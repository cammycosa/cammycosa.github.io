)]}'
{"version":3,"file":"LJST_SAS.js","sources":["../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/tms.js","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/rtl.js","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/system.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/rtlconsts.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/types.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/js.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/sysutils.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/typinfo.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/web.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/classes.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/math.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/contnrs.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Graphics.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Controls.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Modules.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Lang.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.JSON.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Consts.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Utils.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.WebTools.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.WebCtrls.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Dialogs.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.ClientConnector.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Forms.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/dateutils.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/dbconst.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/db.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/fpexprpars.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/jsondataset.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.DB.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.CDS.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Grids.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.StdCtrls.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.ExtCtrls.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.TreeNodes.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.ComCtrls.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Buttons.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/RTL/strutils.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Mask.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.EditAutocomplete.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.DBCtrls.pas","../../../../Users/cameron/Documents/tmssoftware/TMS WEB Core RSXE12/Core Source/WEBLib.Imaging.gifimg.pas","../../uDM.pas","../../uHome.pas","../../uLogin.pas","../../LJST_SAS.dpr"],"sourcesContent":["//***********************************************************************************\r\n// TMS WEB CORE framework code is copyright (c) 2018 - 2020 by tmssoftware.com bvba\r\n// The code or parts of the code cannot be used in any way outside \r\n// a TMS WEB Core application generated by a licensed user or company.\r\n//***********************************************************************************\r\n","var pas = {};\n\nvar rtl = {\n\n  version: 10501,\n\n  quiet: false,\n  debug_load_units: false,\n  debug_rtti: false,\n\n  debug: function(){\n    if (rtl.quiet || !console || !console.log) return;\n    console.log(arguments);\n  },\n\n  error: function(s){\n    rtl.debug('Error: ',s);\n    throw s;\n  },\n\n  warn: function(s){\n    rtl.debug('Warn: ',s);\n  },\n\n  checkVersion: function(v){\n    if (rtl.version != v) throw \"expected rtl version \"+v+\", but found \"+rtl.version;\n  },\n\n  hiInt: Math.pow(2,53),\n\n  hasString: function(s){\n    return rtl.isString(s) && (s.length>0);\n  },\n\n  isArray: function(a) {\n    return Array.isArray(a);\n  },\n\n  isFunction: function(f){\n    return typeof(f)===\"function\";\n  },\n\n  isModule: function(m){\n    return rtl.isObject(m) && rtl.hasString(m.$name) && (pas[m.$name]===m);\n  },\n\n  isImplementation: function(m){\n    return rtl.isObject(m) && rtl.isModule(m.$module) && (m.$module.$impl===m);\n  },\n\n  isNumber: function(n){\n    return typeof(n)===\"number\";\n  },\n\n  isObject: function(o){\n    var s=typeof(o);\n    return (typeof(o)===\"object\") && (o!=null);\n  },\n\n  isString: function(s){\n    return typeof(s)===\"string\";\n  },\n\n  getNumber: function(n){\n    return typeof(n)===\"number\"?n:NaN;\n  },\n\n  getChar: function(c){\n    return ((typeof(c)===\"string\") && (c.length===1)) ? c : \"\";\n  },\n\n  getObject: function(o){\n    return ((typeof(o)===\"object\") || (typeof(o)==='function')) ? o : null;\n  },\n\n  isTRecord: function(type){\n    return (rtl.isObject(type) && type.hasOwnProperty('$new') && (typeof(type.$new)==='function'));\n  },\n\n  isPasClass: function(type){\n    return (rtl.isObject(type) && type.hasOwnProperty('$classname') && rtl.isObject(type.$module));\n  },\n\n  isPasClassInstance: function(type){\n    return (rtl.isObject(type) && rtl.isPasClass(type.$class));\n  },\n\n  hexStr: function(n,digits){\n    return (\"000000000000000\"+n.toString(16).toUpperCase()).slice(-digits);\n  },\n\n  m_loading: 0,\n  m_loading_intf: 1,\n  m_intf_loaded: 2,\n  m_loading_impl: 3, // loading all used unit\n  m_initializing: 4, // running initialization\n  m_initialized: 5,\n\n  module: function(module_name, intfuseslist, intfcode, impluseslist, implcode){\n    if (rtl.debug_load_units) rtl.debug('rtl.module name=\"'+module_name+'\" intfuses='+intfuseslist+' impluses='+impluseslist+' hasimplcode='+rtl.isFunction(implcode));\n    if (!rtl.hasString(module_name)) rtl.error('invalid module name \"'+module_name+'\"');\n    if (!rtl.isArray(intfuseslist)) rtl.error('invalid interface useslist of \"'+module_name+'\"');\n    if (!rtl.isFunction(intfcode)) rtl.error('invalid interface code of \"'+module_name+'\"');\n    if (!(impluseslist==undefined) && !rtl.isArray(impluseslist)) rtl.error('invalid implementation useslist of \"'+module_name+'\"');\n    if (!(implcode==undefined) && !rtl.isFunction(implcode)) rtl.error('invalid implementation code of \"'+module_name+'\"');\n\n    if (pas[module_name])\n      rtl.error('module \"'+module_name+'\" is already registered');\n\n    var module = pas[module_name] = {\n      $name: module_name,\n      $intfuseslist: intfuseslist,\n      $impluseslist: impluseslist,\n      $state: rtl.m_loading,\n      $intfcode: intfcode,\n      $implcode: implcode,\n      $impl: null,\n      $rtti: Object.create(rtl.tSectionRTTI)\n    };\n    module.$rtti.$module = module;\n    if (implcode) module.$impl = {\n      $module: module,\n      $rtti: module.$rtti\n    };\n  },\n\n  exitcode: 0,\n\n  run: function(module_name){\n  \n    function doRun(){\n      if (!rtl.hasString(module_name)) module_name='program';\n      if (rtl.debug_load_units) rtl.debug('rtl.run module=\"'+module_name+'\"');\n      rtl.initRTTI();\n      var module = pas[module_name];\n      if (!module) rtl.error('rtl.run module \"'+module_name+'\" missing');\n      rtl.loadintf(module);\n      rtl.loadimpl(module);\n      if (module_name=='program'){\n        if (rtl.debug_load_units) rtl.debug('running $main');\n        var r = pas.program.$main();\n        if (rtl.isNumber(r)) rtl.exitcode = r;\n      }\n    }\n    \n    if (rtl.showUncaughtExceptions) {\n      try{\n        doRun();\n      } catch(re) {\n        var errMsg = rtl.hasString(re.$classname) ? re.$classname : '';\n\t    errMsg +=  ((errMsg) ? ': ' : '') + (re.hasOwnProperty('fMessage') ? re.fMessage : re);\n        alert('Uncaught Exception : '+errMsg);\n        rtl.exitCode = 216;\n      }\n    } else {\n      doRun();\n    }\n    return rtl.exitcode;\n  },\n\n  loadintf: function(module){\n    if (module.$state>rtl.m_loading_intf) return; // already finished\n    if (rtl.debug_load_units) rtl.debug('loadintf: \"'+module.$name+'\"');\n    if (module.$state===rtl.m_loading_intf)\n      rtl.error('unit cycle detected \"'+module.$name+'\"');\n    module.$state=rtl.m_loading_intf;\n    // load interfaces of interface useslist\n    rtl.loaduseslist(module,module.$intfuseslist,rtl.loadintf);\n    // run interface\n    if (rtl.debug_load_units) rtl.debug('loadintf: run intf of \"'+module.$name+'\"');\n    module.$intfcode(module.$intfuseslist);\n    // success\n    module.$state=rtl.m_intf_loaded;\n    // Note: units only used in implementations are not yet loaded (not even their interfaces)\n  },\n\n  loaduseslist: function(module,useslist,f){\n    if (useslist==undefined) return;\n    for (var i in useslist){\n      var unitname=useslist[i];\n      if (rtl.debug_load_units) rtl.debug('loaduseslist of \"'+module.$name+'\" uses=\"'+unitname+'\"');\n      if (pas[unitname]==undefined)\n        rtl.error('module \"'+module.$name+'\" misses \"'+unitname+'\"');\n      f(pas[unitname]);\n    }\n  },\n\n  loadimpl: function(module){\n    if (module.$state>=rtl.m_loading_impl) return; // already processing\n    if (module.$state<rtl.m_intf_loaded) rtl.error('loadimpl: interface not loaded of \"'+module.$name+'\"');\n    if (rtl.debug_load_units) rtl.debug('loadimpl: load uses of \"'+module.$name+'\"');\n    module.$state=rtl.m_loading_impl;\n    // load interfaces of implementation useslist\n    rtl.loaduseslist(module,module.$impluseslist,rtl.loadintf);\n    // load implementation of interfaces useslist\n    rtl.loaduseslist(module,module.$intfuseslist,rtl.loadimpl);\n    // load implementation of implementation useslist\n    rtl.loaduseslist(module,module.$impluseslist,rtl.loadimpl);\n    // Note: At this point all interfaces used by this unit are loaded. If\n    //   there are implementation uses cycles some used units might not yet be\n    //   initialized. This is by design.\n    // run implementation\n    if (rtl.debug_load_units) rtl.debug('loadimpl: run impl of \"'+module.$name+'\"');\n    if (rtl.isFunction(module.$implcode)) module.$implcode(module.$impluseslist);\n    // run initialization\n    if (rtl.debug_load_units) rtl.debug('loadimpl: run init of \"'+module.$name+'\"');\n    module.$state=rtl.m_initializing;\n    if (rtl.isFunction(module.$init)) module.$init();\n    // unit initialized\n    module.$state=rtl.m_initialized;\n  },\n\n  createCallback: function(scope, fn){\n    var cb;\n    if (typeof(fn)==='string'){\n      cb = function(){\n        return scope[fn].apply(scope,arguments);\n      };\n    } else {\n      cb = function(){\n        return fn.apply(scope,arguments);\n      };\n    };\n    cb.scope = scope;\n    cb.fn = fn;\n    return cb;\n  },\n\n  cloneCallback: function(cb){\n    return rtl.createCallback(cb.scope,cb.fn);\n  },\n\n  eqCallback: function(a,b){\n    // can be a function or a function wrapper\n    if (a==b){\n      return true;\n    } else {\n      return (a!=null) && (b!=null) && (a.fn) && (a.scope===b.scope) && (a.fn==b.fn);\n    }\n  },\n\n  initStruct: function(c,parent,name){\n    if ((parent.$module) && (parent.$module.$impl===parent)) parent=parent.$module;\n    c.$parent = parent;\n    if (rtl.isModule(parent)){\n      c.$module = parent;\n      c.$name = name;\n    } else {\n      c.$module = parent.$module;\n      c.$name = parent.$name+'.'+name;\n    };\n    return parent;\n  },\n\n  initClass: function(c,parent,name,initfn){\n    parent[name] = c;\n    c.$class = c; // Note: o.$class === Object.getPrototypeOf(o)\n    c.$classname = name;\n    parent = rtl.initStruct(c,parent,name);\n    c.$fullname = parent.$name+'.'+name;\n    // rtti\n    if (rtl.debug_rtti) rtl.debug('initClass '+c.$fullname);\n    var t = c.$module.$rtti.$Class(c.$name,{ \"class\": c });\n    c.$rtti = t;\n    if (rtl.isObject(c.$ancestor)) t.ancestor = c.$ancestor.$rtti;\n    if (!t.ancestor) t.ancestor = null;\n    // init members\n    initfn.call(c);\n  },\n\n  createClass: function(parent,name,ancestor,initfn){\n    // create a normal class,\n    // ancestor must be null or a normal class,\n    // the root ancestor can be an external class\n    var c = null;\n    if (ancestor != null){\n      c = Object.create(ancestor);\n      c.$ancestor = ancestor;\n      // Note:\n      // if root is an \"object\" then c.$ancestor === Object.getPrototypeOf(c)\n      // if root is a \"function\" then c.$ancestor === c.__proto__, Object.getPrototypeOf(c) returns the root\n    } else {\n      c = { $ancestor: null };\n      c.$create = function(fn,args){\n        if (args == undefined) args = [];\n        var o = Object.create(this);\n        o.$init();\n        try{\n          if (typeof(fn)===\"string\"){\n            o[fn].apply(o,args);\n          } else {\n            fn.apply(o,args);\n          };\n          o.AfterConstruction();\n        } catch($e){\n          // do not call BeforeDestruction\n          if (o.Destroy) o.Destroy();\n          o.$final();\n          throw $e;\n        }\n        return o;\n      };\n      c.$destroy = function(fnname){\n        this.BeforeDestruction();\n        if (this[fnname]) this[fnname]();\n        this.$final();\n      };\n    };\n    rtl.initClass(c,parent,name,initfn);\n  },\n\n  createClassExt: function(parent,name,ancestor,newinstancefnname,initfn){\n    // Create a class using an external ancestor.\n    // If newinstancefnname is given, use that function to create the new object.\n    // If exist call BeforeDestruction and AfterConstruction.\n    var c = Object.create(ancestor);\n    c.$create = function(fn,args){\n      if (args == undefined) args = [];\n      var o = null;\n      if (newinstancefnname.length>0){\n        o = this[newinstancefnname](fn,args);\n      } else {\n        o = Object.create(this);\n      }\n      if (o.$init) o.$init();\n      try{\n        if (typeof(fn)===\"string\"){\n          o[fn].apply(o,args);\n        } else {\n          fn.apply(o,args);\n        };\n        if (o.AfterConstruction) o.AfterConstruction();\n      } catch($e){\n        // do not call BeforeDestruction\n        console.log($e);\n        if (o.Destroy) o.Destroy();\n        if (o.$final) this.$final();\n        throw $e;\n      }\n      return o;\n    };\n    c.$destroy = function(fnname){\n      if (this.BeforeDestruction) this.BeforeDestruction();\n      if (this[fnname]) this[fnname]();\n      if (this.$final) this.$final();\n    };\n    rtl.initClass(c,parent,name,initfn);\n  },\n\n  createHelper: function(parent,name,ancestor,initfn){\n    // create a helper,\n    // ancestor must be null or a helper,\n    var c = null;\n    if (ancestor != null){\n      c = Object.create(ancestor);\n      c.$ancestor = ancestor;\n      // c.$ancestor === Object.getPrototypeOf(c)\n    } else {\n      c = { $ancestor: null };\n    };\n    parent[name] = c;\n    c.$class = c; // Note: o.$class === Object.getPrototypeOf(o)\n    c.$classname = name;\n    parent = rtl.initStruct(c,parent,name);\n    c.$fullname = parent.$name+'.'+name;\n    // rtti\n    var t = c.$module.$rtti.$Helper(c.$name,{ \"helper\": c });\n    c.$rtti = t;\n    if (rtl.isObject(ancestor)) t.ancestor = ancestor.$rtti;\n    if (!t.ancestor) t.ancestor = null;\n    // init members\n    initfn.call(c);\n  },\n\n  tObjectDestroy: \"Destroy\",\n\n  free: function(obj,name){\n    if (obj[name]==null) return null;\n    obj[name].$destroy(rtl.tObjectDestroy);\n    obj[name]=null;\n  },\n\n  freeLoc: function(obj){\n    if (obj==null) return null;\n    obj.$destroy(rtl.tObjectDestroy);\n    return null;\n  },\n\n  recNewT: function(parent,name,initfn,full){\n    // create new record type\n    var t = {};\n    if (parent) parent[name] = t;\n    function hide(prop){\n      Object.defineProperty(t,prop,{enumerable:false});\n    }\n    if (full){\n      rtl.initStruct(t,parent,name);\n      t.$record = t;\n      hide('$record');\n      hide('$name');\n      hide('$parent');\n      hide('$module');\n    }\n    initfn.call(t);\n    if (!t.$new){\n      t.$new = function(){ return Object.create(this); };\n    }\n    t.$clone = function(r){ return this.$new().$assign(r); };\n    hide('$new');\n    hide('$clone');\n    hide('$eq');\n    hide('$assign');\n    return t;\n  },\n\n  is: function(instance,type){\n    return type.isPrototypeOf(instance) || (instance===type);\n  },\n\n  isExt: function(instance,type,mode){\n    // mode===1 means instance must be a Pascal class instance\n    // mode===2 means instance must be a Pascal class\n    // Notes:\n    // isPrototypeOf and instanceof return false on equal\n    // isPrototypeOf does not work for Date.isPrototypeOf(new Date())\n    //   so if isPrototypeOf is false test with instanceof\n    // instanceof needs a function on right side\n    if (instance == null) return false; // Note: ==null checks for undefined too\n    if ((typeof(type) !== 'object') && (typeof(type) !== 'function')) return false;\n    if (instance === type){\n      if (mode===1) return false;\n      if (mode===2) return rtl.isPasClass(instance);\n      return true;\n    }\n    if (type.isPrototypeOf && type.isPrototypeOf(instance)){\n      if (mode===1) return rtl.isPasClassInstance(instance);\n      if (mode===2) return rtl.isPasClass(instance);\n      return true;\n    }\n    if ((typeof type == 'function') && (instance instanceof type)) return true;\n    return false;\n  },\n\n  Exception: null,\n  EInvalidCast: null,\n  EAbstractError: null,\n  ERangeError: null,\n  EIntOverflow: null,\n  EPropWriteOnly: null,\n\n  raiseE: function(typename){\n    var t = rtl[typename];\n    if (t==null){\n      var mod = pas.SysUtils;\n      if (!mod) mod = pas.sysutils;\n      if (mod){\n        t = mod[typename];\n        if (!t) t = mod[typename.toLowerCase()];\n        if (!t) t = mod['Exception'];\n        if (!t) t = mod['exception'];\n      }\n    }\n    if (t){\n      if (t.Create){\n        throw t.$create(\"Create\");\n      } else if (t.create){\n        throw t.$create(\"create\");\n      }\n    }\n    if (typename === \"EInvalidCast\") throw \"invalid type cast\";\n    if (typename === \"EAbstractError\") throw \"Abstract method called\";\n    if (typename === \"ERangeError\") throw \"range error\";\n    throw typename;\n  },\n\n  as: function(instance,type){\n    if((instance === null) || rtl.is(instance,type)) return instance;\n    rtl.raiseE(\"EInvalidCast\");\n  },\n\n  asExt: function(instance,type,mode){\n    if((instance === null) || rtl.isExt(instance,type,mode)) return instance;\n    rtl.raiseE(\"EInvalidCast\");\n  },\n\n  createInterface: function(module, name, guid, fnnames, ancestor, initfn){\n    //console.log('createInterface name=\"'+name+'\" guid=\"'+guid+'\" names='+fnnames);\n    var i = ancestor?Object.create(ancestor):{};\n    module[name] = i;\n    i.$module = module;\n    i.$name = name;\n    i.$fullname = module.$name+'.'+name;\n    i.$guid = guid;\n    i.$guidr = null;\n    i.$names = fnnames?fnnames:[];\n    if (rtl.isFunction(initfn)){\n      // rtti\n      if (rtl.debug_rtti) rtl.debug('createInterface '+i.$fullname);\n      var t = i.$module.$rtti.$Interface(name,{ \"interface\": i, module: module });\n      i.$rtti = t;\n      if (ancestor) t.ancestor = ancestor.$rtti;\n      if (!t.ancestor) t.ancestor = null;\n      initfn.call(i);\n    }\n    return i;\n  },\n\n  strToGUIDR: function(s,g){\n    var p = 0;\n    function n(l){\n      var h = s.substr(p,l);\n      p+=l;\n      return parseInt(h,16);\n    }\n    p+=1; // skip {\n    g.D1 = n(8);\n    p+=1; // skip -\n    g.D2 = n(4);\n    p+=1; // skip -\n    g.D3 = n(4);\n    p+=1; // skip -\n    if (!g.D4) g.D4=[];\n    g.D4[0] = n(2);\n    g.D4[1] = n(2);\n    p+=1; // skip -\n    for(var i=2; i<8; i++) g.D4[i] = n(2);\n    return g;\n  },\n\n  guidrToStr: function(g){\n    if (g.$intf) return g.$intf.$guid;\n    var h = rtl.hexStr;\n    var s='{'+h(g.D1,8)+'-'+h(g.D2,4)+'-'+h(g.D3,4)+'-'+h(g.D4[0],2)+h(g.D4[1],2)+'-';\n    for (var i=2; i<8; i++) s+=h(g.D4[i],2);\n    s+='}';\n    return s;\n  },\n\n  createTGUID: function(guid){\n    var TGuid = (pas.System)?pas.System.TGuid:pas.system.tguid;\n    var g = rtl.strToGUIDR(guid,TGuid.$new());\n    return g;\n  },\n\n  getIntfGUIDR: function(intfTypeOrVar){\n    if (!intfTypeOrVar) return null;\n    if (!intfTypeOrVar.$guidr){\n      var g = rtl.createTGUID(intfTypeOrVar.$guid);\n      if (!intfTypeOrVar.hasOwnProperty('$guid')) intfTypeOrVar = Object.getPrototypeOf(intfTypeOrVar);\n      g.$intf = intfTypeOrVar;\n      intfTypeOrVar.$guidr = g;\n    }\n    return intfTypeOrVar.$guidr;\n  },\n\n  addIntf: function (aclass, intf, map){\n    function jmp(fn){\n      if (typeof(fn)===\"function\"){\n        return function(){ return fn.apply(this.$o,arguments); };\n      } else {\n        return function(){ rtl.raiseE('EAbstractError'); };\n      }\n    }\n    if(!map) map = {};\n    var t = intf;\n    var item = Object.create(t);\n    if (!aclass.hasOwnProperty('$intfmaps')) aclass.$intfmaps = {};\n    aclass.$intfmaps[intf.$guid] = item;\n    do{\n      var names = t.$names;\n      if (!names) break;\n      for (var i=0; i<names.length; i++){\n        var intfname = names[i];\n        var fnname = map[intfname];\n        if (!fnname) fnname = intfname;\n        //console.log('addIntf: intftype='+t.$name+' index='+i+' intfname=\"'+intfname+'\" fnname=\"'+fnname+'\" old='+typeof(item[intfname]));\n        item[intfname] = jmp(aclass[fnname]);\n      }\n      t = Object.getPrototypeOf(t);\n    }while(t!=null);\n  },\n\n  getIntfG: function (obj, guid, query){\n    if (!obj) return null;\n    //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' query='+query);\n    // search\n    var maps = obj.$intfmaps;\n    if (!maps) return null;\n    var item = maps[guid];\n    if (!item) return null;\n    // check delegation\n    //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' query='+query+' item='+typeof(item));\n    if (typeof item === 'function') return item.call(obj); // delegate. Note: COM contains _AddRef\n    // check cache\n    var intf = null;\n    if (obj.$interfaces){\n      intf = obj.$interfaces[guid];\n      //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' cache='+typeof(intf));\n    }\n    if (!intf){ // intf can be undefined!\n      intf = Object.create(item);\n      intf.$o = obj;\n      if (!obj.$interfaces) obj.$interfaces = {};\n      obj.$interfaces[guid] = intf;\n    }\n    if (typeof(query)==='object'){\n      // called by queryIntfT\n      var o = null;\n      if (intf.QueryInterface(rtl.getIntfGUIDR(query),\n          {get:function(){ return o; }, set:function(v){ o=v; }}) === 0){\n        return o;\n      } else {\n        return null;\n      }\n    } else if(query===2){\n      // called by TObject.GetInterfaceByStr\n      if (intf.$kind === 'com') intf._AddRef();\n    }\n    return intf;\n  },\n\n  getIntfT: function(obj,intftype){\n    return rtl.getIntfG(obj,intftype.$guid);\n  },\n\n  queryIntfT: function(obj,intftype){\n    return rtl.getIntfG(obj,intftype.$guid,intftype);\n  },\n\n  queryIntfIsT: function(obj,intftype){\n    var i = rtl.queryIntfG(obj,intftype.$guid);\n    if (!i) return false;\n    if (i.$kind === 'com') i._Release();\n    return true;\n  },\n\n  asIntfT: function (obj,intftype){\n    var i = rtl.getIntfG(obj,intftype.$guid);\n    if (i!==null) return i;\n    rtl.raiseEInvalidCast();\n  },\n\n  intfIsIntfT: function(intf,intftype){\n    return (intf!==null) && rtl.queryIntfIsT(intf.$o,intftype);\n  },\n\n  intfAsIntfT: function (intf,intftype){\n    if (intf){\n      var i = rtl.getIntfG(intf.$o,intftype.$guid);\n      if (i!==null) return i;\n    }\n    rtl.raiseEInvalidCast();\n  },\n\n  intfIsClass: function(intf,classtype){\n    return (intf!=null) && (rtl.is(intf.$o,classtype));\n  },\n\n  intfAsClass: function(intf,classtype){\n    if (intf==null) return null;\n    return rtl.as(intf.$o,classtype);\n  },\n\n  intfToClass: function(intf,classtype){\n    if ((intf!==null) && rtl.is(intf.$o,classtype)) return intf.$o;\n    return null;\n  },\n\n  // interface reference counting\n  intfRefs: { // base object for temporary interface variables\n    ref: function(id,intf){\n      // called for temporary interface references needing delayed release\n      var old = this[id];\n      //console.log('rtl.intfRefs.ref: id='+id+' old=\"'+(old?old.$name:'null')+'\" intf=\"'+(intf?intf.$name:'null')+' $o='+(intf?intf.$o:'null'));\n      if (old){\n        // called again, e.g. in a loop\n        delete this[id];\n        old._Release(); // may fail\n      }\n      this[id]=intf;\n      return intf;\n    },\n    free: function(){\n      //console.log('rtl.intfRefs.free...');\n      for (var id in this){\n        if (this.hasOwnProperty(id)){\n          //console.log('rtl.intfRefs.free: id='+id+' '+this[id].$name+' $o='+this[id].$o.$classname);\n          this[id]._Release();\n        }\n      }\n    }\n  },\n\n  createIntfRefs: function(){\n    //console.log('rtl.createIntfRefs');\n    return Object.create(rtl.intfRefs);\n  },\n\n  setIntfP: function(path,name,value,skipAddRef){\n    var old = path[name];\n    //console.log('rtl.setIntfP path='+path+' name='+name+' old=\"'+(old?old.$name:'null')+'\" value=\"'+(value?value.$name:'null')+'\"');\n    if (old === value) return;\n    if (old !== null){\n      path[name]=null;\n      old._Release();\n    }\n    if (value !== null){\n      if (!skipAddRef) value._AddRef();\n      path[name]=value;\n    }\n  },\n\n  setIntfL: function(old,value,skipAddRef){\n    //console.log('rtl.setIntfL old=\"'+(old?old.$name:'null')+'\" value=\"'+(value?value.$name:'null')+'\"');\n    if (old !== value){\n      if (value!==null){\n        if (!skipAddRef) value._AddRef();\n      }\n      if (old!==null){\n        old._Release();  // Release after AddRef, to avoid double Release if Release creates an exception\n      }\n    } else if (skipAddRef){\n      if (old!==null){\n        old._Release();  // value has an AddRef\n      }\n    }\n    return value;\n  },\n\n  _AddRef: function(intf){\n    //if (intf) console.log('rtl._AddRef intf=\"'+(intf?intf.$name:'null')+'\"');\n    if (intf) intf._AddRef();\n    return intf;\n  },\n\n  _Release: function(intf){\n    //if (intf) console.log('rtl._Release intf=\"'+(intf?intf.$name:'null')+'\"');\n    if (intf) intf._Release();\n    return intf;\n  },\n\n  checkMethodCall: function(obj,type){\n    if (rtl.isObject(obj) && rtl.is(obj,type)) return;\n    rtl.raiseE(\"EInvalidCast\");\n  },\n\n  oc: function(i){\n    // overflow check integer\n    if ((Math.floor(i)===i) && (i>=-0x1fffffffffffff) && (i<=0x1fffffffffffff)) return i;\n    rtl.raiseE('EIntOverflow');\n  },\n\n  rc: function(i,minval,maxval){\n    // range check integer\n    if ((Math.floor(i)===i) && (i>=minval) && (i<=maxval)) return i;\n    rtl.raiseE('ERangeError');\n  },\n\n  rcc: function(c,minval,maxval){\n    // range check char\n    if ((typeof(c)==='string') && (c.length===1)){\n      var i = c.charCodeAt(0);\n      if ((i>=minval) && (i<=maxval)) return c;\n    }\n    rtl.raiseE('ERangeError');\n  },\n\n  rcSetCharAt: function(s,index,c){\n    // range check setCharAt\n    if ((typeof(s)!=='string') || (index<0) || (index>=s.length)) rtl.raiseE('ERangeError');\n    return rtl.setCharAt(s,index,c);\n  },\n\n  rcCharAt: function(s,index){\n    // range check charAt\n    if ((typeof(s)!=='string') || (index<0) || (index>=s.length)) rtl.raiseE('ERangeError');\n    return s.charAt(index);\n  },\n\n  rcArrR: function(arr,index){\n    // range check read array\n    if (Array.isArray(arr) && (typeof(index)==='number') && (index>=0) && (index<arr.length)){\n      if (arguments.length>2){\n        // arr,index1,index2,...\n        arr=arr[index];\n        for (var i=2; i<arguments.length; i++) arr=rtl.rcArrR(arr,arguments[i]);\n        return arr;\n      }\n      return arr[index];\n    }\n    rtl.raiseE('ERangeError');\n  },\n\n  rcArrW: function(arr,index,value){\n    // range check write array\n    // arr,index1,index2,...,value\n    for (var i=3; i<arguments.length; i++){\n      arr=rtl.rcArrR(arr,index);\n      index=arguments[i-1];\n      value=arguments[i];\n    }\n    if (Array.isArray(arr) && (typeof(index)==='number') && (index>=0) && (index<arr.length)){\n      return arr[index]=value;\n    }\n    rtl.raiseE('ERangeError');\n  },\n\n  length: function(arr){\n    return (arr == null) ? 0 : arr.length;\n  },\n\n  arraySetLength: function(arr,defaultvalue,newlength){\n    var stack = [];\n    for (var i=2; i<arguments.length; i++){\n      stack.push({ dim:arguments[i]+0, a:null, i:0, src:null });\n    }\n    var dimmax = stack.length-1;\n    var depth = 0;\n    var lastlen = stack[dimmax].dim;\n    var item = null;\n    var a = null;\n    var src = arr;\n    var oldlen = 0\n    do{\n      a = [];\n      if (depth>0){\n        item=stack[depth-1];\n        item.a[item.i]=a;\n        src = (item.src && item.src.length>item.i)?item.src[item.i]:null;\n        item.i++;\n      }\n      if (depth<dimmax){\n        item = stack[depth];\n        item.a = a;\n        item.i = 0;\n        item.src = src;\n        depth++;\n      } else {\n        oldlen = src?src.length:0;\n        if (rtl.isArray(defaultvalue)){\n          for (var i=0; i<lastlen; i++) a[i]=(i<oldlen)?src[i]:[]; // array of dyn array\n        } else if (rtl.isObject(defaultvalue)) {\n          if (rtl.isTRecord(defaultvalue)){\n            for (var i=0; i<lastlen; i++){\n              a[i]=(i<oldlen)?defaultvalue.$clone(src[i]):defaultvalue.$new(); // e.g. record\n            }\n          } else {\n            for (var i=0; i<lastlen; i++) a[i]=(i<oldlen)?rtl.refSet(src[i]):{}; // e.g. set\n          }\n        } else {\n          for (var i=0; i<lastlen; i++)\n            a[i]=(i<oldlen)?src[i]:defaultvalue;\n        }\n        while ((depth>0) && (stack[depth-1].i>=stack[depth-1].dim)){\n          depth--;\n        };\n        if (depth===0){\n          if (dimmax===0) return a;\n          return stack[0].a;\n        }\n      }\n    }while (true);\n  },\n\n  /*arrayChgLength: function(arr,defaultvalue,newlength){\n    // multi dim: (arr,defaultvalue,dim1,dim2,...)\n    if (arr == null) arr = [];\n    var p = arguments;\n    function setLength(a,argNo){\n      var oldlen = a.length;\n      var newlen = p[argNo];\n      if (oldlen!==newlength){\n        a.length = newlength;\n        if (argNo === p.length-1){\n          if (rtl.isArray(defaultvalue)){\n            for (var i=oldlen; i<newlen; i++) a[i]=[]; // nested array\n          } else if (rtl.isObject(defaultvalue)) {\n            if (rtl.isTRecord(defaultvalue)){\n              for (var i=oldlen; i<newlen; i++) a[i]=defaultvalue.$new(); // e.g. record\n            } else {\n              for (var i=oldlen; i<newlen; i++) a[i]={}; // e.g. set\n            }\n          } else {\n            for (var i=oldlen; i<newlen; i++) a[i]=defaultvalue;\n          }\n        } else {\n          for (var i=oldlen; i<newlen; i++) a[i]=[]; // nested array\n        }\n      }\n      if (argNo < p.length-1){\n        // multi argNo\n        for (var i=0; i<newlen; i++) a[i]=setLength(a[i],argNo+1);\n      }\n      return a;\n    }\n    return setLength(arr,2);\n  },*/\n\n  arrayEq: function(a,b){\n    if (a===null) return b===null;\n    if (b===null) return false;\n    if (a.length!==b.length) return false;\n    for (var i=0; i<a.length; i++) if (a[i]!==b[i]) return false;\n    return true;\n  },\n\n  arrayClone: function(type,src,srcpos,endpos,dst,dstpos){\n    // type: 0 for references, \"refset\" for calling refSet(), a function for new type()\n    // src must not be null\n    // This function does not range check.\n    if(type === 'refSet') {\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = rtl.refSet(src[srcpos]); // ref set\n    } else if (rtl.isTRecord(type)){\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = type.$clone(src[srcpos]); // clone record\n    }  else {\n      for (; srcpos<endpos; srcpos++) dst[dstpos++] = src[srcpos]; // reference\n    };\n  },\n\n  arrayConcat: function(type){\n    // type: see rtl.arrayClone\n    var a = [];\n    var l = 0;\n    for (var i=1; i<arguments.length; i++){\n      var src = arguments[i];\n      if (src !== null) l+=src.length;\n    };\n    a.length = l;\n    l=0;\n    for (var i=1; i<arguments.length; i++){\n      var src = arguments[i];\n      if (src === null) continue;\n      rtl.arrayClone(type,src,0,src.length,a,l);\n      l+=src.length;\n    };\n    return a;\n  },\n\n  arrayConcatN: function(){\n    var a = null;\n    for (var i=1; i<arguments.length; i++){\n      var src = arguments[i];\n      if (src === null) continue;\n      if (a===null){\n        a=src; // Note: concat(a) does not clone\n      } else {\n        a=a.concat(src);\n      }\n    };\n    return a;\n  },\n\n  arrayCopy: function(type, srcarray, index, count){\n    // type: see rtl.arrayClone\n    // if count is missing, use srcarray.length\n    if (srcarray === null) return [];\n    if (index < 0) index = 0;\n    if (count === undefined) count=srcarray.length;\n    var end = index+count;\n    if (end>srcarray.length) end = srcarray.length;\n    if (index>=end) return [];\n    if (type===0){\n      return srcarray.slice(index,end);\n    } else {\n      var a = [];\n      a.length = end-index;\n      rtl.arrayClone(type,srcarray,index,end,a,0);\n      return a;\n    }\n  },\n\n  setCharAt: function(s,index,c){\n    return s.substr(0,index)+c+s.substr(index+1);\n  },\n\n  getResStr: function(mod,name){\n    var rs = mod.$resourcestrings[name];\n    return rs.current?rs.current:rs.org;\n  },\n\n  createSet: function(){\n    var s = {};\n    for (var i=0; i<arguments.length; i++){\n      if (arguments[i]!=null){\n        s[arguments[i]]=true;\n      } else {\n        var first=arguments[i+=1];\n        var last=arguments[i+=1];\n        for(var j=first; j<=last; j++) s[j]=true;\n      }\n    }\n    return s;\n  },\n\n  cloneSet: function(s){\n    var r = {};\n    for (var key in s) r[key]=true;\n    return r;\n  },\n\n  refSet: function(s){\n    Object.defineProperty(s, '$shared', {\n      enumerable: false,\n      configurable: true,\n      writable: true,\n      value: true\n    });\n    return s;\n  },\n\n  includeSet: function(s,enumvalue){\n    if (s.$shared) s = rtl.cloneSet(s);\n    s[enumvalue] = true;\n    return s;\n  },\n\n  excludeSet: function(s,enumvalue){\n    if (s.$shared) s = rtl.cloneSet(s);\n    delete s[enumvalue];\n    return s;\n  },\n\n  diffSet: function(s,t){\n    var r = {};\n    for (var key in s) if (!t[key]) r[key]=true;\n    return r;\n  },\n\n  unionSet: function(s,t){\n    var r = {};\n    for (var key in s) r[key]=true;\n    for (var key in t) r[key]=true;\n    return r;\n  },\n\n  intersectSet: function(s,t){\n    var r = {};\n    for (var key in s) if (t[key]) r[key]=true;\n    return r;\n  },\n\n  symDiffSet: function(s,t){\n    var r = {};\n    for (var key in s) if (!t[key]) r[key]=true;\n    for (var key in t) if (!s[key]) r[key]=true;\n    return r;\n  },\n\n  eqSet: function(s,t){\n    for (var key in s) if (!t[key]) return false;\n    for (var key in t) if (!s[key]) return false;\n    return true;\n  },\n\n  neSet: function(s,t){\n    return !rtl.eqSet(s,t);\n  },\n\n  leSet: function(s,t){\n    for (var key in s) if (!t[key]) return false;\n    return true;\n  },\n\n  geSet: function(s,t){\n    for (var key in t) if (!s[key]) return false;\n    return true;\n  },\n\n  strSetLength: function(s,newlen){\n    var oldlen = s.length;\n    if (oldlen > newlen){\n      return s.substring(0,newlen);\n    } else if (s.repeat){\n      // Note: repeat needs ECMAScript6!\n      return s+' '.repeat(newlen-oldlen);\n    } else {\n       while (oldlen<newlen){\n         s+=' ';\n         oldlen++;\n       };\n       return s;\n    }\n  },\n\n  spaceLeft: function(s,width){\n    var l=s.length;\n    if (l>=width) return s;\n    if (s.repeat){\n      // Note: repeat needs ECMAScript6!\n      return ' '.repeat(width-l) + s;\n    } else {\n      while (l<width){\n        s=' '+s;\n        l++;\n      };\n      return s;\n    };\n  },\n\n  floatToStr: function(d,w,p){\n    // input 1-3 arguments: double, width, precision\n    if (arguments.length>2){\n      return rtl.spaceLeft(d.toFixed(p),w);\n    } else {\n\t  // exponent width\n\t  var pad = \"\";\n\t  var ad = Math.abs(d);\n\t  if (ad<1.0e+10) {\n\t\tpad='00';\n\t  } else if (ad<1.0e+100) {\n\t\tpad='0';\n      }  \t\n\t  if (arguments.length<2) {\n\t    w=9;\t\t\n      } else if (w<9) {\n\t\tw=9;\n      }\t\t  \n      var p = w-8;\n      var s=(d>0 ? \" \" : \"\" ) + d.toExponential(p);\n      s=s.replace(/e(.)/,'E$1'+pad);\n      return rtl.spaceLeft(s,w);\n    }\n  },\n\n  valEnum: function(s, enumType, setCodeFn){\n    s = s.toLowerCase();\n    for (var key in enumType){\n      if((typeof(key)==='string') && (key.toLowerCase()===s)){\n        setCodeFn(0);\n        return enumType[key];\n      }\n    }\n    setCodeFn(1);\n    return 0;\n  },\n\n  lw: function(l){\n    // fix longword bitwise operation\n    return l<0?l+0x100000000:l;\n  },\n\n  and: function(a,b){\n    var hi = 0x80000000;\n    var low = 0x7fffffff;\n    var h = (a / hi) & (b / hi);\n    var l = (a & low) & (b & low);\n    return h*hi + l;\n  },\n\n  or: function(a,b){\n    var hi = 0x80000000;\n    var low = 0x7fffffff;\n    var h = (a / hi) | (b / hi);\n    var l = (a & low) | (b & low);\n    return h*hi + l;\n  },\n\n  xor: function(a,b){\n    var hi = 0x80000000;\n    var low = 0x7fffffff;\n    var h = (a / hi) ^ (b / hi);\n    var l = (a & low) ^ (b & low);\n    return h*hi + l;\n  },\n\n  shr: function(a,b){\n    if (a<0) a += rtl.hiInt;\n    if (a<0x80000000) return a >> b;\n    if (b<=0) return a;\n    if (b>54) return 0;\n    return Math.floor(a / Math.pow(2,b));\n  },\n\n  shl: function(a,b){\n    if (a<0) a += rtl.hiInt;\n    if (b<=0) return a;\n    if (b>54) return 0;\n    var r = a * Math.pow(2,b);\n    if (r <= rtl.hiInt) return r;\n    return r % rtl.hiInt;\n  },\n\n  initRTTI: function(){\n    if (rtl.debug_rtti) rtl.debug('initRTTI');\n\n    // base types\n    rtl.tTypeInfo = { name: \"tTypeInfo\" };\n    function newBaseTI(name,kind,ancestor){\n      if (!ancestor) ancestor = rtl.tTypeInfo;\n      if (rtl.debug_rtti) rtl.debug('initRTTI.newBaseTI \"'+name+'\" '+kind+' (\"'+ancestor.name+'\")');\n      var t = Object.create(ancestor);\n      t.name = name;\n      t.kind = kind;\n      rtl[name] = t;\n      return t;\n    };\n    function newBaseInt(name,minvalue,maxvalue,ordtype){\n      var t = newBaseTI(name,1 /* tkInteger */,rtl.tTypeInfoInteger);\n      t.minvalue = minvalue;\n      t.maxvalue = maxvalue;\n      t.ordtype = ordtype;\n      return t;\n    };\n    newBaseTI(\"tTypeInfoInteger\",1 /* tkInteger */);\n    newBaseInt(\"shortint\",-0x80,0x7f,0);\n    newBaseInt(\"byte\",0,0xff,1);\n    newBaseInt(\"smallint\",-0x8000,0x7fff,2);\n    newBaseInt(\"word\",0,0xffff,3);\n    newBaseInt(\"longint\",-0x80000000,0x7fffffff,4);\n    newBaseInt(\"longword\",0,0xffffffff,5);\n    newBaseInt(\"nativeint\",-0x10000000000000,0xfffffffffffff,6);\n    newBaseInt(\"nativeuint\",0,0xfffffffffffff,7);\n    newBaseTI(\"char\",2 /* tkChar */);\n    newBaseTI(\"string\",3 /* tkString */);\n    newBaseTI(\"tTypeInfoEnum\",4 /* tkEnumeration */,rtl.tTypeInfoInteger);\n    newBaseTI(\"tTypeInfoSet\",5 /* tkSet */);\n    newBaseTI(\"double\",6 /* tkDouble */);\n    newBaseTI(\"boolean\",7 /* tkBool */);\n    newBaseTI(\"tTypeInfoProcVar\",8 /* tkProcVar */);\n    newBaseTI(\"tTypeInfoMethodVar\",9 /* tkMethod */,rtl.tTypeInfoProcVar);\n    newBaseTI(\"tTypeInfoArray\",10 /* tkArray */);\n    newBaseTI(\"tTypeInfoDynArray\",11 /* tkDynArray */);\n    newBaseTI(\"tTypeInfoPointer\",15 /* tkPointer */);\n    var t = newBaseTI(\"pointer\",15 /* tkPointer */,rtl.tTypeInfoPointer);\n    t.reftype = null;\n    newBaseTI(\"jsvalue\",16 /* tkJSValue */);\n    newBaseTI(\"tTypeInfoRefToProcVar\",17 /* tkRefToProcVar */,rtl.tTypeInfoProcVar);\n\n    // member kinds\n    rtl.tTypeMember = {};\n    function newMember(name,kind){\n      var m = Object.create(rtl.tTypeMember);\n      m.name = name;\n      m.kind = kind;\n      rtl[name] = m;\n    };\n    newMember(\"tTypeMemberField\",1); // tmkField\n    newMember(\"tTypeMemberMethod\",2); // tmkMethod\n    newMember(\"tTypeMemberProperty\",3); // tmkProperty\n\n    // base object for storing members: a simple object\n    rtl.tTypeMembers = {};\n\n    // tTypeInfoStruct - base object for tTypeInfoClass, tTypeInfoRecord, tTypeInfoInterface\n    var tis = newBaseTI(\"tTypeInfoStruct\",0);\n    tis.$addMember = function(name,ancestor,options){\n      if (rtl.debug_rtti){\n        if (!rtl.hasString(name) || (name.charAt()==='$')) throw 'invalid member \"'+name+'\", this=\"'+this.name+'\"';\n        if (!rtl.is(ancestor,rtl.tTypeMember)) throw 'invalid ancestor \"'+ancestor+':'+ancestor.name+'\", \"'+this.name+'.'+name+'\"';\n        if ((options!=undefined) && (typeof(options)!='object')) throw 'invalid options \"'+options+'\", \"'+this.name+'.'+name+'\"';\n      };\n      var t = Object.create(ancestor);\n      t.name = name;\n      this.members[name] = t;\n      this.names.push(name);\n      if (rtl.isObject(options)){\n        for (var key in options) if (options.hasOwnProperty(key)) t[key] = options[key];\n      };\n      return t;\n    };\n    tis.addField = function(name,type,options){\n      var t = this.$addMember(name,rtl.tTypeMemberField,options);\n      if (rtl.debug_rtti){\n        if (!rtl.is(type,rtl.tTypeInfo)) throw 'invalid type \"'+type+'\", \"'+this.name+'.'+name+'\"';\n      };\n      t.typeinfo = type;\n      this.fields.push(name);\n      return t;\n    };\n    tis.addFields = function(){\n      var i=0;\n      while(i<arguments.length){\n        var name = arguments[i++];\n        var type = arguments[i++];\n        if ((i<arguments.length) && (typeof(arguments[i])==='object')){\n          this.addField(name,type,arguments[i++]);\n        } else {\n          this.addField(name,type);\n        };\n      };\n    };\n    tis.addMethod = function(name,methodkind,params,result,options){\n      var t = this.$addMember(name,rtl.tTypeMemberMethod,options);\n      t.methodkind = methodkind;\n      t.procsig = rtl.newTIProcSig(params);\n      t.procsig.resulttype = result?result:null;\n      this.methods.push(name);\n      return t;\n    };\n    tis.addProperty = function(name,flags,result,getter,setter,options){\n      var t = this.$addMember(name,rtl.tTypeMemberProperty,options);\n      t.flags = flags;\n      t.typeinfo = result;\n      t.getter = getter;\n      t.setter = setter;\n      // Note: in options: params, stored, defaultvalue\n      if (rtl.isArray(t.params)) t.params = rtl.newTIParams(t.params);\n      this.properties.push(name);\n      if (!rtl.isString(t.stored)) t.stored = \"\";\n      return t;\n    };\n    tis.getField = function(index){\n      return this.members[this.fields[index]];\n    };\n    tis.getMethod = function(index){\n      return this.members[this.methods[index]];\n    };\n    tis.getProperty = function(index){\n      return this.members[this.properties[index]];\n    };\n\n    newBaseTI(\"tTypeInfoRecord\",12 /* tkRecord */,rtl.tTypeInfoStruct);\n    newBaseTI(\"tTypeInfoClass\",13 /* tkClass */,rtl.tTypeInfoStruct);\n    newBaseTI(\"tTypeInfoClassRef\",14 /* tkClassRef */);\n    newBaseTI(\"tTypeInfoInterface\",18 /* tkInterface */,rtl.tTypeInfoStruct);\n    newBaseTI(\"tTypeInfoHelper\",19 /* tkHelper */,rtl.tTypeInfoStruct);\n  },\n\n  tSectionRTTI: {\n    $module: null,\n    $inherited: function(name,ancestor,o){\n      if (rtl.debug_rtti){\n        rtl.debug('tSectionRTTI.newTI \"'+(this.$module?this.$module.$name:\"(no module)\")\n          +'\".\"'+name+'\" ('+ancestor.name+') '+(o?'init':'forward'));\n      };\n      var t = this[name];\n      if (t){\n        if (!t.$forward) throw 'duplicate type \"'+name+'\"';\n        if (!ancestor.isPrototypeOf(t)) throw 'typeinfo ancestor mismatch \"'+name+'\" ancestor=\"'+ancestor.name+'\" t.name=\"'+t.name+'\"';\n      } else {\n        t = Object.create(ancestor);\n        t.name = name;\n        t.$module = this.$module;\n        this[name] = t;\n      }\n      if (o){\n        delete t.$forward;\n        for (var key in o) if (o.hasOwnProperty(key)) t[key]=o[key];\n      } else {\n        t.$forward = true;\n      }\n      return t;\n    },\n    $Scope: function(name,ancestor,o){\n      var t=this.$inherited(name,ancestor,o);\n      t.members = {};\n      t.names = [];\n      t.fields = [];\n      t.methods = [];\n      t.properties = [];\n      return t;\n    },\n    $TI: function(name,kind,o){ var t=this.$inherited(name,rtl.tTypeInfo,o); t.kind = kind; return t; },\n    $Int: function(name,o){ return this.$inherited(name,rtl.tTypeInfoInteger,o); },\n    $Enum: function(name,o){ return this.$inherited(name,rtl.tTypeInfoEnum,o); },\n    $Set: function(name,o){ return this.$inherited(name,rtl.tTypeInfoSet,o); },\n    $StaticArray: function(name,o){ return this.$inherited(name,rtl.tTypeInfoArray,o); },\n    $DynArray: function(name,o){ return this.$inherited(name,rtl.tTypeInfoDynArray,o); },\n    $ProcVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoProcVar,o); },\n    $RefToProcVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoRefToProcVar,o); },\n    $MethodVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoMethodVar,o); },\n    $Record: function(name,o){ return this.$Scope(name,rtl.tTypeInfoRecord,o); },\n    $Class: function(name,o){ return this.$Scope(name,rtl.tTypeInfoClass,o); },\n    $ClassRef: function(name,o){ return this.$inherited(name,rtl.tTypeInfoClassRef,o); },\n    $Pointer: function(name,o){ return this.$inherited(name,rtl.tTypeInfoPointer,o); },\n    $Interface: function(name,o){ return this.$Scope(name,rtl.tTypeInfoInterface,o); },\n    $Helper: function(name,o){ return this.$Scope(name,rtl.tTypeInfoHelper,o); }\n  },\n\n  newTIParam: function(param){\n    // param is an array, 0=name, 1=type, 2=optional flags\n    var t = {\n      name: param[0],\n      typeinfo: param[1],\n      flags: (rtl.isNumber(param[2]) ? param[2] : 0)\n    };\n    return t;\n  },\n\n  newTIParams: function(list){\n    // list: optional array of [paramname,typeinfo,optional flags]\n    var params = [];\n    if (rtl.isArray(list)){\n      for (var i=0; i<list.length; i++) params.push(rtl.newTIParam(list[i]));\n    };\n    return params;\n  },\n\n  newTIProcSig: function(params,result,flags){\n    var s = {\n      params: rtl.newTIParams(params),\n      resulttype: result,\n      flags: flags\n    };\n    return s;\n  }\n}\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit System;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\n{$IFDEF NodeJS}\r\nvar\r\n  LineEnding: string = #10;\r\n  sLineBreak: string = #10;\r\n{$ELSE}\r\nconst\r\n  LineEnding = #10;\r\n  sLineBreak = LineEnding;\r\n{$ENDIF}\r\n\r\nvar\r\n  PathDelim : Char = '/';\r\n  AllowDirectorySeparators : Set of Char = ['/'];\r\n  AllowDriveSeparators : Set of Char = [':'];\r\n  ExtensionSeparator : Char = '.';\r\n\r\nconst\r\n  MaxSmallint = 32767;\r\n  MinSmallint = -32768;\r\n  MaxShortInt = 127;\r\n  MinShortInt = -128;\r\n  MaxByte = $FF;\r\n  MaxWord = $FFFF;\r\n  MaxLongint  = $7fffffff;\r\n  MaxCardinal = LongWord($ffffffff);\r\n\r\n  Maxint = MaxLongint;\r\n  IsMultiThread = false;\r\n\r\n{*****************************************************************************\r\n                               Base types\r\n*****************************************************************************}\r\ntype\r\n  Int8 = ShortInt;\r\n  UInt8 = Byte;\r\n  Int16 = SmallInt;\r\n  UInt16 = Word;\r\n  Int32 = Longint;\r\n  UInt32 = LongWord;\r\n\r\n  Integer = LongInt;\r\n  Cardinal = LongWord;\r\n  DWord = LongWord;\r\n  SizeInt = NativeInt;\r\n  SizeUInt = NativeUInt;\r\n  PtrInt = NativeInt;\r\n  PtrUInt = NativeUInt;\r\n  ValSInt = NativeInt;\r\n  ValUInt = NativeUInt;\r\n  CodePointer = Pointer;\r\n  ValReal = Double;\r\n  Real = type Double;\r\n  Extended = Double;\r\n\r\n  TDateTime = type double;\r\n  TTime = type TDateTime;\r\n  TDate = type TDateTime;\r\n\r\n  Int64 = NativeInt unimplemented; // only 53 bits at runtime\r\n  UInt64 = type NativeUInt unimplemented; // only 52 bits at runtime\r\n  QWord = type NativeUInt unimplemented; // only 52 bits at runtime\r\n  Single = Double unimplemented;\r\n  Comp = type NativeInt unimplemented;\r\n  NativeLargeInt = NativeInt;\r\n  NativeLargeUInt = NativeUInt;\r\n\r\n  UnicodeString = type String;\r\n  WideString = type String;\r\n  WideChar = char;\r\n  UnicodeChar = char;\r\n\r\n  TDynArrayIndex = NativeInt;\r\n  TTextLineBreakStyle = (tlbsLF,tlbsCRLF,tlbsCR);\r\n\r\n  TSystemTime = record\r\n     Year, Month, Day, DayOfWeek: word;\r\n     Hour, Minute, Second, MilliSecond: word;\r\n  end ;\r\n  TTimeStamp = record\r\n     Time: longint;   { Number of milliseconds since midnight }\r\n     Date: longint;   { One plus number of days since 1/1/0001 }\r\n  end ;\r\n\r\n\r\n{*****************************************************************************\r\n            TObject, TClass, IUnknown, IInterface, TInterfacedObject\r\n*****************************************************************************}\r\ntype\r\n  TGuid = record\r\n    D1: DWord;\r\n    D2: word;\r\n    D3: word;\r\n    D4: array[0..7] of byte;\r\n  end;\r\n  TGUIDString = type string;\r\n\r\n  PMethod = ^TMethod;\r\n  TMethod = record\r\n    Code : CodePointer;\r\n    Data : Pointer;\r\n  end;\r\n\r\n  TClass = class of TObject;\r\n\r\n  { TObject }\r\n\r\n  TObject = class\r\n  private\r\n    class var FClassName: String; external name '$classname';\r\n    class var FClassParent: TClass; external name '$ancestor';\r\n    class var FUnitName: String; external name '$module.$name';\r\n  public\r\n    constructor Create;\r\n    destructor Destroy; virtual;\r\n\r\n    // Free is using compiler magic.\r\n    // Reasons:\r\n    // 1. In JS calling obj.Free when obj=nil would crash.\r\n    // 2. In JS freeing memory requires to set all references to nil.\r\n    // Therefore any obj.free call is replaced by the compiler with some rtl magic.\r\n    procedure Free;\r\n\r\n    class function ClassType: TClass; assembler;\r\n    class property ClassName: String read FClassName;\r\n    class function ClassNameIs(const Name: string): boolean;\r\n    class property ClassParent: TClass read FClassParent;\r\n    class function InheritsFrom(aClass: TClass): boolean; assembler;\r\n    class property UnitName: String read FUnitName;\r\n    class function MethodName(ACode: Pointer) : string;\r\n    class function MethodAddress(AName: string): Pointer;\r\n    class function FieldAddress(aName : String) : Pointer;\r\n    //class function ClassInfo : Pointer;\r\n\r\n    procedure AfterConstruction; virtual;\r\n    procedure BeforeDestruction; virtual;\r\n\r\n    function GetInterface(const iid: TGuid; out obj): boolean;\r\n    function GetInterface(const iidstr: String; out obj): boolean; inline;\r\n    function GetInterfaceByStr(const iidstr: String; out obj): boolean;\r\n    function GetInterfaceWeak(const iid: TGuid; out obj): boolean; // equal to GetInterface but the interface returned is not referenced\r\n\r\n    function Equals(Obj: TObject): boolean; virtual;\r\n    function ToString: String; virtual;\r\n  end;\r\n\r\n  { TCustomAttribute - base class of all user defined attributes. }\r\n\r\n  TCustomAttribute = class\r\n  end;\r\n  TCustomAttributeArray = array of TCustomAttribute;\r\n\r\nconst\r\n  { IInterface }\r\n  S_OK          = 0;\r\n  S_FALSE       = 1;\r\n  E_NOINTERFACE = -2147467262; // FPC: longint($80004002)\r\n  E_UNEXPECTED  = -2147418113; // FPC: longint($8000FFFF)\r\n  E_NOTIMPL     = -2147467263; // FPC: longint($80004001)\r\n\r\ntype\r\n  {$Interfaces COM}\r\n  IUnknown = interface\r\n    ['{00000000-0000-0000-C000-000000000046}']\r\n    function QueryInterface(const iid: TGuid; out obj): Integer;\r\n    function _AddRef: Integer;\r\n    function _Release: Integer;\r\n  end;\r\n  IInterface = IUnknown;\r\n\r\n  {$M+}\r\n  IInvokable = interface(IInterface)\r\n  end;\r\n  {$M-}\r\n\r\n  { Enumerator support }\r\n  IEnumerator = interface(IInterface)\r\n    function GetCurrent: TObject;\r\n    function MoveNext: Boolean;\r\n    procedure Reset;\r\n    property Current: TObject read GetCurrent;\r\n  end;\r\n\r\n  IEnumerable = interface(IInterface)\r\n    function GetEnumerator: IEnumerator;\r\n  end;\r\n\r\n  { TInterfacedObject }\r\n\r\n  TInterfacedObject = class(TObject,IUnknown)\r\n  protected\r\n    fRefCount: Integer;\r\n    { implement methods of IUnknown }\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; virtual;\r\n    function _AddRef: Integer; virtual;\r\n    function _Release: Integer; virtual;\r\n  public\r\n    procedure BeforeDestruction; override;\r\n    property RefCount: Integer read fRefCount;\r\n  end;\r\n  TInterfacedClass = class of TInterfacedObject;\r\n\r\n  { TAggregatedObject - sub or satellite object using same interface as controller }\r\n\r\n  TAggregatedObject = class(TObject)\r\n  private\r\n    fController: Pointer;\r\n    function GetController: IUnknown;\r\n  protected\r\n    { implement methods of IUnknown }\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; virtual;\r\n    function _AddRef: Integer; virtual;\r\n    function _Release: Integer; virtual;\r\n  public\r\n    constructor Create(const aController: IUnknown); reintroduce;\r\n    property Controller: IUnknown read GetController;\r\n  end;\r\n\r\n  { TContainedObject }\r\n\r\n  TContainedObject = class(TAggregatedObject,IInterface)\r\n  protected\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; override;\r\n  end;\r\n\r\nconst\r\n  { for safe as operator support }\r\n  IObjectInstance: TGuid = '{D91C9AF4-3C93-420F-A303-BF5BA82BFD23}';\r\n\r\nfunction GUIDToString(const GUID: TGUID): string; external name 'rtl.guidrToStr';\r\n\r\n{*****************************************************************************\r\n                              Array of const support\r\n*****************************************************************************}\r\n\r\nconst\r\n  vtInteger       = 0;\r\n  vtBoolean       = 1;\r\n  //vtChar          = 2; // Delphi/FPC: ansichar\r\n  vtExtended      = 3; // Note: double in pas2js, PExtended in Delphi/FPC\r\n  //vtString        = 4; // Delphi/FPC: PShortString\r\n  vtPointer       = 5;\r\n  //vtPChar         = 6;\r\n  vtObject        = 7;\r\n  vtClass         = 8;\r\n  vtWideChar      = 9;\r\n  //vtPWideChar     = 10;\r\n  //vtAnsiString    = 11;\r\n  vtCurrency      = 12; // Note: currency in pas2js, PCurrency in Delphi/FPC\r\n  //vtVariant       = 13;\r\n  vtInterface     = 14;\r\n  //vtWideString    = 15;\r\n  //vtInt64         = 16;\r\n  //vtQWord         = 17;\r\n  vtUnicodeString = 18;\r\n  // only pas2js, not in Delphi/FPC:\r\n  vtNativeInt     = 19;\r\n  vtJSValue       = 20;\r\n\r\ntype\r\n  PVarRec = ^TVarRec;\r\n  TVarRec = record\r\n    VType: byte;\r\n    VJSValue: JSValue;\r\n    VInteger: LongInt external name 'VJSValue';\r\n    VBoolean: Boolean external name 'VJSValue';\r\n    VExtended: Double external name 'VJSValue';\r\n    VPointer: Pointer external name 'VJSValue';\r\n    VObject: TObject external name 'VJSValue';\r\n    VClass: TClass external name 'VJSValue';\r\n    VWideChar: WideChar external name 'VJSValue';\r\n    VCurrency: Currency external name 'VJSValue';\r\n    VInterface: Pointer external name 'VJSValue';\r\n    VUnicodeString: UnicodeString external name 'VJSValue';\r\n    VNativeInt: NativeInt external name 'VJSValue';\r\n  end;\r\n  TVarRecArray = array of TVarRec;\r\n\r\nfunction VarRecs: TVarRecArray; varargs;\r\n\r\n{*****************************************************************************\r\n                            Init / Exit / ExitProc\r\n*****************************************************************************}\r\nvar\r\n  ExitCode: Integer; external name 'rtl.exitcode';\r\n  IsConsole: Boolean = {$IFDEF NodeJS}true{$ELSE}false{$ENDIF};\r\n  FirstDotAtFileNameStartIsExtension : Boolean = False;\r\n\r\ntype\r\n  TOnParamCount = function: Longint;\r\n  TOnParamStr = function(Index: Longint): String;\r\nvar\r\n  OnParamCount: TOnParamCount;\r\n  OnParamStr: TOnParamStr;\r\n\r\nfunction ParamCount: Longint;\r\nfunction ParamStr(Index: Longint): String;\r\n\r\n{*****************************************************************************\r\n                                 Math\r\n*****************************************************************************}\r\nconst\r\n  PI: Double; external name 'Math.PI';\r\n  MathE: Double; external name 'Math.E'; // Euler's number\r\n  MathLN10: Double; external name 'Math.LN10'; // ln(10)\r\n  MathLN2: Double; external name 'Math.LN2'; // ln(2)\r\n  MathLog10E: Double; external name 'Math.Log10E'; // log10(e)\r\n  MathLog2E: Double; external name 'Math.LOG2E'; // log2(e)\r\n  MathSQRT1_2: Double; external name 'Math.SQRT1_2'; // sqrt(0.5)\r\n  MathSQRT2: Double; external name 'Math.SQRT2'; // sqrt(2)\r\n\r\nfunction Abs(const A: integer): integer; overload; external name 'Math.abs';\r\nfunction Abs(const A: NativeInt): integer; overload; external name 'Math.abs';\r\nfunction Abs(const A: Double): Double; overload; external name 'Math.abs';\r\nfunction ArcTan(const A: Double): Double; external name 'Math.atan';\r\nfunction ArcTan2(const A,B: Double): Double; external name 'Math.atan2';\r\nfunction Cos(const A: Double): Double; external name 'Math.cos';\r\nfunction Exp(const A: Double): Double; external name 'Math.exp';\r\nfunction Frac(const A: Double): Double; assembler;\r\nfunction Ln(const A: Double): Double; external name 'Math.log';\r\nfunction Odd(const A: Integer): Boolean; assembler;\r\nfunction Random(const Range: Integer): Integer; overload; assembler;\r\nfunction Random: Double; overload; external name 'Math.random';\r\nfunction Round(const A: Double): NativeInt; external name 'Math.round';\r\nfunction Sin(const A: Double): Double; external name 'Math.sin';\r\nfunction Sqr(const A: Integer): Integer; assembler; overload;\r\nfunction Sqr(const A: Double): Double; assembler; overload;\r\nfunction sqrt(const A: Double): Double; external name 'Math.sqrt';\r\nfunction Trunc(const A: Double): NativeInt;\r\n\r\n{*****************************************************************************\r\n                          String functions\r\n*****************************************************************************}\r\nconst\r\n  DefaultTextLineBreakStyle : TTextLineBreakStyle = tlbsLF;\r\n\r\nfunction Int(const A: Double): double;\r\nfunction Copy(const S: string; Index, Size: Integer): String; assembler; overload;\r\nfunction Copy(const S: string; Index: Integer): String; assembler; overload;\r\nprocedure Delete(var S: String; Index, Size: Integer); assembler; overload;\r\nfunction Pos(const Search, InString: String): Integer; assembler; overload;\r\n//function Pos(const Search, InString: String; StartAt : Integer): Integer; assembler; overload;\r\nprocedure Insert(const Insertion: String; var Target: String; Index: Integer); overload;\r\nfunction upcase(c : char) : char; assembler;\r\nfunction HexStr(Val: NativeInt; cnt: byte): string; external name 'rtl.hexStr'; overload;\r\n\r\nprocedure val(const S: String; out NI : NativeInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out NI : NativeUInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out SI : ShortInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out B : Byte; out Code: Integer); overload;\r\nprocedure val(const S: String; out SI : smallint; out Code: Integer); overload;\r\nprocedure val(const S: String; out W : word; out Code : Integer); overload;\r\nprocedure val(const S: String; out I : integer; out Code : Integer); overload;\r\nprocedure val(const S: String; out C : Cardinal; out Code: Integer); overload;\r\nprocedure val(const S: String; out d : double; out Code : Integer); overload;\r\nprocedure val(const S: String; out b : boolean; out Code: Integer); overload;\r\nfunction StringOfChar(c: Char; l: NativeInt): String;\r\n\r\n{*****************************************************************************\r\n                          Other functions\r\n*****************************************************************************}\r\nprocedure Write; varargs; // ToDo: should be compiler built-in function\r\nprocedure Writeln; varargs; // ToDo: should be compiler built-in function\r\n\r\nType\r\n  TConsoleHandler = Procedure (S : JSValue; NewLine : Boolean);\r\nFunction SetWriteCallBack(H : TConsoleHandler) : TConsoleHandler;\r\n\r\nfunction Assigned(const V: JSValue): boolean; assembler; overload;\r\nfunction StrictEqual(const A: JSValue; const B): boolean; assembler;\r\nfunction StrictInequal(const A: JSValue; const B): boolean; assembler;\r\n\r\nimplementation\r\n\r\ntype\r\n\r\n  { TJSObj - simple access to JS Object }\r\n\r\n  TJSObj = class external name 'Object'\r\n  private\r\n    function GetProperties(Name: String): JSValue; external name '[]';\r\n    procedure SetProperties(Name: String; const AValue: JSValue); external name '[]';\r\n  public\r\n    //constructor new;\r\n    //function hasOwnProperty(prop: String): boolean;\r\n    property Properties[Name: String]: JSValue read GetProperties write SetProperties; default;\r\n  end;\r\n\r\n  TJSArray = class external name 'Array'\r\n  public\r\n    //length: nativeint;\r\n    //constructor new; overload;\r\n    function push(aElement : JSValue) : NativeInt; varargs;\r\n  end;\r\n\r\n  TJSArguments = class external name 'arguments'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n  public\r\n    property Length: NativeInt read FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements; default;\r\n  end;\r\n\r\nvar\r\n  JSArguments: TJSArguments; external name 'arguments';\r\n\r\n//function isNumber(const v: JSValue): boolean; external name 'rtl.isNumber';\r\n//function isObject(const v: JSValue): boolean; external name 'rtl.isObject'; // true if not null and a JS Object\r\n//function isString(const v: JSValue): boolean; external name 'rtl.isString';\r\n\r\n// function parseInt(s: String; Radix: NativeInt): NativeInt; external name 'parseInt'; // may result NaN\r\nfunction isNaN(i: JSValue): boolean; external name 'isNaN'; // may result NaN\r\n\r\n// needed by ClassNameIs, the real SameText is in SysUtils\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.toLowerCase() == s2.toLowerCase();\r\nend;\r\n\r\nfunction VarRecs: TVarRecArray;\r\nvar\r\n  i: nativeint;\r\n  v: PVarRec;\r\nbegin\r\n  Result:=nil;\r\n  while i<JSArguments.Length do\r\n    begin\r\n    new(v);\r\n    v^.VType:=byte(JSArguments[i]);\r\n    inc(i);\r\n    v^.VJSValue:=JSArguments[i];\r\n    inc(i);\r\n    TJSArray(Result).push(v^);\r\n    end;\r\nend;\r\n\r\nfunction ParamCount: Longint;\r\nbegin\r\n  if Assigned(OnParamCount) then\r\n    Result:=OnParamCount()\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction ParamStr(Index: Longint): String;\r\nbegin\r\n  if Assigned(OnParamStr) then\r\n    Result:=OnParamStr(Index)\r\n  else if Index=0 then\r\n    Result:='js'\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction Frac(const A: Double): Double; assembler;\r\nasm\r\n  return A % 1;\r\nend;\r\n\r\nfunction Odd(const A: Integer): Boolean; assembler;\r\nasm\r\n  return A&1 != 0;\r\nend;\r\n\r\nfunction Random(const Range: Integer): Integer; assembler;\r\nasm\r\n  return Math.floor(Math.random()*Range);\r\nend;\r\n\r\nfunction Sqr(const A: Integer): Integer; assembler;\r\nasm\r\n  return A*A;\r\nend;\r\n\r\nfunction Sqr(const A: Double): Double; assembler;\r\nasm\r\n  return A*A;\r\nend;\r\n\r\nfunction Trunc(const A: Double): NativeInt; assembler;\r\nasm\r\n  if (!Math.trunc) {\r\n    Math.trunc = function(v) {\r\n      v = +v;\r\n      if (!isFinite(v)) return v;\r\n      return (v - v % 1) || (v < 0 ? -0 : v === 0 ? v : 0);\r\n    };\r\n  }\r\n  $mod.Trunc = Math.trunc;\r\n  return Math.trunc(A);\r\nend;\r\n\r\nfunction Copy(const S: string; Index, Size: Integer): String; assembler;\r\nasm\r\n  if (Index<1) Index = 1;\r\n  return (Size>0) ? S.substring(Index-1,Index+Size-1) : \"\";\r\nend;\r\n\r\nfunction Copy(const S: string; Index: Integer): String; assembler;\r\nasm\r\n  if (Index<1) Index = 1;\r\n  return S.substr(Index-1);\r\nend;\r\n\r\nprocedure Delete(var S: String; Index, Size: Integer);\r\nvar\r\n  h: String;\r\nbegin\r\n  if (Index<1) or (Index>length(S)) or (Size<=0) then exit;\r\n  h:=S;\r\n  S:=copy(h,1,Index-1)+copy(h,Index+Size);\r\nend;\r\n\r\nfunction Pos(const Search, InString: String): Integer; assembler;\r\nasm\r\n  return InString.indexOf(Search)+1;\r\nend;\r\n\r\n//function Pos(const Search, InString: String; StartAt : Integer): Integer; assembler; overload;\r\n//\r\n//asm\r\n//  return InString.indexOf(Search,StartAt-1)+1;\r\n//end;\r\n\r\n\r\n\r\nprocedure Insert(const Insertion: String; var Target: String; Index: Integer);\r\nvar\r\n  t: String;\r\nbegin\r\n  if Insertion='' then exit;\r\n  t:=Target;\r\n  if Index<1 then\r\n    Target:=Insertion+t\r\n  else if Index>length(t) then\r\n    Target:=t+Insertion\r\n  else\r\n    Target:=copy(t,1,Index-1)+Insertion+copy(t,Index,length(t));\r\nend;\r\n\r\nvar\r\n  WriteBuf: String;\r\n  WriteCallBack : TConsoleHandler;\r\n\r\nFunction SetWriteCallBack(H : TConsoleHandler) : TConsoleHandler;\r\n\r\nbegin\r\n  Result:=WriteCallBack;\r\n  WriteCallBack:=H;\r\nend;\r\n\r\nprocedure Write;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  for i:=0 to JSArguments.Length-1 do\r\n    if Assigned(WriteCallBack) then\r\n      WriteCallBack(JSArguments[i],False)\r\n    else\r\n      WriteBuf:=WriteBuf+String(JSArguments[i]);\r\nend;\r\n\r\nprocedure Writeln;\r\n\r\nvar\r\n  i,l: Integer;\r\n  s: String;\r\n\r\nbegin\r\n  L:=JSArguments.Length-1;\r\n  if Assigned(WriteCallBack) then\r\n    begin\r\n    for i:=0 to L do\r\n      WriteCallBack(JSArguments[i],I=L);\r\n    end\r\n  else\r\n    begin\r\n    s:=WriteBuf;\r\n    for i:=0 to L do\r\n      s:=s+String(JSArguments[i]);\r\n    asm\r\n      console.log(s);\r\n    end;\r\n    WriteBuf:='';\r\n    end;\r\nend;\r\n\r\nfunction Int(const A: Double): double;\r\n\r\nbegin\r\n  // trunc contains fix for missing Math.trunc in IE\r\n  Result:=Trunc(A);\r\nend;\r\n\r\nfunction Number(S: String): Double; external name 'Number';\r\n\r\nfunction valint(const S: String; MinVal, MaxVal: NativeInt; out Code: Integer): NativeInt;\r\nvar\r\n  x: double;\r\nbegin\r\n  x:=Number(S);\r\n  if isNaN(x) then\r\n    case copy(s,1,1) of\r\n    '$': x:=Number('0x'+copy(S,2));\r\n    '&': x:=Number('0o'+copy(S,2));\r\n    '%': x:=Number('0b'+copy(S,2));\r\n    else\r\n      Code:=1;\r\n      exit;\r\n    end;\r\n  if isNaN(x) or (X<>Int(X)) then\r\n    Code:=1\r\n  else if (x<MinVal) or (x>MaxVal) then\r\n    Code:=2\r\n  else\r\n    begin\r\n    Result:=Trunc(x);\r\n    Code:=0;\r\n    end;\r\nend;\r\n\r\nprocedure val(const S: String; out NI : NativeInt; out Code: Integer);\r\nbegin\r\n  NI:=valint(S,low(NI),high(NI),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out NI: NativeUInt; out Code: Integer);\r\nvar\r\n  x : double;\r\nbegin\r\n  x:=Number(S);\r\n  if isNaN(x) or (X<>Int(X)) or (X<0) then\r\n    Code:=1\r\n  else\r\n    begin\r\n    Code:=0;\r\n    NI:=Trunc(x);\r\n    end;\r\nend;\r\n\r\nprocedure val(const S: String; out SI : ShortInt; out Code: Integer);\r\nbegin\r\n  SI:=valint(S,low(SI),high(SI),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out SI: smallint; out Code: Integer);\r\nbegin\r\n  SI:=valint(S,low(SI),high(SI),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out C: Cardinal; out Code: Integer);\r\nbegin\r\n  C:=valint(S,low(C),high(C),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out B: Byte; out Code: Integer);\r\nbegin\r\n  B:=valint(S,low(B),high(B),Code);\r\nend;\r\n\r\nprocedure val(const S: String; out W: word; out Code: Integer);\r\nbegin\r\n  W:=valint(S,low(W),high(W),Code);\r\nend;\r\n\r\nprocedure val(const S : String; out I : integer; out Code : Integer);\r\nbegin\r\n  I:=valint(S,low(I),high(I),Code);\r\nend;\r\n\r\nprocedure val(const S : String; out d : double; out Code : Integer);\r\nVar\r\n  x: double;\r\nbegin\r\n  x:=Number(S);\r\n  if isNaN(x) then\r\n    Code:=1\r\n  else\r\n    begin\r\n    Code:=0;\r\n    d:=x;\r\n    end;\r\nend;\r\n\r\nprocedure val(const S: String; out b: boolean; out Code: Integer);\r\nbegin\r\n  if SameText(S,'true') then\r\n    begin\r\n    Code:=0;\r\n    b:=true;\r\n    end\r\n  else if SameText(S,'false') then\r\n    begin\r\n    Code:=0;\r\n    b:=false;\r\n    end\r\n  else\r\n    Code:=1;\r\nend;\r\n\r\nfunction upcase(c : char) : char; assembler;\r\nasm\r\n  return c.toUpperCase();\r\nend;\r\n\r\nfunction StringOfChar(c: Char; l: NativeInt): String;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  //asm\r\n  //  if ((l>0) && c.repeat) return c.repeat(l);\r\n  //end;\r\n  Result:='';\r\n  for i:=1 to l do Result:=Result+c;\r\nend;\r\n\r\nfunction Assigned(const V: JSValue): boolean; assembler;\r\nasm\r\n  return (V!=undefined) && (V!=null) && (!rtl.isArray(V) || (V.length > 0));\r\nend;\r\n\r\nfunction StrictEqual(const A: JSValue; const B): boolean; assembler;\r\nasm\r\n  return A === B;\r\nend;\r\n\r\nfunction StrictInequal(const A: JSValue; const B): boolean; assembler;\r\nasm\r\n  return A !== B;\r\nend;\r\n\r\n{ TContainedObject }\r\n\r\nfunction TContainedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  if GetInterface(iid,obj) then\r\n    Result:=S_OK\r\n  else\r\n    Result:=Integer(E_NOINTERFACE);\r\nend;\r\n\r\n{ TAggregatedObject }\r\n\r\nfunction TAggregatedObject.GetController: IUnknown;\r\nbegin\r\n  Result := IUnknown(fController);\r\nend;\r\n\r\nfunction TAggregatedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  Result := IUnknown(fController).QueryInterface(iid, obj);\r\nend;\r\n\r\nfunction TAggregatedObject._AddRef: Integer;\r\nbegin\r\n  Result := IUnknown(fController)._AddRef;\r\nend;\r\n\r\nfunction TAggregatedObject._Release: Integer;\r\nbegin\r\n  Result := IUnknown(fController)._Release;\r\nend;\r\n\r\nconstructor TAggregatedObject.Create(const aController: IUnknown);\r\nbegin\r\n  inherited Create;\r\n  { do not keep a counted reference to the controller! }\r\n  fController := Pointer(aController);\r\nend;\r\n\r\n{ TInterfacedObject }\r\n\r\nfunction TInterfacedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  if GetInterface(iid,obj) then\r\n    Result:=S_OK\r\n  else\r\n    Result:=Integer(E_NOINTERFACE);\r\nend;\r\n\r\nfunction TInterfacedObject._AddRef: Integer;\r\nbegin\r\n  inc(fRefCount);\r\n  Result:=fRefCount;\r\nend;\r\n\r\nfunction TInterfacedObject._Release: Integer;\r\nbegin\r\n  dec(fRefCount);\r\n  Result:=fRefCount;\r\n  if fRefCount=0 then\r\n    Destroy;\r\nend;\r\n\r\nprocedure TInterfacedObject.BeforeDestruction;\r\nbegin\r\n  if fRefCount<>0 then\r\n    asm\r\n    rtl.raiseE('EHeapMemoryError');\r\n    end;\r\nend;\r\n\r\n{ TObject }\r\n\r\nconstructor TObject.Create;\r\nbegin\r\n\r\nend;\r\n\r\ndestructor TObject.Destroy;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.Free;\r\nbegin\r\n  Destroy;\r\nend;\r\n\r\nclass function TObject.ClassType: TClass; assembler;\r\nasm\r\n  return this;\r\nend;\r\n\r\nclass function TObject.ClassNameIs(const Name: string): boolean;\r\nbegin\r\n  Result:=SameText(Name,ClassName);\r\nend;\r\n\r\nclass function TObject.InheritsFrom(aClass: TClass): boolean; assembler;\r\nasm\r\n  return (aClass!=null) && ((this==aClass) || aClass.isPrototypeOf(this));\r\nend;\r\n\r\nclass function TObject.MethodName(ACode: Pointer) : String;\r\nbegin\r\n  Result := '';\r\n  if ACode = nil then\r\n    Exit;\r\nasm\r\n  if (typeof(ACode)!=='function') return \"\";\r\n  var i = 0;\r\n  var TI = this.$rtti;\r\n  if (rtl.isObject(ACode.scope)){\r\n    // callback\r\n    if (typeof ACode.fn === \"string\") return ACode.fn;\r\n    ACode = ACode.fn;\r\n  }\r\n  // Not a callback, check rtti\r\n  while ((Result === \"\") && (TI != null)) {\r\n    i = 0;\r\n    while ((Result === \"\") && (i < TI.methods.length)) {\r\n      if (this[TI.getMethod(i).name] === ACode)\r\n        Result=TI.getMethod(i).name;\r\n      i += 1;\r\n    };\r\n    if (Result === \"\") TI = TI.ancestor;\r\n  };\r\n  return Result;\r\nend;\r\nend;\r\n\r\nclass function TObject.MethodAddress(AName: string): Pointer;\r\n// We must do this in asm, because the typinfo unit is not available.\r\nbegin\r\n  Result := nil;\r\n  if AName = '' then\r\n    Exit;\r\nasm\r\n  var i = 0;\r\n  var TI = this.$rtti;\r\n  var N = \"\";\r\n  var MN = \"\";\r\n  N = AName.toLowerCase();\r\n  while ((MN === \"\") && (TI != null)) {\r\n    i = 0;\r\n    while ((MN === \"\") && (i < TI.methods.length)) {\r\n      if (TI.getMethod(i).name.toLowerCase() === N) MN = TI.getMethod(i).name;\r\n      i += 1;\r\n    };\r\n    if (MN === \"\") TI = TI.ancestor;\r\n  };\r\n  if (MN !== \"\") Result = this[MN];\r\n  return Result;\r\nend;\r\nend;\r\n\r\nclass function TObject.FieldAddress(aName: String): Pointer;\r\nbegin\r\n  Result:=Nil;\r\n  if aName='' then exit;\r\n  asm\r\n    var aClass = null;\r\n    var i = 0;\r\n    var ClassTI = null;\r\n    var myName = aName.toLowerCase();\r\n    var MemberTI = null;\r\n    aClass = this.$class;\r\n    while (aClass !== null) {\r\n      ClassTI = aClass.$rtti;\r\n      for (var $l1 = 0, $end2 = ClassTI.fields.length - 1; $l1 <= $end2; $l1++) {\r\n        i = $l1;\r\n        MemberTI = ClassTI.getField(i);\r\n        if (MemberTI.name.toLowerCase() === myName) {\r\n           return MemberTI;\r\n        };\r\n      };\r\n      aClass = aClass.$ancestor ? aClass.$ancestor : null;\r\n    };\r\n  end;\r\nend;\r\n\r\n//class Function TObject.ClassInfo : Pointer;\r\n//begin\r\n  // This works different from FPC/Delphi.\r\n  // We get the actual type info.\r\n//  Result := TypeInfo(Self);\r\n//end;\r\n\r\nprocedure TObject.AfterConstruction;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.BeforeDestruction;\r\nbegin\r\n\r\nend;\r\n\r\nfunction TObject.GetInterface(const iid: TGuid; out obj): boolean;\r\nbegin\r\n  asm\r\n    var i = iid.$intf;\r\n    if (i){\r\n      // iid is the private TGuid of an interface\r\n      i = rtl.getIntfG(this,i.$guid,2);\r\n      if (i){\r\n        obj.set(i);\r\n        return true;\r\n      }\r\n    }\r\n  end;\r\n  Result := GetInterfaceByStr(GUIDToString(iid),obj);\r\nend;\r\n\r\nfunction TObject.GetInterface(const iidstr: String; out obj): boolean;\r\nbegin\r\n  Result := GetInterfaceByStr(iidstr,obj);\r\nend;\r\n\r\nfunction TObject.GetInterfaceByStr(const iidstr: String; out obj): boolean;\r\nbegin\r\n  if not TJSObj(IObjectInstance)['$str'] then\r\n    TJSObj(IObjectInstance)['$str']:=GUIDToString(IObjectInstance);\r\n  if iidstr = TJSObj(IObjectInstance)['$str'] then\r\n    begin\r\n    obj:=Self;\r\n    exit(true);\r\n    end;\r\n  asm\r\n    var i = rtl.getIntfG(this,iidstr,2);\r\n    obj.set(i);\r\n    return i!==null;\r\n  end;\r\n  Result:=false;\r\nend;\r\n\r\nfunction TObject.GetInterfaceWeak(const iid: TGuid; out obj): boolean;\r\nbegin\r\n  Result:=GetInterface(iid,obj);\r\n  asm\r\n    if (Result){\r\n      var o = obj.get();\r\n      if (o.$kind==='com'){\r\n        o._Release();\r\n      }\r\n    }\r\n  end;\r\nend;\r\n\r\nfunction TObject.Equals(Obj: TObject): boolean;\r\nbegin\r\n  Result:=Obj=Self;\r\nend;\r\n\r\nfunction TObject.ToString: String;\r\nbegin\r\n  Result:=ClassName;\r\nend;\r\n\r\n\r\ninitialization\r\n  ExitCode:=0; // set it here, so that WPO does not remove it\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit RTLConsts;\r\n\r\ninterface\r\n\r\nconst\r\n  SArgumentMissing              = 'Missing argument in format \"%s\"';\r\n  SInvalidFormat                = 'Invalid format specifier : \"%s\"';\r\n  SInvalidArgIndex              = 'Invalid argument index in format: \"%s\"';\r\n  SListCapacityError            = 'List capacity (%s) exceeded.';\r\n  SListCountError               = 'List count (%s) out of bounds.';\r\n  SListIndexError               = 'List index (%s) out of bounds';\r\n  SSortedListError              = 'Operation not allowed on sorted list';\r\n  SDuplicateString              = 'String list does not allow duplicates';\r\n  SErrFindNeedsSortedList       = 'Cannot use find on unsorted list';\r\n\r\n  SInvalidName                  = 'Invalid component name: \"%s\"';\r\n  SInvalidBoolean               = '\"%s\" is not a valid boolean.';\r\n  SDuplicateName                = 'Duplicate component name: \"%s\"';\r\n\r\n  SErrInvalidDate               = 'Invalid date: \"%s\"';\r\n  SErrInvalidTimeFormat         = 'Invalid time format: \"%s\"';\r\n  SInvalidDateFormat            = 'Invalid date format: \"%s\"';\r\n\r\n  SCantReadPropertyS            = 'Cannot read property \"%s\"';\r\n  SCantWritePropertyS           = 'Cannot write property \"%s\"';\r\n  SErrPropertyNotFound          = 'Unknown property: \"%s\"';\r\n  SIndexedPropertyNeedsParams   = 'Indexed property \"%s\" needs parameters';\r\n  SErrInvalidTypecast           = 'Invalid class typecast';\r\n\r\n  SErrInvalidInteger            = 'Invalid integer value: \"%s\"';\r\n  SErrInvalidFloat              = 'Invalid floating-point value: \"%s\"';\r\n  SInvalidDateTime              = 'Invalid date-time value: %s';\r\n  SInvalidCurrency              = 'Invalid currency value: %s';\r\n  SErrInvalidDayOfWeek          = '%d is not a valid day of the week';\r\n  SErrInvalidTimeStamp          = 'Invalid date/timestamp : \"%s\"';\r\n  SErrInvalidDateWeek           = '%d %d %d is not a valid dateweek';\r\n  SErrInvalidDayOfYear          = 'Year %d does not have a day number %d';\r\n  SErrInvalidDateMonthWeek      = 'Year %d, month %d, Week %d and day %d is not a valid date.';\r\n  SErrInvalidDayOfWeekInMonth   = 'Year %d Month %d NDow %d DOW %d is not a valid date';\r\n  SInvalidJulianDate            = '%f Julian cannot be represented as a DateTime';\r\n  SErrInvalidHourMinuteSecMsec  = '%d:%d:%d.%d is not a valid time specification';\r\n\r\n  SInvalidGUID                  = '\"%s\" is not a valid GUID value';\r\n\r\n  SEmptyStreamIllegalReader       = 'Illegal Nil stream for TReader constructor';\r\n  SInvalidPropertyValue           = 'Invalid value for property';\r\n  SInvalidImage                   = 'Invalid stream format';\r\n  SUnknownProperty                = 'Unknown property: \"%s\"';\r\n  SUnknownPropertyType            = 'Unknown property type %d';\r\n  SAncestorNotFound               = 'Ancestor class for \"%s\" not found.';\r\n  SUnsupportedPropertyVariantType = 'Unsupported property variant type %d';\r\n  SPropertyException              = 'Error reading %s%s%s: %s';\r\n  SInvalidPropertyPath            = 'Invalid property path';\r\n  SReadOnlyProperty               = 'Property is read-only';\r\n  SClassNotFound                  = 'Class \"%s\" not found';\r\n\r\n  SEmptyStreamIllegalWriter       = 'Illegal Nil stream for TWriter constructor';\r\n  SErrInvalidPropertyType         = 'Invalid property type from streamed property: %d';\r\n  SParserExpected                 = 'Wrong token type: %s expected';\r\n  SParserInvalidFloat             = 'Invalid floating point number: %s';\r\n  SParserInvalidInteger           = 'Invalid integer number: %s';\r\n  SParserUnterminatedString       = 'Unterminated string';\r\n  SParserWrongTokenType           = 'Wrong token type: %s expected but %s found';\r\n  SParserWrongTokenSymbol         = 'Wrong token symbol: %s expected but %s found';\r\n  SParserLocInfo                  = ' (at %d,%d, stream offset %.8x)';\r\n  SParserUnterminatedBinValue     = 'Unterminated byte value';\r\n  SParserInvalidProperty          = 'Invalid property';\r\n\r\n\r\nimplementation\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit Types;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\ntype\r\n  TDirection = (FromBeginning, FromEnd);\r\n\r\n  TBooleanDynArray = array of Boolean;\r\n  TIntegerDynArray = array of Integer;\r\n  TNativeIntDynArray = array of NativeInt;\r\n  TStringDynArray = array of String;\r\n  TDoubleDynArray = array of Double;\r\n  TJSValueDynArray = array of JSValue;\r\n  TObjectDynArray = array of TObject;\r\n\r\n  TDuplicates = (dupIgnore, dupAccept, dupError);\r\n\r\n  TListCallback = procedure(data, arg: JSValue) of object;\r\n  TListStaticCallback = procedure(data, arg: JSValue);\r\n\r\n  TSize  = record\r\n    cx, cy: integer;\r\n  end;\r\n\r\n  TPoint  = record\r\n    x, y: integer;\r\n  end;\r\n\r\n  TRect  = record\r\n    Left, Top, Right, Bottom: Integer;\r\n  end;\r\n\r\nfunction EqualRect(const r1,r2 : TRect) : Boolean;\r\nfunction Rect(Left, Top, Right, Bottom : Integer) : TRect;\r\nfunction Bounds(ALeft, ATop, AWidth, AHeight : Integer) : TRect;\r\nfunction Point(x,y : Integer): TPoint; {$IFDEF Has_Inline}inline;{$ENDIF}\r\nfunction PtInRect(const aRect: TRect; const p: TPoint) : Boolean;\r\nfunction IntersectRect(out aRect: TRect; const R1,R2: TRect) : Boolean;\r\nfunction UnionRect(out aRect: TRect; const R1,R2: TRect) : Boolean;\r\nfunction IsRectEmpty(const aRect: TRect) : Boolean;\r\nfunction OffsetRect(var aRect: TRect; DX, DY: Integer) : Boolean;\r\nfunction CenterPoint(const aRect: TRect): TPoint;\r\nfunction InflateRect(var aRect: TRect; dx, dy: Integer): Boolean;\r\nfunction Size(AWidth, AHeight: Integer): TSize;\r\nfunction Size(const aRect: TRect): TSize;\r\n\r\nimplementation\r\n\r\nfunction EqualRect(const r1, r2: TRect): Boolean;\r\nbegin\r\n  Result:=(r1.left=r2.left) and (r1.right=r2.right) and (r1.top=r2.top) and (r1.bottom=r2.bottom);\r\nend;\r\n\r\nfunction Rect(Left, Top, Right, Bottom: Integer): TRect;\r\nbegin\r\n  Result.Left:=Left;\r\n  Result.Top:=Top;\r\n  Result.Right:=Right;\r\n  Result.Bottom:=Bottom;\r\nend;\r\n\r\nfunction Bounds(ALeft, ATop, AWidth, AHeight: Integer): TRect;\r\nbegin\r\n  Result.Left:=ALeft;\r\n  Result.Top:=ATop;\r\n  Result.Right:=ALeft+AWidth;\r\n  Result.Bottom:=ATop+AHeight;\r\nend;\r\n\r\nfunction Point(x, y: Integer): TPoint;\r\nbegin\r\n  Result.x:=x;\r\n  Result.y:=y;\r\nend;\r\n\r\nfunction PtInRect(const aRect: TRect; const p: TPoint): Boolean;\r\nbegin\r\n  Result:=(p.y>=aRect.Top) and\r\n          (p.y<aRect.Bottom) and\r\n          (p.x>=aRect.Left) and\r\n          (p.x<aRect.Right);\r\nend;\r\n\r\nfunction IntersectRect(out aRect: TRect; const R1, R2: TRect): Boolean;\r\nvar\r\n  lRect: TRect;\r\nbegin\r\n  lRect := R1;\r\n  if R2.Left > R1.Left then\r\n    lRect.Left := R2.Left;\r\n  if R2.Top > R1.Top then\r\n    lRect.Top := R2.Top;\r\n  if R2.Right < R1.Right then\r\n    lRect.Right := R2.Right;\r\n  if R2.Bottom < R1.Bottom then\r\n    lRect.Bottom := R2.Bottom;\r\n\r\n  // The var parameter is only assigned in the end to avoid problems\r\n  // when passing the same rectangle in the var and const parameters.\r\n  if IsRectEmpty(lRect) then\r\n  begin\r\n    aRect:=Rect(0,0,0,0);\r\n    Result:=false;\r\n  end\r\n  else\r\n  begin\r\n    Result:=true;\r\n    aRect := lRect;\r\n  end;\r\nend;\r\n\r\nfunction UnionRect(out aRect: TRect; const R1, R2: TRect): Boolean;\r\nvar\r\n  lRect: TRect;\r\nbegin\r\n  lRect:=R1;\r\n  if R2.Left<R1.Left then\r\n    lRect.Left:=R2.Left;\r\n  if R2.Top<R1.Top then\r\n    lRect.Top:=R2.Top;\r\n  if R2.Right>R1.Right then\r\n    lRect.Right:=R2.Right;\r\n  if R2.Bottom>R1.Bottom then\r\n    lRect.Bottom:=R2.Bottom;\r\n\r\n  if IsRectEmpty(lRect) then\r\n  begin\r\n    aRect:=Rect(0,0,0,0);\r\n    Result:=false;\r\n  end\r\n  else\r\n  begin\r\n    aRect:=lRect;\r\n    Result:=true;\r\n  end;\r\nend;\r\n\r\nfunction IsRectEmpty(const aRect: TRect): Boolean;\r\nbegin\r\n  Result:=(aRect.Right<=aRect.Left) or (aRect.Bottom<=aRect.Top);\r\nend;\r\n\r\nfunction OffsetRect(var aRect: TRect; DX, DY: Integer): Boolean;\r\nbegin\r\n  with aRect do\r\n    begin\r\n    inc(Left,dx);\r\n    inc(Top,dy);\r\n    inc(Right,dx);\r\n    inc(Bottom,dy);\r\n    end;\r\n  Result:=true;\r\nend;\r\n\r\nfunction CenterPoint(const aRect: TRect): TPoint;\r\n\r\n  function Avg(a, b: Longint): Longint;\r\n  begin\r\n    if a < b then\r\n      Result := a + ((b - a) shr 1)\r\n    else\r\n      Result := b + ((a - b) shr 1);\r\n  end;\r\n\r\nbegin\r\n  with aRect do\r\n    begin\r\n      Result.X := Avg(Left, Right);\r\n      Result.Y := Avg(Top, Bottom);\r\n    end;\r\nend;\r\n\r\nfunction InflateRect(var aRect: TRect; dx, dy: Integer): Boolean;\r\nbegin\r\n  with aRect do\r\n  begin\r\n    dec(Left, dx);\r\n    dec(Top, dy);\r\n    inc(Right, dx);\r\n    inc(Bottom, dy);\r\n  end;\r\n  Result := True;\r\nend;\r\n\r\nfunction Size(AWidth, AHeight: Integer): TSize;\r\nbegin\r\n  Result.cx := AWidth;\r\n  Result.cy := AHeight;\r\nend;\r\n\r\nfunction Size(const aRect: TRect): TSize;\r\nbegin\r\n  Result.cx := aRect.Right - aRect.Left;\r\n  Result.cy := aRect.Bottom - aRect.Top;\r\nend;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit JS;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Types;\r\n\r\ntype\r\n  // We cannot use EConvertError or Exception, this would result in a circular dependency.\r\n\r\n  { EJS }\r\n\r\n  EJS = class(TObject)\r\n  private\r\n    FMessage: string;\r\n  Public\r\n    constructor Create(const Msg: String); reintroduce;\r\n    property Message : string Read FMessage Write FMessage;\r\n  end;\r\n\r\n  TJSObjectPropertyDescriptor = JSValue;\r\n  Float32 = Double;\r\n  Float64 = Double;\r\n\r\n  { TJSObject }\r\n\r\n  TJSObject = class external name 'Object'\r\n  private\r\n    function GetProperties(Name: String): JSValue; external name '[]';\r\n    procedure SetProperties(Name: String; const AValue: JSValue); external name '[]';\r\n  public\r\n    constructor new;\r\n    class function create(const proto: TJSObject): TJSObject;\r\n    class function create(const proto, propertiesObject: TJSObject): TJSObject;\r\n    class function assign(const Target, Source1: TJSObject): TJSObject; varargs;\r\n    class procedure defineProperty(const obj: TJSObject; propname: String; const descriptor: TJSObjectPropertyDescriptor);\r\n    //class procedure defineProperties\r\n    class function freeze(const obj: TJSObject): TJSObject;\r\n    class function getOwnPropertyDescriptor(const obj: TJSObject; propname: String): TJSObjectPropertyDescriptor;\r\n    //class function getOwnPropertyDescriptors\r\n    class function getOwnPropertyNames(const obj: TJSObject): TStringDynArray;\r\n    {$IFDEF FIREFOX}\r\n    class function getOwnPropertySymbols(const obj: TJSObject): TJSValueDynArray;\r\n    {$ENDIF}\r\n    class function getPrototypeOf(const obj: TJSObject): TJSObject;\r\n    {$IFDEF FIREFOX}\r\n    class function _is(const value1, value2: JSValue): boolean;\r\n    {$ENDIF}\r\n    class function isExtensible(const obj: TJSObject): boolean;\r\n    class function isFrozen(const obj: TJSObject): boolean;\r\n    class function isSealed(const obj: TJSObject): boolean;\r\n    class function keys(const obj: TJSObject): TStringDynArray;\r\n    class function preventExtensions(const obj: TJSObject): TJSObject;\r\n    class function seal(const obj: TJSObject): TJSObject;\r\n    class function setPrototypeOf(const obj, prototype: TJSObject): TJSObject;\r\n    function hasOwnProperty(prop: String): boolean;\r\n    function isPrototypeOf(const obj: TJSObject): boolean;\r\n    function propertyIsEnumerable(propname: String): boolean;\r\n    function toLocaleString: String;\r\n    function toString: String;\r\n    function valueOf: JSValue;\r\n    property Properties[Name: String]: JSValue read GetProperties write SetProperties; default;\r\n  end;\r\n\r\n  TJSObjectDynArray = Array of TJSObject;\r\n  TJSObjectDynArrayArray = Array of TJSObjectDynArray;\r\n  TJSStringDynArray = Array of String;\r\n\r\n\r\n  { TJSIteratorValue }\r\n  TJSIteratorValue = class external name 'IteratorValue'\r\n  public\r\n    value : JSValue; external name 'value';\r\n    done : boolean; external name 'done';\r\n  end;\r\n\r\n  { TJSIterator }\r\n  TJSIterator = class external name 'Iterator'\r\n  Public\r\n    function next: TJSIteratorValue;\r\n  end;\r\n\r\n\r\n  TJSSet = class;\r\n\r\n  TJSSetEventProc = reference to procedure(value : JSValue; key: NativeInt; set_: TJSSet);\r\n  TJSSetProcCallBack = reference  to procedure(value: JSValue; key: JSValue);\r\n\r\n   { TJSSet }\r\n  TJSSet = class external name 'Set'\r\n  private\r\n    FSize : NativeInt; external name 'size';\r\n  public\r\n    constructor new; overload;\r\n    constructor new(aElement1 : JSValue); varargs; overload;\r\n    function add(value: JSValue): TJSSet;\r\n    function has(value: JSValue): Boolean;\r\n    function delete(value: JSValue): Boolean;\r\n    procedure clear;\r\n    function values: TJSIterator;\r\n    procedure forEach(const aCallBack: TJSSetEventProc); overload;\r\n    procedure forEach(const aCallBack: TJSSetProcCallBack); overload;\r\n    procedure forEach(const aCallBack: TJSSetEventProc; thisArg: JSValue); overload;\r\n    function entries: TJSIterator;\r\n    function keys: TJSIterator;\r\n    Property size : NativeInt Read FSize;\r\n  end;\r\n\r\n  TJSMapFunctionCallBack = reference  to function(arg : JSValue): JSValue;\r\n  TJSMapProcCallBack = reference  to procedure(value: JSValue; key: JSValue);\r\n\r\n  { TJSMap }\r\n  TJSMap = class external name 'Map'\r\n  Private\r\n    FSize : NativeInt; external name 'size';\r\n  public\r\n    constructor new; varargs; overload;\r\n    constructor new(aElement1 : JSValue); varargs; overload;\r\n    function &set(key: JSValue; value: JSValue) :TJSMap;\r\n    function get(key : JSValue): JSValue;\r\n    function has(key: JSValue): Boolean;\r\n    function delete(key: JSValue): Boolean;\r\n    procedure clear;\r\n    function entries: TJSIterator;\r\n    procedure forEach(const aCallBack: TJSMapFunctionCallBack); overload;\r\n    procedure forEach(const aCallBack: TJSMapFunctionCallBack; thisArg: JSValue); overload;\r\n    procedure forEach(const aCallBack: TJSMapProcCallBack); overload;\r\n    function keys: TJSIterator;\r\n    function values: TJSIterator;\r\n    property size : NativeInt Read FSize;\r\n  end;\r\n\r\n  { TJSFunction }\r\n\r\n  TJSFunction = class external name 'Function'(TJSObject)\r\n  private\r\n    Flength: NativeInt external name 'length';\r\n    Fprototyp: TJSFunction external name 'prototyp';\r\n  public\r\n    name: String;\r\n    property prototyp: TJSFunction read Fprototyp;\r\n    property length: NativeInt read Flength;\r\n    function apply(thisArg: TJSObject; const ArgArray: TJSValueDynArray): JSValue; varargs;\r\n    function bind(thisArg: TJSObject): JSValue; varargs;\r\n    function call(thisArg: TJSObject): JSValue; varargs;\r\n  end;\r\n\r\n  { TJSDate - wrapper for JavaScript Date }\r\n\r\n  TJSDate = class external name 'Date'(TJSFunction)\r\n  private\r\n    function getDate: NativeInt;\r\n    function getFullYear: NativeInt;\r\n    function getHours: NativeInt;\r\n    function getMilliseconds: NativeInt;\r\n    function getMinutes: NativeInt;\r\n    function getMonth: NativeInt;\r\n    function getSeconds: NativeInt;\r\n    function getYear: NativeInt;\r\n    function getTime: NativeInt;\r\n    function getUTCDate: NativeInt;\r\n    function getUTCFullYear: NativeInt;\r\n    function getUTCHours: NativeInt;\r\n    function getUTCMilliseconds: NativeInt;\r\n    function getUTCMinutes: NativeInt;\r\n    function getUTCMonth: NativeInt;\r\n    function getUTCSeconds: NativeInt;\r\n    procedure setDate(const AValue: NativeInt);\r\n    procedure setFullYear(const AValue: NativeInt);\r\n    procedure setHours(const AValue: NativeInt);\r\n    procedure setMilliseconds(const AValue: NativeInt);\r\n    procedure setMinutes(const AValue: NativeInt);\r\n    procedure setMonth(const AValue: NativeInt);\r\n    procedure setSeconds(const AValue: NativeInt);\r\n    procedure setYear(const AValue: NativeInt);\r\n    procedure setTime(const AValue: NativeInt);\r\n    procedure setUTCDate(const AValue: NativeInt);\r\n    procedure setUTCFullYear(const AValue: NativeInt);\r\n    procedure setUTCHours(const AValue: NativeInt);\r\n    procedure setUTCMilliseconds(const AValue: NativeInt);\r\n    procedure setUTCMinutes(const AValue: NativeInt);\r\n    procedure setUTCMonth(const AValue: NativeInt);\r\n    procedure setUTCSeconds(const AValue: NativeInt);\r\n  public\r\n    constructor New; reintroduce;\r\n    constructor New(const MilliSecsSince1970: NativeInt); // milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    constructor New(const aDateString: String); // RFC 2822, ISO8601\r\n    constructor New(aYear: NativeInt; aMonth: NativeInt; aDayOfMonth: NativeInt = 1;\r\n      TheHours: NativeInt = 0; TheMinutes: NativeInt = 0; TheSeconds: NativeInt = 0;\r\n      TheMilliseconds: NativeInt = 0);\r\n    class function now: NativeInt; // current date and time in milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    class function parse(const aDateString: string): NativeInt; // format depends on browser\r\n    class function UTC(aYear: NativeInt; aMonth: NativeInt = 0; aDayOfMonth: NativeInt = 1;\r\n      TheHours: NativeInt = 0; TheMinutes: NativeInt = 0; TheSeconds: NativeInt = 0;\r\n      TheMilliseconds: NativeInt = 0): NativeInt;\r\n    function getDay: NativeInt;\r\n    function getTimezoneOffset: NativeInt;\r\n    function getUTCDay: NativeInt; // day of the week\r\n    function toDateString: string; // human readable date, without time\r\n    function toISOString: string; // ISO 8601 Extended Format\r\n    function toJSON: string;\r\n    function toGMTString: string; // in GMT timezone\r\n    function toLocaleDateString: string; // date in locale timezone, no time\r\n    function toLocaleString: string; reintroduce; // date and time in locale timezone\r\n    function toLocaleTimeString: string; // time in locale timezone, no date\r\n    function toTimeString: string; // time human readable, no date\r\n    function toUTCString: string; // date and time using UTC timezone\r\n    property Year: NativeInt read getYear write setYear;\r\n    property Time: NativeInt read getTime write setTime; // milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    property FullYear: NativeInt read getFullYear write setFullYear;\r\n    property UTCDate: NativeInt read getUTCDate write setUTCDate; // day of month\r\n    property UTCFullYear: NativeInt read getUTCFullYear write setUTCFullYear;\r\n    property UTCHours: NativeInt read getUTCHours write setUTCHours;\r\n    property UTCMilliseconds: NativeInt read getUTCMilliseconds write setUTCMilliseconds;\r\n    property UTCMinutes: NativeInt read getUTCMinutes write setUTCMinutes;\r\n    property UTCMonth: NativeInt read getUTCMonth write setUTCMonth;\r\n    property UTCSeconds: NativeInt read getUTCSeconds write setUTCSeconds;\r\n    property Month: NativeInt read getMonth write setMonth;\r\n    property Date: NativeInt read getDate write setDate; // day of the month, starting at 1\r\n    property Hours: NativeInt read getHours write setHours;\r\n    property Minutes: NativeInt read getMinutes write setMinutes;\r\n    property Seconds: NativeInt read getSeconds write setSeconds;\r\n    property Milliseconds: NativeInt read getMilliseconds write setMilliseconds;\r\n  end;\r\n\r\n  TLocaleCompareOptions = record\r\n    localematched : string;\r\n    usage: string;\r\n    sensitivity : string;\r\n    ignorePunctuation : Boolean;\r\n    numeric : boolean;\r\n    caseFirst : string;\r\n  end;\r\n\r\n  TJSRegexp = class external name 'RegExp'\r\n  private\r\n  {$IFDEF FIREFOX}\r\n    // not on all browsers:\r\n    FFlags : string; external name 'flags';\r\n    FSticky : boolean; external name 'sticky';\r\n  {$endif}\r\n    fglobal: boolean; external name 'global';\r\n    fignoreCase : boolean; external name 'ignoreCase';\r\n    fmultiline : boolean; external name 'multiline';\r\n    fsource : string; external name 'source';\r\n    funicode : boolean; external name 'unicode';\r\n  public\r\n    Constructor New(Pattern : string);\r\n    Constructor New(Pattern, Flags : string);\r\n    lastIndex: NativeInt;\r\n    function exec(aString : string): TStringDynArray;\r\n    function test(aString : string) : boolean;\r\n    function toString : String;\r\n    property Global : boolean read fglobal;\r\n    property IgnoreCase : Boolean read FIgnoreCase;\r\n    property Multiline : Boolean Read FMultiLine;\r\n    Property Source : string Read FSource;\r\n    Property Unicode : boolean Read FUnicode;\r\n    {$IFDEF FIREFOX}\r\n    // not on all browsers:\r\n    property Flags : string read FFlags;\r\n    property Sticky : boolean read FSticky;\r\n    {$endif}\r\n  end;\r\n\r\n  {$IFDEF PAS2JS}\r\n  TReplaceCallBack = reference to Function (Const match : string) : string; varargs;\r\n  TReplaceCallBack0 = reference to Function (Const match : string; offset : Integer; AString : String) : string;\r\n  TReplaceCallBack1 = reference to Function (Const match,p1 : string; offset : Integer; AString : String) : string;\r\n  TReplaceCallBack2 = reference to Function (Const match,p1,p2 : string; offset : Integer; AString : String) : string;\r\n  {$ENDIF}\r\n\r\n  TJSString = class external name 'String'\r\n  private\r\n    flength : NativeInt; external name 'length';\r\n  public \r\n    constructor New(Const S : String);\r\n    constructor New(Const I : NativeInt);\r\n    constructor New(Const D : double);\r\n    property length : NativeInt read flength; \r\n    class function fromCharCode() : string; varargs;\r\n    class function fromCodePoint() : string; varargs;\r\n    function anchor(const aName : string) : string;\r\n    function charAt(aIndex : NativeInt) : string;\r\n    function charCodeAt(aIndex : NativeInt) : NativeInt;\r\n    function codePointAt(aIndex : NativeInt) : NativeInt;\r\n    function concat(s : string) : string; varargs;\r\n    function endsWith(aSearchString : string) : boolean; overload;\r\n    function endsWith(aSearchString : string; Pos : NativeInt) : boolean; overload;\r\n    function includes(aSearchString : string; Pos : NativeInt = 0) : boolean;\r\n    function indexOf(aSearchString : String; Pos : NativeInt = 0) : Integer;\r\n    function lastIndexOf(aSearchString : String) : NativeInt;overload;\r\n    function lastIndexOf(aSearchString : String; Pos : NativeInt) : Integer;overload;\r\n    function link(aUrl : string) : String;\r\n    function localeCompare(aCompareString : string) : NativeInt; overload;\r\n    function localeCompare(aCompareString : string; aLocales: string) : integer; overload;\r\n    function localeCompare(compareString : string; locales: string; Options : TlocaleCompareOptions) : integer; overload;\r\n    function match(aRegexp : TJSRegexp) : TStringDynArray; overload;\r\n    function match(aRegexp : String) : TStringDynArray;overload;\r\n    {$IFDEF ECMAScript6}\r\n    function normalize : string;\r\n    function normalize(aForm : string) : string;\r\n    {$ENDIF}\r\n    function _repeat(aCount : NativeInt) : Integer; external name 'repeat';\r\n    function replace(aRegexp : String; NewString : String) : String; overload;\r\n    function replace(aRegexp : TJSRegexp; NewString : String) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack0) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack0) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack1) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack1) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack2) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack2) : String; overload;\r\n    function search(Regexp : TJSRegexp) : NativeInt; overload;\r\n    function search(Regexp : JSValue) : NativeInt; overload;\r\n    function slice(aBeginIndex : NativeInt) : String; overload;\r\n    function slice(aBeginIndex, aEndIndex : NativeInt) : String; overload;\r\n    function split : TStringDynArray; overload;\r\n    function split(aRegexp : TJSRegexp) : TStringDynArray; overload;\r\n    function split(aSeparator : string) : TStringDynArray; overload;\r\n    function split(aSeparator : string; aLimit : NativeInt) : TStringDynArray; overload;\r\n    function split(aSeparator : array of string) : TStringDynArray; overload;\r\n    function split(aSeparator : array of string; aLimit : NativeInt) : TStringDynArray; overload;\r\n    function startsWith(aSearchString : String) : Boolean; overload;\r\n    function startsWith(aSearchString : String; aPosition : NativeInt) : Boolean; overload;\r\n    function substr(aStartIndex : NativeInt) : String; overload;\r\n    function substr(aStartIndex,aLength : NativeInt) : String; overload;\r\n    function substring(aStartIndex : NativeInt) : String; overload;\r\n    function substring(aStartIndex,aEndIndex : NativeInt) : String; overload;\r\n    function toLocaleLowerCase : String;\r\n    function toLocaleUpperCase : String;\r\n    function toLowerCase : String;\r\n    function toString : string;\r\n    function toUpperCase : String;\r\n    function trim : string;\r\n    function valueOf : string;\r\n  end;\r\n\r\n  TJSArray = Class;\r\n  \r\n  TJSArrayEventProc = reference to procedure(element : JSValue; index: NativeInt; anArray : TJSArray);\r\n  TJSArrayEvent = reference to function (element : JSValue; index: NativeInt; anArray : TJSArray) : Boolean;\r\n  TJSArrayMapEvent = reference to function (element : JSValue; index: NativeInt; anArray : TJSArray) : JSValue;\r\n  TJSArrayReduceEvent = reference to function (accumulator, currentValue : JSValue; currentIndex : NativeInt; anArray : TJSArray) : JSValue;\r\n  TJSArrayCompareEvent = reference to function (a,b : JSValue) : NativeInt;\r\n  TJSArrayCallback = TJSArrayEvent;\r\n  TJSArrayMapCallback = TJSArrayMapEvent;\r\n  TJSArrayReduceCallBack = TJSArrayReduceEvent;\r\n  TJSArrayCompareCallBack = TJSArrayCompareEvent;\r\n\r\n  { TJSArray }\r\n\r\n  TJSArray = Class external name 'Array'\r\n  private\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n    procedure SetElements(Index: NativeInt; const AValue: JSValue); external name '[]';\r\n  public\r\n    FLength : NativeInt; external name 'length';\r\n    constructor new; overload;\r\n    constructor new(aLength : NativeInt); overload;\r\n    constructor new(aElement1 : JSValue); varargs; overload;\r\n    class function _of() : TJSArray; varargs; external name 'of'; \r\n    class function isArray(a: JSValue) : Boolean;\r\n{$IFDEF JAVASCRIPT2015}    \r\n    class function from(a : JSValue) : TJSArray;\r\n    class function from(arrayLike : JSValue; mapFunction : TJSMapFunctionCallBack): TJSArray; overload;\r\n    class function from(arrayLike : JSValue; mapFunction : TJSMapFunctionCallBack; thisArg : JSValue): TJSArray; overload;\r\n{$ENDIF}\r\n    function concat(el : JSValue) : TJSArray; varargs;\r\n    function copyWithin(aTarget : NativeInt) : TJSarray;overload; // not in IE\r\n    function copyWithin(aTarget, aStart : NativeInt) : TJSarray;overload; // not in IE\r\n    function copyWithin(aTarget, aStart, aEnd : NativeInt) : TJSarray;overload; // not in IE\r\n    function entries: TJSIterator;\r\n    Function every(const aCallback : TJSArrayCallBack) : boolean;overload;\r\n    Function every(const aCallback : TJSArrayEvent; aThis : TObject) : boolean;overload;\r\n    Function filter(const aCallBack : TJSArrayCallBack) : TJSArray; overload;\r\n    Function filter(const aCallBack : TJSArrayEvent; aThis : TObject) : TJSArray;overload;\r\n    Function fill(aValue : JSValue) : TJSArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex : NativeInt) : TJSArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex,aEndIndex : NativeInt) : TJSArray; overload;\r\n    Function find(const aCallBack : TJSArrayCallBack) : JSValue; overload;\r\n    Function find(const aCallBack : TJSArrayEvent; aThis : TObject) : JSValue; overload;\r\n    Function findIndex(const aCallBack : TJSArrayCallBack) : NativeInt; overload;\r\n    Function findIndex(const aCallBack : TJSArrayEvent; aThis : TObject) : NativeInt; overload;\r\n    procedure forEach(const aCallBack : TJSArrayEventProc); overload;\r\n    procedure forEach(const aCallBack : TJSArrayEvent); overload;\r\n    procedure forEach(const aCallBack : TJSArrayEvent; aThis : TObject); overload;\r\n    function includes(aElement : JSValue) : Boolean; overload;\r\n    function includes(aElement : JSValue; FromIndex : NativeInt) : Boolean; overload;\r\n    function indexOf(aElement : JSValue) : NativeInt; overload;\r\n    function indexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    function join : String; overload;\r\n    function join (aSeparator : string) : String; overload;\r\n    function keys: TJSIterator;\r\n    function lastIndexOf(aElement : JSValue) : NativeInt; overload;\r\n    function lastIndexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n//    Function map(const aCallBack : TJSArrayMapEventArray) : JSValue; overload;\r\n    Function map(const aCallBack : TJSArrayMapCallBack) : TJSArray; overload;\r\n    Function map(const aCallBack : TJSArrayMapEvent; aThis : TObject) : TJSArray; overload;\r\n    function pop : JSValue; \r\n    function push(aElement : JSValue) : NativeInt; varargs;\r\n    function reduce(const aCallBack : TJSArrayReduceCallBack) : JSValue; overload;\r\n    function reduce(const aCallBack : TJSArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSArrayReduceCallBack) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    Function reverse : TJSArray;\r\n    Function shift : JSValue;\r\n    Function slice : TJSArray; overload;\r\n    function slice(aBegin : NativeInt) : TJSArray; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSArray; overload;\r\n    Function some(const aCallback : TJSArrayCallBack) : boolean; overload;\r\n    Function some(const aCallback : TJSArrayEvent; aThis : TObject) : boolean; overload;\r\n    Function sort(const aCallback : TJSArrayCompareCallBack) : TJSArray; overload;\r\n    Function sort() : TJSArray; overload;\r\n    function splice(aStart : NativeInt) : TJSArray; overload;\r\n    function splice(aStart,aDeleteCount : NativeInt) : TJSArray; varargs; overload;\r\n    function toLocaleString: String; overload;\r\n    function toLocaleString(locales : string) : String; overload;\r\n    function toLocaleString(locales : string; const Options : TLocaleCompareOptions) : String; overload;\r\n    function toString : String;\r\n    function unshift : NativeInt; varargs;\r\n    function values: TJSIterator;\r\n    Property Length : NativeInt Read FLength Write FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements write SetElements; default;\r\n  end;\r\n\r\n  TJSArrayBuffer = Class external name 'ArrayBuffer'\r\n  private\r\n    fLength : NativeInt; external name 'byteLength';\r\n  public\r\n    constructor new(aByteLength : NativeInt);\r\n    class function isView(aValue : JSValue) : Boolean;   \r\n    function slice(aBegin : NativeInt) : TJSArrayBuffer; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSArrayBuffer; overload;\r\n    Property byteLength : NativeInt Read fLength;\r\n  end;\r\n\r\n  TJSBufferSource = class external name 'BufferSource'\r\n  end;\r\n\r\n  { TJSTypedArray }\r\n  TJSTypedArray = Class;\r\n\r\n  TJSTypedArrayCallBack = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : Boolean;\r\n  TJSTypedArrayEvent = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : Boolean of object;\r\n  TJSTypedArrayMapCallBack = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : JSValue;\r\n  TJSTypedArrayMapEvent = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : JSValue of object;\r\n  TJSTypedArrayReduceCallBack = function (accumulator, currentValue : JSValue; currentIndex : NativeInt; anArray : TJSTypedArray) : JSValue;\r\n  TJSTypedArrayCompareCallBack = function (a,b : JSValue) : NativeInt;\r\n\r\n  TJSTypedArray = class external name 'TypedArray' (TJSBufferSource)\r\n  Private\r\n    FBuffer: TJSArrayBuffer; external name 'buffer';\r\n    FByteLength: NativeInt; external name 'byteLength';\r\n    FLength: NativeInt; external name 'length';\r\n    FByteOffset: NativeInt; external name 'byteOffset';\r\n    FBytesPerElement : NativeInt; external name 'BYTES_PER_ELEMENT';\r\n    function getValue(Index : NativeInt) : JSValue; external name '[]';\r\n    procedure setValue(Index : NativeInt;AValue : JSValue); external name '[]';\r\n  Public\r\n    property BYTES_PER_ELEMENT : NativeInt Read FBytesPerElement;\r\n    class var name : string;\r\n//    class function from(aValue : jsValue) : TJSTypedArray;\r\n//    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSTypedArray;\r\n//    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSTypedArray;\r\n    class function _of(aValue : jsValue) : TJSTypedArray; varargs; external name 'of';\r\n    function copyWithin(aTarget : NativeInt) : TJSTypedArray;overload;\r\n    function copyWithin(aTarget, aStart : NativeInt) : TJSTypedArray;overload;\r\n    function copyWithin(aTarget, aStart, aEnd : NativeInt) : TJSTypedArray;overload;\r\n    Function every(const aCallback : TJSTypedArrayCallBack) : boolean;overload;\r\n    Function every(const aCallback : TJSTypedArrayEvent; aThis : TObject) : boolean;overload;\r\n    Function fill(aValue : JSValue) : TJSTypedArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex : NativeInt) : TJSTypedArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex,aEndIndex : NativeInt) : TJSTypedArray; overload;\r\n    Function filter(const aCallBack : TJSTypedArrayCallBack) : TJSTypedArray; overload;\r\n    Function filter(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : TJSTypedArray;overload;\r\n    Function find(const aCallBack : TJSTypedArrayCallBack) : JSValue; overload;\r\n    Function find(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : JSValue; overload;\r\n    Function findIndex(const aCallBack : TJSTypedArrayCallBack) : NativeInt; overload;\r\n    Function findIndex(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : NativeInt; overload;\r\n    procedure forEach(const aCallBack : TJSTypedArrayCallBack); overload;\r\n    procedure forEach(const aCallBack : TJSTypedArrayEvent; aThis : TObject); overload;\r\n    function includes(aElement : JSValue) : Boolean; overload;\r\n    function includes(aElement : JSValue; FromIndex : NativeInt) : Boolean; overload;\r\n    function indexOf(aElement : JSValue) : NativeInt; overload;\r\n    function indexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    function join : String; overload;\r\n    function join (aSeparator : string) : String; overload;\r\n    function lastIndexOf(aElement : JSValue) : NativeInt; overload;\r\n    function lastIndexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    Function map(const aCallBack : TJSTypedArrayCallBack) : TJSTypedArray; overload;\r\n    Function map(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : TJSTypedArray; overload;\r\n    function reduce(const aCallBack : TJSTypedArrayReduceCallBack) : JSValue; overload;\r\n    function reduce(const aCallBack : TJSTypedArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSTypedArrayReduceCallBack) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSTypedArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    Function reverse : TJSTypedArray;\r\n    procedure _set(anArray : TJSArray); external name 'set';\r\n    procedure _set(anArray : TJSArray; anOffset : NativeInt); external name 'set';\r\n    procedure _set(anArray : TJSTypedArray); external name 'set';\r\n    procedure _set(anArray : TJSTypedArray; anOffset : NativeInt); external name 'set';\r\n    Function slice : TJSTypedArray; overload;\r\n    function slice(aBegin : NativeInt) : TJSTypedArray; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSTypedArray; overload;\r\n    Function some(const aCallback : TJSTypedArrayCallBack) : boolean; overload;\r\n    Function some(const aCallback : TJSTypedArrayEvent; aThis : TObject) : boolean; overload;\r\n    Function sort(const aCallback : TJSTypedArrayCompareCallBack) : TJSTypedArray; overload;\r\n    Function sort() : TJSTypedArray; overload;\r\n    function splice(aStart : NativeInt) : TJSTypedArray; overload;\r\n    function splice(aStart,aDeleteCount : NativeInt) : TJSTypedArray; varargs; overload;\r\n    function toLocaleString: String; overload;\r\n    function toLocaleString(locales : string) : String; overload;\r\n    function toLocaleString(locales : string; const Options : TLocaleCompareOptions) : String; overload;\r\n    function toString : String;\r\n    function unshift : NativeInt; varargs;\r\n    property buffer : TJSArrayBuffer read FBuffer;\r\n    property byteLength : NativeInt Read FByteLength;\r\n    property byteOffset : NativeInt Read FByteOffset;\r\n    property length : NativeInt Read FLength;\r\n    property values[Index : NativeInt] : JSValue Read getValue Write SetValue; default;\r\n  end;\r\n\r\n  { TJSInt8Array }\r\n\r\n  TJSInt8Array = class external name 'Int8Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Shortint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Shortint);external name '[]';\r\n  public\r\n{$IFDEF JAVASCRIPT2017}\r\n    constructor new; // new in ES2017\r\n{$ENDIF}\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt8Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSInt8Array; varargs; external name 'of'; reintroduce;overload;\r\n    class function _of(aValue : TJSValueDynArray) : TJSInt8Array; varargs; external name 'of'; reintroduce; overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSInt8Array;  overload;\r\n    function subarray(aBegin: Integer): TJSInt8Array; overload;\r\n    procedure _set(anArray : Array of ShortInt); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of ShortInt; anOffset : NativeInt); external name 'set';\r\n    property values[Index : NativeInt] : Shortint Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint8Array  = class external name 'Uint8Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Byte; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Byte);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt8Array; reintroduce; overload;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt8Array; reintroduce;overload;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt8Array; reintroduce;overload;\r\n    class function _of(aValue : jsValue) : TJSUInt8Array; varargs; external name 'of'; reintroduce; overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSUInt8Array;  overload;\r\n    function subarray(aBegin: Integer): TJSUInt8Array; overload;\r\n    procedure _set(anArray : Array of Byte); external name 'set'; reintroduce; overload;\r\n    procedure _set(anArray : Array of Byte; anOffset : NativeInt); external name 'set'; overload;\r\n    Property values[Index : NativeInt] : Byte Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint8ClampedArray  = class external name 'Uint8ClampedArray' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Byte; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Byte);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt8ClampedArray; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt8ClampedArray; reintroduce;overload;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt8ClampedArray; reintroduce;overload;\r\n    class function _of(aValue : jsValue) : TJSUInt8ClampedArray; varargs; external name 'of'; reintroduce;overload;\r\n    procedure _set(anArray : Array of Byte); external name 'set'; reintroduce;overload;\r\n    procedure _set(anArray : Array of Byte; anOffset : NativeInt); external name 'set';overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSUInt8ClampedArray;  overload;\r\n    function subarray(aBegin: Integer): TJSUInt8ClampedArray; overload;\r\n    Property values[Index : NativeInt] : Byte Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSInt16Array = class external name 'Int16Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): smallint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Smallint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt16Array; reintroduce;overload;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt16Array; reintroduce;overload;\r\n    class function _of(aValue : jsValue) : TJSInt16Array; varargs; external name 'of'; reintroduce;overload;\r\n    procedure _set(anArray : Array of SmallInt); external name 'set'; reintroduce;overload;\r\n    procedure _set(anArray : Array of SmallInt; anOffset : NativeInt); external name 'set';overload;\r\n    function subarray(aBegin, aEnd: Integer): TJSInt16Array;  overload;\r\n    function subarray(aBegin: Integer): TJSInt16Array; overload;\r\n    Property values[Index : NativeInt] : SmallInt Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint16Array = class external name 'Uint16Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Word; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Word);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt16Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt16Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Word); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Word; anOffset : NativeInt); external name 'set';\r\n    function subarray(aBegin, aEnd: Integer): TJSUInt16Array;  overload;\r\n    function subarray(aBegin: Integer): TJSUInt16Array; overload;\r\n    Property values[Index : NativeInt] : Word Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSInt32Array = class external name 'Int32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): longint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: longint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSInt32Array; varargs;external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of LongInt); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of LongInt; anOffset : NativeInt); external name 'set';\r\n    function subarray(aBegin, aEnd: Integer): TJSInt32Array;  overload;\r\n    function subarray(aBegin: Integer): TJSInt32Array; overload;\r\n    Property values[Index : NativeInt] : longint Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint32Array = class external name 'Uint32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): LongWord; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: LongWord);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt32Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Cardinal); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Cardinal; anOffset : NativeInt); external name 'set';\r\n    function subarray(aBegin, aEnd: Integer): TJSUInt32Array;  overload;\r\n    function subarray(aBegin: Integer): TJSUInt32Array; overload;\r\n    Property values[Index : NativeInt] : LongWord Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSFloat32Array = class external name 'Float32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Float32; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Float32);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSFloat32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSFloat32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSFloat32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSFloat32Array; varargs; reintroduce;\r\n    procedure _set(anArray : Array of Double); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Double; anOffset : NativeInt); external name 'set'; reintroduce;\r\n    function subarray(aBegin, aEnd: Integer): TJSFloat32Array;  overload;\r\n    function subarray(aBegin: Integer): TJSFloat32Array; overload;\r\n    Property values[Index : NativeInt] : Float32 Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSFloat64Array = class external name 'Float64Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Float64; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Float64);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSFloat64Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSFloat64Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSFloat64Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSFloat64Array; varargs; reintroduce;\r\n    procedure _set(anArray : Array of Double); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Double; anOffset : NativeInt); external name 'set'; reintroduce;\r\n    function subarray(aBegin, aEnd: Integer): TJSFloat64Array;  overload;\r\n    function subarray(aBegin: Integer): TJSFloat64Array; overload;\r\n    Property values[Index : NativeInt] : Float64 Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSDataView = Class external name 'DataView' (TJSBufferSource)\r\n  private\r\n    fBuffer : TJSArrayBuffer; external name 'buffer';\r\n    fLength : NativeInt; external name 'byteLength';\r\n    fOffset : NativeInt; external name 'byteOffset';\r\n  public\r\n    constructor new(aBuffer : TJSArrayBuffer); overload;\r\n    constructor new(aBuffer : TJSArrayBuffer; aOffset : NativeInt); overload;\r\n    constructor new(aBuffer : TJSArrayBuffer; aOffset,aByteLength : NativeInt); overload;\r\n    function getFloat32(aByteOffset : NativeInt) : double; overload;\r\n    function getFloat32(aByteOffset : NativeInt; aLittleEndian: Boolean) : double; overload;\r\n    function getFloat64(aByteOffset : NativeInt) : double; overload;\r\n    function getFloat64(aByteOffset : NativeInt; aLittleEndian: Boolean) : double; overload;\r\n    function getInt8(aByteOffset : NativeInt) : ShortInt; \r\n    function getInt16(aByteOffset : NativeInt) : SmallInt; overload;\r\n    function getInt16(aByteOffset : NativeInt; aLittleEndian : Boolean) : SmallInt; overload;\r\n    function getInt32(aByteOffset : NativeInt) : Longint; overload;\r\n    function getInt32(aByteOffset : NativeInt; aLittleEndian : Boolean) : Longint; overload;\r\n    function getUint8(aByteOffset : NativeInt) : Byte; overload;\r\n    function getUint16(aByteOffset : NativeInt) : Word; overload;\r\n    function getUint16(aByteOffset : NativeInt; aLittleEndian : Boolean) : Word; overload;\r\n    function getUint32(aByteOffset : NativeInt) : LongWord; overload;\r\n    function getUint32(aByteOffset : NativeInt; aLittleEndian : Boolean) : LongWord; overload;\r\n\r\n    procedure setFloat32(aByteOffset : NativeInt; aValue : double); overload;\r\n    procedure setFloat32(aByteOffset : NativeInt; aValue : double; aLittleEndian: Boolean); overload;\r\n    procedure setFloat64(aByteOffset : NativeInt; aValue : double); overload;\r\n    procedure setFloat64(aByteOffset : NativeInt; aValue : double; aLittleEndian: Boolean); overload;\r\n    procedure setInt8(aByteOffset : NativeInt; aValue : ShortInt); \r\n    procedure setInt16(aByteOffset : NativeInt; aValue : SmallInt); overload;\r\n    procedure setInt16(aByteOffset : NativeInt; aValue : SmallInt; aLittleEndian : Boolean); overload;\r\n    procedure setInt32(aByteOffset : NativeInt; aValue : Longint); overload;\r\n    procedure setInt32(aByteOffset : NativeInt; aValue : Longint; aLittleEndian : Boolean); overload;\r\n    procedure setUint8(aByteOffset : NativeInt; aValue : Byte); overload;\r\n    procedure setUint16(aByteOffset : NativeInt; aValue : Word); overload;\r\n    procedure setUint16(aByteOffset : NativeInt; aValue : Word; aLittleEndian : Boolean); overload;\r\n    procedure setUint32(aByteOffset : NativeInt; aValue : LongWord); overload;\r\n    procedure setUint32(aByteOffset : NativeInt; aValue: LongWord; aLittleEndian : Boolean); overload;\r\n    Property byteLength : NativeInt Read fLength;\r\n    Property byteOffset : NativeInt read fOffset;\r\n    property buffer : TJSArrayBuffer Read fBuffer;\r\n  end;\r\n\r\n  TJSJSON = class external name 'JSON' (TJSObject)\r\n  Public\r\n    class function parse(aJSON : String) : JSValue;\r\n    // Use this only when you are sure you will get an object, no checking is done.\r\n    class function parseObject(aJSON : String) : TJSObject; external name 'parse';\r\n    class function stringify(aValue : JSValue) : string;\r\n    class function stringify(aValue,aReplacer : JSValue) : string;\r\n    class function stringify(aValue,aReplacer : JSValue; space:  NativeInt) : string;\r\n    class function stringify(aValue,aReplacer : JSValue; space:  String) : string;\r\n  end;\r\n\r\n  { TJSError }\r\n\r\n  TJSError = Class external name 'Error'\r\n  private\r\n    FMessage: String; external name 'message';\r\n    {$ifdef NodeJS}\r\n    FStack: JSValue; external name 'stack';\r\n    {$endif}\r\n  Public\r\n    Constructor new;\r\n    Constructor new(Const aMessage : string);\r\n    Constructor new(Const aMessage,aFileName : string);\r\n    Constructor new(Const aMessage,aFileName : string; aLineNumber : NativeInt);\r\n    Property Message : String Read FMessage;\r\n    {$ifdef NodeJS}\r\n    Property Stack: JSValue read FStack;\r\n    {$endif}\r\n  end;\r\n\r\n\r\n  TJSPromiseResolver = reference to function (aValue : JSValue) : JSValue;\r\n  TJSPromiseExecutor = reference to procedure (resolve,reject : TJSPromiseResolver);\r\n  TJSPromiseFinallyHandler = reference to procedure;\r\n  TJSPromise = Class;\r\n  TJSPromiseArray = array of TJSPromise;\r\n\r\n  TJSPromise = class external name 'Promise'\r\n    constructor new(Executor : TJSPromiseExecutor);\r\n    class function all(arg : Array of JSValue) : TJSPromise; overload;\r\n    class function all(arg : JSValue) : TJSPromise; overload;\r\n    class function all(arg : TJSPromiseArray) : TJSPromise; overload;\r\n    class function race(arg : Array of JSValue) : TJSPromise; overload;\r\n    class function race(arg : JSValue) : TJSPromise; overload;\r\n    class function race(arg : TJSPromiseArray) : TJSPromise; overload;\r\n    class function reject(reason : JSValue) : TJSPromise;\r\n    class function resolve(value : JSValue): TJSPromise; overload;\r\n    class function resolve : TJSPromise; overload;\r\n    function _then (onAccepted : TJSPromiseResolver) : TJSPromise; external name 'then';\r\n    function _then (onAccepted,OnRejected: TJSPromiseResolver) : TJSPromise; external name 'then';\r\n    function catch (onRejected : TJSPromiseResolver) : TJSPromise;\r\n    function _finally(value : TJSPromiseFinallyHandler): TJSPromise;\r\n  end;\r\n\r\n  TJSFunctionArguments = class external name 'arguments'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n    procedure SetElements(Index: NativeInt; const AValue: JSValue); external name '[]';\r\n  public\r\n    property Length: NativeInt read FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements write SetElements; default;\r\n  end;\r\n\r\nvar\r\n  // JSArguments can be used in procedures/functions to provide access to the 'arguments' array.\r\n  JSArguments: TJSFunctionArguments; external name 'arguments';\r\n  // JSThis can be used in all code to access the javascript 'this' object.\r\n  JSThis: TJSObject; external name 'this';\r\n  // JSExceptValue can be used in catch blocks to access the JS throw value\r\n  JSExceptValue: JSValue; external name '$e';\r\n\r\nfunction new(aElements: TJSValueDynArray) : TJSObject; overload;\r\nfunction JSDelete(const Obj: JSValue; const PropName: string): boolean; assembler; overload;\r\n\r\nfunction decodeURIComponent(encodedURI : String) : String; external name 'decodeURIComponent';\r\nfunction encodeURIComponent(str : String) : String; external name 'encodeURIComponent';\r\n\r\nfunction parseInt(s: String; Radix: NativeInt): NativeInt; overload; external name 'parseInt'; // may result NaN\r\nfunction parseInt(s: String): NativeInt; overload; external name 'parseInt'; // may result NaN\r\nfunction parseFloat(s: String): double; overload; external name 'parseFloat'; // may result NaN\r\n\r\nfunction hasString(const v: JSValue): boolean; external name 'rtl.hasString';// isString(v) and v<>''\r\nfunction hasValue(const v: JSValue): boolean; assembler; // returns the JS definition of if(v): v is not false, undefined, null, 0, NaN, or the empty string. Note: JS if(new Boolean(false)) returns true.\r\nfunction isArray(const v: JSValue): boolean; external name 'rtl.isArray';\r\nfunction isBoolean(const v: JSValue): boolean; assembler;\r\nfunction isDate(const v: JSValue): boolean; assembler;\r\nfunction isCallback(const v: JSValue): boolean; assembler;\r\nfunction isChar(const v: JSValue): boolean; assembler;\r\nfunction isClass(const v: JSValue): boolean; assembler; // is a Pascal class, e.g. a TClass\r\nfunction isClassInstance(const v: JSValue): boolean; assembler;// is a Pascal class instance, e.g. a TObject\r\nfunction isFunction(const v: JSValue): boolean; external name 'rtl.isFunction';\r\nfunction isInteger(const v: JSValue): boolean; assembler;\r\nfunction isModule(const v: JSValue): boolean; external name 'rtl.isModule';\r\nfunction isNull(const v: JSValue): boolean; assembler;\r\nfunction isNumber(const v: JSValue): boolean; external name 'rtl.isNumber';\r\nfunction isObject(const v: JSValue): boolean; external name 'rtl.isObject'; // true if not null and a JS Object\r\nfunction isRecord(const v: JSValue): boolean; assembler;\r\nfunction isString(const v: JSValue): boolean; external name 'rtl.isString';\r\nfunction isUndefined(const v: JSValue): boolean; assembler;\r\nfunction isDefined(const v: JSValue): boolean; assembler;\r\nfunction isUTF16Char(const v: JSValue): boolean; assembler;\r\nfunction isExt(const InstanceOrClass, aClass: JSValue): boolean; external name 'rtl.isExt'; // aClass can be a JS object or function\r\nfunction jsInstanceOf(const aFunction, aFunctionWithPrototype: JSValue): String; assembler;\r\nfunction jsTypeOf(const v: JSValue): String; external name 'typeof';\r\nfunction jsIsNaN(const v: JSValue): boolean; external name 'isNaN';// true if value cannot be converted to a number. e.g. True on NaN, undefined, {}, '123'. False on true, null, '', ' ', '1A'\r\nfunction toNumber(const v: JSValue): double; assembler; // if not possible, returns NaN\r\nfunction toInteger(const v: JSValue): NativeInt; // if v is not an integer, returns 0\r\nfunction toObject(Value: JSValue): TJSObject; // If Value is not a Javascript object, returns Nil\r\nfunction toArray(Value: JSValue): TJSArray; // If Value is not a Javascript array, returns Nil\r\nfunction toBoolean(Value: JSValue): Boolean; // If Value is not a Boolean, returns False\r\nfunction toString(Value: JSValue): String; // If Value is not a string, returns ''\r\n\r\nType\r\n  TJSValueType = (jvtNull,jvtBoolean,jvtInteger,jvtFloat,jvtString,jvtObject,jvtArray);\r\n\r\nFunction GetValueType(JS : JSValue) : TJSValueType;\r\nfunction URLToArrayOfString(URL: string): TJSStringDynArray;\r\n\r\nConst\r\n  Null : JSValue; external name 'null';\r\n  Undefined : JSValue; external name 'undefined';\r\n\r\nimplementation\r\n\r\nfunction new(aElements: TJSValueDynArray): TJSObject;\r\n\r\n  function toString(I : Integer): string; external name 'String';\r\n\r\nVar\r\n  L,I : integer;\r\n  S : String;\r\n\r\nbegin\r\n  L:=length(aElements);\r\n  if (L mod 2)=1 then\r\n    raise EJS.Create('Number of arguments must be even');\r\n  I:=0;\r\n  // Check all arguments;\r\n  While (i<L) do\r\n    begin\r\n    if Not isString(aElements[i]) then\r\n      begin\r\n      S:=ToString(I);\r\n      raise EJS.Create('Argument '+S+' must be a string.');\r\n      end;\r\n    inc(I,2);\r\n    end;\r\n  I:=0;\r\n  Result:=TJSObject.New;\r\n  While (i<L) do\r\n    begin\r\n    S:=String(aElements[i]);\r\n    Result.Properties[S]:=aElements[i+1];\r\n    inc(I,2);\r\n    end;\r\nend;\r\n\r\n{$IFDEF PAS2JS}\r\n\r\nfunction JSDelete(const Obj: JSValue; const PropName: string): boolean; assembler;\r\nasm\r\n  return delete Obj[PropName];\r\nend;\r\n\r\nfunction hasValue(const v: JSValue): boolean; assembler;\r\nasm\r\n  if(v){ return true; } else { return false; };\r\nend;\r\n\r\nfunction isBoolean(const v: JSValue): boolean; assembler;\r\nasm\r\n  return typeof(v) == 'boolean';\r\nend;\r\n\r\nfunction isDate(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (v instanceof Date);\r\nend;\r\n\r\nfunction isCallback(const v: JSValue): boolean; assembler;\r\nasm\r\n  return rtl.isObject(v) && rtl.isObject(v.scope) && (rtl.isString(v.fn) || rtl.isFunction(v.fn));\r\nend;\r\n\r\nfunction isChar(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)!=\"string\") && (v.length==1);\r\nend;\r\n\r\nfunction isClass(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)==\"object\") && (v!=null) && (v.$class == v);\r\nend;\r\n\r\nfunction isClassInstance(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)==\"object\") && (v!=null) && (v.$class == Object.getPrototypeOf(v));\r\nend;\r\n\r\nfunction isInteger(const v: JSValue): boolean; assembler;\r\nasm\r\n  return Math.floor(v)===v;\r\nend;\r\n\r\nfunction isNull(const v: JSValue): boolean; assembler;\r\n// Note: use identity, \"==\" would fit undefined\r\nasm\r\n  return v === null;\r\nend;\r\n\r\nfunction isRecord(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)===\"object\")\r\n      && (typeof(v.$new)===\"function\")\r\n      && (typeof(v.$clone)===\"function\")\r\n      && (typeof(v.$eq)===\"function\")\r\n      && (typeof(v.$assign)===\"function\");\r\nend;\r\n\r\nfunction isUndefined(const v: JSValue): boolean; assembler;\r\nasm\r\n  return v == undefined;\r\nend;\r\n\r\nfunction isDefined(const v: JSValue): boolean; assembler;\r\nasm\r\n  return !(v == undefined);\r\nend;\r\n\r\nfunction isUTF16Char(const v: JSValue): boolean; assembler;\r\nasm\r\n  if (typeof(v)!=\"string\") return false;\r\n  if ((v.length==0) || (v.length>2)) return false;\r\n  var code = v.charCodeAt(0);\r\n  if (code < 0xD800){\r\n    if (v.length == 1) return true;\r\n  } else if (code <= 0xDBFF){\r\n    if (v.length==2){\r\n      code = v.charCodeAt(1);\r\n      if (code >= 0xDC00 && code <= 0xDFFF) return true;\r\n    };\r\n  };\r\n  return false;\r\nend;\r\n\r\nfunction jsInstanceOf(const aFunction, aFunctionWithPrototype: JSValue\r\n  ): String; assembler;\r\nasm\r\n  return aFunction instanceof aFunctionWithPrototype;\r\nend;\r\n\r\nfunction toNumber(const v: JSValue): double; assembler;\r\nasm\r\n  return v-0;\r\nend;\r\n\r\nfunction toInteger(const v: JSValue): NativeInt;\r\nbegin\r\n  if IsInteger(v) then\r\n    Result:=NativeInt(v)\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction toObject(Value: JSValue): TJSObject;\r\n\r\nbegin\r\n  if IsObject(Value) then\r\n    Result:=TJSObject(Value)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nfunction toArray(Value: JSValue): TJSArray; // If not possible, returns Nil\r\n\r\nbegin\r\n  if IsArray(Value) then\r\n    Result:=TJSArray(Value)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nfunction toBoolean(Value: JSValue): Boolean; // If not possible, returns False\r\n\r\nbegin\r\n  if isBoolean(Value) then\r\n    Result:=Boolean(Value)\r\n  else\r\n    Result:=False;\r\nend;\r\n\r\nfunction toString(Value: JSValue): String; // If not possible, returns ''\r\n\r\nbegin\r\n  if IsString(Value) then\r\n    Result:=String(Value)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n{ EJS }\r\n\r\nconstructor EJS.Create(const Msg: String);\r\nbegin\r\n  FMessage:=Msg;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction URLToArrayOfString(URL: string): TJSStringDynArray;\r\nvar\r\n  a: TJSStringDynArray;\r\n  cors_api_url: string;\r\nbegin\r\n  cors_api_url := '';//'https://cors-anywhere.herokuapp.com/';\r\n  asm\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open(\"GET\", cors_api_url + URL, false);\r\n    xhr.send();\r\n\r\n    if (xhr.status==200)\r\n    {\r\n      var obj = xhr.responseText.split(/\\r\\n|\\n/);\r\n      for (var i = 0; i < obj.length; i++) {\r\n        a.push(obj[i]);\r\n      }\r\n    }\r\n  end;\r\n\r\n  Result := a;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction GetValueType(JS: JSValue): TJSValueType;\r\n\r\nVar\r\n  t : string;\r\n\r\nbegin\r\n  if isNull(js) then   // null reported as object\r\n    result:=jvtNull\r\n  else\r\n    begin\r\n    t:=jsTypeOf(js);\r\n    if (t='string') then\r\n      Result:=jvtString\r\n    else if (t='boolean') then\r\n      Result:=jvtBoolean\r\n    else if (t='object') then\r\n      begin\r\n      if IsArray(JS) then\r\n        Result:=jvtArray\r\n      else\r\n        Result:=jvtObject;\r\n      end\r\n    else if (t='number') then\r\n      if isInteger(JS) then\r\n        result:=jvtInteger\r\n      else\r\n        result:=jvtFloat\r\n    end;\r\nend;\r\n\r\n{$ENDIF}\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit SysUtils;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nuses\r\n  RTLConsts, js;\r\n\r\nprocedure FreeAndNil(var Obj);\r\n\r\ntype\r\n  TProcedure = procedure;\r\n\r\n {*****************************************************************************\r\n                              Various types\r\n  *****************************************************************************}\r\nConst\r\n  FloatRecDigits = 19;\r\n\r\ntype\r\n  { TFloatRec }\r\n  TFloatRec = Record\r\n    Exponent: Integer;\r\n    Negative: Boolean;\r\n    Digits: Array[0..FloatRecDigits-1] of Char;\r\n  End;\r\n  TEndian = (Little,Big);\r\n  TFileName = String;\r\n  TByteArray = array [0..32767] of Byte;\r\n  TWordArray = array [0..16383] of Word;\r\n  TBytes = Array of byte;\r\n  TStringArray = array of string;\r\n\r\n  TMonthNameArray = array [1..12] of string;\r\n  TDayTable = array [1..12] of Word;\r\n  TWeekNameArray = array [1..7] of string;\r\n  TMonthNames = TMonthNameArray;\r\n  TDayNames = array[1..7] of string;\r\n  Currency = Double;\r\n\r\n{*****************************************************************************\r\n                            Exception handling\r\n*****************************************************************************}\r\n\r\n  { Exception }\r\n\r\n  Exception = class(TObject)\r\n  private\r\n    fMessage: String;\r\n    fHelpContext: Integer;\r\n    {$ifdef NodeJS}\r\n    FNodeJSError: TJSError;\r\n    {$endif}\r\n  public\r\n    constructor Create(const Msg: String); reintroduce;\r\n    constructor CreateFmt(const Msg: string; const Args: array of jsvalue);\r\n    constructor CreateHelp(const Msg: String; AHelpContext: Integer);\r\n    constructor CreateFmtHelp(const Msg: string; const Args: array of jsvalue; AHelpContext: Integer);\r\n    function ToString: String; override;\r\n    property HelpContext: Integer read fHelpContext write fHelpContext;\r\n    property Message: String read fMessage write fMessage;\r\n    {$ifdef NodeJS}\r\n    property NodeJSError: TJSError read FNodeJSError write FNodeJSError;\r\n    {$endif}\r\n  end;\r\n\r\n  ExceptClass = class of Exception;\r\n\r\n  EExternal = class(Exception);\r\n\r\n  { General math errors }\r\n  EMathError  = class(EExternal);\r\n  EInvalidOp  = class(EMathError);\r\n  EZeroDivide = class(EMathError);\r\n  EOverflow   = class(EMathError);\r\n  EUnderflow  = class(EMathError);\r\n\r\n  EAbort           = class(Exception);\r\n  EInvalidCast     = class(Exception);\r\n  EAssertionFailed = class(Exception);\r\n  EObjectCheck     = class(Exception);\r\n\r\n  { String conversion errors }\r\n  EConvertError = class(Exception);\r\n  EFormatError = class(Exception);\r\n\r\n\r\n  { integer math exceptions }\r\n  EIntError    = Class(EExternal);\r\n  EDivByZero   = Class(EIntError);\r\n  ERangeError  = Class(EIntError);\r\n  EIntOverflow = Class(EIntError);\r\n\r\n  { General math errors }\r\n\r\n  { Run-time and I/O Errors }\r\n  EInOutError = class(Exception)\r\n  public\r\n    ErrorCode : Integer;\r\n  end;\r\n\r\n  EHeapMemoryError = class(Exception);\r\n  EHeapException = EHeapMemoryError;\r\n\r\n  EExternalException = class(EExternal);\r\n  EInvalidPointer  = Class(EHeapMemoryError);\r\n  EOutOfMemory     = Class(EHeapMemoryError);\r\n\r\n  { EVariantError }\r\n\r\n  EVariantError = Class(Exception)\r\n    ErrCode : longint;\r\n    Constructor CreateCode(Code : Longint);\r\n  end;\r\n\r\n  EAccessViolation = Class(EExternal);\r\n  EBusError = Class(EAccessViolation);\r\n  EPrivilege = class(EExternal);\r\n  EStackOverflow = class(EExternal);\r\n  EControlC = class(EExternal);\r\n\r\n  { String conversion errors }\r\n\r\n  { Other errors }\r\n  EAbstractError   = Class(Exception);\r\n\r\n  EPropReadOnly = class(Exception);\r\n  EPropWriteOnly = class(Exception);\r\n\r\n  EIntfCastError = class(Exception);\r\n  EInvalidContainer = class(Exception);\r\n  EInvalidInsert = class(Exception);\r\n\r\n  EPackageError = class(Exception);\r\n\r\n  EOSError = class(Exception)\r\n  public\r\n    ErrorCode: Longint;\r\n  end;\r\n\r\n  ESafecallException = class(Exception);\r\n  ENoThreadSupport = Class(Exception);\r\n  ENoWideStringSupport = Class(Exception);\r\n  ENotImplemented = class(Exception);\r\n\r\n  EArgumentException = class(Exception);\r\n  EArgumentOutOfRangeException = class(EArgumentException);\r\n  EArgumentNilException = class(EArgumentException);\r\n\r\n  EPathTooLongException = class(Exception);\r\n  ENotSupportedException = class(Exception);\r\n  EDirectoryNotFoundException = class(Exception);\r\n  EFileNotFoundException = class(Exception);\r\n  EPathNotFoundException = class(Exception);\r\n\r\n  ENoConstructException = class(Exception);\r\n\r\n//function GetTickCount: Integer;\r\n\r\n\r\n{*****************************************************************************\r\n                            String function\r\n*****************************************************************************}\r\n\r\nConst\r\n  EmptyStr = '';\r\n  EmptyWideStr = ''; // No difference here.\r\n  HexDisplayPrefix: string = '$';\r\n  LeadBytes = [] unimplemented;\r\n\r\nFunction CharInSet(Ch: Char;Const CSet : array of char) : Boolean;\r\n\r\nfunction LeftStr(const S: string; Count: Integer): String; assembler;\r\nfunction RightStr(const S: string; Count: Integer): String; assembler;\r\n\r\nfunction Trim(const S: String): String; assembler;\r\nfunction TrimLeft(const S: String): String; assembler;\r\nfunction TrimRight(const S: String): String; assembler;\r\n\r\nfunction UpperCase(const s: String): String; assembler; overload;\r\nfunction LowerCase(const s: String): String; assembler; overload;\r\n\r\nfunction CompareStr(const s1, s2: String): Integer; assembler;\r\nfunction SameStr(const s1, s2: String): Boolean; assembler;\r\nfunction CompareText(const s1, s2: String): Integer; assembler;\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nfunction AnsiCompareText(const s1, s2: String): Integer; assembler;\r\nfunction AnsiSameText(const s1, s2: String): Boolean; assembler;\r\nfunction AnsiCompareStr(const s1, s2: String): Integer;\r\nprocedure AppendStr(var Dest: String; const S: string);\r\n\r\nfunction Format(const Fmt: String; const Args: array of JSValue): String;\r\n\r\nfunction BytesOf(const AVal: string): TBytes;\r\nfunction StringOf(const ABytes: TBytes): string;\r\n\r\n// JavaScript built-in functions\r\nfunction LocaleCompare(const s1, s2, locales: String): Boolean; assembler; overload;\r\nfunction NormalizeStr(const S: String; const Norm: String = 'NFC'): String; assembler; overload; // not in IE\r\n\r\nfunction IsValidIdent(const Ident: string; AllowDots: Boolean = False; StrictDots: Boolean = False): Boolean;\r\n\r\nType\r\n  TStringReplaceFlag = (rfReplaceAll, rfIgnoreCase);\r\n  TReplaceFlag = TStringReplaceFlag;\r\n  TStringReplaceFlags = set of TStringReplaceFlag;\r\n  TReplaceFlags = TStringReplaceFlags;\r\n\r\nfunction StringReplace(aOriginal, aSearch, aReplace: string; Flags: TStringReplaceFlags): String;\r\nfunction QuoteString(aOriginal: String; AQuote: Char): String;\r\nfunction QuotedStr(const s: string; QuoteChar: Char = ''''): string;\r\nfunction DeQuoteString(aQuoted: String; AQuote: Char): String;\r\nfunction IsDelimiter(const Delimiters, S: string; Index: Integer): Boolean;\r\nfunction AdjustLineBreaks(const S: string): string;\r\nfunction AdjustLineBreaks(const S: string; Style: TTextLineBreakStyle): string;\r\nfunction WrapText(const Line, BreakStr: string; const BreakChars: Array of char;  MaxCol: Integer): string;\r\nfunction WrapText(const Line: string; MaxCol: Integer): string;\r\n\r\n{ *****************************************************************************\r\n  Integer conversions\r\n  *****************************************************************************}\r\n\r\nfunction IntToStr(const Value: Integer): string;\r\nFunction TryStrToInt(const S : String; Out res : Integer) : Boolean;\r\nFunction TryStrToInt(const S : String; Out res : NativeInt) : Boolean;\r\nFunction StrToIntDef(const S : String; Const aDef : Integer) : Integer;\r\nFunction StrToIntDef(const S : String; Const aDef : NativeInt) : NativeInt;\r\nFunction StrToInt(const S : String) : Integer;\r\nFunction StrToNativeInt(const S : String) : NativeInt;\r\n// For compatibility\r\nFunction StrToInt64(const S : String) : NativeLargeInt;\r\nFunction StrToInt64Def(const S : String; ADefault : NativeLargeInt) : NativeLargeInt;\r\nFunction TryStrToInt64(const S : String; Out res : NativeLargeInt) : Boolean;\r\nFunction StrToQWord(const S : String) : NativeLargeUInt;\r\nFunction StrToQWordDef(const S : String; ADefault : NativeLargeUInt) : NativeLargeUInt;\r\nFunction TryStrToQWord(const S : String; Out res : NativeLargeUInt) : Boolean;\r\nFunction StrToUInt64(const S : String) : NativeLargeUInt;\r\nFunction StrToUInt64Def(const S : String; ADefault : NativeLargeUInt) : NativeLargeUInt;\r\nFunction TryStrToUInt64(const S : String; Out res : NativeLargeUInt) : Boolean;\r\nFunction StrToDWord(const S : String) : DWord;\r\nFunction StrToDWordDef(const S : String; ADefault : DWord) : DWord;\r\nFunction TryStrToDWord(const S : String; Out res : DWord) : Boolean;\r\n\r\nfunction IntToHex(Value: NativeInt; Digits: integer): string;\r\n\r\n{ *****************************************************************************\r\n  Float conversions\r\n  *****************************************************************************}\r\n\r\nconst\r\n  // Note: Currency is internally a double, multiplied by 10000 and truncated.\r\n  // The below values are the safe limits, within every step exists.\r\n  // Since currency is a double it can take much larger values, but the result\r\n  // may differ from Delphi/FPC\r\n  MaxCurrency: Currency =  450359962737.0495; // fpc: 922337203685477.5807;\r\n  MinCurrency: Currency = -450359962737.0496; // fpc: -922337203685477.5808;\r\n\r\nType\r\n  TFloatFormat = (ffFixed,ffGeneral,ffExponent,ffNumber,ffCurrency);\r\n\r\nFunction FloatToDecimal(Value : double; Precision, Decimals : integer) :  TFloatRec;\r\nFunction FloatToStr(Value: Double): String;\r\nFunction FloatToStrF(const Value : double; format: TFloatFormat; Precision, Digits: Integer): String;\r\nFunction TryStrToFloat(const S : String; Out res : Double) : Boolean; overload;\r\nFunction StrToFloatDef(const S : String; Const aDef : Double) : Double;\r\nFunction StrToFloat(const S : String) : Double;\r\nFunction FormatFloat (Fmt : String; aValue : Double) : String;\r\n\r\n{ *****************************************************************************\r\n  Boolean conversions\r\n  *****************************************************************************}\r\n\r\nVar\r\n  TrueBoolStrs, FalseBoolStrs : Array of String;\r\n\r\nfunction StrToBool(const S: String): Boolean;\r\nfunction BoolToStr(B: Boolean; UseBoolStrs:Boolean=False): string;\r\nfunction BoolToStr(B: Boolean; const TrueS, FalseS: String): string;\r\nfunction StrToBoolDef(const S: String; Default: Boolean): Boolean;\r\nfunction TryStrToBool(const S: String; out Value: Boolean): Boolean;\r\n\r\n\r\n{*****************************************************************************\r\n                              OS/Environment\r\n*****************************************************************************}\r\n\r\nConst\r\n  ConfigExtension : String = '.cfg';\r\n  SysConfigDir    : String = '';\r\n\r\ntype\r\n  TOnGetEnvironmentVariable = function(Const EnvVar: String): String;\r\n  TOnGetEnvironmentString = function(Index: Integer): String;\r\n  TOnGetEnvironmentVariableCount = function: Integer;\r\nvar\r\n  OnGetEnvironmentVariable: TOnGetEnvironmentVariable;\r\n  OnGetEnvironmentString: TOnGetEnvironmentString;\r\n  OnGetEnvironmentVariableCount: TOnGetEnvironmentVariableCount;\r\n\r\nfunction GetEnvironmentVariable(Const EnvVar: String): String;\r\nfunction GetEnvironmentVariableCount: Integer;\r\nfunction GetEnvironmentString(Index: Integer): String;\r\n\r\nprocedure ShowException(ExceptObject: TObject; ExceptAddr: Pointer);\r\nProcedure Abort;\r\n\r\n{*****************************************************************************\r\n                               Events\r\n*****************************************************************************}\r\nType\r\n  TEventType = (etCustom,etInfo,etWarning,etError,etDebug);\r\n  TEventTypes = Set of TEventType;\r\n\r\n{*****************************************************************************\r\n                            Date and time\r\n*****************************************************************************}\r\nType\r\n  \r\n  TSystemTime = record\r\n     Year, Month, Day, DayOfWeek: word;\r\n     Hour, Minute, Second, MilliSecond: word;\r\n  end ;\r\n  TTimeStamp = record\r\n     Time: longint;   { Number of milliseconds since midnight }\r\n     Date: longint;   { One plus number of days since 1/1/0001 }\r\n  end ;\r\n\r\n\r\nvar\r\n  TimeSeparator : char;\r\n  DateSeparator : char;\r\n  ShortDateFormat : string;\r\n  LongDateFormat : string;\r\n  ShortTimeFormat : string;\r\n  LongTimeFormat : string;\r\n  DecimalSeparator : string;\r\n  ThousandSeparator : string;\r\n  TimeAMString : string;\r\n  TimePMString : string;\r\n\r\nconst\r\n\r\n  HoursPerDay = 24;\r\n  MinsPerHour = 60;\r\n  SecsPerMin  = 60;\r\n  MSecsPerSec = 1000;\r\n  MinsPerDay  = HoursPerDay * MinsPerHour;\r\n  SecsPerDay  = MinsPerDay * SecsPerMin;\r\n  MSecsPerDay = SecsPerDay * MSecsPerSec;\r\n  MaxDateTime: TDateTime =  2958465.99999999;\r\n  MinDateTime: TDateTime =  -693593.99999999;\r\n\r\n  JulianEpoch = TDateTime(-2415018.5);\r\n  UnixEpoch = JulianEpoch + TDateTime(2440587.5);\r\n\r\n  DateDelta = 693594;        // Days between 1/1/0001 and 12/31/1899\r\n  UnixDateDelta = 25569;\r\n\r\n  { True=Leapyear }\r\n\r\nvar\r\n  MonthDays : array [Boolean] of TDayTable;\r\n  ShortMonthNames : TMonthNames;\r\n  LongMonthNames : TMonthNames;\r\n  ShortDayNames : TDayNames;\r\n  LongDayNames : TDayNames;\r\n\r\ntype\r\n  // Stub, for easier porting of FPC/Delphi code.\r\n  // Reading/Writing the properties will actually set the global variables\r\n\r\n  { TFormatSettings }\r\n\r\n  TFormatSettings = class(TObject)\r\n  private\r\n    function GetCurrencyDecimals: Byte;\r\n    function GetCurrencyFormat: Byte;\r\n    function GetCurrencyString: String;\r\n    function GetDateSeparator: char;\r\n    function GetDecimalSeparator: string;\r\n    function GetLongDateFormat: string;\r\n    function GetLongDayNames: TDayNames;\r\n    function GetLongMonthNames: TMonthNames;\r\n    function GetLongTimeFormat: string;\r\n    function GetNegCurrFormat: Byte;\r\n    function GetShortDateFormat: string;\r\n    function GetShortDayNames: TDayNames;\r\n    function GetShortMonthNames: TMonthNames;\r\n    function GetShortTimeFormat: string;\r\n    function GetThousandSeparator: string;\r\n    function GetTimeAMString: string;\r\n    function GetTimePMString: string;\r\n    function GetTimeSeparator: char;\r\n    procedure SetCurrencyFormat(AValue: Byte);\r\n    procedure SetCurrencyString(AValue: String);\r\n    procedure SetDateSeparator(const Value: char);\r\n    procedure SetDecimalSeparator(const Value: string);\r\n    procedure SetLongDateFormat(const Value: string);\r\n    procedure SetLongDayNames(AValue: TDayNames);\r\n    procedure SetLongMonthNames(AValue: TMonthNames);\r\n    procedure SetLongTimeFormat(const Value: string);\r\n    procedure SetNegCurrFormat(AValue: Byte);\r\n    procedure SetShortDateFormat(const Value: string);\r\n    procedure SetShortDayNames(AValue: TDayNames);\r\n    procedure SetShortMonthNames(AValue: TMonthNames);\r\n    procedure SetShortTimeFormat(const Value: string);\r\n    procedure SetCurrencyDecimals(AValue: Byte);\r\n    procedure SetThousandSeparator(const Value: string);\r\n    procedure SetTimeAMString(const Value: string);\r\n    procedure SetTimePMString(const Value: string);\r\n    procedure SetTimeSeparator(const Value: char);\r\n  public\r\n    class constructor Init;\r\n    Property ShortMonthNames : TMonthNames Read GetShortMonthNames Write SetShortMonthNames;\r\n    Property LongMonthNames : TMonthNames Read GetLongMonthNames Write SetLongMonthNames;\r\n    Property ShortDayNames : TDayNames Read GetShortDayNames Write SetShortDayNames;\r\n    Property LongDayNames : TDayNames Read GetLongDayNames Write SetLongDayNames;\r\n    property TimeSeparator : char read GetTimeSeparator write SetTimeSeparator;\r\n    property DateSeparator : char read GetDateSeparator write SetDateSeparator;\r\n    property ShortDateFormat : string read GetShortDateFormat write SetShortDateFormat;\r\n    property LongDateFormat : string read GetLongDateFormat write SetLongDateFormat;\r\n    property ShortTimeFormat : string read GetShortTimeFormat write SetShortTimeFormat;\r\n    property LongTimeFormat : string read GetLongTimeFormat write SetLongTimeFormat;\r\n    property DecimalSeparator : string read GetDecimalSeparator write SetDecimalSeparator;\r\n    property ThousandSeparator : string read GetThousandSeparator write SetThousandSeparator;\r\n    property TimeAMString : string read GetTimeAMString write SetTimeAMString;\r\n    property TimePMString : string read GetTimePMString write SetTimePMString;\r\n    Property CurrencyFormat : Byte read GetCurrencyFormat Write SetCurrencyFormat;\r\n    Property NegCurrFormat : Byte read GetNegCurrFormat Write SetNegCurrFormat;\r\n    Property CurrencyDecimals : Byte Read GetCurrencyDecimals Write SetCurrencyDecimals;\r\n    Property CurrencyString : String Read GetCurrencyString Write SetCurrencyString;\r\n  end;\r\n\r\nvar\r\n  FormatSettings: TFormatSettings;\r\n\r\n  TwoDigitYearCenturyWindow : word ;\r\n                             { Threshold to be subtracted from year before age-detection.}\r\n\r\n\r\nfunction DateTimeToJSDate(aDateTime : TDateTime) : TJSDate;\r\nfunction JSDateToDateTime(aDate : TJSDate) : TDateTime;\r\n\r\nfunction DateTimeToTimeStamp(DateTime: TDateTime): TTimeStamp;\r\nfunction TimeStampToDateTime(const TimeStamp: TTimeStamp): TDateTime;\r\nfunction MSecsToTimeStamp(MSecs: NativeInt): TTimeStamp;\r\nfunction TimeStampToMSecs(const TimeStamp: TTimeStamp): NativeInt;\r\nfunction TryEncodeDate(Year, Month, Day: Word; out Date: TDateTime): Boolean;\r\nfunction TryEncodeTime(Hour, Min, Sec, MSec: Word; out Time: TDateTime): Boolean;\r\nfunction EncodeDate(Year, Month, Day :word): TDateTime;\r\nfunction EncodeTime(Hour, Minute, Second, MilliSecond:word): TDateTime;\r\nfunction ComposeDateTime(Date,Time : TDateTime) : TDateTime;\r\nprocedure DecodeDate(Date: TDateTime; out Year, Month, Day: word);\r\nfunction DecodeDateFully(const DateTime: TDateTime; out Year, Month, Day, DOW: Word): Boolean;\r\nprocedure DecodeTime(Time: TDateTime; out Hour, Minute, Second, MilliSecond: word);\r\nprocedure DateTimeToSystemTime(DateTime: TDateTime; out SystemTime: TSystemTime);\r\nfunction SystemTimeToDateTime(const SystemTime: TSystemTime): TDateTime;\r\nfunction DayOfWeek(DateTime: TDateTime): integer;\r\nfunction Date: TDateTime;\r\nfunction Time: TDateTime;\r\nfunction Now: TDateTime;\r\nfunction IncMonth(const DateTime: TDateTime; NumberOfMonths: integer = 1 ): TDateTime;\r\nprocedure IncAMonth(var Year, Month, Day: Word; NumberOfMonths: Integer = 1);\r\nfunction IsLeapYear(Year: Word): boolean;\r\nfunction DateToStr(Date: TDateTime): string;\r\n// function DateToStr(Date: TDateTime; const FormatSettings: TFormatSettings): string;\r\nfunction TimeToStr(Time: TDateTime): string;\r\n// function TimeToStr(Time: TDateTime; const FormatSettings: TFormatSettings): string;\r\nfunction DateTimeToStr(DateTime: TDateTime; ForceTimeIfZero : Boolean = False): string;\r\n// function DateTimeToStr(DateTime: TDateTime; const FormatSettings: TFormatSettings; ForceTimeIfZero : Boolean = False): string;\r\nfunction StrToDate(const S: String): TDateTime;\r\nfunction StrToDate(const S: String; separator : char): TDateTime;\r\nfunction StrToDate(const S: String; const useformat : string; separator : char): TDateTime;\r\n//function StrToDate(const S: string; FormatSettings : TFormatSettings): TDateTime;\r\nfunction StrToTime(const S: String): TDateTime;\r\nfunction StrToTime(const S: String; separator : char): TDateTime;\r\n// function StrToTime(const S: string; FormatSettings : TFormatSettings): TDateTime;\r\nfunction StrToDateTime(const S: String): TDateTime;\r\n//function StrToDateTime(const s: ShortString; const FormatSettings : TFormatSettings): TDateTime;\r\nfunction FormatDateTime(const FormatStr: string; const DateTime: TDateTime): string;\r\n// function FormatDateTime(const FormatStr: string; DateTime: TDateTime; const FormatSettings: TFormatSettings; Options : TFormatDateTimeOptions = []): string;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime): Boolean;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; separator : char): Boolean;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; const useformat : string; separator : char): Boolean;\r\n// function TryStrToDate(const S: string; out Value: TDateTime; const FormatSettings: TFormatSettings): Boolean;\r\nfunction TryStrToTime(const S: String; out Value: TDateTime): Boolean;\r\nfunction TryStrToTime(const S: String; out Value: TDateTime; separator : char): Boolean;\r\nfunction TryStrToDateTime(const S: String; out Value: TDateTime): Boolean;\r\n// function TryStrToTime(const S: string; out Value: TDateTime; const FormatSettings: TFormatSettings): Boolean;\r\n// function TryStrToDateTime(const S: string; out Value: TDateTime; const FormatSettings: TFormatSettings): Boolean;\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nfunction StrToDateTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nfunction CurrentYear:Word;\r\nprocedure ReplaceTime(var dati: TDateTime; NewTime : TDateTime);\r\nprocedure ReplaceDate(var DateTime: TDateTime; const NewDate: TDateTime);\r\nFunction FloatToDateTime (Const Value : Extended) : TDateTime;\r\n\r\n{ *****************************************************************************\r\n  Currency support\r\n  *****************************************************************************}\r\n\r\nVar\r\n  CurrencyFormat : Byte = 0;\r\n  NegCurrFormat : Byte = 0;\r\n  CurrencyDecimals : Byte = 2;\r\n  CurrencyString : String = '$';\r\n\r\nFunction FloattoCurr (Const Value : Extended) : Currency;\r\nfunction TryFloatToCurr(const Value: Extended; var AResult: Currency): Boolean;\r\nFunction CurrToStr(Value: Currency): string;\r\n//Function CurrToStr(Value: Currency; Const FormatSettings: TFormatSettings): string;\r\nfunction StrToCurr(const S: string): Currency;\r\n//function StrToCurr(const S: string; Const FormatSettings: TFormatSettings): Currency;\r\nfunction TryStrToCurr(const S: string;Out Value : Currency): Boolean;\r\n//function TryStrToCurr(const S: string;Out Value : Currency; Const FormatSettings: TFormatSettings): Boolean;\r\nfunction StrToCurrDef(const S: string; Default : Currency): Currency;\r\n//function StrToCurrDef(const S: string; Default : Currency; Const FormatSettings: TFormatSettings): Currency;\r\n\r\n{*****************************************************************************\r\n                               File Paths\r\n*****************************************************************************}\r\ntype\r\n  PathStr = String;\r\n  TPathStrArray = Array of PathStr;\r\n\r\nfunction ChangeFileExt(const FileName, Extension: PathStr): PathStr;\r\nfunction ExtractFilePath(const FileName: PathStr): PathStr;\r\nfunction ExtractFileDrive(const FileName: PathStr): PathStr;\r\nfunction ExtractFileName(const FileName: PathStr): PathStr;\r\nfunction ExtractFileExt(const FileName: PathStr): PathStr;\r\nfunction ExtractFileDir(Const FileName : PathStr): PathStr;\r\nfunction ExtractRelativepath (Const BaseName,DestName : PathStr): PathStr;\r\nfunction IncludeTrailingPathDelimiter(Const Path : PathStr) : PathStr;\r\nfunction ExcludeTrailingPathDelimiter(Const Path: PathStr): PathStr;\r\nfunction IncludeLeadingPathDelimiter(Const Path : PathStr) : PathStr;\r\nfunction ExcludeLeadingPathDelimiter(Const Path: PathStr): PathStr;\r\nfunction IsPathDelimiter(Const Path: PathStr; Index: Integer): Boolean;\r\nFunction SetDirSeparators (Const FileName : PathStr) : PathStr;\r\nFunction GetDirs (DirName : PathStr) : TPathStrArray;\r\nfunction ConcatPaths(const Paths: array of PathStr): PathStr;\r\n\r\n\r\n{*****************************************************************************\r\n                               Interfaces\r\n*****************************************************************************}\r\n\r\nconst\r\n  GUID_NULL: TGuid = '{00000000-0000-0000-0000-000000000000}';\r\n\r\nfunction Supports(const Instance: IInterface; const AClass: TClass; out Obj): Boolean; overload;\r\nfunction Supports(const Instance: IInterface; const IID: TGuid; out Intf): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuid; out Intf): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuidString; out Intf): Boolean; overload;\r\n\r\nfunction Supports(const Instance: IInterface; const AClass: TClass): Boolean; overload;\r\nfunction Supports(const Instance: IInterface; const IID: TGuid): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuid): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuidString): Boolean; overload;\r\n\r\nfunction Supports(const AClass: TClass; const IID: TGuid): Boolean; overload;\r\nfunction Supports(const AClass: TClass; const IID: TGuidString): Boolean; overload;\r\n\r\nfunction TryStringToGUID(const s: string; out Guid: TGuid): Boolean;\r\nfunction StringToGUID(const S: string): TGuid;\r\nfunction GUIDToString(const guid: TGuid): string;\r\nfunction IsEqualGUID(const guid1, guid2: TGuid): Boolean;\r\nfunction GuidCase(const guid: TGuid; const List: array of TGuid): Integer;\r\nFunction CreateGUID(out GUID : TGUID) : Integer;\r\nfunction LastDelimiter(const Delimiters, S: string): Integer;\r\n\r\nimplementation\r\n\r\nfunction LastDelimiter(const Delimiters, S: string): Integer;\r\nbegin\r\n  Result := Length(S);\r\n  while Result > 0 do\r\n  begin\r\n    if (S[Result-1] <> #0) and (Pos(S[Result-1], Delimiters) > 0) then\r\n      Exit;\r\n    Dec(Result);\r\n  end;\r\nend;\r\n\r\nprocedure ShowException(ExceptObject: TObject; ExceptAddr: Pointer);\r\n\r\nVar\r\n  S : String;\r\n\r\nbegin\r\n  S:='Application raised an exception '+ExceptObject.ClassName;\r\n  if ExceptObject is Exception then\r\n    S:=S+' : '+Exception(ExceptObject).Message;\r\n{$IFDEF BROWSER}\r\n  asm\r\n    window.alert(S);\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF NODEJS}\r\n  Writeln(S);\r\n{$ENDIF}\r\n  if ExceptAddr=nil then;\r\nend;\r\n\r\nConst\r\n  SAbortError = 'Operation aborted';\r\n\r\nprocedure Abort;\r\nbegin\r\n  //Raise EAbort.Create(SAbortError);  cameron\r\nend;\r\n\r\nType\r\n  TCharSet = Set of Char;\r\nFunction CharInSet(Ch: Char;Const CSet : TCharSet) : Boolean;\r\n\r\nbegin\r\n  Result:=Ch in CSet;\r\nend;\r\n\r\nfunction CharInSet(Ch: Char; const CSet: array of char): Boolean;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  Result:=False;\r\n  I:=Length(CSet)-1;\r\n  While (Not Result) and (I>=0) do\r\n    begin\r\n    Result:=(Ch=CSet[i]);\r\n    Dec(I);\r\n    end;\r\nend;\r\n\r\nfunction LeftStr(const S: string; Count: Integer): String; assembler;\r\nasm\r\n  return (Count>0) ? S.substr(0,Count) : \"\";\r\nend;\r\n\r\nfunction RightStr(const S: string; Count: Integer): String; assembler;\r\nasm\r\n  var l = S.length;\r\n  return (Count<1) ? \"\" : ( Count>=l ? S : S.substr(l-Count));\r\nend;\r\n\r\nfunction Trim(const S: String): String; assembler;\r\nasm\r\n  return S.trim();\r\nend;\r\n\r\nfunction TrimLeft(const S: String): String; assembler;\r\nasm\r\n  return S.replace(/^[\\s\\uFEFF\\xA0\\x00-\\x1f]+/,'');\r\nend;\r\n\r\nfunction TrimRight(const S: String): String; assembler;\r\nasm\r\n  return S.replace(/[\\s\\uFEFF\\xA0\\x00-\\x1f]+$/,'');\r\nend;\r\n\r\nfunction IntToStr(const Value: Integer): string;\r\nbegin\r\n  Result:=str(Value);\r\nend;\r\n\r\nfunction FloatToDecimal(Value: double; Precision, Decimals: integer): TFloatRec;\r\n\r\nConst\r\n  Rounds = '123456789:';\r\n\r\nvar\r\n  Buffer: String;  //Though str func returns only 25 chars, this might change in the future\r\n  InfNan: string;\r\n  OutPos,Error, N, L, C: Integer;\r\n  GotNonZeroBeforeDot, BeforeDot : boolean;\r\n\r\nbegin\r\n  Result.Negative:=False;\r\n  Result.Exponent:=0;\r\n  For C:=0 to FloatRecDigits do\r\n    Result.Digits[C]:='0';\r\n  if Value=0 then\r\n    exit;\r\n  asm\r\n    Buffer=Value.toPrecision(21); // Double precision\r\n  end;\r\n  N := 1;\r\n  L := Length(Buffer);\r\n  while Buffer[N]=' ' do\r\n    Inc(N);\r\n  Result.Negative := (Buffer[N] = '-');\r\n  if Result.Negative then\r\n    Inc(N)\r\n  else if (Buffer[N] = '+') then\r\n    inc(N);\r\n  { special cases for Inf and Nan }\r\n  if (L>=N+2) then\r\n    begin\r\n      InfNan:=copy(Buffer,N,3);\r\n      if (InfNan='Inf') then\r\n        begin\r\n          Result.Digits[0]:=#0;\r\n          Result.Exponent:=32767;\r\n          exit\r\n        end;\r\n      if (InfNan='Nan') then\r\n        begin\r\n          Result.Digits[0]:=#0;\r\n          Result.Exponent:=-32768;\r\n          exit\r\n        end;\r\n    end;\r\n  //Start := N;  //Start of digits\r\n  Outpos:=0;\r\n  Result.Exponent := 0; BeforeDot := true;\r\n  GotNonZeroBeforeDot := false;\r\n  while (L>=N) and (Buffer[N]<>'E') do\r\n    begin\r\n      // Writeln('Examining : ',Buffer[N],'( output pos: ',outPos,')');\r\n      if Buffer[N]='.' then\r\n        BeforeDot := false\r\n      else\r\n        begin\r\n        if BeforeDot then\r\n          begin  // Currently this is always 1 char\r\n            Inc(Result.Exponent);\r\n            Result.Digits[Outpos] := Buffer[N];\r\n            if Buffer[N] <> '0' then\r\n              GotNonZeroBeforeDot := true;\r\n          end\r\n        else\r\n          Result.Digits[Outpos] := Buffer[N];\r\n        Inc(outpos);\r\n        end;\r\n      Inc(N);\r\n    end;\r\n  Inc(N); // Pass through 'E'\r\n  if N<=L then\r\n    begin\r\n      Val(Copy(Buffer, N, L-N+1), C, Error); // Get exponent after 'E'\r\n      Inc(Result.Exponent, C);\r\n    end;\r\n  // Calculate number of digits we have from str\r\n  N:=OutPos;\r\n//  Writeln('Number of digits: ',N,' requested precision : ',Precision);\r\n  L:=Length(Result.Digits);\r\n  While N<L do\r\n    begin\r\n    Result.Digits[N]:='0';  //Zero remaining space\r\n    Inc(N);\r\n    end;\r\n  if Decimals + Result.Exponent < Precision Then //After this it is the same as in FloatToDecimal\r\n    N := Decimals + Result.Exponent\r\n  Else\r\n    N := Precision;\r\n  if N >= L Then\r\n    N := L-1;\r\n//  Writeln('Rounding on digit : ',N);\r\n  if N = 0 Then\r\n    begin\r\n      if Result.Digits[0] >= '5' Then\r\n        begin\r\n          Result.Digits[0] := '1';\r\n          Result.Digits[1] := #0;\r\n          Inc(Result.Exponent);\r\n        end\r\n      Else\r\n        Result.Digits[0] := #0;\r\n    end  //N=0\r\n  Else if N > 0 Then\r\n    begin\r\n      if Result.Digits[N] >= '5' Then\r\n        begin\r\n          Repeat\r\n            Result.Digits[N] := #0;\r\n            Dec(N);\r\n            // Writeln(N,': ',Result.Digits[N],', Rounding to : ',Rounds[StrToInt(Result.Digits[N])]);\r\n            Result.Digits[N]:=Rounds[StrToInt(Result.Digits[N])+1];\r\n          Until (N = 0) Or (Result.Digits[N] < ':');\r\n          If Result.Digits[0] = ':' Then\r\n            begin\r\n              Result.Digits[0] := '1';\r\n              Inc(Result.Exponent);\r\n            end;\r\n        end\r\n      Else\r\n        begin\r\n          Result.Digits[N] := '0';\r\n          While (N > -1) And (Result.Digits[N] = '0') Do\r\n            begin\r\n              Result.Digits[N] := #0;\r\n              Dec(N);\r\n            end;\r\n        end;\r\n      end //N>0\r\n  Else\r\n    Result.Digits[0] := #0;\r\n  if (Result.Digits[0] = #0) and\r\n     not GotNonZeroBeforeDot then\r\n    begin\r\n      Result.Exponent := 0;\r\n      Result.Negative := False;\r\n    end;\r\nend;\r\n\r\n\r\nfunction FloatToStr(Value: Double): String;\r\nbegin\r\n  Result:=FloatToStrF(Value,ffGeneral,15,0);\r\nend;\r\n\r\nfunction TryStrToFloat(const S: String; out res: Double): Boolean;\r\n\r\nVar\r\n  J : JSValue;\r\n  N : String;\r\n\r\nbegin\r\n  N:=S;\r\n  // Delocalize\r\n  if (ThousandSeparator <>'') then\r\n    N:=StringReplace(N,ThousandSeparator,'',[rfReplaceAll]);\r\n  if (DecimalSeparator<>'.') then\r\n    N:=StringReplace(N,DecimalSeparator,'.',[]);\r\n  J:=parseFloat(N);\r\n  Result:=Not jsIsNaN(J);\r\n  if Result then\r\n    Res:=Double(J);\r\nend;\r\n\r\nfunction StrToFloatDef(const S: String; const aDef: Double): Double;\r\nbegin\r\n  if not TryStrToFloat(S,Result) then\r\n    Result:=aDef;\r\nend;\r\n\r\nfunction StrToFloat(const S: String): Double;\r\nbegin\r\n  if not TryStrToFloat(S,Result) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidFloat,[S]);\r\nend;\r\n\r\nfunction FormatFloat(Fmt: String; aValue: Double): String;\r\n\r\nType\r\n  TPosArray = Array of Integer;\r\n\r\nconst\r\n  MaxPrecision = 18;  // Extended precision\r\n\r\nvar\r\n  // Input in usable format\r\n  E : Extended;              // Value as extended.\r\n  FV: TFloatRec;             // Value as floatrec.\r\n  Section : String;          // Format can contain 3 sections, semicolon separated: Pos;Neg;Zero. This is the one to use.\r\n  SectionLength : Integer;   // Length of section.\r\n  // Calculated based on section. Static during output\r\n  ThousandSep: Boolean;      // Thousands separator detected in format ?\r\n  IsScientific: Boolean;     // Use Scientific notation ? (E detected in format)\r\n  DecimalPos: Integer;       // Position of decimal point in pattern.\r\n  FirstDigit: Integer;       // First actual digit in input (# or 0), relative to decimal point\r\n  LastDigit: Integer;        // Last required (0) digit, relative to decimal point\r\n  RequestedDigits: Integer;  // Number of requested digits, # and 0 alike\r\n  ExpSize : Integer;         // Number of digits in exponent\r\n  Available: Integer;        // Available digits in FV.\r\n  // These change during output loop\r\n  Current: Integer;          // Current digit in available digits\r\n  PadZeroes: Integer;        // Difference in requested digits before comma and exponent, needs to be padded with zeroes.\r\n  DistToDecimal: Integer;    // Place of current digit, relative to decimal point taking in account PadZeroes!\r\n\r\n  Procedure InitVars;\r\n\r\n  begin\r\n    E:=aValue;\r\n    Section:='';\r\n    SectionLength:=0;\r\n    ThousandSep:=false;\r\n    IsScientific:=false;\r\n    DecimalPos:=0;\r\n    FirstDigit:=MaxInt;\r\n    LastDigit:=0;\r\n    RequestedDigits:=0;\r\n    ExpSize:=0;\r\n    Available:=-1;\r\n  end;\r\n\r\n  procedure ToResult(const AChar: Char);\r\n  begin\r\n    Result:=Result+AChar;\r\n  end;\r\n\r\n  procedure AddToResult(const AStr: String);\r\n\r\n  begin\r\n    Result:=Result+AStr;\r\n  end;\r\n\r\n  procedure WriteDigit(ADigit: Char);\r\n\r\n  // Write a digit to result, prepend with decimalseparator or append with 1000 separator\r\n\r\n  begin\r\n    if ADigit=#0 then exit;\r\n    // Writeln('WriteDigit: ',ADigit,', DistToDecimal: ',DistToDecimal);\r\n    Dec(DistToDecimal);\r\n    // -1 -> we've arrived behind the decimal\r\n    if (DistToDecimal=-1) then\r\n      begin\r\n      AddToResult(DecimalSeparator);\r\n      ToResult(ADigit);\r\n      end\r\n    else\r\n      begin\r\n      // We're still before the decimal.\r\n      ToResult(ADigit);\r\n      if ThousandSep and ((DistToDecimal mod 3)=0) and (DistToDecimal>1) then\r\n        AddToResult(ThousandSeparator);\r\n      end;\r\n  end;\r\n\r\n  Function GetDigit : Char;\r\n\r\n  // Return next digit from available digits.\r\n  // May return #0 if none available.\r\n  // Will return '0' if applicable.\r\n\r\n  begin\r\n    // Writeln(' DistToDecimal <= LastDigit : ',DistToDecimal,' <  ',LastDigit,' have digit: ',Current<=Available, '(',Current,')');\r\n    Result:=#0;\r\n    if (Current<=Available) then\r\n      begin\r\n      Result:=FV.Digits[Current];\r\n      Inc(Current);\r\n      end\r\n    else if (DistToDecimal <= LastDigit) then\r\n      Dec(DistToDecimal)\r\n    else\r\n      Result:='0';\r\n    //  Writeln('GetDigit ->: ',Result);\r\n  end;\r\n\r\n  procedure CopyDigit;\r\n\r\n  // Copy a digit (#, 0) to the output with the correct value\r\n\r\n  begin\r\n    // Writeln('CopyDigit ');\r\n    if (PadZeroes=0) then\r\n      WriteDigit(GetDigit) // No shift needed, just copy what is available.\r\n    else if (PadZeroes<0) then\r\n      begin\r\n      // We must prepend zeroes\r\n      Inc(PadZeroes);\r\n      if (DistToDecimal<=FirstDigit) then\r\n        WriteDigit('0')\r\n      else\r\n        Dec(DistToDecimal);\r\n      end\r\n    else\r\n      begin\r\n      // We must append zeroes\r\n      while PadZeroes > 0 do\r\n        begin\r\n        WriteDigit(GetDigit);\r\n        Dec(PadZeroes);\r\n        end;\r\n      WriteDigit(GetDigit);\r\n      end;\r\n  end;\r\n\r\n  Function GetSections(Var SP : TPosArray) : Integer;\r\n\r\n  var\r\n    FL : Integer;\r\n    i : Integer;\r\n    C,Q : Char;\r\n    inQuote : Boolean;\r\n\r\n  begin\r\n    Result:=1;\r\n    SP[1]:=-1;\r\n    SP[2]:=-1;\r\n    SP[3]:=-1;\r\n    inQuote:=False;\r\n    Q:=#0;\r\n    I:=1;\r\n    FL:=Length(Fmt);\r\n    while (I<=FL) do\r\n      begin\r\n      C:=Fmt[I];\r\n      case C of\r\n      ';':\r\n        begin\r\n        if not InQuote then\r\n          begin\r\n          if Result>3 then\r\n            Raise Exception.Create('Invalid float format');\r\n          SP[Result]:=I+1;\r\n          Inc(Result);\r\n          end;\r\n        end;\r\n      '\"','''':\r\n        begin\r\n        if InQuote then\r\n          InQuote:=C<>Q\r\n        else\r\n          begin\r\n          InQuote:=True;\r\n          Q:=C;\r\n          end;\r\n        end;\r\n      end;\r\n      Inc(I);\r\n      end;\r\n    if SP[Result]=-1 then\r\n      SP[Result]:=FL+1;\r\n  end;\r\n\r\n  Procedure AnalyzeFormat;\r\n\r\n  var\r\n    I,Len: Integer;\r\n    Q,C: Char;\r\n    InQuote : Boolean;\r\n\r\n  begin\r\n    Len:=Length(Section);\r\n    I:=1;\r\n    InQuote:=False;\r\n    Q:=#0;\r\n    while (I<=Len) do\r\n      begin\r\n      C:=Section[i];\r\n      if C in ['\"',''''] then\r\n        begin\r\n        if InQuote then\r\n          InQuote:=C<>Q\r\n        else\r\n          begin\r\n          InQuote:=True;\r\n          Q:=C;\r\n          end;\r\n        end\r\n      else if not InQuote then\r\n        case C of\r\n        '.':\r\n          if (DecimalPos=0) then\r\n            DecimalPos:=RequestedDigits+1;\r\n        ',':\r\n            ThousandSep:=ThousandSeparator<>#0;\r\n        'e', 'E':\r\n            begin\r\n            Inc(I);\r\n            if (I<Len) then\r\n              begin\r\n              C:=Section[i];\r\n              IsScientific:=C in ['-','+'];\r\n              if IsScientific then\r\n                while (I<Len) and (Section[i+1]='0') do\r\n                  begin\r\n                  Inc(ExpSize);\r\n                  Inc(I);\r\n                  end;\r\n              if ExpSize>4 then\r\n                ExpSize:=4;\r\n              end;\r\n            end;\r\n        '#':\r\n            Inc(RequestedDigits);\r\n        '0':\r\n            begin\r\n            if RequestedDigits<FirstDigit then\r\n              FirstDigit:=RequestedDigits+1;\r\n            Inc(RequestedDigits);\r\n            LastDigit:=RequestedDigits+1;\r\n            end;\r\n        end;\r\n      Inc(I);\r\n      end;\r\n    if DecimalPos=0 then\r\n      DecimalPos:=RequestedDigits+1;\r\n    // Writeln('LastDigit: ',DecimalPos,'-',LastDigit);\r\n    LastDigit:=DecimalPos-LastDigit;\r\n    if LastDigit>0 then\r\n      LastDigit:=0;\r\n    // Writeln('FirstDigit: ',DecimalPos,'-',FirstDigit);\r\n    FirstDigit:=DecimalPos-FirstDigit;\r\n    if FirstDigit<0 then\r\n      FirstDigit:=0;\r\n  end;\r\n\r\n  Function ValueOutSideScope : Boolean;\r\n  begin\r\n    With FV do\r\n     Result:=((Exponent >= 18) and (not IsScientific)) or (Exponent = $7FF) or (Exponent = $800)\r\n  end;\r\n\r\n  Procedure CalcRunVars;\r\n\r\n  Var\r\n    D,P: Integer;\r\n\r\n  begin\r\n    if IsScientific then\r\n      begin\r\n      P:=RequestedDigits;\r\n      D:=9999;\r\n      end\r\n    else\r\n      begin\r\n      P:=MaxPrecision;\r\n      D:=RequestedDigits-DecimalPos+1;\r\n      end;\r\n    FV:=FloatToDecimal(aValue,P,D);\r\n    DistToDecimal:=DecimalPos-1;\r\n    if IsScientific then\r\n      PadZeroes:=0 // No padding.\r\n    else\r\n      begin\r\n      PadZeroes:=FV.Exponent-(DecimalPos-1);\r\n      if (PadZeroes>=0) then\r\n        DistToDecimal:=FV.Exponent\r\n      end;\r\n    // Writeln('PadZeroes : ',PadZeroes, ', DistToDecimal : ',DistToDecimal);\r\n    Available:=-1;\r\n    while (Available<High(FV.Digits)) and (FV.Digits[Available+1]<>#0) do\r\n      Inc(Available);\r\n    // Writeln('Available: ',Available);\r\n  end;\r\n\r\n  Function FormatExponent(ASign: Char; aExponent: Integer) : String;\r\n\r\n  begin\r\n    Result:=IntToStr(aExponent);\r\n    Result:=StringOfChar('0',ExpSize-Length(Result))+Result;\r\n    if (aExponent<0) then\r\n      Result:='-'+Result\r\n    else if (aExponent>0) and (aSign='+') then\r\n      Result:=aSign+Result;\r\n  end;\r\n\r\nvar\r\n  I,S : Integer;\r\n  C,Q : Char;\r\n  PA : TPosArray;\r\n  InLiteral : Boolean;\r\n\r\nbegin\r\n  SetLength(PA,4);\r\n  Result:='';\r\n  Initvars;\r\n  // What section to use ?\r\n  if (E>0) then\r\n    S:=1\r\n  else if (E<0) then\r\n    S:=2\r\n  else\r\n    S:=3;\r\n  PA[0]:=0;\r\n  I:=GetSections(PA);\r\n  if (I<S) or (PA[S]-PA[S-1]=0) then\r\n    S:=1;\r\n  // Extract correct section\r\n  SectionLength:=PA[S]-PA[S-1]-1;\r\n  Section:=Copy(Fmt,PA[S-1]+1,SectionLength);\r\n  SetLength(Section,SectionLength);\r\n  // Writeln('Section ',I,' : \"',Section,'\" ',SectionLength);\r\n  AnalyzeFormat;\r\n  // Writeln('RequestedDigits: ',RequestedDigits,', DecimalPos : ',DecimalPos,', LastDigit: ',LastDigit,', FirstDigit: ',FirstDigit);\r\n  CalcRunVars;\r\n  // If we cannot process value using current settings, fallback\r\n  if (SectionLength=0) or ValueOutSideScope then\r\n    begin\r\n    asm\r\n     Section=E.toPrecision(15);\r\n    end;\r\n    Result:=Section;\r\n    end;\r\n  // Get Started\r\n  I:=1;\r\n  Current:=0;\r\n  Q:=' ';\r\n  InLiteral:=False;\r\n  if (FV.Negative) and (S=1) then\r\n    ToResult('-');\r\n  while (I<=SectionLength) do\r\n    begin\r\n    C:=Section[i];\r\n    // Writeln('Analyzing pos ',I,': \"',C,'\"');\r\n    If (C in ['\"', '''']) then\r\n      begin\r\n      if InLiteral then\r\n        InLiteral:=C<>Q\r\n      else\r\n        begin\r\n        inLiteral:=True;\r\n        Q:=C;\r\n        end;\r\n      end\r\n    else if InLiteral then\r\n      ToResult(C)\r\n    else\r\n      case C of\r\n      '0', '#':\r\n        CopyDigit;\r\n      '.', ',':\r\n        ; // Do nothing, handled by CopyDigit\r\n      'e', 'E':\r\n        begin\r\n        ToResult(C); // Always needed\r\n        Inc(I);\r\n        if I<=Length(Section) then\r\n          begin\r\n          C:=Section[I];\r\n          if (C in ['+','-']) then\r\n            begin\r\n            AddToResult(FormatExponent(C,FV.Exponent-DecimalPos+1));\r\n            // Skip rest\r\n            while (I<SectionLength) and (Section[i+1]='0') do\r\n              Inc(I);\r\n            end;\r\n          end;\r\n        end;\r\n      else\r\n        ToResult(C);\r\n      end;\r\n    Inc(i);\r\n    end;\r\nend;\r\n\r\nfunction StrToBool(const S: String): Boolean;\r\nbegin\r\n  if not(TryStrToBool(S,Result)) then\r\n    raise EConvertError.CreateFmt(SInvalidBoolean,[S]);\r\nend;\r\n\r\nprocedure CheckBoolStrs;\r\nbegin\r\n  if Length(TrueBoolStrs)=0 then\r\n  begin\r\n    SetLength(TrueBoolStrs,1);\r\n    TrueBoolStrs[0]:='True';\r\n  end;\r\n  if Length(FalseBoolStrs)=0 then\r\n  begin\r\n    SetLength(FalseBoolStrs,1);\r\n    FalseBoolStrs[0]:='False';\r\n  end;\r\nend;\r\n\r\nfunction BoolToStr(B: Boolean; UseBoolStrs: Boolean): string;\r\nbegin\r\n  if UseBoolStrs Then\r\n  begin\r\n    CheckBoolStrs;\r\n    if B then\r\n      Result:=TrueBoolStrs[0]\r\n    else\r\n      Result:=FalseBoolStrs[0];\r\n  end else\r\n    if B then\r\n      Result:='-1'\r\n    else\r\n      Result:='0';\r\nend;\r\n\r\nfunction BoolToStr(B: Boolean; const TrueS, FalseS: String): string;\r\nbegin\r\n  if B then Result:=TrueS else Result:=FalseS;\r\nend;\r\n\r\nfunction StrToBoolDef(const S: String; Default: Boolean): Boolean;\r\nbegin\r\n  if not TryStrToBool(S,Result) then\r\n    Result:=Default;\r\nend;\r\n\r\nfunction TryStrToBool(const S: String; out Value: Boolean): Boolean;\r\nVar\r\n  Temp : String;\r\n  I    : Longint;\r\n  D : Double;\r\n  Code: integer;\r\nbegin\r\n  Temp:=uppercase(S);\r\n  Val(Temp,D,code);\r\n  Result:=true;\r\n  If Code=0 then\r\n    Value:=(D<>0.0)\r\n  else\r\n    begin\r\n      CheckBoolStrs;\r\n      for I:=low(TrueBoolStrs) to High(TrueBoolStrs) do\r\n        if Temp=uppercase(TrueBoolStrs[I]) then\r\n          begin\r\n            Value:=true;\r\n            exit;\r\n          end;\r\n      for I:=low(FalseBoolStrs) to High(FalseBoolStrs) do\r\n        if Temp=uppercase(FalseBoolStrs[I]) then\r\n          begin\r\n            Value:=false;\r\n            exit;\r\n          end;\r\n      Result:=false;\r\n    end;\r\nend;\r\n\r\nfunction UpperCase(const s: String): String; assembler;\r\nasm\r\n  return s.toUpperCase();\r\nend;\r\n\r\nfunction LowerCase(const s: String): String; assembler;\r\nasm\r\n  return s.toLowerCase();\r\nend;\r\n\r\nfunction CompareStr(const s1, s2: String): Integer; assembler;\r\nasm\r\n  var l1 = s1.length;\r\n  var l2 = s2.length;\r\n  if (l1<=l2){\r\n    var s = s2.substr(0,l1);\r\n    if (s1<s){ return -1;\r\n    } else if (s1>s){ return 1;\r\n    } else { return l1<l2 ? -1 : 0; };\r\n  } else {\r\n    var s = s1.substr(0,l2);\r\n    if (s<s2){ return -1;\r\n    } else { return 1; };\r\n  };\r\nend;\r\n\r\nfunction SameStr(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1 == s2;\r\nend;\r\n\r\nfunction CompareText(const s1, s2: String): Integer; assembler;\r\nasm\r\n  var l1 = s1.toLowerCase();\r\n  var l2 = s2.toLowerCase();\r\n  if (l1>l2){ return 1;\r\n  } else if (l1<l2){ return -1;\r\n  } else { return 0; }\r\nend;\r\n\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.toLowerCase() == s2.toLowerCase();\r\nend;\r\n\r\nfunction AnsiCompareText(const s1, s2: String): Integer; assembler;\r\nasm\r\n  return s1.localeCompare(s2);\r\nend;\r\n\r\nfunction AnsiSameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.localeCompare(s2) == 0;\r\nend;\r\n\r\nfunction AnsiCompareStr(const s1, s2: String): Integer;\r\nbegin\r\n  {$IFDEF ECMAScript6}\r\n  Result:=CompareText(TJSString(s1).normalize(),TJSString(s2).normalize());\r\n  {$ELSE}\r\n  Result:=CompareText(s1,s2);\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure AppendStr(var Dest: String; const S: string);\r\n\r\nbegin\r\n  Dest:=Dest+S;\r\nend;\r\n\r\n\r\nConst\r\n  feInvalidFormat   = 1;\r\n  feMissingArgument = 2;\r\n  feInvalidArgIndex = 3;\r\n\r\nProcedure DoFormatError (ErrCode : Longint;const fmt: String);\r\nbegin\r\n  //!! must be changed to contain format string...\r\n  Case ErrCode of\r\n   feInvalidFormat : raise EConvertError.Createfmt(SInvalidFormat,[Fmt]);\r\n   feMissingArgument : raise EConvertError.Createfmt(SArgumentMissing,[Fmt]);\r\n   feInvalidArgIndex : raise EConvertError.Createfmt(SInvalidArgIndex,[Fmt]);\r\n  end;\r\nend;\r\n\r\nConst\r\n  maxdigits = 15;\r\n\r\nFunction ReplaceDecimalSep(S: String; Const DS : string) : string;\r\n\r\nVar\r\n  P : Integer;\r\n\r\nbegin\r\n  P:=Pos('.',S);\r\n  if P>0 then\r\n    Result:=Copy(S,1,P-1)+DS+Copy(S,P+1,Length(S)-P)\r\n  else\r\n    Result:=S;\r\nend;\r\n\r\nfunction FormatGeneralFloat(Value : double; Precision : Integer; DS : String) : string;\r\n\r\nVar\r\n  P, PE, Q, Exponent: Integer;\r\n\r\nBegin\r\n  If (Precision = -1) Or (Precision > maxdigits) Then\r\n     Precision := maxdigits;\r\n  { First convert to scientific format, with correct precision }\r\n  Str(Value:precision+7, Result);\r\n  { Delete leading spaces }\r\n  Result:=TrimLeft(Result);\r\n  P:=Pos('.',Result);\r\n  if P=0 then\r\n    exit;\r\n   { Consider removing exponent }\r\n  PE:=Pos('E',Result);\r\n  if PE=0 then\r\n    begin\r\n    Result:=ReplaceDecimalSep(Result,DS);\r\n    exit;\r\n    end;\r\n  { Read exponent }\r\n  Q:=PE+2;\r\n  Exponent := 0;\r\n  while (Q <= Length(Result)) do\r\n    begin\r\n    Exponent := Exponent*10 + Ord(Result[Q])-Ord('0');\r\n    Inc(Q);\r\n    end;\r\n  if Result[PE+1] = '-' then\r\n    Exponent := -Exponent;\r\n  if (P+Exponent < PE) and (Exponent > -6) then\r\n    begin\r\n    { OK to remove exponent }\r\n    SetLength(Result,PE-1); { Trim exponent }\r\n    if Exponent >= 0 then\r\n      begin\r\n        { Shift point to right }\r\n      for Q := 0 to Exponent-1 do\r\n        begin\r\n        Result[P] := Result[P+1];\r\n        Inc(P);\r\n        end;\r\n      Result[P] := '.';\r\n      P := 1;\r\n      if Result[P] = '-' then\r\n        Inc(P);\r\n      while (Result[P] = '0') and (P < Length(Result)) and (Copy(Result,P+1,Length(DS))<>DS) do\r\n          { Trim leading zeros; conversion above should not give any, but occasionally does\r\n            because of rounding }\r\n          System.Delete(Result,P,1);\r\n      end\r\n    else\r\n      begin\r\n      { Add zeros at start }\r\n      Insert(Copy('00000',1,-Exponent),Result,P-1);\r\n      Result[P-Exponent] := Result[P-Exponent-1]; { Copy leading digit }\r\n      Result[P] := '.';\r\n      if Exponent <> -1 then\r\n        Result[P-Exponent-1] := '0';\r\n      end;\r\n    { Remove trailing zeros }\r\n    Q := Length(Result);\r\n    while (Q > 0) and (Result[Q] = '0') do\r\n      Dec(Q);\r\n    if Result[Q] = '.' then\r\n      Dec(Q); { Remove trailing decimal point }\r\n    if (Q = 0) or ((Q=1) and (Result[1] = '-')) then\r\n      Result := '0'\r\n    else\r\n      SetLength(Result,Q);\r\n    end\r\n  else\r\n    begin\r\n    { Need exponent, but remove superfluous characters }\r\n    { Delete trailing zeros }\r\n    while Result[PE-1] = '0' do\r\n      begin\r\n      System.Delete(Result,PE-1,1);\r\n      Dec(PE);\r\n      end;\r\n    { If number ends in decimal point, remove it }\r\n    if Result[PE-1] = DS then\r\n      begin\r\n      System.Delete(Result,PE-1,1);\r\n      Dec(PE);\r\n      end;\r\n    { delete superfluous + in exponent }\r\n    if Result[PE+1]='+' then\r\n      System.Delete(Result,PE+1,1)\r\n    else\r\n      Inc(PE);\r\n    while Result[PE+1] = '0' do\r\n      { Delete leading zeros in exponent }\r\n      System.Delete(Result,PE+1,1)\r\n    end;\r\n  Result:=ReplaceDecimalSep(Result,DS)\r\nend;\r\n\r\nfunction FormatExponentFloat(Value : double; Precision,Digits : Integer;DS : String) : string;\r\n\r\nVar\r\n  P: Integer;\r\nBegin\r\n  DS:=DecimalSeparator;\r\n  If (Precision = -1) Or (Precision > maxdigits) Then\r\n    Precision := maxdigits;\r\n  Str(Value:Precision+7, Result);\r\n  { Delete leading spaces }\r\n  while Result[1] = ' ' do\r\n    System.Delete(Result, 1, 1);\r\n  P:=Pos('E',Result);\r\n  if P=0 then\r\n    begin\r\n    Result:=ReplaceDecimalSep(Result,DS);\r\n    exit;\r\n    end;\r\n  Inc(P, 2);\r\n  if Digits > 4 then\r\n    Digits:=4;\r\n  Digits:=Length(Result) - P - Digits + 1;\r\n  if Digits < 0 then\r\n    insert(copy('0000',1,-Digits),Result,P)\r\n  else\r\n    while (Digits > 0) and (Result[P] = '0') do\r\n      begin\r\n      System.Delete(Result, P, 1);\r\n      if P > Length(Result) then\r\n        begin\r\n        System.Delete(Result, P - 2, 2);\r\n        break;\r\n        end;\r\n      Dec(Digits);\r\n      end;\r\n  Result:=ReplaceDecimalSep(Result,DS);\r\nEnd;\r\n\r\nfunction FormatFixedFloat(Value : double; Digits : Integer; DS : String) : string;\r\n\r\nBegin\r\n  If Digits = -1 Then\r\n    Digits := 2\r\n  Else If Digits > 18 Then\r\n    Digits := 18;\r\n  Str(Value:0:Digits, Result);\r\n  if (Result<>'') and (Result[1]=' ') then\r\n    Delete(Result,1,1);\r\n  Result:=ReplaceDecimalSep(Result,DS);\r\nend;\r\n\r\n\r\nfunction FormatNumberFloat(Value : double; Digits : Integer; DS,TS : String) : string;\r\n\r\nVar\r\n  P : integer;\r\n\r\nBegin\r\n  If Digits = -1 Then\r\n    Digits := 2\r\n  else If Digits > maxdigits Then\r\n    Digits := maxdigits;\r\n  Str(Value:0:Digits, Result);\r\n  if (Result<>'') and (Result[1]=' ') then\r\n    Delete(Result,1,1);\r\n  P:=Pos('.',Result);\r\n  Result:=ReplaceDecimalSep(Result,DS);\r\n  Dec(P,3);\r\n  if (TS<>'') and (TS<>#0) then\r\n    While (P>1) Do\r\n      Begin\r\n      If (Result[P-1] <> '-')  Then\r\n        Insert(TS, Result, P);\r\n      Dec(P, 3);\r\n      End;\r\nEnd;\r\n\r\nfunction RemoveLeadingNegativeSign(var AValue: String; DS : String): Boolean;\r\n\r\n// removes negative sign in case when result is zero eg. -0.00\r\n\r\nvar\r\n  i: PtrInt;\r\n  TS: String;\r\n  StartPos: PtrInt;\r\n\r\nbegin\r\n  Result:=False;\r\n  StartPos := 2;\r\n  TS := ThousandSeparator;\r\n  for i :=StartPos to length(AValue) do\r\n    begin\r\n    Result := (AValue[i] in ['0', DS, 'E', '+']) or (aValue[i]=TS);\r\n    if not Result then\r\n      break;\r\n    end;\r\n  if (Result) and (AValue[1]='-') then\r\n    Delete(AValue, 1, 1);\r\nend;\r\n\r\nFunction FormatNumberCurrency(const Value : Currency; Digits : Integer; DS,TS : String) : string;\r\n\r\nVar\r\n  Negative: Boolean;\r\n  P : Integer;\r\n\r\nBegin\r\n   If Digits = -1 Then\r\n     Digits := CurrencyDecimals\r\n   Else If Digits > 18 Then\r\n     Digits := 18;\r\n   Str(Value:0:Digits, Result);\r\n   Negative:=Result[1] = '-';\r\n   if Negative then\r\n     System.Delete(Result, 1, 1);\r\n   P := Pos('.', Result);\r\n   // Writeln('2. Result ',Result,' currencystring : ',CurrencyString);\r\n   If TS<>'' Then\r\n     begin\r\n     If P <> 0 Then\r\n       Result:=ReplaceDecimalSep(Result,DS)\r\n     else\r\n       P := Length(Result)+1;\r\n     Dec(P, 3);\r\n     While (P > 1) Do\r\n     Begin\r\n         Insert(TS, Result, P);\r\n     Dec(P, 3);\r\n     End;\r\n     end;\r\n   // Writeln('3. Result ',Result,' currencystring : ',CurrencyString);\r\n   if Negative then\r\n     RemoveLeadingNegativeSign(Result,DS);\r\n   // Writeln('4. Result ',Result,' currencystring : ',CurrencyString);\r\n   // Writeln('CurrencyFormat:  ',CurrencyFormat,'NegcurrencyFormat: ',NegCurrFormat);\r\n   If Not Negative Then\r\n     Case CurrencyFormat Of\r\n       0: Result := CurrencyString + Result;\r\n       1: Result := Result + CurrencyString;\r\n       2: Result := CurrencyString + ' ' + Result;\r\n       3: Result := Result + ' ' + CurrencyString;\r\n     end\r\n   else\r\n     Case NegCurrFormat Of\r\n       0: Result := '(' + CurrencyString + Result + ')';\r\n       1: Result := '-' + CurrencyString + Result;\r\n       2: Result := CurrencyString + '-' + Result;\r\n       3: Result := CurrencyString + Result + '-';\r\n       4: Result := '(' + Result + CurrencyString + ')';\r\n       5: Result := '-' + Result + CurrencyString;\r\n       6: Result := Result + '-' + CurrencyString;\r\n       7: Result := Result + CurrencyString + '-';\r\n       8: Result := '-' + Result + ' ' + CurrencyString;\r\n       9: Result := '-' + CurrencyString + ' ' + Result;\r\n       10: Result := Result + ' ' + CurrencyString + '-';\r\n       11: Result := CurrencyString + ' ' + Result + '-';\r\n       12: Result := CurrencyString + ' ' + '-' + Result;\r\n       13: Result := Result + '-' + ' ' + CurrencyString;\r\n       14: Result := '(' + CurrencyString + ' ' + Result + ')';\r\n       15: Result := '(' + Result + ' ' + CurrencyString + ')';\r\n     end;\r\nend;\r\n\r\nfunction FloatToStrF(const Value: double; format: TFloatFormat; Precision,\r\n  Digits: Integer): String;\r\n\r\nVar\r\n  DS: string;\r\n\r\nBegin\r\n  DS:=DecimalSeparator;\r\n  Case format Of\r\n    ffGeneral:\r\n      Result:=FormatGeneralFloat(Value,Precision,DS);\r\n    ffExponent:\r\n      Result:=FormatExponentFloat(Value,Precision,Digits,DS);\r\n    ffFixed:\r\n      Result:=FormatFixedFloat(Value,Digits,DS);\r\n    ffNumber:\r\n      Result:=FormatNumberFloat(Value,Digits,DS,ThousandSeparator);\r\n    ffCurrency:\r\n     Result:=FormatNumberCurrency(Value,Digits,DS,ThousandSeparator);\r\n  end;\r\n  if (Format<>ffCurrency) and (length(Result)>1) and (Result[1]='-') then\r\n    RemoveLeadingNegativeSign(Result,DS);\r\nend;\r\n\r\nfunction Format(const Fmt: String; const Args: array of JSValue): String;\r\n\r\nVar ChPos,OldPos,ArgPos,DoArg,Len : SizeInt;\r\n    Hs,ToAdd : String;\r\n    Index : SizeInt;\r\n    Width,Prec : Longint;\r\n    Left : Boolean;\r\n    Fchar : char;\r\n    vq : nativeint;\r\n\r\n  {\r\n    ReadFormat reads the format string. It returns the type character in\r\n    uppercase, and sets index, Width, Prec to their correct values,\r\n    or -1 if not set. It sets Left to true if left alignment was requested.\r\n    In case of an error, DoFormatError is called.\r\n  }\r\n\r\n  Function ReadFormat : Char;\r\n\r\n  Var Value : NativeInt;\r\n\r\n    Procedure ReadInteger;\r\n\r\n    var\r\n      Code: integer;\r\n      ArgN: SizeInt;\r\n    begin\r\n      If Value<>-1 then exit; // Was already read.\r\n      OldPos:=ChPos;\r\n      While (ChPos<=Len) and\r\n            (Fmt[ChPos]<='9') and (Fmt[ChPos]>='0') do inc(ChPos);\r\n      If ChPos>len then\r\n        DoFormatError(feInvalidFormat,Fmt);\r\n      If Fmt[ChPos]='*' then\r\n        begin\r\n\r\n        if Index=-1 then\r\n          ArgN:=Argpos\r\n        else\r\n        begin\r\n          ArgN:=Index;\r\n          Inc(Index);\r\n        end;\r\n\r\n        If (ChPos>OldPos) or (ArgN>High(Args)) then\r\n          DoFormatError(feInvalidFormat,Fmt);\r\n\r\n        ArgPos:=ArgN+1;\r\n\r\n        if IsNumber(Args[ArgN]) and IsInteger(Args[ArgN]) then\r\n          Value:=Integer(Args[ArgN])\r\n        else\r\n          DoFormatError(feInvalidFormat,Fmt);\r\n        Inc(ChPos);\r\n        end\r\n      else\r\n        begin\r\n        If (OldPos<ChPos) Then\r\n          begin\r\n          Val (Copy(Fmt,OldPos,ChPos-OldPos),value,code);\r\n          // This should never happen !!\r\n          If Code>0 then DoFormatError (feInvalidFormat,Fmt);\r\n          end\r\n        else\r\n          Value:=-1;\r\n        end;\r\n    end;\r\n\r\n    Procedure ReadIndex;\r\n\r\n    begin\r\n      If Fmt[ChPos]<>':' then\r\n        ReadInteger\r\n      else\r\n        value:=0; // Delphi undocumented behaviour, assume 0, #11099\r\n      If Fmt[ChPos]=':' then\r\n        begin\r\n        If Value=-1 then DoFormatError(feMissingArgument,Fmt);\r\n        Index:=Value;\r\n        Value:=-1;\r\n        Inc(ChPos);\r\n        end;\r\n    end;\r\n\r\n    Procedure ReadLeft;\r\n\r\n    begin\r\n      If Fmt[ChPos]='-' then\r\n        begin\r\n        left:=True;\r\n        Inc(ChPos);\r\n        end\r\n      else\r\n        Left:=False;\r\n    end;\r\n\r\n    Procedure ReadWidth;\r\n\r\n    begin\r\n      ReadInteger;\r\n      If Value<>-1 then\r\n        begin\r\n        Width:=Value;\r\n        Value:=-1;\r\n        end;\r\n    end;\r\n\r\n    Procedure ReadPrec;\r\n\r\n    begin\r\n      If Fmt[ChPos]='.' then\r\n        begin\r\n        inc(ChPos);\r\n          ReadInteger;\r\n        If Value=-1 then\r\n         Value:=0;\r\n        prec:=Value;\r\n        end;\r\n    end;\r\n\r\n\r\n  begin\r\n    Index:=-1;\r\n    Width:=-1;\r\n    Prec:=-1;\r\n    Value:=-1;\r\n    inc(ChPos);\r\n    If Fmt[ChPos]='%' then\r\n      begin\r\n      Result:='%';\r\n      exit;                           // VP fix\r\n      end;\r\n    ReadIndex;\r\n    ReadLeft;\r\n    ReadWidth;\r\n    ReadPrec;\r\n    Result:=Upcase(Fmt[ChPos]);\r\n  end;\r\n\r\n\r\n  function Checkarg (AT : TJSValueType; err:boolean):boolean;\r\n  {\r\n    Check if argument INDEX is of correct type (AT)\r\n    If Index=-1, ArgPos is used, and argpos is augmented with 1\r\n    DoArg is set to the argument that must be used.\r\n  }\r\n  begin\r\n    result:=false;\r\n    if Index=-1 then\r\n      DoArg:=Argpos\r\n    else\r\n      DoArg:=Index;\r\n    ArgPos:=DoArg+1;\r\n    If (Doarg>High(Args)) or (GetValueTYpe(Args[Doarg])<>AT) then\r\n     begin\r\n       if err then\r\n        DoFormatError(feInvalidArgindex,Fmt);\r\n       dec(ArgPos);\r\n       exit;\r\n     end;\r\n    result:=true;\r\n  end;\r\n\r\nbegin\r\n  Result:='';\r\n  Len:=Length(Fmt);\r\n  ChPos:=1;\r\n  OldPos:=1;\r\n  ArgPos:=0;\r\n  While ChPos<=len do\r\n    begin\r\n    While (ChPos<=Len) and (Fmt[ChPos]<>'%') do\r\n      inc(ChPos);\r\n    If ChPos>OldPos Then\r\n      Result:=Result+Copy(Fmt,OldPos,ChPos-Oldpos);\r\n    If ChPos<Len then\r\n      begin\r\n      FChar:=ReadFormat;\r\n{$ifdef fmtdebug}\r\n      DumpFormat(FCHar);\r\n{$endif}\r\n      Case FChar of\r\n        'D' : begin\r\n              Checkarg(jvtinteger,true);\r\n              toAdd:=IntToStr(NativeInt(Args[DoArg]));\r\n              Width:=Abs(width);\r\n              Index:=Prec-Length(ToAdd);\r\n              If ToAdd[1]<>'-' then\r\n                ToAdd:=StringOfChar('0',Index)+ToAdd\r\n              else\r\n                // + 1 to accomodate for - sign in length !!\r\n                Insert(StringOfChar('0',Index+1),toadd,2);\r\n              end;\r\n        'U' : begin\r\n              Checkarg(jvtinteger,True);\r\n              if NativeInt(Args[Doarg])<0 then\r\n                DoFormatError(feInvalidArgindex,Fmt);\r\n              Toadd:=IntToStr(NativeInt(Args[Doarg]));\r\n              Width:=Abs(width);\r\n              Index:=Prec-Length(ToAdd);\r\n              ToAdd:=StringOfChar('0',Index)+ToAdd\r\n              end;\r\n        'E' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffFixed,9999,Prec);\r\n              end;\r\n        'F' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffFixed,9999,Prec);\r\n              end;\r\n        'G' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffGeneral,Prec,3);\r\n              end;\r\n        'N' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffNumber,9999,Prec);\r\n              end;\r\n        'M' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffCurrency,9999,Prec);\r\n              end;\r\n        'S' : begin\r\n              CheckArg(jvtString,true);\r\n              hs:=String(Args[doarg]);\r\n              Index:=Length(hs);\r\n              If (Prec<>-1) and (Index>Prec) then\r\n                Index:=Prec;\r\n              ToAdd:=Copy(hs,1,Index);\r\n              end;\r\n        'P' : Begin\r\n              CheckArg(jvtInteger,true);\r\n              ToAdd:=IntToHex(NativeInt(Args[DoArg]),31);\r\n              end;\r\n        'X' : begin\r\n              Checkarg(jvtinteger,true);\r\n              vq:=nativeInt(Args[Doarg]);\r\n              index:=31; // May need to adjust to NativeInt\r\n              If Prec>index then\r\n                ToAdd:=IntToHex(vq,index)\r\n              else\r\n                begin\r\n                // determine minimum needed number of hex digits.\r\n                Index:=1;\r\n                While (NativeInt(1) shl (Index*4)<=vq) and (index<16) do\r\n                  inc(Index);\r\n                If Index>Prec then\r\n                  Prec:=Index;\r\n                ToAdd:=IntToHex(vq,Prec);\r\n                end;\r\n              end;\r\n        '%': ToAdd:='%';\r\n      end;\r\n      If Width<>-1 then\r\n        If Length(ToAdd)<Width then\r\n          If not Left then\r\n            ToAdd:=StringOfChar(' ',Width-Length(ToAdd))+ToAdd\r\n          else\r\n            ToAdd:=ToAdd+StringOfChar(' ',Width-Length(ToAdd));\r\n      Result:=Result+ToAdd;\r\n      end;\r\n    inc(ChPos);\r\n    Oldpos:=ChPos;\r\n    end;\r\nend;\r\n\r\nfunction BytesOf(const AVal: string): TBytes;\r\nvar\r\n  I: SizeUInt;\r\nbegin\r\n  SetLength(Result, Length(AVal));\r\n  for I := 0 to Length(AVal)-1 do\r\n    Result[I] := Ord(AVal[I+1]);\r\nend;\r\n\r\nfunction StringOf(const ABytes: TBytes): string;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result:='';\r\n  for I := 0 to Length(ABytes)-1 do\r\n    Result:=Result+Char(ABytes[I]);\r\nend;\r\n\r\nfunction LocaleCompare(const s1, s2, locales: String): Boolean; assembler;\r\nasm\r\n  return s1.localeCompare(s2,locales) == 0;\r\nend;\r\n\r\nfunction NormalizeStr(const S: String; const Norm: String): String; assembler;\r\nasm\r\n  return S.normalize(Norm);\r\nend;\r\n\r\nfunction IsValidIdent(const Ident: string; AllowDots: Boolean = False; StrictDots: Boolean = False): Boolean;\r\nconst\r\n  Alpha = ['A'..'Z', 'a'..'z', '_'];\r\n  AlphaNum = Alpha + ['0'..'9'];\r\n  Dot = '.';\r\nvar\r\n  First: Boolean;\r\n  I, Len: Integer;\r\nbegin\r\n  Len := Length(Ident);\r\n  if Len < 1 then\r\n    Exit(False);\r\n  First := True;\r\n  Result:=false;\r\n  I:=1;\r\n  While I<=len do\r\n    begin\r\n    if First then\r\n    begin\r\n      if not (Ident[I] in Alpha) then exit;\r\n      First := False;\r\n    end\r\n    else if AllowDots and (Ident[I] = Dot) then\r\n    begin\r\n      if StrictDots then\r\n      begin\r\n        if I >= Len then exit;\r\n        First := True;\r\n      end;\r\n    end\r\n    else\r\n      if not (Ident[I] in AlphaNum) then exit;\r\n    I:=I+1;\r\n    end;\r\n  Result:=true;\r\nend;\r\n\r\nprocedure FreeAndNil(var Obj);\r\nvar\r\n  o: TObject;\r\nbegin\r\n  o:=TObject(Obj);\r\n  if o=nil then exit;\r\n  TObject(Obj):=nil;\r\n  o.Destroy;\r\nend;\r\n\r\n{ EVariantError }\r\n\r\nconstructor EVariantError.CreateCode(Code: Longint);\r\nbegin\r\n  ErrCode:=Code;\r\nend;\r\n\r\n{ Exception }\r\n\r\nconstructor Exception.Create(const Msg: String);\r\nbegin\r\n  fMessage:=Msg;\r\n  {$ifdef nodejs}\r\n  FNodeJSError:=TJSError.new;\r\n  {$endif}\r\nend;\r\n\r\nconstructor Exception.CreateFmt(const Msg: string; const Args: array of jsvalue\r\n  );\r\nbegin\r\n  //writeln('Exception.CreateFmt START ',ClassName,' \"',Msg,'\" Args=',Args);\r\n  Create(Format(Msg,Args));\r\n  //writeln('Exception.CreateFmt END ',ClassName,' \"',Msg,'\" fMessage=',fMessage);\r\nend;\r\n\r\nconstructor Exception.CreateHelp(const Msg: String; AHelpContext: Integer);\r\nbegin\r\n  Create(Msg);\r\n  fHelpContext:=AHelpContext;\r\nend;\r\n\r\nconstructor Exception.CreateFmtHelp(const Msg: string;\r\n  const Args: array of jsvalue; AHelpContext: Integer);\r\nbegin\r\n  Create(Format(Msg,Args));\r\n  fHelpContext:=AHelpContext;\r\nend;\r\n\r\nfunction Exception.ToString: String;\r\nbegin\r\n  Result:=ClassName+': '+Message;\r\nend;\r\n\r\nConst\r\n  RESpecials = '([\\+\\[\\]\\(\\)\\\\\\.\\*])';\r\n\r\nfunction StringReplace(aOriginal, aSearch, aReplace: string;\r\n  Flags: TStringReplaceFlags): String;\r\nvar\r\n  REFlags : String;\r\n  REString : String;\r\nbegin\r\n  REFlags:='';\r\n  if rfReplaceAll in flags then\r\n    ReFlags := 'g';\r\n  if rfIgnoreCase in flags then\r\n    ReFlags := ReFlags+'i';\r\n\r\n  REString := TJSString(aSearch).replace(TJSRegexp.new(RESpecials,'g'),'\\$1');\r\n  Result := TJSString(aOriginal).replace(TJSRegexp.new(REString,REFlags),aReplace);\r\nend;\r\n\r\nfunction QuoteString(aOriginal: String; AQuote: Char): String;\r\n\r\nbegin\r\n  Result:=AQuote+StringReplace(aOriginal,aQuote,aQuote+aQuote,[rfReplaceAll])+AQuote;\r\nend;\r\n\r\nfunction QuotedStr(const s: string; QuoteChar : Char = ''''): string;\r\n\r\nbegin\r\n  Result:=QuoteString(S,QuoteChar);\r\nend;\r\n\r\nfunction DeQuoteString(aQuoted: String; AQuote: Char): String;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Result:=aQuoted;\r\n  if TJSString(Result).substr(0,1)<>AQuote then exit;\r\n  Result:=TJSString(Result).slice(1);\r\n  i:=1;\r\n  while i<=length(Result) do\r\n    begin\r\n    if Result[i]=AQuote then\r\n      begin\r\n      if (i=length(Result)) or (Result[i+1]<>AQuote) then\r\n        begin\r\n        Result:=TJSString(Result).slice(0,i-1);\r\n        exit;\r\n        end\r\n      else\r\n        Result:=TJSString(Result).slice(0,i-1)+TJSString(Result).slice(i);\r\n      end\r\n    else\r\n      inc(i);\r\n    end;\r\nend;\r\n\r\nfunction IsDelimiter(const Delimiters, S: string; Index: Integer): Boolean;\r\nbegin\r\n  Result:=False;\r\n  if (Index>0) and (Index<=Length(S)) then\r\n    Result:=Pos(S[Index],Delimiters)<>0; // Note we don't do MBCS yet\r\nend;\r\n\r\nfunction AdjustLineBreaks(const S: string): string;\r\n\r\nbegin\r\n  Result:=AdjustLineBreaks(S,DefaultTextLineBreakStyle);\r\nend;\r\n\r\nfunction AdjustLineBreaks(const S: string; Style: TTextLineBreakStyle): string;\r\n\r\nvar\r\n  I,L: Longint;\r\n  Res : String;\r\n\r\n  Procedure Add(C  : Char);\r\n  begin\r\n    Res:=Res+C;\r\n  end;\r\n\r\nbegin\r\n  I:=0;\r\n  L:=Length(S);\r\n  Result:='';\r\n  While (I<=L) do\r\n    case S[I] of\r\n      #10: begin\r\n          if Style in [tlbsCRLF,tlbsCR] then\r\n            Add(#13);\r\n          if Style=tlbsCRLF then\r\n            Add(#10);\r\n          Inc(I);\r\n          end;\r\n     #13: begin\r\n          if Style=tlbsCRLF then\r\n            Add(#13);\r\n          Add(#10);\r\n          Inc(I);\r\n          if S[I]=#10 then\r\n            Inc(I);\r\n          end;\r\n    else\r\n      Add(S[i]);\r\n      Inc(I);\r\n    end;\r\n  Result:=Res;\r\nend;\r\n\r\nfunction WrapText(const Line, BreakStr: string;\r\n  const BreakChars: array of char; MaxCol: Integer): string;\r\n\r\nconst\r\n  Quotes = ['''', '\"'];\r\n\r\nVar\r\n  L : String;\r\n  C,LQ,BC : Char;\r\n  P,BLen,Len : Integer;\r\n  HB,IBC : Boolean;\r\n\r\nbegin\r\n  Result:='';\r\n  L:=Line;\r\n  Blen:=Length(BreakStr);\r\n  If (BLen>0) then\r\n    BC:=BreakStr[1]\r\n  else\r\n    BC:=#0;\r\n  Len:=Length(L);\r\n  While (Len>0) do\r\n    begin\r\n    P:=1;\r\n    LQ:=#0;\r\n    HB:=False;\r\n    IBC:=False;\r\n    While ((P<=Len) and ((P<=MaxCol) or not IBC)) and ((LQ<>#0) or Not HB) do\r\n      begin\r\n      C:=L[P];\r\n      If (C=LQ) then\r\n        LQ:=#0\r\n      else If (C in Quotes) then\r\n        LQ:=C;\r\n      If (LQ<>#0) then\r\n        Inc(P)\r\n      else\r\n        begin\r\n        HB:=((C=BC) and (BreakStr=Copy(L,P,BLen)));\r\n        If HB then\r\n          Inc(P,Blen)\r\n        else\r\n          begin\r\n          If (P>=MaxCol) then\r\n            IBC:=CharInSet(C,BreakChars);\r\n          Inc(P);\r\n          end;\r\n        end;\r\n//      Writeln('\"',C,'\" : IBC : ',IBC,' HB  : ',HB,' LQ  : ',LQ,' P>MaxCol : ',P>MaxCol);\r\n      end;\r\n    Result:=Result+Copy(L,1,P-1);\r\n    Delete(L,1,P-1);\r\n    Len:=Length(L);\r\n    If (Len>0) and Not HB then\r\n      Result:=Result+BreakStr;\r\n    end;\r\nend;\r\n\r\nfunction WrapText(const Line: string; MaxCol: Integer): string;\r\n\r\nbegin\r\n  Result:=WrapText(Line,sLineBreak, [' ', '-', #9], MaxCol);\r\nend;\r\n\r\n\r\nfunction GetEnvironmentVariable(const EnvVar: String): String;\r\nbegin\r\n  if Assigned(OnGetEnvironmentVariable) then\r\n    Result:=OnGetEnvironmentVariable(EnvVar)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction GetEnvironmentVariableCount: Integer;\r\nbegin\r\n  if Assigned(OnGetEnvironmentVariableCount) then\r\n    Result:=OnGetEnvironmentVariableCount()\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction GetEnvironmentString(Index: Integer): String;\r\nbegin\r\n  if Assigned(OnGetEnvironmentString) then\r\n    Result:=OnGetEnvironmentString(Index)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n{ Date/Time routines}\r\n\r\nFunction DoEncodeDate(Year, Month, Day: Word): longint;\r\n\r\nVar\r\n  D : TDateTime;\r\n\r\nbegin\r\n  If TryEncodeDate(Year,Month,Day,D) then\r\n    Result:=Trunc(D)\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction DoEncodeTime(Hour, Minute, Second, MilliSecond: word): TDateTime;\r\n\r\nbegin\r\n  If not TryEncodeTime(Hour,Minute,Second,MilliSecond,Result) then\r\n    Result:=0;\r\nend;\r\n\r\nfunction DateTimeToJSDate(aDateTime: TDateTime): TJSDate;\r\n\r\nVar\r\n  Y,M,D,h,n,s,z : Word;\r\n\r\nbegin\r\n  DecodeDate(Trunc(aDateTime),Y,M,D);\r\n  DecodeTime(Frac(aDateTime),H,N,S,Z);\r\n  Result:=TJSDate.New(Y,M-1,D,h,n,s,z);\r\nend;\r\n\r\nfunction JSDateToDateTime(aDate: TJSDate): TDateTime;\r\n\r\nbegin\r\n  Result:=EncodeDate(ADate.FullYear,ADate.Month+1,ADate.Date) +\r\n          EncodeTime(ADate.Hours,ADate.Minutes,ADate.Seconds,ADate.Milliseconds);\r\nend;\r\n\r\n\r\n{   ComposeDateTime converts a Date and a Time into one TDateTime   }\r\nfunction ComposeDateTime(Date,Time : TDateTime) : TDateTime;\r\n\r\nbegin\r\n  if Date < 0 then\r\n    Result := trunc(Date) - Abs(frac(Time))\r\n  else\r\n    Result := trunc(Date) + Abs(frac(Time));\r\nend;\r\n\r\nfunction TryEncodeDate(Year, Month, Day: Word; out Date: TDateTime): Boolean;\r\n\r\nvar\r\n  c, ya: LongWord;\r\nbegin\r\n  Result:=(Year>0) and (Year<10000) and\r\n          (Month >= 1) and (Month<=12) and\r\n          (Day>0) and (Day<=MonthDays[IsleapYear(Year),Month]);\r\n If Result then\r\n   begin\r\n     if month > 2 then\r\n      Dec(Month,3)\r\n     else\r\n      begin\r\n        Inc(Month,9);\r\n        Dec(Year);\r\n      end;\r\n     c:= Year DIV 100;\r\n     ya:= Year - 100*c;\r\n     Date := (146097*c) SHR 2 + (1461*ya) SHR 2 + (153*LongWord(Month)+2) DIV 5 + LongWord(Day);\r\n     // Note that this line can't be part of the line above, since TDateTime is\r\n     // signed and c and ya are not\r\n     Date := Date - 693900;\r\n   end\r\nend;\r\n\r\nfunction TryEncodeTime(Hour, Min, Sec, MSec: Word; out Time: TDateTime\r\n  ): Boolean;\r\n\r\nbegin\r\n  Result:=(Hour<24) and (Min<60) and (Sec<60) and (MSec<1000);\r\n  If Result then\r\n    Time:=TDateTime(LongWord(Hour)*3600000+LongWord(Min)*60000+LongWord(Sec)*1000+MSec)/MSecsPerDay;\r\nend;\r\n\r\n{   EncodeDate packs three variables Year, Month and Day into a\r\n    TDateTime value the result is the number of days since 12/30/1899   }\r\n\r\nfunction EncodeDate(Year, Month, Day: word): TDateTime;\r\n\r\nbegin\r\n  If Not TryEncodeDate(Year,Month,Day,Result) then\r\n    Raise EConvertError.CreateFmt('%s-%s-%s is not a valid date specification',\r\n                              [IntToStr(Year),IntToStr(Month),IntToStr(Day)]);\r\nend;\r\n\r\n{   EncodeTime packs four variables Hour, Minute, Second and MilliSecond into\r\n    a TDateTime value     }\r\n\r\nfunction EncodeTime(Hour, Minute, Second, MilliSecond:word):TDateTime;\r\n\r\nbegin\r\n  If not TryEncodeTime(Hour,Minute,Second,MilliSecond,Result) then\r\n    Raise EConvertError.CreateFmt('%s:%s:%s.%s is not a valid time specification',\r\n                              [IntToStr(Hour),IntToStr(Minute),IntToStr(Second),IntToStr(MilliSecond)]);\r\nend;\r\n\r\n\r\n{   DecodeDate unpacks the value Date into three values:\r\n    Year, Month and Day   }\r\n\r\nprocedure DecodeDate(Date: TDateTime; out Year, Month, Day: word);\r\nvar\r\n  ly,ld,lm,j : LongWord;\r\nbegin\r\n  if Date <= -datedelta then  // If Date is before 1-1-1 then return 0-0-0\r\n    begin\r\n    Year := 0;\r\n    Month := 0;\r\n    Day := 0;\r\n    end\r\n  else\r\n    begin\r\n    if Date>0 then\r\n      Date:=(Date+(1/(msecsperday*2)))\r\n    else\r\n      Date:=Date-(1/(msecsperday*2));\r\n    if Date>MaxDateTime then\r\n      Date:=MaxDateTime;\r\n//       Raise EConvertError.CreateFmt('%f is not a valid TDatetime encoding, maximum value is %f.',[Date,MaxDateTime]);\r\n    j := ((Trunc(Date) + 693900) SHL 2)-1;\r\n    ly:= j DIV 146097;\r\n    j:= j - 146097 * LongWord(ly);\r\n    ld := j SHR 2;\r\n    j:=(ld SHL 2 + 3) DIV 1461;\r\n    ld:= ((ld SHL 2) + 7 - 1461*j) SHR 2;\r\n    lm:=(5 * ld-3) DIV 153;\r\n    ld:= (5 * ld +2 - 153*lm) DIV 5;\r\n    ly:= 100 * LongWord(ly) + j;\r\n    if lm < 10 then\r\n     inc(lm,3)\r\n    else\r\n      begin\r\n        dec(lm,9);\r\n        inc(ly);\r\n      end;\r\n    year:=ly;\r\n    month:=lm;\r\n    day:=ld;\r\n    end;\r\nend;\r\n\r\n\r\nfunction DecodeDateFully(const DateTime: TDateTime; out Year, Month, Day, DOW: Word): Boolean;\r\nbegin\r\n  DecodeDate(DateTime,Year,Month,Day);\r\n  DOW:=DayOfWeek(DateTime);\r\n  Result:=IsLeapYear(Year);\r\nend;\r\n  {   DateTimeToTimeStamp converts DateTime to a TTimeStamp   }\r\n\r\nfunction DateTimeToTimeStamp(DateTime: TDateTime): TTimeStamp;\r\n\r\nVar\r\n  D : Double;\r\nbegin\r\n  D:=DateTime * Double(MSecsPerDay);\r\n  if D<0 then\r\n    D:=D-0.5\r\n  else\r\n    D:=D+0.5;\r\n  result.Time := Trunc(Abs(Trunc(D)) Mod MSecsPerDay);\r\n  result.Date := DateDelta + (Trunc(D) div MSecsPerDay);\r\nend;\r\n\r\n{   TimeStampToDateTime converts TimeStamp to a TDateTime value   }\r\n\r\nfunction TimeStampToDateTime(const TimeStamp: TTimeStamp): TDateTime;\r\nbegin\r\n  Result := ComposeDateTime(TimeStamp.Date - DateDelta,TimeStamp.Time/MSecsPerDay)\r\nend;\r\n\r\n{   MSecsToTimeStamp   }\r\n\r\nfunction MSecsToTimeStamp(MSecs: NativeInt): TTimeStamp;\r\nbegin\r\n  result.Date := Trunc(msecs/msecsperday);\r\n  msecs:= msecs-NativeInt(result.date)*msecsperday;\r\n  result.Time := Round(MSecs);\r\nend;\r\n\r\nfunction TimeStampToMSecs(const TimeStamp: TTimeStamp): NativeInt;\r\nbegin\r\n  result := TimeStamp.Time + (timestamp.date*msecsperday);\r\nend ;\r\n\r\n\r\n\r\n{   DecodeTime unpacks Time into four values:\r\n    Hour, Minute, Second and MilliSecond    }\r\n\r\nprocedure DecodeTime(Time: TDateTime; out Hour, Minute, Second, MilliSecond: word);\r\nVar\r\n  l : LongWord;\r\nbegin\r\n  l := DateTimeToTimeStamp(Time).Time;\r\n  Hour   := l div 3600000;\r\n  l := l mod 3600000;\r\n  Minute := l div 60000;\r\n  l := l mod 60000;\r\n  Second := l div 1000;\r\n  l := l mod 1000;\r\n  MilliSecond := l;\r\nend;\r\n\r\n{   DateTimeToSystemTime converts DateTime value to SystemTime   }\r\n\r\nprocedure DateTimeToSystemTime(DateTime: TDateTime; out SystemTime: TSystemTime);\r\nbegin\r\n  DecodeDateFully(DateTime, SystemTime.Year, SystemTime.Month, SystemTime.Day,SystemTime.DayOfWeek);\r\n  DecodeTime(DateTime, SystemTime.Hour, SystemTime.Minute, SystemTime.Second, SystemTime.MilliSecond);\r\n  Dec(SystemTime.DayOfWeek);\r\nend ;\r\n\r\n{   SystemTimeToDateTime converts SystemTime to a TDateTime value   }\r\n\r\nfunction SystemTimeToDateTime(const SystemTime: TSystemTime): TDateTime;\r\nbegin\r\n  result := ComposeDateTime(DoEncodeDate(SystemTime.Year, SystemTime.Month, SystemTime.Day),\r\n                            DoEncodeTime(SystemTime.Hour, SystemTime.Minute, SystemTime.Second, SystemTime.MilliSecond));\r\nend ;\r\n\r\nfunction DayOfWeek(DateTime: TDateTime): integer;\r\nbegin\r\n  Result := 1 + ((Trunc(DateTime) - 1) mod 7);\r\n  If (Result<=0) then\r\n    Inc(Result,7);\r\nend;\r\n\r\n\r\n\r\nfunction Now: TDateTime;\r\nbegin\r\n  Result:=JSDateToDateTime(TJSDate.New());\r\nend;\r\n\r\nfunction Date: TDateTime;\r\n\r\nbegin\r\n  Result:=Trunc(Now);\r\nend;\r\n\r\nfunction Time: TDateTime;\r\nbegin\r\n  Result:=Now-Date;\r\nend ;\r\n\r\n{   IncMonth increments DateTime with NumberOfMonths months,\r\n    NumberOfMonths can be less than zero   }\r\n\r\nfunction IncMonth(const DateTime: TDateTime; NumberOfMonths: integer = 1 ): TDateTime;\r\nvar\r\n  Year, Month, Day : word;\r\nbegin\r\n  DecodeDate(DateTime, Year, Month, Day);\r\n  IncAMonth(Year, Month, Day, NumberOfMonths);\r\n  result := ComposeDateTime(DoEncodeDate(Year, Month, Day), DateTime);\r\nend ;\r\n\r\n{   IncAMonth is the same as IncMonth, but operates on decoded date  }\r\n\r\nprocedure IncAMonth(var Year, Month, Day: Word; NumberOfMonths: Integer = 1);\r\nvar\r\n  TempMonth, S: Integer;\r\nbegin\r\n  If NumberOfMonths>=0 then\r\n  begin\r\n    s:=1;\r\n    inc(Year,(NumberOfMonths div 12));\r\n  end\r\n  else\r\n  begin\r\n    s:=-1;\r\n    dec(Year,(Abs(NumberOfMonths) div 12));\r\n  end;\r\n\r\n  TempMonth:=Month+(NumberOfMonths mod 12)-1;\r\n  if (TempMonth>11) or\r\n     (TempMonth<0) then\r\n   begin\r\n     Dec(TempMonth, S*12);\r\n     Inc(Year, S);\r\n   end;\r\n  Month:=TempMonth+1;          {   Months from 1 to 12   }\r\n  If (Day>MonthDays[IsLeapYear(Year)][Month]) then\r\n    Day:=MonthDays[IsLeapYear(Year)][Month];\r\nend;\r\n\r\n{  IsLeapYear returns true if Year is a leap year   }\r\n\r\nfunction IsLeapYear(Year: Word): boolean;\r\nbegin\r\n  Result := (Year mod 4 = 0) and ((Year mod 100 <> 0) or (Year mod 400 = 0));\r\nend;\r\n\r\n{  DateToStr returns a string representation of Date using ShortDateFormat   }\r\n\r\nfunction DateToStr(Date: TDateTime): string;\r\nbegin\r\n  Result:=FormatDateTime('ddddd', Date);\r\nend ;\r\n\r\n{  TimeToStr returns a string representation of Time using LongTimeFormat   }\r\n\r\nfunction TimeToStr(Time: TDateTime): string;\r\nbegin\r\n  Result:=FormatDateTime('tt',Time);\r\nend ;\r\n\r\n{   DateTimeToStr returns a string representation of DateTime using LongDateTimeFormat   }\r\n\r\nVar\r\n  DateTimeToStrFormat : Array[Boolean] of string = ('c','f');\r\n\r\nfunction DateTimeToStr(DateTime: TDateTime; ForceTimeIfZero : Boolean = False): string;\r\nbegin\r\n  Result:=FormatDateTime(DateTimeToStrFormat[ForceTimeIfZero], DateTime)\r\nend ;\r\n\r\n\r\n{   StrToDate converts the string S to a TDateTime value\r\n    if S does not represent a valid date value\r\n    an EConvertError will be raised   }\r\n\r\nfunction IntStrToDate(Out ErrorMsg : String; const S: String; const useformat : string; separator : char): TDateTime;\r\n\r\nConst\r\n  WhiteSpace = ' '#8#9#10#12#13;\r\n  Digits = '0123456789';\r\n\r\n  procedure FixErrorMsg(const errmarg : String);\r\n\r\n  begin\r\n    ErrorMsg:=Format(SInvalidDateFormat,[errmarg]);\r\n  end;\r\n\r\nvar\r\n   df:string;\r\n   d,m,y,ly,ld,lm:word;\r\n   n,i,len:longint;\r\n   c: integer;\r\n   dp,mp,yp,which : Byte;\r\n   s1:string;\r\n   values: array of integer;\r\n   YearMoreThenTwoDigits : boolean;\r\n\r\nbegin\r\n  SetLength(values,4);\r\n  Result:=0;\r\n  Len:=Length(S);\r\n  ErrorMsg:='';\r\n  While (Len>0) and (Pos(S[Len],WhiteSpace)>0) do\r\n    Dec(len);\r\n  if (Len=0) then\r\n    begin\r\n    FixErrorMsg(S);\r\n    exit;\r\n    end;\r\n  YearMoreThenTwoDigits := False;\r\n  if separator = #0 then\r\n    if (DateSeparator<>#0) then\r\n      separator := DateSeparator\r\n    else\r\n      separator:='-';\r\n  // Writeln('Separator: ',Separator);\r\n  df := UpperCase(useFormat);\r\n  { Determine order of D,M,Y }\r\n  yp:=0;\r\n  mp:=0;\r\n  dp:=0;\r\n  Which:=0;\r\n  i:=0;\r\n  while (i<Length(df)) and (Which<3) do\r\n   begin\r\n     inc(i);\r\n     Case df[i] of\r\n       'Y' :\r\n         if yp=0 then\r\n          begin\r\n            Inc(Which);\r\n            yp:=which;\r\n          end;\r\n       'M' :\r\n         if mp=0 then\r\n          begin\r\n            Inc(Which);\r\n            mp:=which;\r\n          end;\r\n       'D' :\r\n         if dp=0 then\r\n          begin\r\n            Inc(Which);\r\n            dp:=which;\r\n          end;\r\n     end;\r\n   end;\r\n  // Writeln('YP: ',Yp,', MP: ',Mp,', DP: ',DP);\r\n  for i := 1 to 3 do\r\n    values[i] := 0;\r\n  s1 := '';\r\n  n := 0;\r\n  for i := 1 to len do\r\n     begin\r\n     if Pos(s[i],Digits)>0 then\r\n       s1 := s1 + s[i];\r\n     { space can be part of the shortdateformat, and is defaultly in slovak\r\n       windows, therefor it shouldn't be taken as separator (unless so specified)\r\n       and ignored }\r\n     if (Separator <> ' ') and (s[i] = ' ') then\r\n       Continue;\r\n     if (s[i] = separator) or ((i = len) and (Pos(s[i],Digits)>0)) then\r\n      begin\r\n        inc(n);\r\n        if n>3 then\r\n          begin\r\n//            Writeln('More than 3 separators');\r\n            FixErrorMsg(S);\r\n            exit;\r\n          end;\r\n         // Check if the year has more then two digits (if n=yp, then we are evaluating the year.)\r\n        if (n=yp) and (length(s1)>2) then YearMoreThenTwoDigits := True;\r\n        val(s1, values[n], c);\r\n        if c<>0 then\r\n          begin\r\n//            Writeln('S1 not a number ',S1);\r\n            FixErrorMsg(s);\r\n            Exit;\r\n          end;\r\n        s1 := '';\r\n      end\r\n     else if (Pos(s[i],Digits)=0) then\r\n       begin\r\n//       Writeln('Not a number at pos ',I,' ',S[i]);\r\n       FixErrorMsg(s);\r\n       Exit;\r\n       end;\r\n   end ;\r\n//   Writeln('Which : ',Which,' N : ',N);\r\n   if (Which<3) and (N>Which) then\r\n    begin\r\n    FixErrorMsg(s);\r\n    Exit;\r\n    end;\r\n  // Fill in values.\r\n  DecodeDate(Date,Ly,LM,LD);\r\n  If N=3 then\r\n   begin\r\n     y:=values[yp];\r\n     m:=values[mp];\r\n     d:=values[dp];\r\n   end\r\n  Else\r\n  begin\r\n    Y:=ly;\r\n    If n<2 then\r\n     begin\r\n       d:=values[1];\r\n       m := LM;\r\n     end\r\n    else\r\n     If dp<mp then\r\n      begin\r\n        d:=values[1];\r\n        m:=values[2];\r\n      end\r\n    else\r\n      begin\r\n        d:=values[2];\r\n        m:=values[1];\r\n      end;\r\n  end;\r\n  if (y >= 0) and (y < 100) and not YearMoreThenTwoDigits then\r\n    begin\r\n    ly := ly - TwoDigitYearCenturyWindow;\r\n    Inc(Y, ly div 100 * 100);\r\n    if (TwoDigitYearCenturyWindow > 0) and (Y < ly) then\r\n      Inc(Y, 100);\r\n    end;\r\n  if not TryEncodeDate(y, m, d, result) then\r\n    errormsg:=SErrInvalidDate;\r\nend;\r\n\r\nfunction StrToDate(const S: String; const useformat : string; separator : char): TDateTime;\r\nVar\r\n  MSg : String;\r\nbegin\r\n  Result:=IntStrToDate(Msg,S,useFormat,Separator);\r\n  If (Msg<>'') then\r\n    Raise EConvertError.Create(Msg);\r\nend;\r\n\r\nfunction StrToDate(const S: String; separator : char): TDateTime;\r\nbegin\r\n    result := StrToDate(S,ShortDateFormat,separator)\r\nend;\r\n\r\nfunction StrToDate(const S: String): TDateTime;\r\nbegin\r\n  result := StrToDate(S,ShortDateFormat,#0);\r\nend;\r\n\r\n{   StrToTime converts the string S to a TDateTime value\r\n    if S does not represent a valid time value an\r\n    EConvertError will be raised   }\r\n\r\n\r\nfunction IntStrToTime(Out ErrorMsg : String; const S: String; Len : integer; separator : char): TDateTime;\r\n\r\nconst\r\n  AMPM_None = 0;\r\n  AMPM_AM = 1;\r\n  AMPM_PM = 2;\r\n  tiHour = 0;\r\n  tiMin = 1;\r\n  tiSec = 2;\r\n  tiMSec = 3;\r\n\r\ntype\r\n  TTimeValues = array of Word;\r\n\r\nvar\r\n   AmPm: integer;\r\n   TimeValues: TTimeValues;\r\n\r\n\r\n   function SplitElements(out TimeValues: TTimeValues; out AmPm: Integer): Boolean;\r\n   //Strict version. It does not allow #32 as Separator, it will treat it as whitespace always\r\n   const\r\n     Digits = '0123456789';\r\n   var\r\n      Cur, Offset, ElemLen, Err, TimeIndex, FirstSignificantDigit: Integer;\r\n      Value: Integer;\r\n      DigitPending, MSecPending: Boolean;\r\n      AmPmStr: String;\r\n      CurChar: Char;\r\n      I : Integer;\r\n      allowedchars : string;\r\n\r\n   begin\r\n     Result := False;\r\n     AmPm := AMPM_None; //No Am or PM in string found yet\r\n     MSecPending := False;\r\n     TimeIndex := 0; //indicating which TTimeValue must be filled next\r\n     For I:=tiHour to tiMSec do\r\n      TimeValues[i]:=0;\r\n     Cur := 1;\r\n     //skip leading blanks\r\n     While (Cur < Len) and (S[Cur] =#32) do Inc(Cur);\r\n     Offset := Cur;\r\n     //First non-blank cannot be Separator or DecimalSeparator\r\n     if (Cur > Len - 1) or (S[Cur] = Separator) or (S[Cur] = Decimalseparator) then\r\n       begin\r\n       // Writeln('Error in sep S[Cur]',S[Cur],' ',separator,' ',GetDecimalSeparator);\r\n       Exit;\r\n       end;\r\n     DigitPending := (Pos(S[Cur],Digits)>0);\r\n     While (Cur <= Len) do\r\n     begin\r\n       //writeln;\r\n       // writeln('Main While loop:  Cur = ',Cur,' S[Cur] = \"',S[Cur],'\" Len = ',Len,' separator : ',Separator);\r\n       CurChar := S[Cur];\r\n       if Pos(CurChar,Digits)>0 then\r\n       begin//Digits\r\n         //HH, MM, SS, or Msec?\r\n         // writeln('Digit: ', CurChar);\r\n         //Digits are only allowed after starting Am/PM or at beginning of string or after Separator\r\n         //and TimeIndex must be <= tiMSec\r\n         //Uncomment \"or (#32 = Separator)\" and it will allllow #32 as separator\r\n         if (not (DigitPending {or (#32 = Separator)})) or (TimeIndex > tiMSec) then\r\n            begin\r\n            // Writeln('DigitPending',ElemLen);\r\n            Exit;\r\n            end;\r\n         OffSet := Cur;\r\n         if (CurChar <> '0') then FirstSignificantDigit := OffSet else FirstSignificantDigit := -1;\r\n         while (Cur < Len) and (Pos(S[Cur + 1],Digits)>0) do\r\n         begin\r\n           //Mark first Digit that is not '0'\r\n           if (FirstSignificantDigit = -1) and (S[Cur] <> '0') then FirstSignificantDigit := Cur;\r\n           Inc(Cur);\r\n         end;\r\n         if (FirstSignificantDigit = -1) then FirstSignificantDigit := Cur;\r\n         ElemLen := 1+ Cur - FirstSignificantDigit;\r\n         // writeln('  S[FirstSignificantDigit] = ',S[FirstSignificantDigit], ' S[Cur] = ',S[Cur],' ElemLen = ',ElemLen,' -> ', S[Offset], ElemLen);\r\n         // writeln('  Cur = ',Cur);\r\n         //this way we know that Val() will never overflow Value !\r\n         if (ElemLen <= 2) or ((ElemLen <= 3) and (TimeIndex = tiMSec) ) then\r\n         begin\r\n           Val(Copy(S,FirstSignificantDigit, ElemLen), Value, Err);\r\n           // writeln('  Value = ',Value,' HH = ',TimeValues[0],' MM = ',TimeValues[1],' SS = ',TimeValues[2],' MSec = ',Timevalues[3]);\r\n           //This is safe now, because we know Value < High(Word)\r\n           TimeValues[TimeIndex] := Value;\r\n           Inc(TimeIndex);\r\n           DigitPending := False;\r\n         end\r\n         else\r\n           begin\r\n           // Writeln('Wrong elemlen: ',ElemLen, ' timeIndex: ',timeindex);\r\n           Exit; //Value to big, so it must be a wrong timestring\r\n           end;\r\n       end//Digits\r\n       else if (CurChar = #32) then\r\n       begin\r\n         //writeln('#32');\r\n         //just skip, but we must adress this, or it will be parsed by either AM/PM or Separator\r\n       end\r\n       else if (CurChar = Separator) then\r\n       begin\r\n         // writeln('Separator ',Separator);\r\n         if DigitPending or (TimeIndex > tiSec) then\r\n           begin\r\n           // Writeln ('DigitPending ',DigitPending,' or (TimeIndex',Timeindex,' > tiSec,', tiSec,')');\r\n           Exit;\r\n           end;\r\n         DigitPending := True;\r\n         MSecPending := False;\r\n       end\r\n       else if (CurChar = DecimalSeparator) then\r\n       begin\r\n         //writeln('DecimalSeparator');\r\n         if DigitPending or MSecPending or (TimeIndex <> tiMSec) then\r\n            begin\r\n            // Writeln('DigitPending ',DigitPending,' or MSecPending ',MSecPending,' (',TimeIndex,',Timeindex, >', tiMSec,'  tiSec)');\r\n            Exit;\r\n            end;\r\n         DigitPending := True;\r\n         MSecPending := True;\r\n       end\r\n       else\r\n       begin//AM/PM?\r\n         //None of the above, so this char _must_ be the start of AM/PM string\r\n         //If we already have found AM/PM or we expect a digit then then timestring must be wrong at this point\r\n         //writeln('AM/PM?');\r\n         if (AmPm <> AMPM_None) or DigitPending then\r\n           begin\r\n           // Writeln('AmPm <> AMPM_None) or DigitPending');\r\n           Exit;\r\n           end;\r\n         OffSet := Cur;\r\n         allowedchars:=DecimalSeparator+' ';\r\n         if Separator<>#0 then\r\n           allowedchars:=allowedchars+Separator;\r\n         while (Cur < Len -1) and (Pos(S[Cur + 1],AllowedChars)=0)\r\n           and (Pos(S[Cur + 1],Digits)=0) do Inc(Cur);\r\n         ElemLen := 1 + Cur - OffSet;\r\n         // writeln('  S[Offset] = ',S[1+Offset], ' S[Cur] = ',S[Cur],' ElemLen = ',ElemLen,' -> ', S[1+Offset], ElemLen);\r\n         // writeln('  Cur = ',Cur, 'S =',S);\r\n         AmPmStr := Copy(S,1+OffSet, ElemLen);\r\n\r\n         // writeln('AmPmStr = ',ampmstr,' (',length(ampmstr),')');\r\n         //We must compare to TimeAMString before hardcoded 'AM' for delphi compatibility\r\n         //Also it is perfectly legal, though insane to have TimeAMString = 'PM' and vice versa\r\n         if (CompareText(AmPmStr, TimeAMString) = 0) then AmPm := AMPM_AM\r\n         else if (CompareText(AmPmStr, TimePMString) = 0) then AmPm := AMPM_PM\r\n         else if (CompareText(AmPmStr, 'AM') = 0) then AmPm := AMPM_AM\r\n         else if (CompareText(AmPmStr, 'PM') = 0) then AmPm := AMPM_PM\r\n         else\r\n           begin\r\n           // Writeln('No timestring ',AmPmStr);\r\n           Exit; //If text does not match any of these, timestring must be wrong;\r\n           end;\r\n         //if AM/PM is at beginning of string, then a digit is mandatory after it\r\n         if (TimeIndex = tiHour) then\r\n         begin\r\n           DigitPending := True;\r\n         end\r\n         //otherwise, no more TimeValues allowed after this\r\n         else\r\n         begin\r\n           TimeIndex := tiMSec + 1;\r\n           DigitPending := False;\r\n         end;\r\n       end;//AM/PM\r\n       Inc(Cur)\r\n     end;//while\r\n\r\n     //If we arrive here, parsing the elements has been successfull\r\n     //if not at least Hours specified then input is not valid\r\n     //when am/pm is specified Hour must be <= 12 and not 0\r\n     if (TimeIndex = tiHour) or ((AmPm <> AMPM_None) and ((TimeValues[tiHour] > 12) or (TimeValues[tiHour] = 0))) or DigitPending then\r\n       Exit;\r\n     Result := True;\r\n   end;\r\n\r\nbegin\r\n  setlength(timevalues,4);\r\n  if separator = #0 then\r\n     if (TimeSeparator<>#0) then\r\n       separator := TimeSeparator\r\n      else\r\n       separator:=':';\r\n  AmPm := AMPM_None;\r\n  if not SplitElements(TimeValues, AmPm) then\r\n  begin\r\n    ErrorMsg:=Format(SErrInvalidTimeFormat,[S]);\r\n    Exit;\r\n  end;\r\n  if (AmPm=AMPM_PM) and (TimeValues[tiHour]<>12) then Inc(TimeValues[tiHour], 12)\r\n  else if (AmPm=AMPM_AM) and (TimeValues[tiHour]=12) then TimeValues[tiHour]:=0;\r\n  // Writeln(      TimeValues[tiHour], TimeValues[tiMin], TimeValues[tiSec], TimeValues[tiMSec]);\r\n  if not TryEncodeTime(TimeValues[tiHour], TimeValues[tiMin], TimeValues[tiSec], TimeValues[tiMSec], result) Then\r\n\r\n    ErrorMsg:=Format(SErrInvalidTimeFormat,[S]);\r\nend ;\r\n\r\nfunction StrToTime(const S: String; separator: char): TDateTime;\r\n\r\nVar\r\n  Msg : String;\r\n\r\nbegin\r\n  Result:=IntStrToTime(Msg,S,Length(S),Separator);\r\n  If (Msg<>'') then\r\n    Raise EConvertError.Create(Msg);\r\nend;\r\n\r\nfunction StrToTime(const S: String): TDateTime;\r\nbegin\r\n   result:= StrToTime(s, TimeSeparator);\r\nend;\r\n\r\n{   StrToDateTime converts the string S to a TDateTime value\r\n    if S does not represent a valid date and/or time value\r\n    an EConvertError will be raised   }\r\n\r\nfunction SplitDateTimeStr(DateTimeStr: String; out DateStr, TimeStr: String): Integer;\r\n\r\n{ Helper function for StrToDateTime\r\n  Pre-condition\r\n    Date is before Time\r\n    If either Date or Time is omitted then see what fits best, a time or a date (issue #0020522)\r\n    Date and Time are separated by whitespace (space Tab, Linefeed or carriage return)\r\n    FS.DateSeparator can be the same as FS.TimeSeparator (issue #0020522)\r\n    If they are both #32 and TrimWhite(DateTimeStr) contains a #32 a date is assumed.\r\n  Post-condition\r\n    DateStr holds date as string or is empty\r\n    TimeStr holds time as string or is empty\r\n    Result = number of strings returned, 0 = error\r\n}\r\nconst\r\n  WhiteSpace = #9#10#13#32;\r\n\r\nvar\r\n  p: Integer;\r\n  DummyDT: TDateTime;\r\nbegin\r\n  Result := 0;\r\n  DateStr := '';\r\n  TimeStr := '';\r\n  DateTimeStr := Trim(DateTimeStr);\r\n  if Length(DateTimeStr) = 0 then exit;\r\n  if (DateSeparator = #32) and (TimeSeparator = #32) and (Pos(#32, DateTimeStr) > 0) then\r\n    begin\r\n    DateStr:=DateTimeStr;\r\n    {\r\n      Assume a date: dd [mm [yy]].\r\n      Really fancy would be counting the number of whitespace occurrences and decide\r\n      and split accordingly\r\n    }\r\n    Exit(1);\r\n    end;\r\n  p:=1;\r\n  //find separator\r\n  if (DateSeparator<>#32) then\r\n    begin\r\n    while (p<Length(DateTimeStr)) and (not (Pos(DateTimeStr[p+1],WhiteSpace)>0)) do\r\n      Inc(p);\r\n    end\r\n  else\r\n    begin\r\n    p:=Pos(TimeSeparator, DateTimeStr);\r\n    if (p<>0) then\r\n      repeat\r\n        Dec(p);\r\n      until (p=0) or (Pos(DateTimeStr[p],WhiteSpace)>0);\r\n    end;\r\n  //Always fill DateStr, it eases the algorithm later\r\n  if (p=0) then\r\n    p:=Length(DateTimeStr);\r\n  DateStr:=Copy(DateTimeStr,1,p);\r\n  TimeStr:=Trim(Copy(DateTimeStr,p+1,100));\r\n  if (Length(TimeStr)<>0) then\r\n    Result:=2\r\n  else\r\n    begin\r\n    Result:=1; //found 1 string\r\n    // 2 cases when DateTimeStr only contains a time:\r\n    // Date/time separator differ, and string contains a timeseparator\r\n    // Date/time separators are equal, but transformation to date fails.\r\n    if ((DateSeparator<>TimeSeparator) and (Pos(TimeSeparator,DateStr) > 0))\r\n       or ((DateSeparator=TimeSeparator) and (not TryStrToDate(DateStr, DummyDT)))  then\r\n      begin\r\n      TimeStr := DateStr;\r\n      DateStr := '';\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction StrToDateTime(const S: String): TDateTime;\r\n\r\nvar\r\n  TimeStr, DateStr: String;\r\n  PartsFound: Integer;\r\nbegin\r\n  PartsFound := SplitDateTimeStr(S, DateStr, TimeStr);\r\n  case PartsFound of\r\n    0: Result:=StrToDate('');\r\n    1: if (Length(DateStr) > 0) then\r\n         Result := StrToDate(DateStr,ShortDateFormat,DateSeparator)\r\n       else\r\n         Result := StrToTime(TimeStr);\r\n    2: Result := ComposeDateTime(StrTodate(DateStr,ShortDateFormat,DateSeparator),\r\n                                  StrToTime(TimeStr));\r\n  end;\r\nend;\r\n\r\nfunction FormatDateTime(const FormatStr: string; const DateTime: TDateTime\r\n  ): string;\r\n\r\n  procedure StoreStr(APos,Len: Integer);\r\n  begin\r\n//    Writeln('StoreStr: ',Result,'+',Copy(FormatStr,APos,Len));\r\n    Result:=Result+Copy(FormatStr,APos,Len);\r\n  end;\r\n\r\n  procedure StoreString(const AStr: string);\r\n\r\n  begin\r\n//    Writeln('StoreString: ',Result,'+',AStr);\r\n    Result:=Result+AStr;\r\n  end;\r\n\r\n  procedure StoreInt(Value, Digits: Integer);\r\n  var\r\n    S: string;\r\n\r\n  begin\r\n    S:=IntToStr(Value);\r\n    While (Length(S)<Digits) do\r\n      S:='0'+S;\r\n    StoreString(S);\r\n  end;\r\n\r\nvar\r\n  Year, Month, Day, DayOfWeek, Hour, Minute, Second, MilliSecond: word;\r\n\r\n  procedure StoreFormat(const FormatStr: string; Nesting: Integer; TimeFlag: Boolean);\r\n  var\r\n    Token, lastformattoken, prevlasttoken: char;\r\n    Count: integer;\r\n    Clock12: boolean;\r\n    tmp: integer;\r\n    isInterval: Boolean;\r\n    P,FormatCurrent,FormatEnd : Integer;\r\n  begin\r\n    if Nesting > 1 then  // 0 is original string, 1 is included FormatString\r\n      Exit;\r\n    FormatCurrent := 1;\r\n    FormatEnd := Length(FormatStr);\r\n    Clock12 := false;\r\n    isInterval := false;\r\n    // look for unquoted 12-hour clock token\r\n    P:=1;\r\n    while P<=FormatEnd do\r\n      begin\r\n      Token := FormatStr[P];\r\n      case Token of\r\n        '''', '\"':\r\n        begin\r\n          Inc(P);\r\n          while (P < FormatEnd) and (FormatStr[P]<>Token) do\r\n            Inc(P);\r\n        end;\r\n        'A', 'a':\r\n        begin\r\n          if (CompareText(Copy(FormatStr,P,3),'A/P')=0) or\r\n             (CompareText(Copy(FormatStr,P,4),'AMPM')=0) or\r\n             (CompareText(Copy(FormatStr,P,5),'AM/PM')=0) then\r\n          begin\r\n            Clock12 := true;\r\n            break;\r\n          end;\r\n        end;\r\n      end;  // case\r\n      Inc(P);\r\n    end ;\r\n    token := #255;\r\n    lastformattoken := ' ';\r\n    prevlasttoken := 'H';\r\n    while FormatCurrent <= FormatEnd do\r\n    begin\r\n      Token := UpperCase(FormatStr[FormatCurrent])[1];\r\n     //  Writeln('Treating token at pos ',FormatCurrent,', : ',Token,' (',FormatStr,')');\r\n      Count := 1;\r\n      P := FormatCurrent + 1;\r\n      case Token of\r\n        '''', '\"':\r\n        begin\r\n          while (P < FormatEnd) and (FormatStr[P]<>Token) do\r\n            Inc(P);\r\n          Inc(P);\r\n          Count := P - FormatCurrent;\r\n          StoreStr(FormatCurrent + 1, Count - 2);\r\n        end ;\r\n        'A':\r\n        begin\r\n          if CompareText(Copy(FormatStr,FormatCurrent,4), 'AMPM') = 0 then\r\n          begin\r\n            Count := 4;\r\n            if Hour < 12 then\r\n              StoreString(TimeAMString)\r\n            else\r\n              StoreString(TimePMString);\r\n          end\r\n          else if CompareText(Copy(FormatStr,FormatCurrent,5), 'AM/PM') = 0 then\r\n          begin\r\n            Count := 5;\r\n            if Hour < 12 then StoreStr(FormatCurrent, 2)\r\n                         else StoreStr(FormatCurrent+3, 2);\r\n          end\r\n          else if CompareText(Copy(FormatStr,FormatCurrent,3), 'A/P') = 0 then\r\n          begin\r\n            Count := 3;\r\n            if Hour < 12 then StoreStr(FormatCurrent, 1)\r\n            else StoreStr(FormatCurrent+2, 1);\r\n          end\r\n          else\r\n            raise EConvertError.Create('Illegal character in format string');\r\n        end ;\r\n        '/':\r\n          begin\r\n           //  Writeln('Detected date separator');\r\n          StoreString(DateSeparator);\r\n          end;\r\n        ':': StoreString(TimeSeparator);\r\n        ' ', 'C', 'D', 'H', 'M', 'N', 'S', 'T', 'Y', 'Z', 'F' :\r\n        begin\r\n          // Writeln(FormatCurrent,' Special Token: ',Token,', Count: ',Count,', P: ',P);\r\n          while (P <= FormatEnd) and (UpperCase(FormatStr[P]) = Token) do\r\n            Inc(P);\r\n          Count := P - FormatCurrent;\r\n          // Writeln(FormatCurrent,' Special Token: ',Token,', Count: ',Count,', P: ',P);\r\n          case Token of\r\n            ' ': StoreStr(FormatCurrent, Count);\r\n            'Y': begin\r\n              if Count > 2 then\r\n                StoreInt(Year, 4)\r\n              else\r\n                StoreInt(Year mod 100, 2);\r\n            end;\r\n            'M': begin\r\n\t      if isInterval and ((prevlasttoken = 'H') or TimeFlag) then\r\n\t        StoreInt(Minute + (Hour + trunc(abs(DateTime))*24)*60, 0)\r\n\t      else\r\n              if (lastformattoken = 'H') or TimeFlag then\r\n              begin\r\n                if Count = 1 then\r\n                  StoreInt(Minute, 0)\r\n                else\r\n                  StoreInt(Minute, 2);\r\n              end\r\n              else\r\n              begin\r\n                case Count of\r\n                  1: StoreInt(Month, 0);\r\n                  2: StoreInt(Month, 2);\r\n                  3: StoreString(ShortMonthNames[Month]);\r\n                else\r\n                  StoreString(LongMonthNames[Month]);\r\n                end;\r\n              end;\r\n            end;\r\n            'D': begin\r\n              case Count of\r\n                1: StoreInt(Day, 0);\r\n                2: StoreInt(Day, 2);\r\n                3: StoreString(ShortDayNames[DayOfWeek]);\r\n                4: StoreString(LongDayNames[DayOfWeek]);\r\n                5: StoreFormat(ShortDateFormat, Nesting+1, False);\r\n              else\r\n                StoreFormat(LongDateFormat, Nesting+1, False);\r\n              end ;\r\n            end ;\r\n            'H':\r\n\t      if isInterval then\r\n\t        StoreInt(Hour + trunc(abs(DateTime))*24, 0)\r\n\t      else\r\n\t      if Clock12 then\r\n              begin\r\n                tmp := hour mod 12;\r\n                if tmp=0 then tmp:=12;\r\n                if Count = 1 then\r\n                  StoreInt(tmp, 0)\r\n                else\r\n                  StoreInt(tmp, 2);\r\n              end\r\n              else begin\r\n                if Count = 1 then\r\n\t\t  StoreInt(Hour, 0)\r\n                else\r\n                  StoreInt(Hour, 2);\r\n              end;\r\n            'N': if isInterval then\r\n\t           StoreInt(Minute + (Hour + trunc(abs(DateTime))*24)*60, 0)\r\n\t\t else\r\n\t\t if Count = 1 then\r\n                   StoreInt(Minute, 0)\r\n                 else\r\n                   StoreInt(Minute, 2);\r\n            'S': if isInterval then\r\n\t           StoreInt(Second + (Minute + (Hour + trunc(abs(DateTime))*24)*60)*60, 0)\r\n\t         else\r\n\t         if Count = 1 then\r\n                   StoreInt(Second, 0)\r\n                 else\r\n                   StoreInt(Second, 2);\r\n            'Z': if Count = 1 then\r\n                   StoreInt(MilliSecond, 0)\r\n                 else\r\n\t\t   StoreInt(MilliSecond, 3);\r\n            'T': if Count = 1 then\r\n\t\t   StoreFormat(ShortTimeFormat, Nesting+1, True)\r\n                 else\r\n\t           StoreFormat(LongTimeFormat, Nesting+1, True);\r\n            'C': begin\r\n                   StoreFormat(ShortDateFormat, Nesting+1, False);\r\n                   if (Hour<>0) or (Minute<>0) or (Second<>0) then\r\n                     begin\r\n                      StoreString(' ');\r\n                      StoreFormat(LongTimeFormat, Nesting+1, True);\r\n                     end;\r\n                 end;\r\n            'F': begin\r\n                   StoreFormat(ShortDateFormat, Nesting+1, False);\r\n                   StoreString(' ');\r\n                   StoreFormat(LongTimeFormat, Nesting+1, True);\r\n                 end;\r\n          end;\r\n\t  prevlasttoken := lastformattoken;\r\n          lastformattoken := token;\r\n        end;\r\n        else\r\n          StoreString(Token);\r\n      end ;\r\n      Inc(FormatCurrent, Count);\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  DecodeDateFully(DateTime, Year, Month, Day, DayOfWeek);\r\n  DecodeTime(DateTime, Hour, Minute, Second, MilliSecond);\r\n  // Writeln(DateTime,'->',Year,',', Month, ',',Day, ',',DayOfWeek,',',Hour, ',',Minute, ',',Second, ',',MilliSecond);\r\n  if FormatStr <> '' then\r\n    StoreFormat(FormatStr, 0, False)\r\n  else\r\n    StoreFormat('C', 0, False);\r\nend ;\r\n\r\n\r\n\r\nfunction CurrentYear: Word;\r\n\r\nbegin\r\n  Result:=TJSDate.New().FullYear;\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime): Boolean;\r\nbegin\r\n  Result:=TryStrToDate(S,Value,ShortDateFormat,#0);\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; separator : char): Boolean;\r\n\r\nbegin\r\n  Result:=TryStrToDate(S,Value,ShortDateFormat,Separator);\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime;\r\n                    const useformat : string; separator : char = #0): Boolean;\r\n\r\nVar\r\n  Msg : String;\r\n\r\nbegin\r\n  Result:=Length(S)<>0;\r\n  If Result then\r\n    begin\r\n    Value:=IntStrToDate(Msg,S,useformat,Separator);\r\n    Result:=(Msg='');\r\n    end;\r\nend;\r\n\r\n\r\n\r\n\r\nfunction TryStrToTime(const S: String; out Value: TDateTime; separator : char): Boolean;\r\nVar\r\n  Msg : String;\r\nbegin\r\n  Result:=Length(S)<>0;\r\n  If Result then\r\n    begin\r\n      Value:=IntStrToTime(Msg,S,Length(S),Separator);\r\n      Result:=(Msg='');\r\n    end;\r\nend;\r\n\r\nfunction TryStrToTime(const S: String; out Value: TDateTime): Boolean;\r\nbegin\r\n  result:=TryStrToTime(S,Value,#0);\r\nend;\r\n\r\nfunction TryStrToDateTime(const S: String; out Value: TDateTime): Boolean;\r\n\r\nvar\r\n  I: integer;\r\n  dtdate, dttime :TDateTime;\r\nbegin\r\n  result:=false;\r\n  I:=Pos(TimeSeparator,S);\r\n  If (I>0) then\r\n    begin\r\n      While (I>0) and (S[I]<>' ') do\r\n        Dec(I);\r\n      If I>0 then\r\n        begin\r\n          if not TryStrToDate(Copy(S,1,I-1),dtdate) then\r\n            exit;\r\n          if not TryStrToTime(Copy(S,i+1, Length(S)-i),dttime) then\r\n            exit;\r\n          Value:=ComposeDateTime(dtdate,dttime);\r\n          result:=true;\r\n        end\r\n      else\r\n         result:=TryStrToTime(s,Value);\r\n    end\r\n  else\r\n    result:=TryStrToDate(s,Value);\r\nend;\r\n\r\n\r\n\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nbegin\r\n   result := StrToDateDef(S,DefValue,#0);\r\nend;\r\n\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nbegin\r\n   result := StrToTimeDef(S,DefValue,#0);\r\nend;\r\n\r\nfunction StrToDateTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nbegin\r\n  if not TryStrToDateTime(s,Result) Then\r\n    result:=defvalue;\r\nend;\r\n\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nbegin\r\n  if not TryStrToDate(s,Result, separator) Then\r\n    result:=defvalue;\r\nend;\r\n\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nbegin\r\n  if not TryStrToTime(s,Result, separator) Then\r\n    result:=defvalue;\r\nend;\r\n\r\nprocedure ReplaceTime(var dati:TDateTime; NewTime : TDateTime);\r\nbegin\r\n  dati:= ComposeDateTime(dati, newtime);\r\nend;\r\n\r\nprocedure ReplaceDate(var DateTime: TDateTime; const NewDate: TDateTime);\r\nvar\r\n  tmp : TDateTime;\r\nbegin\r\n  tmp:=NewDate;\r\n  ReplaceTime(tmp,DateTime);\r\n  DateTime:=tmp;\r\nend;\r\n\r\nfunction FloatToDateTime(const Value: Extended): TDateTime;\r\nbegin\r\n  If (Value<MinDateTime) or (Value>MaxDateTime) then\r\n    Raise EConvertError.CreateFmt (SInvalidDateTime,[FloatToStr(Value)]);\r\n  Result:=Value;\r\nend;\r\n\r\nfunction FloattoCurr(const Value: Extended): Currency;\r\nbegin\r\n  if not TryFloatToCurr(Value, Result) then\r\n    Raise EConvertError.CreateFmt(SInvalidCurrency, [FloatToStr(Value)]);\r\nend;\r\n\r\nfunction TryFloatToCurr(const Value: Extended; var AResult: Currency): Boolean;\r\nbegin\r\n  Result:=(Value>=MinCurrency) and (Value<=MaxCurrency);\r\n  if Result then\r\n    AResult := Value;\r\nend;\r\n\r\nfunction CurrToStr(Value: Currency): string;\r\nbegin\r\n  Result:=FloatToStrF(Value,ffGeneral,-1,0);\r\nend;\r\n\r\n(*\r\nfunction CurrToStr(Value: Currency; const FormatSettings: TFormatSettings): string;\r\nbegin\r\n\r\nend;\r\n*)\r\n\r\nfunction StrToCurr(const S: string): Currency;\r\n\r\nbegin\r\n  if not TryStrToCurr(S,Result) then\r\n    Raise EConvertError.createfmt(SInvalidCurrency,[S]);\r\nend;\r\n\r\n(*\r\nfunction StrToCurr(const S: string; const FormatSettings: TFormatSettings): Currency;\r\nbegin\r\n\r\nend;\r\n*)\r\n\r\nfunction TryStrToCurr(const S: string; out Value: Currency): Boolean;\r\n\r\nVar\r\n  D : Double;\r\n\r\nbegin\r\n  Result:=TryStrToFloat(S,D);\r\n  if Result then\r\n    Value:=D;\r\nend;\r\n\r\n(*\r\nfunction TryStrToCurr(const S: string; out Value: Currency; const FormatSettings: TFormatSettings): Boolean;\r\nbegin\r\n\r\nend;\r\n*)\r\n\r\nfunction StrToCurrDef(const S: string; Default: Currency): Currency;\r\n\r\nVar\r\n  R : Currency;\r\n\r\nbegin\r\n  if TryStrToCurr(S,R) then\r\n    Result:=R\r\n  else\r\n    Result:=Default;\r\nend;\r\n\r\n(*\r\nfunction StrToCurrDef(const S: string; Default: Currency; const FormatSettings: TFormatSettings): Currency;\r\nbegin\r\n\r\nend;\r\n*)\r\n\r\n{ ---------------------------------------------------------------------\r\n  Interface related\r\n  ---------------------------------------------------------------------}\r\nfunction Supports(const Instance: IInterface; const AClass: TClass; out Obj\r\n  ): Boolean;\r\nbegin\r\n  Result := (Instance<>nil) and (Instance.QueryInterface(IObjectInstance,Obj)=S_OK)\r\n     and (TObject(Obj).InheritsFrom(AClass));\r\nend;\r\n\r\nfunction Supports(const Instance: IInterface; const IID: TGuid; out Intf\r\n  ): Boolean;\r\nbegin\r\n  Result:=(Instance<>nil) and (Instance.QueryInterface(IID,Intf)=S_OK);\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuid; out Intf): Boolean;\r\nbegin\r\n  Result:=(Instance<>nil) and Instance.GetInterface(IID,Intf);\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuidString; out Intf\r\n  ): Boolean;\r\nbegin\r\n  Result:=(Instance<>nil) and Instance.GetInterfaceByStr(IID,Intf);\r\nend;\r\n\r\nfunction Supports(const Instance: IInterface; const AClass: TClass): Boolean;\r\nvar\r\n  Temp: TObject;\r\nbegin\r\n  Result:=Supports(Instance,AClass,Temp);\r\nend;\r\n\r\nfunction Supports(const Instance: IInterface; const IID: TGuid): Boolean;\r\nvar\r\n  Temp: IInterface;\r\nbegin\r\n  Result:=Supports(Instance,IID,Temp);\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuid): Boolean;\r\nvar\r\n  Temp: TJSObject;\r\nbegin\r\n  Result:=Supports(Instance,IID,Temp);\r\n  asm\r\n    if (Temp && Temp.$kind==='com') Temp._Release();\r\n  end;\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuidString): Boolean;\r\nvar\r\n  Temp: TJSObject;\r\nbegin\r\n  Result:=Supports(Instance,IID,Temp);\r\n  asm\r\n    if (Temp && Temp.$kind==='com') Temp._Release();\r\n  end;\r\nend;\r\n\r\nfunction Supports(const AClass: TClass; const IID: TGuid): Boolean;\r\nvar\r\n  maps: JSValue;\r\nbegin\r\n  if AClass=nil then exit(false);\r\n  maps := TJSObject(AClass)['$intfmaps'];\r\n  if not maps then exit(false);\r\n  if TJSObject(maps)[GUIDToString(IID)] then exit(true);\r\n  Result:=false;\r\nend;\r\n\r\nfunction Supports(const AClass: TClass; const IID: TGuidString): Boolean;\r\nvar\r\n  maps: JSValue;\r\nbegin\r\n  if AClass=nil then exit(false);\r\n  maps := TJSObject(AClass)['$intfmaps'];\r\n  if not maps then exit(false);\r\n  if TJSObject(maps)[uppercase(IID)] then exit(true);\r\n  Result:=false;\r\nend;\r\n\r\nfunction TryStringToGUID(const s: string; out Guid: TGuid): Boolean;\r\nvar\r\n  re: TJSRegexp;\r\nbegin\r\n  if Length(s)<>38 then Exit(False);\r\n  re:=TJSRegexp.new('^\\{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\}$');\r\n  Result:=re.test(s);\r\n  if not Result then\r\n    begin\r\n    Guid.D1:=0;\r\n    exit;\r\n    end;\r\n  asm\r\n    rtl.strToGUIDR(s,Guid);\r\n  end;\r\n  Result:=true;\r\nend;\r\n\r\nfunction StringToGUID(const S: string): TGuid;\r\nbegin\r\n  if not TryStringToGUID(S, Result) then\r\n    raise EConvertError.CreateFmt(SInvalidGUID, [S]);\r\nend;\r\n\r\nfunction GUIDToString(const guid: TGuid): string;\r\nbegin\r\n  Result:=System.GUIDToString(guid);\r\nend;\r\n\r\nfunction IsEqualGUID(const guid1, guid2: TGuid): Boolean;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if (guid1.D1<>guid2.D1) or (guid1.D2<>guid2.D2) or (guid1.D3<>guid2.D3) then\r\n    exit(false);\r\n  for i:=0 to 7 do if guid1.D4[i]<>guid2.D4[i] then exit(false);\r\n  Result:=true;\r\nend;\r\n\r\nfunction GuidCase(const guid: TGuid; const List: array of TGuid): Integer;\r\nbegin\r\n  for Result := High(List) downto 0 do\r\n    if IsEqualGUID(guid, List[Result]) then\r\n      Exit;\r\n  Result := -1;\r\nend;\r\n\r\nfunction CreateGUID(out GUID: TGUID): Integer;\r\n\r\n  Function R(B: Integer) : NativeInt;\r\n\r\n  Var\r\n    v : NativeInt;\r\n  begin\r\n    v:=Random(256);\r\n    While B>1 do\r\n      begin\r\n      v:=v*256+Random(256);\r\n      Dec(B);\r\n      end;\r\n    Result:=V;\r\n  end;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  GUID.D1:= R(4);\r\n  GUID.D2:= R(2);\r\n  GUID.D3:= R(2);\r\n  For I:=0 to 7 do\r\n   GUID.D4[I]:=R(1);\r\nend;\r\n{ ---------------------------------------------------------------------\r\n  Integer/Ordinal related\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TryStrToInt(const S: String; out res: Integer): Boolean;\r\n\r\nVar\r\n  NI : NativeInt;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,NI);\r\n  if Result then\r\n    res:=NI;\r\nend;\r\n\r\nfunction TryStrToInt(const S: String; out res: NativeInt): Boolean;\r\n\r\nVar\r\n  Radix : Integer = 10;\r\n  N : String;\r\n  J : JSValue;\r\n\r\nbegin\r\n  N:=S;\r\n  case Copy(N,1,1) of\r\n  '$': Radix:=16;\r\n  '&': Radix:=8;\r\n  '%': Radix:=2;\r\n  end;\r\n  If Radix<>10 then\r\n    Delete(N,1,1);\r\n  J:=parseInt(N,Radix);\r\n  Result:=Not jsIsNan(j);\r\n  if Result then\r\n    res:=NativeInt(J);\r\nend;\r\n\r\nfunction StrToIntDef(const S: String; const aDef: Integer): Integer;\r\n\r\nVar\r\n  R : NativeInt;\r\n\r\nbegin\r\n  if TryStrToInt(S,R) then\r\n    Result:=R\r\n  else\r\n    Result:=aDef;\r\nend;\r\n\r\nfunction StrToIntDef(const S: String; const aDef: NativeInt): NativeInt;\r\n\r\nVar\r\n  R : NativeInt;\r\n\r\nbegin\r\n  if TryStrToInt(S,R) then\r\n    Result:=R\r\n  else\r\n    Result:=aDef;\r\nend;\r\n\r\nfunction StrToInt(const S: String): Integer;\r\n\r\nVar\r\n  R : NativeInt;\r\n\r\nbegin\r\n  if not TryStrToInt(S,R) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=R;\r\nend;\r\n\r\nfunction StrToNativeInt(const S: String): NativeInt;\r\n\r\nbegin\r\n  if not TryStrToInt(S,Result) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\nend;\r\n\r\nfunction StrToInt64(const S: String): NativeLargeInt;\r\n\r\nVar\r\n  N : NativeInt;\r\n\r\nbegin\r\n  if not TryStrToInt(S,N) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=N;\r\nend;\r\n\r\nfunction TryStrToInt64(const S: String; out res: NativeLargeInt): Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R);\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nfunction StrToInt64Def(const S: String; ADefault: NativeLargeInt\r\n  ): NativeLargeInt;\r\n\r\n\r\nbegin\r\n  if TryStrToInt64(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\nfunction StrToQWord(const S: String): NativeLargeUInt;\r\n\r\nVar\r\n  N : NativeInt;\r\n\r\nbegin\r\n  if (not TryStrToInt(S,N)) or (N<0) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=N;\r\nend;\r\n\r\nfunction TryStrToQWord(const S: String; out res: NativeLargeUInt): Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R) and (R>=0);\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nfunction StrToQWordDef(const S: String; ADefault: NativeLargeUInt\r\n  ): NativeLargeUInt;\r\n\r\nbegin\r\n  if Not TryStrToQword(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\n\r\nfunction StrToUInt64(const S: String): NativeLargeUInt;\r\n\r\nVar\r\n  N : NativeInt;\r\n\r\nbegin\r\n  if (not TryStrToInt(S,N)) or (N<0) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=N;\r\nend;\r\n\r\nfunction TryStrToUInt64(const S: String; out res: NativeLargeUInt): Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R) and (R>=0);\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nfunction StrToUInt64Def(const S: String; ADefault: NativeLargeUInt\r\n  ): NativeLargeUInt;\r\n\r\n\r\nbegin\r\n  if Not TryStrToUInt64(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\nfunction TryStrToDWord(const S: String; out res: DWord): Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R) and (R>=0) and (R<=DWord($FFFFFFFF));\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nfunction StrToDWord(const S: String): DWord;\r\n\r\nbegin\r\n  if not TryStrToDWord(S,Result) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\nend;\r\n\r\n\r\nfunction StrToDWordDef(const S: String; ADefault: DWord): DWord;\r\n\r\nbegin\r\n  if Not TryStrToDWord(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\n\r\nfunction IntToHex(Value: NativeInt; Digits: integer): string;\r\nconst\r\n  HexDigits = '0123456789ABCDEF';\r\nbegin\r\n  If Digits=0 then\r\n    Digits:=1;\r\n  Result:='';\r\n  While Value>0 do\r\n    begin\r\n    result:=HexDigits[(value and 15)+1]+Result;\r\n    value := value shr 4;\r\n    end ;\r\n  while (Length(Result)<Digits) do\r\n    Result:='0'+Result;\r\nend;\r\n\r\n\r\n{ TFormatSettings }\r\n\r\nfunction TFormatSettings.GetCurrencyDecimals: Byte;\r\nbegin\r\n  Result:=Sysutils.CurrencyDecimals;\r\nend;\r\n\r\nfunction TFormatSettings.GetCurrencyFormat: Byte;\r\nbegin\r\n  Result:=Sysutils.CurrencyFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetCurrencyString: String;\r\nbegin\r\n  Result:=Sysutils.CurrencyString;\r\nend;\r\n\r\nfunction TFormatSettings.GetDateSeparator: char;\r\nbegin\r\n  Result := SysUtils.DateSeparator;\r\nend;\r\n\r\nfunction TFormatSettings.GetDecimalSeparator: string;\r\nbegin\r\n  Result := SysUtils.DecimalSeparator;\r\nend;\r\n\r\nfunction TFormatSettings.GetLongDateFormat: string;\r\nbegin\r\n  Result := SysUtils.LongDateFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetLongDayNames: TDayNames;\r\nbegin\r\n  Result:=Sysutils.LongDayNames;\r\nend;\r\n\r\nfunction TFormatSettings.GetLongMonthNames: TMonthNames;\r\nbegin\r\n Result:=Sysutils.LongMonthNames;\r\nend;\r\n\r\nfunction TFormatSettings.GetLongTimeFormat: string;\r\nbegin\r\n  Result := SysUtils.LongTimeFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetNegCurrFormat: Byte;\r\nbegin\r\n  Result:=Sysutils.NegCurrFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetShortDateFormat: string;\r\nbegin\r\n  Result := SysUtils.ShortDateFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetShortDayNames: TDayNames;\r\nbegin\r\n Result:=Sysutils.ShortDayNames;\r\nend;\r\n\r\nfunction TFormatSettings.GetShortMonthNames: TMonthNames;\r\nbegin\r\n Result:=Sysutils.ShortMonthNames;\r\nend;\r\n\r\nfunction TFormatSettings.GetShortTimeFormat: string;\r\nbegin\r\n  Result := SysUtils.ShortTimeFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetThousandSeparator: string;\r\nbegin\r\n  Result := SysUtils.ThousandSeparator;\r\nend;\r\n\r\nfunction TFormatSettings.GetTimeAMString: string;\r\nbegin\r\n  Result := SysUtils.TimeAMString;\r\nend;\r\n\r\nfunction TFormatSettings.GetTimePMString: string;\r\nbegin\r\n  Result := SysUtils.TimePMString;\r\nend;\r\n\r\nfunction TFormatSettings.GetTimeSeparator: char;\r\nbegin\r\n  Result := SysUtils.TimeSeparator;\r\nend;\r\n\r\nprocedure TFormatSettings.SetCurrencyFormat(AValue: Byte);\r\nbegin\r\n  Sysutils.CurrencyFormat:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetCurrencyString(AValue: String);\r\nbegin\r\n  Sysutils.CurrencyString:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetDateSeparator(const Value: char);\r\nbegin\r\n  SysUtils.DateSeparator := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetDecimalSeparator(const Value: string);\r\nbegin\r\n  SysUtils.DecimalSeparator := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetLongDateFormat(const Value: string);\r\nbegin\r\n  SysUtils.LongDateFormat := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetLongDayNames(AValue: TDayNames);\r\nbegin\r\n  SysUtils.LongDayNames:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetLongMonthNames(AValue: TMonthNames);\r\nbegin\r\n  SysUtils.LongMonthNames:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetLongTimeFormat(const Value: string);\r\nbegin\r\n  SysUtils.LongTimeFormat := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetNegCurrFormat(AValue: Byte);\r\nbegin\r\n  Sysutils.NegCurrFormat:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetShortDateFormat(const Value: string);\r\nbegin\r\n  SysUtils.ShortDateFormat := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetShortDayNames(AValue: TDayNames);\r\nbegin\r\n  SysUtils.ShortDayNames:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetShortMonthNames(AValue: TMonthNames);\r\nbegin\r\n  SysUtils.ShortMonthNames:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetShortTimeFormat(const Value: string);\r\nbegin\r\n  SysUtils.ShortTimeFormat := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetCurrencyDecimals(AValue: Byte);\r\nbegin\r\n  Sysutils.CurrencyDecimals:=aValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetThousandSeparator(const Value: string);\r\nbegin\r\n  SysUtils.ThousandSeparator := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetTimeAMString(const Value: string);\r\nbegin\r\n  SysUtils.TimeAMString := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetTimePMString(const Value: string);\r\nbegin\r\n  SysUtils.TimePMString := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetTimeSeparator(const Value: char);\r\nbegin\r\n  SysUtils.TimeSeparator := Value;\r\nend;\r\n\r\nclass constructor TFormatSettings.Init;\r\nbegin\r\n  FormatSettings := TFormatSettings.Create;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  FileNames\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction ChangeFileExt(const FileName, Extension: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\n  SOF : Boolean;\r\n\r\nbegin\r\n  i := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators+[ExtensionSeparator];\r\n  while (I > 0) and not(FileName[I] in EndSep) do\r\n    Dec(I);\r\n  if (I = 0) or (FileName[I] <> ExtensionSeparator) then\r\n    I := Length(FileName)+1\r\n  else\r\n    begin\r\n        SOF:=(I=1) or (FileName[i-1] in AllowDirectorySeparators);\r\n        if (SOF) and not FirstDotAtFileNameStartIsExtension then\r\n          I:=Length(FileName)+1;\r\n        end;\r\n  Result := Copy(FileName, 1, I - 1) + Extension;\r\nend;\r\n\r\nfunction ExtractFilePath(const FileName: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\nbegin\r\n  i := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators;\r\n  while (i > 0) and not CharInSet(FileName[i],EndSep) do\r\n    Dec(i);\r\n  If I>0 then\r\n    Result := Copy(FileName, 1, i)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction ExtractFileDir(const FileName: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\nbegin\r\n  I := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators;\r\n  while (I > 0) and not CharInSet(FileName[I],EndSep) do\r\n    Dec(I);\r\n  if (I > 1) and CharInSet(FileName[I],AllowDirectorySeparators) and\r\n     not CharInSet(FileName[I - 1],EndSep) then\r\n    Dec(I);\r\n  Result := Copy(FileName, 1, I);\r\nend;\r\n\r\nfunction ExtractFileDrive(const FileName: PathStr): PathStr;\r\nvar\r\n  i,l: longint;\r\nbegin\r\n  Result := '';\r\n  l:=Length(FileName);\r\n  if (l<2) then\r\n    exit;\r\n  If CharInSet(FileName[2],AllowDriveSeparators) then\r\n    result:=Copy(FileName,1,2)\r\n  else if CharInSet(FileName[1],AllowDirectorySeparators) and\r\n          CharInSet(FileName[2],AllowDirectorySeparators) then\r\n    begin\r\n      i := 2;\r\n\r\n      { skip share }\r\n      While (i<l) and Not CharInSet(Filename[i+1],AllowDirectorySeparators) do\r\n        inc(i);\r\n      inc(i);\r\n\r\n      While (i<l) and Not CharInSet(Filename[i+1],AllowDirectorySeparators) do\r\n        inc(i);\r\n      Result:=Copy(FileName,1,i);\r\n    end;\r\nend;\r\n\r\nfunction ExtractFileName(const FileName: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\nbegin\r\n  I := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators;\r\n  while (I > 0) and not CharInSet(FileName[I],EndSep) do\r\n    Dec(I);\r\n  Result := Copy(FileName, I + 1, MaxInt);\r\nend;\r\n\r\nfunction ExtractFileExt(const FileName: PathStr): PathStr;\r\nvar\r\n  i : longint;\r\n  EndSep : Set of Char;\r\n  SOF : Boolean; // Dot at Start of filename ?\r\n\r\nbegin\r\n  Result:='';\r\n  I := Length(FileName);\r\n  EndSep:=AllowDirectorySeparators+AllowDriveSeparators+[ExtensionSeparator];\r\n  while (I > 0) and not CharInSet(FileName[I],EndSep) do\r\n    Dec(I);\r\n  if (I > 0) and (FileName[I] = ExtensionSeparator) then\r\n    begin\r\n        SOF:=(I=1) or (FileName[i-1] in AllowDirectorySeparators);\r\n        if (Not SOF) or FirstDotAtFileNameStartIsExtension then\r\n          Result := Copy(FileName, I, MaxInt);\r\n        end\r\n  else\r\n    Result := '';\r\nend;\r\n\r\nfunction ExtractRelativepath(const BaseName, DestName: PathStr): PathStr;\r\n\r\nVar\r\n  OneLevelBack,Source, Dest   : PathStr;\r\n  Sc,Dc,I,J      : Longint;\r\n  SD,DD          : TPathStrArray;\r\n\r\n\r\nbegin\r\n  OneLevelBack := '..'+PathDelim;\r\n  If Uppercase(ExtractFileDrive(BaseName))<>Uppercase(ExtractFileDrive(DestName)) Then\r\n    begin\r\n    Result:=DestName;\r\n    exit;\r\n    end;\r\n  Source:=ExcludeTrailingPathDelimiter(ExtractFilePath(BaseName));\r\n  Dest:=ExcludeTrailingPathDelimiter(ExtractFilePath(DestName));\r\n  SD:=GetDirs (Source);\r\n  SC:=Length(SD);\r\n  DD:=GetDirs (Dest);\r\n  DC:=Length(SD);\r\n  I:=0;\r\n  While (I<DC) and (I<SC) do\r\n    begin\r\n    If SameText(DD[i],SD[i]) then\r\n      Inc(i)\r\n    else\r\n      Break;\r\n    end;\r\n  Result:='';\r\n  For J:=I to SC do Result:=Result+OneLevelBack;\r\n  For J:=I to DC do Result:=Result+DD[J]+PathDelim;\r\n  Result:=Result+ExtractFileName(DestName);\r\nend;\r\n\r\nfunction SetDirSeparators(const FileName: PathStr): PathStr;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  Result:=FileName;\r\n  For I:=1 to Length(Result) do\r\n    If CharInSet(Result[I],AllowDirectorySeparators) then\r\n      Result[i]:=PathDelim;\r\nend;\r\n\r\nfunction GetDirs(DirName: PathStr): TPathStrArray;\r\n\r\nVar\r\n  I,J,L : Longint;\r\n  D : String;\r\n\r\nbegin\r\n  I:=1;\r\n  J:=0;\r\n  L:=0;\r\n  SetLength(Result,Length(DirName));\r\n  While I<=Length(DirName) do\r\n    begin\r\n    If CharInSet(DirName[i],AllowDirectorySeparators) then\r\n      begin\r\n      D:=Copy(DirName,J+1,J-I);\r\n      if (D<>'') then\r\n        begin\r\n        Result[L]:=D;\r\n        Inc(L);\r\n        end;\r\n      J:=I;\r\n      end;\r\n    Inc(I);\r\n    end;\r\n  SetLength(Result,L);\r\nend;\r\n\r\nfunction IncludeTrailingPathDelimiter(const Path: PathStr): PathStr;\r\n\r\nVar\r\n  l : Integer;\r\n\r\nbegin\r\n  Result:=Path;\r\n  l:=Length(Result);\r\n  If (L=0) or not CharInSet(Result[l],AllowDirectorySeparators) then\r\n    Result:=Result+PathDelim;\r\nend;\r\n\r\nfunction ExcludeTrailingPathDelimiter(const Path: PathStr): PathStr;\r\n\r\nVar\r\n  L : Integer;\r\n\r\nbegin\r\n  L:=Length(Path);\r\n  If (L>0) and CharInSet(Path[L],AllowDirectorySeparators) then\r\n    Dec(L);\r\n  Result:=Copy(Path,1,L);\r\nend;\r\n\r\nfunction IncludeLeadingPathDelimiter(const Path: PathStr): PathStr;\r\n\r\nVar\r\n  l : Integer;\r\n\r\nbegin\r\n  Result:=Path;\r\n  l:=Length(Result);\r\n  If (L=0) or not CharInSet(Result[1],AllowDirectorySeparators) then\r\n    Result:=PathDelim+Result;\r\nend;\r\n\r\nfunction ExcludeLeadingPathDelimiter(const Path: PathStr): PathStr;\r\n\r\nVar\r\n  L : Integer;\r\n\r\nbegin\r\n  Result:=Path;\r\n  L:=Length(Result);\r\n  If (L>0) and CharInSet(Result[1],AllowDirectorySeparators) then\r\n    Delete(Result,1,1);\r\nend;\r\n\r\nfunction IsPathDelimiter(const Path: PathStr; Index: Integer): Boolean;\r\n\r\nbegin\r\n  Result:=(Index>0) and (Index<=Length(Path)) and CharInSet(Path[Index],AllowDirectorySeparators);\r\nend;\r\n\r\nfunction ConcatPaths(const Paths: array of PathStr): PathStr;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if Length(Paths) > 0 then\r\n  begin\r\n    Result := Paths[0];\r\n    for I := 1 to Length(Paths) - 1 do\r\n      Result := IncludeTrailingPathDelimiter(Result) + ExcludeLeadingPathDelimiter(Paths[I]);\r\n  end else\r\n    Result := '';\r\nend;\r\n\r\ninitialization\r\n  FormatSettings := TFormatSettings.Create;\r\n  //RTLEInvalidCast:=EInvalidCast;\r\n  LongDayNames[1] := 'Sunday';\r\n  LongDayNames[2] := 'Monday';\r\n  LongDayNames[3] := 'Tuesday';\r\n  LongDayNames[4] := 'Wednesday';\r\n  LongDayNames[5] := 'Thursday';\r\n  LongDayNames[6] := 'Friday';\r\n  LongDayNames[7] := 'Saturday';\r\n  ShortDayNames[1] := 'Sun';\r\n  ShortDayNames[2] := 'Mon';\r\n  ShortDayNames[3] := 'Tue';\r\n  ShortDayNames[4] := 'Wed';\r\n  ShortDayNames[5] := 'Thu';\r\n  ShortDayNames[6] := 'Fri';\r\n  ShortDayNames[7] := 'Sat';\r\n  ShortMonthNames[1] := 'Jan';\r\n  ShortMonthNames[2] := 'Feb';\r\n  ShortMonthNames[3] := 'Mar';\r\n  ShortMonthNames[4] := 'Apr';\r\n  ShortMonthNames[5] := 'May';\r\n  ShortMonthNames[6] := 'Jun';\r\n  ShortMonthNames[7] := 'Jul';\r\n  ShortMonthNames[8] := 'Aug';\r\n  ShortMonthNames[9] := 'Sep';\r\n  ShortMonthNames[10] := 'Oct';\r\n  ShortMonthNames[11] := 'Nov';\r\n  ShortMonthNames[12] := 'Dec';\r\n  LongMonthNames[1] := 'January';\r\n  LongMonthNames[2] := 'February';\r\n  LongMonthNames[3] := 'March';\r\n  LongMonthNames[4] := 'April';\r\n  LongMonthNames[5] := 'May';\r\n  LongMonthNames[6] := 'June';\r\n  LongMonthNames[7] := 'July';\r\n  LongMonthNames[8] := 'August';\r\n  LongMonthNames[9] := 'September';\r\n  LongMonthNames[10] := 'October';\r\n  LongMonthNames[11] := 'November';\r\n  LongMonthNames[12] := 'December';\r\n  MonthDays[True][1] := 31;\r\n  MonthDays[True][2] := 29;\r\n  MonthDays[True][3] := 31;\r\n  MonthDays[True][4] := 30;\r\n  MonthDays[True][5] := 31;\r\n  MonthDays[True][6] := 30;\r\n  MonthDays[True][7] := 31;\r\n  MonthDays[True][8] := 31;\r\n  MonthDays[True][9] := 30;\r\n  MonthDays[True][10] := 31;\r\n  MonthDays[True][11] := 30;\r\n  MonthDays[True][12] := 31;\r\n  MonthDays[False][1] := 31;\r\n  MonthDays[False][2] := 28;\r\n  MonthDays[False][3] := 31;\r\n  MonthDays[False][4] := 30;\r\n  MonthDays[False][5] := 31;\r\n  MonthDays[False][6] := 30;\r\n  MonthDays[False][7] := 31;\r\n  MonthDays[False][8] := 31;\r\n  MonthDays[False][9] := 30;\r\n  MonthDays[False][10] := 31;\r\n  MonthDays[False][11] := 30;\r\n  MonthDays[False][12] := 31;\r\n  DateTimeToStrFormat[False] := 'c';\r\n  DateTimeToStrFormat[True] := 'f';\r\n  //RTLEInvalidCast := EInvalidCast;\r\n  DateSeparator := '-';\r\n  TimeSeparator := ':';\r\n  ShortDateFormat := 'yyyy-mm-dd';\r\n  LongDateFormat := 'ddd, yyyy-mm-dd';\r\n  ShortTimeFormat := 'hh:nn';\r\n  LongTimeFormat := 'hh:nn:ss';\r\n  DecimalSeparator := '.';\r\n  ThousandSeparator := ',';\r\n  TimeAMString := 'AM';\r\n  TimePMString := 'PM';\r\n  TwoDigitYearCenturyWindow:=50;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit TypInfo;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Types, RTLConsts, JS;\r\n\r\ntype\r\n  // if you change the following enumeration type in any way\r\n  // you also have to change the rtl.js in an appropriate way !\r\n  TTypeKind = (\r\n    tkUnknown,  // 0\r\n    tkInteger,  // 1\r\n    tkChar,     // 2 in Delphi/FPC tkWChar, tkUChar\r\n    tkString,   // 3 in Delphi/FPC tkSString, tkWString or tkUString\r\n    tkEnumeration, // 4\r\n    tkSet,      // 5\r\n    tkDouble,   // 6\r\n    tkBool,     // 7\r\n    tkProcVar,  // 8  function or procedure\r\n    tkMethod,   // 9  proc var of object\r\n    tkArray,    // 10 static array\r\n    tkDynArray, // 11\r\n    tkRecord,   // 12\r\n    tkClass,    // 13\r\n    tkClassRef, // 14\r\n    tkPointer,  // 15\r\n    tkJSValue,  // 16\r\n    tkRefToProcVar, // 17  variable of procedure type\r\n    tkInterface, // 18\r\n    //tkObject,\r\n    //tkSString,tkLString,tkAString,tkWString,\r\n    //tkVariant,\r\n    //tkWChar,\r\n    //tkInt64,\r\n    //tkQWord,\r\n    //tkInterfaceRaw,\r\n    //tkUString,tkUChar,\r\n    tkHelper    // 19\r\n    //tkFile,\r\n    );\r\n  TTypeKinds = set of TTypeKind;\r\n\r\n  // TCallConv for compatibility with Delphi/FPC, ignored under pas2js\r\n  TCallConv = (ccReg, ccCdecl, ccPascal, ccStdCall, ccSafeCall, ccCppdecl,\r\n    ccFar16, ccOldFPCCall, ccInternProc, ccSysCall, ccSoftFloat, ccMWPascal);\r\n\r\nconst\r\n  tkFloat = tkDouble; // for compatibility with Delphi/FPC\r\n  tkProcedure = tkProcVar; // for compatibility with Delphi\r\n  tkAny = [Low(TTypeKind)..High(TTypeKind)];\r\n  tkMethods = [tkMethod];\r\n  tkProperties = tkAny-tkMethods-[tkUnknown];\r\n\r\ntype\r\n\r\n  { TTypeInfoModule }\r\n\r\n  TTypeInfoModule = class external name 'pasmodule'\r\n  public\r\n    Name: String external name '$name';\r\n  end;\r\n\r\n  TTypeInfoAttributes = type TJSValueDynArray;\r\n\r\n  { TTypeInfo }\r\n\r\n  TTypeInfo = class external name 'rtl.tTypeInfo'\r\n  public\r\n    Name: String external name 'name';\r\n    Kind: TTypeKind external name 'kind';\r\n    Attributes: TTypeInfoAttributes external name 'attr'; // can be undefined\r\n    Module: TTypeInfoModule external name '$module'; // can be undefined\r\n  end;\r\n  TTypeInfoClassOf = class of TTypeInfo;\r\n\r\n  PTypeInfo = Pointer; // for compatibility with Delphi/FPC, under pas2js it is a TTypeInfo\r\n\r\n  TOrdType  = (\r\n    otSByte,      // 0\r\n    otUByte,      // 1\r\n    otSWord,      // 2\r\n    otUWord,      // 3\r\n    otSLong,      // 4\r\n    otULong,      // 5\r\n    otSIntDouble, // 6 NativeInt\r\n    otUIntDouble  // 7 NativeUInt\r\n    );\r\n\r\n  { TTypeInfoInteger - Kind = tkInteger }\r\n\r\n  TTypeInfoInteger = class external name 'rtl.tTypeInfoInteger'(TTypeInfo)\r\n  public\r\n    MinValue: NativeInt external name 'minvalue';\r\n    MaxValue: NativeInt external name 'maxvalue';\r\n    OrdType : TOrdType external name 'ordtype';\r\n  end;\r\n\r\n  { TEnumType }\r\n\r\n  TEnumType = class external name 'anonymous'\r\n  private\r\n    function GetIntToName(Index: NativeInt): String; external name '[]';\r\n    function GetNameToInt(Name: String): NativeInt; external name '[]';\r\n  public\r\n    property IntToName[Index: NativeInt]: String read GetIntToName;\r\n    property NameToInt[Name: String]: NativeInt read GetNameToInt;\r\n  end;\r\n\r\n  { TTypeInfoEnum - Kind = tkEnumeration }\r\n\r\n  TTypeInfoEnum = class external name 'rtl.tTypeInfoEnum'(TTypeInfoInteger)\r\n  public\r\n    // not supported: BaseType: TTypeInfo\r\n    EnumType: TEnumType external name 'enumtype';\r\n  end;\r\n\r\n  { TTypeInfoSet - Kind = tkSet }\r\n\r\n  TTypeInfoSet = class external name 'rtl.tTypeInfoSet'(TTypeInfo)\r\n  public\r\n    // not supported: BaseType: TTypeInfo\r\n    CompType: TTypeInfo external name 'comptype';\r\n  end;\r\n\r\n  { TTypeInfoStaticArray - Kind = tkArray }\r\n\r\n  TTypeInfoStaticArray = class external name 'rtl.tTypeInfoStaticArray'(TTypeInfo)\r\n  public\r\n    Dims: TIntegerDynArray;\r\n    ElType: TTypeInfo external name 'eltype';\r\n  end;\r\n\r\n  { TTypeInfoDynArray - Kind = tkDynArray }\r\n\r\n  TTypeInfoDynArray = class external name 'rtl.tTypeInfoDynArray'(TTypeInfo)\r\n  public\r\n    DimCount: NativeInt external name 'dimcount';\r\n    ElType: TTypeInfo external name 'eltype';\r\n  end;\r\n\r\n  TParamFlag     = (\r\n    pfVar,     // 2^0 = 1\r\n    pfConst,   // 2^1 = 2\r\n    pfOut,     // 2^2 = 4\r\n    pfArray    // 2^3 = 8\r\n    //pfAddress,pfReference,\r\n    );\r\n  TParamFlags = set of TParamFlag;\r\n\r\n  { TProcedureParam }\r\n\r\n  TProcedureParam = class external name 'anonymous'\r\n  public\r\n    Name: String external name 'name';\r\n    TypeInfo: TTypeInfo external name 'typeinfo';\r\n    Flags: NativeInt external name 'flags'; // TParamFlags as bit vector\r\n  end;\r\n\r\n  TProcedureParams = array of TProcedureParam;\r\n\r\n  TProcedureFlag = (\r\n    pfStatic,   // 2^0 = 1\r\n    pfVarargs,  // 2^1 = 2\r\n    pfExternal  // 2^2 = 4  name may be an expression\r\n    );\r\n  TProcedureFlags = set of TProcedureFlag;\r\n\r\n  { TProcedureSignature }\r\n\r\n  TProcedureSignature = class external name 'anonymous'\r\n  public\r\n    Params: TProcedureParams external name 'params'; // can be null\r\n    ResultType: TTypeInfo external name 'resulttype'; // can be null\r\n    Flags: NativeInt external name 'flags'; // TProcedureFlags as bit vector\r\n  end;\r\n\r\n  { TTypeInfoProcVar - Kind = tkProcVar }\r\n\r\n  TTypeInfoProcVar = class external name 'rtl.tTypeInfoProcVar'(TTypeInfo)\r\n  public\r\n    ProcSig: TProcedureSignature external name 'procsig';\r\n  end;\r\n\r\n  { TTypeInfoRefToProcVar - Kind = tkRefToProcVar }\r\n\r\n  TTypeInfoRefToProcVar = class external name 'rtl.tTypeInfoRefToProcVar'(TTypeInfoProcVar)\r\n  end;\r\n\r\n  TMethodKind = (\r\n    mkProcedure,     // 0  default\r\n    mkFunction,      // 1\r\n    mkConstructor,   // 2\r\n    mkDestructor,    // 3\r\n    mkClassProcedure,// 4\r\n    mkClassFunction  // 5\r\n    //mkClassConstructor,mkClassDestructor,mkOperatorOverload\r\n    );\r\n  TMethodKinds = set of TMethodKind;\r\n\r\n  { TTypeInfoMethodVar - Kind = tkMethod }\r\n\r\n  TTypeInfoMethodVar = class external name 'rtl.tTypeInfoMethodVar'(TTypeInfoProcVar)\r\n  public\r\n    MethodKind: TMethodKind external name 'methodkind';\r\n  end;\r\n\r\n  TTypeMemberKind = (\r\n    tmkUnknown,  // 0\r\n    tmkField,    // 1\r\n    tmkMethod,   // 2\r\n    tmkProperty  // 3\r\n    );\r\n  TTypeMemberKinds = set of TTypeMemberKind;\r\n\r\n  { TTypeMember }\r\n\r\n  TTypeMember = class external name 'rtl.tTypeMember'\r\n  public\r\n    Name: String external name 'name';\r\n    Kind: TTypeMemberKind external name 'kind';\r\n    Attributes: TTypeInfoAttributes external name 'attr'; // can be undefined\r\n  end;\r\n  TTypeMemberDynArray = array of TTypeMember;\r\n\r\n  { TTypeMemberField - Kind = tmkField }\r\n\r\n  TTypeMemberField = class external name 'rtl.tTypeMemberField'(TTypeMember)\r\n  public\r\n    TypeInfo: TTypeInfo external name 'typeinfo';\r\n  end;\r\n\r\n  { TTypeMemberMethod - Kind = tmkMethod }\r\n\r\n  TTypeMemberMethod = class external name 'rtl.tTypeMemberMethod'(TTypeMember)\r\n  public\r\n    MethodKind: TMethodKind external name 'methodkind';\r\n    ProcSig: TProcedureSignature external name 'procsig';\r\n  end;\r\n  TTypeMemberMethodDynArray = array of TTypeMemberMethod;\r\n\r\nconst\r\n  pfGetFunction = 1; // getter is a function\r\n  pfSetProcedure = 2; // setter is a procedure\r\n  // stored is a 2-bit vector:\r\n  pfStoredFalse = 4; // stored false, never\r\n  pfStoredField = 8; // stored field, field name is in Stored\r\n  pfStoredFunction = 12; // stored function, function name is in Stored\r\n  pfHasIndex = 16; { if getter is function, append Index as last param\r\n                     if setter is function, append Index as second last param }\r\ntype\r\n  { TTypeMemberProperty - Kind = tmkProperty }\r\n\r\n  TTypeMemberProperty = class external name 'rtl.tTypeMemberProperty'(TTypeMember)\r\n  public\r\n    TypeInfo: TTypeInfo external name 'typeinfo';\r\n    Flags: NativeInt external name 'flags'; // bit vector, see pf constants above\r\n    Params: TProcedureParams external name 'params'; // can be null or undefined\r\n    Index: JSValue external name 'index'; // can be undefined\r\n    Getter: String external name 'getter'; // name of field or function\r\n    Setter: String external name 'setter'; // name of field or function\r\n    Stored: String external name 'stored'; // name of field or function, can be undefined\r\n    Default: JSValue external name 'Default'; // can be undefined\r\n  end;\r\n  TTypeMemberPropertyDynArray = array of TTypeMemberProperty;\r\n\r\n  { TTypeMembers }\r\n\r\n  TTypeMembers = class external name 'rtl.tTypeMembers'\r\n  private\r\n    function GetItems(Name: String): TTypeMember; external name '[]';\r\n    procedure SetItems(Name: String; const AValue: TTypeMember); external name '[]';\r\n  public\r\n    property Members[Name: String]: TTypeMember read GetItems write SetItems; default;\r\n  end;\r\n\r\n  { TTypeInfoStruct }\r\n\r\n  TTypeInfoStruct = class external name 'rtl.tTypeInfoStruct'(TTypeInfo)\r\n  private\r\n    FFieldCount: NativeInt external name 'fields.length';\r\n    FMethodCount: NativeInt external name 'methods.length';\r\n    FPropCount: NativeInt external name 'properties.length';\r\n  public\r\n    Members: TTypeMembers external name 'members';\r\n    Names: TStringDynArray external name 'names'; // all member names with TTypeInfo\r\n    Fields: TStringDynArray external name 'fields';\r\n    Methods: TStringDynArray external name 'methods';\r\n    Properties: TStringDynArray external name 'properties';\r\n    property FieldCount: NativeInt read FFieldCount;\r\n    function GetField(Index: NativeInt): TTypeMemberField; external name 'getField';\r\n    function AddField(aName: String; aType: TTypeInfo; Options: TJSObject = nil\r\n      ): TTypeMemberField; external name 'addField';\r\n    property MethodCount: NativeInt read FMethodCount;\r\n    function GetMethod(Index: NativeInt): TTypeMemberMethod; external name 'getMethod';\r\n    function AddMethod(aName: String; MethodKind: TMethodKind = mkProcedure;\r\n      Params: TJSArray = nil; ResultType: TTypeInfo = nil;\r\n      Options: TJSObject = nil): TTypeMemberMethod; external name 'addMethod';\r\n    property PropCount: NativeInt read FPropCount;\r\n    function GetProp(Index: NativeInt): TTypeMemberProperty; external name 'getProperty';\r\n    function AddProperty(aName: String; Flags: NativeInt; ResultType: TTypeInfo;\r\n      Getter, Setter: String; Options: TJSObject = nil): TTypeMemberProperty; external name 'addProperty';\r\n  end;\r\n\r\n  { TTypeInfoRecord - Kind = tkRecord }\r\n\r\n  TTypeInfoRecord = class external name 'rtl.tTypeInfoRecord'(TTypeInfoStruct)\r\n  public\r\n    RecordType: TJSObject external name 'record';\r\n  end;\r\n\r\n  { TTypeInfoClass - Kind = tkClass }\r\n\r\n  TTypeInfoClass = class external name 'rtl.tTypeInfoClass'(TTypeInfoStruct)\r\n  public\r\n    ClassType: TClass external name 'class';\r\n    Ancestor: TTypeInfoClass external name 'ancestor';\r\n  end;\r\n\r\n  { TTypeInfoClassRef - class-of, Kind = tkClassRef }\r\n\r\n  TTypeInfoClassRef = class external name 'rtl.tTypeInfoClassRef'(TTypeInfo)\r\n  public\r\n    InstanceType: TTypeInfo external name 'instancetype';\r\n  end;\r\n\r\n  { TTypeInfoPointer - Kind = tkPointer }\r\n\r\n  TTypeInfoPointer = class external name 'rtl.tTypeInfoPointer'(TTypeInfo)\r\n  public\r\n    RefType: TTypeInfo external name 'reftype'; // can be null\r\n  end;\r\n\r\n  { TTypeInfoInterface - Kind = tkInterface }\r\n\r\n  TTypeInfoInterface = class external name 'rtl.tTypeInfoInterface'(TTypeInfoStruct)\r\n  public\r\n    InterfaceType: TJSObject external name 'interface';\r\n    Ancestor: TTypeInfoInterface external name 'ancestor';\r\n  end;\r\n\r\n  { TTypeInfoHelper - Kind = tkHelper }\r\n\r\n  TTypeInfoHelper = class external name 'rtl.tTypeInfoHelper'(TTypeInfoStruct)\r\n  public\r\n    HelperType: TJSObject external name 'helper';\r\n    Ancestor: TTypeInfoHelper external name 'ancestor';\r\n    HelperFor: TTypeInfo external name 'helperfor';\r\n  end;\r\n\r\n  EPropertyError  = class(Exception);\r\n\r\nfunction GetClassMembers(aTIStruct: TTypeInfoStruct): TTypeMemberDynArray;\r\nfunction GetClassMember(aTIStruct: TTypeInfoStruct; const aName: String): TTypeMember;\r\nfunction GetInstanceMethod(Instance: TObject; const aName: String): Pointer;\r\nfunction GetClassMethods(aTIStruct: TTypeInfoStruct): TTypeMemberMethodDynArray;\r\nfunction CreateMethod(Instance: TObject; FuncName: String): Pointer; external name 'rtl.createCallback';\r\n\r\nfunction GetInterfaceMembers(aTIInterface: TTypeInfoInterface): TTypeMemberDynArray;\r\nfunction GetInterfaceMember(aTIInterface: TTypeInfoInterface; const aName: String): TTypeMember;\r\nfunction GetInterfaceMethods(aTIInterface: TTypeInfoInterface): TTypeMemberMethodDynArray;\r\n\r\nfunction GetRTTIAttributes(const Attributes: TTypeInfoAttributes): TCustomAttributeArray;\r\n\r\nfunction GetPropInfos(aTIStruct: TTypeInfoStruct): TTypeMemberPropertyDynArray;\r\nfunction GetPropList(aTIStruct: TTypeInfoStruct; TypeKinds: TTypeKinds; Sorted: boolean = true): TTypeMemberPropertyDynArray;\r\nfunction GetPropList(aTIStruct: TTypeInfoStruct): TTypeMemberPropertyDynArray;\r\nfunction GetPropList(AClass: TClass): TTypeMemberPropertyDynArray;\r\nfunction GetPropList(Instance: TObject): TTypeMemberPropertyDynArray;\r\n\r\nfunction GetPropInfo(TI: TTypeInfoStruct; const PropName: String): TTypeMemberProperty;\r\nfunction GetPropInfo(TI: TTypeInfoStruct; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\nfunction GetPropInfo(Instance: TObject; const PropName: String): TTypeMemberProperty;\r\nfunction GetPropInfo(Instance: TObject; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\nfunction GetPropInfo(aClass: TClass; const PropName: String): TTypeMemberProperty;\r\nfunction GetPropInfo(aClass: TClass; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\n\r\nfunction FindPropInfo(Instance: TObject; const PropName: String): TTypeMemberProperty;\r\nfunction FindPropInfo(Instance: TObject; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\nfunction FindPropInfo(aClass: TClass; const PropName: String): TTypeMemberProperty;\r\nfunction FindPropInfo(aClass: TClass; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\n\r\n// Property information routines.\r\nFunction IsStoredProp(Instance: TObject; const PropInfo: TTypeMemberProperty): Boolean;\r\nFunction IsStoredProp(Instance: TObject; const PropName: string): Boolean;\r\nfunction IsPublishedProp(Instance: TObject; const PropName: String): Boolean;\r\nfunction IsPublishedProp(aClass: TClass; const PropName: String): Boolean;\r\nfunction PropType(Instance: TObject; const PropName: string): TTypeKind;\r\nfunction PropType(aClass: TClass; const PropName: string): TTypeKind;\r\nfunction PropIsType(Instance: TObject; const PropName: string; const TypeKind: TTypeKind): Boolean;\r\nfunction PropIsType(aClass: TClass; const PropName: string; const TypeKind: TTypeKind): Boolean;\r\n\r\nfunction GetJSValueProp(Instance: TJSObject; TI: TTypeInfoStruct; const PropName: String): JSValue;\r\nfunction GetJSValueProp(Instance: TJSObject; const PropInfo: TTypeMemberProperty): JSValue;\r\nfunction GetJSValueProp(Instance: TObject; const PropName: String): JSValue;\r\nfunction GetJSValueProp(Instance: TObject; const PropInfo: TTypeMemberProperty): JSValue;\r\nprocedure SetJSValueProp(Instance: TJSObject; TI: TTypeInfoStruct; const PropName: String; Value: JSValue);\r\nprocedure SetJSValueProp(Instance: TJSObject; const PropInfo: TTypeMemberProperty; Value: JSValue);\r\nprocedure SetJSValueProp(Instance: TObject; const PropName: String; Value: JSValue);\r\nprocedure SetJSValueProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: JSValue);\r\n\r\nfunction GetNativeIntProp(Instance: TObject; const PropName: String): NativeInt;\r\nfunction GetNativeIntProp(Instance: TObject; const PropInfo: TTypeMemberProperty): NativeInt;\r\nprocedure SetNativeIntProp(Instance: TObject; const PropName: String; Value: NativeInt);\r\nprocedure SetNativeIntProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: NativeInt);\r\n\r\nfunction GetOrdProp(Instance: TObject; const PropName: String): longint;\r\nfunction GetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty): longint;\r\nprocedure SetOrdProp(Instance: TObject; const PropName: String; Value: longint);\r\nprocedure SetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: longint);\r\n\r\nfunction GetEnumProp(Instance: TObject; const PropName: String): String;\r\nfunction GetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String;\r\nprocedure SetEnumProp(Instance: TObject; const PropName: String; const Value: String);\r\nprocedure SetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty; const Value: String);\r\n// Auxiliary routines, which may be useful\r\nfunction GetEnumName(TypeInfo: TTypeInfoEnum; Value: Integer): String;\r\nfunction GetEnumValue(TypeInfo: TTypeInfoEnum; const Name: string): Longint;\r\nfunction GetEnumNameCount(TypeInfo: TTypeInfoEnum): Longint;\r\n\r\nfunction GetSetProp(Instance: TObject; const PropName: String): String; overload;\r\nfunction GetSetProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String; overload;\r\nfunction GetSetPropArray(Instance: TObject; const PropName: String): TIntegerDynArray; overload;\r\nfunction GetSetPropArray(Instance: TObject; const PropInfo: TTypeMemberProperty): TIntegerDynArray; overload;\r\nprocedure SetSetPropArray(Instance: TObject; const PropName: String; const Arr: TIntegerDynArray); overload;\r\nprocedure SetSetPropArray(Instance: TObject; const PropInfo: TTypeMemberProperty; const Arr: TIntegerDynArray); overload;\r\n\r\nfunction GetBoolProp(Instance: TObject; const PropName: String): boolean;\r\nfunction GetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty): boolean;\r\nprocedure SetBoolProp(Instance: TObject; const PropName: String; Value: boolean);\r\nprocedure SetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: boolean);\r\n\r\nfunction GetStrProp(Instance: TObject; const PropName: String): String;\r\nfunction GetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String;\r\nprocedure SetStrProp(Instance: TObject; const PropName: String; Value: String);\r\nprocedure SetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: String);\r\n\r\nfunction GetStringProp(Instance: TObject; const PropName: String): String; deprecated; // use GetStrProp\r\nfunction GetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String; deprecated; // use GetStrProp\r\nprocedure SetStringProp(Instance: TObject; const PropName: String; Value: String); deprecated; // use GetStrProp\r\nprocedure SetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: String); deprecated; // use GetStrProp\r\n\r\nfunction  GetFloatProp(Instance: TObject; const PropName: string): Double;\r\nfunction  GetFloatProp(Instance: TObject; PropInfo : TTypeMemberProperty) : Double;\r\nprocedure SetFloatProp(Instance: TObject; const PropName: string; Value: Double);\r\nprocedure SetFloatProp(Instance: TObject; PropInfo : TTypeMemberProperty;  Value : Double);\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropName: String): TObject;\r\nfunction GetObjectProp(Instance: TObject; const PropName: String; MinClass: TClass): TObject;\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty):  TObject;\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; MinClass: TClass):  TObject;\r\nprocedure SetObjectProp(Instance: TObject; const PropName: String; Value: TObject) ;\r\nprocedure SetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: TObject);\r\n\r\nfunction GetMethodProp(Instance: TObject; PropInfo: TTypeMemberProperty): TMethod;\r\nfunction GetMethodProp(Instance: TObject; const PropName: string): TMethod;\r\nprocedure SetMethodProp(Instance: TObject; PropInfo: TTypeMemberProperty;  const Value : TMethod);\r\nprocedure SetMethodProp(Instance: TObject; const PropName: string; const Value: TMethod);\r\n\r\n\r\nimplementation\r\n\r\nfunction GetClassMembers(aTIStruct: TTypeInfoStruct): TTypeMemberDynArray;\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i: Integer;\r\n  PropName: String;\r\n  Names: TJSObject;\r\nbegin\r\n  Result:=nil;\r\n  Names:=TJSObject.new;\r\n  C:=aTIStruct;\r\n  while C<>nil do\r\n  begin\r\n    for i:=0 to length(C.Names)-1 do\r\n    begin\r\n      PropName:=C.Names[i];\r\n      if Names.hasOwnProperty(PropName) then continue;\r\n      TJSArray(Result).push(C.Members[PropName]);\r\n      Names[PropName]:=true;\r\n    end;\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetClassMember(aTIStruct: TTypeInfoStruct; const aName: String): TTypeMember;\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i: Integer;\r\nbegin\r\n  // quick search: case sensitive\r\n  C:=aTIStruct;\r\n  while C<>nil do\r\n  begin\r\n    if TJSObject(C.Members).hasOwnProperty(aName) then\r\n      exit(C.Members[aName]);\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n  // slow search: case insensitive\r\n  C:=aTIStruct;\r\n  while C<>nil do\r\n  begin\r\n    for i:=0 to length(C.Names)-1 do\r\n      if CompareText(C.Names[i],aName)=0 then\r\n        exit(C.Members[C.Names[i]]);\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n  Result:=nil;\r\nend;\r\n\r\nfunction GetInstanceMethod(Instance: TObject; const aName: String): Pointer;\r\nvar\r\n  TI: TTypeMember;\r\nbegin\r\n  if Instance=nil then exit(nil);\r\n  TI:=GetClassMember(TypeInfo(Instance),aName);\r\n  if not (TI is TTypeMemberMethod) then exit(nil);\r\n  Result:=CreateMethod(Instance,TI.Name); // Note: use TI.Name for the correct case!\r\nend;\r\n\r\nfunction GetClassMethods(aTIStruct: TTypeInfoStruct): TTypeMemberMethodDynArray;\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  C:=aTIStruct;\r\n  while C<>nil do\r\n  begin\r\n    inc(Cnt,C.MethodCount);\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  C:=aTIStruct;\r\n  i:=0;\r\n  while C<>nil do\r\n  begin\r\n    for j:=0 to C.MethodCount-1 do\r\n    begin\r\n      Result[i]:=TTypeMemberMethod(C.Members[C.Methods[j]]);\r\n      inc(i);\r\n    end;\r\n    if not (C is TTypeInfoClass) then break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetInterfaceMembers(aTIInterface: TTypeInfoInterface\r\n  ): TTypeMemberDynArray;\r\nvar\r\n  Intf: TTypeInfoInterface;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    inc(Cnt,length(Intf.Names));\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  Intf:=aTIInterface;\r\n  i:=0;\r\n  while Intf<>nil do\r\n  begin\r\n    for j:=0 to length(Intf.Names)-1 do\r\n    begin\r\n      Result[i]:=Intf.Members[Intf.Names[j]];\r\n      inc(i);\r\n    end;\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetInterfaceMember(aTIInterface: TTypeInfoInterface;\r\n  const aName: String): TTypeMember;\r\nvar\r\n  Intf: TTypeInfoInterface;\r\n  i: Integer;\r\nbegin\r\n  // quick search: case sensitive\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    if TJSObject(Intf.Members).hasOwnProperty(aName) then\r\n      exit(Intf.Members[aName]);\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  // slow search: case insensitive\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    for i:=0 to length(Intf.Names)-1 do\r\n      if CompareText(Intf.Names[i],aName)=0 then\r\n        exit(Intf.Members[Intf.Names[i]]);\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  Result:=nil;\r\nend;\r\n\r\nfunction GetInterfaceMethods(aTIInterface: TTypeInfoInterface\r\n  ): TTypeMemberMethodDynArray;\r\nvar\r\n  Intf: TTypeInfoInterface;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    inc(Cnt,Intf.MethodCount);\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  Intf:=aTIInterface;\r\n  i:=0;\r\n  while Intf<>nil do\r\n  begin\r\n    for j:=0 to Intf.MethodCount-1 do\r\n    begin\r\n      Result[i]:=TTypeMemberMethod(Intf.Members[Intf.Methods[j]]);\r\n      inc(i);\r\n    end;\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\nend;\r\n\r\ntype\r\n  TCreatorAttribute = class external name 'attr'\r\n    class function Create(const ProcName: string): TCustomAttribute; overload; external name '$create';\r\n    class function Create(const ProcName: string; Params: jsvalue): TCustomAttribute; overload; external name '$create';\r\n  end;\r\n  TCreatorAttributeClass = class of TCreatorAttribute;\r\n\r\nfunction GetRTTIAttributes(const Attributes: TTypeInfoAttributes\r\n  ): TCustomAttributeArray;\r\nvar\r\n  i, len: Integer;\r\n  AttrClass: TCreatorAttributeClass;\r\n  ProcName: String;\r\n  Attr: TCustomAttribute;\r\nbegin\r\n  Result:=nil;\r\n  if Attributes=Undefined then exit;\r\n  i:=0;\r\n  len:=length(Attributes);\r\n  while i<len do\r\n    begin\r\n    AttrClass:=TCreatorAttributeClass(Attributes[i]);\r\n    inc(i);\r\n    ProcName:=String(Attributes[i]);\r\n    inc(i);\r\n    if (i<len) and isArray(Attributes[i]) then\r\n      begin\r\n      Attr:=AttrClass.Create(ProcName,Attributes[i]);\r\n      inc(i);\r\n      end\r\n    else\r\n      Attr:=AttrClass.Create(ProcName);\r\n    Insert(Attr,Result,length(Result));\r\n    end;\r\nend;\r\n\r\nfunction GetPropInfos(aTIStruct: TTypeInfoStruct): TTypeMemberPropertyDynArray;\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i: Integer;\r\n  Names: TJSObject;\r\n  PropName: String;\r\nbegin\r\n  Result:=nil;\r\n  C:=aTIStruct;\r\n  Names:=TJSObject.new;\r\n  while C<>nil do\r\n  begin\r\n    for i:=0 to C.PropCount-1 do\r\n    begin\r\n      PropName:=C.Properties[i];\r\n      if Names.hasOwnProperty(PropName) then continue;\r\n      TJSArray(Result).push(TTypeMemberProperty(C.Members[PropName]));\r\n      Names[PropName]:=true;\r\n    end;\r\n    if not (C is TTypeInfoClass) then\r\n      break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetPropList(aTIStruct: TTypeInfoStruct; TypeKinds: TTypeKinds;\r\n  Sorted: boolean): TTypeMemberPropertyDynArray;\r\n\r\n  function NameSort(a,b: JSValue): NativeInt;\r\n  begin\r\n    if TTypeMemberProperty(a).Name<TTypeMemberProperty(b).Name then\r\n      Result:=-1\r\n    else if TTypeMemberProperty(a).Name>TTypeMemberProperty(b).Name then\r\n      Result:=1\r\n    else\r\n      Result:=0;\r\n  end;\r\n\r\nvar\r\n  C: TTypeInfoStruct;\r\n  i: Integer;\r\n  Names: TJSObject;\r\n  PropName: String;\r\n  Prop: TTypeMemberProperty;\r\nbegin\r\n  Result:=nil;\r\n  C:=aTIStruct;\r\n  Names:=TJSObject.new;\r\n  while C<>nil do\r\n  begin\r\n    for i:=0 to C.PropCount-1 do\r\n    begin\r\n      PropName:=C.Properties[i];\r\n      if Names.hasOwnProperty(PropName) then continue;\r\n      Prop:=TTypeMemberProperty(C.Members[PropName]);\r\n      if not (Prop.TypeInfo.Kind in TypeKinds) then continue;\r\n      TJSArray(Result).push(Prop);\r\n      Names[PropName]:=true;\r\n    end;\r\n    if not (C is TTypeInfoClass) then\r\n      break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n  if Sorted then\r\n    TJSArray(Result).sort(@NameSort);\r\nend;\r\n\r\nfunction GetPropList(aTIStruct: TTypeInfoStruct): TTypeMemberPropertyDynArray;\r\nbegin\r\n  Result:=GetPropInfos(aTIStruct);\r\nend;\r\n\r\nfunction GetPropList(AClass: TClass): TTypeMemberPropertyDynArray;\r\nbegin\r\n  Result:=GetPropInfos(TypeInfo(AClass));\r\nend;\r\n\r\nfunction GetPropList(Instance: TObject): TTypeMemberPropertyDynArray;\r\nbegin\r\n  Result:=GetPropList(Instance.ClassType);\r\nend;\r\n\r\nfunction GetPropInfo(TI: TTypeInfoStruct; const PropName: String\r\n  ): TTypeMemberProperty;\r\nvar\r\n  m: TTypeMember;\r\n  i: Integer;\r\n  C: TTypeInfoStruct;\r\nbegin\r\n  // quick search case sensitive\r\n  C:=TI;\r\n  while C<>nil do\r\n  begin\r\n    m:=C.Members[PropName];\r\n    if m is TTypeMemberProperty then\r\n      exit(TTypeMemberProperty(m));\r\n    if not (C is TTypeInfoClass) then\r\n      break;\r\n    C:=TTypeInfoClass(C).Ancestor;\r\n  end;\r\n\r\n  // slow search case insensitive\r\n  Result:=nil;\r\n  repeat\r\n    for i:=0 to TI.PropCount-1 do\r\n      if CompareText(PropName,TI.Properties[i])=0 then\r\n      begin\r\n        m:=TI.Members[TI.Properties[i]];\r\n        if m is TTypeMemberProperty then\r\n          Result:=TTypeMemberProperty(m);\r\n        exit;\r\n      end;\r\n    if not (TI is TTypeInfoClass) then\r\n      break;\r\n    TI:=TTypeInfoClass(TI).Ancestor;\r\n  until TI=nil;\r\nend;\r\n\r\nfunction GetPropInfo(TI: TTypeInfoStruct; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TI,PropName);\r\n  if (Kinds<>[]) and (Result<>nil) and not (Result.TypeInfo.Kind in Kinds) then\r\n    Result:=nil;\r\nend;\r\n\r\nfunction GetPropInfo(Instance: TObject; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance),PropName,[]);\r\nend;\r\n\r\nfunction GetPropInfo(Instance: TObject; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance),PropName,Kinds);\r\nend;\r\n\r\nfunction GetPropInfo(aClass: TClass; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(AClass),PropName,[]);\r\nend;\r\n\r\nfunction GetPropInfo(aClass: TClass; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(AClass),PropName,Kinds);\r\nend;\r\n\r\nfunction FindPropInfo(Instance: TObject; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance), PropName);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction FindPropInfo(Instance: TObject; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance), PropName, Kinds);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction FindPropInfo(aClass: TClass; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(aClass), PropName);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction FindPropInfo(aClass: TClass; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(aClass), PropName, Kinds);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction IsStoredProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): Boolean;\r\ntype\r\n  TIsStored = function: Boolean of object;\r\nbegin\r\n  case PropInfo.Flags and 12 of\r\n  0: Result:=true;\r\n  4: Result:=false;\r\n  8: Result:=Boolean(TJSObject(Instance)[PropInfo.Stored]);\r\n  else Result:=TIsStored(TJSObject(Instance)[PropInfo.Stored])();\r\n  end;\r\nend;\r\n\r\nfunction IsStoredProp(Instance: TObject; const PropName: string): Boolean;\r\nbegin\r\n  Result:=IsStoredProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction IsPublishedProp(Instance: TObject; const PropName: String): Boolean;\r\nbegin\r\n  Result:=GetPropInfo(Instance,PropName)<>nil;\r\nend;\r\n\r\nfunction IsPublishedProp(aClass: TClass; const PropName: String): Boolean;\r\nbegin\r\n  Result:=GetPropInfo(aClass,PropName)<>nil;\r\nend;\r\n\r\nfunction PropType(Instance: TObject; const PropName: string): TTypeKind;\r\nbegin\r\n  Result:=FindPropInfo(Instance,PropName).TypeInfo.Kind;\r\nend;\r\n\r\nfunction PropType(aClass: TClass; const PropName: string): TTypeKind;\r\nbegin\r\n  Result:=FindPropInfo(aClass,PropName).TypeInfo.Kind;\r\nend;\r\n\r\nfunction PropIsType(Instance: TObject; const PropName: string;\r\n  const TypeKind: TTypeKind): Boolean;\r\nbegin\r\n  Result:=PropType(Instance,PropName)=TypeKind;\r\nend;\r\n\r\nfunction PropIsType(aClass: TClass; const PropName: string;\r\n  const TypeKind: TTypeKind): Boolean;\r\nbegin\r\n  Result:=PropType(aClass,PropName)=TypeKind;\r\nend;\r\n\r\ntype\r\n  TGetterKind = (\r\n    gkNone,\r\n    gkField,\r\n    gkFunction,\r\n    gkFunctionWithParams\r\n  );\r\n\r\nfunction GetPropGetterKind(const PropInfo: TTypeMemberProperty): TGetterKind;\r\nbegin\r\n  if PropInfo.Getter='' then\r\n    Result:=gkNone\r\n  else if (pfGetFunction and PropInfo.Flags)>0 then\r\n    begin\r\n    if length(PropInfo.Params)>0 then\r\n      Result:=gkFunctionWithParams\r\n    else\r\n      Result:=gkFunction;\r\n    end\r\n  else\r\n    Result:=gkField;\r\nend;\r\n\r\ntype\r\n  TSetterKind = (\r\n    skNone,\r\n    skField,\r\n    skProcedure,\r\n    skProcedureWithParams\r\n  );\r\n\r\nfunction GetPropSetterKind(const PropInfo: TTypeMemberProperty): TSetterKind;\r\nbegin\r\n  if PropInfo.Setter='' then\r\n    Result:=skNone\r\n  else if (pfSetProcedure and PropInfo.Flags)>0 then\r\n    begin\r\n    if length(PropInfo.Params)>0 then\r\n      Result:=skProcedureWithParams\r\n    else\r\n      Result:=skProcedure;\r\n    end\r\n  else\r\n    Result:=skField;\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TJSObject; TI: TTypeInfoStruct;\r\n  const PropName: String): JSValue;\r\nvar\r\n  PropInfo: TTypeMemberProperty;\r\nbegin\r\n  PropInfo:=GetPropInfo(TI,PropName);\r\n  if PropInfo=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\n  Result:=GetJSValueProp(Instance,PropInfo);\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TJSObject;\r\n  const PropInfo: TTypeMemberProperty): JSValue;\r\ntype\r\n  TGetter = function: JSValue of object;\r\n  TGetterWithIndex = function(Index: JSValue): JSValue of object;\r\nvar\r\n  gk: TGetterKind;\r\nbegin\r\n  gk:=GetPropGetterKind(PropInfo);\r\n  case gk of\r\n    gkNone:\r\n      raise EPropertyError.CreateFmt(SCantReadPropertyS, [PropInfo.Name]);\r\n    gkField:\r\n      Result:=Instance[PropInfo.Getter];\r\n    gkFunction:\r\n      if (pfHasIndex and PropInfo.Flags)>0 then\r\n        Result:=TGetterWithIndex(Instance[PropInfo.Getter])(PropInfo.Index)\r\n      else\r\n        Result:=TGetter(Instance[PropInfo.Getter])();\r\n    gkFunctionWithParams:\r\n      raise EPropertyError.CreateFmt(SIndexedPropertyNeedsParams, [PropInfo.Name]);\r\n  end;\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TObject; const PropName: String): JSValue;\r\nbegin\r\n  Result:=GetJSValueProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): JSValue;\r\nbegin\r\n  Result:=GetJSValueProp(TJSObject(Instance),PropInfo);\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TJSObject; TI: TTypeInfoStruct;\r\n  const PropName: String; Value: JSValue);\r\nvar\r\n  PropInfo: TTypeMemberProperty;\r\nbegin\r\n  PropInfo:=GetPropInfo(TI,PropName);\r\n  if PropInfo=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TJSObject;\r\n  const PropInfo: TTypeMemberProperty; Value: JSValue);\r\ntype\r\n  TSetter = procedure(Value: JSValue) of object;\r\n  TSetterWithIndex = procedure(Index, Value: JSValue) of object;\r\nvar\r\n  sk: TSetterKind;\r\nbegin\r\n  sk:=GetPropSetterKind(PropInfo);\r\n  case sk of\r\n    skNone:\r\n      raise EPropertyError.CreateFmt(SCantWritePropertyS, [PropInfo.Name]);\r\n    skField:\r\n      Instance[PropInfo.Setter]:=Value;\r\n    skProcedure:\r\n      if (pfHasIndex and PropInfo.Flags)>0 then\r\n        TSetterWithIndex(Instance[PropInfo.Setter])(PropInfo.Index,Value)\r\n      else\r\n        TSetter(Instance[PropInfo.Setter])(Value);\r\n    skProcedureWithParams:\r\n      raise EPropertyError.CreateFmt(SIndexedPropertyNeedsParams, [PropInfo.Name]);\r\n  end;\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TObject; const PropName: String;\r\n  Value: JSValue);\r\nbegin\r\n  SetJSValueProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TObject;\r\n  const PropInfo: TTypeMemberProperty; Value: JSValue);\r\nbegin\r\n  SetJSValueProp(TJSObject(Instance),PropInfo,Value);\r\nend;\r\n\r\nfunction GetNativeIntProp(Instance: TObject; const PropName: String): NativeInt;\r\nbegin\r\n  Result:=GetNativeIntProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetNativeIntProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): NativeInt;\r\nbegin\r\n  Result:=NativeInt(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetNativeIntProp(Instance: TObject; const PropName: String;\r\n  Value: NativeInt);\r\nbegin\r\n  SetJSValueProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetNativeIntProp(Instance: TObject;\r\n  const PropInfo: TTypeMemberProperty; Value: NativeInt);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetOrdProp(Instance: TObject; const PropName: String): longint;\r\nbegin\r\n  Result:=GetOrdProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): longint;\r\nvar\r\n  o: TJSObject;\r\n  Key: String;\r\n  n: NativeInt;\r\nbegin\r\n  if PropInfo.TypeInfo.Kind=tkSet then\r\n  begin\r\n    // a set is a JS object, with the following property: o[ElementDecimal]=true\r\n    o:=TJSObject(GetJSValueProp(Instance,PropInfo));\r\n    Result:=0;\r\n    for Key in o do\r\n    begin\r\n      n:=parseInt(Key,10);\r\n      if n<32 then\r\n        Result:=Result+(1 shl n);\r\n    end;\r\n  end else\r\n    Result:=longint(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetOrdProp(Instance: TObject; const PropName: String; Value: longint);\r\nbegin\r\n  SetOrdProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: longint);\r\nvar\r\n  o: TJSObject;\r\n  i: Integer;\r\nbegin\r\n  if PropInfo.TypeInfo.Kind=tkSet then\r\n  begin\r\n    o:=TJSObject.new;\r\n    for i:=0 to 31 do\r\n      if (1 shl i) and Value>0 then\r\n        o[str(i)]:=true;\r\n    SetJSValueProp(Instance,PropInfo,o);\r\n  end else\r\n    SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetEnumProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetEnumProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String;\r\nvar\r\n  n: NativeInt;\r\n  TIEnum: TTypeInfoEnum;\r\nbegin\r\n  TIEnum:=PropInfo.TypeInfo as TTypeInfoEnum;\r\n  n:=NativeInt(GetJSValueProp(Instance,PropInfo));\r\n  if (n>=TIEnum.MinValue) and (n<=TIEnum.MaxValue) then\r\n    Result:=TIEnum.EnumType.IntToName[n]\r\n  else\r\n    Result:=str(n);\r\nend;\r\n\r\nprocedure SetEnumProp(Instance: TObject; const PropName: String;\r\n  const Value: String);\r\nbegin\r\n  SetEnumProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  const Value: String);\r\nvar\r\n  TIEnum: TTypeInfoEnum;\r\n  n: NativeInt;\r\nbegin\r\n  TIEnum:=PropInfo.TypeInfo as TTypeInfoEnum;\r\n  n:=TIEnum.EnumType.NameToInt[Value];\r\n  if not isUndefined(n) then\r\n    SetJSValueProp(Instance,PropInfo,n);\r\nend;\r\n\r\nfunction GetEnumName(TypeInfo: TTypeInfoEnum; Value: Integer): String;\r\nbegin\r\n  Result:=TypeInfo.EnumType.IntToName[Value];\r\nend;\r\n\r\nfunction GetEnumValue(TypeInfo: TTypeInfoEnum; const Name: string): Longint;\r\nbegin\r\n  Result:=TypeInfo.EnumType.NameToInt[Name];\r\nend;\r\n\r\nfunction GetEnumNameCount(TypeInfo: TTypeInfoEnum): Longint;\r\nvar\r\n  o: TJSObject;\r\n  l, r: LongInt;\r\nbegin\r\n  o:=TJSObject(TypeInfo.EnumType);\r\n  // as of pas2js 1.0 the RTTI does not contain a min/max value\r\n  // -> use exponential search\r\n  // ToDo: adapt this once enums with gaps are supported\r\n  Result:=1;\r\n  while o.hasOwnProperty(String(JSValue(Result))) do\r\n    Result:=Result*2;\r\n  l:=Result div 2;\r\n  r:=Result;\r\n  while l<=r do\r\n    begin\r\n    Result:=(l+r) div 2;\r\n    if o.hasOwnProperty(String(JSValue(Result))) then\r\n      l:=Result+1\r\n    else\r\n      r:=Result-1;\r\n    end;\r\n  if o.hasOwnProperty(String(JSValue(Result))) then\r\n    inc(Result);\r\nend;\r\n\r\nfunction GetSetProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetSetProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetSetProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): String;\r\nvar\r\n  o: TJSObject;\r\n  key, Value: String;\r\n  n: NativeInt;\r\n  TIEnum: TTypeInfoEnum;\r\n  TISet: TTypeInfoSet;\r\nbegin\r\n  Result:='';\r\n  // get enum type if available\r\n  TISet:=PropInfo.TypeInfo as TTypeInfoSet;\r\n  TIEnum:=nil;\r\n  if TISet.CompType is TTypeInfoEnum then\r\n    TIEnum:=TTypeInfoEnum(TISet.CompType);\r\n  // read value\r\n  o:=TJSObject(GetJSValueProp(Instance,PropInfo));\r\n  // a set is a JS object, where included element is stored as: o[ElementDecimal]=true\r\n  for Key in o do\r\n  begin\r\n    n:=parseInt(Key,10);\r\n    if (TIEnum<>nil) and (n>=TIEnum.MinValue) and (n<=TIEnum.MaxValue) then\r\n      Value:=TIEnum.EnumType.IntToName[n]\r\n    else\r\n      Value:=str(n);\r\n    if Result<>'' then Result:=Result+',';\r\n    Result:=Result+Value;\r\n  end;\r\n  Result:='['+Result+']';\r\nend;\r\n\r\nfunction GetSetPropArray(Instance: TObject; const PropName: String\r\n  ): TIntegerDynArray;\r\nbegin\r\n  Result:=GetSetPropArray(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetSetPropArray(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): TIntegerDynArray;\r\nvar\r\n  o: TJSObject;\r\n  Key: string;\r\nbegin\r\n  Result:=[];\r\n  // read value\r\n  o:=TJSObject(GetJSValueProp(Instance,PropInfo));\r\n  // a set is a JS object, where included element is stored as: o[ElementDecimal]=true\r\n  for Key in o do\r\n    TJSArray(Result).push(parseInt(Key,10));\r\nend;\r\n\r\nprocedure SetSetPropArray(Instance: TObject; const PropName: String;\r\n  const Arr: TIntegerDynArray);\r\nbegin\r\n  SetSetPropArray(Instance,FindPropInfo(Instance,PropName),Arr);\r\nend;\r\n\r\nprocedure SetSetPropArray(Instance: TObject;\r\n  const PropInfo: TTypeMemberProperty; const Arr: TIntegerDynArray);\r\nvar\r\n  o: TJSObject;\r\n  i: integer;\r\nbegin\r\n  o:=TJSObject.new;\r\n  for i in Arr do\r\n    o[str(i)]:=true;\r\n  SetJSValueProp(Instance,PropInfo,o);\r\nend;\r\n\r\nfunction GetStrProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetStrProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): String;\r\nbegin\r\n  Result:=String(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetStrProp(Instance: TObject; const PropName: String; Value: String\r\n  );\r\nbegin\r\n  SetStrProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: String);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetStringProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetStrProp(Instance,PropName);\r\nend;\r\n\r\nfunction GetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): String;\r\nbegin\r\n  Result:=GetStrProp(Instance,PropInfo);\r\nend;\r\n\r\nprocedure SetStringProp(Instance: TObject; const PropName: String; Value: String\r\n  );\r\nbegin\r\n  SetStrProp(Instance,PropName,Value);\r\nend;\r\n\r\nprocedure SetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: String);\r\nbegin\r\n  SetStrProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetBoolProp(Instance: TObject; const PropName: String): boolean;\r\nbegin\r\n  Result:=GetBoolProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): boolean;\r\nbegin\r\n  Result:=Boolean(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetBoolProp(Instance: TObject; const PropName: String; Value: boolean\r\n  );\r\nbegin\r\n  SetBoolProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: boolean);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropName: String): TObject;\r\nbegin\r\n  Result:=GetObjectProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropName: String; MinClass : TClass): TObject;\r\nbegin\r\n  Result:=GetObjectProp(Instance,FindPropInfo(Instance,PropName));\r\n  if (MinClass<>Nil) and (Result<>Nil) Then\r\n    if not Result.InheritsFrom(MinClass) then\r\n      Result:=Nil;\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty):  TObject;\r\n\r\nbegin\r\n  Result:=GetObjectProp(Instance,PropInfo,Nil);\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; MinClass : TClass):  TObject;\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  O:=TObject(GetJSValueProp(Instance,PropInfo));\r\n  if (MinClass<>Nil) and not O.InheritsFrom(MinClass) then\r\n    Result:=Nil\r\n  else\r\n    Result:=O;\r\nend;\r\n\r\nprocedure SetObjectProp(Instance: TObject; const PropName: String; Value: TObject) ;\r\n\r\nbegin\r\n  SetObjectProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: TObject);\r\n\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetMethodProp(Instance: TObject; PropInfo: TTypeMemberProperty\r\n  ): TMethod;\r\nvar\r\n  v, fn: JSValue;\r\nbegin\r\n  Result.Code:=nil;\r\n  Result.Data:=nil;\r\n  v:=GetJSValueProp(Instance,PropInfo);\r\n  if not isFunction(v) then exit;\r\n  Result.Data:=Pointer(TJSObject(v)['scope']);\r\n  fn:=TJSObject(v)['fn'];\r\n  if isString(fn) then\r\n    begin\r\n    if Result.Data<>nil then\r\n      // named callback\r\n      Result.Code:=CodePointer(TJSObject(Result.Data)[String(fn)])\r\n    else\r\n      // this is not an rtl callback, return the value\r\n      Result.Code:=CodePointer(v);\r\n    end\r\n  else\r\n    // anonymous callback\r\n    Result.Code:=CodePointer(fn);\r\nend;\r\n\r\nfunction GetMethodProp(Instance: TObject; const PropName: string): TMethod;\r\nbegin\r\n  Result:=GetMethodProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction createCallbackPtr(scope: Pointer; fn: CodePointer): TJSFunction; external name 'rtl.createCallback';\r\nfunction createCallbackStr(scope: Pointer; fn: string): TJSFunction; external name 'rtl.createCallback';\r\n\r\nprocedure SetMethodProp(Instance: TObject; PropInfo: TTypeMemberProperty;\r\n  const Value: TMethod);\r\nvar\r\n  cb: TJSFunction;\r\n  Code: Pointer;\r\nbegin\r\n  // Note: Value.Data=nil is allowed and can be used by designer code\r\n  Code:=Value.Code;\r\n  if Code=nil then\r\n    cb:=nil\r\n  else if isFunction(Code) then\r\n    begin\r\n    if (TJSObject(Code)['scope']=Value.Data)\r\n        and (isFunction(TJSObject(Code)['fn']) or isString(TJSObject(Code)['fn']))\r\n      then\r\n      begin\r\n      // Value.Code is already the needed callback\r\n      cb:=TJSFunction(Code);\r\n      end\r\n    else if isString(TJSObject(Code)['fn']) then\r\n      // named callback, different scope\r\n      cb:=createCallbackStr(Value.Data,string(TJSObject(Code)['fn']))\r\n    else\r\n      // normal function\r\n      cb:=createCallbackPtr(Value.Data,Code);\r\n    end\r\n  else\r\n    // not a valid value -> for compatibility set it anyway\r\n    cb:=createCallbackPtr(Value.Data,Code);\r\n  SetJSValueProp(Instance,PropInfo,cb);\r\nend;\r\n\r\nprocedure SetMethodProp(Instance: TObject; const PropName: string;\r\n  const Value: TMethod);\r\nbegin\r\n  SetMethodProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nfunction GetFloatProp(Instance: TObject; PropInfo: TTypeMemberProperty): Double;\r\nbegin\r\n  Result:=Double(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nfunction GetFloatProp(Instance: TObject; const PropName: string): Double;\r\nbegin\r\n  Result:=GetFloatProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nprocedure SetFloatProp(Instance: TObject; const PropName: string; Value: Double\r\n  );\r\nbegin\r\n  SetFloatProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetFloatProp(Instance: TObject; PropInfo: TTypeMemberProperty;\r\n  Value: Double);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017-2019 by the Pas2JS development team.\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\nunit Web;\r\n\r\ninterface\r\n\r\nuses Types, JS;\r\n\r\nType\r\n  // Forward definitions\r\n  TJSWindow = class;\r\n  TJSDOMTokenList = class;\r\n  TJSXPathResult = CLass;\r\n  TJSNodeList = class;\r\n  TJSDocument = class;\r\n  TJSElement = class;\r\n  TJSCSSStyleSheet = class;\r\n  TJSNodeFilter = class;\r\n  TJSIDBObjectStore = class;\r\n  TIDBDatabase = class;\r\n  TJSIDBRequest = class;\r\n  TJSEventTarget = class;\r\n  TJSMouseEvent = class;\r\n  TJSWheelEvent = class;\r\n  TJSKeyBoardEvent = class;\r\n  TJSPointerEvent = class;\r\n  TJSUIEvent = class;\r\n  TJSTouchEvent = class;\r\n  TJSMessageEvent = class;\r\n\r\n  TJSAttr = class external name 'Attr'\r\n  private\r\n    fLocalName: string; external name 'localName';\r\n    fNameSpaceURI: string external name 'namespaceURI';\r\n    fPrefix: string; external name 'prefix';\r\n    fName: string; external name 'name';\r\n  public\r\n    value: JSValue;\r\n    property localName: string read fLocalName;\r\n    property namespaceURI: string read fNameSpaceURI;\r\n    property prefix: string read fPrefix;\r\n    property name: string read fName;\r\n  end;\r\n\r\n\r\n  { TEventListenerEvent }\r\n\r\n  TEventListenerEvent = class external name 'EventListener_Event'\r\n  private\r\n    FTarget: TJSEventTarget; external name 'target';\r\n  public\r\n    Property target: TJSEventTarget read FTarget;\r\n  end;\r\n\r\n  TJSEventHandler = reference to function(Event: TEventListenerEvent): boolean;\r\n\r\n  TJSEventTarget = class external name 'EventTarget'\r\n  public\r\n    procedure addEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure addEventListener(aname : string; aListener : JSValue);\r\n    function dispatchEvent(event : JSValue) : Boolean;\r\n    procedure removeEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure removeEventListener(aname : string; aListener : JSValue);\r\n  end;\r\n\r\n  TJSNode = class external name 'Node' (TJSEventTarget)\r\n  Private\r\n    FBaseURI: string; external name 'baseURI';\r\n    FChildNodes: TJSNodeList; external name 'childNodes';\r\n    FFirstChild: TJSNode; external name 'firstChild';\r\n    FNextSibling: TJSNode; external name 'nextSibling';\r\n    FNodeName: string; external name 'nodeName';\r\n    FNodeType: NativeInt; external name 'nodeType';\r\n    FOwnerDocument: TJSDocument; external name 'ownerDocument';\r\n    FParentElement: TJSElement; external name 'parentElement';\r\n    FParentNode: TJSNode; external name 'parentNode';\r\n    FPreviousSibling: TJSNode; external name 'previousSibling';\r\n  public\r\n    const\r\n      ELEMENT_NODE \t=1;\r\n      TEXT_NODE \t=3;\r\n      PROCESSING_INSTRUCTION_NODE = \t7;\r\n      COMMENT_NODE \t=8;\r\n      DOCUMENT_NODE \t=9;\r\n      DOCUMENT_TYPE_NODE \t= 10;\r\n      DOCUMENT_FRAGMENT_NODE  = 11;\r\n\r\n      DOCUMENT_POSITION_DISCONNECTED \t= 1;\r\n      DOCUMENT_POSITION_PRECEDING \t= 2;\r\n      DOCUMENT_POSITION_FOLLOWING \t= 4;\r\n      DOCUMENT_POSITION_CONTAINS \t= 8;\r\n      DOCUMENT_POSITION_CONTAINED_BY \t= 16;\r\n      DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = 32;\r\n  public\r\n    nodeValue: string;\r\n    innerText: string;\r\n    textContent: string;\r\n    function appendChild(aChild : TJSNode) : TJSNode;\r\n    function cloneNode(deep:  boolean): TJSNode;\r\n    function compareDocumentPosition(aNode : TJSNode) : NativeInt;\r\n    function contains(aNode : TJSNode) : boolean;\r\n    function hasChildNodes : boolean;\r\n    function insertBefore(newNode, referenceNode : TJSNode) : TJSNode;\r\n    function isDefaultNameSpace(aNameSpaceURI : String) : Boolean;\r\n    function isEqualNode(aNode : TJSNode) : boolean;\r\n    function isSameNode(aNode : TJSNode) : boolean;\r\n    function lookupNamespaceURI(aPrefix : string) : string;\r\n    function lookupPrefix(aPrefix : string) : string;\r\n    procedure normalize;\r\n    function removeChild(aChild: TJSNode) : TJSNode;\r\n    function replaceChild(aNewChild, aOldChild : TJSNode) : TJSNode;\r\n    property baseURI : string read FBaseURI;\r\n    property childNodes : TJSNodeList read FChildNodes;\r\n    property firstChild : TJSNode Read FFirstChild;\r\n    property nextSibling : TJSNode Read FNextSibling;\r\n    property nodeName : String Read FNodeName;\r\n    property nodeType : NativeInt Read FNodeType;\r\n    property ownerDocument : TJSDocument read FOwnerDocument;    \r\n    property parentElement : TJSElement read FParentElement;\r\n    property parentNode : TJSNode read FParentNode;\r\n    property previousSibling : TJSNode Read FPreviousSibling;\r\n  end;\r\n\r\n  TJSNodeListCallBack = procedure (currentValue : TJSNode; currentIndex: NativeInt; list : TJSNodeList);\r\n  TJSNodeListEvent = procedure (currentValue : TJSNode; currentIndex: NativeInt; list : TJSNodeList) of object;\r\n  \r\n  TJSNodeList = class external name 'NodeList'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    procedure forEach(const aCallBack : TJSNodeListCallBack);\r\n    procedure forEach(const aCallBack : TJSNodeListEvent);\r\n    function item(aIndex : NativeInt) : TJSNode;\r\n    Property length : NativeInt Read FLength;\r\n    Property Nodes [aIndex : NativeInt] : TJSNode Read item; default;\r\n  end;\r\n  \r\n  TJSNamedNodeMap = class external name 'NamedNodeMap'\r\n  Public\r\n    function getNamedItem(aName : string) : TJSAttr;\r\n    Property Attrs[aIndex : String] : TJSattr Read getNamedItem; default;\r\n  end;\r\n  \r\n  TJSHTMLCollection = class external name 'HTMLCollection'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  public\r\n    Function item(aIndex : Integer) : TJSNode;\r\n    Function namedItem(aName : string) : TJSNode;\r\n    property Items[aIndex : Integer] : TJSNode Read item; default;\r\n    property NamedItems[aName : String] : TJSNode Read namedItem; \r\n    Property length : NativeInt Read FLength;\r\n  end;  \r\n  \r\n  TJSDOMString = String;\r\n\r\n  TDOMTokenlistCallBack = Procedure (Current : JSValue; currentIndex : NativeInt; list : TJSDOMTokenList);\r\n  \r\n  // Interface\r\n  TJSDOMTokenList = class external name 'DOMTokenList'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  public\r\n    Procedure add(aToken : TJSDOMString); varargs;\r\n    Procedure remove(aToken : TJSDOMString); varargs;\r\n    function item(aIndex : NativeInt) : String;\r\n    function contains(aToken : TJSDOMString) : Boolean;\r\n    Procedure replace(aOldToken, ANewToken : TJSDOMString);\r\n    function supports(aToken : TJSDOMString) : Boolean;\r\n    function toggle(aToken : TJSDOMString) : Boolean;\r\n    // entries,keys, values\r\n    procedure forEach(const callback: TDOMTokenlistCallBack);\r\n    property length : NativeInt read FLength;\r\n  end;\r\n\r\n  TJSDOMRect = class external name 'DOMRect'\r\n  public\r\n    left,top,right,bottom,x,y,width,height : double;\r\n    {$IFDEF FIREFOX}\r\n    constructor New;\r\n    {$ENDIF}\r\n  end;\r\n  TJSClientRect = record\r\n    left,top,right,bottom : double;\r\n    {$IFDEF FIREFOX}\r\n    width, height: double;\r\n    {$ENDIF}\r\n  end;\r\n  \r\n  TJSClientRectArray = array of TJSClientRect;\r\n  \r\n  TJSElement = class external name 'Element' (TJSNode)\r\n  Private\r\n    FAttributes : TJSNamedNodeMap; external name 'attributes';\r\n    FChildElementCount : NativeInt; external name 'childElementCount';\r\n    FChildren : TJSHTMLCollection; external name 'children';\r\n    FClassList : TJSDOMTokenList; external name 'classList';\r\n    FCLientHeight : NativeInt; external name 'clientHeight';\r\n    FCLientLeft : NativeInt; external name 'clientLeft';\r\n    FCLientTop : NativeInt; external name 'clientTop';\r\n    FCLientWidth : NativeInt; external name 'clientWidth';\r\n    FFirstElementChild : TJSElement; external name 'firstElementChild';\r\n    FLastElementChild : TJSElement; external name 'lastElementChild';\r\n    FLocalName : string; external name 'localName';\r\n    FNameSpaceURI : String; external name 'namespaceURI';\r\n    FNextElementSibling : TJSElement; external name 'nextElementSibling';\r\n    FPreviousElementSibling : TJSElement; external name 'previousElementSibling';\r\n    FPrefix : String; external name 'prefix';\r\n    FScrollHeight : NativeInt; external name 'scrollHeight';\r\n{$IFDEF FIREFOX}\r\n    FScrollLeftMax : NativeInt; external name 'scrollLeftMax';\r\n    FScrollTopMax : NativeInt; external name 'scrollTopMax';\r\n{$endif}\r\n    FScrollWidth : NativeInt; external name 'scrollWidth';\r\n    FTagName : string; external name 'tagName';\r\n  Public\r\n    name : string;\r\n    className : string;\r\n    id : string;\r\n    innerHTML : String;\r\n    outerHTML : string;\r\n    scrollLeft : NativeInt;\r\n    scrollTop : NativeInt;\r\n    procedure append(aText : String); overload;\r\n    procedure append(aNode : TJSElement); overload;\r\n    procedure append(aText : String; aNode : TJSElement); varargs; overload;\r\n    procedure append(aNode1,aNode2: TJSElement); varargs; overload;\r\n    function getAttribute(aName : string) : string;\r\n    function getAttributeNode(aName : string) : TJSAttr;\r\n    function getAttributeNodeNS(aNameSpace, aName : string) : TJSAttr;\r\n    function getAttributeNS(aNameSpace, aName : string) : string;\r\n    function getBoundingClientRect : TJSDOMRect;\r\n    function getClientRects : TJSClientRectArray;\r\n    function getElementsByClassName(aClassName: string) : TJSHTMLCollection;\r\n    function getElementsByTagNameNS(aNameSpace, aTagName : String): TJSHTMLCollection;\r\n    function getElementsByTagName(aTagName : String): TJSHTMLCollection;\r\n    function hasAttribute(aName : String) : Boolean;\r\n    function hasAttributeNS(aNameSpace,aName : String) : Boolean;\r\n    function hasAttributes : Boolean;\r\n    function insertAdjacentElement(aPosition : string; aElement : TJSElement) : TJSElement;\r\n    procedure insertAdjacentHTML(aPosition,aHTML : string);\r\n    procedure insertAdjacentText(aPosition,aText : string);\r\n    function matches(aSelectorString : String) : Boolean;\r\n    function querySelector(aSelectors : String) : TJSElement;\r\n    function querySelectorAll(aSelectors : String) : TJSNodeList;\r\n    procedure releasePointerCapture(evID : JSValue);\r\n    procedure removeAttribute(aName: string);\r\n    procedure removeAttributeNS(aNameSpace,aName: string);\r\n    function removeAttributeNode(aAttr : TJSAttr) : TJSAttr;\r\n    procedure setAttribute(aName : string; AValue : String);\r\n    function setAttributeNode(aNode: TJSAttr) : TJSAttr;\r\n    function setAttributeNodeNS(aNode: TJSAttr) : TJSAttr;\r\n    procedure setAttributeNS(aNameSpace,aName : string; AValue : String);\r\n    procedure setCapture(retargetToElement : Boolean);\r\n    procedure setPointerCapture(pointerID : JSValue);\r\n    procedure requestFullScreen;    \r\n    Property attributes : TJSNamedNodeMap read FAttributes;\r\n    Property childElementCount : NativeInt Read FChildElementCount;\r\n    Property children : TJSHTMLCollection Read FChildren;\r\n    Property classList : TJSDOMTokenList read FClassList;\r\n    property clientHeight : NativeInt read FClientHeight;\r\n    property clientLeft : NativeInt read FClientLeft;\r\n    property clientTop : NativeInt read FClientTop;\r\n    property clientWidth : NativeInt read FClientWidth;\r\n    property firstElementChild : TJSElement Read FFirstElementChild;\r\n    property lastElementChild : TJSElement Read FLastElementChild;\r\n    property localName : string Read FLocalName;\r\n    property namespaceURI : String read FNameSpaceURI;\r\n    property nextElementSibling : TJSElement Read FNextElementSibling;\r\n    property previousElementSibling : TJSElement Read FPreviousElementSibling;\r\n    property prefix : String read FPrefix;\r\n    property scrollHeight : NativeInt Read FScrollHeight;\r\n{$IFDEF FIREFOX}\r\n    property scrollLeftMax  : NativeInt Read FScrollLeftMax;\r\n    property scrollTopMax  : NativeInt Read FScrollTopMax;\r\n{$ENDIF}\r\n    property scrollWidth : NativeInt Read FScrollWidth;\r\n    property tagName : String read FTagName;\r\n    Property Attrs[aName : string] : String read getAttribute write setAttribute; default;\r\n  end;\r\n   \r\n  TJSElementCreationOptions = record\r\n    named : string;\r\n  end;\r\n \r\n  TJSDocumentType = class external name 'DocumentType' (TJSNode)\r\n  private\r\n    FName : String; external name 'name';\r\n    FPublicID : String; external name 'publicId';\r\n    FSystemID : String; external name 'systemId';\r\n  public\r\n    property name : String read FName;\r\n    property publicId : String Read FPublicID;\r\n    property systemId : String read FSystemID;\r\n  end;\r\n\r\n  TJSDOMImplementation  = class external name 'DocumentImplementation'\r\n  Public  \r\n    function createDocument(aNamespaceURI, aQualifiedNameStr : String; aDocumentType : TJSDocumentType) : TJSDocument;\r\n    function createDocumentType(aQualifiedNameStr,aPublicId,aSystemId : String) : TJSDocumentType;\r\n    function createHTMLDocument(aTitle : String) : TJSDocument;\r\n  end;\r\n\r\n  TJSLocation = class external name 'Location'\r\n  Private\r\n    FOrigin : string; external name 'origin';\r\n  Public\r\n    hash : string;\r\n    host : string;\r\n    hostname : string;\r\n    href : string;\r\n    password : string;\r\n    pathname : string;\r\n    port : string;\r\n    protocol : string;\r\n    search : string;\r\n    username : string;\r\n    procedure assign(aURL : String); overload;\r\n    procedure reload(aForce : Boolean);\r\n    procedure replace(aURL : String);\r\n    function toString : String;\r\n    property origin : string read FOrigin;\r\n  end;\r\n  \r\n  TJSStyleSheet = class external name 'StyleSheet' (TJSEventTarget)\r\n  Private\r\n    FHRef : String; external name 'href';\r\n    FOwnerNode : TJSNode; external name 'ownerNode';\r\n    FParentStyleSheet : TJSStyleSheet; external name 'parentStyleSheet';\r\n    FTitle : String; external name 'title';\r\n    FType : String; external name 'type';\r\n  Public\r\n    disabled : String;\r\n    Property href : String read FHRef;\r\n    property ownerNode : TJSNode Read FOwnerNode;\r\n    property parentStyleSheet : TJSStyleSheet read FParentStyleSheet;\r\n    property title : string Read FTitle;\r\n    property _type : String read FType;\r\n  end;\r\n\r\n\r\n  TJSCSSRule = class external name 'CSSRule'\r\n  Private\r\n    FCSSText : String; external name 'cssText';\r\n    FParentStyleSheet : TJSCSSStyleSheet; external name 'parentStyleSheet';\r\n    FparentRule : TJSCSSRule; external name 'parentRule';\r\n  Public\r\n    property cssText : String Read FCSSText;\r\n    property parentRule : TJSCSSRule read FparentRule;\r\n    property parentStyleSheet : TJSCSSStyleSheet Read FParentStyleSheet;\r\n  end;\r\n  \r\n  TJSCSSRuleList = Class external name 'CSSRuleList'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    function item(index : NativeInt) : TJSCSSRule;\r\n    property length : NativeInt Read FLength;\r\n    Property items[aIndex : NativeInt] : TJSCSSRule read item; default;\r\n  end;\r\n  \r\n  \r\n  TJSCSSStyleSheet = class external name 'CSSStyleSheet' (TJSStyleSheet)\r\n  Private\r\n    FCSSRules : TJSCSSRuleList; external name 'cssRules';\r\n  Public\r\n    procedure deleteRule(aIndex : NativeInt);\r\n    function insertRule(aRule : String; aIndex : NativeInt) : NativeInt;\r\n    Property cssRules : TJSCSSRuleList read FCSSRules;\r\n  end;\r\n\r\n  TJSStyleSheetList = Class external name 'StyleSheetList'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    function item(index : NativeInt) : TJSStyleSheet;\r\n    property length : NativeInt Read FLength;\r\n    Property items[aIndex : NativeInt] : TJSStyleSheet read item; default;\r\n  end;\r\n\r\n  { TJSDocumentFragment }\r\n\r\n  TJSDocumentFragment = Class external name 'DocumentFragment' (TJSNode)\r\n  private\r\n    FchildElementCount: Integer; external name 'childElementCount';\r\n    Fchildren: TJSHTMLCollection; external name 'children';\r\n    FfirstElementChild: TJSElement; external name 'firstElementChild';\r\n    FlastElementChild: TJSElement; external name 'lastElementChild';\r\n  public\r\n    constructor new;\r\n    function querySelector(aSelector : String) : TJSElement;\r\n    function querySelectorAll(aSelector : String) : TJSNodeList;\r\n    property childElementCount : Integer read FchildElementCount;\r\n    property children : TJSHTMLCollection read Fchildren;\r\n    property firstElementChild : TJSElement read FfirstElementChild;\r\n    property lastElementChild : TJSElement read FlastElementChild;\r\n  end;\r\n\r\n  TJSEventInit = record\r\n    bubbles : boolean;\r\n    cancelable : boolean;\r\n    scoped : boolean;\r\n    composed : boolean;\r\n  end;\r\n\r\n  TJSEvent = class external name 'Event'\r\n  Private\r\n    FBubbles : Boolean; external name 'bubbles';\r\n    FCancelable : Boolean; external name 'cancelable';\r\n    FComposed : Boolean; external name 'composed';\r\n    FCurrentTarget : TJSElement; external name 'currentTarget';\r\n    FdefaultPrevented : Boolean; external name 'defaultPrevented';\r\n    FEventPhase : NativeInt; external name 'eventPhase';\r\n    FTarget : TJSElement; external name 'target';\r\n    FTimeStamp : NativeInt; external name 'timestamp';\r\n    FType : String; external name 'type';\r\n    FIsTrusted : Boolean; external name 'isTrusted';\r\n  Public\r\n    Const\r\n      NONE = 0;\r\n      CAPTURING_PHASE = 1;\r\n      AT_TARGET  = 2;\r\n      BUBBLING_PHASE = 3;\r\n  public    \r\n    cancelBubble : Boolean;\r\n    constructor new (aType : String; const aInit : TJSEventInit); overload;\r\n    constructor new (aType : String); overload;\r\n    procedure preventDefault;\r\n    procedure stopImmediatePropagation;\r\n    procedure stopPropagation;\r\n    Property bubbles : Boolean Read FBubbles;\r\n    Property cancelable : Boolean Read FCancelable;\r\n    Property composed : Boolean Read FComposed;\r\n    property currentTarget : TJSElement Read FCurrentTarget;\r\n    property defaultPrevented : Boolean Read FdefaultPrevented;\r\n    property eventPhase : NativeInt Read FEventPhase;\r\n    property target : TJSElement Read FTarget;\r\n    Property timestamp : NativeInt Read FTimeStamp;\r\n    property _type : string read FType;\r\n    property isTrusted : Boolean Read FIsTrusted;\r\n  end;\r\n\r\n\r\n  TJSXPathExpression = class external name 'XPathExpression'\r\n  Public\r\n    function evaluate(contextNode : TJSNode; aType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n    function evaluateWithContext(contextNode : TJSNode; aPosition, aSize, aType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n  end;\r\n\r\n  TJSXPathNSResolver = class external name 'XPathNSResolver'\r\n  Public\r\n    function lookupNamespaceURI(prefix : string) : string;\r\n  end;\r\n\r\n  { TJSCharacterData }\r\n\r\n  TJSCharacterData = class external name 'CharacterData' (TJSNode)\r\n  private\r\n    FnextElementSibling: TJSElement; external name 'nextElementSibling';\r\n    FpreviousElementSibling: TJSElement; external name 'previousElementSibling';\r\n  public\r\n    property nextElementSibling : TJSElement read FnextElementSibling;\r\n    property previousElementSibling : TJSElement read FpreviousElementSibling;\r\n  end;\r\n\r\n  TJSProcessingInstruction = class external name 'ProcessingInstruction' (TJSCharacterData);\r\n\r\n  { TJSRange }\r\n\r\n  TJSRange = class external name 'Range'\r\n  private\r\n    FCollapsed: boolean; external name 'collapsed';\r\n    FcommonAncestorContainer: TJSNode; external name 'commonAncestorContainer';\r\n    FendContainer: TJSNode; external name 'endContainer';\r\n    FEndOffset: NativeInt; external name 'endOffset';\r\n    FstartContainer: TJSNode; external name 'startContainer';\r\n    FstartOffset: NativeInt; external name 'startOffset';\r\n  Public\r\n    const\r\n      END_TO_END     = 0;\r\n      END_TO_START   = 1;\r\n      START_TO_END   = 2;\r\n      START_TO_START = 3;\r\n  Public\r\n    constructor new;\r\n    function cloneContents : TJSDocumentFragment;\r\n    function cloneRange : TJSRange;\r\n    procedure collapse;\r\n    function compareBoundaryPoints(aHow : NativeInt) : NativeInt;\r\n    function createContextualFragment(aTagstring : String) : TJSDocumentFragment;\r\n    procedure deleteContents;\r\n    procedure detach;\r\n    function extractContents : TJSDocumentFragment;\r\n    procedure insertNode(aNode : TJSNode);\r\n    procedure selectNode(aNode : TJSNode);\r\n    procedure selectNodeContents(aNode : TJSNode);\r\n    procedure setEnd(aEndNode : TJSNode; aEndOffset : NativeInt); \r\n    procedure setEndAfter(aEndNode : TJSNode);\r\n    procedure setEndBefore(aEndNode : TJSNode);\r\n    procedure setStart(aStartNode : TJSNode; aStartOffset : NativeInt); \r\n    procedure setStartAfter(aStartNode : TJSNode);\r\n    procedure setStartBefore(aStartNode : TJSNode);\r\n    procedure surroundContents(aNode : TJSNode);\r\n    function toString : string;\r\n    property collapsed : boolean read FCollapsed;\r\n    property commonAncestorContainer : TJSNode read FcommonAncestorContainer ;\r\n    property endContainer : TJSNode read FendContainer;\r\n    property endOffset : NativeInt Read FEndOffset;\r\n    property startContainer : TJSNode read FstartContainer;\r\n    property startOffset : NativeInt Read FstartOffset;\r\n  end;\r\n\r\n\r\n  { TJSTreeWalker }\r\n\r\n  TJSTreeWalker = class external name 'TreeWalker'\r\n  private\r\n    FCurrentNode: TJSNode; external name 'currentNode';\r\n    FexpandEntityReference: Boolean; external name 'expandEntityReference';\r\n    FFilter: TJSNodeFilter; external name 'filter';\r\n    FRoot: TJSNode; external name 'root';\r\n    FWhatToShow: NativeInt; external name 'whatToShow';\r\n  Public\r\n    function firstChild : TJSNode;\r\n    function lastChild : TJSNode;\r\n    function nextNode : TJSNode;\r\n    function nextSibling : TJSNode;\r\n    function parentNode : TJSNode;\r\n    function previousNode : TJSNode;\r\n    function previousSibling : TJSNode;\r\n\r\n    property root : TJSNode read FRoot;\r\n    property whatToShow : NativeInt read FWhatToShow;\r\n    property filter : TJSNodeFilter Read FFilter;\r\n    property expandEntityReference : Boolean Read FexpandEntityReference;\r\n    property currentNode : TJSNode Read FCurrentNode;\r\n  end;\r\n\r\n  TJSNodeFilter = class external name 'NodeFilter'\r\n    const\r\n      SHOW_ALL                    = -1;\r\n      SHOW_ATTRIBUTE              = 2;\r\n      SHOW_CDATA_SECTION          = 8;\r\n      SHOW_COMMENT                = 128;\r\n      SHOW_DOCUMENT               = 256;\r\n      SHOW_DOCUMENT_FRAGMENT      = 1024;\r\n      SHOW_DOCUMENT_TYPE          = 512;\r\n      SHOW_ELEMENT                = 1;\r\n      SHOW_ENTITY                 = 32;\r\n      SHOW_ENTITY_REFERENCE       = 16;\r\n      SHOW_NOTATION               = 2048;\r\n      SHOW_PROCESSING_INSTRUCTION = 64;\r\n      SHOW_TEXT                   = 4;\r\n    function acceptNode (aNode : TJSNode) : NativeInt;\r\n  end;\r\n\r\n  TJSXPathResult = class external name 'XPathResult'\r\n  private\r\n    FBooleanValue : Boolean; external name 'booleanValue';\r\n    FNumberValue : Double; external name 'numberValue';\r\n    FResultType : NativeInt; external name 'resultType';\r\n    FSingleNodeValue : TJSNode;  external name 'singleNodeValue';\r\n    FSnaphotLength : NativeInt; external name 'snapshotLength';\r\n    FStringValue : String; external name 'stringValue';\r\n  public  \r\n    Function iterateNext : TJSNode;\r\n    Function snapshotItem(Index: NativeInt) : TJSNode;\r\n    Property booleanValue : Boolean Read FBooleanValue;\r\n    Property numberValue : Double Read FNumberValue;\r\n    property resultType : NativeInt Read FResultType;\r\n    Property singleNodeValue : TJSNode Read FSingleNodeValue;\r\n    property snapshotLength : NativeInt read FSnaphotLength;\r\n    property stringValue : String Read FStringValue;\r\n  end;\r\n\r\n  TJSSelection = class external name 'Selection'\r\n  Private\r\n    FanchorNode : TJSNode ; external name 'anchorNode';\r\n    FanchorOffset : NativeInt ; external name 'anchorOffset';\r\n    FfocusNode : TJSNode ; external name 'focusNode';\r\n    FfocusOffset : NativeInt ; external name 'focusOffset';\r\n    FisCollapsed : Boolean ; external name 'isCollapsed';\r\n    FrangeCount : NativeInt ; external name 'rangeCount';\r\n    Ftype : String ; external name 'type';\r\n  Public\r\n    function getRangeAt(aIndex : NativeInt) : TJSRange;\r\n    procedure collapse(aParentNode : TJSNode; Offset : NativeInt);\r\n    procedure extend(aParentNode : TJSNode; Offset : NativeInt);\r\n    procedure collapseToStart;\r\n    procedure collapseToEnd;\r\n    procedure selectAllChildren(aParentNode : TJSNode);\r\n    procedure addRange(aRange : TJSRange);\r\n    procedure removeRange(aRange : TJSRange);\r\n    procedure removeAllRanges;\r\n    procedure deleteFromDocument;\r\n    function containsNode(aNode : TJSNode; aPartlyContained : Boolean) : Boolean;\r\n    procedure setBaseAndExtent(aAnchorNode : TJSNode; aAnchorOffset : NativeInt; aFocusNode : TJSNode; aFocusOffset : NativeInt);\r\n    function toString : String;\r\n    property anchorNode : TJSNode read FAnchorNode;\r\n    property anchorOffset : NativeInt read FAnchorOffset;\r\n    property focusNode : TJSNode read FFocusNode;\r\n    property focusOffset : NativeInt read FFocusOffset;\r\n    property isCollapsed : Boolean read FIsCollapsed;\r\n    property rangeCount : NativeInt read FRangeCount;\r\n    property _type : String Read FType;\r\n  end;\r\n  TJSNameSpaceMapperCallback = function (aNameSpace : string ) : String;\r\n\r\n  TJSHTMLFile = class;\r\n  TJSHTMLFileList = Class;\r\n\r\n  { TJSDataTransferItem }\r\n\r\n  TJSDataTransferItemCallBack = reference to Procedure(aData : String);\r\n\r\n  TJSDataTransferItem = class external name 'DataTransferItem'\r\n  private\r\n    FKind: String; external name 'kind';\r\n    FType: string; external name 'type';\r\n  Public\r\n    function getAsFile : TJSHTMLFile;\r\n    Procedure getAsString(aCallBack : TJSDataTransferItemCallBack);\r\n    property Kind : String read FKind;\r\n    property _Type : string read FType;\r\n  end;\r\n\r\n  TJSDataTransferItemList = class external name 'DataTransferItemList'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSDataTransferItem ; external name '[]';\r\n  Public\r\n    Function add(aData : string; AType: string) : TJSDataTransferItem; overload;\r\n    Function add(aFile : TJSHTMLFile) : TJSDataTransferItem; overload;\r\n    Procedure clear;\r\n    procedure remove(aIndex : integer);\r\n    property length : NativeInt read FLength;\r\n    property Items[aIndex : NativeInt] : TJSDataTransferItem Read getitem; default;\r\n  end;\r\n\r\n  { TDataTransfer }\r\n\r\n  TJSDataTransfer = class external name 'DataTransfer'\r\n  private\r\n    FFiles: TJSHTMLFileList; external name 'files';\r\n    FItems: TJSDataTransferItemList; external name 'items';\r\n    FTypes: TJSStringDynArray; external name 'types';\r\n  Public\r\n    dropEffect : string;\r\n    effectAllowed : string;\r\n    Procedure clearData; overload;\r\n    Procedure clearData(aFormat : string); overload;\r\n    function getData(aFormat : string) : String;\r\n    procedure setData(aFormat : String; aData : String);\r\n    procedure setDragImage(aImage: TJSElement; xOffset,yOffset : integer);\r\n    property files : TJSHTMLFileList Read FFiles;\r\n    property items : TJSDataTransferItemList read FItems;\r\n    property types : TJSStringDynArray read FTypes;\r\n  end;\r\n\r\n  { TJSDragEvent }\r\n\r\n  TJSDragEvent = class external name 'DragEvent' (TJSEvent)\r\n  Private\r\n    FDataTransfer: TJSDataTransfer; external name 'dataTransfer';\r\n    FrelatedTarget : TJSEventTarget external name 'relatedTarget';\r\n    FscreenX : NativeInt external name 'screenX';\r\n    FscreenY : NativeInt external name 'screenY';\r\n    FclientX : NativeInt external name 'clientX';\r\n    FclientY : NativeInt external name 'clientY';\r\n    Fbutton : NativeInt external name 'button';\r\n    Fbuttons : NativeInt external name 'buttons';\r\n    FctrlKey : Boolean external name 'ctrlKey';\r\n    FshiftKey : Boolean external name 'shiftKey';\r\n    FaltKey  : Boolean external name 'altKey';\r\n    FmetaKey  : Boolean external name 'metaKey';\r\n  Public\r\n    Property relatedTarget : TJSEventTarget Read FRelatedTarget;\r\n    Property screenX : NativeInt Read FScreenX;\r\n    Property screenY : NativeInt Read FScreenY;\r\n    Property clientX : NativeInt Read FClientX;\r\n    Property clientY : NativeInt Read FClientY;\r\n    Property button : NativeInt Read FButton;\r\n    Property buttons : NativeInt Read FButtons;\r\n    Property ctrlKey : Boolean Read FctrlKey;\r\n    Property shiftKey : Boolean Read FshiftKey;\r\n    Property altKey  : Boolean Read FaltKey;\r\n    Property metaKey  : Boolean Read FmetaKey;\r\n    property dataTransfer : TJSDataTransfer Read FDataTransfer;\r\n  end;\r\n  TJSDragDropEventHandler = reference to function(aEvent: TJSDragEvent) : Boolean;\r\n  THTMLClickEventHandler = reference to function(aEvent : TJSMouseEvent) : boolean;\r\n  { Various events }\r\n\r\n{$IFNDEF FIREFOX}\r\n  TJSFocusEvent = TJSEvent;\r\n{$ELSE}\r\n  TJSFocusEvent = Class(TJSEvent)\r\n  private\r\n    FrelatedTarget : TJSElement external name 'relatedTarget';\r\n  public\r\n    property relatedTarget : TJSElement Read FrelatedTarget;\r\n  end;\r\n{$ENDIF}\r\n  TJSAnimationEvent = Class(TJSEvent);\r\n  TJSLoadEvent = Class(TJSEvent);\r\n\r\n  TJSErrorEvent = class external name 'ErrorEvent' (TJSEvent)\r\n  Private\r\n    Fmessage : String external name 'message';\r\n    Ffilename : string external name 'filename';\r\n    Flineno : integer external name 'lineno';\r\n    Fcolno : integer external name 'colno';\r\n    Ferror : TJSObject external name 'error';\r\n  Public\r\n    Property message : String read FMessage;\r\n    property filename : string Read FFileName;\r\n    property lineno : integer read FLineNo;\r\n    Property colno : integer read FColNo;\r\n    Property error : TJSObject read FError;\r\n  end;\r\n\r\n  TJsPageTransitionEvent = class(TJSEvent)\r\n  end;\r\n\r\n  TJSHashChangeEvent = class external name 'HashChangeEvent' (TJSEvent)\r\n  Private\r\n    FnewURL : String external name 'newURL';\r\n    FoldURL : String external name 'oldURL';\r\n  public\r\n    property newURL : String Read FNewURL;\r\n    property oldURL : String Read FOldURL;\r\n  end;\r\n\r\n  TJSPopStateEvent = class external name 'PopStateEvent'  (TJSEvent)\r\n  Private\r\n    FState : JSValue; external name 'state';\r\n  Public\r\n    property state : JSValue read FState;\r\n  end;\r\n\r\n  TJSStorageEvent = class external name 'StorageEvent' (TJSEvent)\r\n  private\r\n    Fkey : String external name 'key';\r\n    FoldValue : String external name 'oldValue';\r\n    FnewValue : String external name 'newValue';\r\n    Furl : String external name 'url';\r\n    FstorageArea : String external name 'storageArea';\r\n  public\r\n    Property key : String Read FKey;\r\n    Property oldValue : String Read FOldValue;\r\n    Property newValue : String Read FNewValue;\r\n    Property url : String Read FURL;\r\n    Property storageArea : String Read FstorageArea;\r\n  end;\r\n\r\n  { TJSProgressEvent }\r\n\r\n  TJSProgressEvent = class external name 'ProgressEvent' (TJSEvent)\r\n  Private\r\n    FlengthComputable : Boolean external name 'lengthComputable';\r\n    Floaded : NativeUINT external name 'loaded';\r\n    FTotal : NativeUINT external name 'Total';\r\n  Public\r\n    property lengthComputable : Boolean Read FlengthComputable;\r\n    property loaded : NativeUINT Read FLoaded;\r\n    property Total : NativeUINT Read FTotal;\r\n  end;\r\n\r\n  TJSPageTransitionEventHandler = reference to function(aEvent : TJsPageTransitionEvent) : boolean;\r\n  TJSHashChangeEventhandler = reference to function(aEvent : TJSHashChangeEvent) : boolean;\r\n  TJSMouseWheelEventHandler = reference to function(aEvent : TJSWheelEvent) : boolean;\r\n  TJSMouseEventHandler = reference to function(aEvent : TJSMouseEvent) : boolean;\r\n  THTMLAnimationEventHandler = reference to function(aEvent : TJSAnimationEvent) : boolean;\r\n  TJSErrorEventHandler = reference to function(aEvent : TJSErrorEvent) : boolean;\r\n  TJSFocusEventHandler = reference to function(aEvent : TJSFocusEvent) : boolean;\r\n  TJSKeyEventhandler = reference to function (aEvent : TJSKeyBoardEvent) : boolean;\r\n  TJSLoadEventhandler = reference to function (aEvent : TJSLoadEvent) : boolean;\r\n  TJSPointerEventHandler = reference to function(aEvent : TJSPointerEvent) : boolean;\r\n  TJSUIEventHandler = reference to function(aEvent : TJSUIEvent) : Boolean;\r\n  TJSPopStateEventHandler = reference to function(aEvent : TJSPopStateEvent) : Boolean;\r\n  TJSStorageEventHandler = reference to function(aEvent : TJSStorageEvent) : Boolean;\r\n  TJSProgressEventhandler =  reference to function(aEvent : TJSProgressEvent) : Boolean;\r\n  TJSTouchEventHandler = reference to function(aEvent : TJSTouchEvent) : boolean;\r\n\r\n  TJSDocument = class external name 'Document' (TJSNode)\r\n  Private\r\n    fActiveElement : TJSElement; external name 'activeElement';\r\n    FCharacterSet: String; external name 'characterSet';\r\n    FChildElementCount: NativeInt; external name 'childElementCount';\r\n    FCompatMode: String; external name 'compatMode';\r\n    FCurrentScript: TJSElement; external name 'currentScript';\r\n    FDefaultView: TJSWindow; external name 'defaultView';\r\n    FDocType: TJSDocumentType; external name 'docrype';\r\n    FDocumentElement: TJSElement; external name 'documentElement';\r\n    FDocumentURI: String; external name 'documentURI';\r\n    FEmbeds: TJSHTMLCollection; external name 'embeds';\r\n    FFirstElementChild : TJSElement; external name 'firstElementChild';\r\n    FForms: TJSHTMLCollection; external name 'forms';\r\n    FFullScreenElement: TJSElement; external name 'fullscreenElement';\r\n    FFullscreenEnabled: Boolean; external name 'fullscreenEnabled';\r\n    FHead: TJSElement; external name 'head';\r\n    FHidden: Boolean; external name 'hidden';\r\n    FImages: TJSHTMLCollection; external name 'images';\r\n    FImplementation: TJSDOMImplementation; external name 'implementation';\r\n    FLastElementChild : TJSElement; external name 'lastElementChild';\r\n    FLastModified: String; external name 'lastModified';\r\n    FLastStyleSheetSet: String; external name 'lastStyleSheetSet';\r\n    FLinks: TJSHTMLCollection; external name 'links';\r\n    FLocation: TJSLocation; external name 'location';\r\n    FLocationString: String; external name 'location';\r\n    FPlugins: TJSHTMLCollection; external name 'plugins';\r\n    FPointerLockElement: TJSElement; external name 'pointerLockElement';\r\n    FPreferredStyleSheetSet: String; external name 'preferredStyleSheetSet';\r\n    FReadyState: String; external name 'readyState';\r\n    FReferrer: String; external name 'referrer';\r\n    FScripts: TJSHTMLCollection; external name 'scripts';\r\n    FStyleSheets: TJSStyleSheetList; external name 'styleSheets';\r\n    FStyleSheetSets: TJSValueDynArray; external name 'styleSheetSets';\r\n    FURL: String; external name 'URL';\r\n    FVisibilityState: string; external name 'visibilityState';\r\n  Public\r\n    function adoptNode(aExternalNode : TJSNode) : TJSNode;\r\n    procedure close;\r\n    function createAttribute(aName : string) : TJSAttr;\r\n    function createCDATASection(S : String) : TJSNode;\r\n    function createComment(S : String) : TJSNode;\r\n    function createDocumentFragment : TJSDocumentFragment;\r\n    function createElement(tagName : string) : TJSElement; overload;\r\n    function createElement(tagName : string; const options : TJSElementCreationOptions) : TJSElement; overload;\r\n    function createElementNS(aNameSpace,tagName : string) : TJSElement; overload;\r\n    function createElementNS(aNameSpace,tagName : string; const options : TJSElementCreationOptions) : TJSElement; overload;\r\n    function createEvent(aType : string) : TJSEvent;\r\n    function createExpression(xPathText : String; aNameSpaceMapper: TJSNameSpaceMapperCallback) : TJSXPathExpression;\r\n    function createNSResolver(aNode : TJSNode) : TJSXPathNSResolver;\r\n    function createProcessingInstruction(target, data : String) : TJSProcessingInstruction;\r\n    function createRange : TJSRange;\r\n    function createTextNode(S : String) : TJSNode;\r\n    function createTreeWalker(root : TJSNode; whatToShow : NativeInt; filter : TJSNodeFilter) : TJSTreeWalker;\r\n    function elementFromPoint(x,y : integer) : TJSElement;\r\n    procedure enableStyleSheetsForSet(aSet : String);\r\n    function evaluate(xpathExpression : String; ContextNode : TJSNode; NameSpaceResolver : TJSNamespaceMapperCallBack; resultType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n    function execCommand(aCommandName : String; aShowDefaultUI : Boolean; AValueArgument : String) : boolean; overload;\r\n    function execCommand(aCommandName : String; aShowDefaultUI : Boolean) : boolean; overload;\r\n    Procedure exitFullScreen;\r\n    function getElementById(aID : String) : TJSElement;\r\n    function getElementsByClassName(aNames : string) : TJSHTMLCollection;\r\n    function getElementsByName(aName : String) : TJSNodeList;\r\n    function getElementsByTagName(aName : String) : TJSHTMLCollection;\r\n    function getElementsByTagNameNS(aNameSpace,aName : String) : TJSHTMLCollection;\r\n    function getSelection : TJSSelection;\r\n    function hasFocus : boolean;\r\n    function importNode(aExternalNode : TJSNode; Deep: boolean) : TJSNode;\r\n    function querySelector(aSelectors : String) : TJSElement;\r\n    function querySelectorAll(aSelectors : String) : TJSNodeList;\r\n    procedure open;\r\n    procedure releaseCapture;\r\n    procedure write(aLine : string);\r\n    procedure writeln(aLine : String);\r\n  Public\r\n    body : TJSElement;\r\n    designMode : string;\r\n    dir : string;\r\n    domain : string;\r\n    selectedStyleSheetSet : string;\r\n    title : string;\r\n    onabort : TJSEventHandler;\r\n    onblur : TJSEventHandler;\r\n    oncancel : TJSEventHandler;\r\n    oncanplay : TJSEventHandler;\r\n    oncanplaythrough : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    oncuechange : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    ondrag : TJSDragDropEventHandler;\r\n    ondragend : TJSDragDropEventHandler;\r\n    ondragenter : TJSDragDropEventHandler;\r\n    ondragexit : TJSDragDropEventHandler;\r\n    ondragover : TJSDragDropEventHandler;\r\n    ondragleave : TJSDragDropEventHandler;\r\n    ondragstart: TJSDragDropEventHandler;\r\n    ondrop : TJSDragDropEventHandler;\r\n    ondurationchange : TJSEventHandler;\r\n    onemptied : TJSEventHandler;\r\n    onended : TJSEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    ongotpointercapture : TJSPointerEventHandler;\r\n    oninput : TJSEventhandler;\r\n    oninvalid : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadeddata : TJSEventhandler;\r\n    onloadedmetadata : TJSEventhandler;\r\n    onloadend : TJSProgressEventhandler;\r\n    onloadstart : TJSProgressEventhandler;\r\n    onlostpointercapture : TJSPointerEventHandler;\r\n    onmessage : TJSEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onpause : TJSEventHandler;\r\n    onplay : TJSEventHandler;\r\n    onplaying : TJSEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onreset : TJSUIEventHandler;\r\n    onratechange : TJSEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onseekend : TJSEventHandler;\r\n    onseeking : TJSEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onsshow : TJSEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onunload : TJSUIEventHandler;\r\n    onwaiting : TJSEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    Property activeElement : TJSElement Read FActiveElement;\r\n    Property characterSet : String Read FCharacterSet;\r\n    property childElementCount : NativeInt Read FChildElementCount;\r\n    property compatMode : String Read FCompatMode;\r\n    property currentScript : TJSElement Read FCurrentScript;\r\n    property defaultView : TJSWindow Read FDefaultView;\r\n    property doctype : TJSDocumentType read FDocType;\r\n    property documentElement : TJSElement read FDocumentElement;\r\n    property documentURI : String Read FDocumentURI;\r\n    property embeds : TJSHTMLCollection Read FEmbeds;\r\n    property firstElementChild : TJSElement Read FFirstElementChild;\r\n    property lastElementChild : TJSElement Read FLastElementChild;\r\n    property Forms : TJSHTMLCollection Read FForms;\r\n    property fullscreenElement : TJSElement Read FFullScreenElement;\r\n    property fullscreenEnabled : Boolean Read FFullscreenEnabled;\r\n    property head : TJSElement read FHead;\r\n    Property hidden : Boolean read FHidden;\r\n    property images : TJSHTMLCollection Read FImages;\r\n    property _implementation : TJSDOMImplementation Read FImplementation;\r\n    property lastModified : String Read FLastModified;\r\n    property lastStyleSheetSet : String read FLastStyleSheetSet;\r\n    property links : TJSHTMLCollection Read FLinks;\r\n    property location : TJSLocation read FLocation;\r\n    Property LocationString : String Read FURL Write FLocationString; // On purpose\r\n    property plugins : TJSHTMLCollection Read FPlugins;\r\n    property pointerLockElement : TJSElement Read FPointerLockElement;\r\n    property preferredStyleSheetSet : String Read FPreferredStyleSheetSet;\r\n    Property readyState : String Read FReadyState;\r\n    Property referrer : String Read FReferrer;\r\n    property scripts : TJSHTMLCollection Read FScripts;\r\n    property styleSheets : TJSStyleSheetList Read FStyleSheets;\r\n    property styleSheetSets : TJSValueDynArray Read FStyleSheetSets; // No type documented ?\r\n    Property URL : String Read FURL;\r\n    property visibilityState : string read FVisibilityState;\r\n  end;\r\n\r\n  TJSConsole = class external name 'Console'\r\n  Public\r\n    procedure assert(anAssertion : string; Obj1 : JSValue); varargs;\r\n    Procedure clear;  \r\n    procedure count; overload;\r\n    procedure count(aCounter : String);\r\n    procedure error(Obj1 : JSValue); varargs;\r\n    procedure group; overload;\r\n    procedure group(aLabel : String); overload;\r\n    procedure groupCollapsed; overload;\r\n    procedure groupCollapsed(aLabel : String);overload;\r\n    procedure groupEnd;\r\n    procedure info(Obj1 : JSValue); varargs;\r\n    procedure log(Obj1 : JSValue); varargs;\r\n    procedure table(args: array of JSValue); overload;\r\n    procedure table(args: array of JSValue; Columns : Array of string);\r\n    procedure table(args: TJSObject); overload;\r\n    procedure table(args: TJSObject; Columns : Array of string); overload;\r\n    procedure time(aName : string);\r\n    procedure timeEnd(aName : string);\r\n    procedure trace;\r\n    procedure warn(Obj1 : JSValue); varargs;\r\n  end;\r\n\r\n//  TJSBufferSource = class external name 'BufferSource' end;\r\n//  TJSTypedArray = class external name 'TypedArray' end;\r\n\r\n  // Forward class definitions\r\n  TJSCryptoKey = Class;\r\n  TJSSubtleCrypto = Class;\r\n  KeyType = String;\r\n  KeyUsage = String;\r\n  NamedCurve = String;\r\n  BigInteger = TJSUint8Array;\r\n  KeyFormat = String;\r\n  // Union of object, DOMString\r\n  AlgorithmIdentifier = JSValue; \r\n  \r\n  { Algorithm }\r\n\r\n  Algorithm = record\r\n    name : String;\r\n  end;\r\n  \r\n  { AesCbcParams }\r\n\r\n  AesCbcParams = record\r\n    iv : TJSBufferSource;\r\n  end;\r\n\r\n  { AesCtrParams }\r\n  \r\n  AesCtrParams = record\r\n    counter : TJSBufferSource;\r\n    length_ : Byte;external name 'length';\r\n  end;\r\n  \r\n  { AesGcmParams }\r\n  \r\n  AesGcmParams = record\r\n    iv : TJSBufferSource;\r\n    additionalData : TJSBufferSource;\r\n    tagLength : Byte;\r\n  end;\r\n  \r\n  { HmacImportParams }\r\n  \r\n  HmacImportParams = record\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { Pbkdf2Params }\r\n  \r\n  Pbkdf2Params = record\r\n    salt : TJSBufferSource;\r\n    iterations : NativeInt;\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { RsaHashedImportParams }\r\n\r\n  RsaHashedImportParams = record\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n  \r\n  { AesKeyGenParams }\r\n\r\n  AesKeyGenParams = record\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n\r\n  { HmacKeyGenParams }\r\n\r\n  HmacKeyGenParams = record\r\n    hash : AlgorithmIdentifier;\r\n    length_ : Integer;external name 'length';\r\n  end;\r\n\r\n  { RsaHashedKeyGenParams }\r\n\r\n  RsaHashedKeyGenParams = record\r\n    modulusLength : Integer;\r\n    publicExponent : BigInteger;\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n\r\n  { RsaOaepParams }\r\n\r\n  RsaOaepParams = record\r\n    label_ : TJSBufferSource;external name 'label';\r\n  end;\r\n\r\n  { RsaPssParams }\r\n\r\n  RsaPssParams = record\r\n    saltLength : Integer;\r\n  end;\r\n\r\n  { DhKeyGenParams }\r\n  \r\n  DhKeyGenParams = record\r\n    prime : BigInteger;\r\n    generator : BigInteger;\r\n  end;\r\n  \r\n  { EcKeyGenParams }\r\n\r\n  EcKeyGenParams = record\r\n    _namedCurve : NamedCurve; external name 'namedCurve';\r\n  end;\r\n\r\n  { AesDerivedKeyParams }\r\n  \r\n  AesDerivedKeyParams = record\r\n    length_ : Integer; external name 'length';\r\n  end;\r\n  \r\n  { HmacDerivedKeyParams }\r\n\r\n  HmacDerivedKeyParams = record\r\n    length_ : Integer; external name 'length';\r\n  end;\r\n\r\n  { EcdhKeyDeriveParams }\r\n  \r\n  EcdhKeyDeriveParams = record\r\n     public_ : TJSCryptoKey; external name 'public';\r\n  end;\r\n  \r\n  { DhKeyDeriveParams }\r\n\r\n  DhKeyDeriveParams = record\r\n    public_ : TJSCryptoKey; external name 'public';\r\n  end;\r\n\r\n  { DhImportKeyParams }\r\n  \r\n  DhImportKeyParams = record\r\n    prime : BigInteger;\r\n    generator : BigInteger;\r\n  end;\r\n  \r\n  { EcdsaParams }\r\n\r\n  EcdsaParams = record\r\n    hash : AlgorithmIdentifier;\r\n  end;\r\n\r\n  { EcKeyImportParams }\r\n\r\n  EcKeyImportParams = record\r\n    _namedCurve : NamedCurve;external name 'namedCurve';\r\n  end;\r\n\r\n  { HkdfParams }\r\n\r\n  HkdfParams = record\r\n    hash : AlgorithmIdentifier;\r\n    salt : TJSBufferSource;\r\n    info : TJSBufferSource;\r\n  end;\r\n\r\n  { RsaOtherPrimesInfo }\r\n  \r\n  RsaOtherPrimesInfo = record\r\n    r : String;\r\n    d : String;\r\n    t : String;\r\n  end;\r\n  \r\n  { JsonWebKey }\r\n  \r\n  TStringDynArray = Array of String;\r\n  TRsaOtherPrimesInfoDynArray = Array of RsaOtherPrimesInfo;\r\n  JsonWebKey = record\r\n    kty : String;\r\n    use : String;\r\n    key_ops : TStringDynArray;\r\n    alg : String;\r\n    ext : boolean;\r\n    crv : String;\r\n    x : String;\r\n    y : String;\r\n    d : String;\r\n    n : String;\r\n    e : String;\r\n    p : String;\r\n    q : String;\r\n    dp : String;\r\n    dq : String;\r\n    qi : String;\r\n    oth : TRsaOtherPrimesInfoDynArray;\r\n    k : String;\r\n  end;\r\n  \r\n  { CryptoKeyPair }\r\n\r\n  CryptoKeyPair = record\r\n    publicKey : TJSCryptoKey;\r\n    privateKey : TJSCryptoKey;\r\n  end;\r\n\r\n  { TJSCryptoKey }\r\n  \r\n  TKeyUsageDynArray = Array of KeyUsage;\r\n  TJSCryptoKey = class external name 'CryptoKey' \r\n  Private\r\n    Ftype_ : KeyType; external name 'type'; \r\n    Fextractable : boolean; external name 'extractable'; \r\n    Falgorithm : TJSObject; external name 'algorithm'; \r\n    Fusages : TKeyUsageDynArray; external name 'usages'; \r\n  Public\r\n    \r\n    Property type_ : KeyType Read Ftype_; \r\n    Property extractable : boolean Read Fextractable; \r\n    Property algorithm : TJSObject Read Falgorithm; \r\n    Property usages : TKeyUsageDynArray Read Fusages; \r\n  end;\r\n  \r\n  { TJSSubtleCrypto }\r\n  \r\n  TJSSubtleCrypto = class external name 'SubtleCrypto' \r\n  Private\r\n  Public\r\n    function encrypt(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; data : TJSBufferSource): TJSPromise;\r\n    function decrypt(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; data : TJSBufferSource): TJSPromise;\r\n    function sign(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; data : TJSBufferSource): TJSPromise;\r\n    function verify(algorithm : AlgorithmIdentifier; key : TJSCryptoKey; signature : TJSBufferSource; data : TJSBufferSource): TJSPromise;\r\n    function digest(algorithm : AlgorithmIdentifier; data : TJSBufferSource): TJSPromise;\r\n    function generateKey(algorithm : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n    function deriveKey(algorithm : AlgorithmIdentifier; baseKey : TJSCryptoKey; derivedKeyType : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n    function deriveBits(algorithm : AlgorithmIdentifier; baseKey : TJSCryptoKey; length_ : NativeInt): TJSPromise;\r\n    function importKey(format : KeyFormat; keyData : TJSObject; algorithm : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n    function exportKey(format : KeyFormat; key : TJSCryptoKey): TJSPromise;\r\n    function wrapKey(format : KeyFormat; key : TJSCryptoKey; wrappingKey : TJSCryptoKey; wrapAlgorithm : AlgorithmIdentifier): TJSPromise;\r\n    function unwrapKey(format : KeyFormat; wrappedKey : TJSBufferSource; unwrappingKey : TJSCryptoKey; unwrapAlgorithm : AlgorithmIdentifier; unwrappedKeyAlgorithm : AlgorithmIdentifier; extractable : boolean; keyUsages : TKeyUsageDynArray): TJSPromise;\r\n  end;\r\n  \r\n  { TJSCrypto }\r\n\r\n  TJSCrypto = class external name 'Crypto'\r\n  private\r\n    Fsubtle: TJSSubtleCrypto; external name 'subtle';\r\n  Public\r\n    procedure getRandomValues (anArray : TJSTypedArray);\r\n    property subtle : TJSSubtleCrypto Read Fsubtle;\r\n  end;\r\n  \r\n  { TJSHistory }\r\n\r\n  TJSHistory = class external name 'History'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n{$IFDEF FIREFOX}\r\n    FState : JSValue; external name 'state';\r\n{$ENDIF}\r\n  Public\r\n    procedure back;\r\n    procedure forward;\r\n    procedure go(aIndex : NativeInt);\r\n    procedure go;\r\n    procedure pushState(aState : jsValue; aTitle : String; AURL : String);\r\n    procedure pushState(aState : jsValue; aTitle : String);\r\n    procedure replaceState(aState : jsValue; aTitle : String; AURL : String);\r\n    procedure replaceState(aState : jsValue; aTitle : String);\r\n    procedure replaceState(aState : jsValue);\r\n{$IFDEF FIREFOX}\r\n    property state : JSValue read FState;\r\n{$ENDIF}\r\n    property length: NativeInt read FLength;\r\n  end;\r\n\r\n  TJSIDBTransactionMode = class\r\n  const\r\n    readonly = 'readonly';\r\n    readwrite = 'readwrite';\r\n    versionchange = 'versionchange';\r\n  end;\r\n\r\n\r\n  { TJSIDBTransaction }\r\n\r\n  TJSIDBTransaction = class external name 'IDBTransaction'  (TJSEventTarget)\r\n  private\r\n    FDB : TIDBDatabase; external name 'db';\r\n    FError: JSValue; external name 'error';\r\n    FMode: String; external name 'mode';\r\n    FObjectStoreNames: TStringDynArray; external name 'objectStoreNames';\r\n  public\r\n    procedure abort;\r\n    function objectStore(aName : String) : TJSIDBObjectStore;\r\n    property db : TIDBDatabase read FDB;\r\n    property mode : String read FMode;\r\n    property objectStoreNames : TStringDynArray read FObjectStoreNames;\r\n    property error : JSValue read FError;\r\n  end;\r\n\r\n\r\n  { TJSIDBKeyRange }\r\n\r\n  TJSIDBKeyRange = class external name 'IDBKeyRange'\r\n  private\r\n    FLower: JSValue;\r\n    FLowerOpen: Boolean;\r\n    FUpper: JSValue;\r\n    FUpperOpen: Boolean;\r\n  Public\r\n    Class Function bound(aLower,aUpper : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function bound(aLower,aUpper : JSValue; aLowerOpen : Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function bound(aLower,aUpper : JSValue; aLowerOpen,aUpperOpen : Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function lowerBound(aLower : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function lowerBound(aLower : JSValue; aOpen: Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function only(aValue : JSValue) : TJSIDBKeyRange;\r\n    Class Function upperBound(aUpper : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function upperBound(aUpper : JSValue; aOpen: Boolean) : TJSIDBKeyRange; overload;\r\n    function includes (aValue : JSValue) : Boolean;\r\n    property lower : JSValue read FLower;\r\n    property lowerOpen : Boolean read FLowerOpen;\r\n    property upper : JSValue read FUpper;\r\n    property upperOpen : Boolean read FUpperOpen;\r\n  end;\r\n\r\n  TJSIDBIndexParameters = record\r\n    unique : boolean;\r\n    multiEntry : boolean;\r\n    locale : string;\r\n  end;\r\n\r\n\r\n  { TJSIDBIndex }\r\n\r\n  TJSIDBIndex = class external name 'IDBIndex'\r\n  private\r\n    FKeyPath: JSValue; external name 'keyPath';\r\n    FMultiEntry: Boolean; external name 'multiEntry';\r\n    FObjectStore: TJSIDBObjectStore; external name 'objectStore';\r\n    FUnique: boolean; external name 'unique';\r\n  public\r\n    name : string;\r\n    function count : TJSIDBRequest;\r\n    function get(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function get(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function getAll(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : jsValue; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAll(aKey : TJSIDBKeyRange; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : jsValue; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : TJSIDBKeyRange; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getKey(aKey : jsValue) : TJSIDBRequest;\r\n    function openCursor : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange; ADirection : String) : TJSIDBRequest;overload;\r\n    function openKeyCursor : TJSIDBRequest;overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest;overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange; ADirection : String) : TJSIDBRequest;overload;\r\n    Property keyPath : JSValue Read FKeyPath;\r\n    property multiEntry : Boolean read FMultiEntry;\r\n    property objectStore : TJSIDBObjectStore read FObjectStore;\r\n    property unique : boolean read FUnique;\r\n  end;\r\n\r\n  TJSIDBCursorDirection = class external name 'IDBCursorDirection'\r\n  Const\r\n    next = 'next';\r\n    nextUnique = 'nextUnique';\r\n    prev = 'prev';\r\n    prevUnique = 'prevUnique';\r\n  end;\r\n\r\n\r\n  { TJSIDBCursor }\r\n\r\n  TJSIDBCursor = class external name 'IDBCursor'\r\n  private\r\n    FDirection: string; external name 'direction';\r\n    FKey: JSValue; external name 'key';\r\n    FValue : JSValue; external name 'value';\r\n    FPrimaryKey: JSValue; external name 'primaryKey';\r\n    FSource: JSValue; external name 'source';\r\n    FSourceAsIndex: TJSIDBIndex; external name 'source';\r\n    FSourceAsStore: TJSIDBObjectStore; external name 'source';\r\n  Public\r\n    procedure advance(aCount : NativeInt); overload;\r\n    procedure advance(aKey : JSValue); overload;\r\n    procedure continue(aKey : JSValue); overload;\r\n    procedure continue; overload;\r\n    procedure continuePrimaryKey(aKey : JSValue); overload;\r\n    procedure continuePrimaryKey(aKey,aPrimaryKey : JSValue); overload;\r\n    procedure delete;\r\n    procedure update(aValue : JSValue);\r\n    property source : JSValue read FSource;\r\n    property sourceAsStore : TJSIDBObjectStore read FSourceAsStore;\r\n    property sourceAsIndex : TJSIDBIndex read FSourceAsIndex;\r\n    property key : JSValue read FKey;\r\n    Property Value : JSValue Read FValue;\r\n    property primaryKey : JSValue read FPrimaryKey;\r\n    property direction : string read FDirection;\r\n  end;\r\n\r\n  TJSIDBObjectStore = class external name 'IDBObjectStore'  (TJSEventTarget)\r\n  public\r\n    function add(aValue : JSValue; aKey : String) : TJSIDBRequest;\r\n    function add(aValue : JSValue) : TJSIDBRequest;\r\n    function clear : TJSIDBRequest;\r\n    function delete(aKey : string) : TJSIDBRequest;\r\n    function delete(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest;\r\n    function get(aKey : string) : TJSIDBRequest; overload;\r\n    function get(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getKey(aKey : string) : TJSIDBRequest; overload;\r\n    function getKey(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll : TJSIDBRequest; overload;\r\n    function getAll(aKey : String) : TJSIDBRequest; overload;\r\n    function getAll(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : String; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAll(aKeyRange : TJSIDBKeyRange; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : String) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : String; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKeyRange : TJSIDBKeyRange; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function createIndex (aIndexName : String; KeyPath : String)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : String; Options : TJSIDBIndexParameters)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : Array of String)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : Array of String; Options : TJSIDBIndexParameters)  : TJSIDBIndex; overload;\r\n    Procedure deleteIndex (aIndexName : String);\r\n    function index (aIndexName : String)  : TJSIDBIndex;\r\n    function put(aValue : JSValue; aKey : String) : TJSIDBRequest; overload;\r\n    function put(aValue : JSValue) : TJSIDBRequest; overload;\r\n    function openCursor : TJSIDBRequest; overload;\r\n    function openCursor(aKey : String) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openCursor(aKey : String; aDirection : string) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange; aDirection : string) : TJSIDBRequest; overload;\r\n    function openKeyCursor : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKey : String) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKey : String; aDirection : string) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange; aDirection : string) : TJSIDBRequest; overload;\r\n    function count : TJSIDBRequest; overload;\r\n    function count(aKey : String) : TJSIDBRequest; overload;\r\n    function count(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    property Indexes [aIndexName : String] : TJSIDBIndex read index;\r\n  end;\r\n\r\n  { TJSIDBRequest }\r\n\r\n  TJSIDBRequest = class external name 'IDBRequest'  (TJSEventTarget)\r\n  private\r\n    Ferror : JSValue; external name 'error'; // standards are not quite clear on this one\r\n    FReadyState: string; external name 'readyState';\r\n    FResult: JSValue; external name 'result';\r\n    FResultDatabase: TIDBDatabase; external name 'result';\r\n    FResultIndex: TJSIDBIndex; external name 'result';\r\n    FResultObjectStore : TJSIDBObjectStore; external name 'result';\r\n    FResultCursor : TJSIDBCursor; external name 'result';\r\n    FSourceDatabase: TIDBDatabase; external name 'source';\r\n    FSourceIndex: TJSIDBIndex; external name 'source';\r\n    FSourceObjectStore : TJSIDBObjectStore; external name 'source';\r\n    FSourceCursor : TJSIDBCursor; external name 'source';\r\n    FSource: JSValue; external name 'source';\r\n    FTransaction: TJSIDBTransaction; external name 'transaction';\r\n  Public\r\n    onerror : TJSEventHandler;\r\n    onsuccess : TJSEventHandler;\r\n    Property error : JSValue read FError;\r\n    property readyState : string read FReadyState;\r\n\r\n    property result : JSValue read FResult;\r\n    property resultAsObjectStore : TJSIDBObjectStore read FResultObjectStore;\r\n    property resultAsCursor : TJSIDBCursor read FResultCursor;\r\n    property resultAsIndex : TJSIDBIndex read FResultIndex;\r\n    property resultAsDatabase : TIDBDatabase read FResultDatabase;\r\n\r\n    property source : JSValue read FSource;\r\n    property sourceAsObjectStore : TJSIDBObjectStore read FSourceObjectStore;\r\n    property sourceAsCursor : TJSIDBCursor read FSourceCursor;\r\n    property sourceAsIndex : TJSIDBIndex read FSourceIndex;\r\n    property sourceAsDatabase : TIDBDatabase read FSourceDatabase;\r\n\r\n    property transaction : TJSIDBTransaction read FTransaction;\r\n  end;\r\n\r\n  TJSIDBOpenDBRequest = class external name 'IDBOpenDBRequest' (TJSIDBRequest)\r\n  Public\r\n    onblocked : TJSEventHandler;\r\n    onupgradeneeded : TJSEventHandler;\r\n  end;\r\n\r\n  TJSCreateObjectStoreOptions = record\r\n    keyPath : jsValue;\r\n    autoIncrement : boolean;\r\n  end;\r\n\r\n  { TIDBDatabase }\r\n\r\n  TIDBDatabase = class external name 'IDBDatabase' (TJSEventTarget)\r\n  private\r\n    FName: string; external name 'name';\r\n    FobjectStoreNames: TStringDynArray; external name 'objectStoreNames';\r\n    FVersion: integer; external name 'version';\r\n  public\r\n    procedure close;\r\n    function createObjectStore(aName : string) : TJSIDBObjectStore; overload;\r\n    function createObjectStore(aName : string; Options: TJSCreateObjectStoreOptions) : TJSIDBObjectStore; overload;\r\n    procedure deleteObjectStore(aName : string);\r\n    function transaction(aStoreNames : array of string) : TJSIDBTransaction; overload;\r\n    function transaction(aStoreNames : array of string; aMode : string) : TJSIDBTransaction; overload;\r\n    property name : string read FName;\r\n    property version : integer read FVersion;\r\n    property objectStoreNames : TStringDynArray read FobjectStoreNames;\r\n  end;\r\n\r\n  TJSIDBFactory = class external name 'IDBFactory' (TJSEventTarget)\r\n  public\r\n    function open(aName : string) : TJSIDBOpenDBRequest;\r\n    function open(aName : string; aVersion : Integer) : TJSIDBOpenDBRequest;\r\n    function deleteDatabase(aName : string) : TJSIDBOpenDBRequest;\r\n    function cmp (a,b : jsValue) : NativeInt;\r\n  end;\r\n  \r\n  { TJSStorage }\r\n\r\n  TJSStorage = class external name 'Storage' (TJSEventTarget)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  public\r\n    function key(aIndex : Integer) : String;\r\n    function getItem(aKeyName : string) : string;\r\n    procedure setItem(aKeyName : string; aValue : string);\r\n    procedure removeItem(aKeyName : string);\r\n    procedure clear;\r\n    property Keys[AIndex : Integer] : String read key;\r\n    property Items[aKeyName: String] : String read getItem write setItem; default;\r\n    property length : NativeInt Read FLength;\r\n  end;\r\n\r\n  // Fake object, used for objects whose visible can be checked\r\n  TJSVisibleItem = class external name 'IVisible'\r\n  Private\r\n    FVisible : boolean; external name 'visible';\r\n  Public\r\n    Property visible : boolean read FVisible;\r\n  end;\r\n  \r\n  TJSLocationBar = class external name 'LocationBar' (TJSVisibleItem);\r\n  TJSMenuBar = class external name 'MenuBar' (TJSVisibleItem);\r\n  TJSToolBar = class external name 'ToolBar' (TJSVisibleItem);\r\n  TJSPersonalBar = class external name 'PersonalBar' (TJSVisibleItem);\r\n  TJSScrollBars = class external name 'ScrollBars' (TJSVisibleItem);\r\n\r\n  TJSPositionError = record\r\n    code : integer;\r\n    message : string;\r\n  end;\r\n\r\n  TJSPositionOptions = record\r\n    enableHighAccuracy : boolean;\r\n    timeout : integer;\r\n    maximumAge : integer;\r\n  end;\r\n\r\n  TJSCoordinates = record\r\n    latitude : double;\r\n    longitude : double;\r\n    altitude : double;\r\n    accuracy : double;\r\n    altitudeAccuracy : double;\r\n    heading : double;\r\n    speed : double;\r\n  end;\r\n\r\n  TJSPosition = record\r\n    coords : TJSCoordinates;\r\n    timestamp : String;\r\n  end;\r\n\r\n  TJSGeoLocationCallback = procedure (aPosition : TJSPosition);\r\n  TJSGeoLocationEvent = procedure (aPosition : TJSPosition) of object;\r\n  TJSGeoLocationErrorCallback = procedure (aValue : TJSPositionError);\r\n  TJSGeoLocationErrorEvent = procedure (aValue : TJSPositionError) of object;\r\n\r\n  TJSGeoLocation  = class external name 'geolocation'\r\n  Public\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback); overload;\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback); overload;\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback; AOptions : TJSPositionOptions); overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback) : NativeInt; overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback) : NativeInt; overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback; AOptions : TJSPositionOptions) : NativeInt; overload;\r\n    procedure clearWatch(AID : NativeInt);\r\n  end;\r\n\r\n  TJSMediaDevices = class external name 'MediaDevices' (TJSEventTarget)\r\n  end;\r\n\r\n  TJSWorker = class external name 'Worker' (TJSEventTarget)\r\n  public\r\n    constructor new(aURL : string);\r\n    procedure postMessage(aValue : JSValue);\r\n    procedure postMessage(aValue : JSValue; aList : TJSValueDynArray);\r\n    procedure terminate;\r\n  end;\r\n\r\n  TJSMessagePort = class external name 'MessagePort' (TJSEventTarget)\r\n  Public\r\n    procedure close;\r\n    procedure postMessage(aValue : JSValue);\r\n    procedure postMessage(aValue : JSValue; aList : TJSValueDynArray);\r\n    procedure start;\r\n  end;\r\n\r\n  { TJSSharedWorker }\r\n\r\n  TJSSharedWorker = class external name 'SharedWorker' (TJSEventTarget)\r\n  private\r\n    FPort: TJSMessagePort; external name 'port';\r\n  Public\r\n    constructor new(aURL : String); overload;\r\n    constructor new(aURL : String; aName : string); overload;\r\n    property port : TJSMessagePort Read FPort;\r\n  end;\r\n\r\n  { TJSServiceWorker }\r\n\r\n  TJSServiceWorker = class external name 'ServiceWorker' (TJSWorker)\r\n  private\r\n    FscriptURL: String;  external name 'scriptURL';\r\n    FState: string;  external name 'state';\r\n  Public\r\n    property state : string read FState;\r\n    property scriptURL : String Read FscriptURL;\r\n  end;\r\n\r\n  { TJSServiceWorkerRegistration }\r\n\r\n  TJSServiceWorkerRegistration = class external name 'ServiceWorkerRegistration'\r\n  private\r\n    FActive: TJSServiceWorker; external name 'active';\r\n    FInstalling: TJSServiceWorker; external name 'installing';\r\n    FScope: string; external name 'scope';\r\n    FWaiting: TJSServiceWorker; external name 'waiting';\r\n  public\r\n    function unregister : TJSPromise;\r\n    procedure update;\r\n    property active : TJSServiceWorker read FActive;\r\n    property scope : string read FScope;\r\n    property waiting : TJSServiceWorker read FWaiting;\r\n    property installing : TJSServiceWorker read FInstalling;\r\n  end;\r\n\r\n  TJSServiceWorkerContainerOptions = record\r\n    scope : string;\r\n  end;\r\n\r\n  { TJSServiceWorkerContainer }\r\n\r\n  TJSServiceWorkerContainer = class external name 'ServiceWorkerContainer'\r\n  private\r\n    FController: TJSServiceWorker; external name 'controller';\r\n    FReady: TJSPromise; external name 'ready';\r\n  Public\r\n    function register(aURL : String) : TJSPromise; overload;\r\n    function register(aURL : String; aOptions : TJSServiceWorkerContainerOptions) : TJSPromise; overload;\r\n    function getRegistration(aURL : String) : TJSPromise; overload;\r\n    function getRegistration : TJSPromise; overload;\r\n    function getRegistrations : TJSPromise;\r\n    property controller : TJSServiceWorker read FController;\r\n    property ready : TJSPromise read FReady;\r\n  end;\r\n\r\n\r\n  { TJSNavigator }\r\n\r\n  TJSNavigator = class external name 'Navigator'\r\n{$IFDEF FIREFOX}\r\n    FbuildID : String ; external name 'buildID';\r\n    FOSCPU : String ; external name 'oscpu';\r\n    FproductSub : string; external name 'productSub';\r\n    FVendor : string; external name 'vendor';\r\n{$ENDIF}\r\n  private\r\n    FCookieEnabled: Boolean; external name 'cookieEnabled';\r\n    FGeoLocation: TJSGeoLocation; external name 'geoLocation';\r\n    FLanguage: String; external name 'language';\r\n    FMaxTouchPoints: NativeInt; external name 'maxTouchPoints';\r\n    FMediaDevices: TJSMediaDevices; external name 'mediaDevices';\r\n    FOnline: boolean; external name 'onLine';\r\n    FPlatform: string; external name 'platform';\r\n    FServiceWorker: TJSServiceWorkerContainer; external name 'serviceWorker';\r\n    FUserAgent: string; external name 'userAgent';\r\n  public\r\n    function getBattery : TJSPromise;\r\n    function requestMediaKeySystemAccess(aKeySystem : String; supportedConfigurations : TJSValueDynArray) : TJSPromise;\r\n    Procedure registerContentHandler(aMimeType,aURI,aTitle : string);\r\n    Procedure registerProtocolHandler(aProtocol,aURI,aTitle : string);\r\n    Procedure vibrate(aPattern : NativeInt);\r\n    Procedure vibrate(aPattern : Array of NativeInt);\r\n{$IFDEF FIREFOX}\r\n    property buildID : String read FBuildID;\r\n    property oscpu : string read FOSCPU;\r\n    property productSub: string read FproductSub;\r\n    property vendor : string read Fvendor;\r\n{$ENDIF}\r\n    property cookieEnabled : Boolean read FCookieEnabled;\r\n    property geoLocation : TJSGeoLocation Read FGeoLocation;\r\n    property language : String read FLanguage;\r\n    property maxTouchPoints : NativeInt read FMaxTouchPoints;\r\n    property mediaDevices : TJSMediaDevices read FMediaDevices;\r\n    property onLine : boolean read FOnline;\r\n    property platform : string read FPlatform;\r\n    property userAgent : string read FUserAgent;\r\n    property serviceWorker : TJSServiceWorkerContainer read FServiceWorker;\r\n  end;\r\n\r\n  { TJSTouchEvent }\r\n  TTouchCoord = longint;\r\n\r\n  TJSTouch = class external name 'Touch'\r\n  private\r\n    FClientX: TTouchCoord; external name 'clientX';\r\n    FClientY: TTouchCoord; external name 'clientY';\r\n    FIDentifier: longint; external name 'identifier';\r\n    FPageX: TTouchCoord; external name 'pageX';\r\n    FPageY: TTouchCoord; external name 'pageY';\r\n    FScreenX: TTouchCoord; external name 'screenX';\r\n    FScreenY: TTouchCoord; external name 'screenY';\r\n    FTarget: TJSElement; external name 'target';\r\n  Public\r\n    Property identifier : longint read FIDentifier;\r\n    Property ScreenX : TTouchCoord Read FScreenX;\r\n    Property ScreenY : TTouchCoord Read FScreenY;\r\n    Property ClientX : TTouchCoord Read FClientX;\r\n    Property ClientY : TTouchCoord Read FClientY;\r\n    Property PageX : TTouchCoord Read FPageX;\r\n    Property PageY : TTouchCoord Read FPageY;\r\n    Property Target : TJSElement Read FTarget;\r\n  end;\r\n\r\n  { TJSTouchList }\r\n\r\n  TJSTouchList = class external name 'TouchList'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    function item (aIndex : Integer) : TJSTouch;\r\n    property length : NativeInt Read FLength;\r\n    Property Touches[AIndex : Integer] : TJSTouch Read item; default;\r\n  end;\r\n\r\n\r\n  TJSPerformance = class external name 'Performance' (TJSObject);\r\n\r\n  TJSScreen = class external name 'Screen' (TJSObject)\r\n  private\r\n    FavailHeight: Integer; external name 'availHeight';\r\n    FavailWidth: Integer; external name 'availWidth';\r\n    FcolorDepth: Integer; external name 'colorDepth';\r\n    FPixelDepth: Integer; external name 'pixelDepth';\r\n    Fheight: Integer; external name 'height';\r\n    Fwidth: Integer; external name 'width';\r\n  public\r\n  { Properties declarations }\r\n    property availHeight: Integer read FavailHeight;\r\n    property availWidth: Integer read FavailWidth;\r\n    property colorDepth: Integer read FcolorDepth;\r\n    property pixelDepth: Integer read FPixelDepth;\r\n    property height: Integer read Fheight;\r\n    property width: Integer read Fwidth;\r\n  end;\r\n\r\n\r\n  TJSURL = class external name 'URL' (TJSObject);\r\n  \r\n  TJSCSSStyleDeclaration = class; // forward\r\n\r\n  TJSTimerCallBack = reference to procedure;\r\n\r\n  { TJSMediaQueryList }\r\n\r\n  TJSMediaQueryList = class external name 'MediaQueryList' (TJSObject)\r\n  private\r\n    FMatches: Boolean; external name 'matches';\r\n    FMedia: String; external name 'media';\r\n  Public\r\n    Property matches : Boolean Read FMatches;\r\n    Property media : String Read FMedia;\r\n  end;\r\n\r\n  TJSReadableStream = class external name 'ReadableStream' (TJSObject)\r\n  private\r\n    flocked: Boolean; external name 'locked';\r\n  public\r\n    property locked: Boolean read flocked;\r\n    constructor new(underlyingSource: TJSObject);\r\n    constructor new(underlyingSource, queueingStrategy: TJSObject);\r\n    function cancel(reason: TJSDOMString): TJSPromise;\r\n    function getReader(): TJSObject; overload;\r\n    function getReader(mode: TJSObject): TJSObject; overload;\r\n    function pipeThrough(transformStream: TJSObject): TJSReadableStream; overload;\r\n    function pipeThrough(transformStream, options: TJSObject): TJSReadableStream; overload;\r\n    function pipeTo(destination: TJSObject): TJSPromise; overload;\r\n    function pipeTo(destination, options: TJSObject): TJSPromise; overload;\r\n    function tee(): TJSArray; // array containing two TJSReadableStream instances\r\n  end;\r\n\r\n  TJSBody = class external name 'Body' (TJSObject)\r\n  private\r\n    fbody: TJSReadableStream; external name 'body';\r\n    fbodyUsed: Boolean; external name 'bodyUsed';\r\n  public\r\n    property body: TJSReadableStream read fbody;\r\n    property bodyUsed: Boolean read fbodyUsed;\r\n    function arrayBuffer(): TJSPromise; // resolves to TJSArrayBuffer\r\n    function blob(): TJSPromise; // resolves to TJSBlob\r\n    function json(): TJSPromise; // resolves to JSON / TJSValue\r\n    function text(): TJSPromise; // resolves to USVString, always decoded using UTF-8\r\n  end;\r\n\r\n  TJSResponse = class external name 'Response' (TJSBody)\r\n  private\r\n    fheaders: TJSObject;external name 'headers';\r\n    fok: Boolean; external name 'ok';\r\n    fredirected: Boolean; external name 'redirected';\r\n    fstatus: NativeInt; external name 'status';\r\n    fstatusText: String; external name 'statusText';\r\n    ftype: String; external name 'type';\r\n    furl: String; external name 'url';\r\n    fuseFinalUrl: Boolean; external name 'useFinalUrl';\r\n  public\r\n    property headers: TJSObject read fheaders; //\r\n    property ok: Boolean read fok;\r\n    property redirected: Boolean read fredirected;\r\n    property status: NativeInt read fstatus;\r\n    property statusText: String read fstatusText; //\r\n    property type_: String read ftype; //\r\n    property url: String read furl; //\r\n    property useFinalUrl: Boolean read fuseFinalUrl write fuseFinalUrl;\r\n    constructor new(body: TJSObject; init: TJSObject); varargs; external name 'new';\r\n    function clone(): TJSResponse;\r\n    function error(): TJSResponse;\r\n    function redirect(url: String; Status: NativeInt): TJSResponse;\r\n  end;\r\n  { TJSWindow }\r\n  TJSDOMHighResTimeStamp = Double;\r\n  TFrameRequestCallback = procedure (aTime: TJSDOMHighResTimeStamp);\r\n\r\n  TJSWindowArray = Array of TJSWindow;\r\n  TJSWindow = class external name 'Window' (TJSObject)\r\n  Private\r\n    FClosed: boolean; external name 'closed';\r\n    FConsole : TJSConsole;  external name 'console';\r\n    FCrypto: TJSCrypto; external name 'crypto';\r\n    FDevicePixelRatio: Double; external name 'devicePixelRatio';\r\n    FDocument: TJSDocument; external name 'document';\r\n    FFrameElement: TJSElement; external name 'frameElement';\r\n    FFrames: TJSWindowArray; external name 'frames';\r\n    FHistory: TJSHistory; external name 'history';\r\n    FIndexedDB: TJSIDBFactory; external name 'indexedDB';\r\n    FInnerheight: NativeInt; external name 'innerHeight';\r\n    FInnerWidth: NativeInt; external name 'innerWidth';\r\n    FLength: NativeInt; external name 'length';\r\n    FLocalStorage: TJSStorage; external name 'localStorage';\r\n    FLocation: TJSLocation; external name 'location';\r\n    FLocationBar: TJSLocationBar; external name 'locationbar';\r\n    FLocationString: string; external name 'location';\r\n    FMenuBar: TJSMenuBar; external name 'menubar';\r\n    FNavigator: TJSNavigator; external name 'navigator';\r\n    FOpener: TJSWindow; external name 'opener';\r\n    FOuterheight: NativeInt; external name 'outerHeight';\r\n    FOuterWidth: NativeInt; external name 'outerWidth';\r\n    FParent: TJSWindow; external name 'parent';\r\n    FPerformance: TJSPerformance; external name 'Performance';\r\n    FPersonalBar: TJSPersonalBar; external name 'personalbar';\r\n    FScreen: TJSScreen; external name 'screen';\r\n    FScreenX: NativeInt; external name 'screenX';\r\n    FScreenY: NativeInt; external name 'screenY';\r\n    FScrollbar: TJSScrollBars; external name 'scrollbar';\r\n    FScrollX: NativeInt; external name 'scrollX';\r\n    FScrollY: NativeInt; external name 'scrollY';\r\n    FSelf: TJSWindow; external name 'self';\r\n    FSessionStorage: TJSStorage; external name 'sessionStorage';\r\n    FToolBar: TJSToolBar; external name 'toolbar';\r\n    FTop: TJSWindow; external name 'top';\r\n    FURL: TJSURL; external name 'URL';\r\n  Public\r\n    fullSreen : Boolean;   \r\n    name : string;\r\n    status : string;\r\n    onabort : TJSEventHandler;\r\n    onafterprint : TJSEventHandler;\r\n    onbeforeprint : TJSEventHandler;\r\n    onbeforeinstallprompt : TJSEventHandler;\r\n    onbeforeunloadprompt : TJSEventHandler;\r\n    onblur : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    onhashchange : TJSHashChangeEventhandler;\r\n    oninput : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onlanguagechange : TJSEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadend : TJSLoadEventhandler;\r\n    onloadstart : TJSLoadEventhandler;\r\n    onmessage : TJSEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onoffline : TJSEventHandler;\r\n    ononline : TJSEventHandler;\r\n    onpagehide : TJSPageTransitionEventHandler;\r\n    onpageshow : TJSPageTransitionEventHandler;\r\n    onpaint : TJSEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onpopstate : TJSPopStateEventHandler;\r\n    onreset : TJSUIEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onstorage : TJSStorageEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onunload : TJSUIEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    procedure addEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure addEventListener(aname : string; aListener : JSValue);\r\n    Procedure alert(Const Msg : String);\r\n    Function atob(Const aValue : string) : string;\r\n    procedure blur;\r\n    Procedure clearInterval(aID: NativeInt);\r\n    Procedure clearTimeout(aID: NativeInt);\r\n    Function btoa(Const aValue : string) : string;\r\n    procedure cancelAnimationFrame(aHandle: Integer);\r\n    Procedure close;\r\n    Function confirm(Const aMsg : String) :  boolean;\r\n    function fetch(resource: String; init: TJSObject): TJSPromise; overload; external name 'fetch';\r\n    function fetch(resource: String): TJSPromise; overload; external name 'fetch';\r\n    function fetch(resource: TJSObject; init: TJSObject): TJSPromise; overload; external name 'fetch';\r\n    function fetch(resource: TJSObject): TJSPromise; overload; external name 'fetch';\r\n    procedure focus;\r\n    Function getComputedStyle(aElement : TJSElement) : TJSCSSStyleDeclaration; overload;\r\n    Function getComputedStyle(aElement,aPseudoElement : TJSElement) : TJSCSSStyleDeclaration; overload;\r\n    function matchMedia(aQuery : String) : TJSMediaQueryList;\r\n    procedure moveBy(x,y : NativeInt);\r\n    procedure moveTo(x,y : NativeInt);\r\n    function open : TJSWindow;\r\n    function open(Const aURL : String) : TJSWindow; overload;\r\n    function open(Const aURL,aTarget : String) : TJSWindow; overload;\r\n    function open(Const aURL,aTarget : String; AOptions : TJSObject) : TJSWindow; overload;\r\n    procedure postMessage(aMessage : JSValue; aTarget : string);\r\n    procedure postMessage(aMessage : JSValue; aTarget : string; aTransfer : TJSValueDynArray);\r\n    procedure print;\r\n    function prompt(const aMessage : String) : String; overload;\r\n    function prompt(const aMessage,aDefault : String) : String; overload;\r\n    procedure removeEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure removeEventListener(aname : string; aListener : JSValue);\r\n    function requestAnimationFrame(aCallback: TFrameRequestCallback): Integer;\r\n    procedure resizeBy(aWidth,aHeight : NativeInt);\r\n    procedure resizeTo(aWidth,aHeight : NativeInt);\r\n    procedure scrollBy(x,y : NativeInt);\r\n    procedure scrollTo(x,y : NativeInt);\r\n    Function setInterval(ahandler : TJSTimerCallBack; aInterval : NativeUInt) : NativeInt; varargs;\r\n    Function setTimeout(ahandler : TJSTimerCallBack; aTimeout : NativeUInt) : NativeInt; varargs;\r\n    Function setTimeout(ahandler : TJSTimerCallBack) : NativeInt;\r\n    procedure stop;\r\n    { public properties }\r\n    property console : TJSConsole Read FConsole;\r\n    property closed : boolean read FClosed;\r\n    property crypto : TJSCrypto Read FCrypto;\r\n    property devicePixelRatio : Double read FDevicePixelRatio;\r\n    property document : TJSDocument read FDocument;\r\n    property frameElement : TJSElement Read FFrameElement;\r\n    Property frames  : TJSWindowArray read FFrames;\r\n    Property history : TJSHistory read FHistory;\r\n    Property indexedDB : TJSIDBFactory read FIndexedDB;\r\n    Property innerHeight : NativeInt Read FInnerheight;\r\n    Property innerWidth : NativeInt Read FInnerWidth;\r\n    Property length : NativeInt Read FLength;\r\n    Property localStorage : TJSStorage Read FLocalStorage; \r\n    property location : TJSLocation Read FLocation;\r\n    Property locationString : String read FLocationString write FLocationString;\r\n    property locationbar : TJSLocationBar Read FLocationBar;\r\n    property menubar : TJSMenuBar Read FMenuBar;\r\n    property navigator : TJSNavigator Read FNavigator;\r\n    property opener : TJSWindow read FOpener;\r\n    Property outerHeight : NativeInt Read FOuterheight;\r\n    Property outerWidth : NativeInt Read FOuterWidth;\r\n    Property parent : TJSWindow Read FParent;\r\n    Property Performance : TJSPerformance Read FPerformance;\r\n    property personalbar : TJSPersonalBar Read FPersonalBar;\r\n    property screen : TJSScreen read FScreen;\r\n    property screenX : NativeInt read FScreenX;\r\n    Property screenY : NativeInt read FScreenY;\r\n    Property scrollbar : TJSScrollBars Read FScrollbar;\r\n    property scrollX : NativeInt read FScrollX;\r\n    Property scrollY : NativeInt read FScrollY;\r\n    Property _Self : TJSWindow read FSelf;\r\n    Property sessionStorage : TJSStorage Read FSessionStorage; \r\n    property toolbar : TJSToolBar Read FToolBar;\r\n    property top : TJSWindow Read FTop;\r\n    property URL : TJSURL Read FURL; \r\n  end;\r\n\r\n  { TJSCSSStyleDeclaration }\r\n\r\n  TJSCSSStyleDeclaration = class external name 'CSSStyleDeclaration'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    FParentRule: TJSCSSRule; external name 'parentRule';\r\n  public\r\n    cssText : string;\r\n    function item(aIndex : Integer) : string;\r\n    function removeProperty(const aProperty : String) : string;\r\n    function getPropertyPriority(const aProperty : String) : string;\r\n    function getPropertyValue(const aProperty : String) : string;\r\n    procedure setProperty(const aProperty,aValue : String);overload;\r\n    procedure setProperty(const aProperty,aValue,aPriority : string); overload;\r\n    property length : NativeInt read FLength;\r\n    property parentRule : TJSCSSRule read FParentRule;\r\n  end;\r\n\r\n\r\n\r\n\r\n\r\n  { TJSHTMLElement }\r\n  TJSHTMLElement = class external name 'HTMLElement' (TJSElement)\r\n  private\r\n    FDataset: TJSObject ; external name 'dataset';\r\n    FIsContentEditable: Boolean ; external name 'isContentEditable';\r\n    FOffsetHeight: Double; external name 'offsetHeight';\r\n    FOffsetLeft: Double; external name 'offsetLeft';\r\n    FOffsetParent: TJSElement; external name 'offsetParent';\r\n    FOffsetTop: Double; external name 'offsetTop';\r\n    FOffsetWidth: Double; external name 'offsetWidth';\r\n  Public\r\n    accessKey : string;\r\n    contentEditable : string;\r\n    dir : string;\r\n    draggable : boolean;\r\n    hidden : boolean;\r\n    lang : string;\r\n    spellcheck : boolean;\r\n    style : TJSCSSStyleDeclaration;\r\n    tabIndex : Integer;\r\n    title: string;\r\n    onabort : TJSEventHandler;\r\n    onanimationcancel: THTMLAnimationEventHandler;\r\n    onanimationend: THTMLAnimationEventHandler;\r\n    onblur : TJSEventHandler;\r\n    oncancel : TJSEventHandler;\r\n    oncanplay : TJSEventHandler;\r\n    oncanplaythrough : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    ondrag : TJSDragDropEventHandler;\r\n    ondragend : TJSDragDropEventHandler;\r\n    ondragenter : TJSDragDropEventHandler;\r\n    ondragexit : TJSDragDropEventHandler;\r\n    ondragover : TJSDragDropEventHandler;\r\n    ondragleave : TJSDragDropEventHandler;\r\n    ondragstart: TJSDragDropEventHandler;\r\n    ondrop : TJSDragDropEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    ondurationchange : TJSEventHandler;\r\n    onemptied : TJSEventHandler;\r\n    onended : TJSEventHandler;\r\n    ongotpointercapture : TJSPointerEventHandler;\r\n    oninput : TJSEventhandler;\r\n    oninvalid : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadeddata : TJSEventhandler;\r\n    onloadedmetadata : TJSEventhandler;\r\n    onloadend : TJSLoadEventhandler;\r\n    onloadstart : TJSLoadEventhandler;\r\n    onlostpointercapture : TJSPointerEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onpause : TJSPointerEventHandler;\r\n    onplay : TJSPointerEventHandler;\r\n    onplaying : TJSPointerEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onseeked : TJSEventHandler;\r\n    onseeking : TJSEventHandler;\r\n    onreset : TJSUIEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectstart : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onshow : TJSEventHandler;\r\n    onstalled : TJSEventHandler;\r\n    ontimeupdate : TJSEventHandler;\r\n    ontransitioncancel : TJSEventHandler;\r\n    ontransitionend : TJSEventHandler;\r\n    onvolumechange : TJSEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onwheel : TJSMouseWheelEventHandler;\r\n    onwaiting : TJSEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    Procedure blur;\r\n    Procedure focus;\r\n    Procedure click;\r\n    property dataset : TJSObject read FDataset;\r\n    property isContentEditable : Boolean read FIsContentEditable;\r\n    property offsetHeight : Double Read FOffsetHeight;\r\n    property offsetLeft : Double Read FOffsetLeft;\r\n    property offsetTop : Double Read FOffsetTop;\r\n    property offsetWidth : Double Read FOffsetWidth;\r\n    property offsetParent : TJSElement Read FOffsetParent;\r\n  end;\r\n\r\n  TJSHTMLFormControlsCollection = class external name 'HTMLFormControlsCollection' (TJSHTMLCollection)\r\n  Public\r\n    function namedItem(S : String) : TJSElement; reintroduce; external name 'namedItem';\r\n    property Items[S : String] : TJSElement read namedItem; default;\r\n  end;\r\n\r\n  { TJSHTMLFormElement }\r\n\r\n  TJSHTMLFormElement = class external name 'HTMLFormElement' (TJSHTMLElement)\r\n  private\r\n    FElements: TJSHTMLFormControlsCollection; external name 'elements';\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    Procedure reset;\r\n    function reportValidity : Boolean;\r\n    function checkValidity : Boolean;\r\n    procedure submit;\r\n    method : string;\r\n    target : string;\r\n    action : string;\r\n    encoding : string;\r\n    enctype : string;\r\n    acceptCharset :  string;\r\n    autocomplete : string;\r\n    noValidate : boolean;\r\n    property elements : TJSHTMLFormControlsCollection read FElements;\r\n    Property length : NativeInt Read FLength;\r\n  end;\r\n\r\n  { TJSValidityState }\r\n\r\n  TJSValidityState = class external name 'ValidityState'\r\n  private\r\n    FBadInput: Boolean; external name 'badInput';\r\n    FCustomError: Boolean; external name 'customError';\r\n    FPatternMismatch: Boolean; external name 'patternMisMatch';\r\n    FRangeOverflow: Boolean; external name 'rangeOverflow';\r\n    FRangeUnderflow: Boolean; external name 'rangeUnderflow';\r\n    FStepMismatch: Boolean; external name 'stepMismatch';\r\n    FTooLong: Boolean; external name 'tooLong';\r\n    FTooShort: Boolean; external name 'tooShort';\r\n    FTypeMismatch: Boolean; external name 'typeMisMatch';\r\n    FValid: Boolean; external name 'valid';\r\n    FValueMissing: Boolean; external name 'valueMissing';\r\n  public\r\n    property badInput : Boolean read FBadInput;\r\n    property customError : Boolean read FCustomError;\r\n    property patternMisMatch : Boolean read FPatternMismatch;\r\n    property rangeOverflow : Boolean read FRangeOverflow;\r\n    property rangeUnderflow : Boolean read FRangeUnderflow;\r\n    property stepMismatch : Boolean read FStepMismatch;\r\n    property tooLong : Boolean read FTooLong;\r\n    property tooShort : Boolean read FTooShort;\r\n    property typeMisMatch : Boolean read FTypeMismatch;\r\n    property valid : Boolean Read FValid;\r\n    property valueMissing : Boolean read FValueMissing;\r\n  end;\r\n\r\n  { TJSBlob }\r\n\r\n  TJSBlob = class external name 'Blob' (TJSEventTarget)\r\n  private\r\n    FSize: NativeInt; external name 'size';\r\n    FType: string; external name  'type';\r\n  Public\r\n    procedure close;\r\n    function slice : TJSBlob; overload;\r\n    function slice(aStart : NativeInt) : TJSBlob; overload;\r\n    function slice(aStart,aEnd : NativeInt) : TJSBlob; overload;\r\n    function slice(aStart,aEnd : NativeInt; AContentType : String) : TJSBlob; overload;\r\n    property size : NativeInt read FSize;\r\n    property _type : string read FType;\r\n  end;\r\n\r\n\r\n  { TJSHTMLFile }\r\n\r\n  TJSHTMLFile = class external name 'File' (TJSBlob)\r\n  private\r\n    FLastModified: NativeInt; external name 'lastModified';\r\n    FLastModifiedDate: TJSDate; external name 'lastModifiedDate';\r\n    FName: string; external name 'name';\r\n  Public\r\n    property name : string read FName;\r\n    property lastModified : NativeInt read FLastModified;\r\n    property lastModifiedDate : TJSDate read FLastModifiedDate;\r\n  end;\r\n\r\n  { TJSHTMLFileList }\r\n\r\n  TJSHTMLFileList = class external name 'FileList' (TJSEventTarget)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    function item(aIndex : NativeInt) : TJSHTMLFile;\r\n    property length : NativeInt read FLength;\r\n    property Files[aIndex : NativeInt] : TJSHTMLFile Read item; default;\r\n  end;\r\n\r\n   { TJSHTMLInputElement }\r\n  // https://html.spec.whatwg.org/multipage/forms.html#the-input-element\r\n\r\n  TJSHTMLInputElement = class external name 'HTMLInputElement' (TJSHTMLElement)\r\n  private\r\n    FFiles: TJSHTMLFileList; external name 'files';\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FList: TJSHTMLElement; external name 'list';\r\n    FValidationmMessage: string; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    procedure select;\r\n    procedure setCustomValidity(aText : string);\r\n    procedure stepUp; overload;\r\n    procedure stepUp(n : Integer); overload;\r\n    function checkValidity : Boolean;\r\n    function reportValidity : Boolean;\r\n    procedure setSelectionRange(selectionStart, selectionEnd: NativeInt) ; overload;\r\n    procedure setSelectionRange(selectionStart, selectionEnd: NativeInt; Direction : string) ; overload;\r\n    procedure setRangeText(aText : string; selectionStart, selectionEnd: NativeInt) ; overload;\r\n    procedure setRangeText(aText : string; selectionStart, selectionEnd: NativeInt; Direction : string) ; overload;\r\n  Public\r\n    accept : string;\r\n    allowDirs : boolean;\r\n    align : string;\r\n    alt : string;\r\n    autofocus : boolean;\r\n    autocapitalize : string;\r\n    autocomplete : string;\r\n    defaultValue : string;\r\n    defaultChecked : string;\r\n    checked : boolean;\r\n    dirName : string;\r\n    disabled : boolean;\r\n    formAction : string;\r\n    formEncType : string;\r\n    formMethod : string;\r\n    formNoValidate : Boolean;\r\n    formTarget : string;\r\n    height : string;\r\n    indeterminate : boolean;\r\n    inputMode : string;\r\n    max : string;\r\n    maxLength : NativeInt;\r\n    min : string;\r\n    minLength : NativeInt;\r\n    multiple : boolean;\r\n    pattern : string;\r\n    placeholder : string;\r\n    readOnly : boolean;\r\n    required : boolean;\r\n    size : NativeInt;\r\n    src : string;\r\n    step : string;\r\n    _type : string; external name 'type';\r\n    selectionStart : NativeInt;\r\n    selectionEnd : NativeInt;\r\n    selectionDirection : string;\r\n    useMap : string;\r\n    value : string;\r\n    width : string;\r\n    property files : TJSHTMLFileList Read FFiles;\r\n    property form : TJSHTMLFormElement read FForm;\r\n    property labels : TJSNodeList read FLabels;\r\n    property list : TJSHTMLElement Read FList;\r\n    property validationMessage : string read FValidationmMessage;\r\n    property willValidate : boolean read FWillValidate;\r\n    property validity : TJSValidityState read FValidity;\r\n  end;\r\n\r\n  TJSDOMSettableTokenList = class external name 'DOMSettableTokenList' (TJSDOMTokenList)\r\n  private\r\n    fvalue: TJSDOMString; external name 'value';\r\n  public\r\n    property value: TJSDOMString read fvalue; // readonly\r\n  end;\r\n\r\n  TJSHTMLOutputElement = class external name 'HTMLOutputElement' (TJSHTMLElement)\r\n  private\r\n    flabels: TJSNodeList; external name 'labels';\r\n    fform: TJSHTMLFormElement; external name 'form';\r\n    ftype: TJSDOMString; external name 'type';\r\n    fdefaultValue: TJSDOMString; external name 'defaultValue';\r\n    fvalue: TJSDOMString; external name 'value';\r\n    fwillValidate: Boolean; external name 'willValidate';\r\n    fvalidity: TJSValidityState; external name 'validity';\r\n    fvalidationMessage: TJSDOMString; external name 'validationMessage';\r\n  public\r\n    htmlFor: TJSDOMSettableTokenList;\r\n    function checkValidity: Boolean;\r\n    function reportValidity: Boolean;\r\n    procedure setCustomValidity(error: TJSDOMString);\r\n  public\r\n    property labels: TJSNodeList read flabels;\r\n    property form: TJSHTMLFormElement read fform;\r\n    property type_: TJSDOMString read ftype;\r\n    property defaultValue: TJSDOMString read fdefaultValue;\r\n    property value: TJSDOMString read fvalue write fvalue;\r\n    property willValidate: Boolean read fwillValidate;\r\n    property validity: TJSValidityState read fvalidity;\r\n    property validationMessage: TJSDOMString read fvalidationMessage;\r\n  end;\r\n\r\n  { TJSHTMLImageElement }\r\n\r\n  TJSHTMLImageElement = class external name 'Image' (TJSHTMLElement)\r\n  Private\r\n    FComplete: boolean; external name 'complete';\r\n    FCurrentSrc: String; external name 'currentSrc';\r\n    FNaturalHeight: NativeUInt; external name 'naturalHeight';\r\n    FNaturalWidth: NativeUInt; external name 'naturalWidth';\r\n    FX: NativeInt; external name 'x';\r\n    FY: NativeInt; external name 'y';\r\n  Public\r\n    constructor New(x,y : Cardinal); overload;\r\n    alt: String;\r\n    crossOrigin: String;\r\n    decoding: String;\r\n    height: NativeUInt;\r\n    isMap: boolean;\r\n    referrerPolicy: String;\r\n    src: String;\r\n    sizes: String;\r\n    srcset: String;\r\n    useMap: String;\r\n    width: NativeUInt;\r\n    function decode : TJSPromise;\r\n    property complete: boolean read FComplete;\r\n    property currentSrc: String read FCurrentSrc;\r\n    property naturalHeight: NativeUInt read FNaturalHeight;\r\n    property naturalWidth: NativeUInt read FNaturalWidth;\r\n    property x: NativeInt read FX;\r\n    property y: NativeInt read FY;\r\n  end;\r\n\r\n  TJSHTMLLinkElement = class external name 'HTMLLinkElement'(TJSHTMLElement)\r\n  Private\r\n    frelList: TJSDOMTokenList; external name 'relList';\r\n    fsizes: TJSDOMSettableTokenList {TJSDOMTokenList}; external name 'sizes';\r\n  Public\r\n    href: string;\r\n    crossOrigin: string;\r\n    rel: string;\r\n    as_: string; external name 'as';\r\n    media: string;\r\n    integrity: string;\r\n    hreflang: string;\r\n    type_: string external name 'type';\r\n    imageSrcset: string;\r\n    imageSizes: string;\r\n    referrerPolicy: string;\r\n    disabled: string;\r\n    charset: string deprecated; // obsolete\r\n    rev: string deprecated; // obsolete property\r\n    target: string deprecated; // obsolete property\r\n    Property relList: TJSDOMTokenList read frelList;\r\n    Property sizes: TJSDOMSettableTokenList{TJSDOMTokenList} read fsizes;\r\n  end;\r\n\r\n  { TJSHTMLMenuElement }\r\n\r\n  TJSHTMLMenuElement = class external name 'HTMLMenuElement' (TJSHTMLElement) //  uhm... should it be declared? it is experimental at Mozilla docs...\r\n  end;\r\n\r\n  { TJSHTMLButtonElement }\r\n\r\n  TJSHTMLButtonElement = class external name 'HTMLButtonElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FValidationmMessage: String; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    autofocus : boolean;\r\n    disabled : boolean;\r\n    formAction : String;\r\n    formEnctype : String;\r\n    formMethod : String;\r\n    formNoValidate : Boolean;\r\n    formTarget : String;\r\n    menu: TJSHTMLMenuElement;\r\n    _type : String; external name 'type';\r\n    value : string;\r\n  Public\r\n    property form : TJSHTMLFormElement Read FForm;\r\n    property labels : TJSNodeList Read FLabels;\r\n    property validationMessage : String Read FValidationmMessage;\r\n    property validity : TJSValidityState Read FValidity;\r\n    property willValidate : boolean read FWillValidate;\r\n  end;\r\n\r\n  TJSHTMLLabelElement = class external name 'HTMLLabelElement' (TJSHTMLElement)\r\n  Public\r\n    For_ : String; external name 'for';\r\n    form : String;\r\n  end;\r\n\r\n  { TJSHTMLTextAreaElement }\r\n\r\n  TJSHTMLTextAreaElement = class external name 'HTMLTextAreaElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FTextLength: NativeInt; external name 'textKength';\r\n    FType: String; external name 'type';\r\n    FValidationMessage: String; external name 'validationMessage';\r\n    FValidity: TJSValidityState;  external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    defaultValue : string;\r\n    value : string;\r\n    rows : cardinal;\r\n    cols : cardinal;\r\n    autofocus : boolean;\r\n    disabled : boolean;\r\n    maxLength : nativeInt;\r\n    readOnly : Boolean;\r\n    required : Boolean;\r\n    selectionStart : Cardinal;\r\n    selectionEnd : Cardinal;\r\n    selectionDirection : String;\r\n    wrap : string;\r\n    Property Form : TJSHTMLFormElement Read FForm;\r\n    Property Type_: String Read FType;\r\n    Property textLength : NativeInt Read FTextLength;\r\n    Property validity : TJSValidityState Read FValidity;\r\n    property willValidate : boolean read FWillValidate;\r\n    property validationMessage : String Read FValidationMessage;\r\n  end;\r\n\r\n  { TJSHTMLEmbedElement }\r\n\r\n  TJSHTMLEmbedElement = class external name 'HTMLEmbedElement' (TJSHTMLElement)\r\n  Public\r\n    height: String;\r\n    src: String;\r\n    _type : String; external name 'type';\r\n    width: String;\r\n  end;\r\n\r\n  { TJSHTMLOptionElement }\r\n\r\n  TJSHTMLOptionElement = class external name 'Option' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FIndex: NativeInt; external name 'index';\r\n  Public\r\n    Constructor New; overload;\r\n    Constructor New(aText : String); overload;\r\n    Constructor New(aText,aValue : String); overload;\r\n    Constructor New(aText,aValue : String; aDefaultSelected : Boolean); overload;\r\n    Constructor New(aText,aValue : String; aDefaultSelected,Selected : Boolean); overload;\r\n  Public\r\n    defaultSelected : boolean;\r\n    disabled : boolean;\r\n    _label : string ; external name 'label';\r\n    selected : boolean;\r\n    text : string;\r\n    value : string;\r\n    property index : NativeInt Read FIndex;\r\n    property form : TJSHTMLFormElement Read FForm;\r\n  end;\r\n\r\n  TJSHTMLOptGroupElement = class external name 'HTMLOptGroupElement' (TJSHTMLElement)\r\n  end;\r\n\r\n  TJSHTMLOptionsCollection = class external name 'HTMLOptionsCollection' (TJSHTMLCollection)\r\n  end;\r\n\r\n  { TJSHTMLSelectElement }\r\n\r\n  TJSHTMLSelectElement = Class external name 'HTMLSelectElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FLength: NativeInt; external name 'length';\r\n    FOptions: TJSHTMLOptionsCollection; external name 'options';\r\n    FSelectedOptions: TJSHTMLCollection; external name 'selectedOptions';\r\n    FType: String; external name 'type';\r\n    FValidationMessage: string; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    fwillValidate: Boolean; external name 'willValidate';\r\n  Public\r\n    Procedure add(anItem : TJSHTMLOptionElement); overload;\r\n    Procedure add(anItem, before : TJSHTMLOptionElement); overload;\r\n    function item(aIndex : NativeInt): TJSHTMLOptionElement;\r\n    function namedItem(aName : String): TJSHTMLOptionElement;\r\n    procedure remove(aIndex : NativeInt);\r\n    procedure checkValidity;\r\n    procedure setCustomValidity(aMessage : String);\r\n  Public\r\n    multiple : boolean;\r\n    required: boolean;\r\n    selectedIndex : NativeInt;\r\n    size : NativeInt;\r\n    value : string;\r\n    property length : NativeInt read FLength;\r\n    Property options : TJSHTMLOptionsCollection read FOptions;\r\n    Property selectedOptions : TJSHTMLCollection read FSelectedOptions;\r\n    Property form : TJSHTMLFormElement read FForm;\r\n    property labels : TJSNodeList Read FLabels;\r\n    property _type : String Read FType;\r\n    property validity : TJSValidityState Read FValidity;\r\n    property validationMessage : string Read FValidationMessage;\r\n    property willValidate : Boolean read fwillValidate;\r\n  end;\r\n\r\n  { TJSHTMLTableElement }\r\n\r\n  TJSHTMLTableSectionElement = class;\r\n  TJSHTMLTableRowElement = class;\r\n\r\n  TJSHTMLTableElement = Class external name 'HTMLTableElement'(TJSHTMLElement)\r\n  private\r\n    FAlign: String; external name 'align';\r\n    FBGColor: String; external name 'bgColor';\r\n    FBorder: String; external name 'border';\r\n    FCaption: TJSHTMLElement; external name 'caption';\r\n    FCellPadding: String; external name 'cellPadding';\r\n    FCellSpacing: String; external name 'cellSpacing';\r\n    FFrame: String; external name 'frame';\r\n    FRows: TJSHTMLCollection; external name 'rows';\r\n    FRules: String; external name 'rules';\r\n    FSummary: String; external name 'summary';\r\n    FTBodies: TJSHTMLCollection; external name 'tBodies';\r\n    FTfoot: TJSHTMLTableSectionElement; external name 'tfoot';\r\n    FTHead: TJSHTMLTableSectionElement; external name 'tHead';\r\n    FWidth: String; external name 'width';\r\n  public\r\n  { Methods }\r\n    function createCaption: TJSHTMLElement;\r\n    function createTFoot: TJSHTMLTableSectionElement;\r\n    function createTHead: TJSHTMLTableSectionElement;\r\n    procedure deleteCaption;\r\n    procedure deleteRow(index: Integer);\r\n    procedure deleteTFoot;\r\n    procedure deleteTHead;\r\n    function insertRow(index: Integer): TJSHTMLTableRowElement;\r\n  { Properties }\r\n    property align: String read FAlign write FAlign;\r\n    property bgColor: String read FBGColor write FBGColor;\r\n    property border: String read FBorder write FBorder;\r\n    property caption: TJSHTMLElement read FCaption;\r\n    property cellPadding: String read FCellPadding write FCellPadding;\r\n    property cellSpacing: String read FCellSpacing write FCellSpacing;\r\n    property frame: String read FFrame write FFrame;\r\n    property rows: TJSHTMLCollection read FRows;\r\n    property rules: String read FRules write FRules;\r\n    property summary: String read FSummary write FSummary;\r\n    property tBodies: TJSHTMLCollection read FTBodies;\r\n    property tfoot: TJSHTMLTableSectionElement read FTfoot;\r\n    property tHead: TJSHTMLTableSectionElement read FTHead;\r\n    property width: String read FWidth write FWidth;\r\n  end;\r\n\r\n  { TJSHTMLTableSectionElement }\r\n\r\n  TJSHTMLTableSectionElement = Class external name 'HTMLTableSectionElement' (TJSHTMLElement)\r\n  private\r\n    Falign: String; external name 'align';\r\n    Frows: TJSHTMLCollection external name 'rows';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FvAlign: String; external name 'vAlign';\r\n  public\r\n  { Methods }\r\n    procedure deleteRow(index: Integer);\r\n    function insertRow(index: Integer): TJSHTMLTableRowElement;\r\n  { Properties }\r\n    property align: String read Falign write Falign;\r\n    property rows: TJSHTMLCollection read Frows;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n  end;\r\n\r\n  { TJSHTMLTableCellElement }\r\n\r\n  TJSHTMLTableCellElement = Class external name 'HTMLTableCellElement' (TJSHTMLElement)\r\n  private\r\n    Fabbr: String; external name 'abbr';\r\n    Falign: String; external name 'align';\r\n    Faxis: String; external name 'axis';\r\n    FbgColor: String; external name 'bgColor';\r\n    FcellIndex: Integer; external name 'cellIndex';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FcolSpan: Integer; external name 'colSpan';\r\n    Fheaders: String; external name 'headers';\r\n    Fheight: String; external name 'height';\r\n    FnoWrap: Boolean; external name 'noWrap';\r\n    FrowSpan: Integer; external name 'rowSpan';\r\n    Fscope: String; external name 'scope';\r\n    FvAlign: String; external name 'vAlign';\r\n    Fwidth: String; external name 'width';\r\n  public\r\n  { Properties }\r\n    property abbr: String read Fabbr write Fabbr;\r\n    property align: String read Falign write Falign;\r\n    property axis: String read Faxis write Faxis;\r\n    property bgColor: String read FbgColor write FbgColor;\r\n    property cellIndex: Integer read FcellIndex;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property colSpan: Integer read FcolSpan write FcolSpan;\r\n    property headers: String read Fheaders write Fheaders;\r\n    property height: String read Fheight write Fheight;\r\n    property noWrap: Boolean read FnoWrap write FnoWrap;\r\n    property rowSpan: Integer read FrowSpan write FrowSpan;\r\n    property scope: String read Fscope write Fscope;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n    property width: String read Fwidth write Fwidth;\r\n  end;\r\n\r\n  { TJSHTMLTableRowElement }\r\n\r\n  TJSHTMLTableRowElement = Class external name 'HTMLTableRowElement' (TJSHTMLElement)\r\n  private\r\n    Falign: String; external name 'align';\r\n    FbgColor: String; external name 'bgColor';\r\n    Fcells: TJSHTMLCollection; external name 'cells';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FrowIndex: Integer; external name 'rowIndex';\r\n    FsectionRowIndex: Integer; external name 'sectionRowIndex';\r\n    FvAlign: String; external name 'vAlign';\r\n  public\r\n  { Methods }\r\n    procedure deleteCell(index: Integer);\r\n    function insertCell(index: Integer): TJSHTMLTableCellElement;\r\n  { Properties }\r\n    property align: String read Falign write Falign;\r\n    property bgColor: String read FbgColor write FbgColor;\r\n    property cells: TJSHTMLCollection read Fcells;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property rowIndex: Integer read FrowIndex;\r\n    property sectionRowIndex: Integer read FsectionRowIndex;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n  end;\r\n\r\n  { TJSHTMLTableDataCellElement }\r\n\r\n  TJSHTMLTableDataCellElement = Class external name 'HTMLTableDataCellElement' (TJSHTMLElement)\r\n  private\r\n    Fabbr: String; external name 'abbr';\r\n  public\r\n  { Properties }\r\n    property abbr: String read Fabbr write Fabbr;\r\n  end;\r\n\r\n\r\n  TJSCanvasRenderingContext2D = Class;\r\n\r\n  THTMLCanvasToBlobCallback = Reference to function (aBlob : TJSBlob) : boolean;\r\n\r\n  TJSHTMLCanvasElement = Class external name 'HTMLCanvasElement' (TJSHTMLElement)\r\n  Public\r\n    height : integer;\r\n    width : integer;\r\n    Function getContext(contextType : string) : TJSObject;\r\n    Function getContext(contextType : string; contextAttributes : TJSObject) : TJSObject;\r\n    Function getContextAs2DContext(contextType : string; contextAttributes : TJSObject) : TJSCanvasRenderingContext2D; external name 'getContext';\r\n    Function getContextAs2DContext(contextType : string) : TJSCanvasRenderingContext2D; external name 'getContext';\r\n    Procedure toBlob (aCallBack : THTMLCanvasToBlobCallback; aMimeType : String); overload;\r\n    Procedure toBlob (aCallBack : THTMLCanvasToBlobCallback; aMimeType : String; aQuality : Double); overload;\r\n    Function toDataURL : String; overload;\r\n    Function toDataURL(aMimeType : String) : String; overload;\r\n    Function toDataURL(aMimeType : String; aQuality : Double) : String; overload;\r\n  end;\r\n\r\n  TJSHTMLProgressElement = class external name 'HTMLProgressElement' (TJSHTMLElement)\r\n  private\r\n    Fposition: Double; external name 'position';\r\n    Flabels: TJSNodeList; external name 'labels';\r\n  public\r\n    max: Double;\r\n    value: Double;\r\n    property position: Double read Fposition;\r\n    property labels: TJSNodeList read Flabels;\r\n  end;\r\n  { TJSDOMException }\r\n\r\n  TJSDOMException = class external name 'DOMException' (TJSObject)\r\n  private\r\n    FCode: Integer; external name 'code';\r\n    FMessage: String; external name 'message';\r\n    FName: string; external name 'name';\r\n  Public\r\n    Property code : Integer Read FCode;\r\n    Property Message : String Read FMessage;\r\n    Property name : string Read FName;\r\n  end;\r\n\r\n  { TJSFileReader }\r\n\r\n  TJSFileReader = class external name 'FileReader' (TJSEventTarget)\r\n  private\r\n    FError: TJSDOMException; external name 'error';\r\n    fReadyState: Integer; external name 'readyState';\r\n    FResult: JSValue; external name 'result';\r\n  public\r\n    const EMPTY : Integer = 0;\r\n    const LOADING : Integer = 1;\r\n    const DONE : Integer = 2;\r\n  public\r\n    onabort : TJSEventHandler;\r\n    onerror : TJSEventHandler;\r\n    onload : TJSEventHandler;\r\n    onloadstart : TJSEventHandler;\r\n    onloadend : TJSEventHandler;\r\n    onprogress : TJSEventHandler;\r\n  Public\r\n    constructor new;\r\n    Procedure abort;\r\n    procedure readAsArrayBuffer(Blob: TJSBlob);\r\n    procedure readAsBinaryString(Blob: TJSBlob);\r\n    procedure readAsDataURL(Blob: TJSBlob);\r\n    procedure readAsText(Blob: TJSBlob; encoding : string);\r\n    procedure readAsText(Blob: TJSBlob);\r\n    property Error : TJSDOMException read FError;\r\n    Property readyState : Integer Read fReadyState;\r\n    property Result : JSValue Read FResult;\r\n  end;\r\n\r\n  // Opaque objects\r\n  TJSCanvasGradient = class external name 'CanvasGradient'\r\n  end;\r\n\r\n  TJSCanvasPattern = class external name 'CanvasPattern'\r\n  end;\r\n\r\n  TJSPath2D = class external name 'Path2D'\r\n  end;\r\n\r\n  { TJSImageData }\r\n\r\n  TJSImageData = class external name 'ImageData'\r\n  private\r\n    FData: TJSUint8ClampedArray; external name 'data';\r\n    FHeight: Integer; external name 'height';\r\n    FWidth: Integer; external name 'width';\r\n  Public\r\n    constructor new(awidth,aheight : integer); overload;\r\n    constructor new(anArray :TJSUint8ClampedArray; awidth,aheight : integer); overload;\r\n    property data : TJSUint8ClampedArray read FData;\r\n    property height : Integer Read FHeight;\r\n    property width : Integer Read FWidth;\r\n  end;\r\n\r\n  TCanvasCoordType = double; // Is in fact a number.\r\n\r\n  TJSTextMetrics = record\r\n    width : TCanvasCoordType;\r\n    actualBoundingBoxLeft : TCanvasCoordType;\r\n    actualBoundingBoxRight : TCanvasCoordType;\r\n    fontBoundingBoxAscent : TCanvasCoordType;\r\n    fontBoundingBoxDescent : TCanvasCoordType;\r\n    actualBoundingBoxAscent : TCanvasCoordType;\r\n    actualBoundingBoxDescent : TCanvasCoordType;\r\n    emHeightAscent : TCanvasCoordType;\r\n    emHeightDescent : TCanvasCoordType;\r\n    hangingBaseline : TCanvasCoordType;\r\n    alphabeticBaseline : TCanvasCoordType;\r\n    ideographicBaseline : TCanvasCoordType;\r\n  end;\r\n\r\n  { TJSCanvasRenderingContext2D }\r\n  TJSCanvasRenderingContext2D = class external name 'CanvasRenderingContext2D'\r\n  private\r\n    FCanvas: TJSHTMLCanvasElement; external name 'canvas';\r\n    FfillStyleColor: String; external name 'fillStyle';\r\n    FfillStyleGradient: TJSCanvasGradient; external name 'fillStyle';\r\n    FfillStylePattern: TJSCanvasPattern; external name 'fillStyle';\r\n    FstrokeStyleColor: String; external name 'strokeStyle';\r\n    FstrokeStyleGradient: TJSCanvasGradient; external name 'strokeStyle';\r\n    FstrokeStylePattern: TJSCanvasPattern; external name 'strokeStyle';\r\n  Public\r\n    fillStyle : JSValue;\r\n    font : string;\r\n    globalAlpha : double;\r\n    globalCompositeOperation : String;\r\n    lineCap : string;\r\n    lineDashOffset : Double;\r\n    lineJoin : String;\r\n    lineWidth : Double;\r\n    miterLimit : Double;\r\n    shadowBlur : Double;\r\n    shadowColor : String;\r\n    shadowOffsetX : Double;\r\n    shadowOffsetY : Double;\r\n    strokeStyle : JSValue;\r\n    textAlign : String;\r\n    textBaseline : String;\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType); overload;\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType; antiClockWise : boolean); overload;\r\n    procedure arcTo(x1,y1,x2,y2,radius : TCanvasCoordType); overload;\r\n    procedure beginPath;\r\n    procedure bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y : TCanvasCoordType); overload;\r\n    procedure clearRect(x,y,width,height : TCanvasCoordType);\r\n    procedure clip; overload;\r\n    procedure clip(aFillRule : String); overload;\r\n    procedure clip(aPath : TJSPath2D); overload;\r\n    procedure closePath;\r\n    function createImageData(aWidth,aHeight : Integer) : TJSImageData; overload;\r\n    function createImageData(aImage : TJSImageData) : TJSImageData; overload;\r\n    function createLinearGradient(x0,y0,x1,y1 : TCanvasCoordType) : TJSCanvasGradient;\r\n    function createPattern(aImage : TJSObject; repetition : string) : TJSCanvasPattern;\r\n    function createRadialGradient(x0,y0,r0,x1,y1,r1 : TCanvasCoordType) : TJSCanvasGradient;\r\n    procedure drawFocusIfNeeded(aElement : TJSElement); overload;\r\n    procedure drawFocusIfNeeded(aPath : TJSPath2D; aElement : TJSElement); overload;\r\n    procedure drawImage(image : TJSObject; dx,dy : TCanvasCoordType); overload;\r\n    procedure drawImage(image : TJSObject; dx,dy,dwidth,dheight : TCanvasCoordType); overload;\r\n    procedure drawImage(image : TJSObject; sx,sy,sWidth,sHeight,dx,dy,dwidth,dheight : TCanvasCoordType); overload;\r\n    procedure fill; overload;\r\n    procedure fill(aRule : String); overload;\r\n    procedure fill(aPath : TJSPath2D); overload;\r\n    procedure fill(aPath : TJSPath2D;aRule : String); overload;\r\n    procedure fillRect(x,y,awidth,aheight: TCanvasCoordType); overload;\r\n    procedure fillText(aText : string; x,y : TCanvasCoordType); overload;\r\n    procedure fillText(aText : string; x,y, aMaxWidth : TCanvasCoordType); overload;\r\n    function getImageData(x,y,awidth,aheight: TCanvasCoordType) : TJSImageData; overload;\r\n    function getLineDash : TJSArray;\r\n    function isPointInPath(x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInPath(x,y : TCanvasCoordType; aFillRule : String) : Boolean; overload;\r\n    function isPointInPath(aPath : TJSPath2D; x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInPath(aPath : TJSPath2D; x,y : TCanvasCoordType; aFillRule : String) : Boolean; overload;\r\n    function isPointInStroke(x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInStroke(aPath : TJSPath2D; x,y : TCanvasCoordType) : Boolean; overload;\r\n    procedure lineTo(x,y : TCanvasCoordType);\r\n    function measureText(S : String) : TJSTextMetrics;\r\n    procedure moveTo(x,y : TCanvasCoordType);\r\n    procedure putImageData(aData : TJSImageData; x,y: TCanvasCoordType) ; overload;\r\n    procedure putImageData(aData : TJSImageData; x,y,dityX,dirtyY,dirtyWidth,dirtyHeight: TCanvasCoordType) ; overload;\r\n    procedure quadraticCurveTo(cpx,cpy,x,y : TCanvasCoordType);\r\n    procedure rect(x,y,awidth,aheight: TCanvasCoordType); overload;\r\n    procedure restore;\r\n    procedure rotate(anAngle : double);\r\n    procedure save;\r\n    procedure scale(x,y : double);\r\n    procedure setLineDash(segments : TJSArray); overload;\r\n    procedure setLineDash(segments : array of integer); overload;\r\n    procedure setTransform(a,b,c,d,e,f : double);\r\n    procedure stroke; overload;\r\n    procedure stroke(aPath : TJSPath2D); overload;\r\n    procedure strokeRect(x,y,awidth,aheight: TCanvasCoordType);\r\n    procedure strokeText(aText : string; x,y : TCanvasCoordType); overload;\r\n    procedure strokeText(aText : string; x,y, aMaxWidth : TCanvasCoordType); overload;\r\n    procedure transform(a,b,c,d,e,f : double);\r\n    procedure translate(x,y : TCanvasCoordType);\r\n\r\n    property canvas : TJSHTMLCanvasElement Read FCanvas;\r\n    property fillStyleAsColor : String Read FfillStyleColor Write FfillStyleColor;\r\n    property fillStyleAsGradient : TJSCanvasGradient Read FfillStyleGradient Write FfillStyleGradient;\r\n    property fillStyleAsPattern : TJSCanvasPattern Read FfillStylePattern Write FfillStylePattern;\r\n    property strokeStyleAsColor : String Read FstrokeStyleColor Write FstrokeStyleColor;\r\n    property strokeStyleAsGradient : TJSCanvasGradient Read FstrokeStyleGradient Write FstrokeStyleGradient;\r\n    property strokeStyleAsPattern : TJSCanvasPattern Read FstrokeStylePattern Write FstrokeStylePattern;\r\n  end;\r\n\r\n  { TJSHTMLIFrameElement }\r\n\r\n  TJSHTMLIFrameElement = Class external name 'HTMLIFrameElement' (TJSHTMLElement)\r\n  private\r\n    FAllowPaymentRequest: Boolean; external name 'allowPaymentRequest';\r\n    FContentDocument: TJSDocument; external name 'contentDocument';\r\n    FContentWindow: TJSWindow; external name 'contentWindow';\r\n    FSandbox: string; external name 'sandbox';\r\n  Public\r\n    height : string;\r\n    src : string;\r\n    srcdoc : string;\r\n    width : string;\r\n    Property allowPaymentRequest : Boolean Read FAllowPaymentRequest;\r\n    property contentWindow : TJSWindow Read FContentWindow;\r\n    property contentDocument : TJSDocument Read FContentDocument;\r\n    property sandbox : string read FSandbox;\r\n  end;\r\n\r\n  TJSHTMLScriptElement = Class external name 'HTMLScriptElement' (TJSHTMLElement)\r\n  Public\r\n    type_ : String external name 'type';\r\n    src : String;\r\n    charset : string;\r\n    integrity : string;\r\n    async : boolean;\r\n    defer : boolean;\r\n    text : string;\r\n    crossOrigin : string;\r\n    referrerPolicy : string;\r\n    noModule : boolean;\r\n  end;\r\n\r\n\r\n\r\n  TJSXMLHttpRequestEventTarget = class external name 'XMLHttpRequestEventTarget' (TJSEventTarget)\r\n  end;\r\n\r\n  TJSXMLHttpRequestUpload = class external name 'XMLHttpRequestUpload' (TJSXMLHttpRequestEventTarget)\r\n  end;\r\n\r\n  { TJSXMLHttpRequest }\r\n  TJSOnReadyStateChangeHandler = reference to procedure;\r\n\r\n  TJSXMLHttpRequest = class external name 'XMLHttpRequest' (TJSXMLHttpRequestEventTarget)\r\n  private\r\n    FReadyState: NativeInt; external name 'readyState';\r\n    FResponse: JSValue; external name 'response';\r\n    FResponseText: string; external name 'responseText';\r\n    FResponseType: string; external name 'responseType';\r\n    FresponseURL: string; external name 'responseURL';\r\n    FresponseXML: TJSDocument; external name 'responseXML';\r\n    FUpload: TJSXMLHttpRequestUpload; external name 'upload';\r\n    FStatus : integer; external name 'status';\r\n    FStatusText : string; external name 'statusText';\r\n  public\r\n    const\r\n      UNSENT           = 0;\r\n      OPENED           = 1;\r\n      HEADERS_RECEIVED = 2;\r\n      LOADING          = 3;\r\n      DONE             = 4;\r\n  public\r\n    timeout : LongWord;\r\n    withCredentials : Boolean;\r\n    onreadystatechange : TJSOnReadyStateChangeHandler;\r\n    constructor new;\r\n    procedure abort;\r\n    function getResponseHeader(aName : string) : String;\r\n    function getAllResponseHeaders : String;\r\n    procedure open(aMethod,aURL : String); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean; AUserame : String); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean; AUserame,APassword : String); overload;\r\n    procedure overrideMimeType(aType : String);\r\n    procedure send(aBody : jsValue);overload;\r\n    procedure send;overload;\r\n    procedure setRequestHeader(aName, AValue : string);\r\n\r\n    property readyState : NativeInt read FReadyState;\r\n    property ResponseHeaders[aName : string] : string Read getResponseHeader;\r\n    property responseXML : TJSDocument read FresponseXML;\r\n    property responseURL : string read FresponseURL;\r\n    property responseType : string read FResponseType Write FResponseType;\r\n    property response : JSValue Read FResponse;\r\n    property responseText : string read FResponseText;\r\n    property Status : integer read FStatus;\r\n    property StatusText : string read FStatusText;\r\n    property upload : TJSXMLHttpRequestUpload read FUpload;\r\n\r\n  end;\r\n\r\n  { TJSUIEvent }\r\n\r\n  TJSUIEvent = class external name 'UIEvent' (TJSEvent)\r\n  private\r\n    FDetail: NativeInt; external name 'detail';\r\n    FView: TJSWindow; external name 'view';\r\n  Public\r\n    property detail : NativeInt read FDetail;\r\n    property view : TJSWindow read FView;\r\n  end;\r\n\r\n  { TJSMouseEvent }\r\n\r\n  TJSMouseEvent = class external name 'MouseEvent' (TJSUIevent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FBUtton: NativeInt; external name 'button';\r\n    FBUttons: NativeInt; external name 'buttons';\r\n    FClientX: Double; external name 'clientX';\r\n    FClientY: Double; external name 'clientY';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FmovementX: Double; external name 'movementX';\r\n    FmovementY: Double; external name 'movementY';\r\n    FoffsetX: Double; external name 'offsetX';\r\n    FoffsetY: Double; external name 'offsetY';\r\n    FRegion: String; external name 'region';\r\n    FRelatedTarget: TJSEventTarget; external name 'relatedTarget';\r\n    FscreenX: Double; external name 'screenX';\r\n    FscreenY: Double; external name 'screenY';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n  Public\r\n    function getModifierState(keyArg: String): boolean;\r\n    Property altKey : Boolean read FAltKey;\r\n    Property button: NativeInt read FBUtton;\r\n    Property buttons: NativeInt read FBUttons;\r\n    property clientX : Double read FClientX;\r\n    property clientY : Double read FClientY;\r\n    property ctrlKey : Boolean read FCtrlKey;\r\n    property metaKey : Boolean read FMetaKey;\r\n    property movementX : Double read FmovementX;\r\n    property movementY : Double read FmovementY;\r\n    property offsetX : Double read FoffsetX;\r\n    property offsetY : Double read FoffsetY;\r\n{$IFDEF FIREFOX}\r\n    property pageX : Double read FpageX;\r\n    property pageY : Double read FpageY;\r\n{$ENDIF}\r\n    property region : String read FRegion;\r\n    property relatedTarget : TJSEventTarget read FRelatedTarget;\r\n    property screenX : Double read FscreenX;\r\n    property screenY : Double read FscreenY;\r\n    property shiftKey : Boolean read FShiftKey;\r\n    property x : Double read FClientX;\r\n    property y : Double read FClientY;\r\n  end;\r\n\r\n  { TJSWheelEvent }\r\n  TJSWheelEventInit = record\r\n    deltaX : Double;\r\n    deltaY : Double;\r\n    deltaZ : Double;\r\n    deltaMode : NativeInt;\r\n  end;\r\n\r\n  TJSWheelEvent = class external name 'WheelEvent' (TJSMouseEvent)\r\n  private\r\n    FDeltaMode: NativeInt; external name 'deltaMode';\r\n    FDeltaX: Double; external name 'deltaX';\r\n    FDeltaY: Double; external name 'deltaY';\r\n    FDeltaZ: Double; external name 'deltaZ';\r\n  Public\r\n    constructor new(atype : String); overload;\r\n    constructor new(atype : String; aInit : TJSWheelEventInit); overload;\r\n    Property deltaX : Double Read FDeltaX;\r\n    Property deltaY : Double Read FDeltaY;\r\n    Property deltaZ : Double Read FDeltaZ;\r\n    Property deltaMode : NativeInt Read FDeltaMode;\r\n  end;\r\n\r\n  TJSPointerEvent = Class external name 'PointerEvent' (TJSMouseEvent);\r\n\r\n  TJSTouchEvent = Class external name 'TouchEvent'(TJSUIEvent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FChangedTouches: TJSTouchList; external name 'changedTouches';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n    FTargetTouches: TJSTouchList; external name 'targetTouches';\r\n    FTouches: TJSTouchList; external name 'touches';\r\n  Public\r\n    Property altKey : Boolean Read FAltKey;\r\n    Property ctrlKey : Boolean Read FCtrlKey;\r\n    Property metaKey : Boolean Read FMetaKey;\r\n    Property shiftKey : Boolean Read FShiftKey;\r\n    property changedTouches : TJSTouchList Read FChangedTouches;\r\n    property touches : TJSTouchList Read FTouches;\r\n    property targetTouches : TJSTouchList Read FTargetTouches;\r\n  end;\r\n\r\n\r\n  // Namespace for standard key names.\r\n  // See list at https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values\r\n  TJSKeyNames = Class\r\n  Const\r\n    Alt = 'Alt';\r\n    AltGraph = 'AltGraph';\r\n    CapsLock = 'CapsLock';\r\n    Control = 'Control';\r\n    Fn = 'Fn';\r\n    FnLock = 'FnLock';\r\n    Hyper = 'Hyper';\r\n    Meta = 'Meta';\r\n    NumLock = 'NumLock';\r\n    ScrollLock = 'ScrollLock';\r\n    Shift = 'Shift';\r\n    Super = 'Super';\r\n    Symbol = 'Symbol';\r\n    SymbolLock = 'SymbolLock';\r\n    Enter = 'Enter';\r\n    Tab = 'Tab';\r\n    Space = 'Space';\r\n    ArrowDown = 'ArrowDown';\r\n    ArrowLeft = 'ArrowLeft';\r\n    ArrowRight = 'ArrowRight';\r\n    ArrowUp = 'ArrowUp';\r\n    _End = 'End';\r\n    Home = 'Home';\r\n    PageDown = 'PageDown';\r\n    PageUp = 'PageUp';\r\n    BackSpace = 'Backspace';\r\n    Clear = 'Clear';\r\n    Copy = 'Copy';\r\n    CrSel = 'CrSel';\r\n    Cut = 'Cut';\r\n    Delete = 'Delete';\r\n    EraseEof = 'EraseEof';\r\n    ExSel = 'ExSel';\r\n    Insert = 'Insert';\r\n    Paste = 'Paste';\r\n    Redo = 'Redo';\r\n    Undo = 'Undo';\r\n    Accept = 'Accept';\r\n    Again = 'Again';\r\n    Attn = 'Attn';\r\n    Cancel = 'Cancel';\r\n    ContextMenu = 'Contextmenu';\r\n    Escape = 'Escape';\r\n    Execute = 'Execute';\r\n    Find = 'Find';\r\n    Finish = 'Finish';\r\n    Help = 'Help';\r\n    Pause = 'Pause';\r\n    Play = 'Play';\r\n    Props = 'Props';\r\n    Select = 'Select';\r\n    ZoomIn = 'ZoomIn';\r\n    ZoomOut = 'ZoomOut';\r\n    BrightnessDown = 'BrightnessDown';\r\n    BrightnessUp = 'BrightnessUp';\r\n    Eject = 'Eject';\r\n    LogOff = 'LogOff';\r\n    Power = 'Power';\r\n    PowerOff = 'PowerOff';\r\n    PrintScreen = 'PrintScreen';\r\n    Hibernate = 'Hibernate';\r\n    Standby = 'Standby';\r\n    WakeUp = 'WakeUp';\r\n    AllCandidates = 'AllCandidates';\r\n    Alphanumeric =  'Alphanumeric';\r\n    CodeInput = 'CodeInput';\r\n    Compose = 'Compose';\r\n    Convert = 'Convert';\r\n    Dead = 'Dead';\r\n    FinalMode = 'FinalMode';\r\n    GroupFirst = 'GroupFirst';\r\n    GroupLast = 'GroupLast';\r\n    GroupNext = 'GroupNext';\r\n    GroupPrevious = 'GroupPrevious';\r\n    ModelChange = 'ModelChange';\r\n    NextCandidate = 'NextCandidate';\r\n    NonConvert = 'NonConvert';\r\n    PreviousCandidate = 'PreviousCandidate';\r\n    Process = 'Process';\r\n    SingleCandidate = 'SingleCandidate';\r\n    HangulMode = 'HangulMode';\r\n    HanjaMode = 'HanjaMode';\r\n    JunjaMode = 'JunjaMode';\r\n    Eisu = 'Eisu';\r\n    Hankaku = 'Hankaku';\r\n    Hiranga = 'Hiranga';\r\n    HirangaKatakana = 'HirangaKatakana';\r\n    KanaMode = 'KanaMode';\r\n    Katakana = 'Katakana';\r\n    Romaji = 'Romaji';\r\n    Zenkaku = 'Zenkaku';\r\n    ZenkakuHanaku = 'ZenkakuHanaku';\r\n    F1 = 'F1';\r\n    F2 = 'F2';\r\n    F3 = 'F3';\r\n    F4 = 'F4';\r\n    F5 = 'F5';\r\n    F6 = 'F6';\r\n    F7 = 'F7';\r\n    F8 = 'F8';\r\n    F9 = 'F9';\r\n    F10 = 'F10';\r\n    F11 = 'F11';\r\n    F12 = 'F12';\r\n    F13 = 'F13';\r\n    F14 = 'F14';\r\n    F15 = 'F15';\r\n    F16 = 'F16';\r\n    F17 = 'F17';\r\n    F18 = 'F18';\r\n    F19 = 'F19';\r\n    F20 = 'F20';\r\n    Soft1 = 'Soft1';\r\n    Soft2 = 'Soft2';\r\n    Soft3 = 'Soft3';\r\n    Soft4 = 'Soft4';\r\n    Decimal = 'Decimal';\r\n    Key11 = 'Key11';\r\n    Key12 = 'Key12';\r\n    Multiply = 'Multiply';\r\n    Add = 'Add';\r\n    NumClear = 'Clear';\r\n    Divide = 'Divide';\r\n    Subtract = 'Subtract';\r\n    Separator = 'Separator';\r\n    AppSwitch = 'AppSwitch';\r\n    Call = 'Call';\r\n    Camera = 'Camera';\r\n    CameraFocus = 'CameraFocus';\r\n    EndCall = 'EndCall';\r\n    GoBack = 'GoBack';\r\n    GoHome = 'GoHome';\r\n    HeadsetHook = 'HeadsetHook';\r\n    LastNumberRedial = 'LastNumberRedial';\r\n    Notification = 'Notification';\r\n    MannerMode = 'MannerMode';\r\n    VoiceDial = 'VoiceDial';\r\n    // TODO : Multimedia keys\r\n    // TODO : Audio control keys\r\n    // TODO : TV control keys\r\n    // TODO : Media controller keys\r\n    // TODO : Speech recognition keys\r\n    // TODO : Document keys\r\n    // TODO : Application selector keys\r\n    // TODO : Browser Control keys\r\n  end;\r\n\r\n\r\n  { TJSKeyboardEvent }\r\n\r\n  TJSKeyboardEvent = class external name 'KeyboardEvent' (TJSUIEvent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FCode: string; external name 'code';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FIsComposing: Boolean;  external name 'isComposing';\r\n    FKey: String; external name 'key';\r\n    FLocale: string; external name 'locale';\r\n    FLocation: NativeInt; external name 'location';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FRepeat: Boolean; external name 'repeat';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n  Public\r\n    function getModifierState(aKey : string) : Boolean;\r\n    property code : string read FCode;\r\n    Property altKey : Boolean read FAltKey;\r\n    property ctrlKey : Boolean read FCtrlKey;\r\n    property isComposing : Boolean read FIsComposing;\r\n    property Key : String read FKey;\r\n    property locale : string read FLocale;\r\n    property location : NativeInt read FLocation;\r\n    property metaKey : Boolean read FMetaKey;\r\n    property _repeat : Boolean read FRepeat;\r\n    property shiftKey : Boolean read FShiftKey;\r\n  end;\r\n\r\n  { MutationObserver }\r\n\r\n  TJSMutationObserver = Class;\r\n\r\n  TJSMutationRecord = record\r\n    type_ : string;\r\n    target : TJSNode;\r\n    addedNodes : TJSNodeList;\r\n    removedNodes : TJSNodeList;\r\n    previousSibling : TJSNode;\r\n    nextSibling : TJSNode;\r\n    attributeName : String;\r\n    attributeNamespace : String;\r\n    oldValue : String;\r\n  end;\r\n\r\n  TJSMutationRecordArray = array of TJSMutationRecord;\r\n  TJSMutationCallback = reference to procedure(mutations: TJSMutationRecordArray; observer: TJSMutationObserver);\r\n\r\n  TJSMutationObserverInit = record\r\n    attributes: boolean;\r\n    attributeOldValue: boolean;\r\n    characterData: boolean;\r\n    characterDataOldValue: boolean;\r\n    childList: boolean;\r\n    subTree: boolean;\r\n    attributeFilter: TJSArray;\r\n  end;\r\n\r\n  TJSMutationObserver = class external name 'MutationObserver' (TJSObject)\r\n  public\r\n    { constructor }\r\n    constructor new(mutationCallback: TJSMutationCallback); overload;\r\n    { public methods }\r\n    procedure observe(target: TJSNode); overload;\r\n    procedure observe(target: TJSNode; options: TJSMutationObserverInit); overload;\r\n    procedure observe(target: TJSNode; options: TJSObject); overload;\r\n    procedure disconnect;\r\n    function takeRecords: TJSMutationRecordArray;\r\n  end;\r\n\r\n  { --------------------------------------------------------------------\r\n    TJSWebSocket\r\n    --------------------------------------------------------------------}\r\n\r\n  TJSMessagePortArray = Array of TJSMessagePort;\r\n\r\n  { TJSMessageEvent }\r\n\r\n  TJSMessageEvent = class external name 'MessageEvent' (TEventListenerEvent)\r\n  private\r\n    FData: TJSObject; external name 'data';\r\n    FLastEventID: String; external name 'lastEventID';\r\n    FOrigin: String;  external name 'origin';\r\n    FPorts: TJSMessagePortArray; external name 'ports';\r\n  Public\r\n    Property Data : TJSObject Read FData;\r\n    Property LastEventID : String Read FLastEventID;\r\n    Property Origin : String Read FOrigin;\r\n    Property Ports : TJSMessagePortArray Read FPorts;\r\n  end;\r\n\r\n  TJSWebSocket = class external name 'WebSocket'  (TJSEventTarget)\r\n  Private\r\n    Furl : String; external name 'url';\r\n    FreadyState : Cardinal; external name 'readyState';\r\n    FbufferedAmount : NativeInt; external name 'bufferedAmount';\r\n    Fextensions : String; external name 'extensions';\r\n    Fprotocol : String; external name 'protocol';\r\n  Public\r\n    Const\r\n      CONNECTING = 0;\r\n      OPEN = 1;\r\n      CLOSING = 2;\r\n      CLOSED = 3;\r\n  Public\r\n    onopen : TJSEventHandler;\r\n    onerror : TJSEventHandler;\r\n    onclose : TJSEventHandler;\r\n    onmessage : TJSEventHandler;\r\n    binaryType : String;\r\n    constructor new(url : String); overload;\r\n    constructor new(url : String; protocol: String); overload;\r\n    constructor new(url : String; protocols: array of String); overload;\r\n    Procedure close; overload;\r\n    Procedure close(code : Cardinal); overload;\r\n    Procedure close(code : Cardinal; reason : String); overload;\r\n    Procedure send(data : String);\r\n    Procedure send(data : TJSBlob);\r\n    Procedure send(data : TJSArrayBuffer);\r\n    Procedure send(data : TJSTypedArray);\r\n    Property url : String Read Furl;\r\n    Property readyState : Cardinal Read FreadyState;\r\n    Property bufferedAmount : NativeInt Read FbufferedAmount;\r\n    Property extensions : String Read Fextensions;\r\n    Property protocol : String Read Fprotocol;\r\n  end;\r\n\r\n  TJSHTMLAudioTrack = class external name 'AudioTrack' (TJSObject)\r\n  end;\r\n\r\n  TJSHTMLAudioTrackList = class external name 'AudioTrackList' (TJSObject)\r\n  private\r\n    FLength : Integer; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSHTMLAudioTrack ; external name '[]';\r\n  public\r\n    onaddtrack : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onremovetrack : TJSEventHandler;\r\n    Property Length : Integer Read FLength;\r\n    Property tracks [aIndex : NativeInt] : TJSHTMLAudioTrack read Getitem;\r\n  end;\r\n\r\n  TJSHTMLVideoTrack = class external name 'VideoTrack' (TJSObject)\r\n  end;\r\n\r\n  TJSHTMLVideoTrackList = class external name 'VideoTrackList' (TJSObject)\r\n  private\r\n    FLength : Integer; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSHTMLVideoTrack ; external name '[]';\r\n  public\r\n    onaddtrack : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onremovetrack : TJSEventHandler;\r\n    Property Length : Integer Read FLength;\r\n    Property tracks [aIndex : NativeInt] : TJSHTMLVideoTrack read Getitem;\r\n  end;\r\n\r\n  TJSHTMLTextTrack = class external name 'TextTrack' (TJSObject)\r\n  end;\r\n\r\n  TJSHTMLTextTrackList = class external name 'TextTrackList' (TJSObject)\r\n  private\r\n    FLength : Integer; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSHTMLTextTrack ; external name '[]';\r\n  public\r\n    onaddtrack : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onremovetrack : TJSEventHandler;\r\n    Property Length : Integer Read FLength;\r\n    Property tracks [aIndex : NativeInt] : TJSHTMLTextTrack read Getitem;\r\n  end;\r\n\r\n\r\n  { TJSHTMLMediaElement }\r\n  TJSMEdiaError = class external name 'MediaError' (TJSObject)\r\n  public\r\n    code : NativeInt;\r\n    message : string;\r\n  end;\r\n\r\n  TJSHTMLMediaStream = class external name 'MediaStream' (TJSObject);\r\n\r\n  TJSHTMLMediaController = class external name 'MediaController' (TJSObject);\r\n\r\n  TJSHTMLMediaElement = Class external name 'HTMLMediaElement' (TJSHTMLElement)\r\n  private\r\n    FAudioTracks: TJSHTMLAudioTrackList; external name 'audioTracks';\r\n    FVideoTracks: TJSHTMLVideoTrackList; external name 'videoTracks';\r\n    FTextTracks: TJSHTMLTextTrackList; external name 'textTracks';\r\n    FControlsList: TJSDOMTokenList; external name 'controlslist';\r\n    FCurrentSrc: String; external name 'currentSrc';\r\n    FDuration: Double; external name 'duration';\r\n    FEnded: Boolean;external name 'ended';\r\n    FError: TJSMEdiaError; external name 'error';\r\n    FNetworkState: NativeInt; external name 'networkState';\r\n    FPaused: boolean; external name 'paused';\r\n    FReadyState: NativeInt; external name 'readyState';\r\n    FSeeking: boolean; external name 'seeking';\r\n    FSinkID: string; external name 'sinkId';\r\n  Public\r\n    autoplay : Boolean;\r\n    buffered : Boolean;\r\n    controls : Boolean;\r\n    controller : TJSHTMLMediaController;\r\n    crossOrigin : String;\r\n    currentTime : Double;\r\n    defaultMuted : boolean;\r\n    defaultPlaybackRate : Double;\r\n    disableRemotePlayback : Boolean;\r\n    loop : boolean;\r\n    mediaGroup : string;\r\n    muted : boolean;\r\n    preload : string;\r\n    preservesPitch : boolean;\r\n    src : string;\r\n    srcObject : TJSHTMLMediaStream;\r\n    volume : double;\r\n    onencrypted : TJSEventHandler;\r\n    onwaitingforkey : TJSEventHandler;\r\n    function canPlayType(aType : String) : String;\r\n    Function captureStream : TJSHTMLMediaStream;\r\n    Procedure play;\r\n    Procedure load;\r\n    Procedure pause;\r\n\r\n    Property AudioTracks : TJSHTMLAudioTrackList Read FAudioTracks;\r\n    Property Controlslist : TJSDOMTokenList Read FControlsList;\r\n    Property CurrentSrc : String Read FCurrentSrc;\r\n    Property Duration : Double read FDuration;\r\n    Property Ended : Boolean read FEnded;\r\n    Property Error : TJSMEdiaError read FError;\r\n    property networkState : NativeInt read FNetworkState;\r\n    property paused : boolean read FPaused;\r\n    property readyState : NativeInt read FReadyState;\r\n    property seeking : boolean read FSeeking;\r\n    property sinkID : string read FSinkID;\r\n    Property TextTracks : TJSHTMLTextTrackList Read FTextTracks;\r\n    Property VideoTracks : TJSHTMLVideoTrackList Read FVideoTracks;\r\n  end;\r\n\r\n  TJSHTMLAudioElement = Class external name 'HTMLAudioElement' (TJSHTMLMediaElement)\r\n  end;\r\n\r\n  TJSFormDataEntryValue = String;\r\n  TJSFormDataEntryValueArray = Array of TJSFormDataEntryValue;\r\n\r\n  TJSFormData = Class external name 'FormData' (TJSObject)\r\n    constructor new;\r\n    constructor new(aForm : TJSHTMLElement);\r\n    Procedure append(const aName,aValue : String);\r\n    Procedure append(const aName : String; aBlob : TJSBlob);\r\n    Procedure delete(const aName : String);\r\n    Function entries : TJSFormDataEntryValueArray;\r\n    Function get(const aName : String): TJSFormDataEntryValue;\r\n    function has(const aName : String): Boolean;\r\n    Function keys : TStringDynArray; reintroduce;\r\n    Procedure set_(const aName,aValue : String); external name 'set';\r\n    Procedure set_(const aName : String; aBlob : TJSBlob); external name 'set';\r\n    Function getAll(const aName : String) : TJSFormDataEntryValueArray;\r\n    Function values : TJSValueDynArray; \r\n    Property Entry[aIndex : String] : TJSFormDataEntryValue read Get;\r\n  end;\r\n\r\nvar\r\n  document : TJSDocument; external name 'document';\r\n  window : TJSWindow; external name 'window';\r\n  console : TJSConsole; external name 'window.console';\r\n  \r\nimplementation\r\n    \r\nend.\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit Classes;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nuses\r\n  RTLConsts, Types, SysUtils, JS, TypInfo, Web;\r\n\r\ntype\r\n  TNotifyEvent = procedure(Sender: TObject) of object;\r\n\r\n  // Notification operations :\r\n  // Observer has changed, is freed, item added to/deleted from list, custom event.\r\n  TFPObservedOperation = (ooChange,ooFree,ooAddItem,ooDeleteItem,ooCustom);\r\n\r\n  EStreamError = class(Exception);\r\n  EFCreateError = class(EStreamError);\r\n  EFOpenError = class(EStreamError);\r\n  EFilerError = class(EStreamError);\r\n  EReadError = class(EFilerError);\r\n  EWriteError = class(EFilerError);\r\n  EClassNotFound = class(EFilerError);\r\n  EMethodNotFound = class(EFilerError);\r\n  EInvalidImage = class(EFilerError);\r\n  EResNotFound = class(Exception);\r\n  EListError = class(Exception);\r\n  EBitsError = class(Exception);\r\n  EStringListError = class(EListError);\r\n  EComponentError = class(Exception);\r\n  EParserError = class(Exception);\r\n  EOutOfResources = class(EOutOfMemory);\r\n  EInvalidOperation = class(Exception);\r\n\r\n  TListAssignOp = (laCopy, laAnd, laOr, laXor, laSrcUnique, laDestUnique);\r\n  TListSortCompare = function(Item1, Item2: JSValue): Integer;\r\n  TListCallback = Types.TListCallback;\r\n  TListStaticCallback = Types.TListStaticCallback;\r\n  TAlignment = (taLeftJustify, taRightJustify, taCenter);\r\n\r\n  // Forward class definitions\r\n  TFPList = Class;\r\n\r\n  { TFPListEnumerator }\r\n  TFPListEnumerator = class\r\n  private\r\n    FList: TFPList;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AList: TFPList); reintroduce;\r\n    function GetCurrent: JSValue;\r\n    function MoveNext: Boolean;\r\n    property Current: JSValue read GetCurrent;\r\n  end;\r\n\r\n  { TFPList }\r\n\r\n  TFPList = class(TObject)\r\n  private\r\n    FList: TJSValueDynArray;\r\n    FCount: Integer;\r\n    FCapacity: Integer;\r\n    procedure CopyMove(aList: TFPList);\r\n    procedure MergeMove(aList: TFPList);\r\n    procedure DoCopy(ListA, ListB: TFPList);\r\n    procedure DoSrcUnique(ListA, ListB: TFPList);\r\n    procedure DoAnd(ListA, ListB: TFPList);\r\n    procedure DoDestUnique(ListA, ListB: TFPList);\r\n    procedure DoOr(ListA, ListB: TFPList);\r\n    procedure DoXOr(ListA, ListB: TFPList);\r\n  protected\r\n    function Get(Index: Integer): JSValue; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure Put(Index: Integer; Item: JSValue); {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure SetCapacity(NewCapacity: Integer);\r\n    procedure SetCount(NewCount: Integer);\r\n    Procedure RaiseIndexError(Index: Integer);\r\n  public\r\n    //Type\r\n    //  TDirection = (FromBeginning, FromEnd);\r\n    destructor Destroy; override;\r\n    procedure AddList(AList: TFPList);\r\n    function Add(Item: JSValue): Integer; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure Clear;\r\n    procedure Delete(Index: Integer); {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    class procedure Error(const Msg: string; const Data: String);\r\n    procedure Exchange(Index1, Index2: Integer);\r\n    function Expand: TFPList; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function Extract(Item: JSValue): JSValue;\r\n    function First: JSValue;\r\n    function GetEnumerator: TFPListEnumerator;\r\n    function IndexOf(Item: JSValue): Integer;\r\n    function IndexOfItem(Item: JSValue; Direction: TDirection): Integer;\r\n    procedure Insert(Index: Integer; Item: JSValue); {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function Last: JSValue;\r\n    procedure Move(CurIndex, NewIndex: Integer);\r\n    procedure Assign (ListA: TFPList; AOperator: TListAssignOp=laCopy; ListB: TFPList=nil);\r\n    function Remove(Item: JSValue): Integer;\r\n    procedure Pack;\r\n    procedure Sort(const Compare: TListSortCompare);\r\n    procedure ForEachCall(const proc2call: TListCallback; const arg: JSValue);\r\n    procedure ForEachCall(const proc2call: TListStaticCallback; const arg: JSValue);\r\n    property Capacity: Integer read FCapacity write SetCapacity;\r\n    property Count: Integer read FCount write SetCount;\r\n    property Items[Index: Integer]: JSValue read Get write Put; default;\r\n    property List: TJSValueDynArray read FList;\r\n  end;\r\n\r\n  TListNotification = (lnAdded, lnExtracted, lnDeleted);\r\n  TList = class;\r\n\r\n  { TListEnumerator }\r\n\r\n  TListEnumerator = class\r\n  private\r\n    FList: TList;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AList: TList); reintroduce;\r\n    function GetCurrent: JSValue;\r\n    function MoveNext: Boolean;\r\n    property Current: JSValue read GetCurrent;\r\n  end;\r\n\r\n  { TList }\r\n\r\n  TList = class(TObject)\r\n  private\r\n    FList: TFPList;\r\n    procedure CopyMove (aList : TList);\r\n    procedure MergeMove (aList : TList);\r\n    procedure DoCopy(ListA, ListB : TList);\r\n    procedure DoSrcUnique(ListA, ListB : TList);\r\n    procedure DoAnd(ListA, ListB : TList);\r\n    procedure DoDestUnique(ListA, ListB : TList);\r\n    procedure DoOr(ListA, ListB : TList);\r\n    procedure DoXOr(ListA, ListB : TList);\r\n  protected\r\n    function Get(Index: Integer): JSValue;\r\n    procedure Put(Index: Integer; Item: JSValue);\r\n    procedure Notify(aValue: JSValue; Action: TListNotification); virtual;\r\n    procedure SetCapacity(NewCapacity: Integer);\r\n    function GetCapacity: integer;\r\n    procedure SetCount(NewCount: Integer);\r\n    function GetCount: integer;\r\n    function GetList: TJSValueDynArray;\r\n    property FPList : TFPList Read FList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    Procedure AddList(AList : TList);\r\n    function Add(Item: JSValue): Integer;\r\n    procedure Clear; virtual;\r\n    procedure Delete(Index: Integer);\r\n    class procedure Error(const Msg: string; Data: String); virtual;\r\n    procedure Exchange(Index1, Index2: Integer);\r\n    function Expand: TList;\r\n    function Extract(Item: JSValue): JSValue;\r\n    function First: JSValue;\r\n    function GetEnumerator: TListEnumerator;\r\n    function IndexOf(Item: JSValue): Integer;\r\n    procedure Insert(Index: Integer; Item: JSValue);\r\n    function Last: JSValue;\r\n    procedure Move(CurIndex, NewIndex: Integer);\r\n    procedure Assign (ListA: TList; AOperator: TListAssignOp=laCopy; ListB: TList=nil);\r\n    function Remove(Item: JSValue): Integer;\r\n    procedure Pack;\r\n    procedure Sort(const Compare: TListSortCompare);\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property Count: Integer read GetCount write SetCount;\r\n    property Items[Index: Integer]: JSValue read Get write Put; default;\r\n    property List: TJSValueDynArray read GetList;\r\n  end;\r\n\r\n  { TPersistent }\r\n\r\n{$M+}\r\n  TPersistent = class(TObject)\r\n  private\r\n    //FObservers : TFPList;\r\n    procedure AssignError(Source: TPersistent);\r\n  protected\r\n    procedure AssignTo(Dest: TPersistent); virtual;\r\n    function GetOwner: TPersistent; virtual;\r\n  public\r\n    procedure Assign(Source: TPersistent); virtual;\r\n    //procedure FPOAttachObserver(AObserver : TObject);\r\n    //procedure FPODetachObserver(AObserver : TObject);\r\n    //procedure FPONotifyObservers(ASender : TObject; AOperation: TFPObservedOperation; Data: TObject);\r\n    function GetNamePath: string; virtual;\r\n  end;\r\n{$M-}\r\n  TPersistentClass = Class of TPersistent;\r\n\r\n  { TInterfacedPersistent }\r\n\r\n  TInterfacedPersistent = class(TPersistent, IInterface)\r\n  private\r\n    FOwnerInterface: IInterface;\r\n  protected\r\n    function _AddRef: Integer;\r\n    function _Release: Integer;\r\n  public\r\n    function QueryInterface(const IID: TGUID; out Obj): integer; virtual;\r\n    procedure AfterConstruction; override;\r\n  end;\r\n\r\n\r\n  TStrings = Class;\r\n  { TStringsEnumerator class }\r\n\r\n  TStringsEnumerator = class\r\n  private\r\n    FStrings: TStrings;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AStrings: TStrings); reintroduce;\r\n    function GetCurrent: String;\r\n    function MoveNext: Boolean;\r\n    property Current: String read GetCurrent;\r\n  end;\r\n\r\n\r\n  { TStrings class }\r\n  TStrings = class(TPersistent)\r\n  private\r\n    FReq: TJSXMLHTTPRequest;\r\n    FSpecialCharsInited : boolean;\r\n    FAlwaysQuote: Boolean;\r\n    FQuoteChar : Char;\r\n    FDelimiter : Char;\r\n    FNameValueSeparator : Char;\r\n    FUpdateCount: Integer;\r\n    FLBS : TTextLineBreakStyle;\r\n    FSkipLastLineBreak : Boolean;\r\n    FStrictDelimiter : Boolean;\r\n    FLineBreak : String;\r\n    function GetCommaText: string;\r\n    function GetName(Index: Integer): string;\r\n    function GetValue(const Name: string): string;\r\n    Function GetLBS : TTextLineBreakStyle;\r\n    Procedure SetLBS (AValue : TTextLineBreakStyle);\r\n    procedure SetCommaText(const Value: string);\r\n    procedure SetValue(const Name, Value: string);\r\n    procedure SetDelimiter(c:Char);\r\n    procedure SetQuoteChar(c:Char);\r\n    procedure SetNameValueSeparator(c:Char);\r\n    procedure DoSetTextStr(const Value: string; DoClear : Boolean);\r\n    Function GetDelimiter : Char;\r\n    Function GetNameValueSeparator : Char;\r\n    Function GetQuoteChar: Char;\r\n    Function GetLineBreak : String;\r\n    procedure SetLineBreak(const S : String);\r\n    Function GetSkipLastLineBreak : Boolean;\r\n    procedure SetSkipLastLineBreak(const AValue : Boolean);\r\n  protected\r\n    function onLoad(Event: TEventListenerEvent): boolean;\r\n    procedure Error(const Msg: string; Data: Integer);\r\n    function Get(Index: Integer): string; virtual; abstract;\r\n    function GetCapacity: Integer; virtual;\r\n    function GetCount: Integer; virtual; abstract;\r\n    function GetObject(Index: Integer): TObject; virtual;\r\n    function GetTextStr: string; virtual;\r\n    procedure Put(Index: Integer; const S: string); virtual;\r\n    procedure PutObject(Index: Integer; AObject: TObject); virtual;\r\n    procedure SetCapacity(NewCapacity: Integer); virtual;\r\n    procedure SetTextStr(const Value: string); virtual;\r\n    procedure SetUpdateState(Updating: Boolean); virtual;\r\n    property UpdateCount: Integer read FUpdateCount;\r\n    Function DoCompareText(const s1,s2 : string) : PtrInt; virtual;\r\n    Function GetDelimitedText: string;\r\n    Procedure SetDelimitedText(Const AValue: string);\r\n    Function GetValueFromIndex(Index: Integer): string;\r\n    Procedure SetValueFromIndex(Index: Integer; const Value: string);\r\n    Procedure CheckSpecialChars;\r\n//    Class Function GetNextLine (Const Value : String; Var S : String; Var P : Integer) : Boolean;\r\n    Function GetNextLinebreak (Const Value : String; Out S : String; Var P : Integer) : Boolean;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    function Add(const S: string): Integer; virtual; overload;\r\n//    function AddFmt(const Fmt : string; const Args : Array of const): Integer; overload;\r\n    function AddObject(const S: string; AObject: TObject): Integer; virtual; overload;\r\n//    function AddObject(const Fmt: string; Args : Array of const; AObject: TObject): Integer; overload;\r\n    procedure Append(const S: string);\r\n    procedure AddStrings(TheStrings: TStrings); overload; virtual;\r\n    procedure AddStrings(TheStrings: TStrings; ClearFirst : Boolean); overload;\r\n    procedure AddStrings(const TheStrings: array of string); overload; virtual;\r\n    procedure AddStrings(const TheStrings: array of string; ClearFirst : Boolean); overload;\r\n    function AddPair(const AName, AValue: string): TStrings; overload;\r\n    function AddPair(const AName, AValue: string; AObject: TObject): TStrings; overload;\r\n    Procedure AddText(Const S : String); virtual;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate;\r\n    procedure Clear; virtual; abstract;\r\n    procedure Delete(Index: Integer); virtual; abstract;\r\n    procedure EndUpdate;\r\n    function Equals(Obj: TObject): Boolean; override; overload;\r\n    function Equals(TheStrings: TStrings): Boolean; overload;\r\n    procedure Exchange(Index1, Index2: Integer); virtual;\r\n    function GetEnumerator: TStringsEnumerator;\r\n    function IndexOf(const S: string): Integer; virtual;\r\n    function IndexOfName(const Name: string): Integer; virtual;\r\n    function IndexOfObject(AObject: TObject): Integer; virtual;\r\n    procedure Insert(Index: Integer; const S: string); virtual; abstract;\r\n    procedure InsertObject(Index: Integer; const S: string; AObject: TObject);\r\n    procedure LoadFromFile(const FileName: string); overload; virtual;\r\n    procedure LoadFromFileAsync(const FileName: string); overload; virtual;\r\n    procedure SaveToFile(const FileName: string); overload; virtual;\r\n    procedure Move(CurIndex, NewIndex: Integer); virtual;\r\n    procedure GetNameValue(Index : Integer; Out AName,AValue : String);\r\n    function  ExtractName(Const S:String):String;\r\n    Property TextLineBreakStyle : TTextLineBreakStyle Read GetLBS Write SetLBS;\r\n    property Delimiter: Char read GetDelimiter write SetDelimiter;\r\n    property DelimitedText: string read GetDelimitedText write SetDelimitedText;\r\n    property LineBreak : string Read GetLineBreak write SetLineBreak;\r\n    Property StrictDelimiter : Boolean Read FStrictDelimiter Write FStrictDelimiter;\r\n    property AlwaysQuote: Boolean read FAlwaysQuote write FAlwaysQuote;\r\n    property QuoteChar: Char read GetQuoteChar write SetQuoteChar;\r\n    Property NameValueSeparator : Char Read GetNameValueSeparator Write SetNameValueSeparator;\r\n    property ValueFromIndex[Index: Integer]: string read GetValueFromIndex write SetValueFromIndex;\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property CommaText: string read GetCommaText write SetCommaText;\r\n    property Count: Integer read GetCount;\r\n    property Names[Index: Integer]: string read GetName;\r\n    property Objects[Index: Integer]: TObject read GetObject write PutObject;\r\n    property Values[const Name: string]: string read GetValue write SetValue;\r\n    property Strings[Index: Integer]: string read Get write Put; default;\r\n    property Text: string read GetTextStr write SetTextStr;\r\n    Property SkipLastLineBreak : Boolean Read GetSkipLastLineBreak Write SetSkipLastLineBreak;\r\n  end;\r\n\r\n  { TStringList}\r\n  TStringItem = record\r\n     FString: string;\r\n     FObject: TObject;\r\n   end;\r\n\r\n  TStringItemArray = Array of TStringItem;\r\n\r\n  TStringList = class;\r\n  TStringListSortCompare = function(List: TStringList; Index1, Index2: Integer): Integer;\r\n\r\n  TStringsSortStyle = (sslNone,sslUser,sslAuto);\r\n  TStringsSortStyles = Set of TStringsSortStyle;\r\n\r\n  TStringList = class(TStrings)\r\n  private\r\n    FList: TStringItemArray;\r\n    FCount: Integer;\r\n    FOnChange: TNotifyEvent;\r\n    FOnChanging: TNotifyEvent;\r\n    FDuplicates: TDuplicates;\r\n    FCaseSensitive : Boolean;\r\n    FForceSort : Boolean;\r\n    FOwnsObjects : Boolean;\r\n    FSortStyle: TStringsSortStyle;\r\n    procedure ExchangeItemsInt(Index1, Index2: Integer);\r\n    function GetSorted: Boolean;\r\n    procedure Grow;\r\n    procedure InternalClear(FromIndex : Integer = 0; ClearOnly : Boolean = False);\r\n    procedure QuickSort(L, R: Integer; CompareFn: TStringListSortCompare);\r\n    procedure SetSorted(Value: Boolean);\r\n    procedure SetCaseSensitive(b : boolean);\r\n    procedure SetSortStyle(AValue: TStringsSortStyle);\r\n  protected\r\n    Procedure CheckIndex(AIndex : Integer);\r\n    procedure ExchangeItems(Index1, Index2: Integer); virtual;\r\n    procedure Changed; virtual;\r\n    procedure Changing; virtual;\r\n    function Get(Index: Integer): string; override;\r\n    function GetCapacity: Integer; override;\r\n    function GetCount: Integer; override;\r\n    function GetObject(Index: Integer): TObject; override;\r\n    procedure Put(Index: Integer; const S: string); override;\r\n    procedure PutObject(Index: Integer; AObject: TObject); override;\r\n    procedure SetCapacity(NewCapacity: Integer); override;\r\n    procedure SetUpdateState(Updating: Boolean); override;\r\n    procedure InsertItem(Index: Integer; const S: string); virtual;\r\n    procedure InsertItem(Index: Integer; const S: string; O: TObject); virtual;\r\n    Function DoCompareText(const s1,s2 : string) : PtrInt; override;\r\n    function CompareStrings(const s1,s2 : string) : Integer; virtual;\r\n  public\r\n    destructor Destroy; override;\r\n    function Add(const S: string): Integer; override;\r\n    procedure Clear; override;\r\n    procedure Delete(Index: Integer); override;\r\n    procedure Exchange(Index1, Index2: Integer); override;\r\n    function Find(const S: string; Out Index: Integer): Boolean; virtual;\r\n    function IndexOf(const S: string): Integer; override;\r\n    procedure Insert(Index: Integer; const S: string); override;\r\n    procedure Sort; virtual;\r\n    procedure CustomSort(CompareFn: TStringListSortCompare); virtual;\r\n    property Duplicates: TDuplicates read FDuplicates write FDuplicates;\r\n    property Sorted: Boolean read GetSorted write SetSorted;\r\n    property CaseSensitive: Boolean read FCaseSensitive write SetCaseSensitive;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnChanging: TNotifyEvent read FOnChanging write FOnChanging;\r\n    property OwnsObjects : boolean read FOwnsObjects write FOwnsObjects;\r\n    Property SortStyle : TStringsSortStyle Read FSortStyle Write SetSortStyle;\r\n  end;\r\n\r\n  TCollection = class;\r\n\r\n  { TCollectionItem }\r\n\r\n  TCollectionItem = class(TPersistent)\r\n  private\r\n    FCollection: TCollection;\r\n    FID: Integer;\r\n    FUpdateCount: Integer;\r\n    function GetIndex: Integer;\r\n  protected\r\n    procedure SetCollection(Value: TCollection);virtual;\r\n    procedure Changed(AllItems: Boolean);\r\n    function GetOwner: TPersistent; override;\r\n    function GetDisplayName: string; virtual;\r\n    procedure SetIndex(Value: Integer); virtual;\r\n    procedure SetDisplayName(const Value: string); virtual;\r\n    property UpdateCount: Integer read FUpdateCount;\r\n  public\r\n    constructor Create(ACollection: TCollection); virtual; reintroduce;\r\n    destructor Destroy; override;\r\n    function GetNamePath: string; override;\r\n    property Collection: TCollection read FCollection write SetCollection;\r\n    property ID: Integer read FID;\r\n    property Index: Integer read GetIndex write SetIndex;\r\n    property DisplayName: string read GetDisplayName write SetDisplayName;\r\n  end;\r\n\r\n  TCollectionEnumerator = class\r\n  private\r\n    FCollection: TCollection;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(ACollection: TCollection); reintroduce;\r\n    function GetCurrent: TCollectionItem;\r\n    function MoveNext: Boolean;\r\n    property Current: TCollectionItem read GetCurrent;\r\n  end;\r\n\r\n  TCollectionItemClass = class of TCollectionItem;\r\n  TCollectionNotification = (cnAdded, cnExtracting, cnDeleting);\r\n  TCollectionSortCompare = function (Item1, Item2: TCollectionItem): Integer;\r\n\r\n  TCollection = class(TPersistent)\r\n  private\r\n    FItemClass: TCollectionItemClass;\r\n    FItems: TFpList;\r\n    FUpdateCount: Integer;\r\n    FNextID: Integer;\r\n    FPropName: string;\r\n    function GetCount: Integer;\r\n    function GetPropName: string;\r\n    procedure InsertItem(Item: TCollectionItem);\r\n    procedure RemoveItem(Item: TCollectionItem);\r\n    procedure DoClear;\r\n  protected\r\n    { Design-time editor support }\r\n    function GetAttrCount: Integer; virtual;\r\n    function GetAttr(Index: Integer): string; virtual;\r\n    function GetItemAttr(Index, ItemIndex: Integer): string; virtual;\r\n    procedure Changed;\r\n    function GetItem(Index: Integer): TCollectionItem;\r\n    procedure SetItem(Index: Integer; Value: TCollectionItem);\r\n    procedure SetItemName(Item: TCollectionItem); virtual;\r\n    procedure SetPropName; virtual;\r\n    procedure Update(Item: TCollectionItem); virtual;\r\n    procedure Notify(Item: TCollectionItem;Action: TCollectionNotification); virtual;\r\n    property PropName: string read GetPropName write FPropName;\r\n    property UpdateCount: Integer read FUpdateCount;\r\n    property FPList : TFPList Read FItems;\r\n  public\r\n    constructor Create(AItemClass: TCollectionItemClass); reintroduce;\r\n    destructor Destroy; override;\r\n    function Owner: TPersistent;\r\n    function Add: TCollectionItem;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate; virtual;\r\n    procedure Clear;\r\n    procedure EndUpdate; virtual;\r\n    procedure Delete(Index: Integer);\r\n    function GetEnumerator: TCollectionEnumerator;\r\n    function GetNamePath: string; override;\r\n    function Insert(Index: Integer): TCollectionItem;\r\n    function FindItemID(ID: Integer): TCollectionItem;\r\n    procedure Exchange(Const Index1, index2: integer);\r\n    procedure Sort(Const Compare : TCollectionSortCompare);\r\n    property Count: Integer read GetCount;\r\n    property ItemClass: TCollectionItemClass read FItemClass;\r\n    property Items[Index: Integer]: TCollectionItem read GetItem write SetItem;\r\n  end;\r\n\r\n  TOwnedCollection = class(TCollection)\r\n  private\r\n    FOwner: TPersistent;\r\n  protected\r\n    Function GetOwner: TPersistent; override;\r\n  public\r\n    Constructor Create(AOwner: TPersistent; AItemClass: TCollectionItemClass); reintroduce;\r\n  end;\r\n\r\n  TComponent = Class;\r\n\r\n  TOperation = (opInsert, opRemove);\r\n\r\n  TComponentStateItem = ( csLoading, csReading, csWriting,  csDestroying,\r\n    csDesigning, csAncestor, csUpdating, csFixups, csFreeNotification,\r\n    csInline, csDesignInstance);\r\n  TComponentState = set of TComponentStateItem;\r\n  TComponentStyleItem = (csInheritable, csCheckPropAvail, csSubComponent, csTransient);\r\n  TComponentStyle = set of TComponentStyleItem;\r\n\r\n  TGetChildProc = procedure (Child: TComponent) of object;\r\n\r\n  TComponentName = string;\r\n\r\n  { TComponentEnumerator }\r\n\r\n  TComponentEnumerator = class\r\n  private\r\n    FComponent: TComponent;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AComponent: TComponent); reintroduce;\r\n    function GetCurrent: TComponent;\r\n    function MoveNext: Boolean;\r\n    property Current: TComponent read GetCurrent;\r\n  end;\r\n\r\n  TComponent = class(TInterfacedPersistent)\r\n  private\r\n    FOwner: TComponent;\r\n    FName: TComponentName;\r\n    FTag: Ptrint;\r\n    FComponents: TFpList;\r\n    FFreeNotifies: TFpList;\r\n    FDesignInfo: Longint;\r\n    FComponentState: TComponentState;\r\n    function GetComponent(AIndex: Integer): TComponent;\r\n    function GetComponentCount: Integer;\r\n    function GetComponentIndex: Integer;\r\n    procedure Insert(AComponent: TComponent);\r\n    procedure Remove(AComponent: TComponent);\r\n    procedure RemoveNotification(AComponent: TComponent);\r\n    procedure SetComponentIndex(Value: Integer);\r\n  protected\r\n    FComponentStyle: TComponentStyle;\r\n    FLeft: Integer;\r\n    FTop: Integer;\r\n    procedure ChangeName(const NewName: TComponentName);\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); virtual;\r\n    function GetChildOwner: TComponent; virtual;\r\n    function GetChildParent: TComponent; virtual;\r\n    function GetOwner: TPersistent; override;\r\n    function GetLeft: Integer; virtual;\r\n    function GetTop: Integer; virtual;\r\n    procedure Loaded; virtual;\r\n    procedure Loading; virtual;\r\n    procedure Notification(AComponent: TComponent;  Operation: TOperation); virtual;\r\n    procedure PaletteCreated; virtual;\r\n    procedure SetAncestor(Value: Boolean);\r\n    procedure SetDesigning(Value: Boolean; SetChildren : Boolean = True);\r\n    procedure SetDesignInstance(Value: Boolean);\r\n    procedure SetInline(Value: Boolean);\r\n    procedure SetName(const NewName: TComponentName); virtual;\r\n    procedure SetChildOrder(Child: TComponent; Order: Integer); virtual;\r\n    procedure SetLeft(AValue: Integer); virtual;\r\n    procedure SetTop(AValue: Integer); virtual;\r\n    procedure Updating; virtual;\r\n    procedure Updated; virtual;\r\n    procedure ValidateRename(AComponent: TComponent;  const CurName, NewName: string); virtual;\r\n    procedure ValidateContainer(AComponent: TComponent); virtual;\r\n    procedure ValidateInsert(AComponent: TComponent); virtual;\r\n  public\r\n    constructor Create(AOwner: TComponent); virtual; reintroduce;\r\n    destructor Destroy; override;\r\n    procedure BeforeDestruction; override;\r\n    procedure DestroyComponents;\r\n    procedure Destroying;\r\n    procedure AfterLoadDFMValues; virtual;\r\n    procedure BeforeLoadDFMValues; virtual;\r\n    procedure BeginUpdate; virtual;\r\n    procedure EndUpdate; virtual;\r\n//    function ExecuteAction(Action: TBasicAction): Boolean; virtual;\r\n    function FindComponent(const AName: string): TComponent;\r\n    procedure FreeNotification(AComponent: TComponent);\r\n    procedure RemoveFreeNotification(AComponent: TComponent);\r\n    function GetNamePath: string; override;\r\n    function GetParentComponent: TComponent; virtual;\r\n    function HasParent: Boolean; virtual;\r\n    procedure InsertComponent(AComponent: TComponent);\r\n    procedure RemoveComponent(AComponent: TComponent);\r\n    procedure SetParentComponent(Value: TComponent); virtual;\r\n    procedure SetSubComponent(ASubComponent: Boolean);\r\n    function GetEnumerator: TComponentEnumerator;\r\n    procedure SetEvent(const AInstance: TPersistent; const ALookupRoot: TComponent; const APropName, AMethodName: string);\r\n//    function UpdateAction(Action: TBasicAction): Boolean; dynamic;\r\n    property Components[Index: Integer]: TComponent read GetComponent;\r\n    property ComponentCount: Integer read GetComponentCount;\r\n    property ComponentIndex: Integer read GetComponentIndex write SetComponentIndex;\r\n    property ComponentState: TComponentState read FComponentState;\r\n    property ComponentStyle: TComponentStyle read FComponentStyle;\r\n    property DesignInfo: Longint read FDesignInfo write FDesignInfo;\r\n    property Owner: TComponent read FOwner;\r\n    property Left: Integer read GetLeft write SetLeft;\r\n    property Top: Integer read GetTop write SetTop;\r\n  published\r\n    property Name: TComponentName read FName write SetName stored False;\r\n    property Tag: PtrInt read FTag write FTag {default 0};\r\n  end;\r\n\r\n  TComponentClass = class of TComponent;\r\n\r\n  TSeekOrigin = (soBeginning, soCurrent, soEnd);\r\n\r\n  { TStream }\r\n  (*\r\n  TStream = class(TObject)\r\n  private\r\n    FEndian: TEndian;\r\n    function MakeInt(B: TBytes; aSize: Integer; Signed: Boolean): NativeInt;\r\n    function MakeBytes(B: NativeInt; aSize: Integer; Signed: Boolean): TBytes;\r\n  protected\r\n    procedure InvalidSeek; virtual;\r\n    procedure Discard(const Count: NativeInt);\r\n    procedure DiscardLarge(Count: NativeInt; const MaxBufferSize: Longint);\r\n    procedure FakeSeekForward(Offset: NativeInt; const Origin: TSeekOrigin; const Pos: NativeInt);\r\n    function  GetPosition: NativeInt; virtual;\r\n    procedure SetPosition(const Pos: NativeInt); virtual;\r\n    function  GetSize: NativeInt; virtual;\r\n    procedure SetSize(const NewSize: NativeInt); virtual;\r\n    procedure SetSize64(const NewSize: NativeInt); virtual;\r\n    procedure ReadNotImplemented;\r\n    procedure WriteNotImplemented;\r\n    function ReadMaxSizeData(Buffer : TBytes; aSize,aCount : NativeInt) : NativeInt;\r\n    Procedure ReadExactSizeData(Buffer : TBytes; aSize,aCount : NativeInt);\r\n    function WriteMaxSizeData(Const Buffer : TBytes; aSize,aCount : NativeInt) : NativeInt;\r\n    Procedure WriteExactSizeData(Const Buffer : TBytes; aSize,aCount : NativeInt);\r\n  public\r\n    function Read(var Buffer: TBytes; Count: Longint): Longint; overload;\r\n    function Read(Buffer : TBytes; aOffset, Count: Longint): Longint; virtual; abstract; overload;\r\n\r\n    function Write(const Buffer: TBytes; Count: Longint): Longint; virtual; overload;\r\n    function Write(const Buffer: TBytes; Offset, Count: Longint): Longint; virtual; abstract; overload;\r\n\r\n    function Seek(const Offset: NativeInt; Origin: TSeekOrigin): NativeInt; virtual; abstract; overload;\r\n\r\n    function ReadData(Buffer: TBytes; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: Boolean): NativeInt; overload;\r\n    function ReadData(var Buffer: Boolean; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: WideChar): NativeInt; overload;\r\n    function ReadData(var Buffer: WideChar; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: Byte): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt8; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: Int16): NativeInt; overload;\r\n    function ReadData(var Buffer: Int16; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt16): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt16; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: Int32): NativeInt; overload;\r\n    function ReadData(var Buffer: Int32; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt32): NativeInt; overload;\r\n    function ReadData(var Buffer: UInt32; Count: NativeInt): NativeInt; overload;\r\n    // NativeLargeint. Stored as a float64, Read as float64.\r\n    function ReadData(var Buffer: NativeLargeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: NativeLargeInt; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: NativeLargeUInt): NativeInt; overload;\r\n    function ReadData(var Buffer: NativeLargeUInt; Count: NativeInt): NativeInt; overload;\r\n    function ReadData(var Buffer: Double): NativeInt; overload;\r\n    function ReadData(var Buffer: Double; Count: NativeInt): NativeInt; overload;\r\n    procedure ReadBuffer(var Buffer: TBytes; Count: NativeInt); overload;\r\n    procedure ReadBuffer(var Buffer: TBytes; Offset, Count: NativeInt); overload;\r\n\r\n    procedure ReadBufferData(var Buffer: Boolean); overload;\r\n    procedure ReadBufferData(var Buffer: Boolean; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: WideChar); overload;\r\n    procedure ReadBufferData(var Buffer: WideChar; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: Int8); overload;\r\n    procedure ReadBufferData(var Buffer: Int8; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: UInt8); overload;\r\n    procedure ReadBufferData(var Buffer: UInt8; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: Int16); overload;\r\n    procedure ReadBufferData(var Buffer: Int16; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: UInt16); overload;\r\n    procedure ReadBufferData(var Buffer: UInt16; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: Int32); overload;\r\n    procedure ReadBufferData(var Buffer: Int32; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: UInt32); overload;\r\n    procedure ReadBufferData(var Buffer: UInt32; Count: NativeInt); overload;\r\n    // NativeLargeint. Stored as a float64, Read as float64.\r\n    procedure ReadBufferData(var Buffer: NativeLargeInt); overload;\r\n    procedure ReadBufferData(var Buffer: NativeLargeInt; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: NativeLargeUInt); overload;\r\n    procedure ReadBufferData(var Buffer: NativeLargeUInt; Count: NativeInt); overload;\r\n    procedure ReadBufferData(var Buffer: Double); overload;\r\n    procedure ReadBufferData(var Buffer: Double; Count: NativeInt); overload;\r\n    procedure WriteBuffer(const Buffer: TBytes; Count: NativeInt); overload;\r\n    procedure WriteBuffer(const Buffer: TBytes; Offset, Count: NativeInt); overload;\r\n\r\n    function WriteData(const Buffer: TBytes; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Boolean): NativeInt; overload;\r\n    function WriteData(const Buffer: Boolean; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: WideChar): NativeInt; overload;\r\n    function WriteData(const Buffer: WideChar; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Int8): NativeInt; overload;\r\n    function WriteData(const Buffer: Int8; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt8): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt8; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Int16): NativeInt; overload;\r\n    function WriteData(const Buffer: Int16; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt16): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt16; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Int32): NativeInt; overload;\r\n    function WriteData(const Buffer: Int32; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt32): NativeInt; overload;\r\n    function WriteData(const Buffer: UInt32; Count: NativeInt): NativeInt; overload;\r\n    // NativeLargeint. Stored as a float64, Read as float64.\r\n    function WriteData(const Buffer: NativeLargeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: NativeLargeInt; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: NativeLargeUInt): NativeInt; overload;\r\n    function WriteData(const Buffer: NativeLargeUInt; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: Double): NativeInt; overload;\r\n    function WriteData(const Buffer: Double; Count: NativeInt): NativeInt; overload;\r\n{$IFDEF FPC_HAS_TYPE_EXTENDED}\r\n    function WriteData(const Buffer: Extended): NativeInt; overload;\r\n    function WriteData(const Buffer: Extended; Count: NativeInt): NativeInt; overload;\r\n    function WriteData(const Buffer: TExtended80Rec): NativeInt; overload;\r\n    function WriteData(const Buffer: TExtended80Rec; Count: NativeInt): NativeInt; overload;\r\n{$ENDIF}\r\n    procedure WriteBufferData(Buffer: Int32); overload;\r\n    procedure WriteBufferData(Buffer: Int32; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: Boolean); overload;\r\n    procedure WriteBufferData(Buffer: Boolean; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: WideChar); overload;\r\n    procedure WriteBufferData(Buffer: WideChar; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: Int8); overload;\r\n    procedure WriteBufferData(Buffer: Int8; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: UInt8); overload;\r\n    procedure WriteBufferData(Buffer: UInt8; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: Int16); overload;\r\n    procedure WriteBufferData(Buffer: Int16; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: UInt16); overload;\r\n    procedure WriteBufferData(Buffer: UInt16; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: UInt32); overload;\r\n    procedure WriteBufferData(Buffer: UInt32; Count: NativeInt); overload;\r\n    // NativeLargeint. Stored as a float64, Read as float64.\r\n    procedure WriteBufferData(Buffer: NativeLargeInt); overload;\r\n    procedure WriteBufferData(Buffer: NativeLargeInt; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: NativeLargeUInt); overload;\r\n    procedure WriteBufferData(Buffer: NativeLargeUInt; Count: NativeInt); overload;\r\n    procedure WriteBufferData(Buffer: Double); overload;\r\n    procedure WriteBufferData(Buffer: Double; Count: NativeInt); overload;\r\n    function CopyFrom(Source: TStream; Count: NativeInt): NativeInt;\r\n    function ReadComponent(Instance: TComponent): TComponent;\r\n    function ReadComponentRes(Instance: TComponent): TComponent;\r\n    procedure WriteComponent(Instance: TComponent);\r\n    procedure WriteComponentRes(const ResName: string; Instance: TComponent);\r\n    procedure WriteDescendent(Instance, Ancestor: TComponent);\r\n    procedure WriteDescendentRes(const ResName: string; Instance, Ancestor: TComponent);\r\n    procedure WriteResourceHeader(const ResName: string; {!!!:out} var FixupInfo: Longint);\r\n    procedure FixupResourceHeader(FixupInfo: Longint);\r\n    procedure ReadResHeader;\r\n    function ReadByte : Byte;\r\n    function ReadWord : Word;\r\n    function ReadDWord : Cardinal;\r\n    function ReadQWord : NativeLargeUInt;\r\n    procedure WriteByte(b : Byte);\r\n    procedure WriteWord(w : Word);\r\n    procedure WriteDWord(d : Cardinal);\r\n    procedure WriteQWord(q : NativeLargeUInt);\r\n    property Position: NativeInt read GetPosition write SetPosition;\r\n    property Size: NativeInt read GetSize write SetSize64;\r\n    Property Endian: TEndian Read FEndian Write FEndian;\r\n  end;\r\n\r\n  { TCustomMemoryStream abstract class }\r\n\r\n  TCustomMemoryStream = class(TStream)\r\n  private\r\n    FMemory: TJSArrayBuffer;\r\n    FDataView : TJSDataView;\r\n    FDataArray : TJSUint8Array;\r\n    FSize, FPosition: PtrInt;\r\n    FSizeBoundsSeek : Boolean;\r\n    function GetDataArray: TJSUint8Array;\r\n    function GetDataView: TJSDataview;\r\n  protected\r\n    Function GetSize : NativeInt; Override;\r\n    function GetPosition: NativeInt; Override;\r\n    procedure SetPointer(Ptr: TJSArrayBuffer; ASize: PtrInt);\r\n    Property DataView : TJSDataview Read GetDataView;\r\n    Property DataArray : TJSUint8Array Read GetDataArray;\r\n  public\r\n    Class Function MemoryToBytes(Mem : TJSArrayBuffer) : TBytes; overload;\r\n    Class Function MemoryToBytes(Mem : TJSUint8Array) : TBytes; overload;\r\n    Class Function BytesToMemory(aBytes : TBytes) : TJSArrayBuffer;\r\n    function Read(Buffer : TBytes; Offset, Count: LongInt): LongInt; override;\r\n    function Seek(const Offset: NativeInt; Origin: TSeekOrigin): NativeInt; override;\r\n    procedure SaveToStream(Stream: TStream);\r\n    property Memory: TJSArrayBuffer read FMemory;\r\n    Property SizeBoundsSeek : Boolean Read FSizeBoundsSeek Write FSizeBoundsSeek;\r\n  end;\r\n\r\n  { TMemoryStream }\r\n\r\n  TMemoryStream = class(TCustomMemoryStream)\r\n  private\r\n    FCapacity: PtrInt;\r\n    procedure SetCapacity(NewCapacity: PtrInt);\r\n  protected\r\n    function Realloc(var NewCapacity: PtrInt): TJSArrayBuffer; virtual;\r\n    property Capacity: PtrInt read FCapacity write SetCapacity;\r\n  public\r\n    destructor Destroy; override;\r\n    procedure Clear;\r\n    procedure LoadFromStream(Stream: TStream);\r\n    procedure SetSize(const NewSize: NativeInt); override;\r\n    function Write(const Buffer: TBytes; Offset, Count: LongInt): LongInt; override;\r\n  end;\r\n\r\n{ TBytesStream }\r\n\r\n  TBytesStream = class(TMemoryStream)\r\n  private\r\n    function GetBytes: TBytes;\r\n  public\r\n    constructor Create(const ABytes: TBytes); virtual; overload;\r\n    property Bytes: TBytes read GetBytes;\r\n  end;\r\n\r\n  { TStringStream }\r\n\r\n  TStringStream = class(TMemoryStream)\r\n  private\r\n    function GetDataString : String;\r\n  public\r\n    constructor Create(const aString: String); virtual; overload;\r\n    property DataString: String read GetDataString;\r\n  end;\r\n  *)\r\n\r\n\r\nprocedure RegisterClass(AClass : TPersistentClass);\r\nprocedure RegisterClasses(const AClasses: array of TPersistentClass);\r\nfunction GetClass(AClassName : string) : TPersistentClass;\r\n\r\nimplementation\r\n\r\n{ TInterfacedPersistent }\r\n\r\nfunction TInterfacedPersistent._AddRef: Integer;\r\nbegin\r\n  Result:=-1;\r\n  if Assigned(FOwnerInterface) then\r\n    Result:=FOwnerInterface._AddRef;\r\nend;\r\n\r\nfunction TInterfacedPersistent._Release: Integer;\r\n\r\nbegin\r\n  Result:=-1;\r\n  if Assigned(FOwnerInterface) then\r\n    Result:=FOwnerInterface._Release;\r\nend;\r\n\r\nfunction TInterfacedPersistent.QueryInterface(const IID: TGUID; out Obj): integer;\r\nbegin\r\n  Result:=E_NOINTERFACE;\r\n  if GetInterface(IID, Obj)  then\r\n    Result:=0;\r\nend;\r\n\r\nprocedure TInterfacedPersistent.AfterConstruction;\r\nbegin\r\n  inherited AfterConstruction;\r\n  if (GetOwner<>nil) then\r\n    GetOwner.GetInterface(IInterface, FOwnerInterface);\r\nend;\r\n\r\n{ TComponentEnumerator }\r\n\r\nconstructor TComponentEnumerator.Create(AComponent: TComponent);\r\nbegin\r\n  inherited Create;\r\n  FComponent := AComponent;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TComponentEnumerator.GetCurrent: TComponent;\r\nbegin\r\n  Result := FComponent.Components[FPosition];\r\nend;\r\n\r\nfunction TComponentEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FComponent.ComponentCount;\r\nend;\r\n\r\n{ TListEnumerator }\r\n\r\nconstructor TListEnumerator.Create(AList: TList);\r\nbegin\r\n  inherited Create;\r\n  FList := AList;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TListEnumerator.GetCurrent: JSValue;\r\nbegin\r\n  Result := FList[FPosition];\r\nend;\r\n\r\nfunction TListEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FList.Count;\r\nend;\r\n\r\n{ TFPListEnumerator }\r\n\r\nconstructor TFPListEnumerator.Create(AList: TFPList);\r\nbegin\r\n  inherited Create;\r\n  FList := AList;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TFPListEnumerator.GetCurrent: JSValue;\r\nbegin\r\n  Result := FList[FPosition];\r\nend;\r\n\r\nfunction TFPListEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FList.Count;\r\nend;\r\n\r\n{ TFPList }\r\n\r\nprocedure TFPList.CopyMove(aList: TFPList);\r\nvar r : integer;\r\nbegin\r\n  Clear;\r\n  for r := 0 to aList.count-1 do\r\n    Add(aList[r]);\r\nend;\r\n\r\nprocedure TFPList.MergeMove(aList: TFPList);\r\nvar r : integer;\r\nbegin\r\n  For r := 0 to aList.count-1 do\r\n    if IndexOf(aList[r]) < 0 then\r\n      Add(aList[r]);\r\nend;\r\n\r\nprocedure TFPList.DoCopy(ListA, ListB: TFPList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    CopyMove(ListB)\r\n  else\r\n    CopyMove(ListA);\r\nend;\r\n\r\nprocedure TFPList.DoSrcUnique(ListA, ListB: TFPList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) >= 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.DoAnd(ListA, ListB: TFPList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.count-1 do\r\n      if ListB.IndexOf(ListA[r]) >= 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) < 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.DoDestUnique(ListA, ListB: TFPList);\r\n\r\n  procedure MoveElements(Src, Dest: TFPList);\r\n  var r : integer;\r\n  begin\r\n    Clear;\r\n    for r := 0 to Src.count-1 do\r\n      if Dest.IndexOf(Src[r]) < 0 then\r\n        self.Add(Src[r]);\r\n  end;\r\n\r\nvar Dest : TFPList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    MoveElements(ListB, ListA)\r\n  else\r\n    Dest := TFPList.Create;\r\n    try\r\n      Dest.CopyMove(Self);\r\n      MoveElements(ListA, Dest)\r\n    finally\r\n      Dest.Destroy;\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.DoOr(ListA, ListB: TFPList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    CopyMove(ListA);\r\n    MergeMove(ListB);\r\n    end\r\n  else\r\n    MergeMove(ListA);\r\nend;\r\n\r\nprocedure TFPList.DoXOr(ListA, ListB: TFPList);\r\nvar\r\n  r : integer;\r\n  l : TFPList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    for r := 0 to ListB.Count-1 do\r\n      if ListA.IndexOf(ListB[r]) < 0 then\r\n        Add(ListB[r]);\r\n    end\r\n  else\r\n    begin\r\n    l := TFPList.Create;\r\n    try\r\n      l.CopyMove(Self);\r\n      for r := Count-1 downto 0 do\r\n        if listA.IndexOf(Self[r]) >= 0 then\r\n          Delete(r);\r\n      for r := 0 to ListA.Count-1 do\r\n        if l.IndexOf(ListA[r]) < 0 then\r\n          Add(ListA[r]);\r\n    finally\r\n      l.Destroy;\r\n    end;\r\n    end;\r\nend;\r\n\r\nfunction TFPList.Get(Index: Integer): JSValue;\r\nbegin\r\n  If (Index < 0) or (Index >= FCount) then\r\n    RaiseIndexError(Index);\r\n  Result:=FList[Index];\r\nend;\r\n\r\nprocedure TFPList.Put(Index: Integer; Item: JSValue);\r\nbegin\r\n  if (Index < 0) or (Index >= FCount) then\r\n    RaiseIndexError(Index);\r\n  FList[Index] := Item;\r\nend;\r\n\r\nprocedure TFPList.SetCapacity(NewCapacity: Integer);\r\nbegin\r\n  If (NewCapacity < FCount) then\r\n     Error (SListCapacityError, str(NewCapacity));\r\n  if NewCapacity = FCapacity then\r\n    exit;\r\n  SetLength(FList,NewCapacity);\r\n  FCapacity := NewCapacity;\r\nend;\r\n\r\nprocedure TFPList.SetCount(NewCount: Integer);\r\nbegin\r\n  if (NewCount < 0) then\r\n    Error(SListCountError, str(NewCount));\r\n  If NewCount > FCount then\r\n    begin\r\n    If NewCount > FCapacity then\r\n      SetCapacity(NewCount);\r\n    end;\r\n  FCount := NewCount;\r\nend;\r\n\r\nprocedure TFPList.RaiseIndexError(Index: Integer);\r\nbegin\r\n  Error(SListIndexError, str(Index));\r\nend;\r\n\r\ndestructor TFPList.Destroy;\r\nbegin\r\n  Clear;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TFPList.AddList(AList: TFPList);\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  If (Capacity<Count+AList.Count) then\r\n    Capacity:=Count+AList.Count;\r\n  For I:=0 to AList.Count-1 do\r\n    Add(AList[i]);\r\nend;\r\n\r\nfunction TFPList.Add(Item: JSValue): Integer;\r\nbegin\r\n  if FCount = FCapacity then\r\n    Expand;\r\n  FList[FCount] := Item;\r\n  Result := FCount;\r\n  Inc(FCount);\r\nend;\r\n\r\nprocedure TFPList.Clear;\r\nbegin\r\n  if Assigned(FList) then\r\n  begin\r\n    SetCount(0);\r\n    SetCapacity(0);\r\n  end;\r\nend;\r\n\r\nprocedure TFPList.Delete(Index: Integer);\r\nbegin\r\n  If (Index<0) or (Index>=FCount) then\r\n    Error (SListIndexError, str(Index));\r\n  FCount := FCount-1;\r\n  System.Delete(FList,Index,1);\r\n  Dec(FCapacity);\r\nend;\r\n\r\nclass procedure TFPList.Error(const Msg: string; const Data: String);\r\nbegin\r\n  Raise EListError.CreateFmt(Msg,[Data]);\r\nend;\r\n\r\nprocedure TFPList.Exchange(Index1, Index2: Integer);\r\nvar\r\n  Temp : JSValue;\r\nbegin\r\n  If (Index1 >= FCount) or (Index1 < 0) then\r\n    Error(SListIndexError, str(Index1));\r\n  If (Index2 >= FCount) or (Index2 < 0) then\r\n    Error(SListIndexError, str(Index2));\r\n  Temp := FList[Index1];\r\n  FList[Index1] := FList[Index2];\r\n  FList[Index2] := Temp;\r\nend;\r\n\r\nfunction TFPList.Expand: TFPList;\r\nvar\r\n  IncSize : Integer;\r\nbegin\r\n  if FCount < FCapacity then exit(self);\r\n  IncSize := 4;\r\n  if FCapacity > 3 then IncSize := IncSize + 4;\r\n  if FCapacity > 8 then IncSize := IncSize+8;\r\n  if FCapacity > 127 then Inc(IncSize, FCapacity shr 2);\r\n  SetCapacity(FCapacity + IncSize);\r\n  Result := Self;\r\nend;\r\n\r\nfunction TFPList.Extract(Item: JSValue): JSValue;\r\nvar\r\n  i : Integer;\r\nbegin\r\n  i := IndexOf(Item);\r\n  if i >= 0 then\r\n  begin\r\n    Result := Item;\r\n    Delete(i);\r\n  end\r\n  else\r\n    Result := nil;\r\nend;\r\n\r\nfunction TFPList.First: JSValue;\r\nbegin\r\n  If FCount = 0 then\r\n    Result := Nil\r\n  else\r\n    Result := Items[0];\r\nend;\r\n\r\nfunction TFPList.GetEnumerator: TFPListEnumerator;\r\nbegin\r\n  Result:=TFPListEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TFPList.IndexOf(Item: JSValue): Integer;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  C:=Count;\r\n  while (Result<C) and (FList[Result]<>Item) do\r\n    Inc(Result);\r\n  If Result>=C then\r\n    Result:=-1;\r\n\r\nend;\r\n\r\nfunction TFPList.IndexOfItem(Item: JSValue; Direction: TDirection): Integer;\r\n\r\nbegin\r\n  if Direction=fromBeginning then\r\n    Result:=IndexOf(Item)\r\n  else\r\n    begin\r\n    Result:=Count-1;\r\n    while (Result >=0) and (Flist[Result]<>Item) do\r\n      Result:=Result - 1;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TFPList.Insert(Index: Integer; Item: JSValue);\r\nbegin\r\n  if (Index < 0) or (Index > FCount )then\r\n    Error(SlistIndexError, str(Index));\r\n  TJSArray(FList).splice(Index, 0, Item);\r\n  inc(FCapacity);\r\n  inc(FCount);\r\nend;\r\n\r\nfunction TFPList.Last: JSValue;\r\nbegin\r\n  If FCount = 0 then\r\n    Result := nil\r\n  else\r\n    Result := Items[FCount - 1];\r\nend;\r\n\r\nprocedure TFPList.Move(CurIndex, NewIndex: Integer);\r\nvar\r\n  Temp: JSValue;\r\nbegin\r\n  if (CurIndex < 0) or (CurIndex > Count - 1) then\r\n    Error(SListIndexError, str(CurIndex));\r\n  if (NewIndex < 0) or (NewIndex > Count -1) then\r\n    Error(SlistIndexError, str(NewIndex));\r\n  if CurIndex=NewIndex then exit;\r\n  Temp:=FList[CurIndex];\r\n  // ToDo: use TJSArray.copyWithin if available\r\n  TJSArray(FList).splice(CurIndex,1);\r\n  TJSArray(FList).splice(NewIndex,0,Temp);\r\nend;\r\n\r\nprocedure TFPList.Assign(ListA: TFPList; AOperator: TListAssignOp;\r\n  ListB: TFPList);\r\nbegin\r\n  case AOperator of\r\n    laCopy      : DoCopy (ListA, ListB);      // replace dest with src\r\n    laSrcUnique : DoSrcUnique (ListA, ListB); // replace dest with src that are not in dest\r\n    laAnd       : DoAnd (ListA, ListB);       // remove from dest that are not in src\r\n    laDestUnique: DoDestUnique (ListA, ListB);// remove from dest that are in src\r\n    laOr        : DoOr (ListA, ListB);        // add to dest from src and not in dest\r\n    laXOr       : DoXOr (ListA, ListB);       // add to dest from src and not in dest, remove from dest that are in src\r\n  end;\r\nend;\r\n\r\nfunction TFPList.Remove(Item: JSValue): Integer;\r\nbegin\r\n  Result := IndexOf(Item);\r\n  If Result <> -1 then\r\n    Delete(Result);\r\nend;\r\n\r\nprocedure TFPList.Pack;\r\nvar\r\n  Dst, i: Integer;\r\n  V: JSValue;\r\nbegin\r\n  Dst:=0;\r\n  for i:=0 to Count-1 do\r\n    begin\r\n    V:=FList[i];\r\n    if not Assigned(V) then continue;\r\n    FList[Dst]:=V;\r\n    inc(Dst);\r\n    end;\r\nend;\r\n\r\n// Needed by Sort method.\r\n\r\nProcedure QuickSort(aList: TJSValueDynArray; L, R : Longint;\r\n                    const Compare: TListSortCompare);\r\nvar\r\n  I, J : Longint;\r\n  P, Q : JSValue;\r\nbegin\r\n  repeat\r\n    I := L;\r\n    J := R;\r\n    P := aList[ (L + R) div 2 ];\r\n    repeat\r\n      while Compare(P, aList[i]) > 0 do\r\n        I := I + 1;\r\n      while Compare(P, aList[J]) < 0 do\r\n        J := J - 1;\r\n      If I <= J then\r\n      begin\r\n        Q := aList[I];\r\n        aList[I] := aList[J];\r\n        aList[J] := Q;\r\n        I := I + 1;\r\n        J := J - 1;\r\n      end;\r\n    until I > J;\r\n    // sort the smaller range recursively\r\n    // sort the bigger range via the loop\r\n    // Reasons: memory usage is O(log(n)) instead of O(n) and loop is faster than recursion\r\n    if J - L < R - I then\r\n    begin\r\n      if L < J then\r\n        QuickSort(aList, L, J, Compare);\r\n      L := I;\r\n    end\r\n    else\r\n    begin\r\n      if I < R then\r\n        QuickSort(aList, I, R, Compare);\r\n      R := J;\r\n    end;\r\n  until L >= R;\r\nend;\r\n\r\nprocedure TFPList.Sort(const Compare: TListSortCompare);\r\nbegin\r\n  if Not Assigned(FList) or (FCount < 2) then exit;\r\n  QuickSort(Flist, 0, FCount-1, Compare);\r\nend;\r\n\r\nprocedure TFPList.ForEachCall(const proc2call: TListCallback; const arg: JSValue\r\n  );\r\nvar\r\n  i : integer;\r\n  v : JSValue;\r\nbegin\r\n  For I:=0 To Count-1 Do\r\n    begin\r\n      v:=FList[i];\r\n      if Assigned(v) then\r\n        proc2call(v,arg);\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.ForEachCall(const proc2call: TListStaticCallback;\r\n  const arg: JSValue);\r\nvar\r\n  i : integer;\r\n  v : JSValue;\r\nbegin\r\n  For I:=0 To Count-1 Do\r\n    begin\r\n      v:=FList[i];\r\n      if Assigned(v) then\r\n        proc2call(v,arg);\r\n    end;\r\nend;\r\n\r\n{ TList }\r\n\r\nprocedure TList.CopyMove(aList: TList);\r\nvar\r\n  r : integer;\r\nbegin\r\n  Clear;\r\n  for r := 0 to aList.count-1 do\r\n    Add(aList[r]);\r\nend;\r\n\r\nprocedure TList.MergeMove(aList: TList);\r\nvar r : integer;\r\nbegin\r\n  For r := 0 to aList.count-1 do\r\n    if IndexOf(aList[r]) < 0 then\r\n      Add(aList[r]);\r\nend;\r\n\r\nprocedure TList.DoCopy(ListA, ListB: TList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    CopyMove(ListB)\r\n  else\r\n    CopyMove(ListA);\r\nend;\r\n\r\nprocedure TList.DoSrcUnique(ListA, ListB: TList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) >= 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TList.DoAnd(ListA, ListB: TList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) >= 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) < 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TList.DoDestUnique(ListA, ListB: TList);\r\n\r\n  procedure MoveElements(Src, Dest : TList);\r\n  var r : integer;\r\n  begin\r\n    Clear;\r\n    for r := 0 to Src.Count-1 do\r\n      if Dest.IndexOf(Src[r]) < 0 then\r\n        Add(Src[r]);\r\n  end;\r\n\r\nvar Dest : TList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    MoveElements(ListB, ListA)\r\n  else\r\n    try\r\n      Dest := TList.Create;\r\n      Dest.CopyMove(Self);\r\n      MoveElements(ListA, Dest)\r\n    finally\r\n      Dest.Destroy;\r\n    end;\r\nend;\r\n\r\nprocedure TList.DoOr(ListA, ListB: TList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    CopyMove(ListA);\r\n    MergeMove(ListB);\r\n    end\r\n  else\r\n    MergeMove(ListA);\r\nend;\r\n\r\nprocedure TList.DoXOr(ListA, ListB: TList);\r\nvar\r\n  r : integer;\r\n  l : TList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    for r := 0 to ListB.Count-1 do\r\n      if ListA.IndexOf(ListB[r]) < 0 then\r\n        Add(ListB[r]);\r\n    end\r\n  else\r\n    try\r\n      l := TList.Create;\r\n      l.CopyMove (Self);\r\n      for r := Count-1 downto 0 do\r\n        if listA.IndexOf(Self[r]) >= 0 then\r\n          Delete(r);\r\n      for r := 0 to ListA.Count-1 do\r\n        if l.IndexOf(ListA[r]) < 0 then\r\n          Add(ListA[r]);\r\n    finally\r\n      l.Destroy;\r\n    end;\r\nend;\r\n\r\nfunction TList.Get(Index: Integer): JSValue;\r\nbegin\r\n  Result := FList.Get(Index);\r\nend;\r\n\r\nprocedure TList.Put(Index: Integer; Item: JSValue);\r\nvar V : JSValue;\r\nbegin\r\n  V := Get(Index);\r\n  FList.Put(Index, Item);\r\n  if Assigned(V) then\r\n    Notify(V, lnDeleted);\r\n  if Assigned(Item) then\r\n    Notify(Item, lnAdded);\r\nend;\r\n\r\nprocedure TList.Notify(aValue: JSValue; Action: TListNotification);\r\nbegin\r\n  if Assigned(aValue) then ;\r\n  if Action=lnExtracted then ;\r\nend;\r\n\r\nprocedure TList.SetCapacity(NewCapacity: Integer);\r\nbegin\r\n  FList.SetCapacity(NewCapacity);\r\nend;\r\n\r\nfunction TList.GetCapacity: integer;\r\nbegin\r\n  Result := FList.Capacity;\r\nend;\r\n\r\nprocedure TList.SetCount(NewCount: Integer);\r\nbegin\r\n  if NewCount < FList.Count then\r\n    while FList.Count > NewCount do\r\n      Delete(FList.Count - 1)\r\n  else\r\n    FList.SetCount(NewCount);\r\nend;\r\n\r\nfunction TList.GetCount: integer;\r\nbegin\r\n  Result := FList.Count;\r\nend;\r\n\r\nfunction TList.GetList: TJSValueDynArray;\r\nbegin\r\n  Result := FList.List;\r\nend;\r\n\r\nconstructor TList.Create;\r\nbegin\r\n  inherited Create;\r\n  FList := TFPList.Create;\r\nend;\r\n\r\ndestructor TList.Destroy;\r\nbegin\r\n  if Assigned(FList) then\r\n    Clear;\r\n  FreeAndNil(FList);\r\nend;\r\n\r\nprocedure TList.AddList(AList: TList);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  { this only does FList.AddList(AList.FList), avoiding notifications }\r\n  FList.AddList(AList.FList);\r\n\r\n  { make lnAdded notifications }\r\n  for I := 0 to AList.Count - 1 do\r\n    if Assigned(AList[I]) then\r\n      Notify(AList[I], lnAdded);\r\nend;\r\n\r\nfunction TList.Add(Item: JSValue): Integer;\r\nbegin\r\n  Result := FList.Add(Item);\r\n  if Assigned(Item) then\r\n    Notify(Item, lnAdded);\r\nend;\r\n\r\nprocedure TList.Clear;\r\nbegin\r\n  While (FList.Count>0) do\r\n    Delete(Count-1);\r\nend;\r\n\r\nprocedure TList.Delete(Index: Integer);\r\n\r\nvar V : JSValue;\r\n\r\nbegin\r\n  V:=FList.Get(Index);\r\n  FList.Delete(Index);\r\n  if assigned(V) then\r\n    Notify(V, lnDeleted);\r\nend;\r\n\r\nclass procedure TList.Error(const Msg: string; Data: String);\r\nbegin\r\n  Raise EListError.CreateFmt(Msg,[Data]);\r\nend;\r\n\r\nprocedure TList.Exchange(Index1, Index2: Integer);\r\nbegin\r\n  FList.Exchange(Index1, Index2);\r\nend;\r\n\r\nfunction TList.Expand: TList;\r\nbegin\r\n  FList.Expand;\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TList.Extract(Item: JSValue): JSValue;\r\nvar c : integer;\r\nbegin\r\n  c := FList.Count;\r\n  Result := FList.Extract(Item);\r\n  if c <> FList.Count then\r\n    Notify (Result, lnExtracted);\r\nend;\r\n\r\nfunction TList.First: JSValue;\r\nbegin\r\n  Result := FList.First;\r\nend;\r\n\r\nfunction TList.GetEnumerator: TListEnumerator;\r\nbegin\r\n  Result:=TListEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TList.IndexOf(Item: JSValue): Integer;\r\nbegin\r\n  Result := FList.IndexOf(Item);\r\nend;\r\n\r\nprocedure TList.Insert(Index: Integer; Item: JSValue);\r\nbegin\r\n  FList.Insert(Index, Item);\r\n  if Assigned(Item) then\r\n    Notify(Item,lnAdded);\r\nend;\r\n\r\nfunction TList.Last: JSValue;\r\nbegin\r\n  Result := FList.Last;\r\nend;\r\n\r\nprocedure TList.Move(CurIndex, NewIndex: Integer);\r\nbegin\r\n  FList.Move(CurIndex, NewIndex);\r\nend;\r\n\r\nprocedure TList.Assign(ListA: TList; AOperator: TListAssignOp; ListB: TList);\r\nbegin\r\n  case AOperator of\r\n    laCopy      : DoCopy (ListA, ListB);      // replace dest with src\r\n    laSrcUnique : DoSrcUnique (ListA, ListB); // replace dest with src that are not in dest\r\n    laAnd       : DoAnd (ListA, ListB);       // remove from dest that are not in src\r\n    laDestUnique: DoDestUnique (ListA, ListB);// remove from dest that are in src\r\n    laOr        : DoOr (ListA, ListB);        // add to dest from src and not in dest\r\n    laXOr       : DoXOr (ListA, ListB);       // add to dest from src and not in dest, remove from dest that are in src\r\n  end;\r\nend;\r\n\r\nfunction TList.Remove(Item: JSValue): Integer;\r\nbegin\r\n  Result := IndexOf(Item);\r\n  if Result <> -1 then\r\n    Self.Delete(Result);\r\nend;\r\n\r\nprocedure TList.Pack;\r\nbegin\r\n  FList.Pack;\r\nend;\r\n\r\nprocedure TList.Sort(const Compare: TListSortCompare);\r\nbegin\r\n  FList.Sort(Compare);\r\nend;\r\n\r\n{ TPersistent }\r\n\r\nprocedure TPersistent.AssignError(Source: TPersistent);\r\nvar\r\n  SourceName: String;\r\nbegin\r\n  if Source<>Nil then\r\n    SourceName:=Source.ClassName\r\n  else\r\n    SourceName:='Nil';\r\n  raise EConvertError.Create('Cannot assign a '+SourceName+' to a '+ClassName+'.');\r\nend;\r\n\r\nprocedure TPersistent.AssignTo(Dest: TPersistent);\r\nbegin\r\n  Dest.AssignError(Self);\r\nend;\r\n\r\nfunction TPersistent.GetOwner: TPersistent;\r\nbegin\r\n  Result:=nil;\r\nend;\r\n\r\nprocedure TPersistent.Assign(Source: TPersistent);\r\nbegin\r\n  If Source<>Nil then\r\n    Source.AssignTo(Self)\r\n  else\r\n    AssignError(Nil);\r\nend;\r\n\r\nfunction TPersistent.GetNamePath: string;\r\nvar\r\n  OwnerName: String;\r\n  TheOwner: TPersistent;\r\nbegin\r\n  Result:=ClassName;\r\n  TheOwner:=GetOwner;\r\n  if TheOwner<>Nil then\r\n  begin\r\n    OwnerName:=TheOwner.GetNamePath;\r\n    if OwnerName<>'' then Result:=OwnerName+'.'+Result;\r\n  end;\r\nend;\r\n\r\n{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 1999-2000 by the Free Pascal development team\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n{****************************************************************************}\r\n{*                        TStringsEnumerator                                *}\r\n{****************************************************************************}\r\n\r\nconstructor TStringsEnumerator.Create(AStrings: TStrings);\r\nbegin\r\n  inherited Create;\r\n  FStrings := AStrings;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TStringsEnumerator.GetCurrent: String;\r\nbegin\r\n  Result := FStrings[FPosition];\r\nend;\r\n\r\nfunction TStringsEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FStrings.Count;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TStrings                                     *}\r\n{****************************************************************************}\r\n\r\n// Function to quote text. Should move maybe to sysutils !!\r\n// Also, it is not clear at this point what exactly should be done.\r\n\r\n{ //!! is used to mark unsupported things. }\r\n\r\n{\r\n  For compatibility we can't add a Constructor to TSTrings to initialize\r\n  the special characters. Therefore we add a routine which is called whenever\r\n  the special chars are needed.\r\n}\r\n\r\nProcedure Tstrings.CheckSpecialChars;\r\n\r\nbegin\r\n  If Not FSpecialCharsInited then\r\n    begin\r\n    FQuoteChar:='\"';\r\n    FDelimiter:=',';\r\n    FNameValueSeparator:='=';\r\n    FLBS:=DefaultTextLineBreakStyle;\r\n    FSpecialCharsInited:=true;\r\n    FLineBreak:=sLineBreak;\r\n    end;\r\nend;\r\n\r\nFunction TStrings.GetSkipLastLineBreak : Boolean;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FSkipLastLineBreak;\r\nend;\r\n\r\nprocedure TStrings.SetSkipLastLineBreak(const AValue : Boolean);\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  FSkipLastLineBreak:=AValue;\r\nend;\r\n\r\nFunction TStrings.GetLBS : TTextLineBreakStyle;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FLBS;\r\nend;\r\n\r\nProcedure TStrings.SetLBS (AValue : TTextLineBreakStyle);\r\nbegin\r\n  CheckSpecialChars;\r\n  FLBS:=AValue;\r\nend;\r\n\r\nprocedure TStrings.SetDelimiter(c:Char);\r\nbegin\r\n  CheckSpecialChars;\r\n  FDelimiter:=c;\r\nend;\r\n\r\nFunction TStrings.GetDelimiter : Char;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FDelimiter;\r\nend;\r\n\r\nprocedure TStrings.SetLineBreak(Const S : String);\r\nbegin\r\n  CheckSpecialChars;\r\n  FLineBreak:=S;\r\nend;\r\n\r\nFunction TStrings.GetLineBreak : String;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FLineBreak;\r\nend;\r\n\r\n\r\nprocedure TStrings.SetQuoteChar(c:Char);\r\nbegin\r\n  CheckSpecialChars;\r\n  FQuoteChar:=c;\r\nend;\r\n\r\nFunction TStrings.GetQuoteChar :Char;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FQuoteChar;\r\nend;\r\n\r\nprocedure TStrings.SetNameValueSeparator(c:Char);\r\nbegin\r\n  CheckSpecialChars;\r\n  FNameValueSeparator:=c;\r\nend;\r\n\r\nFunction TStrings.GetNameValueSeparator :Char;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FNameValueSeparator;\r\nend;\r\n\r\n\r\nfunction TStrings.GetCommaText: string;\r\n\r\nVar\r\n  C1,C2 : Char;\r\n  FSD : Boolean;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  FSD:=StrictDelimiter;\r\n  C1:=Delimiter;\r\n  C2:=QuoteChar;\r\n  Delimiter:=',';\r\n  QuoteChar:='\"';\r\n  StrictDelimiter:=False;\r\n  Try\r\n    Result:=GetDelimitedText;\r\n  Finally\r\n    Delimiter:=C1;\r\n    QuoteChar:=C2;\r\n    StrictDelimiter:=FSD;\r\n  end;\r\nend;\r\n\r\n\r\nFunction TStrings.GetDelimitedText: string;\r\n\r\nVar\r\n  I: integer;\r\n  RE : string;\r\n  S : String;\r\n  doQuote : Boolean;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  result:='';\r\n  RE:=QuoteChar+'|'+Delimiter;\r\n  if not StrictDelimiter then\r\n    RE:=' |'+RE;\r\n  RE:='/'+RE+'/';\r\n  // Check for break characters and quote if required.\r\n  For i:=0 to count-1 do\r\n    begin\r\n    S:=Strings[i];\r\n    doQuote:=FAlwaysQuote or (TJSString(s).search(RE)<>-1);\r\n    if DoQuote then\r\n      Result:=Result+QuoteString(S,QuoteChar)\r\n    else\r\n      Result:=Result+S;\r\n    if I<Count-1 then\r\n      Result:=Result+Delimiter;\r\n    end;\r\n  // Quote empty string:\r\n  If (Length(Result)=0) and (Count=1) then\r\n    Result:=QuoteChar+QuoteChar;\r\nend;\r\n\r\nprocedure TStrings.GetNameValue(Index : Integer; Out AName,AValue : String);\r\n\r\nVar L : longint;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  AValue:=Strings[Index];\r\n  L:=Pos(FNameValueSeparator,AValue);\r\n  If L<>0 then\r\n    begin\r\n    AName:=Copy(AValue,1,L-1);\r\n    //    System.Delete(AValue,1,L);\r\n    AValue:=Copy(AValue,L+1,length(AValue)-L);\r\n    end\r\n  else\r\n    AName:='';\r\nend;\r\n\r\nfunction TStrings.ExtractName(const s:String):String;\r\nvar\r\n  L: Longint;\r\nbegin\r\n  CheckSpecialChars;\r\n  L:=Pos(FNameValueSeparator,S);\r\n  If L<>0 then\r\n    Result:=Copy(S,1,L-1)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction TStrings.GetName(Index: Integer): string;\r\n\r\nVar\r\n  V : String;\r\n\r\nbegin\r\n  GetNameValue(Index,Result,V);\r\nend;\r\n\r\nFunction TStrings.GetValue(const Name: string): string;\r\n\r\nVar\r\n  L : longint;\r\n  N : String;\r\n\r\nbegin\r\n  Result:='';\r\n  L:=IndexOfName(Name);\r\n  If L<>-1 then\r\n    GetNameValue(L,N,Result);\r\nend;\r\n\r\nFunction TStrings.GetValueFromIndex(Index: Integer): string;\r\n\r\nVar\r\n  N : String;\r\n\r\nbegin\r\n  GetNameValue(Index,N,Result);\r\nend;\r\n\r\nProcedure TStrings.SetValueFromIndex(Index: Integer; const Value: string);\r\n\r\nbegin\r\n  If (Value='') then\r\n    Delete(Index)\r\n  else\r\n    begin\r\n    If (Index<0) then\r\n      Index:=Add('');\r\n    CheckSpecialChars;\r\n    Strings[Index]:=GetName(Index)+FNameValueSeparator+Value;\r\n    end;\r\nend;\r\n\r\nProcedure TStrings.SetDelimitedText(const AValue: string);\r\nvar i,j:integer;\r\n    aNotFirst:boolean;\r\nbegin\r\n CheckSpecialChars;\r\n BeginUpdate;\r\n\r\n i:=1;\r\n j:=1;\r\n aNotFirst:=false;\r\n\r\n { Paraphrased from Delphi XE2 help:\r\n Strings must be separated by Delimiter characters or spaces.\r\n They may be enclosed in QuoteChars.\r\n QuoteChars in the string must be repeated to distinguish them from the QuoteChars enclosing the string.\r\n }\r\n try\r\n  Clear;\r\n  If StrictDelimiter then\r\n    begin\r\n    while i<=length(AValue) do begin\r\n     // skip delimiter\r\n     if aNotFirst and (i<=length(AValue)) and (AValue[i]=FDelimiter) then inc(i);\r\n\r\n     // read next string\r\n     if i<=length(AValue) then begin\r\n      if AValue[i]=FQuoteChar then begin\r\n       // next string is quoted\r\n       j:=i+1;\r\n       while (j<=length(AValue)) and\r\n             ( (AValue[j]<>FQuoteChar) or\r\n               ( (j+1<=length(AValue)) and (AValue[j+1]=FQuoteChar) ) ) do begin\r\n        if (j<=length(AValue)) and (AValue[j]=FQuoteChar) then inc(j,2)\r\n                                                          else inc(j);\r\n       end;\r\n       // j is position of closing quote\r\n       Add( StringReplace (Copy(AValue,i+1,j-i-1),\r\n                           FQuoteChar+FQuoteChar,FQuoteChar, [rfReplaceAll]));\r\n       i:=j+1;\r\n      end else begin\r\n       // next string is not quoted; read until delimiter\r\n       j:=i;\r\n       while (j<=length(AValue)) and\r\n             (AValue[j]<>FDelimiter) do inc(j);\r\n       Add( Copy(AValue,i,j-i));\r\n       i:=j;\r\n      end;\r\n     end else begin\r\n      if aNotFirst then Add('');\r\n     end;\r\n\r\n     aNotFirst:=true;\r\n    end;\r\n    end\r\n  else\r\n    begin\r\n    while i<=length(AValue) do begin\r\n     // skip delimiter\r\n     if aNotFirst and (i<=length(AValue)) and (AValue[i]=FDelimiter) then inc(i);\r\n\r\n     // skip spaces\r\n     while (i<=length(AValue)) and (Ord(AValue[i])<=Ord(' ')) do inc(i);\r\n\r\n     // read next string\r\n     if i<=length(AValue) then begin\r\n      if AValue[i]=FQuoteChar then begin\r\n       // next string is quoted\r\n       j:=i+1;\r\n       while (j<=length(AValue)) and\r\n             ( (AValue[j]<>FQuoteChar) or\r\n               ( (j+1<=length(AValue)) and (AValue[j+1]=FQuoteChar) ) ) do begin\r\n        if (j<=length(AValue)) and (AValue[j]=FQuoteChar) then inc(j,2)\r\n                                                          else inc(j);\r\n       end;\r\n       // j is position of closing quote\r\n       Add( StringReplace (Copy(AValue,i+1,j-i-1),\r\n                           FQuoteChar+FQuoteChar,FQuoteChar, [rfReplaceAll]));\r\n       i:=j+1;\r\n      end else begin\r\n       // next string is not quoted; read until control character/space/delimiter\r\n       j:=i;\r\n       while (j<=length(AValue)) and\r\n             (Ord(AValue[j])>Ord(' ')) and\r\n             (AValue[j]<>FDelimiter) do inc(j);\r\n       Add( Copy(AValue,i,j-i));\r\n       i:=j;\r\n      end;\r\n     end else begin\r\n      if aNotFirst then Add('');\r\n     end;\r\n\r\n     // skip spaces\r\n     while (i<=length(AValue)) and (Ord(AValue[i])<=Ord(' ')) do inc(i);\r\n\r\n     aNotFirst:=true;\r\n    end;\r\n    end;\r\n finally\r\n   EndUpdate;\r\n end;\r\nend;\r\n\r\nProcedure TStrings.SetCommaText(const Value: string);\r\n\r\nVar\r\n  C1,C2 : Char;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  C1:=Delimiter;\r\n  C2:=QuoteChar;\r\n  Delimiter:=',';\r\n  QuoteChar:='\"';\r\n  Try\r\n    SetDelimitedText(Value);\r\n  Finally\r\n    Delimiter:=C1;\r\n    QuoteChar:=C2;\r\n  end;\r\nend;\r\n\r\nProcedure TStrings.SetValue(const Name, Value: string);\r\n\r\nVar L : longint;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  L:=IndexOfName(Name);\r\n  if L=-1 then\r\n   Add (Name+FNameValueSeparator+Value)\r\n  else\r\n   Strings[L]:=Name+FNameValueSeparator+value;\r\nend;\r\n\r\n\r\nProcedure TStrings.Error(const Msg: string; Data: Integer);\r\nbegin\r\n  Raise EStringListError.CreateFmt(Msg,[IntToStr(Data)]);\r\nend;\r\n\r\nFunction TStrings.GetCapacity: Integer;\r\n\r\nbegin\r\n  Result:=Count;\r\nend;\r\n\r\n\r\n\r\nFunction TStrings.GetObject(Index: Integer): TObject;\r\n\r\nbegin\r\n  if Index=0 then ;\r\n  Result:=Nil;\r\nend;\r\n\r\nFunction TStrings.GetTextStr: string;\r\n\r\nVar\r\n  I : Longint;\r\n  S,NL : String;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  // Determine needed place\r\n  if FLineBreak<>sLineBreak then\r\n    NL:=FLineBreak\r\n  else\r\n    Case FLBS of\r\n      tlbsLF   : NL:=#10;\r\n      tlbsCRLF : NL:=#13#10;\r\n      tlbsCR   : NL:=#13;\r\n    end;\r\n  Result:='';\r\n  For i:=0 To count-1 do\r\n    begin\r\n    S:=Strings[I];\r\n    Result:=Result+S;\r\n    if (I<Count-1) or Not SkipLastLineBreak then\r\n      Result:=Result+NL;\r\n    end;\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.Put(Index: Integer; const S: string);\r\n\r\nVar Obj : TObject;\r\n\r\nbegin\r\n  Obj:=Objects[Index];\r\n  Delete(Index);\r\n  InsertObject(Index,S,Obj);\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.PutObject(Index: Integer; AObject: TObject);\r\n\r\nbegin\r\n  // Empty.\r\n  if Index=0 then exit;\r\n  if AObject=nil then exit;\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure TStrings.SaveToFile(const FileName: string);\r\nvar\r\n  AText: string;\r\nbegin\r\n  AText := self.Text;\r\n  asm\r\n    var element = document.createElement('a');\r\n    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(AText));\r\n    if (FileName != ''){\r\n      element.setAttribute('download', FileName);\r\n    }\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n    element.click();\r\n    document.body.removeChild(element);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nProcedure TStrings.SetCapacity(NewCapacity: Integer);\r\n\r\nbegin\r\n  // Empty.\r\n  if NewCapacity=0 then ;\r\nend;\r\n\r\nFunction TStrings.GetNextLineBreak (Const Value : String; Out S : String; Var P : Integer) : Boolean;\r\n\r\nVar\r\n  PP : Integer;\r\n\r\nbegin\r\n  S:='';\r\n  Result:=False;\r\n  If ((Length(Value)-P)<0) then\r\n    exit;\r\n  PP:=TJSString(Value).IndexOf(LineBreak,P-1)+1;\r\n  if (PP<1) then\r\n    PP:=Length(Value)+1;\r\n  S:=Copy(Value,P,PP-P);\r\n  P:=PP+length(LineBreak);\r\n  Result:=True;\r\nend;\r\n\r\nProcedure TStrings.DoSetTextStr(const Value: string; DoClear : Boolean);\r\n\r\nVar\r\n  S : String;\r\n  P : Integer;\r\n\r\nbegin\r\n  Try\r\n    BeginUpdate;\r\n    if DoClear then\r\n      Clear;\r\n    P:=1;\r\n    While GetNextLineBreak (Value,S,P) do\r\n      Add(S);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nProcedure TStrings.SetTextStr(const Value: string);\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  DoSetTextStr(Value,True);\r\nend;\r\n\r\nProcedure TStrings.AddText(const S: string);\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  DoSetTextStr(S,False);\r\nend;\r\n\r\nProcedure TStrings.SetUpdateState(Updating: Boolean);\r\n\r\nbegin\r\n  // FPONotifyObservers(Self,ooChange,Nil);\r\n  if Updating then ;\r\nend;\r\n\r\n\r\n\r\ndestructor TSTrings.Destroy;\r\n\r\nbegin\r\n  inherited destroy;\r\nend;\r\n\r\n\r\nconstructor TStrings.Create;\r\nbegin\r\n  inherited Create;\r\n  FAlwaysQuote:=False;\r\nend;\r\n\r\nFunction TStrings.Add(const S: string): Integer;\r\n\r\nbegin\r\n  Result:=Count;\r\n  Insert (Count,S);\r\nend;\r\n\r\n(*\r\nfunction TStrings.AddFmt(const Fmt : string; const Args : Array of const): Integer;\r\n\r\nbegin\r\n  Result:=Add(Format(Fmt,Args));\r\nend;\r\n*)\r\n\r\nFunction TStrings.AddObject(const S: string; AObject: TObject): Integer;\r\n\r\nbegin\r\n  Result:=Add(S);\r\n  Objects[result]:=AObject;\r\nend;\r\n\r\n(*\r\nfunction TStrings.AddObject(const Fmt: string; Args : Array of const; AObject: TObject): Integer;\r\n\r\nbegin\r\n  Result:=AddObject(Format(Fmt,Args),AObject);\r\nend;\r\n*)\r\n\r\nProcedure TStrings.Append(const S: string);\r\n\r\nbegin\r\n  Add (S);\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.AddStrings(TheStrings: TStrings; ClearFirst : Boolean);\r\n\r\n\r\nbegin\r\n  beginupdate;\r\n  try\r\n    if ClearFirst then\r\n      Clear;\r\n    AddStrings(TheStrings);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nProcedure TStrings.AddStrings(TheStrings: TStrings);\r\n\r\nVar Runner : longint;\r\nbegin\r\n  For Runner:=0 to TheStrings.Count-1 do\r\n    self.AddObject (Thestrings[Runner],TheStrings.Objects[Runner]);\r\nend;\r\n\r\nProcedure TStrings.AddStrings(const TheStrings: array of string);\r\n\r\nVar Runner : longint;\r\nbegin\r\n  if Count + High(TheStrings)+1 > Capacity then\r\n    Capacity := Count + High(TheStrings)+1;\r\n  For Runner:=Low(TheStrings) to High(TheStrings) do\r\n    self.Add(Thestrings[Runner]);\r\nend;\r\n\r\n\r\nProcedure TStrings.AddStrings(const TheStrings: array of string; ClearFirst : Boolean);\r\n\r\nbegin\r\n  beginupdate;\r\n  try\r\n    if ClearFirst then\r\n      Clear;\r\n    AddStrings(TheStrings);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TStrings.AddPair(const AName, AValue: string): TStrings;\r\n\r\nbegin\r\n  Result:=AddPair(AName,AValue,Nil);\r\nend;\r\n\r\nfunction TStrings.AddPair(const AName, AValue: string; AObject: TObject): TStrings;\r\n\r\nbegin\r\n  Result := Self;\r\n  AddObject(AName+NameValueSeparator+AValue, AObject);\r\nend;\r\n\r\n\r\nProcedure TStrings.Assign(Source: TPersistent);\r\n\r\nVar\r\n  S : TStrings;\r\n\r\nbegin\r\n  If Source is TStrings then\r\n    begin\r\n    S:=TStrings(Source);\r\n    BeginUpdate;\r\n    Try\r\n      clear;\r\n      FSpecialCharsInited:=S.FSpecialCharsInited;\r\n      FQuoteChar:=S.FQuoteChar;\r\n      FDelimiter:=S.FDelimiter;\r\n      FNameValueSeparator:=S.FNameValueSeparator;\r\n      FLBS:=S.FLBS;\r\n      FLineBreak:=S.FLineBreak;\r\n      AddStrings(S);\r\n    finally\r\n      EndUpdate;\r\n    end;\r\n    end\r\n  else\r\n    Inherited Assign(Source);\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.BeginUpdate;\r\n\r\nbegin\r\n   if FUpdateCount = 0 then SetUpdateState(true);\r\n   inc(FUpdateCount);\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.EndUpdate;\r\n\r\nbegin\r\n  If FUpdateCount>0 then\r\n     Dec(FUpdateCount);\r\n  if FUpdateCount=0 then\r\n    SetUpdateState(False);\r\nend;\r\n\r\n\r\n\r\nFunction TStrings.Equals(Obj: TObject): Boolean;\r\n\r\nbegin\r\n  if Obj is TStrings then\r\n    Result := Equals(TStrings(Obj))\r\n  else\r\n    Result := inherited Equals(Obj);\r\nend;\r\n\r\n\r\n\r\nFunction TStrings.Equals(TheStrings: TStrings): Boolean;\r\n\r\nVar Runner,Nr : Longint;\r\n\r\nbegin\r\n  Result:=False;\r\n  Nr:=Self.Count;\r\n  if Nr<>TheStrings.Count then exit;\r\n  For Runner:=0 to Nr-1 do\r\n    If Strings[Runner]<>TheStrings[Runner] then exit;\r\n  Result:=True;\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.Exchange(Index1, Index2: Integer);\r\n\r\nVar\r\n  Obj : TObject;\r\n  Str : String;\r\n\r\nbegin\r\n  beginUpdate;\r\n  Try\r\n    Obj:=Objects[Index1];\r\n    Str:=Strings[Index1];\r\n    Objects[Index1]:=Objects[Index2];\r\n    Strings[Index1]:=Strings[Index2];\r\n    Objects[Index2]:=Obj;\r\n    Strings[Index2]:=Str;\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TStrings.GetEnumerator: TStringsEnumerator;\r\nbegin\r\n  Result:=TStringsEnumerator.Create(Self);\r\nend;\r\n\r\n\r\nFunction TStrings.DoCompareText(const s1,s2 : string) : PtrInt;\r\nbegin\r\n  result:=CompareText(s1,s2);\r\nend;\r\n\r\n\r\nFunction TStrings.IndexOf(const S: string): Integer;\r\nbegin\r\n  Result:=0;\r\n  While (Result<Count) and (DoCompareText(Strings[Result],S)<>0) do Result:=Result+1;\r\n  if Result=Count then Result:=-1;\r\nend;\r\n\r\n\r\nFunction TStrings.IndexOfName(const Name: string): Integer;\r\nVar\r\n  len : longint;\r\n  S : String;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=0;\r\n  while (Result<Count) do\r\n    begin\r\n    S:=Strings[Result];\r\n    len:=pos(FNameValueSeparator,S)-1;\r\n    if (len>=0) and (DoCompareText(Name,Copy(S,1,Len))=0) then\r\n      exit;\r\n    inc(result);\r\n    end;\r\n  result:=-1;\r\nend;\r\n\r\n\r\nFunction TStrings.IndexOfObject(AObject: TObject): Integer;\r\nbegin\r\n  Result:=0;\r\n  While (Result<count) and (Objects[Result]<>AObject) do Result:=Result+1;\r\n  If Result=Count then Result:=-1;\r\nend;\r\n\r\n\r\nProcedure TStrings.InsertObject(Index: Integer; const S: string;\r\n  AObject: TObject);\r\n\r\nbegin\r\n  Insert (Index,S);\r\n  Objects[Index]:=AObject;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TStrings.onLoad(Event: TEventListenerEvent): boolean;\r\nvar\r\n  a: TJSStringDynArray;\r\n  req: TJSXMLHttpRequest;\r\n\r\nbegin\r\n  req := TJSXMLHttpRequest(Event.target);\r\n\r\n  if (req.status = 200) then\r\n  begin\r\n    asm\r\n      var obj = req.responseText.split(/\\r\\n|\\n/);\r\n      for (var i = 0; i < obj.length; i++) {\r\n        a.push(obj[i]);\r\n      }\r\n    end;\r\n  end;\r\n\r\n  AddStrings(a, True);\r\n\r\n  Result := true;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TStrings.LoadFromFileAsync(const FileName: string);\r\nvar\r\n  cors_api_url: string;\r\nbegin\r\n  cors_api_url := '';//'https://cors-anywhere.herokuapp.com/';\r\n  FReq := TJSXMLHttpRequest.New;\r\n  FReq.addEventListener('load', @onLoad);\r\n  FReq.open('GET', cors_api_url + FileName, true);\r\n  FReq.send;\r\nend;\r\n\r\nprocedure TStrings.LoadFromFile(const FileName: string);\r\nvar\r\n  a: TJSStringDynArray;\r\nbegin\r\n  a := URLToArrayOfString(FileName);\r\n  AddStrings(a, True);\r\nend;\r\n\r\nProcedure TStrings.Move(CurIndex, NewIndex: Integer);\r\nVar\r\n  Obj : TObject;\r\n  Str : String;\r\nbegin\r\n  BeginUpdate;\r\n  Try\r\n    Obj:=Objects[CurIndex];\r\n    Str:=Strings[CurIndex];\r\n    Objects[CurIndex]:=Nil; // Prevent Delete from freeing.\r\n    Delete(Curindex);\r\n    InsertObject(NewIndex,Str,Obj);\r\n  finally\r\n    EndUpdate;\r\n    end;\r\nend;\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TStringList                                  *}\r\n{****************************************************************************}\r\n\r\n\r\nprocedure TStringList.ExchangeItemsInt(Index1, Index2: Integer);\r\n\r\nVar\r\n  S : String;\r\n  O : TObject;\r\n\r\nbegin\r\n  S:=Flist[Index1].FString;\r\n  O:=Flist[Index1].FObject;\r\n  Flist[Index1].Fstring:=Flist[Index2].Fstring;\r\n  Flist[Index1].FObject:=Flist[Index2].FObject;\r\n  Flist[Index2].Fstring:=S;\r\n  Flist[Index2].FObject:=O;\r\nend;\r\n\r\nfunction TStringList.GetSorted: Boolean;\r\nbegin\r\n  Result:=FSortStyle in [sslUser,sslAuto];\r\nend;\r\n\r\n\r\nprocedure TStringList.ExchangeItems(Index1, Index2: Integer);\r\nbegin\r\n  ExchangeItemsInt(Index1, Index2);\r\nend;\r\n\r\n\r\nprocedure TStringList.Grow;\r\n\r\nVar\r\n  NC : Integer;\r\n\r\nbegin\r\n  NC:=Capacity;\r\n  If NC>=256 then\r\n    NC:=NC+(NC Div 4)\r\n  else if NC=0 then\r\n    NC:=4\r\n  else\r\n    NC:=NC*4;\r\n  SetCapacity(NC);\r\nend;\r\n\r\nprocedure TStringList.InternalClear(FromIndex: Integer; ClearOnly: Boolean);\r\n\r\nVar\r\n  I: Integer;\r\n\r\nbegin\r\n  if FromIndex < FCount then\r\n    begin\r\n      if FOwnsObjects then\r\n        begin\r\n          For I:=FromIndex to FCount-1 do\r\n            begin\r\n              Flist[I].FString:='';\r\n              freeandnil(Flist[i].FObject);\r\n            end;\r\n        end\r\n      else\r\n        begin\r\n          For I:=FromIndex to FCount-1 do\r\n            Flist[I].FString:='';\r\n        end;\r\n      FCount:=FromIndex;\r\n    end;\r\n  if Not ClearOnly then\r\n    SetCapacity(0);\r\nend;\r\n\r\n\r\nprocedure TStringList.QuickSort(L, R: Integer; CompareFn: TStringListSortCompare\r\n  );\r\n\r\n\r\nvar\r\n  Pivot, vL, vR: Integer;\r\n\r\nbegin\r\n  //if ExchangeItems is override call that, else call (faster) ExchangeItemsInt\r\n\r\n  if R - L <= 1 then begin // a little bit of time saver\r\n    if L < R then\r\n      if CompareFn(Self, L, R) > 0 then\r\n        ExchangeItems(L, R);\r\n\r\n    Exit;\r\n  end;\r\n\r\n  vL := L;\r\n  vR := R;\r\n\r\n  Pivot := L + Random(R - L); // they say random is best\r\n\r\n  while vL < vR do begin\r\n    while (vL < Pivot) and (CompareFn(Self, vL, Pivot) <= 0) do\r\n      Inc(vL);\r\n\r\n    while (vR > Pivot) and (CompareFn(Self, vR, Pivot) > 0) do\r\n      Dec(vR);\r\n\r\n    ExchangeItems(vL, vR);\r\n\r\n    if Pivot = vL then // swap pivot if we just hit it from one side\r\n      Pivot := vR\r\n    else if Pivot = vR then\r\n      Pivot := vL;\r\n  end;\r\n\r\n  if Pivot - 1 >= L then\r\n    QuickSort(L, Pivot - 1, CompareFn);\r\n  if Pivot + 1 <= R then\r\n    QuickSort(Pivot + 1, R, CompareFn);\r\nend;\r\n\r\n\r\nprocedure TStringList.InsertItem(Index: Integer; const S: string);\r\nbegin\r\n  InsertItem(Index, S, nil);\r\nend;\r\n\r\n\r\nprocedure TStringList.InsertItem(Index: Integer; const S: string; O: TObject);\r\n\r\nVar\r\n  It : TStringItem;\r\n  \r\nbegin\r\n  Changing;\r\n  If FCount=Capacity then Grow;\r\n  it.FString:=S;\r\n  it.FObject:=O;\r\n  TJSArray(FList).Splice(Index,0,It);\r\n  Inc(FCount);\r\n  Changed;\r\nend;\r\n\r\n\r\nprocedure TStringList.SetSorted(Value: Boolean);\r\n\r\nbegin\r\n  If Value then\r\n    SortStyle:=sslAuto\r\n  else\r\n    SortStyle:=sslNone\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Changed;\r\n\r\nbegin\r\n  If (FUpdateCount=0) Then\r\n   begin\r\n   If Assigned(FOnChange) then\r\n     FOnchange(Self);\r\n   end;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Changing;\r\n\r\nbegin\r\n  If FUpdateCount=0 then\r\n    if Assigned(FOnChanging) then\r\n      FOnchanging(Self);\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.Get(Index: Integer): string;\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Result:=Flist[Index].FString;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.GetCapacity: Integer;\r\n\r\nbegin\r\n  Result:=Length(FList);\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.GetCount: Integer;\r\n\r\nbegin\r\n  Result:=FCount;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.GetObject(Index: Integer): TObject;\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Result:=Flist[Index].FObject;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Put(Index: Integer; const S: string);\r\n\r\nbegin\r\n  If Sorted then\r\n    Error(SSortedListError,0);\r\n  CheckIndex(Index);\r\n  Changing;\r\n  Flist[Index].FString:=S;\r\n  Changed;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.PutObject(Index: Integer; AObject: TObject);\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Changing;\r\n  Flist[Index].FObject:=AObject;\r\n  Changed;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.SetCapacity(NewCapacity: Integer);\r\n\r\nbegin\r\n  If (NewCapacity<0) then\r\n     Error (SListCapacityError,NewCapacity);\r\n  If NewCapacity<>Capacity then\r\n    SetLength(FList,NewCapacity)\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.SetUpdateState(Updating: Boolean);\r\n\r\nbegin\r\n  If Updating then\r\n    Changing\r\n  else\r\n    Changed\r\nend;\r\n\r\n\r\n\r\ndestructor TStringList.Destroy;\r\n\r\nbegin\r\n  InternalClear;\r\n  Inherited destroy;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.Add(const S: string): Integer;\r\n\r\nbegin\r\n  If Not (SortStyle=sslAuto) then\r\n    Result:=FCount\r\n  else\r\n    If Find (S,Result) then\r\n      Case DUplicates of\r\n        DupIgnore : Exit;\r\n        DupError : Error(SDuplicateString,0)\r\n      end;\r\n   InsertItem (Result,S);\r\nend;\r\n\r\nprocedure TStringList.Clear;\r\n\r\nbegin\r\n  if FCount = 0 then Exit;\r\n  Changing;\r\n  InternalClear;\r\n  Changed;\r\nend;\r\n\r\nprocedure TStringList.Delete(Index: Integer);\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Changing;\r\n  if FOwnsObjects then\r\n    FreeAndNil(Flist[Index].FObject);\r\n  TJSArray(FList).splice(Index,1);  \r\n  FList[Count-1].FString:='';\r\n  Flist[Count-1].FObject:=Nil;\r\n  Dec(FCount);\r\n  Changed;\r\nend;\r\n\r\nprocedure TStringList.Exchange(Index1, Index2: Integer);\r\n\r\nbegin\r\n  CheckIndex(Index1);\r\n  CheckIndex(Index2);\r\n  Changing;\r\n  ExchangeItemsInt(Index1,Index2);\r\n  changed;\r\nend;\r\n\r\nprocedure TStringList.SetCaseSensitive(b : boolean);\r\nbegin\r\n  if b=FCaseSensitive then\r\n    Exit;\r\n  FCaseSensitive:=b;\r\n  if FSortStyle=sslAuto then\r\n    begin\r\n    FForceSort:=True;\r\n    try\r\n      Sort;\r\n    finally\r\n      FForceSort:=False;\r\n    end;\r\n    end;\r\nend;\r\n\r\nprocedure TStringList.SetSortStyle(AValue: TStringsSortStyle);\r\nbegin\r\n  if FSortStyle=AValue then Exit;\r\n  if (AValue=sslAuto) then\r\n    Sort;\r\n  FSortStyle:=AValue;\r\nend;\r\n\r\nprocedure TStringList.CheckIndex(AIndex: Integer);\r\nbegin\r\n  If (AIndex<0) or (AIndex>=FCount) then\r\n    Error(SListIndexError,AIndex);\r\nend;\r\n\r\n\r\nfunction TStringList.DoCompareText(const s1, s2: string): PtrInt;\r\nbegin\r\n  if FCaseSensitive then\r\n    result:=CompareStr(s1,s2)\r\n  else\r\n    result:=CompareText(s1,s2);\r\nend;\r\n\r\n\r\nfunction TStringList.CompareStrings(const s1,s2 : string) : Integer;\r\nbegin\r\n  Result := DoCompareText(s1, s2);\r\nend;\r\n\r\n\r\nfunction TStringList.Find(const S: string; out Index: Integer): Boolean;\r\n\r\nvar\r\n  L, R, I: Integer;\r\n  CompareRes: PtrInt;\r\nbegin\r\n  Result := false;\r\n  Index:=-1;\r\n  if Not Sorted then\r\n    Raise EListError.Create(SErrFindNeedsSortedList);\r\n  // Use binary search.\r\n  L := 0;\r\n  R := Count - 1;\r\n  while (L<=R) do\r\n  begin\r\n    I := L + (R - L) div 2;\r\n    CompareRes := DoCompareText(S, Flist[I].FString);\r\n    if (CompareRes>0) then\r\n      L := I+1\r\n    else begin\r\n      R := I-1;\r\n      if (CompareRes=0) then begin\r\n         Result := true;\r\n         if (Duplicates<>dupAccept) then\r\n            L := I; // forces end of while loop\r\n      end;\r\n    end;\r\n  end;\r\n  Index := L;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.IndexOf(const S: string): Integer;\r\n\r\nbegin\r\n  If Not Sorted then\r\n    Result:=Inherited indexOf(S)\r\n  else\r\n    // faster using binary search...\r\n    If Not Find (S,Result) then\r\n      Result:=-1;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Insert(Index: Integer; const S: string);\r\n\r\nbegin\r\n  If SortStyle=sslAuto then\r\n    Error (SSortedListError,0)\r\n  else\r\n    begin\r\n    If (Index<0) or (Index>FCount) then\r\n      Error(SListIndexError,Index); // Cannot use CheckIndex, because there >= FCount...\r\n    InsertItem (Index,S);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TStringList.CustomSort(CompareFn: TStringListSortCompare);\r\n\r\nbegin\r\n  If (FForceSort or (Not (FSortStyle=sslAuto))) and (FCount>1) then\r\n    begin\r\n    Changing;\r\n    QuickSort(0,FCount-1, CompareFn);\r\n    Changed;\r\n    end;\r\nend;\r\n\r\nfunction StringListAnsiCompare(List: TStringList; Index1, Index: Integer): Integer;\r\n\r\nbegin\r\n  Result := List.DoCompareText(List.FList[Index1].FString,\r\n                               List.FList[Index].FString);\r\nend;\r\n\r\nprocedure TStringList.Sort;\r\n\r\nbegin\r\n  CustomSort(@StringListAnsiCompare);\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TCollectionItem                              *}\r\n{****************************************************************************}\r\n\r\n\r\nfunction TCollectionItem.GetIndex: Integer;\r\n\r\nbegin\r\n  if FCollection<>nil then\r\n    Result:=FCollection.FItems.IndexOf(Self)\r\n  else\r\n    Result:=-1;\r\nend;\r\n\r\n\r\n\r\nprocedure TCollectionItem.SetCollection(Value: TCollection);\r\n\r\nbegin\r\n  IF Value<>FCollection then\r\n    begin\r\n    If FCollection<>Nil then FCollection.RemoveItem(Self);\r\n    if Value<>Nil then Value.InsertItem(Self);\r\n    end;\r\nend;\r\n\r\n\r\n\r\nprocedure TCollectionItem.Changed(AllItems: Boolean);\r\n\r\nbegin\r\n If (FCollection<>Nil) and (FCollection.UpdateCount=0) then\r\n  begin\r\n  If AllItems then\r\n    FCollection.Update(Nil)\r\n  else\r\n    FCollection.Update(Self);\r\n  end;\r\nend;\r\n\r\n\r\n\r\nfunction TCollectionItem.GetNamePath: string;\r\n\r\nbegin\r\n  If FCollection<>Nil then\r\n    Result:=FCollection.GetNamePath+'['+IntToStr(Index)+']'\r\n  else\r\n    Result:=ClassName;\r\nend;\r\n\r\n\r\nfunction TCollectionItem.GetOwner: TPersistent;\r\n\r\nbegin\r\n  Result:=FCollection;\r\nend;\r\n\r\n\r\n\r\nfunction TCollectionItem.GetDisplayName: string;\r\n\r\nbegin\r\n  Result:=ClassName;\r\nend;\r\n\r\n\r\n\r\nprocedure TCollectionItem.SetIndex(Value: Integer);\r\n\r\nVar Temp : Longint;\r\n\r\nbegin\r\n  Temp:=GetIndex;\r\n  If (Temp>-1) and (Temp<>Value) then\r\n    begin\r\n    FCollection.FItems.Move(Temp,Value);\r\n    Changed(True);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TCollectionItem.SetDisplayName(const Value: string);\r\n\r\nbegin\r\n  Changed(False);\r\n  if Value='' then ;\r\nend;\r\n\r\n\r\n\r\nconstructor TCollectionItem.Create(ACollection: TCollection);\r\n\r\nbegin\r\n  Inherited Create;\r\n  SetCollection(ACollection);\r\nend;\r\n\r\n\r\n\r\ndestructor TCollectionItem.Destroy;\r\n\r\nbegin\r\n  SetCollection(Nil);\r\n  Inherited Destroy;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                          TCollectionEnumerator                           *}\r\n{****************************************************************************}\r\n\r\nconstructor TCollectionEnumerator.Create(ACollection: TCollection);\r\nbegin\r\n  inherited Create;\r\n  FCollection := ACollection;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TCollectionEnumerator.GetCurrent: TCollectionItem;\r\nbegin\r\n  Result := FCollection.Items[FPosition];\r\nend;\r\n\r\nfunction TCollectionEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FCollection.Count;\r\nend;\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TCollection                                  *}\r\n{****************************************************************************}\r\n\r\nfunction TCollection.Owner: TPersistent;\r\nbegin\r\n  result:=getowner;\r\nend;\r\n\r\n\r\nfunction TCollection.GetCount: Integer;\r\n\r\nbegin\r\n  Result:=FItems.Count;\r\nend;\r\n\r\n\r\nProcedure TCollection.SetPropName;\r\n\r\n{\r\nVar\r\n  TheOwner : TPersistent;\r\n  PropList : PPropList;\r\n  I, PropCount : Integer;\r\n}\r\nbegin\r\n//  FPropName:='';\r\n{\r\n  TheOwner:=GetOwner;\r\n  // TODO: This needs to wait till Mattias finishes typeinfo.\r\n  // It's normally only used in the designer so should not be a problem currently.\r\n  if (TheOwner=Nil) Or (TheOwner.Classinfo=Nil) Then Exit;\r\n  // get information from the owner RTTI\r\n  PropCount:=GetPropList(TheOwner, PropList);\r\n  Try\r\n    For I:=0 To PropCount-1 Do\r\n      If (PropList^[i]^.PropType^.Kind=tkClass) And\r\n         (GetObjectProp(TheOwner, PropList^[i], ClassType)=Self) Then\r\n        Begin\r\n          FPropName:=PropList^[i]^.Name;\r\n          Exit;\r\n        End;\r\n  Finally\r\n    FreeMem(PropList);\r\n  End;\r\n}\r\nend;\r\n\r\n\r\nfunction TCollection.GetPropName: string;\r\n\r\n{Var\r\n  TheOwner : TPersistent;}\r\n\r\nbegin\r\n  Result:=FPropNAme;\r\n//  TheOwner:=GetOwner;\r\n//  If (Result<>'') or (TheOwner=Nil) Or (TheOwner.Classinfo=Nil) then exit;\r\n  SetPropName;\r\n  Result:=FPropName;\r\nend;\r\n\r\n\r\nprocedure TCollection.InsertItem(Item: TCollectionItem);\r\nbegin\r\n  If Not(Item Is FitemClass) then\r\n    exit;\r\n  FItems.add(Item);\r\n  Item.FCollection:=Self;\r\n  Item.FID:=FNextID;\r\n  inc(FNextID);\r\n  SetItemName(Item);\r\n  Notify(Item,cnAdded);\r\n  Changed;\r\nend;\r\n\r\n\r\nprocedure TCollection.RemoveItem(Item: TCollectionItem);\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Notify(Item,cnExtracting);\r\n  I:=FItems.IndexOfItem(Item,fromEnd);\r\n  If (I<>-1) then\r\n    FItems.Delete(I);\r\n  Item.FCollection:=Nil;\r\n  Changed;\r\nend;\r\n\r\n\r\nfunction TCollection.GetAttrCount: Integer;\r\nbegin\r\n  Result:=0;\r\nend;\r\n\r\n\r\nfunction TCollection.GetAttr(Index: Integer): string;\r\nbegin\r\n  Result:='';\r\n  if Index=0 then ;\r\nend;\r\n\r\n\r\nfunction TCollection.GetItemAttr(Index, ItemIndex: Integer): string;\r\nbegin\r\n  Result:=TCollectionItem(FItems.Items[ItemIndex]).DisplayName;\r\n  if Index=0 then ;\r\nend;\r\n\r\n\r\nfunction TCollection.GetEnumerator: TCollectionEnumerator;\r\nbegin\r\n  Result := TCollectionEnumerator.Create(Self);\r\nend;\r\n\r\n\r\nfunction TCollection.GetNamePath: string;\r\nvar o : TPersistent;\r\nbegin\r\n  o:=getowner;\r\n  if assigned(o) and (propname<>'') then\r\n     result:=o.getnamepath+'.'+propname\r\n   else\r\n     result:=classname;\r\nend;\r\n\r\n\r\nprocedure TCollection.Changed;\r\nbegin\r\n  if FUpdateCount=0 then\r\n    Update(Nil);\r\nend;\r\n\r\n\r\nfunction TCollection.GetItem(Index: Integer): TCollectionItem;\r\nbegin\r\n  Result:=TCollectionItem(FItems.Items[Index]);\r\nend;\r\n\r\n\r\nprocedure TCollection.SetItem(Index: Integer; Value: TCollectionItem);\r\nbegin\r\n  TCollectionItem(FItems.items[Index]).Assign(Value);\r\nend;\r\n\r\n\r\nprocedure TCollection.SetItemName(Item: TCollectionItem);\r\nbegin\r\n  if Item=nil then ;\r\nend;\r\n\r\nprocedure TCollection.Update(Item: TCollectionItem);\r\nbegin\r\n  if Item=nil then ;\r\nend;\r\n\r\n\r\nconstructor TCollection.Create(AItemClass: TCollectionItemClass);\r\nbegin\r\n  inherited create;\r\n  FItemClass:=AItemClass;\r\n  FItems:=TFpList.Create;\r\nend;\r\n\r\n\r\ndestructor TCollection.Destroy;\r\nbegin\r\n  FUpdateCount:=1; // Prevent OnChange\r\n  try\r\n    DoClear;\r\n  Finally\r\n    FUpdateCount:=0;\r\n  end;\r\n  if assigned(FItems) then\r\n    FItems.Destroy;\r\n  Inherited Destroy;\r\nend;\r\n\r\n\r\nfunction TCollection.Add: TCollectionItem;\r\nbegin\r\n  Result:=FItemClass.Create(Self);\r\nend;\r\n\r\n\r\nprocedure TCollection.Assign(Source: TPersistent);\r\nVar I : Longint;\r\nbegin\r\n  If Source is TCollection then\r\n    begin\r\n    Clear;\r\n    For I:=0 To TCollection(Source).Count-1 do\r\n     Add.Assign(TCollection(Source).Items[I]);\r\n    exit;\r\n    end\r\n  else\r\n    Inherited Assign(Source);\r\nend;\r\n\r\n\r\nprocedure TCollection.BeginUpdate;\r\nbegin\r\n  inc(FUpdateCount);\r\nend;\r\n\r\n\r\nprocedure TCollection.Clear;\r\nbegin\r\n  if FItems.Count=0 then\r\n    exit; // Prevent Changed\r\n  BeginUpdate;\r\n  try\r\n    DoClear;\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TCollection.DoClear;\r\nvar\r\n  Item: TCollectionItem;\r\nbegin\r\n  While FItems.Count>0 do\r\n    begin\r\n    Item:=TCollectionItem(FItems.Last);\r\n    if Assigned(Item) then\r\n      Item.Destroy;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TCollection.EndUpdate;\r\nbegin\r\n  if FUpdateCount>0 then\r\n    dec(FUpdateCount);\r\n  if FUpdateCount=0 then\r\n    Changed;\r\nend;\r\n\r\n\r\nfunction TCollection.FindItemID(ID: Integer): TCollectionItem;\r\nVar\r\n          I : Longint;\r\nbegin\r\n  For I:=0 to Fitems.Count-1 do\r\n   begin\r\n     Result:=TCollectionItem(FItems.items[I]);\r\n     If Result.Id=Id then\r\n       exit;\r\n   end;\r\n  Result:=Nil;\r\nend;\r\n\r\n\r\nprocedure TCollection.Delete(Index: Integer);\r\nVar\r\n  Item : TCollectionItem;\r\nbegin\r\n  Item:=TCollectionItem(FItems[Index]);\r\n  Notify(Item,cnDeleting);\r\n  If assigned(Item) then\r\n    Item.Destroy;\r\nend;\r\n\r\n\r\nfunction TCollection.Insert(Index: Integer): TCollectionItem;\r\nbegin\r\n  Result:=Add;\r\n  Result.Index:=Index;\r\nend;\r\n\r\n\r\nprocedure TCollection.Notify(Item: TCollectionItem;Action: TCollectionNotification);\r\nbegin\r\n  if Item=nil then ;\r\n  if Action=cnAdded then ;\r\nend;\r\n\r\nprocedure TCollection.Sort(Const Compare : TCollectionSortCompare);\r\n\r\nbegin\r\n  BeginUpdate;\r\n  try\r\n    FItems.Sort(TListSortCompare(Compare));\r\n  Finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TCollection.Exchange(Const Index1, index2: integer);\r\n\r\nbegin\r\n  FItems.Exchange(Index1,Index2);\r\nend;\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TOwnedCollection                             *}\r\n{****************************************************************************}\r\n\r\n\r\n\r\nConstructor TOwnedCollection.Create(AOwner: TPersistent; AItemClass: TCollectionItemClass);\r\n\r\nBegin\r\n  FOwner := AOwner;\r\n  inherited Create(AItemClass);\r\nend;\r\n\r\nFunction TOwnedCollection.GetOwner: TPersistent;\r\n\r\nbegin\r\n  Result:=FOwner;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TComponent                                   *}\r\n{****************************************************************************}\r\n\r\n\r\nfunction TComponent.GetComponent(AIndex: Integer): TComponent;\r\n\r\nbegin\r\n  If not assigned(FComponents) then\r\n    Result:=Nil\r\n  else\r\n    Result:=TComponent(FComponents.Items[Aindex]);\r\nend;\r\n\r\nfunction TComponent.GetComponentCount: Integer;\r\n\r\nbegin\r\n  If not assigned(FComponents) then\r\n    result:=0\r\n  else\r\n    Result:=FComponents.Count;\r\nend;\r\n\r\n\r\nfunction TComponent.GetComponentIndex: Integer;\r\n\r\nbegin\r\n  If Assigned(FOwner) and Assigned(FOwner.FComponents) then\r\n    Result:=FOWner.FComponents.IndexOf(Self)\r\n  else\r\n    Result:=-1;\r\nend;\r\n\r\n\r\nprocedure TComponent.Insert(AComponent: TComponent);\r\n\r\nbegin\r\n  If not assigned(FComponents) then\r\n    FComponents:=TFpList.Create;\r\n  FComponents.Add(AComponent);\r\n  AComponent.FOwner:=Self;\r\nend;\r\n\r\n\r\nprocedure TComponent.Remove(AComponent: TComponent);\r\n\r\nbegin\r\n  AComponent.FOwner:=Nil;\r\n  If assigned(FCOmponents) then\r\n    begin\r\n    FComponents.Remove(AComponent);\r\n    IF FComponents.Count=0 then\r\n      begin\r\n      FComponents.Destroy;\r\n      FComponents:=Nil;\r\n      end;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.RemoveNotification(AComponent: TComponent);\r\n\r\nbegin\r\n  if FFreeNotifies<>nil then\r\n    begin\r\n    FFreeNotifies.Remove(AComponent);\r\n    if FFreeNotifies.Count=0 then\r\n      begin\r\n      FFreeNotifies.Destroy;\r\n      FFreeNotifies:=nil;\r\n      Exclude(FComponentState,csFreeNotification);\r\n      end;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.SetComponentIndex(Value: Integer);\r\n\r\nVar Temp,Count : longint;\r\n\r\nbegin\r\n  If Not assigned(Fowner) then exit;\r\n  Temp:=getcomponentindex;\r\n  If temp<0 then exit;\r\n  If value<0 then value:=0;\r\n  Count:=Fowner.FComponents.Count;\r\n  If Value>=Count then value:=count-1;\r\n  If Value<>Temp then\r\n    begin\r\n    FOWner.FComponents.Delete(Temp);\r\n    FOwner.FComponents.Insert(Value,Self);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.BeginUpdate;\r\nbegin\r\n\r\nend;\r\n\r\nProcedure TComponent.ChangeName(const NewName: TComponentName);\r\n\r\nbegin\r\n  FName:=NewName;\r\nend;\r\n\r\n\r\nprocedure TComponent.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\n\r\nbegin\r\n  // Does nothing.\r\n  if Proc=nil then ;\r\n  if Root=nil then ;\r\nend;\r\n\r\n\r\nfunction TComponent.GetChildOwner: TComponent;\r\n\r\nbegin\r\n Result:=Nil;\r\nend;\r\n\r\n\r\nfunction TComponent.GetChildParent: TComponent;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\n\r\nfunction TComponent.GetNamePath: string;\r\n\r\nbegin\r\n  Result:=FName;\r\nend;\r\n\r\n\r\nfunction TComponent.GetOwner: TPersistent;\r\n\r\nbegin\r\n  Result:=FOwner;\r\nend;\r\n\r\n\r\nfunction TComponent.GetLeft: Integer;\r\nbegin\r\n  Result := FLeft;\r\nend;\r\n\r\nfunction TComponent.GetTop: Integer;\r\nbegin\r\n  Result := FTop;\r\nend;\r\n\r\nProcedure TComponent.Loaded;\r\n\r\nbegin\r\n  Exclude(FComponentState,csLoading);\r\nend;\r\n\r\nProcedure TComponent.Loading;\r\n\r\nbegin\r\n  Include(FComponentState,csLoading);\r\nend;\r\n\r\n\r\nprocedure TComponent.Notification(AComponent: TComponent; Operation: TOperation);\r\n\r\nVar\r\n  C : Longint;\r\n\r\nbegin\r\n  If (Operation=opRemove) then\r\n    RemoveFreeNotification(AComponent);\r\n  If Not assigned(FComponents) then\r\n    exit;\r\n  C:=FComponents.Count-1;\r\n  While (C>=0) do\r\n    begin\r\n    TComponent(FComponents.Items[C]).Notification(AComponent,Operation);\r\n    Dec(C);\r\n    if C>=FComponents.Count then\r\n      C:=FComponents.Count-1;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.PaletteCreated;\r\nbegin\r\nend;\r\n\r\n\r\n\r\nProcedure TComponent.SetAncestor(Value: Boolean);\r\n\r\nVar Runner : Longint;\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csAncestor)\r\n  else\r\n    Exclude(FCOmponentState,csAncestor);\r\n  if Assigned(FComponents) then\r\n    For Runner:=0 To FComponents.Count-1 do\r\n      TComponent(FComponents.Items[Runner]).SetAncestor(Value);\r\nend;\r\n\r\n\r\nprocedure TComponent.SetDesigning(Value: Boolean; SetChildren: Boolean);\r\n\r\nVar Runner : Longint;\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csDesigning)\r\n  else\r\n    Exclude(FComponentState,csDesigning);\r\n  if Assigned(FComponents) and SetChildren then\r\n    For Runner:=0 To FComponents.Count - 1 do\r\n      TComponent(FComponents.items[Runner]).SetDesigning(Value);\r\nend;\r\n\r\nprocedure TComponent.SetDesignInstance(Value: Boolean);\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csDesignInstance)\r\n  else\r\n    Exclude(FComponentState,csDesignInstance);\r\nend;\r\n\r\nprocedure TComponent.SetInline(Value: Boolean);\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csInline)\r\n  else\r\n    Exclude(FComponentState,csInline);\r\nend;\r\n\r\n\r\nprocedure TComponent.SetName(const NewName: TComponentName);\r\n\r\nbegin\r\n  If FName=NewName then exit;\r\n  If (NewName<>'') and not IsValidIdent(NewName) then\r\n    Raise EComponentError.CreateFmt(SInvalidName,[NewName]);\r\n  If Assigned(FOwner) Then\r\n    FOwner.ValidateRename(Self,FName,NewName)\r\n  else\r\n    ValidateRename(Nil,FName,NewName);\r\n  ChangeName(NewName);\r\nend;\r\n\r\n\r\nprocedure TComponent.SetChildOrder(Child: TComponent; Order: Integer);\r\n\r\nbegin\r\n  // does nothing\r\n  if Child=nil then ;\r\n  if Order=0 then ;\r\nend;\r\n\r\n\r\nprocedure TComponent.SetLeft(AValue: Integer);\r\nbegin\r\n  FLeft := AValue;\r\nend;\r\n\r\nprocedure TComponent.SetTop(AValue: Integer);\r\nbegin\r\n  FTop := AValue;\r\nend;\r\n\r\nProcedure TComponent.SetParentComponent(Value: TComponent);\r\n\r\nbegin\r\n  // Does nothing\r\n  if Value=nil then ;\r\nend;\r\n\r\n\r\nprocedure TComponent.Updating;\r\n\r\nbegin\r\n  Include (FComponentState,csUpdating);\r\nend;\r\n\r\n\r\nprocedure TComponent.Updated;\r\n\r\nbegin\r\n  Exclude(FComponentState,csUpdating);\r\nend;\r\n\r\n\r\nprocedure TComponent.ValidateRename(AComponent: TComponent; const CurName, NewName: string);\r\n\r\nbegin\r\n//!! This contradicts the Delphi manual.\r\n  If (AComponent<>Nil) and (CompareText(CurName,NewName)<>0) and (AComponent.Owner = Self) and\r\n     (FindComponent(NewName)<>Nil) then\r\n      raise EComponentError.Createfmt(SDuplicateName,[newname]);\r\n  If (csDesigning in FComponentState) and (FOwner<>Nil) then\r\n    FOwner.ValidateRename(AComponent,Curname,Newname);\r\nend;\r\n\r\n\r\nprocedure TComponent.ValidateContainer(AComponent: TComponent);\r\n\r\nbegin\r\n  AComponent.ValidateInsert(Self);\r\nend;\r\n\r\n\r\nprocedure TComponent.ValidateInsert(AComponent: TComponent);\r\n\r\nbegin\r\n  // Does nothing.\r\n  if AComponent=nil then ;\r\nend;\r\n\r\n\r\nconstructor TComponent.Create(AOwner: TComponent);\r\nbegin\r\n  FComponentStyle:=[csInheritable];\r\n  If Assigned(AOwner) then AOwner.InsertComponent(Self);\r\n\r\n  //SetDesigning(true,true);\r\nend;\r\n\r\n\r\ndestructor TComponent.Destroy;\r\n\r\nVar\r\n  I : Integer;\r\n  C : TComponent;\r\n\r\nbegin\r\n  Destroying;\r\n  If Assigned(FFreeNotifies) then\r\n    begin\r\n    I:=FFreeNotifies.Count-1;\r\n    While (I>=0) do\r\n      begin\r\n      C:=TComponent(FFreeNotifies.Items[I]);\r\n      // Delete, so one component is not notified twice, if it is owned.\r\n      FFreeNotifies.Delete(I);\r\n      C.Notification (self,opRemove);\r\n      If (FFreeNotifies=Nil) then\r\n        I:=0\r\n      else if (I>FFreeNotifies.Count) then\r\n        I:=FFreeNotifies.Count;\r\n      dec(i);\r\n      end;\r\n    FreeAndNil(FFreeNotifies);\r\n    end;\r\n  DestroyComponents;\r\n  If FOwner<>Nil Then FOwner.RemoveComponent(Self);\r\n  inherited destroy;\r\nend;\r\n\r\n\r\nprocedure TComponent.AfterLoadDFMValues;\r\nbegin\r\n  EndUpdate;\r\nend;\r\n\r\nProcedure TComponent.BeforeDestruction;\r\nbegin\r\n  if not(csDestroying in FComponentstate) then\r\n    Destroying;\r\nend;\r\n\r\nprocedure TComponent.BeforeLoadDFMValues;\r\nbegin\r\n  BeginUpdate;\r\nend;\r\n\r\nprocedure TComponent.DestroyComponents;\r\n\r\nVar acomponent: TComponent;\r\n\r\nbegin\r\n  While assigned(FComponents) do\r\n    begin\r\n    aComponent:=TComponent(FComponents.Last);\r\n    Remove(aComponent);\r\n    Acomponent.Destroy;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.Destroying;\r\n\r\nVar Runner : longint;\r\n\r\nbegin\r\n  If csDestroying in FComponentstate Then Exit;\r\n  include (FComponentState,csDestroying);\r\n  If Assigned(FComponents) then\r\n    for Runner:=0 to FComponents.Count-1 do\r\n      TComponent(FComponents.Items[Runner]).Destroying;\r\nend;\r\n\r\n\r\nprocedure TComponent.EndUpdate;\r\nbegin\r\n\r\nend;\r\n\r\n\r\nfunction TComponent.FindComponent(const AName: string): TComponent;\r\n\r\nVar I : longint;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  If (AName='') or Not assigned(FComponents) then exit;\r\n  For i:=0 to FComponents.Count-1 do\r\n    if (CompareText(TComponent(FComponents[I]).Name,AName)=0) then\r\n      begin\r\n      Result:=TComponent(FComponents.Items[I]);\r\n      exit;\r\n      end;\r\nend;\r\n\r\n\r\nprocedure TComponent.FreeNotification(AComponent: TComponent);\r\n\r\nbegin\r\n  If (Owner<>Nil) and (AComponent=Owner) then exit;\r\n  If not (Assigned(FFreeNotifies)) then\r\n    FFreeNotifies:=TFpList.Create;\r\n  If FFreeNotifies.IndexOf(AComponent)=-1 then\r\n    begin\r\n    FFreeNotifies.Add(AComponent);\r\n    AComponent.FreeNotification (self);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.RemoveFreeNotification(AComponent: TComponent);\r\nbegin\r\n  RemoveNotification(AComponent);\r\n  AComponent.RemoveNotification (self);\r\nend;\r\n\r\n\r\nfunction TComponent.GetParentComponent: TComponent;\r\n\r\nbegin\r\n  Result:=Nil;\r\nend;\r\n\r\n\r\nfunction TComponent.HasParent: Boolean;\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\n\r\nprocedure TComponent.InsertComponent(AComponent: TComponent);\r\n\r\nbegin\r\n  AComponent.ValidateContainer(Self);\r\n  ValidateRename(AComponent,'',AComponent.FName);\r\n  Insert(AComponent);\r\n  If csDesigning in FComponentState then\r\n    AComponent.SetDesigning(true);\r\n  Notification(AComponent,opInsert);\r\nend;\r\n\r\n\r\nprocedure TComponent.RemoveComponent(AComponent: TComponent);\r\n\r\nbegin\r\n  Notification(AComponent,opRemove);\r\n  Remove(AComponent);\r\n  Acomponent.Setdesigning(False);\r\n  ValidateRename(AComponent,AComponent.FName,'');\r\nend;\r\n\r\nprocedure TComponent.SetSubComponent(ASubComponent: Boolean);\r\nbegin\r\n  if ASubComponent then\r\n    Include(FComponentStyle, csSubComponent)\r\n  else\r\n    Exclude(FComponentStyle, csSubComponent);\r\nend;\r\n\r\nfunction TComponent.GetEnumerator: TComponentEnumerator;\r\nbegin\r\n  Result:=TComponentEnumerator.Create(Self);\r\nend;\r\n\r\nprocedure TComponent.SetEvent(const AInstance: TPersistent; const ALookupRoot: TComponent; const APropName, AMethodName: string);\r\nvar\r\n  lMethod: TMethod;\r\nbegin\r\n  lMethod.Code := ALookupRoot.MethodAddress(AMethodName);\r\n  if lMethod.Code = nil then\r\n    raise Exception.Create(ALookupRoot.ClassName +' has no published method \"'+ AMethodName + '\"');\r\n   lMethod.Data := ALookupRoot;\r\n  SetMethodProp(AInstance, APropName, lMethod);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n  Global routines\r\n  ---------------------------------------------------------------------}\r\n(*\r\nresourcestring\r\n  SStreamInvalidSeek = 'Seek is not implemented for class %s';\r\n  SStreamNoReading = 'Stream reading is not implemented for class %s';\r\n  SStreamNoWriting = 'Stream writing is not implemented for class %s';\r\n  SReadError = 'Could not read data from stream';\r\n  SWriteError = 'Could not write data to stream';\r\n  SMemoryStreamError = 'Could not allocate memory';\r\n  SerrInvalidStreamSize = 'Invalid Stream size';\r\n\r\n\r\nprocedure TStream.ReadNotImplemented;\r\nbegin\r\n  raise EStreamError.CreateFmt(SStreamNoReading, [ClassName]);\r\nend;\r\n\r\nprocedure TStream.WriteNotImplemented;\r\nbegin\r\n  raise EStreamError.CreateFmt(SStreamNoWriting, [ClassName]);\r\nend;\r\n\r\nfunction TStream.Read(var Buffer: TBytes; Count: Longint): Longint;\r\nbegin\r\n  Result:=Read(Buffer,0,Count);\r\nend;\r\n\r\nfunction TStream.Write(const Buffer: TBytes; Count: Longint): Longint;\r\nbegin\r\n  Result:=Self.Write(Buffer,0,Count);\r\nend;\r\n\r\nfunction TStream.GetPosition: NativeInt;\r\n\r\nbegin\r\n   Result:=Seek(0,soCurrent);\r\nend;\r\n\r\nprocedure TStream.SetPosition(const Pos: NativeInt);\r\n\r\nbegin\r\n   Seek(pos,soBeginning);\r\nend;\r\n\r\nprocedure TStream.SetSize64(const NewSize: NativeInt);\r\n\r\nbegin\r\n  // Required because can't use overloaded functions in properties\r\n  SetSize(NewSize);\r\nend;\r\n\r\nfunction TStream.GetSize: NativeInt;\r\n\r\nvar\r\n   p : NativeInt;\r\n\r\nbegin\r\n   p:=Seek(0,soCurrent);\r\n   GetSize:=Seek(0,soEnd);\r\n   Seek(p,soBeginning);\r\nend;\r\n\r\nprocedure TStream.SetSize(const NewSize: NativeInt);\r\n\r\nbegin\r\n  if NewSize<0 then\r\n    Raise EStreamError.Create(SerrInvalidStreamSize);\r\nend;\r\n\r\nprocedure TStream.Discard(const Count: NativeInt);\r\n\r\nconst\r\n  CSmallSize      =255;\r\n  CLargeMaxBuffer =32*1024; // 32 KiB\r\n\r\nvar\r\n  Buffer: TBytes;\r\n\r\nbegin\r\n  if Count=0 then\r\n    Exit;\r\n  if (Count<=CSmallSize) then\r\n    begin\r\n    SetLength(Buffer,CSmallSize);\r\n    ReadBuffer(Buffer,Count)\r\n    end\r\n  else\r\n    DiscardLarge(Count,CLargeMaxBuffer);\r\nend;\r\n\r\nprocedure TStream.DiscardLarge(Count: NativeInt; const MaxBufferSize: Longint);\r\n\r\nvar\r\n  Buffer: TBytes;\r\n\r\nbegin\r\n  if Count=0 then\r\n     Exit;\r\n  if Count>MaxBufferSize then\r\n    SetLength(Buffer,MaxBufferSize)\r\n  else\r\n    SetLength(Buffer,Count);\r\n  while (Count>=Length(Buffer)) do\r\n    begin\r\n    ReadBuffer(Buffer,Length(Buffer));\r\n    Dec(Count,Length(Buffer));\r\n    end;\r\n  if Count>0 then\r\n    ReadBuffer(Buffer,Count);\r\nend;\r\n\r\nprocedure TStream.InvalidSeek;\r\n\r\nbegin\r\n  raise EStreamError.CreateFmt(SStreamInvalidSeek, [ClassName]);\r\nend;\r\n\r\nprocedure TStream.FakeSeekForward(Offset: NativeInt;  const Origin: TSeekOrigin; const Pos: NativeInt);\r\n\r\nbegin\r\n  if Origin=soBeginning then\r\n     Dec(Offset,Pos);\r\n  if (Offset<0) or (Origin=soEnd) then\r\n    InvalidSeek;\r\n  if Offset>0 then\r\n    Discard(Offset);\r\n end;\r\n\r\nfunction TStream.ReadData({var} Buffer: TBytes; Count: NativeInt): NativeInt;\r\nbegin\r\n Result:=Read(Buffer,0,Count);\r\nend;\r\n\r\n\r\nfunction TStream.ReadMaxSizeData(Buffer : TBytes; aSize,aCount : NativeInt) : NativeInt;\r\n\r\nVar\r\n  CP : NativeInt;\r\n\r\nbegin\r\n  if aCount<=aSize then\r\n    Result:=read(Buffer,aCount)\r\n  else\r\n    begin\r\n    Result:=Read(Buffer,aSize);\r\n    CP:=Position;\r\n    Result:=Result+Seek(aCount-aSize,soCurrent)-CP;\r\n    end\r\nend;\r\n\r\nfunction TStream.WriteMaxSizeData(const Buffer : TBytes; aSize,aCount : NativeInt) : NativeInt;\r\nVar\r\n  CP : NativeInt;\r\n\r\nbegin\r\n  if aCount<=aSize then\r\n    Result:=Self.Write(Buffer,aCount)\r\n  else\r\n    begin\r\n    Result:=Self.Write(Buffer,aSize);\r\n    CP:=Position;\r\n    Result:=Result+Seek(aCount-aSize,soCurrent)-CP;\r\n    end\r\nend;\r\n\r\nprocedure TStream.WriteExactSizeData(const Buffer : TBytes; aSize, aCount: NativeInt);\r\nbegin\r\n  // Embarcadero docs mentions no exception. Does not seem very logical\r\n  WriteMaxSizeData(Buffer,aSize,ACount);\r\nend;\r\n\r\nprocedure TStream.ReadExactSizeData(Buffer : TBytes; aSize, aCount: NativeInt);\r\nbegin\r\n  if ReadMaxSizeData(Buffer,aSize,ACount)<>aCount then\r\n     Raise EReadError.Create(SReadError);\r\nend;\r\n\r\n\r\nfunction TStream.ReadData(var Buffer: Boolean): NativeInt;\r\nvar\r\n  B : Byte;\r\n\r\nbegin\r\n  Result:=ReadData(B,1);\r\n  if Result=1 then\r\n    Buffer:=B<>0;\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Boolean; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\n\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,1,Count);\r\n  if Result>0 then\r\n    Buffer:=B[0]<>0\r\nend;\r\n\r\n\r\nfunction TStream.ReadData(var Buffer: WideChar): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: WideChar; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  W : Word;\r\n\r\nbegin\r\n  Result:=ReadData(W,Count);\r\n  if Result=2 then\r\n    Buffer:=WideChar(W);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int8): NativeInt;\r\nbegin\r\n  Result := ReadData(Buffer,1);\r\nend;\r\n\r\nFunction TStream.MakeInt(B : TBytes; aSize : Integer; Signed : Boolean) : NativeInt;\r\n\r\nVar\r\n  Mem : TJSArrayBuffer;\r\n  A : TJSUInt8Array;\r\n  D : TJSDataView;\r\n  isLittle : Boolean;\r\n\r\nbegin\r\n  IsLittle:=(Endian=TEndian.Little);\r\n  Mem:=TJSArrayBuffer.New(Length(B));\r\n  A:=TJSUInt8Array.new(Mem);\r\n  A._set(B);\r\n  D:=TJSDataView.New(Mem);\r\n  if Signed then\r\n    case aSize of\r\n      1 : Result:=D.getInt8(0);\r\n      2 : Result:=D.getInt16(0,IsLittle);\r\n      4 : Result:=D.getInt32(0,IsLittle);\r\n      // Todo : fix sign\r\n      8 : Result:=Round(D.getFloat64(0,IsLittle));\r\n    end\r\n  else\r\n    case aSize of\r\n      1 : Result:=D.getUInt8(0);\r\n      2 : Result:=D.getUInt16(0,IsLittle);\r\n      4 : Result:=D.getUInt32(0,IsLittle);\r\n      8 : Result:=Round(D.getFloat64(0,IsLittle));\r\n    end\r\nend;\r\n\r\nfunction TStream.MakeBytes(B: NativeInt; aSize: Integer; Signed: Boolean): TBytes;\r\n\r\n\r\nVar\r\n  Mem : TJSArrayBuffer;\r\n  A : TJSUInt8Array;\r\n  D : TJSDataView;\r\n  isLittle : Boolean;\r\n\r\nbegin\r\n  IsLittle:=(Endian=TEndian.Little);\r\n  Mem:=TJSArrayBuffer.New(aSize);\r\n  D:=TJSDataView.New(Mem);\r\n  if Signed then\r\n    case aSize of\r\n      1 : D.setInt8(0,B);\r\n      2 : D.setInt16(0,B,IsLittle);\r\n      4 : D.setInt32(0,B,IsLittle);\r\n      8 : D.setFloat64(0,B,IsLittle);\r\n    end\r\n  else\r\n    case aSize of\r\n      1 : D.SetUInt8(0,B);\r\n      2 : D.SetUInt16(0,B,IsLittle);\r\n      4 : D.SetUInt32(0,B,IsLittle);\r\n      8 : D.setFloat64(0,B,IsLittle);\r\n    end;\r\n  SetLength(Result,aSize);\r\n  A:=TJSUInt8Array.new(Mem);\r\n  Result:=TMemoryStream.MemoryToBytes(A);\r\nend;\r\n\r\n\r\nfunction TStream.ReadData(var Buffer: Byte; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,1,Count);\r\n  if Result>=1 then\r\n    Buffer:=MakeInt(B,1,True);\r\nend;\r\n\r\n//function TStream.ReadData(var Buffer: UInt8): NativeInt;\r\n//begin\r\n//  Result:=ReadData(Buffer,1);\r\n//end;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt8; Count: NativeInt): NativeInt;\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,1,Count);\r\n  if Result>=1 then\r\n    Buffer:=MakeInt(B,1,False);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int16): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int16; Count: NativeInt): NativeInt;\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,2,Count);\r\n  if Result>=2 then\r\n    Buffer:=MakeInt(B,2,True);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt16): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt16; Count: NativeInt): NativeInt;\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,2,Count);\r\n  if Result>=2 then\r\n    Buffer:=MakeInt(B,2,False);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int32): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,4);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Int32; Count: NativeInt): NativeInt;\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,4,Count);\r\n  if Result>=4 then\r\n    Buffer:=MakeInt(B,4,True);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt32): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,4);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: UInt32; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,4,Count);\r\n  if Result>=4 then\r\n    Buffer:=MakeInt(B,4,False);\r\nend;\r\n\r\n\r\nfunction TStream.ReadData(var Buffer: NativeInt): NativeInt;\r\n\r\nbegin\r\n  Result:=ReadData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: NativeInt; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\n\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,8,8);\r\n  if Result>=8 then\r\n    Buffer:=MakeInt(B,8,True);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: NativeLargeUInt): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: NativeLargeUInt; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\n  B1 : Integer;\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,4,4);\r\n  if Result>=4 then\r\n    begin\r\n    B1:=MakeInt(B,4,False);\r\n    Result:=Result+ReadMaxSizeData(B,4,4);\r\n    Buffer:=MakeInt(B,4,False);\r\n    Buffer:=(Buffer shl 32) or B1;\r\n    end;\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Double): NativeInt;\r\nbegin\r\n  Result:=ReadData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.ReadData(var Buffer: Double; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : TBytes;\r\n  Mem : TJSArrayBuffer;\r\n  A : TJSUInt8Array;\r\n  D : TJSDataView;\r\n\r\nbegin\r\n  SetLength(B,Count);\r\n  Result:=ReadMaxSizeData(B,8,Count);\r\n  if Result>=8 then\r\n    begin\r\n    Mem:=TJSArrayBuffer.New(8);\r\n    A:=TJSUInt8Array.new(Mem);\r\n    A._set(B);\r\n    D:=TJSDataView.New(Mem);\r\n    Buffer:=D.getFloat64(0);\r\n    end;\r\nend;\r\n\r\nprocedure TStream.ReadBuffer(var Buffer: TBytes; Count: NativeInt);\r\nbegin\r\n  ReadBuffer(Buffer,0,Count);\r\nend;\r\n\r\nprocedure TStream.ReadBuffer(var Buffer: TBytes; Offset, Count: NativeInt);\r\nbegin\r\n  if Read(Buffer,OffSet,Count)<>Count then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Boolean);\r\nbegin\r\n  ReadBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Boolean; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: WideChar);\r\nbegin\r\n  ReadBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: WideChar; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int8);\r\nbegin\r\n  ReadBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int8; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt8);\r\nbegin\r\n  ReadBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt8; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int16);\r\nbegin\r\n  ReadBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int16; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt16);\r\nbegin\r\n  ReadBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt16; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int32);\r\nbegin\r\n  ReadBufferData(Buffer,4);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Int32; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt32);\r\nbegin\r\n  ReadBufferData(Buffer,4);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: UInt32; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: NativeLargeInt);\r\nbegin\r\n  ReadBufferData(Buffer,8)\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: NativeLargeInt; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: NativeLargeUInt);\r\nbegin\r\n  ReadBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: NativeLargeUInt; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Double);\r\nbegin\r\n  ReadBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.ReadBufferData(var Buffer: Double; Count: NativeInt);\r\nbegin\r\n  if (ReadData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SReadError);\r\nend;\r\n\r\nprocedure TStream.WriteBuffer(const Buffer: TBytes; Count: NativeInt);\r\nbegin\r\n  WriteBuffer(Buffer,0,Count);\r\nend;\r\n\r\nprocedure TStream.WriteBuffer(const Buffer: TBytes; Offset, Count: NativeInt);\r\nbegin\r\n  if Self.Write(Buffer,Offset,Count)<>Count then\r\n     Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: TBytes; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=Self.Write(Buffer, 0, Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Boolean): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,1);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Boolean; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  B : Int8;\r\n\r\nbegin\r\n  B:=Ord(Buffer);\r\n  Result:=WriteData(B,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: WideChar): NativeInt;\r\n\r\nbegin\r\n  Result:=WriteData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: WideChar; Count: NativeInt): NativeInt;\r\nVar\r\n  U : UInt16;\r\nbegin\r\n  U:=Ord(Buffer);\r\n  Result:=WriteData(U,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int8): NativeInt;\r\n\r\nbegin\r\n  Result:=WriteData(Buffer,1);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int8; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,1,True),1,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt8): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,1);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt8; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,1,False),1,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int16): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int16; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,2,True),2,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt16): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,2);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt16; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,2,True),2,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int32): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,4);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Int32; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,4,True),4,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt32): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,4);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: UInt32; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,4,False),4,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: NativeLargeInt): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: NativeLargeInt; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,8,True),8,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: NativeLargeUInt): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: NativeLargeUInt; Count: NativeInt): NativeInt;\r\nbegin\r\n  Result:=WriteMaxSizeData(MakeBytes(Buffer,8,False),8,Count);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Double): NativeInt;\r\nbegin\r\n  Result:=WriteData(Buffer,8);\r\nend;\r\n\r\nfunction TStream.WriteData(const Buffer: Double; Count: NativeInt): NativeInt;\r\n\r\nVar\r\n  Mem : TJSArrayBuffer;\r\n  A : TJSUint8array;\r\n  D : TJSDataview;\r\n  B : TBytes;\r\n  I : Integer;\r\n\r\nbegin\r\n  Mem:=TJSArrayBuffer.New(8);\r\n  D:=TJSDataView.new(Mem);\r\n  D.setFloat64(0,Buffer);\r\n  SetLength(B,8);\r\n  A:=TJSUint8array.New(Mem);\r\n  For I:=0 to 7 do\r\n    B[i]:=A[i];\r\n  Result:=WriteMaxSizeData(B,8,Count);\r\nend;\r\n\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int32);\r\nbegin\r\n  WriteBufferData(Buffer,4);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int32; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Boolean);\r\nbegin\r\n  WriteBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Boolean; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: WideChar);\r\nbegin\r\n  WriteBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: WideChar; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int8);\r\nbegin\r\n  WriteBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int8; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt8);\r\nbegin\r\n  WriteBufferData(Buffer,1);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt8; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int16);\r\nbegin\r\n  WriteBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Int16; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt16);\r\nbegin\r\n  WriteBufferData(Buffer,2);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt16; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt32);\r\nbegin\r\n  WriteBufferData(Buffer,4);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: UInt32; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: NativeInt);\r\nbegin\r\n  WriteBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: NativeInt; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: NativeLargeUInt);\r\nbegin\r\n  WriteBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: NativeLargeUInt; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Double);\r\nbegin\r\n  WriteBufferData(Buffer,8);\r\nend;\r\n\r\nprocedure TStream.WriteBufferData(Buffer: Double; Count: NativeInt);\r\nbegin\r\n  if (WriteData(Buffer,Count)<>Count) then\r\n    Raise EStreamError.Create(SWriteError);\r\nend;\r\n\r\n\r\n\r\nfunction TStream.CopyFrom(Source: TStream; Count: NativeInt): NativeInt;\r\n\r\nvar\r\n   Buffer: TBytes;\r\n   BufferSize, i: LongInt;\r\n\r\nconst\r\n   MaxSize = $20000;\r\nbegin\r\n   Result:=0;\r\n   if Count=0 then\r\n     Source.Position:=0;   // This WILL fail for non-seekable streams...\r\n   BufferSize:=MaxSize;\r\n   if (Count>0) and (Count<BufferSize) then\r\n     BufferSize:=Count;    // do not allocate more than needed\r\n   SetLength(Buffer,BufferSize);\r\n   if Count=0 then\r\n     repeat\r\n       i:=Source.Read(Buffer,BufferSize);\r\n       if i>0 then\r\n         WriteBuffer(Buffer,i);\r\n       Inc(Result,i);\r\n     until i<BufferSize\r\n   else\r\n     while Count>0 do\r\n       begin\r\n       if Count>BufferSize then\r\n         i:=BufferSize\r\n       else\r\n         i:=Count;\r\n       Source.ReadBuffer(Buffer,i);\r\n       WriteBuffer(Buffer,i);\r\n       Dec(count,i);\r\n       Inc(Result,i);\r\n       end;\r\nend;\r\n\r\nfunction TStream.ReadComponent(Instance: TComponent): TComponent;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nfunction TStream.ReadComponentRes(Instance: TComponent): TComponent;\r\nbegin\r\n  ReadResHeader;\r\n  Result := ReadComponent(Instance);\r\nend;\r\n\r\nprocedure TStream.WriteComponent(Instance: TComponent);\r\n\r\nbegin\r\n  WriteDescendent(Instance, nil);\r\nend;\r\n\r\nprocedure TStream.WriteComponentRes(const ResName: string; Instance: TComponent);\r\n\r\nbegin\r\n  WriteDescendentRes(ResName, Instance, nil);\r\nend;\r\n\r\nprocedure TStream.WriteDescendent(Instance, Ancestor: TComponent);\r\nbegin\r\nend;\r\n\r\nprocedure TStream.WriteDescendentRes(const ResName: string; Instance, Ancestor: TComponent);\r\nbegin\r\nend;\r\n\r\n\r\nprocedure TStream.WriteResourceHeader(const ResName: string; {!!!: out} var FixupInfo: Longint);\r\n  var\r\n    ResType, Flags : word;\r\n    B : Byte;\r\n    I : Integer;\r\n\r\n  begin\r\n     ResType:=Word($000A);\r\n     Flags:=Word($1030);\r\n     { Note: This is a Windows 16 bit resource }\r\n     { Numeric resource type }\r\n     WriteByte($ff);\r\n     { Application defined data }\r\n     WriteWord(ResType);\r\n     { write the name as asciiz }\r\n     For I:=1 to Length(ResName) do\r\n        begin\r\n        B:=Ord(ResName[i]);\r\n        WriteByte(B);\r\n        end;\r\n     WriteByte(0);\r\n     { Movable, Pure and Discardable }\r\n     WriteWord(Flags);\r\n     { Placeholder for the resource size }\r\n     WriteDWord(0);\r\n     { Return current stream position so that the resource size can be\r\n       inserted later }\r\n     FixupInfo := Position;\r\n  end;\r\n\r\nprocedure TStream.FixupResourceHeader(FixupInfo: Longint);\r\n\r\nvar\r\n   ResSize,TmpResSize : Longint;\r\n\r\nbegin\r\n\r\n  ResSize := Position - FixupInfo;\r\n  TmpResSize := longword(ResSize);\r\n\r\n  { Insert the correct resource size into the placeholder written by\r\n    WriteResourceHeader }\r\n  Position := FixupInfo - 4;\r\n  WriteDWord(TmpResSize);\r\n  { Seek back to the end of the resource }\r\n  Position := FixupInfo + ResSize;\r\n\r\nend;\r\n\r\nprocedure TStream.ReadResHeader;\r\n  var\r\n    ResType, Flags : word;\r\n  begin\r\n     try\r\n       { Note: This is a Windows 16 bit resource }\r\n       { application specific resource ? }\r\n       if ReadByte<>$ff then\r\n         raise EInvalidImage.Create(SInvalidImage);\r\n       ResType:=ReadWord;\r\n       if ResType<>$000a then\r\n         raise EInvalidImage.Create(SInvalidImage);\r\n       { read name }\r\n       while ReadByte<>0 do\r\n         ;\r\n       { check the access specifier }\r\n       Flags:=ReadWord;\r\n       if Flags<>$1030 then\r\n         raise EInvalidImage.Create(SInvalidImage);\r\n       { ignore the size }\r\n       ReadDWord;\r\n     except\r\n       on EInvalidImage do\r\n         raise;\r\n       else\r\n         raise EInvalidImage.create(SInvalidImage);\r\n     end;\r\n  end;\r\n\r\n\r\nfunction TStream.ReadByte : Byte;\r\n\r\nbegin\r\n  ReadBufferData(Result,1);\r\nend;\r\n\r\nfunction TStream.ReadWord : Word;\r\n\r\nbegin\r\n  ReadBufferData(Result,2);\r\nend;\r\n\r\nfunction TStream.ReadDWord : Cardinal;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TStream.ReadQWord: NativeLargeUInt;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\n\r\nprocedure TStream.WriteByte(b : Byte);\r\n\r\nbegin\r\n  WriteBufferData(b,1);\r\nend;\r\n\r\nprocedure TStream.WriteWord(w : Word);\r\n\r\nbegin\r\n  WriteBufferData(W,2);\r\nend;\r\n\r\nprocedure TStream.WriteDWord(d : Cardinal);\r\n\r\nbegin\r\n  WriteBufferData(d,4);\r\nend;\r\n\r\nprocedure TStream.WriteQWord(q: NativeLargeUInt);\r\nbegin\r\n  WriteBufferData(q,8);\r\nend;\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TCustomMemoryStream                          *}\r\n{****************************************************************************}\r\n\r\nprocedure TCustomMemoryStream.SetPointer(Ptr: TJSArrayBuffer; ASize: PtrInt);\r\n\r\nbegin\r\n  FMemory:=Ptr;\r\n  FSize:=ASize;\r\n  FDataView:=Nil;\r\n  FDataArray:=Nil;\r\nend;\r\n\r\n\r\nClass Function TCustomMemoryStream.MemoryToBytes(Mem : TJSArrayBuffer) : TBytes; overload;\r\n\r\nbegin\r\n  Result:=MemoryToBytes(TJSUint8Array.New(Mem));\r\nend;\r\n\r\nclass function TCustomMemoryStream.MemoryToBytes(Mem: TJSUint8Array): TBytes;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  // This must be improved, but needs some asm or TJSFunction.call() to implement answers in\r\n  // https://stackoverflow.com/questions/29676635/convert-uint8array-to-array-in-javascript\r\n  for i:=0 to mem.length-1 do\r\n    Result[i]:=Mem[i];\r\nend;\r\n\r\nclass function TCustomMemoryStream.BytesToMemory(aBytes: TBytes): TJSArrayBuffer;\r\n\r\nVar\r\n  a : TJSUint8Array;\r\n\r\nbegin\r\n  Result:=TJSArrayBuffer.new(Length(aBytes));\r\n  A:=TJSUint8Array.New(Result);\r\n  A._set(aBytes);\r\nend;\r\n\r\nfunction TCustomMemoryStream.GetDataArray: TJSUint8Array;\r\nbegin\r\n  if FDataArray=Nil then\r\n    FDataArray:=TJSUint8Array.new(Memory);\r\n  Result:=FDataArray;\r\nend;\r\n\r\nfunction TCustomMemoryStream.GetDataView: TJSDataview;\r\nbegin\r\n  if FDataView=Nil then\r\n    FDataView:=TJSDataView.New(Memory);\r\n  Result:=FDataView;\r\nend;\r\n\r\nfunction TCustomMemoryStream.GetSize: NativeInt;\r\n\r\nbegin\r\n  Result:=FSize;\r\nend;\r\n\r\nfunction TCustomMemoryStream.GetPosition: NativeInt;\r\nbegin\r\n  Result:=FPosition;\r\nend;\r\n\r\n\r\nfunction TCustomMemoryStream.Read(Buffer : TBytes; offset, Count: LongInt): LongInt;\r\n\r\nVar\r\n  I,Src,Dest : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  If (FSize>0) and (FPosition<Fsize) and (FPosition>=0) then\r\n    begin\r\n    Result:=Count;\r\n    If (Result>(FSize-FPosition)) then\r\n      Result:=(FSize-FPosition);\r\n    Src:=FPosition;\r\n    Dest:=Offset;\r\n    I:=0;\r\n    While I<Result do\r\n      begin\r\n      Buffer[Dest]:=DataView.getUint8(Src);\r\n      inc(Src);\r\n      inc(Dest);\r\n      inc(I);\r\n      end;\r\n    FPosition:=Fposition+Result;\r\n    end;\r\nend;\r\n\r\n\r\nfunction TCustomMemoryStream.Seek(const Offset: NativeInt; Origin: TSeekOrigin): NativeInt;\r\n\r\nbegin\r\n  Case Origin of\r\n    soBeginning : FPosition:=Offset;\r\n    soEnd       : FPosition:=FSize+Offset;\r\n    soCurrent   : FPosition:=FPosition+Offset;\r\n  end;\r\n  if SizeBoundsSeek and (FPosition>FSize) then\r\n    FPosition:=FSize;\r\n  Result:=FPosition;\r\n  {$IFDEF DEBUG}\r\n  if Result < 0 then\r\n    raise Exception.Create('TCustomMemoryStream');\r\n  {$ENDIF}\r\nend;\r\n\r\n\r\nprocedure TCustomMemoryStream.SaveToStream(Stream: TStream);\r\n\r\nbegin\r\n  if FSize>0 then\r\n    Stream.WriteBuffer(TMemoryStream.MemoryToBytes(Memory),FSize);\r\nend;\r\n\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TMemoryStream                                *}\r\n{****************************************************************************}\r\n\r\n\r\nConst TMSGrow = 4096; { Use 4k blocks. }\r\n\r\nprocedure TMemoryStream.SetCapacity(NewCapacity: PtrInt);\r\n\r\nbegin\r\n  SetPointer (Realloc(NewCapacity),Fsize);\r\n  FCapacity:=NewCapacity;\r\nend;\r\n\r\n\r\nfunction TMemoryStream.Realloc(var NewCapacity: PtrInt): TJSArrayBuffer;\r\n\r\nVar\r\n  GC : PtrInt;\r\n  DestView : TJSUInt8array;\r\n\r\nbegin\r\n  If NewCapacity<0 Then\r\n    NewCapacity:=0\r\n  else\r\n    begin\r\n      GC:=FCapacity + (FCapacity div 4);\r\n      // if growing, grow at least a quarter\r\n      if (NewCapacity>FCapacity) and (NewCapacity < GC) then\r\n        NewCapacity := GC;\r\n      // round off to block size.\r\n      NewCapacity := (NewCapacity + (TMSGrow-1)) and not (TMSGROW-1);\r\n    end;\r\n  // Only now check !\r\n  If NewCapacity=FCapacity then\r\n    Result:=FMemory\r\n  else if NewCapacity=0 then\r\n    Result:=Nil\r\n  else\r\n    begin\r\n    // New buffer\r\n    Result:=TJSArrayBuffer.New(NewCapacity);\r\n    If (Result=Nil)  then\r\n      Raise EStreamError.Create(SMemoryStreamError);\r\n    // Transfer\r\n    DestView:=TJSUInt8array.New(Result);\r\n    Destview._Set(Self.DataArray);\r\n    end;\r\nend;\r\n\r\n\r\ndestructor TMemoryStream.Destroy;\r\n\r\nbegin\r\n  Clear;\r\n  Inherited Destroy;\r\nend;\r\n\r\n\r\nprocedure TMemoryStream.Clear;\r\n\r\nbegin\r\n  FSize:=0;\r\n  FPosition:=0;\r\n  SetCapacity (0);\r\nend;\r\n\r\n\r\nprocedure TMemoryStream.LoadFromStream(Stream: TStream);\r\n\r\nbegin\r\n  Stream.Position:=0;\r\n  SetSize(Stream.Size);\r\n  If FSize>0 then Stream.ReadBuffer(MemoryToBytes(FMemory),FSize);\r\nend;\r\n\r\nprocedure TMemoryStream.SetSize(const NewSize: NativeInt);\r\n\r\nbegin\r\n  SetCapacity (NewSize);\r\n  FSize:=NewSize;\r\n  IF FPosition>FSize then\r\n    FPosition:=FSize;\r\nend;\r\n\r\nfunction TMemoryStream.Write(Const Buffer : TBytes; OffSet, Count: LongInt): LongInt;\r\n\r\nVar NewPos : PtrInt;\r\n\r\nbegin\r\n  If (Count=0) or (FPosition<0) then\r\n    exit(0);\r\n  NewPos:=FPosition+Count;\r\n  If NewPos>Fsize then\r\n    begin\r\n    IF NewPos>FCapacity then\r\n      SetCapacity (NewPos);\r\n    FSize:=Newpos;\r\n    end;\r\n  DataArray._set(Copy(Buffer,Offset,Count),FPosition);\r\n  FPosition:=NewPos;\r\n  Result:=Count;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                              TBytesStream                                *}\r\n{****************************************************************************}\r\n\r\nconstructor TBytesStream.Create(const ABytes: TBytes);\r\nbegin\r\n  inherited Create;\r\n  SetPointer(TMemoryStream.BytesToMemory(aBytes),Length(ABytes));\r\n  FCapacity:=Length(ABytes);\r\nend;\r\n\r\nfunction TBytesStream.GetBytes: TBytes;\r\nbegin\r\n  Result:=TMemoryStream.MemoryToBytes(Memory);\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                              TStringStream                               *}\r\n{****************************************************************************}\r\n\r\n\r\n{ TStringStream }\r\n\r\nfunction TStringStream.GetDataString: String;\r\nvar\r\n  a : TJSUint16Array;\r\nbegin\r\n  Result:=''; // Silence warning\r\n  a:=TJSUint16Array.New(Memory.slice(0,Size));\r\n  if a<>nil then\r\n    asm\r\n      // Result=String.fromCharCode.apply(null, new Uint16Array(a));\r\n      Result=String.fromCharCode.apply(null, a);\r\n    end;\r\nend;\r\n\r\nconstructor TStringStream.Create(const aString: String);\r\n\r\n  Function StrToBuf(aLen : Integer) : TJSArrayBuffer;\r\n\r\n  var\r\n     I : Integer;\r\n\r\n  begin\r\n    Result:=TJSArrayBuffer.new(aLen*2);// 2 bytes for each char\r\n    With TJSUint16Array.new(Result) do\r\n      for i:=0 to aLen-1 do\r\n        values[i] := TJSString(aString).charCodeAt(i);\r\n  end;\r\n\r\nvar\r\n  Len : Integer;\r\n\r\nbegin\r\n  inherited Create;\r\n  Len:=Length(aString);\r\n  SetPointer(StrToBuf(len),Len*2);\r\n  FCapacity:=Len*2;\r\nend;\r\n*)\r\n\r\nvar\r\n  ClassList : TJSObject;\r\n  \r\nProcedure RegisterClass(AClass : TPersistentClass);\r\n\r\nbegin\r\n  ClassList[AClass.ClassName]:=AClass;\r\nend;\r\n\r\nprocedure RegisterClasses(const AClasses: array of TPersistentClass);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  for I := Low(AClasses) to High(AClasses) do RegisterClass(AClasses[I]);\r\nend;\r\n\r\nFunction GetClass(AClassName : string) : TPersistentClass;\r\n\r\nbegin\r\n  Result:=nil;\r\n  if AClassName='' then exit;\r\n  //if not ClassList.hasOwnProperty(AClassName) then exit;\r\n  Result:=TPersistentClass(ClassList[AClassName]);\r\nend;\r\n\r\ninitialization\r\n  ClassList:=TJSObject.create(nil);\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit Math;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils;\r\n\r\nconst\r\n  MinInteger = -$fffffffffffff-1;\r\n  MaxInteger = $fffffffffffff;\r\n  MinDouble  =  5.0e-324;\r\n  MaxDouble  =  1.7e+308;\r\n\r\n\r\nconst\r\n  NaN: Double; external name 'NaN';\r\n  Infinity: Double; external name 'Infinity';\r\n  NegInfinity: Double; external name '-Infinity';\r\n\r\ntype\r\n  float = double;\r\n\r\n  //EInvalidArgument = class(EMathError);\r\n\r\nfunction Min(const a, b: Double): Double; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: Double): Double; varargs; external name 'Math.max'; overload;\r\nfunction Min(const a, b: NativeLargeUInt): NativeLargeUInt; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: NativeLargeUInt): NativeLargeUInt; varargs; external name 'Math.max'; overload;\r\nfunction Min(const a, b: NativeLargeInt): NativeLargeInt; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: NativeLargeInt): NativeLargeInt; varargs; external name 'Math.max'; overload;\r\nfunction Min(const a, b: Integer): Integer; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: Integer): Integer; varargs; external name 'Math.max'; overload;\r\n\r\nfunction InRange(const AValue, AMin, AMax: Integer): Boolean; assembler; overload;\r\nfunction InRange(const AValue, AMin, AMax: Double): Boolean; assembler; overload;\r\n\r\nfunction EnsureRange(const AValue, AMin, AMax: Integer): Integer; assembler; overload;\r\nfunction EnsureRange(const AValue, AMin, AMax: Double): Double; assembler; overload;\r\n\r\ntype\r\n  TRoundToRange = -37..37;\r\n\r\nfunction RoundTo(const AValue: Double; const Digits: TRoundToRange): Double;\r\nfunction SimpleRoundTo(const AValue: Double; const Digits: TRoundToRange = -2): Double;\r\n\r\nfunction randg(mean,stddev : float) : float;\r\nfunction RandomRange(const aFrom, aTo: Integer): Integer;\r\nfunction RandomRange(const aFrom, aTo: NativeLargeInt): NativeLargeInt;\r\n\r\nconst\r\n  NegativeValue = -1;\r\n  ZeroValue = 0;\r\n  PositiveValue = 1;\r\n\r\nfunction Sign(const AValue: Integer): Integer; external name 'Math.sign'; overload;\r\nfunction Sign(const AValue: Double): Double; external name 'Math.sign'; overload;\r\n\r\nfunction IsZero(const d: Double; Epsilon: Double): Boolean; overload;\r\nfunction IsZero(const d: Double): Boolean; overload;\r\n\r\nfunction IsNaN(const v: JSValue): boolean; external name {$IFDEF ECMAScript5}'isNaN'{$ELSE}'Number.isNaN'{$ENDIF}; overload;\r\nfunction IsFinite(const d: JSValue): Boolean; external name 'isFinite'; overload;// false if NaN, positive or negative infinity\r\nfunction IsInfinite(const d: JSValue): Boolean; assembler; overload; // negative or positive infinity\r\n{$IFDEF ECMAScript6}\r\nfunction IsInteger(const d: JSValue): Boolean; external name 'Number.isInteger'; // any integer representable by a double\r\nfunction IsSafeInteger(const d: JSValue): Boolean; external name 'Number.isSafeInteger'; // an integer between MinInteger and MaxInteger, inclusive\r\n{$ENDIF}\r\n\r\nfunction SameValue(const A, B: Double; Epsilon: Double = 0.0): Boolean; overload;\r\n\r\n// function Abs is in System.pas\r\nfunction ArcCos(const A : Double): Double; external name 'Math.acos';\r\nfunction ArcCosH(const A: Double): Double; external name 'Math.acosh'; // not on IE\r\nfunction ArcSin(const A : Double): Double; external name 'Math.asin';\r\nfunction ArcSinH(const A : Double): Double; external name 'Math.asinh'; // not on IE\r\nfunction ArcTanH(const A: Double): Double; external name 'Math.atanh'; // not on IE\r\nfunction CosH(const A: Double): Double; external name 'Math.cosh'; // not on IE\r\nfunction ExpM1(const A: Double): Double; external name 'Math.expm1'; // not on IE\r\nfunction FRound(const A: Double): Double; overload; external name 'Math.fround'; // not on IE\r\nfunction FTrunc(const A: Double): double; overload; external name 'Math.trunc'; // not on IE\r\nfunction Hypot(const A : Double): Double; varargs; external name 'Math.hypot'; // not on IE\r\nfunction IMul(const A, B: Integer): Integer; external name 'Math.imul'; // not on IE\r\nfunction Log10(const A: Double): Double; external name 'Math.log10';\r\nfunction Log1p(const A: Double): Double; external name 'Math.log1p'; // not on IE\r\nfunction Log2(const A: Double): Double; external name 'Math.log2'; // not on IE\r\nfunction LogN(const A, Base: Double): Double; \r\nfunction Power(const Base, Exponent: Double): Double; external name 'Math.pow';\r\n// ln, round, sqrt, trunc, cos, sin, arctan, round, exp are in unit system\r\nfunction Ceil(const A: Double): Integer;\r\nfunction Floor(const A: Double): Integer;\r\nfunction Ceil64(const A: Double): NativeLargeInt;\r\nfunction Floor64(const A: Double): NativeLargeInt;\r\nfunction ldexp(x : double;const p : Integer) : double;\r\nprocedure Frexp(X: double; out Mantissa: double; out Exponent: integer);\r\nfunction lnxp1(x : double) : double;\r\n\r\nfunction IntPower(base : float;const exponent : Integer) : double;\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result, Remainder: Word);\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result, Remainder: SmallInt);\r\nprocedure DivMod(Dividend: DWord; Divisor: DWord; out Result, Remainder: DWord);\r\nprocedure DivMod(Dividend: LongInt; Divisor: LongInt; out Result, Remainder: LongInt);\r\n\r\n{ Angle conversion }\r\nfunction DegToRad(deg : double) : double;\r\nfunction RadToDeg(rad : double) : double;\r\nfunction GradToRad(grad : double) : double;\r\nfunction RadToGrad(rad : double) : double;\r\nfunction DegToGrad(deg : double) : double;\r\nfunction GradToDeg(grad : double) : double;\r\n{ one cycle are 2*Pi rad }\r\nfunction CycleToRad(cycle : double) : double;\r\nfunction RadToCycle(rad : double) : double;\r\nFunction DegNormalize(deg : double) : double;\r\n\r\nfunction Norm(const data : array of double) : double;\r\n\r\n// Statistical functions\r\nfunction Mean(const data : array of double) : double;\r\nfunction Sum(const data : array of double) : double;\r\nprocedure SumsAndSquares(const data : Array of Double; out Sum,SumOfSquares : double);\r\n\r\nfunction StdDev(const data : array of Double) : float;\r\nprocedure MeanAndStdDev(const data : array of Double; out Mean,StdDev : double);\r\nfunction Variance(const data : array of Double) : double;\r\nfunction TotalVariance(const data : array of Double) : double;\r\nfunction PopNStdDev(const data : array of Double) : double;\r\nfunction PopNVariance(const data : array of Double) : double;\r\nprocedure MomentSkewKurtosis(const data : array of Double; out m1,m2,m3,m4,skew,kurtosis : double);\r\n\r\n// Financial functions\r\n\r\nType\r\n  TPaymentTime = (ptEndOfPeriod,ptStartOfPeriod);\r\n\r\nfunction FutureValue(ARate: double; NPeriods: Integer;\r\n  APayment, APresentValue: double; APaymentTime: TPaymentTime): double;\r\n\r\nfunction InterestRate(NPeriods: Integer; APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n\r\nfunction NumberOfPeriods(ARate, APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n\r\nfunction Payment(ARate: double; NPeriods: Integer;\r\n  APresentValue, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\n\r\nfunction PresentValue(ARate: double; NPeriods: Integer;\r\n  APayment, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\n\r\n// Miscellaneous\r\n\r\nfunction IfThen(val:boolean;const ifTrue:integer; const ifFalse:integer= 0) :integer; overload;\r\nfunction IfThen(val:boolean;const ifTrue:double ; const ifFalse:double =0.0):double; overload;\r\n\r\nType\r\n  TValueRelationship = -1..1;\r\n\r\nconst\r\n  EqualsValue = 0;\r\n  LessThanValue = Low(TValueRelationship);\r\n  GreaterThanValue = High(TValueRelationship);\r\n\r\nfunction CompareValue ( const A, B  : Integer) : TValueRelationship;\r\nfunction CompareValue ( const A, B  : NativeLargeInt) : TValueRelationship;\r\nfunction CompareValue ( const A, B  : NativeLargeUInt) : TValueRelationship;\r\nfunction CompareValue ( const A, B : Double; delta : Double = 0.0) : TValueRelationship;\r\n\r\nfunction MinValue(const Data: array of Double): Double;\r\nfunction MaxValue(const Data: array of Double): Double; overload;\r\n\r\nimplementation\r\n\r\nfunction MinValue(const Data: array of Double): Double;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := Data[Low(Data)];\r\n  for I := Low(Data) + 1 to High(Data) do\r\n    if Result > Data[I] then\r\n      Result := Data[I];\r\nend;\r\n\r\nfunction MaxValue(const Data: array of Double): Double;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := Data[Low(Data)];\r\n  for I := Low(Data) + 1 to High(Data) do\r\n    if Result < Data[I] then\r\n      Result := Data[I];\r\nend;\r\n\r\nfunction InRange(const AValue, AMin, AMax: Integer): Boolean; assembler;\r\nasm\r\n  return (AValue >= AMin) && (AValue <= AMax);\r\nend;\r\n\r\nfunction InRange(const AValue, AMin, AMax: Double): Boolean; assembler;\r\nasm\r\n  return (AValue >= AMin) && (AValue <= AMax);\r\nend;\r\n\r\nfunction EnsureRange(const AValue, AMin, AMax: Integer): Integer; assembler;\r\nasm\r\n  if (AValue<AMin){ return AMin;\r\n  } else if (AValue>AMax){ return AMax;\r\n  } else return AValue;\r\nend;\r\n\r\nfunction EnsureRange(const AValue, AMin, AMax: Double): Double; assembler;\r\nasm\r\n  if (AValue<AMin){ return AMin;\r\n  } else if (AValue>AMax){ return AMax;\r\n  } else return AValue;\r\nend;\r\n\r\nfunction RoundTo(const AValue: Double; const Digits: TRoundToRange): Double;\r\nvar\r\n  RV : Double;\r\n\r\nbegin\r\n  RV:=IntPower(10,Digits);\r\n  Result:=Round(AValue/RV)*RV;\r\nend;\r\n\r\nfunction SimpleRoundTo(const AValue: Double; const Digits: TRoundToRange): Double;\r\nvar\r\n  RV : Double;\r\n\r\nbegin\r\n  RV := IntPower(10, -Digits);\r\n  if AValue < 0 then\r\n    Result := Int((AValue*RV) - 0.5)/RV\r\n  else\r\n    Result := Int((AValue*RV) + 0.5)/RV;\r\nend;\r\n\r\nfunction randg(mean,stddev : float) : float;\r\n\r\nVar\r\n  U1,S2 : Float;\r\n\r\nbegin\r\n  repeat\r\n    u1:= 2*random-1;\r\n    S2:=Sqr(U1)+sqr(2*random-1);\r\n  until s2<1;\r\n  Result:=Sqrt(-2*ln(S2)/S2)*u1*stddev+Mean;\r\nend;\r\n\r\n\r\nfunction RandomRange(const aFrom, aTo: Integer): Integer;\r\nbegin\r\n  Result:=Random(Abs(aFrom-aTo))+Min(aTo,AFrom);\r\nend;\r\n\r\n\r\nfunction RandomRange(const aFrom, aTo: NativeLargeInt): NativeLargeInt;\r\n\r\nVar\r\n  m : NativeLargeInt;\r\nbegin\r\n  if aFrom<aTo then\r\n    M:=aFrom\r\n  else\r\n    M:=aTo;\r\n  Result:=Random(Abs(aFrom-aTo))+M;\r\nend;\r\n\r\nconst\r\n  DZeroResolution = 1E-12;\r\n\r\nfunction IsZero(const d: Double; Epsilon: Double): Boolean;\r\nbegin\r\n  if Epsilon=0 then\r\n    Epsilon:=DZeroResolution;\r\n  Result:=Abs(d)<=Epsilon;\r\nend;\r\n\r\nfunction IsZero(const d: Double): Boolean;\r\nbegin\r\n  Result:=Abs(d)<=DZeroResolution;\r\nend;\r\n\r\nfunction IsInfinite(const d: JSValue): Boolean; assembler;\r\nasm\r\n  return (d==Infinity) || (d==-Infinity);\r\nend;\r\n\r\nfunction SameValue(const A, B: Double; Epsilon: Double): Boolean;\r\nbegin\r\n  if (Epsilon=0.0) then\r\n    Epsilon:=Max(Min(Abs(A),Abs(B))*DZeroResolution,DZeroResolution);\r\n  if (A>B) then\r\n    Result:=((A-B)<=Epsilon)\r\n  else\r\n    Result:=((B-A)<=Epsilon);\r\nend;\r\n\r\nfunction JSFloor(const A: Double): Double; external name 'Math.floor';\r\nfunction JSCeil(const A: Double): Double; external name 'Math.ceil';\r\n\r\nfunction Ceil(const A: Double): Integer;\r\n\r\nbegin\r\n  // TODO: add Range check ?\r\n  Result:=trunc(JSCeil(a));\r\nend;\r\n\r\nfunction Floor(const A: Double): Integer;\r\n\r\nbegin\r\n  // TODO: add Range check ?\r\n  Result:=trunc(JSFloor(a));\r\nend;\r\n\r\nfunction Ceil64(const A: Double): NativeLargeInt;\r\n\r\nbegin\r\n  Result:=trunc(JSCeil(a));\r\nend;\r\n\r\nfunction Floor64(const A: Double): NativeLargeInt;\r\n\r\nbegin\r\n  Result:=trunc(JSCeil(a));\r\nend;\r\n\r\nprocedure Frexp(X: double; out Mantissa: double; out Exponent: integer);\r\n\r\nbegin\r\n  Exponent:=0;\r\n  if (X<>0) then\r\n    if (abs(X)<0.5) then\r\n      repeat\r\n        X:=X*2;\r\n        Dec(Exponent);\r\n      until (abs(X)>=0.5)\r\n    else\r\n      while (abs(X)>=1) do\r\n        begin\r\n        X:=X/2;\r\n        Inc(Exponent);\r\n        end;\r\n  Mantissa:=X;\r\nend;\r\n\r\nfunction LogN(const A, Base: Double): Double; \r\n\r\nbegin\r\n  Result:=Ln(A)/Ln(Base);\r\nend;\r\n\r\nfunction lnxp1(x: double): double;\r\n\r\nvar\r\n  y: float;\r\n\r\nbegin\r\n  if (x>=4.0) then\r\n    result:=ln(1.0+x)\r\n  else\r\n    begin\r\n    y:=1.0+x;\r\n    if (y=1.0) then\r\n      result:=x\r\n    else\r\n      begin\r\n      result:=ln(y);     { lnxp1(-1) = ln(0) = -Inf }\r\n      if y>0.0 then\r\n        result:=result+(x-(y-1.0))/y;\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction ldexp(x : double;const p : Integer) : double;\r\n\r\nbegin\r\n   result:=x*intpower(2.0,p);\r\nend;\r\n\r\n\r\nfunction IntPower(base: float; const exponent: Integer): double;\r\n\r\nvar\r\n  i : longint;\r\n\r\nbegin\r\n  if (base = 0.0) and (exponent = 0) then\r\n    result:=1\r\n  else\r\n    begin\r\n    i:=abs(exponent);\r\n    Result:=1.0;\r\n    while i>0 do\r\n      begin\r\n      while (i and 1)=0 do\r\n        begin\r\n        i:=i shr 1;\r\n        base:=sqr(base);\r\n        end;\r\n      i:=i-1;\r\n      Result:=Result*base;\r\n      end;\r\n    if exponent<0 then\r\n      Result:=1.0/Result;\r\n    end;\r\nend;\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result, Remainder: Word);\r\nbegin\r\n  if Dividend < 0 then\r\n    begin\r\n    Dividend:=-Dividend;\r\n    Result:=-(Dividend Div Divisor);\r\n    Remainder:=-(Dividend+(Result*Divisor));\r\n    end\r\n  else\r\n    begin\r\n    Result:=Dividend Div Divisor;\r\n    Remainder:=Dividend-(Result*Divisor);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result,\r\n  Remainder: SmallInt);\r\nbegin\r\n  if Dividend < 0 then\r\n    begin\r\n    Dividend:=-Dividend;\r\n    Result:=-(Dividend Div Divisor);\r\n    Remainder:=-(Dividend+(Result*Divisor));\r\n    end\r\n  else\r\n    begin\r\n    Result:=Dividend Div Divisor;\r\n    Remainder:=Dividend-(Result*Divisor);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure DivMod(Dividend: DWord; Divisor: DWord; out Result, Remainder: DWord);\r\nbegin\r\n  Result:=Dividend Div Divisor;\r\n  Remainder:=Dividend-(Result*Divisor);\r\nend;\r\n\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: LongInt; out Result,\r\n  Remainder: LongInt);\r\n\r\nbegin\r\n  if Dividend < 0 then\r\n    begin\r\n    Dividend:=-Dividend;\r\n    Result:=-(Dividend Div Divisor);\r\n    Remainder:=-(Dividend+(Result*Divisor));\r\n    end\r\n  else\r\n    begin\r\n    Result:=Dividend Div Divisor;\r\n    Remainder:=Dividend-(Result*Divisor);\r\n    end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Angle conversion\r\n  ---------------------------------------------------------------------}\r\nfunction DegToRad(deg: double): double;\r\n\r\nbegin\r\n  Result:=deg*(pi/180.0);\r\nend;\r\n\r\n\r\nfunction RadToDeg(rad: double): double;\r\n\r\nbegin\r\n  Result:=rad*(180.0/pi);\r\nend;\r\n\r\n\r\nfunction GradToRad(grad: double): double;\r\n\r\nbegin\r\n  Result:=grad*(pi/200.0);\r\nend;\r\n\r\n\r\nfunction RadToGrad(rad: double): double;\r\n\r\nbegin\r\n  Result:=rad*(200.0/pi);\r\nend;\r\n\r\n\r\nfunction DegToGrad(deg: double): double;\r\n\r\nbegin\r\n  Result:=deg*(200.0/180.0);\r\nend;\r\n\r\n\r\nfunction GradToDeg(grad: double): double;\r\n\r\nbegin\r\n  Result:=grad*(180.0/200.0);\r\nend;\r\n\r\n\r\nfunction CycleToRad(cycle: double): double;\r\n\r\nbegin\r\n  Result:=(2*pi)*cycle;\r\nend;\r\n\r\n\r\nfunction RadToCycle(rad: double): double;\r\n\r\nbegin\r\n  Result:=rad*(1/(2*pi));\r\nend;\r\n\r\n\r\nfunction DegNormalize(deg: double): double;\r\n\r\nbegin\r\n  Result:=Deg-Int(Deg/360)*360;\r\n  If (Result<0) then Result:=Result+360;\r\nend;\r\n\r\nfunction sumofsquares(const data : array of double) : double;\r\nvar\r\n  i,N : longint;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  Result:=0.0;\r\n  for i:=0 to N-1 do\r\n    Result:=Result+sqr(data[i]);\r\nend;\r\n\r\nfunction Norm(const data: array of double): double;\r\nbegin\r\n  Result:=sqrt(sumofsquares(data));\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Statistical functions\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction Sum(const data: array of double): double;\r\n\r\nvar\r\n  i,N : longint;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  Result:=0.0;\r\n  for i:=0 to N-1 do\r\n    Result:=Result+data[i];\r\nend;\r\n\r\nfunction Mean(const data: array of double): double;\r\n\r\nVar\r\n  N : integer;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  if N=0 then\r\n    Result:=0\r\n  else\r\n    Result:=Sum(Data)/N;\r\nend;\r\nprocedure SumsAndSquares(const data: array of Double; out Sum,\r\n  SumOfSquares: double);\r\n\r\nvar\r\n  i,n : Integer;\r\n  t,s,ss: double;\r\n\r\nbegin\r\n  n:=length(Data);\r\n  ss:=0.0; // Use local vars, var is very inefficient in js\r\n  s:=0.0;\r\n  for i:=0 to N-1 do\r\n    begin\r\n    t:=data[i];\r\n    ss:=ss+sqr(t);\r\n    s:=s+t;\r\n    end;\r\n  Sum:=s;\r\n  SumOfSquares:=ss;\r\nend;\r\n\r\nfunction StdDev(const data: array of Double): float;\r\n\r\nbegin\r\n  Result:=Sqrt(Variance(Data));\r\nend;\r\n\r\nfunction Variance(const data: array of Double): double;\r\n\r\nvar\r\n  n : integer;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  If N=1 then\r\n    Result:=0\r\n  else\r\n    Result:=TotalVariance(Data)/(N-1);\r\nend;\r\n\r\nfunction TotalVariance(const data: array of Double): double;\r\n\r\nvar\r\n  S,SS : Float;\r\n  N : integer;\r\nbegin\r\n  N:=Length(Data);\r\n  If Length(Data)=1 then\r\n    Result:=0\r\n  else\r\n    begin\r\n    SumsAndSquares(Data,S,SS);\r\n    Result := SS-Sqr(S)/N;\r\n    end;\r\nend;\r\n\r\nprocedure MeanAndStdDev(const data: array of Double; out Mean, StdDev: double);\r\n\r\nVar\r\n  I,N : longint;\r\n  M,S : Double;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  M:=0;\r\n  S:=0;\r\n  For I:=0 to N-1 do\r\n    begin\r\n    M:=M+Data[i];\r\n    S:=S+Sqr(Data[i]);\r\n    end;\r\n  M:=M/N;\r\n  S:=(S-N*Sqr(M));\r\n  If N>1 then\r\n    S:=Sqrt(S/(N-1))\r\n  else\r\n    S:=0;\r\n  Mean:=M;\r\n  StdDev:=S;\r\nend;\r\n\r\nfunction PopNStdDev(const data : array of Double) : double;\r\n\r\nbegin\r\n  Result:=Sqrt(PopnVariance(Data));\r\nend;\r\n\r\nfunction PopNVariance(const data : array of Double) : double;\r\n\r\nVar\r\n  N : integer;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  if N=0 then\r\n    Result:=0\r\n  else\r\n    Result:=TotalVariance(Data)/N;\r\nend;\r\n\r\nprocedure MomentSkewKurtosis(const data: array of Double; out m1, m2, m3, m4, skew, kurtosis: double);\r\n\r\nvar\r\n  i,N: integer;\r\n  deviation, deviation2: double;\r\n  reciprocalN: float;\r\n  // Use local vars for all calculations, var is very slow\r\n  lm1, lm2, lm3, lm4, lskew, lkurtosis: double;\r\n\r\nbegin\r\n  N:=length(Data);\r\n  lm1 := 0;\r\n  reciprocalN := 1/N;\r\n  for i := 0 to N-1 do\r\n    lm1 := lm1 + data[i];\r\n  lm1 := reciprocalN * lm1;\r\n\r\n  lm2 := 0;\r\n  lm3 := 0;\r\n  lm4 := 0;\r\n  for i := 0 to N-1 do\r\n    begin\r\n    deviation := (data[i]-lm1);\r\n    deviation2 := deviation * deviation;\r\n    lm2 := lm2 + deviation2;\r\n    lm3 := lm3 + deviation2 * deviation;\r\n    lm4 := lm4 + deviation2 * deviation2;\r\n    end;\r\n  lm2 := reciprocalN * lm2;\r\n  lm3 := reciprocalN * lm3;\r\n  lm4 := reciprocalN * lm4;\r\n\r\n  lskew := lm3 / (sqrt(lm2)*lm2);\r\n  lkurtosis := lm4 / (lm2 * lm2);\r\n\r\n  m1:=lm1;\r\n  m2:=lm2;\r\n  m3:=lm3;\r\n  m4:=lm4;\r\n  skew:=lskew;\r\n  kurtosis:=lkurtosis;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Financial functions\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction FutureValue(ARate: double; NPeriods: Integer;\r\n  APayment, APresentValue: double; APaymentTime: TPaymentTime): double;\r\nvar\r\n  q, qn, factor: double;\r\nbegin\r\n  if ARate = 0 then\r\n    Result := -APresentValue - APayment * NPeriods\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    qn := power(q, NPeriods);\r\n    factor := (qn - 1) / (q - 1);\r\n    if APaymentTime = ptStartOfPeriod then\r\n      factor := factor * q;\r\n    Result := -(APresentValue * qn + APayment*factor);\r\n  end;\r\nend;\r\n\r\nfunction InterestRate(NPeriods: Integer; APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n{ The interest rate cannot be calculated analytically. We solve the equation\r\n  numerically by means of the Newton method:\r\n  - guess value for the interest reate\r\n  - calculate at which interest rate the tangent of the curve fv(rate)\r\n    (straight line!) has the requested future vale.\r\n  - use this rate for the next iteration. }\r\nconst\r\n  DELTA = 0.001;\r\n  EPS = 1E-9;   // required precision of interest rate (after typ. 6 iterations)\r\n  MAXIT = 20;   // max iteration count to protect agains non-convergence\r\nvar\r\n  r1, r2, dr: double;\r\n  fv1, fv2: double;\r\n  iteration: Integer;\r\nbegin\r\n  iteration := 0;\r\n  r1 := 0.05;  // inital guess\r\n  repeat\r\n    r2 := r1 + DELTA;\r\n    fv1 := FutureValue(r1, NPeriods, APayment, APresentValue, APaymentTime);\r\n    fv2 := FutureValue(r2, NPeriods, APayment, APresentValue, APaymentTime);\r\n    dr := (AFutureValue - fv1) / (fv2 - fv1) * delta;  // tangent at fv(r)\r\n    r1 := r1 + dr;      // next guess\r\n    inc(iteration);\r\n  until (abs(dr) < EPS) or (iteration >= MAXIT);\r\n  Result := r1;\r\nend;\r\n\r\nfunction NumberOfPeriods(ARate, APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n{ Solve the cash flow equation (1) for q^n and take the logarithm }\r\nvar\r\n  q, x1, x2: double;\r\nbegin\r\n  if ARate = 0 then\r\n    Result := -(APresentValue + AFutureValue) / APayment\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    if APaymentTime = ptStartOfPeriod then\r\n      APayment := APayment * q;\r\n    x1 := APayment - AFutureValue * ARate;\r\n    x2 := APayment + APresentValue * ARate;\r\n    if   (x2 = 0)                    // we have to divide by x2\r\n      or (sign(x1) * sign(x2) < 0)   // the argument of the log is negative\r\n    then\r\n      Result := Infinity\r\n    else begin\r\n      Result := ln(x1/x2) / ln(q);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction Payment(ARate: double; NPeriods: Integer;\r\n  APresentValue, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\nvar\r\n  q, qn, factor: double;\r\nbegin\r\n  if ARate = 0 then\r\n    Result := -(AFutureValue + APresentValue) / NPeriods\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    qn := power(q, NPeriods);\r\n    factor := (qn - 1) / (q - 1);\r\n    if APaymentTime = ptStartOfPeriod then\r\n      factor := factor * q;\r\n    Result := -(AFutureValue + APresentValue * qn) / factor;\r\n  end;\r\nend;\r\n\r\nfunction PresentValue(ARate: double; NPeriods: Integer;\r\n  APayment, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\nvar\r\n  q, qn, factor: double;\r\nbegin\r\n  if ARate = 0.0 then\r\n    Result := -AFutureValue - APayment * NPeriods\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    qn := power(q, NPeriods);\r\n    factor := (qn - 1) / (q - 1);\r\n    if APaymentTime = ptStartOfPeriod then\r\n      factor := factor * q;\r\n    Result := -(AFutureValue + APayment*factor) / qn;\r\n  end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Miscellaneous\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction IfThen(val: boolean; const ifTrue: integer; const ifFalse: integer): integer;\r\n\r\nbegin\r\n  if val then result:=iftrue else result:=iffalse;\r\nend;\r\n\r\nfunction IfThen(val: boolean; const ifTrue: double; const ifFalse: double): double;\r\n\r\nbegin\r\n  if val then result:=iftrue else result:=iffalse;\r\nend;\r\n\r\nfunction CompareValue(const A, B  : Integer): TValueRelationship;\r\n\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if a=b then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nfunction CompareValue(const A, B: NativeLargeInt): TValueRelationship;\r\n\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if a=b then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nfunction CompareValue(const A, B: NativeLargeUInt): TValueRelationship;\r\n\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if a=b then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nfunction CompareValue(const A, B: Double; delta: Double): TValueRelationship;\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if abs(a-b)<=delta then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 2002 by Florian Klaempfl\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n{$mode objfpc}\r\n\r\nunit contnrs;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Classes;\r\n\r\n\r\nType\r\n  TObjectListCallback = Reference to Procedure(data:TObject;arg:JSValue);\r\n\r\n  TFPObjectList = class(TObject)\r\n  private\r\n    FFreeObjects : Boolean;\r\n    FList: TFPList;\r\n    Function GetCount: integer;\r\n    Procedure SetCount(const AValue: integer);\r\n  protected\r\n    Function GetItem(Index: Integer): TObject;\r\n    Procedure SetItem(Index: Integer; AObject: TObject);\r\n    Procedure SetCapacity(NewCapacity: Integer);\r\n    Function GetCapacity: integer;\r\n  public\r\n    constructor Create; reintroduce;\r\n    constructor Create(FreeObjects : Boolean);\r\n    destructor Destroy; override;\r\n    Procedure Clear;\r\n    Function Add(AObject: TObject): Integer;\r\n    Procedure Delete(Index: Integer);\r\n    Procedure Exchange(Index1, Index2: Integer);\r\n    Function Expand: TFPObjectList;\r\n    Function Extract(Item: TObject): TObject;\r\n    Function Remove(AObject: TObject): Integer;\r\n    Function IndexOf(AObject: TObject): Integer;\r\n    Function FindInstanceOf(AClass: TClass; AExact: Boolean; AStartAt: Integer): Integer;\r\n    Procedure Insert(Index: Integer; AObject: TObject);\r\n    Function First: TObject;\r\n    Function Last: TObject;\r\n    Procedure Move(CurIndex, NewIndex: Integer);\r\n    Procedure Assign(Obj:TFPObjectList);\r\n    Procedure Pack;\r\n    Procedure Sort(Compare: TListSortCompare);\r\n    Procedure ForEachCall(proc2call:TObjectListCallback;arg:JSValue);\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property Count: Integer read GetCount write SetCount;\r\n    property OwnsObjects: Boolean read FFreeObjects write FFreeObjects;\r\n    property Items[Index: Integer]: TObject read GetItem write SetItem; default;\r\n    property List: TFPList read FList;\r\n  end;\r\n\r\n\r\n  { TObjectList }\r\n\r\n  TObjectList = class(TList)\r\n  private\r\n    FFreeObjects : Boolean;\r\n  Protected\r\n    Procedure Notify(Ptr: JSValue; Action: TListNotification); override;\r\n    Function GetItem(Index: Integer): TObject;\r\n    Procedure SetItem(Index: Integer; AObject: TObject);\r\n  public\r\n    constructor Create; reintroduce;\r\n    constructor Create(FreeObjects : boolean);\r\n    Function Add(AObject: TObject): Integer; reintroduce;\r\n    Function Extract(Item: TObject): TObject; reintroduce;\r\n    Function Remove(AObject: TObject): Integer; reintroduce;\r\n    Function IndexOf(AObject: TObject): Integer; reintroduce;\r\n    Function FindInstanceOf(AClass: TClass; AExact: Boolean; AStartAt: Integer): Integer;\r\n    Procedure Insert(Index: Integer; AObject: TObject); reintroduce;\r\n    Function First: TObject; reintroduce;\r\n    Function Last: TObject; reintroduce;\r\n    property OwnsObjects: Boolean read FFreeObjects write FFreeObjects;\r\n    property Items[Index: Integer]: TObject read GetItem write SetItem; default;\r\n  end;\r\n\r\n  TComponentList = class(TObjectList)\r\n  Private\r\n    FNotifier : TComponent;\r\n  Protected\r\n    Procedure Notify(Ptr: JSValue; Action: TListNotification); override;\r\n    Function GetItems(Index: Integer): TComponent;\r\n    Procedure SetItems(Index: Integer; AComponent: TComponent);\r\n    Procedure HandleFreeNotify(Sender: TObject; AComponent: TComponent);\r\n  public\r\n    destructor Destroy; override;\r\n    Function Add(AComponent: TComponent): Integer; reintroduce;\r\n    Function Extract(Item: TComponent): TComponent; reintroduce;\r\n    Function Remove(AComponent: TComponent): Integer; reintroduce;\r\n    Function IndexOf(AComponent: TComponent): Integer; reintroduce;\r\n    Function First: TComponent; reintroduce;\r\n    Function Last: TComponent; reintroduce;\r\n    Procedure Insert(Index: Integer; AComponent: TComponent); reintroduce;\r\n    property Items[Index: Integer]: TComponent read GetItems write SetItems; default;\r\n  end;\r\n\r\n  TClassList = class(TList)\r\n  protected\r\n    Function GetItems(Index: Integer): TClass;\r\n    Procedure SetItems(Index: Integer; AClass: TClass);\r\n  public\r\n    Function Add(AClass: TClass): Integer; reintroduce;\r\n    Function Extract(Item: TClass): TClass; reintroduce;\r\n    Function Remove(AClass: TClass): Integer; reintroduce;\r\n    Function IndexOf(AClass: TClass): Integer; reintroduce;\r\n    Function First: TClass; reintroduce;\r\n    Function Last: TClass; reintroduce;\r\n    Procedure Insert(Index: Integer; AClass: TClass); reintroduce;\r\n    property Items[Index: Integer]: TClass read GetItems write SetItems; default;\r\n  end;\r\n\r\n  TOrderedList = class(TObject)\r\n  private\r\n    FList: TList;\r\n  protected\r\n    Procedure PushItem(AItem: JSValue); virtual; abstract;\r\n    Function PopItem: JSValue; virtual;\r\n    Function PeekItem: JSValue; virtual;\r\n    property List: TList read FList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    Function Count: Integer;\r\n    Function AtLeast(ACount: Integer): Boolean;\r\n    Function Push(AItem: JSValue): JSValue;\r\n    Function Pop: JSValue;\r\n    Function Peek: JSValue;\r\n  end;\r\n\r\n{ TStack class }\r\n\r\n  TStack = class(TOrderedList)\r\n  protected\r\n    Procedure PushItem(AItem: JSValue); override;\r\n  end;\r\n\r\n{ TObjectStack class }\r\n\r\n  TObjectStack = class(TStack)\r\n  public\r\n    Function Push(AObject: TObject): TObject; reintroduce;\r\n    Function Pop: TObject; reintroduce;\r\n    Function Peek: TObject; reintroduce;\r\n  end;\r\n\r\n{ TQueue class }\r\n\r\n  TQueue = class(TOrderedList)\r\n  protected\r\n    Procedure PushItem(AItem: JSValue); override;\r\n  end;\r\n\r\n{ TObjectQueue class }\r\n\r\n  TObjectQueue = class(TQueue)\r\n  public\r\n    Function Push(AObject: TObject): TObject; reintroduce;\r\n    Function Pop: TObject; reintroduce;\r\n    Function Peek: TObject; reintroduce;\r\n  end;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Hash support, implemented by Dean Zobec\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\n  { Must return a Longword value in the range 0..TableSize,\r\n   usually via a mod operator;  }\r\n  THashFunction = Function(const S: string; const TableSize: Longword): Longword;\r\n\r\n\r\n  { THTNode }\r\n\r\n  THTCustomNode = class(TObject)\r\n  private\r\n    FKey: string;\r\n  public\r\n    constructor CreateWith(const AString: String);\r\n    Function HasKey(const AKey: string): boolean;\r\n    property Key: string read FKey;\r\n  end;\r\n  THTCustomNodeClass = Class of THTCustomNode;\r\n\r\n\r\n  { TFPCustomHashTable }\r\n\r\n  TFPCustomHashTable = class(TObject)\r\n  private\r\n    FHashTable: TFPObjectList;\r\n    FHashFunction: THashFunction;\r\n    FCount: Longword;\r\n    Function GetDensity: Longword;\r\n    Function GetNumberOfCollisions: Longword;\r\n    Procedure SetHashTableSize(const Value: Longword);\r\n    Procedure InitializeHashTable;\r\n    Function GetVoidSlots: Longword;\r\n    Function GetLoadFactor: double;\r\n    Function GetAVGChainLen: double;\r\n    Function GetMaxChainLength: Longword;\r\n  protected\r\n    FHashTableSize: Longword;\r\n    Function Chain(const index: Longword):TFPObjectList;\r\n    Function CreateNewNode(const aKey : string) : THTCustomNode; virtual; abstract;\r\n    Procedure AddNode(ANode : THTCustomNode); virtual; abstract;\r\n    Function ChainLength(const ChainIndex: Longword): Longword; virtual;\r\n    Function FindOrCreateNew(const aKey: string): THTCustomNode; virtual;\r\n    Procedure SetHashFunction(AHashFunction: THashFunction); virtual;\r\n    Function FindChainForAdd(Const aKey : String) : TFPObjectList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    constructor CreateWith(AHashTableSize: Longword; aHashFunc: THashFunction);\r\n    destructor Destroy; override;\r\n    Procedure ChangeTableSize(const ANewSize: Longword); virtual;\r\n    Procedure Clear; virtual;\r\n    Procedure Delete(const aKey: string); virtual;\r\n    Function Find(const aKey: string): THTCustomNode;\r\n    Function IsEmpty: boolean;\r\n    property HashFunction: THashFunction read FHashFunction write SetHashFunction;\r\n    property Count: Longword read FCount;\r\n    property HashTableSize: Longword read FHashTableSize write SetHashTableSize;\r\n    property HashTable: TFPObjectList read FHashTable;\r\n    property VoidSlots: Longword read GetVoidSlots;\r\n    property LoadFactor: double read GetLoadFactor;\r\n    property AVGChainLen: double read GetAVGChainLen;\r\n    property MaxChainLength: Longword read GetMaxChainLength;\r\n    property NumberOfCollisions: Longword read GetNumberOfCollisions;\r\n    property Density: Longword read GetDensity;\r\n  end;\r\n\r\n  { TFPDataHashTable : Hash table with simple data JSValues }\r\n\r\n  THTDataNode = Class(THTCustomNode)\r\n  Private\r\n    FData: JSValue;\r\n  public\r\n    property Data: JSValue read FData write FData;\r\n  end;\r\n  // For compatibility\r\n  THTNode = THTDataNode;\r\n\r\n  TDataIteratorMethod = Procedure(Item: JSValue; const Key: string; var Continue: Boolean) of object;\r\n  TDataIteratorCallBack = Procedure(Item: JSValue; const Key: string; var Continue: Boolean);\r\n\r\n  // For compatibility\r\n  TIteratorMethod = TDataIteratorMethod;\r\n\r\n  TFPDataHashTable = Class(TFPCustomHashTable)\r\n  Private\r\n    FIteratorCallBack: TDataIteratorCallBack;\r\n    Procedure CallbackIterator(Item: JSValue; const Key: string; var Continue: Boolean);\r\n  Protected\r\n    Function CreateNewNode(const aKey : String) : THTCustomNode; override;\r\n    Procedure AddNode(ANode : THTCustomNode); override;\r\n    Procedure SetData(const index: string; const AValue: JSValue); virtual;\r\n    Function GetData(const index: string):JSValue; virtual;\r\n    Function ForEachCall(aMethod: TDataIteratorMethod): THTDataNode; virtual;\r\n  Public\r\n    Function Iterate(aMethod: TDataIteratorMethod): JSValue; virtual;\r\n    Function Iterate(aMethod: TDataIteratorCallBack): JSValue; virtual;\r\n    Procedure Add(const aKey: string; AItem: JSValue); virtual;\r\n    property Items[const index: string]: JSValue read GetData write SetData; default;\r\n  end;\r\n\r\n  { TFPStringHashTable : Hash table with simple strings as data }\r\n  THTStringNode = Class(THTCustomNode)\r\n  Private\r\n    FData : String;\r\n  public\r\n    property Data: String read FData write FData;\r\n  end;\r\n  \r\n  TStringIteratorMethod = Procedure(Item: String; const Key: string; var Continue: Boolean) of object;\r\n  TStringIteratorCallback = Procedure(Item: String; const Key: string; var Continue: Boolean);\r\n\r\n  TFPStringHashTable = Class(TFPCustomHashTable)\r\n  Private\r\n    FIteratorCallBack: TStringIteratorCallback;\r\n    Procedure CallbackIterator(Item: String; const Key: string; var Continue: Boolean);\r\n  Protected\r\n    Function CreateNewNode(const aKey : String) : THTCustomNode; override;\r\n    Procedure AddNode(ANode : THTCustomNode); override;\r\n    Procedure SetData(const Index, AValue: string); virtual;\r\n    Function GetData(const index: string): String; virtual;\r\n    Function ForEachCall(aMethod: TStringIteratorMethod): THTStringNode; virtual;\r\n  Public\r\n    Function Iterate(aMethod: TStringIteratorMethod): String; virtual;\r\n    Function Iterate(aMethod: TStringIteratorCallback): String; virtual;\r\n    Procedure Add(const aKey,aItem: string); virtual;\r\n    property Items[const index: string]: String read GetData write SetData; default;\r\n  end;\r\n\r\n  { TFPStringHashTable : Hash table with simple strings as data }\r\n\r\n\r\n  THTObjectNode = Class(THTCustomNode)\r\n  Private\r\n    FData : TObject;\r\n  public\r\n    property Data: TObject read FData write FData;\r\n  end;\r\n\r\n  THTOwnedObjectNode = Class(THTObjectNode)\r\n  public\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TObjectIteratorMethod = Procedure(Item: TObject; const Key: string; var Continue: Boolean) of object;\r\n  TObjectIteratorCallback = Procedure(Item: TObject; const Key: string; var Continue: Boolean);\r\n\r\n  TFPObjectHashTable = Class(TFPCustomHashTable)\r\n  Private\r\n    FOwnsObjects : Boolean;\r\n    FIteratorCallBack: TObjectIteratorCallback;\r\n    procedure CallbackIterator(Item: TObject; const Key: string; var Continue: Boolean);\r\n  Protected\r\n    Function CreateNewNode(const aKey : String) : THTCustomNode; override;\r\n    Procedure AddNode(ANode : THTCustomNode); override;\r\n    Procedure SetData(const Index: string; AObject : TObject); virtual;\r\n    Function GetData(const index: string): TObject; virtual;\r\n    Function ForEachCall(aMethod: TObjectIteratorMethod): THTObjectNode; virtual;\r\n  Public\r\n    constructor Create(AOwnsObjects : Boolean = True); reintroduce;\r\n    constructor CreateWith(AHashTableSize: Longword; aHashFunc: THashFunction; AOwnsObjects : Boolean = True); reintroduce;\r\n    Function Iterate(aMethod: TObjectIteratorMethod): TObject; virtual;\r\n    Function Iterate(aMethod: TObjectIteratorCallback): TObject; virtual;\r\n    Procedure Add(const aKey: string; AItem : TObject); virtual;\r\n    property Items[const index: string]: TObject read GetData write SetData; default;\r\n    Property OwnsObjects : Boolean Read FOwnsObjects;\r\n  end;\r\n\r\n  EDuplicate = class(Exception);\r\n  EKeyNotFound = class(Exception);\r\n\r\n  Function RSHash(const S: string; const TableSize: Longword): Longword;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Bucket lists as in Delphi\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nType\r\n  TBucketItem = record\r\n    Item, Data: JSValue;\r\n  end;\r\n  TBucketItemArray = array of TBucketItem;\r\n\r\n  TBucket = record\r\n    Count : Integer;\r\n    Items : TBucketItemArray;\r\n  end;\r\n  TBucketArray = array of TBucket;\r\n\r\n  TBucketProc = Reference to Procedure(AInfo, AItem, AData: JSValue; out AContinue: Boolean);\r\n\r\n{ ---------------------------------------------------------------------\r\n  TCustomBucketList\r\n  ---------------------------------------------------------------------}\r\n\r\n  { TCustomBucketList }\r\n\r\n  TCustomBucketList = class(TObject)\r\n  private\r\n    FBuckets: TBucketArray;\r\n    Function GetBucketCount: Integer;\r\n    Function GetData(AItem: JSValue): JSValue;\r\n    Procedure SetData(AItem: JSValue; const AData: JSValue);\r\n    Procedure SetBucketCount(const Value: Integer);\r\n  protected\r\n    Procedure GetBucketItem(AItem: JSValue; out ABucket, AIndex: Integer);\r\n    Function AddItem(ABucket: Integer; AItem, AData: JSValue): JSValue; virtual;\r\n    Function BucketFor(AItem: JSValue): Integer; virtual; abstract;\r\n    Function DeleteItem(ABucket: Integer; AIndex: Integer): JSValue; virtual;\r\n    Procedure Error(Msg : String; Args : Array of JSValue);\r\n    Function FindItem(AItem: JSValue; out ABucket, AIndex: Integer): Boolean; virtual;\r\n    property Buckets: TBucketArray read FBuckets;\r\n    property BucketCount: Integer read GetBucketCount write SetBucketCount;\r\n  public\r\n    destructor Destroy; override;\r\n    Procedure Clear;\r\n    Function Add(AItem, AData: JSValue): JSValue;\r\n    Procedure Assign(AList: TCustomBucketList);\r\n    Function Exists(AItem: JSValue): Boolean;\r\n    Function Find(AItem: JSValue; out AData: JSValue): Boolean;\r\n    Function ForEach(AProc: TBucketProc; AInfo: JSValue): Boolean;\r\n    Function ForEach(AProc: TBucketProc): Boolean;\r\n    Function Remove(AItem: JSValue): JSValue;\r\n    property Data[AItem: JSValue]: JSValue read GetData write SetData; default;\r\n  end;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TBucketList\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\n  TBucketListSizes = (bl2, bl4, bl8, bl16, bl32, bl64, bl128, bl256);\r\n\r\n  { TBucketList }\r\n\r\n  TBucketList = class(TCustomBucketList)\r\n  private\r\n    FBucketMask: Byte;\r\n  protected\r\n    Function BucketFor(AItem: JSValue): Integer; override;\r\n  public\r\n    constructor Create(ABuckets: TBucketListSizes = bl16); reintroduce;\r\n  end;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TObjectBucketList\r\n  ---------------------------------------------------------------------}\r\n\r\n  { TObjectBucketList }\r\n\r\n  TObjectBucketList = class(TBucketList)\r\n  protected\r\n    Function GetData(AItem: TObject): TObject; reintroduce;\r\n    Procedure SetData(AItem: TObject; const AData: TObject); reintroduce;\r\n  public\r\n    Function Add(AItem, AData: TObject): TObject; reintroduce;\r\n    Function Remove(AItem: TObject): TObject; reintroduce;\r\n    property Data[AItem: TObject]: TObject read GetData write SetData; default;\r\n  end;\r\n\r\n\r\nimplementation\r\n\r\nuses\r\n  js;\r\n\r\nResourceString\r\n  DuplicateMsg   = 'An item with key %0:s already exists';\r\n  //KeyNotFoundMsg = 'Method: %0:s key [''%1:s''] not found in container';\r\n  NotEmptyMsg    = 'Hash table not empty.';\r\n  SErrNoSuchItem = 'No item in list for %p';\r\n  SDuplicateItem = 'Item already exists in list: %p';\r\n\r\nconst\r\n  NPRIMES = 28;\r\n\r\n  PRIMELIST: array[0 .. NPRIMES-1] of Longword =\r\n  ( 53,         97,         193,       389,       769,\r\n    1543,       3079,       6151,      12289,     24593,\r\n    49157,      98317,      196613,    393241,    786433,\r\n    1572869,    3145739,    6291469,   12582917,  25165843,\r\n    50331653,   100663319,  201326611, 402653189, 805306457,\r\n    1610612741, 3221225473, 4294967291 );\r\n\r\nconstructor TFPObjectList.Create(FreeObjects : boolean);\r\nbegin\r\n  Create;\r\n  FFreeObjects:=Freeobjects;\r\nend;\r\n\r\ndestructor TFPObjectList.Destroy;\r\nbegin\r\n  if (FList <> nil) then\r\n  begin\r\n    Clear;\r\n    FList.Destroy;\r\n  end;\r\n  inherited Destroy;\r\nend;\r\n\r\nProcedure TFPObjectList.Clear;\r\nvar\r\n  i: integer;\r\n  O : TObject;\r\nbegin\r\n  if FFreeObjects then\r\n    for i:=FList.Count-1 downto 0 do\r\n      begin\r\n      O:=TObject(FList[i]);\r\n      FList[i]:=Nil;\r\n      O.Free;\r\n      end;\r\n  FList.Clear;\r\nend;\r\n\r\nconstructor TFPObjectList.Create;\r\nbegin\r\n  inherited Create;\r\n  FList:=TFPList.Create;\r\n  FFreeObjects:=True;\r\nend;\r\n\r\nFunction TFPObjectList.GetCount: integer;\r\nbegin\r\n  Result:=FList.Count;\r\nend;\r\n\r\nProcedure TFPObjectList.SetCount(const AValue: integer);\r\nbegin\r\n  if FList.Count <> AValue then\r\n    FList.Count:=AValue;\r\nend;\r\n\r\nFunction TFPObjectList.GetItem(Index: Integer): TObject;\r\nbegin\r\n  Result:=TObject(FList[Index]);\r\nend;\r\n\r\nProcedure TFPObjectList.SetItem(Index: Integer; AObject: TObject);\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  if OwnsObjects then\r\n    begin\r\n    O:=TObject(FList[Index]);\r\n    FList[Index]:=AObject;\r\n    O.Free;\r\n    end\r\n  else\r\n    FList[index]:=AObject;\r\nend;\r\n\r\nProcedure TFPObjectList.SetCapacity(NewCapacity: Integer);\r\nbegin\r\n  FList.Capacity:=NewCapacity;\r\nend;\r\n\r\nFunction TFPObjectList.GetCapacity: integer;\r\nbegin\r\n  Result:=FList.Capacity;\r\nend;\r\n\r\nFunction TFPObjectList.Add(AObject: TObject): Integer;\r\nbegin\r\n  Result:=FList.Add(AObject);\r\nend;\r\n\r\nProcedure TFPObjectList.Delete(Index: Integer);\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  if OwnsObjects then\r\n    begin\r\n    O:=TObject(FList[Index]);\r\n    FList[Index]:=Nil;\r\n    O.Free;\r\n    end;\r\n  FList.Delete(Index);\r\nend;\r\n\r\nProcedure TFPObjectList.Exchange(Index1, Index2: Integer);\r\nbegin\r\n  FList.Exchange(Index1, Index2);\r\nend;\r\n\r\nFunction TFPObjectList.Expand: TFPObjectList;\r\nbegin\r\n  FList.Expand;\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TFPObjectList.Extract(Item: TObject): TObject;\r\nbegin\r\n  Result:=TObject(FList.Extract(Item));\r\nend;\r\n\r\nFunction TFPObjectList.Remove(AObject: TObject): Integer;\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  Result:=IndexOf(AObject);\r\n  if (Result <> -1) then\r\n    begin\r\n    if OwnsObjects then\r\n      begin\r\n      O:=TObject(FList[Result]);\r\n      FList[Result]:=Nil;\r\n      O.Free;\r\n      end;\r\n    FList.Delete(Result);\r\n    end;\r\nend;\r\n\r\nFunction TFPObjectList.IndexOf(AObject: TObject): Integer;\r\nbegin\r\n  Result:=FList.IndexOf(JSValue(AObject));\r\nend;\r\n\r\nFunction TFPObjectList.FindInstanceOf(AClass: TClass; AExact: Boolean; AStartAt : Integer): Integer;\r\nvar\r\n  I : Integer;\r\nbegin\r\n  I:=AStartAt;\r\n  Result:=-1;\r\n  if AExact then\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].ClassType=AClass then\r\n        Result:=I\r\n      else\r\n        Inc(I)\r\n  else\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].InheritsFrom(AClass) then\r\n        Result:=I\r\n      else\r\n        Inc(I);\r\nend;\r\n\r\nProcedure TFPObjectList.Insert(Index: Integer; AObject: TObject);\r\nbegin\r\n  FList.Insert(Index, JSValue(AObject));\r\nend;\r\n\r\nProcedure TFPObjectList.Move(CurIndex, NewIndex: Integer);\r\nbegin\r\n  FList.Move(CurIndex, NewIndex);\r\nend;\r\n\r\nProcedure TFPObjectList.Assign(Obj: TFPObjectList);\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Clear;\r\n  for i:=0 to Obj.Count - 1 do\r\n    Add(Obj[i]);\r\nend;\r\n\r\nProcedure TFPObjectList.Pack;\r\nbegin\r\n  FList.Pack;\r\nend;\r\n\r\nProcedure TFPObjectList.Sort(Compare: TListSortCompare);\r\nbegin\r\n  FList.Sort(Compare);\r\nend;\r\n\r\nFunction TFPObjectList.First: TObject;\r\nbegin\r\n  Result:=TObject(FList.First);\r\nend;\r\n\r\nFunction TFPObjectList.Last: TObject;\r\nbegin\r\n  Result:=TObject(FList.Last);\r\nend;\r\n\r\nProcedure TFPObjectList.ForEachCall(proc2call:TObjectListCallback;arg:JSValue);\r\nbegin\r\n  FList.ForEachCall(TListCallBack(proc2call),arg);\r\nend;\r\n\r\n{ TObjectList }\r\n\r\nconstructor TObjectList.Create(FreeObjects: boolean);\r\nbegin\r\n  inherited Create;\r\n  FFreeObjects:=FreeObjects;\r\nend;\r\n\r\nconstructor TObjectList.Create;\r\nbegin\r\n  inherited Create;\r\n  FFreeObjects:=True;\r\nend;\r\n\r\nProcedure TObjectList.Notify(Ptr: JSValue; Action: TListNotification);\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  if FFreeObjects then\r\n    if (Action=lnDeleted) then\r\n      begin\r\n      O:=TObject(Ptr);\r\n      O.Free;\r\n      end;\r\n  inherited Notify(Ptr,Action);\r\nend;\r\n\r\n\r\nFunction TObjectList.GetItem(Index: Integer): TObject;\r\nbegin\r\n  Result:=TObject(inherited Get(Index));\r\nend;\r\n\r\n\r\nProcedure TObjectList.SetItem(Index: Integer; AObject: TObject);\r\nbegin\r\n  // Put will take care of deleting old one in Notify.\r\n  Put(Index,JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.Add(AObject: TObject): Integer;\r\nbegin\r\n  Result:=inherited Add(JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.Extract(Item: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Extract(JSValue(Item)));\r\nend;\r\n\r\n\r\nFunction TObjectList.Remove(AObject: TObject): Integer;\r\nbegin\r\n  Result:=inherited Remove(JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.IndexOf(AObject: TObject): Integer;\r\nbegin\r\n  Result:=inherited IndexOf(JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.FindInstanceOf(AClass: TClass; AExact: Boolean;\r\n  AStartAt: Integer): Integer;\r\nvar\r\n  I : Integer;\r\nbegin\r\n  I:=AStartAt;\r\n  Result:=-1;\r\n  if AExact then\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].ClassType=AClass then\r\n        Result:=I\r\n      else\r\n        Inc(I)\r\n  else\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].InheritsFrom(AClass) then\r\n        Result:=I\r\n      else\r\n        Inc(I);\r\nend;\r\n\r\n\r\nProcedure TObjectList.Insert(Index: Integer; AObject: TObject);\r\nbegin\r\n  Inherited Insert(Index,JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.First: TObject;\r\nbegin\r\n  Result:=TObject(inherited First);\r\nend;\r\n\r\n\r\nFunction TObjectList.Last: TObject;\r\nbegin\r\n  Result:=TObject(inherited Last);\r\nend;\r\n\r\n{ TListComponent }\r\n\r\ntype\r\n  TlistComponent = class(TComponent)\r\n  private\r\n    Flist : TComponentList;\r\n  public\r\n    Procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n  end;\r\n\r\nProcedure TlistComponent.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  if (Operation=opRemove) then\r\n    Flist.HandleFreeNotify(Self,AComponent);\r\n  inherited;\r\nend;\r\n\r\n{ TComponentList }\r\n\r\nFunction TComponentList.Add(AComponent: TComponent): Integer;\r\nbegin\r\n  Result:=inherited Add(AComponent);\r\nend;\r\n\r\ndestructor TComponentList.Destroy;\r\nbegin\r\n  inherited;\r\n  FreeAndNil(FNotifier);\r\nend;\r\n\r\nFunction TComponentList.Extract(Item: TComponent): TComponent;\r\nbegin\r\n  Result:=TComponent(inherited Extract(Item));\r\nend;\r\n\r\nFunction TComponentList.First: TComponent;\r\nbegin\r\n  Result:=TComponent(inherited First);\r\nend;\r\n\r\nFunction TComponentList.GetItems(Index: Integer): TComponent;\r\nbegin\r\n  Result:=TComponent(inherited Items[Index]);\r\nend;\r\n\r\nProcedure TComponentList.HandleFreeNotify(Sender: TObject;\r\n  AComponent: TComponent);\r\nbegin\r\n  Extract(AComponent);\r\n  if Sender=nil then ;\r\nend;\r\n\r\nFunction TComponentList.IndexOf(AComponent: TComponent): Integer;\r\nbegin\r\n  Result:=inherited IndexOf(AComponent);\r\nend;\r\n\r\nProcedure TComponentList.Insert(Index: Integer; AComponent: TComponent);\r\nbegin\r\n  inherited Insert(Index,AComponent)\r\nend;\r\n\r\nFunction TComponentList.Last: TComponent;\r\nbegin\r\n  Result:=TComponent(inherited Last);\r\nend;\r\n\r\nProcedure TComponentList.Notify(Ptr: JSValue; Action: TListNotification);\r\nbegin\r\n  if FNotifier=nil then\r\n    begin\r\n    FNotifier:=TlistComponent.Create(nil);\r\n    TlistComponent(FNotifier).FList:=Self;\r\n    end;\r\n  if Assigned(Ptr) then\r\n    with TComponent(Ptr) do\r\n      case Action of\r\n        lnAdded : FreeNotification(FNotifier);\r\n        lnExtracted, lnDeleted: RemoveFreeNotification(FNotifier);\r\n      end;\r\n  inherited Notify(Ptr, Action);\r\nend;\r\n\r\nFunction TComponentList.Remove(AComponent: TComponent): Integer;\r\nbegin\r\n  Result:=inherited Remove(AComponent);\r\nend;\r\n\r\nProcedure TComponentList.SetItems(Index: Integer; AComponent: TComponent);\r\nbegin\r\n  Put(Index,AComponent);\r\nend;\r\n\r\n{ TClassList }\r\n\r\nFunction TClassList.Add(AClass: TClass): Integer;\r\nbegin\r\n  Result:=inherited Add(JSValue(AClass));\r\nend;\r\n\r\nFunction TClassList.Extract(Item: TClass): TClass;\r\nbegin\r\n  Result:=TClass(inherited Extract(JSValue(Item)));\r\nend;\r\n\r\nFunction TClassList.First: TClass;\r\nbegin\r\n  Result:=TClass(inherited First);\r\nend;\r\n\r\nFunction TClassList.GetItems(Index: Integer): TClass;\r\nbegin\r\n  Result:=TClass(inherited Items[Index]);\r\nend;\r\n\r\nFunction TClassList.IndexOf(AClass: TClass): Integer;\r\nbegin\r\n  Result:=inherited IndexOf(JSValue(AClass));\r\nend;\r\n\r\nProcedure TClassList.Insert(Index: Integer; AClass: TClass);\r\nbegin\r\n  inherited Insert(Index,JSValue(AClass));\r\nend;\r\n\r\nFunction TClassList.Last: TClass;\r\nbegin\r\n  Result:=TClass(inherited Last);\r\nend;\r\n\r\nFunction TClassList.Remove(AClass: TClass): Integer;\r\nbegin\r\n  Result:=inherited Remove(JSValue(AClass));\r\nend;\r\n\r\nProcedure TClassList.SetItems(Index: Integer; AClass: TClass);\r\nbegin\r\n  Put(Index,JSValue(AClass));\r\nend;\r\n\r\n{ TOrderedList }\r\n\r\nFunction TOrderedList.AtLeast(ACount: Integer): Boolean;\r\nbegin\r\n  Result:=(FList.Count>=Acount)\r\nend;\r\n\r\nFunction TOrderedList.Count: Integer;\r\nbegin\r\n  Result:=FList.Count;\r\nend;\r\n\r\nconstructor TOrderedList.Create;\r\nbegin\r\n  FList:=Tlist.Create;\r\nend;\r\n\r\ndestructor TOrderedList.Destroy;\r\nbegin\r\n  FList.Free;\r\nend;\r\n\r\nFunction TOrderedList.Peek: JSValue;\r\nbegin\r\n  if AtLeast(1) then\r\n    Result:=PeekItem\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nFunction TOrderedList.PeekItem: JSValue;\r\n\r\nbegin\r\n  with Flist do\r\n    Result:=Items[Count-1]\r\nend;\r\n\r\nFunction TOrderedList.Pop: JSValue;\r\nbegin\r\n  If Atleast(1) then\r\n    Result:=PopItem\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nFunction TOrderedList.PopItem: JSValue;\r\nbegin\r\n  with FList do\r\n    if Count>0 then\r\n      begin\r\n      Result:=Items[Count-1];\r\n      Delete(Count-1);\r\n      end\r\n    else\r\n      Result:=nil;\r\nend;\r\n\r\nFunction TOrderedList.Push(AItem: JSValue): JSValue;\r\nbegin\r\n  PushItem(AItem);\r\n  Result:=AItem;\r\nend;\r\n\r\n{ TStack }\r\n\r\nProcedure TStack.PushItem(AItem: JSValue);\r\nbegin\r\n  FList.Add(AItem);\r\nend;\r\n\r\n{ TObjectStack }\r\n\r\nFunction TObjectStack.Peek: TObject;\r\nbegin\r\n  Result:=TObject(inherited Peek);\r\nend;\r\n\r\nFunction TObjectStack.Pop: TObject;\r\nbegin\r\n  Result:=TObject(Inherited Pop);\r\nend;\r\n\r\nFunction TObjectStack.Push(AObject: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Push(JSValue(AObject)));\r\nend;\r\n\r\n{ TQueue }\r\n\r\nProcedure TQueue.PushItem(AItem: JSValue);\r\nbegin\r\n  with FList Do\r\n    Insert(0,AItem);\r\nend;\r\n\r\n{ TObjectQueue }\r\n\r\nFunction TObjectQueue.Peek: TObject;\r\nbegin\r\n  Result:=TObject(inherited Peek);\r\nend;\r\n\r\nFunction TObjectQueue.Pop: TObject;\r\nbegin\r\n  Result:=TObject(inherited Pop);\r\nend;\r\n\r\nFunction TObjectQueue.Push(AObject: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Push(JSValue(AObject)));\r\nend;\r\n\r\n\r\n{*****************************************************************************\r\n                            TFPHashList\r\n*****************************************************************************}\r\n(*\r\n    Function FPHash(const s:shortstring):LongWord;\r\n    var\r\n      p,pmax : PChar;\r\n    begin\r\n{$push}\r\n{$Q-}\r\n      Result:=0;\r\n      p:=@s[1];\r\n      pmax:=@s[length(s)+1];\r\n      while (p<pmax) do\r\n        begin\r\n          Result:=LongWord(LongInt(Result shl 5) - LongInt(Result)) xor LongWord(P^);\r\n          Inc(p);\r\n        end;\r\n{$pop}\r\n    end;\r\n\r\n    Function FPHash(P: PChar; Len: Integer): LongWord;\r\n    var\r\n      pmax : PChar;\r\n    begin\r\n{$push}\r\n{$Q-}\r\n      Result:=0;\r\n      pmax:=p+len;\r\n      while (p<pmax) do\r\n        begin\r\n          Result:=LongWord(LongInt(Result shl 5) - LongInt(Result)) xor LongWord(P^);\r\n          Inc(p);\r\n        end;\r\n{$pop}\r\n    end;\r\n\r\n*)\r\n\r\n{ ---------------------------------------------------------------------\r\n    Hash support, by Dean Zobec\r\n  ---------------------------------------------------------------------}\r\n\r\n{ Default hash Function }\r\n\r\nFunction RSHash(const S: string; const TableSize: Longword): Longword;\r\nconst\r\n  b = 378551;\r\nvar\r\n  a: Longword;\r\n  i: Longword;\r\nbegin\r\n  a:=63689;\r\n  Result:=0;\r\n  if length(s)>0 then\r\n    for i:=1 to Length(S) do\r\n      begin\r\n      Result:=Result * a + Ord(S[i]);\r\n      a:=a * b;\r\n      end;\r\n  Result:=(Result and $7FFFFFFF) mod TableSize;\r\nend;\r\n\r\n{ THTNode }\r\n\r\nconstructor THTCustomNode.CreateWith(const AString: string);\r\nbegin\r\n  inherited Create;\r\n  FKey:=AString;\r\nend;\r\n\r\nFunction THTCustomNode.HasKey(const AKey: string): boolean;\r\nbegin\r\n  Result:=(AKey=FKey);\r\nend;\r\n\r\n{ TFPCustomHashTable }\r\n\r\nconstructor TFPCustomHashTable.Create;\r\nbegin\r\n  CreateWith(196613,@RSHash);\r\nend;\r\n\r\nconstructor TFPCustomHashTable.CreateWith(AHashTableSize: Longword;\r\n  aHashFunc: THashFunction);\r\nbegin\r\n  inherited Create;\r\n  FHashTable:=TFPObjectList.Create(True);\r\n  HashTableSize:=AHashTableSize;\r\n  FHashFunction:=aHashFunc;\r\nend;\r\n\r\ndestructor TFPCustomHashTable.Destroy;\r\nbegin\r\n  FHashTable.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetDensity: Longword;\r\nbegin\r\n  Result:=FHashTableSize - VoidSlots\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetNumberOfCollisions: Longword;\r\nbegin\r\n  Result:=FCount -(FHashTableSize - VoidSlots)\r\nend;\r\n\r\nProcedure TFPCustomHashTable.SetHashTableSize(const Value: Longword);\r\nvar\r\n  i: Longword;\r\n  newSize: Longword;\r\nbegin\r\n  if Value <> FHashTableSize then\r\n    begin\r\n    i:=0;\r\n    while (PRIMELIST[i] < Value) and (i < 27) do\r\n     Inc(i);\r\n    newSize:=PRIMELIST[i];\r\n    if Count = 0 then\r\n      begin\r\n      FHashTableSize:=newSize;\r\n      InitializeHashTable;\r\n      end\r\n    else\r\n      ChangeTableSize(newSize);\r\n    end;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.InitializeHashTable;\r\nvar\r\n  i: LongWord;\r\nbegin\r\n  if FHashTableSize>0 Then\r\n    for i:=0 to FHashTableSize-1 do\r\n      FHashTable.Add(nil);\r\n  FCount:=0;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.ChangeTableSize(const ANewSize: Longword);\r\nvar\r\n  SavedTable, List: TFPObjectList;\r\n  SavedTableSize: Longword;\r\n  i, j: Longword;\r\n  temp: THTCustomNode;\r\nbegin\r\n  SavedTable:=FHashTable;\r\n  SavedTableSize:=FHashTableSize;\r\n  FHashTableSize:=ANewSize;\r\n  FHashTable:=TFPObjectList.Create(True);\r\n  InitializeHashTable;\r\n  if SavedTableSize>0 Then\r\n    for i:=0 to SavedTableSize-1 do\r\n      begin\r\n      List:=TFPObjectList(SavedTable[i]);\r\n      if Assigned(List) then\r\n        for j:=0 to List.Count -1 do\r\n          begin\r\n          temp:=THTCustomNode(List[j]);\r\n          AddNode(temp);\r\n          end;\r\n      end;\r\n  SavedTable.Free;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.SetHashFunction(AHashFunction: THashFunction);\r\nbegin\r\n  if IsEmpty then\r\n    FHashFunction:=AHashFunction\r\n  else\r\n    raise Exception.Create(NotEmptyMsg);\r\nend;\r\n\r\nFunction TFPCustomHashTable.Find(const aKey: string): THTCustomNode;\r\nvar\r\n  hashCode: Longword;\r\n  chn: TFPObjectList;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  chn:=Chain(hashCode);\r\n  if Assigned(chn) then\r\n    if chn.count>0 then\r\n      for i:=0 to chn.Count - 1 do\r\n        if THTCustomNode(chn[i]).Key=aKey then\r\n          Exit(THTCustomNode(chn[i]));\r\n  Result:=nil;\r\nend;\r\n\r\nFunction TFPCustomHashTable.FindChainForAdd(Const aKey : String) : TFPObjectList;\r\nvar\r\n  hashCode: Longword;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  Result:=Chain(hashCode);\r\n  if Assigned(Result)  then\r\n    begin\r\n    if Result.count>0 then\r\n      for i:=0 to Result.Count - 1 do\r\n        if (THTCustomNode(Result[i]).Key=aKey) then\r\n          raise EDuplicate.CreateFmt(DuplicateMsg, [aKey]);\r\n    end\r\n  else\r\n    begin\r\n    FHashTable[hashcode]:=TFPObjectList.Create(True);\r\n    Result:=Chain(hashCode);\r\n    end;\r\n  Inc(FCount);\r\nend;\r\n\r\n\r\nProcedure TFPCustomHashTable.Delete(const aKey: string);\r\nvar\r\n  hashCode: Longword;\r\n  chn: TFPObjectList;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  chn:=Chain(hashCode);\r\n  if Assigned(chn) then\r\n    if chn.count>0 then\r\n      for i:=0 to chn.Count - 1 do\r\n        if THTCustomNode(chn[i]).Key=aKey then\r\n          begin\r\n          chn.Delete(i);\r\n          dec(FCount);\r\n          Exit;\r\n          end;\r\nend;\r\n\r\nFunction TFPCustomHashTable.IsEmpty: boolean;\r\nbegin\r\n  Result:=(FCount = 0);\r\nend;\r\n\r\nFunction TFPCustomHashTable.Chain(const index: Longword): TFPObjectList;\r\nbegin\r\n  Result:=TFPObjectList(FHashTable[index]);\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetVoidSlots: Longword;\r\nvar\r\n  i: Longword;\r\n  num: Longword;\r\nbegin\r\n  num:=0;\r\n  if FHashTableSize>0 then\r\n    for i:= 0 to FHashTableSize-1 do\r\n      if not Assigned(Chain(i)) then\r\n        Inc(num);\r\n  Result:=num;\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetLoadFactor: double;\r\nbegin\r\n  Result:=Count / FHashTableSize;\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetAVGChainLen: double;\r\nbegin\r\n  Result:=Count / (FHashTableSize - VoidSlots);\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetMaxChainLength: Longword;\r\nvar\r\n  i: Longword;\r\nbegin\r\n  Result:=0;\r\n  if FHashTableSize>0 Then\r\n   for i:=0 to FHashTableSize-1 do\r\n      if ChainLength(i) > Result then\r\n        Result:=ChainLength(i);\r\nend;\r\n\r\nFunction TFPCustomHashTable.FindOrCreateNew(const aKey: string): THTCustomNode;\r\nvar\r\n  hashCode: Longword;\r\n  chn: TFPObjectList;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  chn:=Chain(hashCode);\r\n  if Assigned(chn)  then\r\n    begin\r\n    if chn.count>0 then\r\n      for i:=0 to chn.Count - 1 do\r\n        if (THTCustomNode(chn[i]).Key=aKey) then\r\n          Exit(THTNode(chn[i]));\r\n    end\r\n  else\r\n    begin\r\n    FHashTable[hashcode]:=TFPObjectList.Create(true);\r\n    chn:=Chain(hashcode);\r\n    end;\r\n  Inc(FCount);\r\n  Result:=CreateNewNode(aKey);\r\n  chn.Add(Result);\r\nend;\r\n\r\nFunction TFPCustomHashTable.ChainLength(const ChainIndex: Longword): Longword;\r\nbegin\r\n  if Assigned(Chain(ChainIndex)) then\r\n    Result:=Chain(ChainIndex).Count\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.Clear;\r\nvar\r\n  i: Longword;\r\nbegin\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize - 1 do\r\n      if Assigned(Chain(i)) then\r\n        Chain(i).Clear;\r\n  FCount:=0;\r\nend;\r\n\r\n\r\n\r\n{ TFPDataHashTable }\r\n\r\nProcedure TFPDataHashTable.Add(const aKey: string; aItem: JSValue);\r\nvar\r\n  chn: TFPObjectList;\r\n  NewNode: THtDataNode;\r\nbegin\r\n  chn:=FindChainForAdd(akey);\r\n  NewNode:=THtDataNode(CreateNewNode(aKey));\r\n  NewNode.Data:=aItem;\r\n  chn.Add(NewNode);\r\nend;\r\n\r\nFunction TFPDataHashTable.GetData(const Index: string): JSValue;\r\nvar\r\n  node: THTDataNode;\r\nbegin\r\n  node:=THTDataNode(Find(Index));\r\n  if Assigned(node) then\r\n    Result:=node.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPDataHashTable.SetData(const index: string; const AValue: JSValue);\r\nbegin\r\n  THTDataNode(FindOrCreateNew(index)).Data:=AValue;\r\nend;\r\n\r\nFunction TFPDataHashTable.CreateNewNode(const aKey : string) : THTCustomNode;\r\n\r\nbegin\r\n  Result:=THTDataNode.CreateWith(aKey);\r\nend;\r\n\r\nFunction TFPDataHashTable.Iterate(aMethod: TDataIteratorMethod): JSValue;\r\nvar\r\n  N : THTDataNode;\r\nbegin\r\n  N:=ForEachCall(AMethod);\r\n  if Assigned(N) then\r\n    Result:=N.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPDataHashTable.CallbackIterator(Item: JSValue; const Key: string; var Continue: Boolean);\r\nbegin\r\n  FIteratorCallBack(Item, Key, Continue);\r\nend;\r\n\r\nFunction TFPDataHashTable.Iterate(aMethod: TDataIteratorCallBack): JSValue;\r\nbegin\r\n  FIteratorCallBack := aMethod;\r\n  Result := Iterate(@CallbackIterator);\r\nend;\r\n\r\nFunction TFPDataHashTable.ForEachCall(aMethod: TDataIteratorMethod): THTDataNode;\r\nvar\r\n  i, j: Longword;\r\n  continue: Boolean;\r\nbegin\r\n  Result:=nil;\r\n  continue:=true;\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize-1 do\r\n      if Assigned(Chain(i)) then\r\n        if chain(i).count>0 then\r\n          for j:=0 to Chain(i).Count-1 do\r\n            begin\r\n            aMethod(THTDataNode(Chain(i)[j]).Data, THTDataNode(Chain(i)[j]).Key, continue);\r\n            if not continue then\r\n              begin\r\n              Result:=THTDataNode(Chain(i)[j]);\r\n              Exit;\r\n              end;\r\n           end;\r\nend;\r\n\r\nProcedure TFPDataHashTable.AddNode(ANode : THTCustomNode);\r\nbegin\r\n  with THTDataNode(ANode) do\r\n    Add(Key,Data);\r\nend;\r\n\r\n{ TFPStringHashTable }\r\n\r\nProcedure TFPStringHashTable.AddNode(ANode : THTCustomNode);\r\nbegin\r\n  with THTStringNode(ANode) do\r\n    Add(Key,Data);\r\nend;\r\n\r\nFunction TFPStringHashTable.GetData(const Index: string): String;\r\nvar\r\n  node: THTStringNode;\r\nbegin\r\n  node:=THTStringNode(Find(Index));\r\n  if Assigned(node) then\r\n    Result:=node.Data\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nProcedure TFPStringHashTable.SetData(const index, AValue: string);\r\nbegin\r\n  THTStringNode(FindOrCreateNew(index)).Data:=AValue;\r\nend;\r\n\r\nProcedure TFPStringHashTable.Add(const aKey, aItem: string);\r\nvar\r\n  chn: TFPObjectList;\r\n  NewNode: THtStringNode;\r\nbegin\r\n  chn:=FindChainForAdd(akey);\r\n  NewNode:=THtStringNode(CreateNewNode(aKey));\r\n  NewNode.Data:=aItem;\r\n  chn.Add(NewNode);\r\nend;\r\n\r\nFunction TFPStringHashTable.CreateNewNode(const aKey : string) : THTCustomNode;\r\nbegin\r\n  Result:=THTStringNode.CreateWith(aKey);\r\nend;\r\n\r\nFunction TFPStringHashTable.Iterate(aMethod: TStringIteratorMethod): String;\r\nvar\r\n  N : THTStringNode;\r\nbegin\r\n  N:=ForEachCall(AMethod);\r\n  if Assigned(N) then\r\n    Result:=N.Data\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nProcedure TFPStringHashTable.CallbackIterator(Item: String; const Key: string; var Continue: Boolean);\r\nbegin\r\n  FIteratorCallBack(Item, Key, Continue);\r\nend;\r\n\r\nFunction TFPStringHashTable.Iterate(aMethod: TStringIteratorCallback): String;\r\nbegin\r\n  FIteratorCallBack := aMethod;\r\n  Result := Iterate(@CallbackIterator);\r\nend;\r\n\r\nFunction TFPStringHashTable.ForEachCall(aMethod: TStringIteratorMethod): THTStringNode;\r\nvar\r\n  i, j: Longword;\r\n  continue: boolean;\r\nbegin\r\n  Result:=nil;\r\n  continue:=True;\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize-1 do\r\n      if Assigned(Chain(i)) then\r\n        if chain(i).Count>0 then\r\n          for j:=0 to Chain(i).Count-1 do\r\n            begin\r\n            aMethod(THTStringNode(Chain(i)[j]).Data, THTStringNode(Chain(i)[j]).Key, continue);\r\n            if not continue then\r\n              begin\r\n              Result:=THTStringNode(Chain(i)[j]);\r\n              Exit;\r\n              end;\r\n            end;\r\nend;\r\n\r\n{ TFPObjectHashTable }\r\n\r\nProcedure TFPObjectHashTable.AddNode(ANode : THTCustomNode);\r\nbegin\r\n  With THTObjectNode(ANode) do\r\n    Add(Key,Data);\r\nend;\r\n\r\nFunction TFPObjectHashTable.GetData(const Index: string): TObject;\r\nvar\r\n  node: THTObjectNode;\r\nbegin\r\n  node:=THTObjectNode(Find(Index));\r\n  if Assigned(node) then\r\n    Result:=node.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPObjectHashTable.SetData(const index : string; AObject : TObject);\r\nbegin\r\n  THTObjectNode(FindOrCreateNew(index)).Data:=AObject;\r\nend;\r\n\r\nProcedure TFPObjectHashTable.Add(const aKey: string; AItem : TObject);\r\nvar\r\n  chn: TFPObjectList;\r\n  NewNode: THTObjectNode;\r\nbegin\r\n  chn:=FindChainForAdd(akey);\r\n  NewNode:=THTObjectNode(CreateNewNode(aKey));\r\n  NewNode.Data:=aItem;\r\n  chn.Add(NewNode);\r\nend;\r\n\r\nFunction TFPObjectHashTable.CreateNewNode(const aKey : string) : THTCustomNode;\r\nbegin\r\n  if OwnsObjects then\r\n    Result:=THTOwnedObjectNode.CreateWith(aKey)\r\n  else\r\n    Result:=THTObjectNode.CreateWith(aKey);\r\nend;\r\n\r\n\r\nFunction TFPObjectHashTable.Iterate(aMethod: TObjectIteratorMethod): TObject;\r\nvar\r\n  N : THTObjectNode;\r\nbegin\r\n  N:=ForEachCall(AMethod);\r\n  if Assigned(N) then\r\n    Result:=N.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPObjectHashTable.CallbackIterator(Item: TObject; const Key: string; var Continue: Boolean);\r\nbegin\r\n  FIteratorCallBack(Item, Key, Continue);\r\nend;\r\n\r\nFunction TFPObjectHashTable.Iterate(aMethod: TObjectIteratorCallback): TObject;\r\nbegin\r\n  FIteratorCallBack := aMethod;\r\n  Result := Iterate(@CallbackIterator);\r\nend;\r\n\r\nFunction TFPObjectHashTable.ForEachCall(aMethod: TObjectIteratorMethod): THTObjectNode;\r\nvar\r\n  i, j: Longword;\r\n  continue: boolean;\r\nbegin\r\n  Result:=nil;\r\n  continue:=true;\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize-1 do\r\n      if Assigned(Chain(i)) then\r\n        if Chain(i).Count>0 then\r\n          for j:=0 to Chain(i).Count-1 do\r\n           begin\r\n           aMethod(THTObjectNode(Chain(i)[j]).Data, THTObjectNode(Chain(i)[j]).Key, continue);\r\n           if not continue then\r\n             begin\r\n             Result:=THTObjectNode(Chain(i)[j]);\r\n             Exit;\r\n             end;\r\n           end;\r\nend;\r\n\r\nconstructor TFPObjectHashTable.Create(AOwnsObjects : Boolean = True);\r\nbegin\r\n  inherited Create;\r\n  FOwnsObjects:=AOwnsObjects;\r\nend;\r\n\r\nconstructor TFPObjectHashTable.CreateWith(AHashTableSize: Longword; aHashFunc: THashFunction; AOwnsObjects : Boolean = True);\r\nbegin\r\n  inherited CreateWith(AHashTableSize,AHashFunc);\r\n  FOwnsObjects:=AOwnsObjects;\r\nend;\r\n\r\ndestructor THTOwnedObjectNode.Destroy;\r\nbegin\r\n  FreeAndNil(FData);\r\n  inherited;\r\nend;\r\n\r\n{ TCustomBucketList }\r\n\r\nFunction TCustomBucketList.GetData(AItem: JSValue): JSValue;\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  GetBucketItem(AItem,B,I);\r\n  Result:=FBuckets[B].Items[I].Data;\r\nend;\r\n\r\nFunction TCustomBucketList.GetBucketCount: Integer;\r\nbegin\r\n  Result:=Length(FBuckets);\r\nend;\r\n\r\nProcedure TCustomBucketList.SetData(AItem: JSValue; const AData: JSValue);\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  GetBucketItem(AItem,B,I);\r\n  FBuckets[B].Items[I].Data:=AData;\r\nend;\r\n\r\nProcedure TCustomBucketList.SetBucketCount(const Value: Integer);\r\nbegin\r\n  if (Value<>GetBucketCount) then\r\n    SetLength(FBuckets,Value);\r\nend;\r\n\r\nProcedure TCustomBucketList.GetBucketItem(AItem: JSValue; out ABucket,\r\n  AIndex: Integer);\r\nbegin\r\n  if not FindItem(AItem,ABucket,AIndex) then\r\n    Error(SErrNoSuchItem,[AItem]);\r\nend;\r\n\r\nFunction TCustomBucketList.AddItem(ABucket: Integer; AItem, AData: JSValue\r\n  ): JSValue;\r\nvar\r\n  L : Integer;\r\nbegin\r\n  L:=Length(FBuckets[ABucket].Items);\r\n  if (FBuckets[ABucket].Count=L) then\r\n    begin\r\n    if L<8 then\r\n      L:=8\r\n    else\r\n      L:=L+L div 2;\r\n    SetLength(FBuckets[ABucket].Items,L);\r\n    end;\r\n  with FBuckets[ABucket] do\r\n    begin\r\n    Items[Count].Item:=AItem;\r\n    Items[Count].Data:=AData;\r\n    Result:=AData;\r\n    Inc(Count);\r\n    end;\r\nend;\r\n\r\nFunction TCustomBucketList.DeleteItem(ABucket: Integer; AIndex: Integer): JSValue;\r\nvar\r\n  I,L : Integer;\r\nbegin\r\n  Result:=FBuckets[ABucket].Items[AIndex].Data;\r\n  if FBuckets[ABucket].Count=1 then\r\n    SetLength(FBuckets[ABucket].Items,0)\r\n  else\r\n    begin\r\n    L:=(FBuckets[ABucket].Count-AIndex-1);// No point in moving if last one...\r\n    For I:=0 to L-1 do\r\n      FBuckets[ABucket].Items[AIndex+I]:=FBuckets[ABucket].Items[AIndex+I+1];\r\n    end;\r\n  Dec(FBuckets[ABucket].Count);\r\nend;\r\n\r\nProcedure TCustomBucketList.Error(Msg: String; Args: array of JSValue);\r\nbegin\r\n  raise ElistError.CreateFmt(Msg,Args);\r\nend;\r\n\r\nFunction TCustomBucketList.FindItem(AItem: JSValue; out ABucket, AIndex: Integer\r\n  ): Boolean;\r\nvar\r\n  I : Integer;\r\n  B : TBucket;\r\nbegin\r\n  ABucket:=BucketFor(AItem);\r\n  B:=FBuckets[ABucket];\r\n  I:=B.Count-1;\r\n  while (I>=0) and (B.Items[I].Item<>AItem) do\r\n    Dec(I);\r\n  Result:=I>=0;\r\n  if Result then\r\n    AIndex:=I;\r\nend;\r\n\r\ndestructor TCustomBucketList.Destroy;\r\nbegin\r\n  Clear;\r\n  inherited Destroy;\r\nend;\r\n\r\nProcedure TCustomBucketList.Clear;\r\nvar\r\n  B : TBucket;\r\n  I,J : Integer;\r\nbegin\r\n  for I:=0 to Length(FBuckets)-1 do\r\n    begin\r\n    B:=FBuckets[I];\r\n    for J:=B.Count-1 downto 0 do\r\n      DeleteItem(I,J);\r\n    end;\r\n  SetLength(FBuckets,0);\r\nend;\r\n\r\nFunction TCustomBucketList.Add(AItem, AData: JSValue): JSValue;\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  if FindItem(AItem,B,I) then\r\n    Error(SDuplicateItem,[AItem]);\r\n  Result:=AddItem(B,AItem,AData);\r\nend;\r\n\r\nProcedure TCustomBucketList.Assign(AList: TCustomBucketList);\r\nvar\r\n  I,J : Integer;\r\nbegin\r\n  Clear;\r\n  SetLength(FBuckets,Length(Alist.FBuckets));\r\n  for I:=0 to BucketCount-1 do\r\n    begin\r\n    SetLength(FBuckets[i].Items,Length(AList.Fbuckets[I].Items));\r\n    for J:=0 to AList.Fbuckets[I].Count-1 do\r\n      with AList.Fbuckets[I].Items[J] do\r\n        AddItem(I,Item,Data);\r\n    end;\r\nend;\r\n\r\nFunction TCustomBucketList.Exists(AItem: JSValue): Boolean;\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  Result:=FindItem(AItem,B,I);\r\nend;\r\n\r\nFunction TCustomBucketList.Find(AItem: JSValue; out AData: JSValue): Boolean;\r\nvar\r\n  B,I : integer;\r\nbegin\r\n  Result:=FindItem(AItem,B,I);\r\n  if Result then\r\n    AData:=FBuckets[B].Items[I].Data;\r\nend;\r\n\r\nFunction TCustomBucketList.ForEach(AProc: TBucketProc): Boolean;\r\nbegin\r\n  Result:=Foreach(aProc,Null);\r\nend;\r\n\r\nFunction TCustomBucketList.ForEach(AProc: TBucketProc; AInfo: JSValue): Boolean;\r\nvar\r\n  I,J,S : Integer;\r\n  Bu : TBucket;\r\nbegin\r\n  I:=0;\r\n  Result:=True;\r\n  S:=GetBucketCount;\r\n  while Result and (I<S) do\r\n    begin\r\n    J:=0;\r\n    Bu:=FBuckets[I];\r\n    while Result and (J<Bu.Count) do\r\n      begin\r\n      with Bu.Items[J] do\r\n        AProc(AInfo,Item,Data,Result);\r\n      Inc(J);\r\n      end;\r\n    Inc(I);\r\n    end;\r\nend;\r\n\r\nFunction TCustomBucketList.Remove(AItem: JSValue): JSValue;\r\nvar\r\n  B,I : integer;\r\nbegin\r\n  if FindItem(AItem,B,I) then\r\n    begin\r\n    Result:=FBuckets[B].Items[I].Data;\r\n    DeleteItem(B,I);\r\n    end\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\n{ TBucketList }\r\n\r\nFunction TBucketList.BucketFor(AItem: JSValue): Integer;\r\nbegin\r\n  // JSValues on average have a granularity of 4\r\n  Result:=(longword(AItem) shr 2) and FBucketMask;\r\nend;\r\n\r\nconstructor TBucketList.Create(ABuckets: TBucketListSizes);\r\nvar\r\n  L : Integer;\r\nbegin\r\n  inherited Create;\r\n  L:=1 shl (Ord(Abuckets)+1);\r\n  SetBucketCount(L);\r\n  FBucketMask:=L-1;\r\nend;\r\n\r\n{ TObjectBucketList }\r\n\r\nFunction TObjectBucketList.GetData(AItem: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited GetData(AItem));\r\nend;\r\n\r\nProcedure TObjectBucketList.SetData(AItem: TObject; const AData: TObject);\r\nbegin\r\n  inherited SetData(JSValue(AItem),JSValue(AData));\r\nend;\r\n\r\nFunction TObjectBucketList.Add(AItem, AData: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Add(JSValue(AItem),JSValue(AData)));\r\nend;\r\n\r\nFunction TObjectBucketList.Remove(AItem: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Remove(JSValue(AItem)));\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Graphics;\r\n\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, Types, Web, JS;\r\n\r\nconst\r\n  WEBDEFAULTFONT = 'Arial';\r\n  SysDefault = $20000000;\r\n\r\n  clNone = -1;\r\n  clBlack = $000000;\r\n  clMaroon = $000080;\r\n  clGreen = $008000;\r\n  clOlive = $008080;\r\n  clNavy = $800000;\r\n  clPurple = $800080;\r\n  clTeal = $808000;\r\n  clGray = $808080;\r\n  clSilver = $C0C0C0;\r\n  clRed = $0000FF;\r\n  clLime = $00FF00;\r\n  clYellow = $00FFFF;\r\n  clBlue = $FF0000;\r\n  clFuchsia = $FF00FF;\r\n  clAqua = $FFFF00;\r\n  clLtGray = $C1C1C1;\r\n  clDkGray = $818181;\r\n  clWhite = $FFFFFF;\r\n  clDefault = SysDefault;\r\n  clBtnFace = $F0F0F0;\r\n  clWindowText = $010101;\r\n  clWindow = $FEFEFE;\r\n  clHighlight = $D77800;\r\n  clHighlightText = $030303;\r\n  clInfoText = $020202;\r\n  clInfoBk = $E1FFFF;\r\n  clActiveCaption = $D1B499;\r\n  clInactiveCaption =  $E2C5AA;\r\n  clHotLight = $CC6600;\r\n\r\n  clMoneyGreen = $C0DCC0;\r\n  clSkyBlue = $F0CAA6;\r\n  clCream = $F0FBFF;\r\n  clMedGray = $A0A0A0;\r\n\r\n  clWebAliceblue = $FFF8F0;\r\n  clWebAntiquewhite = $D7EBFA;\r\n  clWebAqua = $FFFF00;\r\n  clWebAquamarine = $D4FF7F;\r\n  clWebAzure = $FFFFF0;\r\n  clWebBeige = $DCF5F5;\r\n  clWebBisque = $C4E4FF;\r\n  clWebBlack = $000000;\r\n  clWebBlanchedalmond = $CDEBFF;\r\n  clWebBlue = $FF0000;\r\n  clWebBlueviolet = $E22B8A;\r\n  clWebBrown = $2A2AA5;\r\n  clWebBurlywood = $87B8DE;\r\n  clWebCadetblue = $A09E5F;\r\n  clWebChartreuse = $00FF7F;\r\n  clWebChocolate = $1E69D2;\r\n  clWebCoral = $507FFF;\r\n  clWebCornflowerblue = $ED9564;\r\n  clWebCornsilk = $DCF8FF;\r\n  clWebCrimson = $3C14DC;\r\n  clWebCyan = $FFFF00;\r\n  clWebDarkblue = $8B0000;\r\n  clWebDarkcyan = $8B8B00;\r\n  clWebDarkgoldenrod = $0B86B8;\r\n  clWebDarkgray = $A9A9A9;\r\n  clWebDarkgreen = $006400;\r\n  clWebDarkgrey = $A9A9A9;\r\n  clWebDarkkhaki = $6BB7BD;\r\n  clWebDarkmagenta = $8B008B;\r\n  clWebDarkolivegreen = $2F6B55;\r\n  clWebDarkorange = $008CFF;\r\n  clWebDarkorchid = $CC3299;\r\n  clWebDarkred = $00008B;\r\n  clWebDarksalmon = $7A96E9;\r\n  clWebDarkseagreen = $8FBC8F;\r\n  clWebDarkslateblue = $8B3D48;\r\n  clWebDarkslategray = $4F4F2F;\r\n  clWebDarkslategrey = $4F4F2F;\r\n  clWebDarkturquoise = $D1CE00;\r\n  clWebDarkviolet = $D30094;\r\n  clWebDeeppink = $9314FF;\r\n  clWebDeepskyblue = $FFBF00;\r\n  clWebDimgray = $696969;\r\n  clWebDimgrey = $696969;\r\n  clWebDodgerblue = $FF901E;\r\n  clWebFirebrick = $2222B2;\r\n  clWebFloralwhite = $F0FAFF;\r\n  clWebForestgreen = $228B22;\r\n  clWebFuchsia = $FF00FF;\r\n  clWebGainsboro = $DCDCDC;\r\n  clWebGhostwhite = $FFF8F8;\r\n  clWebGold = $00D7FF;\r\n  clWebGoldenrod = $20A5DA;\r\n  clWebGray = $808080;\r\n  clWebGreen = $008000;\r\n  clWebGreenyellow = $2FFFAD;\r\n  clWebGrey = $808080;\r\n  clWebHoneydew = $F0FFF0;\r\n  clWebHotpink = $B469FF;\r\n  clWebIndianred = $5C5CCD;\r\n  clWebIndigo = $82004B;\r\n  clWebIvory = $F0FFFF;\r\n  clWebKhaki = $8CE6F0;\r\n  clWebLavender = $FAE6E6;\r\n  clWebLavenderblush = $F5F0FF;\r\n  clWebLawngreen = $00FC7C;\r\n  clWebLemonchiffon = $CDFAFF;\r\n  clWebLightblue = $E6D8AD;\r\n  clWebLightcoral = $8080F0;\r\n  clWebLightcyan = $FFFFE0;\r\n  clWebLightgoldenrodyellow = $D2FAFA;\r\n  clWebLightgray = $D3D3D3;\r\n  clWebLightgreen = $90EE90;\r\n  clWebLightgrey = $D3D3D3;\r\n  clWebLightpink = $C1B6FF;\r\n  clWebLightsalmon = $7AA0FF;\r\n  clWebLightseagreen = $AAB220;\r\n  clWebLightskyblue = $FACE87;\r\n  clWebLightslategray = $998877;\r\n  clWebLightslategrey = $998877;\r\n  clWebLightsteelblue = $DEC4B0;\r\n  clWebLightyellow = $E0FFFF;\r\n  clWebLtGray = $C0C0C0;\r\n  clWebMedGray = $A4A0A0;\r\n  clWebDkGray = $808080;\r\n  clWebMoneyGreen = $C0DCC0;\r\n  clWebLegacySkyBlue = $F0CAA6;\r\n  clWebCream = $F0FBFF;\r\n  clWebLime = $00FF00;\r\n  clWebLimegreen = $32CD32;\r\n  clWebLinen = $E6F0FA;\r\n  clWebMagenta = $FF00FF;\r\n  clWebMaroon = $000080;\r\n  clWebMediumaquamarine = $AACD66;\r\n  clWebMediumblue = $CD0000;\r\n  clWebMediumorchid = $D355BA;\r\n  clWebMediumpurple = $DB7093;\r\n  clWebMediumseagreen = $71B33C;\r\n  clWebMediumslateblue = $EE687B;\r\n  clWebMediumspringgreen = $9AFA00;\r\n  clWebMediumturquoise = $CCD148;\r\n  clWebMediumvioletred = $8515C7;\r\n  clWebMidnightblue = $701919;\r\n  clWebMintcream = $FAFFF5;\r\n  clWebMistyrose = $E1E4FF;\r\n  clWebMoccasin = $B5E4FF;\r\n  clWebNavajowhite = $ADDEFF;\r\n  clWebNavy = $800000;\r\n  clWebOldlace = $E6F5FD;\r\n  clWebOlive = $008080;\r\n  clWebOlivedrab = $238E6B;\r\n  clWebOrange = $00A5FF;\r\n  clWebOrangered = $0045FF;\r\n  clWebOrchid = $D670DA;\r\n  clWebPalegoldenrod = $AAE8EE;\r\n  clWebPalegreen = $98FB98;\r\n  clWebPaleturquoise = $EEEEAF;\r\n  clWebPalevioletred = $9370DB;\r\n  clWebPapayawhip = $D5EFFF;\r\n  clWebPeachpuff = $B9DAFF;\r\n  clWebPeru = $3F85CD;\r\n  clWebPink = $CBC0FF;\r\n  clWebPlum = $DDA0DD;\r\n  clWebPowderblue = $E6E0B0;\r\n  clWebPurple = $800080;\r\n  clWebRed = $0000FF;\r\n  clWebRosybrown = $8F8FBC;\r\n  clWebRoyalblue = $E16941;\r\n  clWebSaddlebrown = $13458B;\r\n  clWebSalmon = $7280FA;\r\n  clWebSandybrown = $60A4F4;\r\n  clWebSeagreen = $578B2E;\r\n  clWebSeashell = $EEF5FF;\r\n  clWebSienna = $2D52A0;\r\n  clWebSilver = $C0C0C0;\r\n  clWebSkyblue = $EBCE87;\r\n  clWebSlateblue = $CD5A6A;\r\n  clWebSlategray = $908070;\r\n  clWebSlategrey = $908070;\r\n  clWebSnow = $FAFAFF;\r\n  clWebSpringgreen = $7FFF00;\r\n  clWebSteelblue = $B48246;\r\n  clWebTan = $8CB4D2;\r\n  clWebTeal = $808000;\r\n  clWebThistle = $D8BFD8;\r\n  clWebTomato = $4763FF;\r\n  clWebTurquoise = $D0E040;\r\n  clWebViolet = $EE82EE;\r\n  clWebWheat = $B3DEF5;\r\n  clWebWhite = $FFFFFF;\r\n  clWebWhitesmoke = $F5F5F5;\r\n  clWebYellow = $00FFFF;\r\n  clWebYellowgreen = $32CD9A;\r\n\r\n  clScrollBar = clBtnFace;\r\n  clBackground = clBtnFace;\r\n  clMenu = clBtnFace;\r\n  clWindowFrame = clWhite;\r\n  clMenuText = clBlack;\r\n  clCaptionText = clWhite;\r\n  clActiveBorder = clBlue;\r\n  clInactiveBorder = clWebDarkBlue;\r\n  clAppWorkSpace = clWhite;\r\n  clBtnShadow = clGray;\r\n  clGrayText = clGray;\r\n  clBtnText = clBlack;\r\n  clInactiveCaptionText = clWhite;\r\n  clBtnHighlight = clWhite;\r\n  cl3DDkShadow = clWebDarkGray;\r\n  cl3DLight = clBlue;\r\n  clMenuHighlight = clBlue;\r\n  clMenuBar = clBlue;\r\n\r\n  ANSI_CHARSET = 0;\r\n  DEFAULT_CHARSET = 1;\r\n  SYMBOL_CHARSET = 2;\r\n  MAC_CHARSET = 77;\r\n  SHIFTJIS_CHARSET = 128;\r\n  HANGEUL_CHARSET = 129;\r\n  JOHAB_CHARSET = 130;\r\n  GB2312_CHARSET = 134;\r\n  CHINESEBIG5_CHARSET = 136;\r\n  GREEK_CHARSET = 161;\r\n  TURKISH_CHARSET = 162;\r\n  HEBREW_CHARSET = 177;\r\n  ARABIC_CHARSET = 178;\r\n  BALTIC_CHARSET = 186;\r\n  RUSSIAN_CHARSET = 204;\r\n  THAI_CHARSET = 222;\r\n  EASTEUROPE_CHARSET = 238;\r\n  OEM_CHARSET = 255;\r\n\r\ntype\r\n  Single = Double;\r\n  TColor = type NativeInt;\r\n\r\n  TVerticalAlignment = (taAlignTop, taAlignBottom, taVerticalCenter);\r\n\r\n  TPenStyle = (psSolid, psDash, psDot, psDashDot, psDashDotDot, psClear,\r\n    psInsideFrame, psUserStyle, psAlternate);\r\n\r\n  TBrushStyle = (bsSolid, bsClear, bsHorizontal, bsVertical,\r\n    bsFDiagonal, bsBDiagonal, bsCross, bsDiagCross);\r\n\r\n  TFontStyle = (fsBold, fsItalic, fsStrikeOut, fsUnderline);\r\n\r\n  TFontStyles = set of TFontStyle;\r\n\r\n  TFontCharset = 0..255;\r\n\r\n  TBinaryString = type string;\r\n\r\n  TCanvasPointF = record\r\n    X: Double;\r\n    Y: Double;\r\n  end;\r\n\r\n  TCanvasRectF = record\r\n    Left, Top, Right, Bottom: Double;\r\n  end;\r\n\r\n  TCanvasSizeF = record\r\n    cx: Double;\r\n    cy: Double;\r\n  end;\r\n  \r\n  TPen = class(TPersistent)\r\n  private\r\n    FWidth: Integer;\r\n    FColor: TColor;\r\n    FStyle: TPenStyle;\r\n    procedure SetColor(const Value: TColor);\r\n  public\r\n    constructor Create; reintroduce;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Color: TColor read FColor write SetColor;\r\n    property Width: Integer read FWidth write FWidth;\r\n    property Style: TPenStyle read FStyle write FStyle;\r\n  end;\r\n\r\n  TBrush = class(TPersistent)\r\n  private\r\n    FColor: TColor;\r\n    FStyle: TBrushStyle;\r\n  public\r\n    constructor Create; reintroduce;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Color: TColor read FColor write FColor;\r\n    property Style: TBrushStyle read FStyle write FStyle;\r\n  end;\r\n\r\n  TFont = class(TPersistent)\r\n  private\r\n    FName: string;\r\n    FSize: Integer;\r\n    FColor: TColor;\r\n    FStyle: TFontStyles;\r\n    FOnChange: TNotifyEvent;\r\n    FHeight: Integer;\r\n    FCharset: TFontCharset;\r\n    FOrientation: integer;\r\n    procedure SetHeight(const Value: Integer);\r\n  protected\r\n    procedure SetName(const AName: string);\r\n    procedure SetSize(const ASize: Integer);\r\n    procedure SetColor(const AColor: TColor);\r\n    procedure SetStyle(const AStyle: TFontStyles);\r\n    procedure DoChange; virtual;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create; reintroduce;\r\n    function ToString: string; override;\r\n    property Orientation: integer read FOrientation write FOrientation;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  published\r\n    property Charset: TFontCharset read FCharset write FCharset;\r\n    property Name: string read FName write SetName;\r\n    property Height: Integer read FHeight write SetHeight;\r\n    property Style: TFontStyles read FStyle write SetStyle;\r\n    property Color: TColor read FColor write SetColor;\r\n    property Size: Integer read FSize write SetSize;\r\n  end;\r\n\r\n\r\n  TImageType = (itBase64, itBMP, itPNG, itJPEG, itGIF);\r\n\r\n  TCanvas = class;\r\n\r\n  TStream = TObject;\r\n\r\n  TBitmap = class;\r\n\r\n  TGraphic = class(TObject)\r\n  private\r\n    FAddToQueue: Boolean;\r\n    FCanvasElement: TJSHTMLCanvasElement;\r\n    FEmpty: Boolean;\r\n    FData: string;\r\n    FCanvas: TCanvas;\r\n    FOnChange: TNotifyEvent;\r\n    FImage: TJSObject;\r\n    FBitmap: TBitmap;\r\n    FURL: String;\r\n    procedure SetHeight(const Value: Integer);\r\n    procedure SetWidth(const Value: Integer);\r\n    function GetCanvas: TCanvas;\r\n  protected\r\n    procedure DoChange;\r\n    procedure SetURL(const URL: string);\r\n    function GetWidth: Integer;\r\n    function GetHeight: Integer;\r\n    procedure RecreateCanvas;\r\n    procedure DoBeginScene(Sender: TObject);\r\n    procedure DoEndScene(Sender: TObject);\r\n    procedure AssignEvents;\r\n    procedure CreateImage;\r\n    procedure LoadFromCache(AData: String);\r\n  public\r\n    class function CreateFromResource(AResource: String): TGraphic; overload;\r\n    class function CreateFromResource(AResource: String; AInstance: NativeUInt): TGraphic; overload;\r\n    class function CreateFromURL(AURL: String): TGraphic; overload;\r\n    class function CreateFromURL(AURL: String; AInstance: NativeUInt): TGraphic; overload;\r\n    function Image: TJSObject;\r\n    function Empty: Boolean;\r\n    function GetBase64Image: string;\r\n    function GetAsImage(AType: TImageType = itBase64): string;\r\n    constructor Create(URL: string); overload;\r\n    constructor Create(Img: TJSObject); overload;\r\n    constructor Create; overload; reintroduce;\r\n    property Width: Integer read GetWidth write SetWidth;\r\n    property Height: Integer read GetHeight write SetHeight;\r\n    procedure CaptureCanvas; virtual;\r\n    procedure LoadFromCanvas(ACanvas: TCanvas); virtual;\r\n    procedure SetSize(AWidth, AHeight: Integer);\r\n    procedure Assign(Source: TGraphic); virtual;\r\n    procedure LoadFromURL(AURL: string); virtual; overload;\r\n    procedure LoadFromURL(AURL: string; AHInstance: Integer); virtual; overload;\r\n    procedure LoadFromFile(AFileName: string); virtual;\r\n    procedure LoadFromResource(AResource: string); virtual; overload;\r\n    procedure LoadFromResource(AResource: string; AHInstance: Integer); virtual; overload;\r\n    procedure LoadFromStream(AStream: TStream);\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property Bitmap: TBitmap read FBitmap;\r\n  published\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property URL: string read FURL write SetURL;\r\n  end;\r\n\r\n  TBitmap = class(TGraphic)\r\n  end;\r\n\r\n  TMatrix = record\r\n    m11, m12, m13: Single;\r\n    m21, m22, m23: Single;\r\n    m31, m32, m33: Single;\r\n  end;\r\n\r\n  TCanvas = class(TObject)\r\n  private\r\n    FElementCanvas: TJSHTMLCanvasElement;\r\n    FContext: TJSCanvasRenderingContext2D;\r\n    FPen: TPen;\r\n    FBrush: TBrush;\r\n    FFont: TFont;\r\n    FPathOpen: boolean;\r\n    FPathX, FPathY: Double;\r\n    FClipRect: TCanvasRectF;\r\n    FOnEndScene: TNotifyEvent;\r\n    FOnBeginScene: TNotifyEvent;\r\n    FApplyPixelRatio: Boolean;\r\n    procedure SetClipRect(const Value: TCanvasRectF);\r\n  protected\r\n    procedure GetAccuOffset(X,Y: double; var dx,dy: single);\r\n    function GetPixel(X,Y: Single): TColor;\r\n    procedure SetPixel(X,Y: Single; Clr: TColor);\r\n    procedure ApplyStroke;\r\n    procedure ApplyFill;\r\n    property OnBeginScene: TNotifyEvent read FOnBeginScene write FOnBeginScene;\r\n    property OnEndScene: TNotifyEvent read FOnEndScene write FOnEndScene;\r\n  public\r\n    constructor Create(AControl: TJSHTMLCanvasElement); overload; virtual;\r\n    constructor Create; overload; reintroduce;\r\n    destructor Destroy; override;\r\n    procedure SetTransform(m11, m12, m21, m22, dx, dy: Double);\r\n    procedure Transform(m11, m12, m21, m22, dx, dy: Double);\r\n    procedure Rotate(Angle: Double);\r\n    procedure Translate(X, Y: Double);\r\n    procedure AngleArc(X, Y: Integer; Radius: Cardinal; StartAngle, SweepAngle: Double); overload;\r\n    procedure AngleArc(X, Y: Double; Radius: Double; StartAngle, SweepAngle: Double); overload;\r\n    procedure MoveTo(X, Y: Integer); overload;\r\n    procedure MoveTo(X, Y: Double); overload;\r\n    procedure LineTo(X, Y: Integer); overload;\r\n    procedure LineTo(X, Y: Double); overload;\r\n    procedure Rectangle(X1, Y1, X2, Y2: Double); overload;\r\n    procedure Rectangle(X1, Y1, X2, Y2: Integer); overload;\r\n    procedure Rectangle(const Rect: TRect); overload;\r\n    procedure Rectangle(const Rect: TCanvasRectF); overload;\r\n    procedure RoundRect(X1, Y1, X2, Y2, X3, Y3: Integer); overload;\r\n    procedure RoundRect(X1, Y1, X2, Y2, X3, Y3: Double); overload;\r\n    procedure RoundRect(const Rect: TRect; CX, CY: Integer); overload;\r\n    procedure RoundRect(const Rect: TCanvasRectF; CX, CY: Double); overload;\r\n    procedure FillRect(const Rect: TRect); overload;\r\n    procedure FillRect(const Rect: TCanvasRectF); overload;\r\n    procedure Ellipse(X1, Y1, X2, Y2: Integer); overload;\r\n    procedure Ellipse(X1, Y1, X2, Y2: Double); overload;\r\n    procedure Ellipse(const Rect: TRect); overload;\r\n    procedure Ellipse(const Rect: TCanvasRectF); overload;\r\n    procedure Polyline(const Points: array of TPoint); overload;\r\n    procedure Polyline(const Points: array of TCanvasPointF); overload;\r\n    procedure Polygon(const Points: array of TPoint); overload;\r\n    procedure Polygon(const Points: array of TCanvasPointF); overload;\r\n    procedure TextOut(X, Y: Integer; const Text: string); overload;\r\n    procedure TextOut(X, Y: Double; const Text: string); overload;\r\n    procedure Draw(X, Y: Integer; Graphic: TGraphic); overload;\r\n    procedure Draw(X, Y: Double; Graphic: TGraphic); overload;\r\n    procedure StretchDraw(Rect: TRect; Graphic: TGraphic); overload;\r\n    procedure StretchDraw(Rect: TCanvasRectF; Graphic: TGraphic); overload;\r\n    procedure DrawFocusRect(const Rect: TRect); overload;\r\n    procedure DrawFocusRect(const Rect: TCanvasRectF); overload;\r\n    procedure BeginScene;\r\n    procedure EndScene;\r\n    procedure PathBegin;\r\n    procedure PathClose;\r\n    procedure PathStroke;\r\n    procedure PathFill;\r\n    procedure PathMoveTo(X, Y: Integer); overload;\r\n    procedure PathMoveTo(X, Y: Double); overload;\r\n    procedure PathLineTo(X, Y: Integer); overload;\r\n    procedure PathLineTo(X, Y: Double); overload;\r\n    procedure Save;\r\n    procedure Clip;\r\n    procedure Restore;\r\n    procedure Refresh;\r\n    procedure Clear; overload;\r\n    procedure Clear(AColor: TColor); overload;\r\n    function TextExtent(const Text: string): TCanvasSizeF;\r\n    function TextRect(ARect: TRect; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TRect; overload;\r\n    function TextRect(ARect: TCanvasRectF; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TCanvasRectF; overload;\r\n    function TextWidth(const Text: string): Double; overload;\r\n    function TextHeight(const Text: string): Double; overload;\r\n    function GetBase64Image: string;\r\n    function GetAsImage(AType: TImageType = itBase64): string;\r\n    procedure DownloadImage(AFileName: string; AType: TImageType = itPNG);\r\n    property Element: TJSHTMLCanvasElement read FElementCanvas;\r\n    property Pen: TPen read FPen;\r\n    property Brush: TBrush read FBrush;\r\n    property Font: TFont read FFont;\r\n    property Pixels[X, Y: Single]: TColor read GetPixel write SetPixel;\r\n    property ClipRect: TCanvasRectF read FClipRect write SetClipRect;\r\n    property Context: TJSCanvasRenderingContext2D read FContext;\r\n    property ApplyPixelRatio: Boolean read FApplyPixelRatio write FApplyPixelRatio default False;\r\n  end;\r\n\r\n  TJSCSSStyleDeclarationEx = class(TJSCSSStyleDeclaration)\r\n  public\r\n    filter: string;\r\n  end;\r\n\r\n  TJSHTMLElementEx = class(TJSHTMLElement)\r\n  private\r\n    FStyle: TJSCSSStyleDeclarationEx; external name 'style';\r\n  public\r\n  property style: TJSCSSStyleDeclarationEx read FStyle write FStyle;\r\n  end;\r\n\r\n  TJSCanvasRenderingContext2DEx = class(TJSCanvasRenderingContext2D)\r\n  private\r\n    FFilter: string; external name 'filter';\r\n  public\r\n    property filter: string read FFilter write FFilter;\r\n  end;\r\n\r\n\r\n  TURLPicture = class(TPersistent)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    FFilename: string;\r\n    FData: TBinaryString;\r\n    FOnDataChange: TNotifyEvent;\r\n    procedure SetData(const Value: TBinaryString);\r\n    function GetData: TBinaryString;\r\n  protected\r\n    procedure Changed; virtual;\r\n    procedure DataChanged; virtual;\r\n  public\r\n    procedure LoadFromFile(AFileName: string);\r\n    property Filename: string read FFilename;\r\n    procedure Assign(Source: TPersistent); override;\r\n    property OnDataChange: TNotifyEvent read FOnDataChange write FOnDataChange;\r\n  published\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property Data: TBinaryString read GetData write SetData;\r\n  end;\r\n\r\n\r\n  TThumbnailCreatedProc = reference to procedure(ADataURL: string);\r\n\r\nfunction ColorToRGB(Color: TColor): Longint;\r\nfunction ColorToHex(c: TColor): string;\r\nfunction ColorToHTML(c: TColor): string;\r\n\r\nfunction ColorToString(Color: TColor): string;\r\nfunction StringToColor(const S: string): TColor;\r\nfunction CharsetToIdent(ACharSet: TFontCharSet): string;\r\nfunction IdentToCharset(const S: string): TFontCharSet;\r\n\r\nfunction FontSizeToHTML(sz: Double): string;\r\nfunction HTMLChar(h: string): integer;\r\nfunction HexToColor(h: string): TColor;\r\nfunction FontSizeToPx(sz: Double): Double;\r\nfunction GetRValue(rgb: NativeInt): Byte;\r\nfunction GetGValue(rgb: NativeInt): Byte;\r\nfunction GetBValue(rgb: NativeInt): Byte;\r\nfunction CreateCanvasRectF(Left, Top, Right, Bottom: Double): TCanvasRectF;\r\nfunction CreateCanvasPointF(X, Y: Double): TCanvasPointF;\r\nfunction CreateCanvasSizeF(cx, cy: Double): TCanvasSizeF;\r\nfunction RGB(r, g, b: Byte): TColor;\r\nfunction CSSFont(Font: TFont): string;\r\nprocedure CreateThumbnail(ADataURL: string; AWidth, AHeight: integer; UseAspectRatio: boolean; ThumbnailReady: TThumbnailCreatedProc);\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Forms, Math, SysUtils, Contnrs;\r\n\r\ntype\r\n  TGraphicCache = class\r\n  private\r\n    FImage: TJSObject;\r\n    FID: string;\r\n  public\r\n    constructor Create(AImage: TJSObject; AID: string); reintroduce;\r\n    property Image: TJSObject read FImage;\r\n    property ID: string read FID;\r\n  end;\r\n\r\n  TGraphicCacheList = class(TObjectList)\r\n  public\r\n    function Find(AID: string; var FImage: TJSObject): Boolean; virtual;\r\n    function Exists(AID: string): Boolean; virtual;\r\n  end;\r\n\r\nvar\r\n  FCache: TGraphicCacheList;\r\n  FQueue: TStringList;\r\n  FCacheCount: Integer = 0;\r\n\r\nfunction RGB(r, g, b: Byte): TColor;\r\nbegin\r\n  Result := (r or (g shl 8) or (b shl 16));\r\nend;\r\n\r\nfunction MatrixIdentity: TMatrix;\r\nbegin\r\n  Result.m11 := 1;\r\n  Result.m12 := 0;\r\n  Result.m13 := 0;\r\n  Result.m21 := 0;\r\n  Result.m22 := 1;\r\n  Result.m23 := 0;\r\n  Result.m31 := 0;\r\n  Result.m32 := 0;\r\n  Result.m33 := 1;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction GetPixelRatio(ACanvas: TCanvas): Single;\r\nvar\r\n  res: single;\r\n  ca: TCanvas;\r\nbegin\r\n  ca := ACanvas;\r\n  asm\r\n    var ctx = ca.FContext,\r\n        dpr = window.devicePixelRatio || 1,\r\n        bsr = ctx.webkitBackingStorePixelRatio ||\r\n              ctx.mozBackingStorePixelRatio ||\r\n              ctx.msBackingStorePixelRatio ||\r\n              ctx.oBackingStorePixelRatio ||\r\n              ctx.backingStorePixelRatio || 1;\r\n    res = dpr / bsr\r\n  end;\r\n  Result := res;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction MatrixCreateScaling(const AScaleX, AScaleY: Single): TMatrix;\r\nbegin\r\n  Result := MatrixIdentity;\r\n  Result.m11 := AScaleX;\r\n  Result.m22 := AScaleY;\r\nend;\r\n\r\nfunction MatrixMultiply(const AMatrix1, AMatrix2: TMatrix): TMatrix;\r\nbegin\r\n  Result.m11 := AMatrix1.m11 * AMatrix2.m11 + AMatrix1.m12 * AMatrix2.m21 + AMatrix1.m13 * AMatrix2.m31;\r\n  Result.m12 := AMatrix1.m11 * AMatrix2.m12 + AMatrix1.m12 * AMatrix2.m22 + AMatrix1.m13 * AMatrix2.m32;\r\n  Result.m13 := AMatrix1.m11 * AMatrix2.m13 + AMatrix1.m12 * AMatrix2.m23 + AMatrix1.m13 * AMatrix2.m33;\r\n  Result.m21 := AMatrix1.m21 * AMatrix2.m11 + AMatrix1.m22 * AMatrix2.m21 + AMatrix1.m23 * AMatrix2.m31;\r\n  Result.m22 := AMatrix1.m21 * AMatrix2.m12 + AMatrix1.m22 * AMatrix2.m22 + AMatrix1.m23 * AMatrix2.m32;\r\n  Result.m23 := AMatrix1.m21 * AMatrix2.m13 + AMatrix1.m22 * AMatrix2.m23 + AMatrix1.m23 * AMatrix2.m33;\r\n  Result.m31 := AMatrix1.m31 * AMatrix2.m11 + AMatrix1.m32 * AMatrix2.m21 + AMatrix1.m33 * AMatrix2.m31;\r\n  Result.m32 := AMatrix1.m31 * AMatrix2.m12 + AMatrix1.m32 * AMatrix2.m22 + AMatrix1.m33 * AMatrix2.m32;\r\n  Result.m33 := AMatrix1.m31 * AMatrix2.m13 + AMatrix1.m32 * AMatrix2.m23 + AMatrix1.m33 * AMatrix2.m33;\r\nend;\r\n\r\nprocedure CreateThumbnail(ADataURL: string; AWidth, AHeight: integer; UseAspectRatio: boolean; ThumbnailReady: TThumbnailCreatedProc);\r\nvar\r\n  LImg: TJSElement;\r\n\r\nbegin\r\n  if (AWidth <=0) or (AHeight <= 0) then\r\n    Exit;\r\n\r\n  LImg := document.createElement('IMG');\r\n\r\n  asm\r\n    LImg.onload = function() {\r\n\r\n      var w = LImg.width;\r\n      var h = LImg.height;\r\n\r\n      var neww = AWidth;\r\n      var newh = AHeight;\r\n\r\n      if (UseAspectRatio) {\r\n        if ((w/neww) > (h/newh))\r\n        {\r\n          newh = h / (w/neww);\r\n        }\r\n        else\r\n        {\r\n          neww = w / (h/newh);\r\n        }\r\n      }\r\n      var LCanvas = document.createElement('CANVAS');\r\n      var ctx = LCanvas.getContext(\"2d\");\r\n      ctx.drawImage(LImg, 0, 0, neww, newh);\r\n      var res = LCanvas.toDataURL(\"image/png\");\r\n      ThumbnailReady(res);\r\n    }\r\n  end;\r\n\r\n  LImg['src'] := ADataURL;\r\nend;\r\n\r\nfunction CSSFont(Font: TFont): string;\r\nvar\r\n  res,fs: string;\r\nbegin\r\n  res := 'font-family:'+ Font.Name+';';\r\n  res := res + 'font-style: normal;';\r\n\r\n  if fsBold in Font.Style then\r\n    res := res + 'font-weight: bold;';\r\n\r\n  if fsItalic in Font.Style then\r\n    res := res + 'font-style: italic;';\r\n\r\n  fs := '';\r\n\r\n  if fsUnderline in Font.Style then\r\n    fs := fs + ' underline';\r\n\r\n  if fsStrikeOut in Font.Style then\r\n     fs:= fs + ' line-through';\r\n\r\n  if (fs <> '') then\r\n    res := res + 'text-decoration:' + fs+';';\r\n\r\n  res := res + 'font-size:'+ IntToStr(Font.Size) + 'pt;';\r\n\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction CreateCanvasRectF(Left, Top, Right, Bottom: Double): TCanvasRectF;\r\nbegin\r\n  Result.Left := Left;\r\n  Result.Top := Top;\r\n  Result.Right := Right;\r\n  Result.Bottom := Bottom;\r\nend;\r\n\r\nfunction CreateCanvasPointF(X, Y: Double): TCanvasPointF;\r\nbegin\r\n  Result.X := X;\r\n  Result.Y := Y;\r\nend;\r\n\r\nfunction CreateCanvasSizeF(cx, cy: Double): TCanvasSizeF;\r\nbegin\r\n  Result.cx := cx;\r\n  Result.cy := cy;\r\nend;\r\n\r\nfunction GetRValue(rgb: NativeInt): Byte;\r\nbegin\r\n  Result := Byte(rgb and $FF);\r\nend;\r\n\r\nfunction GetGValue(rgb: NativeInt): Byte;\r\nbegin\r\n  Result := Byte((rgb shr 8) and $FF);\r\nend;\r\n\r\nfunction GetBValue(rgb: NativeInt): Byte;\r\nbegin\r\n  Result := Byte((rgb shr 16) and $FF);\r\nend;\r\n\r\nfunction ColorToRGB(Color: TColor): Longint;\r\nbegin\r\n  Result := Color;\r\nend;\r\n\r\nfunction ColorToHex(c: TColor): string;\r\nvar\r\n  s: string;\r\nbegin\r\n  asm\r\n    s = c.toString(16);\r\n\r\n    while (s.length < 6)\r\n    {\r\n      s = \"0\" + s;\r\n    }\r\n  end;\r\n\r\n  Result := Copy(s,5,2) + Copy(s,3,2) + Copy(s,1,2);\r\nend;\r\n\r\nfunction ColorToHTML(c: TColor): string;\r\nbegin\r\n  Result := '#' + ColorToHex(c);\r\nend;\r\n\r\nfunction ColorToString(Color: TColor): string;\r\nbegin\r\n  case Color of\r\n  clNone: Result := 'clNone';\r\n  clBlack: Result := 'clBlack';\r\n  clMaroon: Result := 'clMaroon';\r\n  clGreen: Result := 'clGreen';\r\n  clOlive: Result := 'clOlive';\r\n  clNavy: Result := 'clNavy';\r\n  clPurple: Result := 'clPurple';\r\n  clTeal: Result := 'clTeal';\r\n  clGray: Result := 'clGray';\r\n  clSilver: Result := 'clSilver';\r\n  clRed: Result := 'clRed';\r\n  clLime: Result := 'clLime';\r\n  clYellow: Result := 'clYellow';\r\n  clBlue: Result := 'clBlue';\r\n  clFuchsia: Result := 'clFuchsia';\r\n  clAqua: Result := 'clAqua';\r\n  clWhite: Result := 'clWhite';\r\n  clLtGray: Result := 'clLtGray';\r\n  clDkGray: Result := 'clDkGray';\r\n  clDefault: Result := 'clDefault';\r\n  clBtnFace: Result := 'clBtnFace';\r\n  clWindowText: Result := 'clWindowText';\r\n  clWindow: Result := 'clWindow';\r\n  clHighlight: Result := 'clHighlight';\r\n  clHighlightText: Result :='clHighlightText';\r\n  clInfoText: Result :='clInfoText';\r\n  clInfoBk: Result := 'clInfoBk';\r\n  clActiveCaption: Result := 'clActiveCaption';\r\n  clInactiveCaption: Result := 'clInactiveCaption';\r\n  clHotLight: Result := 'clHotLight'\r\n  else\r\n    Result := '$' + ColorToHex(Color);\r\n  end;\r\nend;\r\n\r\nfunction StringToColor(const S: string): TColor;\r\nvar\r\n  us: string;\r\n\r\nbegin\r\n  us := Uppercase(s);\r\n  if (us = 'CLNONE') then Result := clNone else\r\n  if (us = 'CLBLACK') then Result := clBlack else\r\n  if (us = 'CLMAROON') then Result := clMaroon else\r\n  if (us = 'CLGREEN') then Result := clGreen else\r\n  if (us = 'CLOLIVE') then Result := clOlive else\r\n  if (us = 'CLNAVY') then Result := clNavy else\r\n  if (us = 'CLPURPLE') then Result := clPurple else\r\n  if (us = 'CLTEAL') then Result := clTeal else\r\n  if (us = 'CLGRAY') then Result := clGray else\r\n  if (us = 'CLSILVER') then Result := clSilver else\r\n  if (us = 'CLRED') then Result := clRed else\r\n  if (us = 'CLLIME') then Result := clLime else\r\n  if (us = 'CLYELLOW') then Result := clYellow else\r\n  if (us = 'CLBLUE') then Result := clBlue else\r\n  if (us = 'CLFUCHSIA') then Result := clFuchsia else\r\n  if (us = 'CLAQUA') then Result := clAqua else\r\n  if (us = 'CLWHITE') then Result := clWhite else\r\n  if (us = 'CLLTGRAY') then Result := clLtGray else\r\n  if (us = 'CLDKGRAY') then Result := clDkGray else\r\n  if (us = 'CLDEFAULT') then Result := clDefault else\r\n  if (us = 'CLBTNFACE') then Result := clBtnFace else\r\n  if (us = 'CLWINDOWTEXT') then Result := clWindowText else\r\n  if (us = 'CLWINDOW') then Result := clWindow else\r\n  if (us = 'CLHIGHLIGHT') then Result := clHighlight else\r\n  if (us = 'CLHIGHLIGHTTEXT') then Result := clWhite else\r\n  if (us = 'CLINFOTEXT') then Result := clInfoText else\r\n  if (us = 'CLINFOBK') then Result := clInfoBk else\r\n  if (us = 'CLACTIVECAPTION') then Result := clActiveCaption else\r\n  if (us = 'CLINACTIVECAPTION') then Result := clInactiveCaption else\r\n  if (us = 'CLHOTLIGHT') then Result := clHotLight else\r\n    Result := HexToColor(us);\r\nend;\r\n\r\n\r\nfunction HexToColor(h: string): TColor;\r\nvar\r\n  s: string;\r\n  i: integer;\r\nbegin\r\n  s := '';\r\n  for i := 1 to Length(h) do\r\n  begin\r\n    // accept hex chars\r\n    if ((h[i] >='0') and (h[i] <= '9')) or ((h[i] >='A') and (h[i] <= 'F') or ((h[i] >='a') and (h[i] <= 'f'))) then\r\n      s := s + h[i];\r\n  end;\r\n\r\n  s := '$' + Copy(s,5,2) + Copy(s,3,2) + Copy(s,1,2);\r\n  Result := StrToInt64(s);\r\nend;\r\n\r\nfunction HTMLChar(h: string): integer;\r\nbegin\r\n  // fmt &#xABCD;\r\n  Delete(h,1,3);\r\n  Delete(h,Length(h) - 1, 1);\r\n  Result := StrToInt('0x' + h);\r\nend;\r\n\r\nfunction FontSizeToHTML(sz: Double): string;\r\nbegin\r\n  Result := FloatToStr(sz)+'px';\r\n  Result := StringReplace(Result, ',', '.', [rfReplaceAll]);\r\nend;\r\n\r\n\r\nfunction CharSetToIdent(ACharSet: TFontCharSet): string;\r\nbegin\r\n  case ACharSet of\r\n  ANSI_CHARSET: Result := 'ANSI_CHARSET';\r\n  DEFAULT_CHARSET: Result := 'DEFAULT_CHARSET';\r\n  SYMBOL_CHARSET: Result := 'SYMBOL_CHARSET';\r\n  MAC_CHARSET: Result := 'MAC_CHARSET';\r\n  SHIFTJIS_CHARSET: Result := 'SHIFTJIS_CHARSET';\r\n  HANGEUL_CHARSET: Result := 'HANGEUL_CHARSET';\r\n  JOHAB_CHARSET: Result := 'JOHAB_CHARSET';\r\n  GB2312_CHARSET: Result := 'GB2312_CHARSET';\r\n  CHINESEBIG5_CHARSET: Result := 'CHINESEBIG5_CHARSET';\r\n  GREEK_CHARSET: Result := 'GREEK_CHARSET';\r\n  TURKISH_CHARSET: Result := 'TURKISH_CHARSET';\r\n  HEBREW_CHARSET: Result := 'HEBREW_CHARSET';\r\n  ARABIC_CHARSET: Result := 'ARABIC_CHARSET';\r\n  BALTIC_CHARSET: Result := 'BALTIC_CHARSET';\r\n  RUSSIAN_CHARSET: Result := 'RUSSIAN_CHARSET';\r\n  THAI_CHARSET: Result := 'THAI_CHARSET';\r\n  EASTEUROPE_CHARSET: Result := 'EASTEUROPE_CHARSET';\r\n  OEM_CHARSET: Result := 'OEM_CHARSET';\r\n  end;\r\nend;\r\n\r\nfunction IdentToCharSet(const S: string): TFontCharSet;\r\nbegin\r\n  if S = 'ANSI_CHARSET' then Result := ANSI_CHARSET;\r\n  if S = 'DEFAULT_CHARSET' then Result := DEFAULT_CHARSET;\r\n  if S = 'SYMBOL_CHARSET' then Result := SYMBOL_CHARSET;\r\n  if S = 'MAC_CHARSET' then Result := MAC_CHARSET;\r\n  if S = 'SHIFTJIS_CHARSET' then Result := SHIFTJIS_CHARSET;\r\n  if S = 'HANGEUL_CHARSET' then Result := HANGEUL_CHARSET;\r\n  if S = 'JOHAB_CHARSET' then Result := JOHAB_CHARSET;\r\n  if S = 'GB2312_CHARSET' then Result := GB2312_CHARSET;\r\n  if S = 'CHINESEBIG5_CHARSET' then Result := CHINESEBIG5_CHARSET;\r\n  if S = 'GREEK_CHARSET' then Result := GREEK_CHARSET;\r\n  if S = 'TURKISH_CHARSET' then Result := TURKISH_CHARSET;\r\n  if S = 'HEBREW_CHARSET' then Result := HEBREW_CHARSET;\r\n  if S = 'ARABIC_CHARSET' then Result := ARABIC_CHARSET;\r\n  if S = 'BALTIC_CHARSET' then Result := BALTIC_CHARSET;\r\n  if S = 'RUSSIAN_CHARSET' then Result := RUSSIAN_CHARSET;\r\n  if S = 'THAI_CHARSET' then Result := THAI_CHARSET;\r\n  if S = 'EASTEUROPE_CHARSET' then Result := EASTEUROPE_CHARSET;\r\n  if S = 'OEM_CHARSET' then Result := OEM_CHARSET;\r\nend;\r\n\r\n{ TPen }\r\n\r\nprocedure TPen.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TPen) then\r\n  begin\r\n    FColor := (Source as TPen).Color;\r\n    FStyle := (Source as TPen).Style;\r\n    FWidth := (Source as TPen).Width;\r\n  end;\r\nend;\r\n\r\nconstructor TPen.Create;\r\nbegin\r\n  FColor := clBlack;\r\n  FWidth := 1;\r\n  FStyle := psSolid;\r\nend;\r\n\r\nprocedure TPen.SetColor(const Value: TColor);\r\nbegin\r\n  FColor := Value;\r\nend;\r\n\r\n{ TBrush }\r\n\r\nprocedure TBrush.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TBrush) then\r\n  begin\r\n    FColor := (Source as TBrush).Color;\r\n    FStyle := (Source as TBrush).Style;\r\n  end;\r\nend;\r\n\r\nfunction FontSizeToPx(sz: Double): Double;\r\nbegin\r\n  Result := sz * 96 / 72;\r\nend;\r\n\r\nconstructor TBrush.Create;\r\nbegin\r\n  FColor := clWhite;\r\n  FStyle := bsSolid;\r\nend;\r\n\r\n{ TFont }\r\n\r\nprocedure TFont.Assign(Source: TPersistent); \r\nbegin\r\n  if (Source is TFont) then\r\n  begin\r\n    FName := (Source as TFont).Name;\r\n    FColor := (Source as TFont).Color;\r\n    FSize := (Source as TFont).Size;\r\n    FStyle := (Source as TFont).Style;\r\n  end;\r\nend;\r\n\r\nfunction TFont.ToString: string;\r\nvar\r\n  s: string;\r\nbegin\r\n  s := '';\r\n  if (TFontStyle.fsBold in Style) and (TFontStyle.fsItalic in Style) then\r\n    s := s + 'bold italic'\r\n  else if TFontStyle.fsBold in Style then\r\n    s := s + 'bold'\r\n  else if TFontStyle.fsItalic in Style then\r\n    s := s + 'italic';\r\n\r\n  Result := s + ' ' + FontSizeToHTML(FontSizeToPx(Size)) + ' ' + Name;\r\nend;\r\n\r\nprocedure TFont.SetName(const AName: string);\r\nbegin\r\n  if (FName <> AName) then\r\n  begin\r\n    FName := AName;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetSize(const ASize: Integer);\r\nbegin\r\n  if (FSize <> ASize) then\r\n  begin\r\n    FSize := ASize;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetColor(const AColor: TColor);\r\nbegin\r\n  if (FColor <> AColor) then\r\n  begin\r\n    FColor := AColor;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetHeight(const Value: Integer);\r\nvar\r\n  d: double;\r\nbegin\r\n  FHeight := Value;\r\n  d := -FHeight * 72/96;\r\n  FSize := Round(d);\r\n  DoChange;\r\nend;\r\n\r\nprocedure TFont.SetStyle(const AStyle: TFontStyles);\r\nbegin\r\n  FStyle := AStyle;\r\n  DoChange;\r\nend;\r\n\r\nconstructor TFont.Create;\r\nbegin\r\n  inherited;\r\n  FName := WEBDEFAULTFONT;\r\n  FSize := 8;\r\n  FStyle := [];\r\n  FColor := clBlack;\r\nend;\r\n\r\nprocedure TFont.DoChange;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{ TCanvas }\r\n\r\nprocedure TCanvas.AngleArc(X, Y, Radius: Double; StartAngle,\r\n  SweepAngle: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    FContext.arc(X, Y, Radius, StartAngle, StartAngle + SweepAngle);\r\n    FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.ApplyFill;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.fillStyle := ColorToHtml(Brush.Color);\r\nend;\r\n\r\nprocedure TCanvas.ApplyStroke;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.lineWidth := Pen.Width;\r\n    FContext.strokeStyleAsColor := ColorToHtml(Pen.Color);\r\n    case Pen.Style of\r\n      psSolid: FContext.setlinedash([]);\r\n      psDot: FContext.setlinedash([1,2]);\r\n      psDash: FContext.setlinedash([8,2]);\r\n      psDashDot: FContext.setlinedash([6,2,2,2]);\r\n      psDashDotDot: FContext.setlinedash([6,2,2,2,2,2]);\r\n      psClear: FContext.setlinedash([0, $FFFF]);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.PathBegin;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.beginPath();\r\nend;\r\n\r\nprocedure TCanvas.BeginScene;\r\nbegin\r\n  if Assigned(OnBeginScene) then\r\n    OnBeginScene(Self);\r\nend;\r\n\r\nprocedure TCanvas.Clear;\r\nbegin\r\n  if Assigned(FContext) and Assigned(FElementCanvas) then\r\n    FContext.clearRect(0, 0, FElementCanvas.width, FElementCanvas.height);\r\nend;\r\n\r\nprocedure TCanvas.Clear(AColor: TColor);\r\nvar\r\n  c: TColor;\r\n  s: TBrushStyle;\r\nbegin\r\n  Clear;\r\n  if Assigned(FElementCanvas) then\r\n  begin\r\n    c := Brush.Color;\r\n    s := Brush.Style;\r\n    Brush.Color := AColor;\r\n    Brush.Style := bsSolid;\r\n    FillRect(Rect(0, 0, FElementCanvas.width, FElementCanvas.height));\r\n    Brush.Color := c;\r\n    Brush.Style := s;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Clip;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.clip;\r\nend;\r\n\r\nconstructor TCanvas.Create;\r\nbegin\r\n  FElementCanvas := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n  Create(FElementCanvas);\r\nend;\r\n\r\nconstructor TCanvas.Create(AControl: TJSHTMLCanvasElement);\r\nbegin\r\n  FElementCanvas := AControl;\r\n  FContext := AControl.getContextAs2DContext('2d');\r\n  FPen := TPen.Create;\r\n  FBrush := TBrush.Create;\r\n  FPathOpen := false;\r\n  FFont := TFont.Create;\r\n  FApplyPixelRatio := False;\r\nend;\r\n\r\nprocedure TCanvas.AngleArc(X, Y: Integer; Radius: Cardinal; StartAngle, SweepAngle: Double);\r\nbegin\r\n  AngleArc(Double(X), Double(Y), Double(Radius), Double(StartAngle), Double(SweepAngle));\r\nend;\r\n\r\nprocedure TCanvas.MoveTo(X,Y: Integer);\r\nbegin\r\n  MoveTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.LineTo(X,Y: Integer);\r\nbegin\r\n  LineTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(const Rect: TRect);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(X1, Y1, X2, Y2: Double);\r\nvar\r\n  dx,dy: single;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n\r\n    GetAccuOffset(X1,Y1,dx,dy);\r\n\r\n    FContext.rect(X1+dx, Y1+dy, X2 - X1, Y2 - Y1);\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(const Rect: TCanvasRectF);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Refresh;\r\nbegin\r\nend;\r\n\r\nprocedure TCanvas.Restore;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.restore();\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(X1, Y1, X2, Y2: Integer);\r\nbegin\r\n  Rectangle(Double(X1), Double(Y1), Double(X2), Double(Y2));\r\nend;\r\n\r\nprocedure TCanvas.FillRect(const Rect: TRect);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(X1,Y1,X2,Y2,X3,Y3: Integer);\r\nbegin\r\n  RoundRect(Double(X1), Double(Y1), Double(X2), Double(Y2), Double(X3), Double(Y3));\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(const Rect: TRect; CX, CY: Integer);\r\nbegin\r\n  RoundRect(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom, CX, CY);\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(X1, Y1, X2, Y2, X3, Y3: Double);\r\nvar\r\n  dx,dy: single;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n\r\n    GetAccuOffset(X1, Y1, dx, dy);\r\n\r\n    FContext.moveTo(X1 + X3/2, Y1+dy);\r\n    FContext.lineTo(X2 - X3/2, Y1+dy);\r\n    FContext.quadraticCurveTo(X2+dx,Y1+dy, X2+dx, Y1 + Y3/2);\r\n    FContext.lineTo(X2 +dx, Y2 - Y3/2);\r\n    FContext.quadraticCurveTo(X2+dx, Y2+dy, X2 - X3/2, Y2+dy);\r\n    FContext.lineTo(X1 + X3/2, Y2+dy);\r\n    FContext.quadraticCurveTo(X1+dx, Y2+dy, X1+dx, Y2 - Y3/2);\r\n    FContext.lineTo(X1+dx, Y1 + Y3/2);\r\n    FContext.quadraticCurveTo(X1+dx, Y1+dy, X1 + X3/2, Y1+dy);\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(X1, Y1, X2, Y2: Integer);\r\nbegin\r\n  Ellipse(Double(X1), Double(Y1), Double(X2), Double(Y2));\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(const Rect: TRect);\r\nbegin\r\n  Ellipse(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Polyline(const Points: array of TPoint);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    if l = 0 then\r\n      Exit;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Polygon(const Points: array of TPoint);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    if l = 0 then\r\n      Exit;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    FContext.closePath();\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nfunction TCanvas.TextExtent(const Text: string): TCanvasSizeF;\r\nbegin\r\n  Result.cx := TextWidth(Text);\r\n  Result.cy := TextHeight(Text);\r\nend;\r\n\r\nfunction TCanvas.TextHeight(const Text: string): Double;\r\nbegin\r\n  Result := FontSizeToPx(Font.Size);\r\nend;\r\n\r\nprocedure TCanvas.MoveTo(X, Y: Double);\r\nvar\r\n  dx,dy: single;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FPathOpen := true;\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    dx := 0;\r\n    dy := 0;\r\n    GetAccuOffset(X, Y, dx, dy);\r\n    FContext.moveTo(X + dx,Y + dy);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.TextOut(X, Y: Double; const Text: string);\r\nvar\r\n  tm: TJSTextMetrics;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.fillStyle := ColorToHtml(Font.Color);\r\n    FContext.font := Font.ToString;\r\n    FContext.textBaseline := 'hanging';\r\n    FContext.fillText(Text, X, Y + 0.5);\r\n\r\n    if fsUnderline in Font.Style then\r\n    begin\r\n      tm := FContext.measureText(Text);\r\n      FContext.fillRect(X, Y + Font.Size *1.4, tm.width, 1);\r\n    end;\r\n\r\n    if fsStrikeOut in Font.Style then\r\n    begin\r\n      tm := FContext.measureText(Text);\r\n      FContext.fillRect(X, Y + Font.Size *0.7, tm.width, 1);\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nfunction TCanvas.TextRect(ARect: TCanvasRectF; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TCanvasRectF;\r\nvar\r\n  i: Integer;\r\n  s, sn, st: string;\r\n  l: Integer;\r\n  w, mw: Double;\r\n  f: Boolean;\r\n  p: Integer;\r\n  tw: Double;\r\n  th: Double;\r\n  lcnt: Integer;\r\n  rs: TCanvasRectF;\r\n  fws: Double;\r\n  ths: Double;\r\n  ww, wwx, fx: Boolean;\r\n\r\n  procedure DrawText(AText: string; AWidth, AHeight: Single);\r\n  begin\r\n    if ww then\r\n    begin\r\n      case AHorizontalAlignment of\r\n        taCenter: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Top, AText);\r\n        taLeftJustify: TextOut(ARect.Left, ARect.Top, AText);\r\n        taRightJustify: TextOut(ARect.Right - AWidth, ARect.Top, AText);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      case AHorizontalAlignment of\r\n        taCenter:\r\n        begin\r\n          case AVerticalAlignment of\r\n            taAlignTop: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Top, AText);\r\n            taVerticalCenter: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Top + (ARect.Bottom - ARect.Top - AHeight) / 2, AText);\r\n            taAlignBottom: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Bottom - AHeight, AText);\r\n          end;\r\n        end;\r\n        taLeftJustify:\r\n        begin\r\n          case AVerticalAlignment of\r\n            taAlignTop: TextOut(ARect.Left, ARect.Top, AText);\r\n            taVerticalCenter: TextOut(ARect.Left, ARect.Top + (ARect.Bottom - ARect.Top - AHeight) / 2, AText);\r\n            taAlignBottom: TextOut(ARect.Left, ARect.Bottom - AHeight, AText);\r\n          end;\r\n        end;\r\n        taRightJustify:\r\n        begin\r\n          case AVerticalAlignment of\r\n            taAlignTop: TextOut(ARect.Right - AWidth, ARect.Top, AText);\r\n            taVerticalCenter: TextOut(ARect.Right - AWidth, ARect.Top + (ARect.Bottom - ARect.Top - AHeight) / 2, AText);\r\n            taAlignBottom: TextOut(ARect.Right - AWidth, ARect.Bottom - AHeight, AText);\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  function FindNextWord(Text: String; var APos: Integer): String;\r\n  var\r\n    l: Integer;\r\n    i: Integer;\r\n  begin\r\n    Result := '';\r\n\r\n    l := Length(Text);\r\n    if APos > l then\r\n      Exit;\r\n\r\n    i := APos;\r\n    while True do\r\n    begin\r\n      if ((Text[i] = #10) and (Text[i - 1] = #13)) or ((Text[i] = #13) and (Text[i - 1] = #10)) or (Text[i] = ' ') then\r\n      begin\r\n        if Text[i] = ' ' then\r\n          Result := Copy(Text, APos, i - (APos - 1))\r\n        else\r\n          Result := Copy(Text, APos, i - APos);\r\n\r\n        Break;\r\n      end\r\n      else if (Text[i] = #10) or (Text[i] = #13) or (Text[i] = ' ') then\r\n      begin\r\n        result := Copy(Text, APos, i - (APos - 1));\r\n        Break;\r\n      end\r\n      else if i >= l then\r\n      begin\r\n        result := Copy(Text, APos, i - (APos - 1));\r\n        Break;\r\n      end\r\n      else\r\n        inc(i);\r\n    end;\r\n\r\n    APos := i + 1;\r\n  end;\r\nbegin\r\n  ww := WordWrap or (Pos(#13, Text) > 0) or (Pos(#10, Text) > 0);\r\n  wwx := not WordWrap and ((Pos(#13, Text) > 0) or (Pos(#10, Text) > 0));\r\n    \r\n  if not ww then\r\n  begin\r\n    w := TextWidth(Text);\r\n    th := TextHeight(Text);\r\n    if not Calculate then\r\n      DrawText(Text, w, th);\r\n\r\n    Result := CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Left + w, ARect.Top + th);\r\n  end\r\n  else\r\n  begin\r\n    rs := ARect;\r\n\r\n    mw := 0;\r\n    i := 1;\r\n    ths := FFont.Size * 0.5;\r\n    lcnt := 0;\r\n    fws := 0;\r\n    tw := 0;\r\n    s := FindNextWord(Text, i);\r\n    w := TextWidth(s);\r\n    th := TextHeight(s) + ths;\r\n\r\n    mw := mw + w;\r\n    if (Length(s) > 0) and (s[Length(s)] = ' ') then\r\n      mw := mw + fws;\r\n\r\n    fx := False;\r\n    while i <= Length(Text) do\r\n    begin\r\n      l := Length(s);\r\n      if (l >= 2) and (((s[l] = #10) and (s[l - 1] = #13)) or ((s[l] = #13) and (s[l - 1] = #10))) then\r\n      begin\r\n        s := Copy(s, 1, l - 2);\r\n        f := True;\r\n      end\r\n      else if (l >= 1) and ((s[l] = #10) or (s[l] = #13)) then\r\n      begin\r\n        s := Copy(s, 1, l - 1);\r\n        f := True;\r\n      end\r\n      else\r\n        f := False;\r\n\r\n      sn := FindNextWord(Text, i);\r\n      w := TextWidth(sn);\r\n      th := Max(th, TextHeight(sn) + ths);\r\n\r\n      if (ARect.Left + mw + w > ARect.Right) or f then\r\n      begin\r\n        if (s <> '') and not fx then\r\n        begin\r\n          p := Length(s);\r\n\r\n          st := Copy(s, 1, p);\r\n\r\n          Inc(lcnt);\r\n          if mw > tw then\r\n            tw := mw;\r\n\r\n          if not Calculate then\r\n            DrawText(st, mw, th);\r\n\r\n          mw := 0;\r\n        end;\r\n\r\n        s := '';\r\n\r\n        fx := False;\r\n        if (wwx and f) or not wwx then\r\n          ARect.Top := ARect.Top + th\r\n        else if (wwx and not f) then\r\n          fx := True;\r\n\r\n        if (Trunc(ARect.Top) > Trunc(ARect.Bottom - th)) and not Calculate then\r\n          Break;\r\n      end;\r\n\r\n      mw := mw + w;\r\n      if (Length(sn) > 0) and (sn[Length(sn)] = ' ') then\r\n        mw := mw + fws;\r\n      s := s + sn;\r\n    end;\r\n\r\n    if s <> '' then\r\n    begin\r\n      p := Length(s);\r\n      st := Copy(s, 1, p);\r\n      Inc(lcnt);\r\n      if mw > tw then\r\n        tw := mw;\r\n\r\n      if not Calculate then\r\n        DrawText(st, mw, th);\r\n    end;\r\n\r\n    Result := CreateCanvasRectF(rs.Left, rs.Top, rs.Left + tw, rs.Top + lcnt * th);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.TextOut(X,Y: Integer; const Text: string);\r\nbegin\r\n  TextOut(Double(X), Double(Y), Text);\r\nend;\r\n\r\nfunction TCanvas.TextRect(ARect: TRect; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TRect;\r\nvar\r\n  r: TCanvasRectF;\r\nbegin\r\n  r := TextRect(CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom), Text, WordWrap, Calculate, AHorizontalAlignment, AVerticalAlignment);\r\n  Result := Rect(Round(r.Left), Round(r.Top), Round(r.Right), Round(r.Bottom));\r\nend;\r\n\r\nfunction TCanvas.TextWidth(const Text: string): Double;\r\nvar\r\n  f: string;\r\n  tm: TJSTextMetrics;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    f := Font.ToString;\r\n    FContext.font := f;\r\n    tm := FContext.measureText(Text);\r\n    Result := tm.width;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Transform(m11, m12, m21, m22, dx, dy: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.transform(m11, m12, m21, m22, dx, dy);\r\nend;\r\n\r\nprocedure TCanvas.Translate(X, Y: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.translate(X, Y);\r\nend;\r\n\r\nprocedure TCanvas.Draw(X, Y: Integer; Graphic: TGraphic);\r\nbegin\r\n  Draw(Double(X), Double(Y), Graphic);\r\nend;\r\n\r\ndestructor TCanvas.Destroy;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCanvas.Draw(X, Y: Double; Graphic: TGraphic);\r\nvar\r\n  img: TJSObject;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    img := Graphic.Image;\r\n    FContext.drawImage(img, X, Y);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.DrawFocusRect(const Rect: TCanvasRectF);\r\nvar\r\n  ps: TPenStyle;\r\nbegin\r\n  ps := Pen.Style;\r\n  Pen.Style := psDot;\r\n  Pen.Width := 1;\r\n  Pen.Color := clBlack;\r\n\r\n  MoveTo(Rect.Left, Rect.Top);\r\n  LineTo(Rect.Right, Rect.Top);\r\n  LineTo(Rect.Right, Rect.Bottom);\r\n  LineTo(Rect.Left, Rect.Bottom);\r\n  LineTo(Rect.Left, Rect.Top);\r\n\r\n  Pen.Style := ps;\r\nend;\r\n\r\nprocedure TCanvas.DrawFocusRect(const Rect: TRect);\r\nbegin\r\n  DrawFocusRect(CreateCanvasRectF(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom));\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(X1, Y1, X2, Y2: Double);\r\nvar\r\n  w, h: Double;\r\n  kappa: Double;\r\n  ox, oy, xe, ye, xm, ym: Double;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    w := x2 - x1;\r\n    h := y2 - y1;\r\n\r\n    kappa := 0.5522848;\r\n\r\n    ox := (w / 2) * kappa;\r\n    oy := (h / 2) * kappa;\r\n    xe := x1 + w;\r\n    ye := y1 + h;\r\n    xm := x1 + w / 2;\r\n    ym := y1 + h / 2;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n    FContext.moveTo(x1, ym);\r\n    FContext.bezierCurveTo(x1, ym - oy, xm - ox, y1, xm, y1);\r\n    FContext.bezierCurveTo(xm + ox, y1, xe, ym - oy, xe, ym);\r\n    FContext.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\r\n    FContext.bezierCurveTo(xm - ox, ye, x1, ym + oy, x1, ym);\r\n    FContext.closePath();\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.GetAccuOffset(X,Y: double; var dx, dy: single);\r\nbegin\r\n  dx := 0;\r\n  dy := 0;\r\n\r\n  if (Pen.Width = 1) and (Pen.Style <> psClear) and (Frac(X) = 0) then\r\n    dx := 0.5;\r\n\r\n  if (Pen.Width = 1) and (Pen.Style <> psClear) and (Frac(Y) = 0) then\r\n    dy := 0.5;\r\nend;\r\n\r\nfunction TCanvas.GetBase64Image: string;\r\nbegin\r\n  Result := '';\r\n  if Assigned(Element) then\r\n    Result := Element.toDataURL();\r\nend;\r\n\r\nfunction TCanvas.GetPixel(X,Y: Single): TColor;\r\nvar\r\n  imgd: TJSImageData;\r\nbegin\r\n  Result := clNone;\r\n  if Assigned(FContext) then\r\n  begin\r\n    imgd := FContext.getImageData(x, y, 1, 1);\r\n    Result := RGB(imgd.data[0], imgd.data[1], imgd.data[2]);\r\n  end;\r\nend;\r\n\r\nfunction TCanvas.GetAsImage(AType: TImageType): string;\r\nbegin\r\n  Result := '';\r\n  if Assigned(Element) then\r\n  begin\r\n    case AType of\r\n    itBase64: Result := Element.toDataURL();\r\n    itPNG: Result := Element.toDataURL('image/png');\r\n    itJPEG: Result := Element.toDataURL('image/jpeg',1.0);\r\n    itBMP: Result := Element.toDataURL('image/bmp');\r\n    itGIF: Result := Element.toDataURL('image/gif');\r\n   end;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TCanvas.DownloadImage( AFileName: string; AType: TImageType = itPNG);\r\nvar\r\n  s: string;\r\nbegin\r\n  if Assigned(Element) then\r\n  begin\r\n    s := GetAsImage(AType);\r\n\r\n    asm\r\n      var element = document.createElement('a');\r\n      element.setAttribute('href', s);\r\n      if (AFileName != ''){\r\n        element.setAttribute('download', AFileName);\r\n      }\r\n      element.style.display = 'none';\r\n      document.body.appendChild(element);\r\n      element.click();\r\n      document.body.removeChild(element);\r\n\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TCanvas.LineTo(X, Y: Double);\r\nvar\r\n  dx,dy: single;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    dx := 0;\r\n    dy := 0;\r\n    GetAccuOffset(X,Y,dx,dy);\r\n\r\n    if not FPathOpen then\r\n    begin\r\n      FContext.beginPath();\r\n      ApplyStroke;\r\n      FContext.moveTo(FPathX + dx, FPathY + dy);\r\n    end;\r\n\r\n    FContext.lineTo(X + dx, Y + dy);\r\n    FContext.stroke();\r\n    FPathX := X;\r\n    FPathY := Y;\r\n\r\n    FPathOpen := false;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Save;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.save();\r\nend;\r\n\r\nprocedure TCanvas.SetClipRect(const Value: TCanvasRectF);\r\nbegin\r\n  FClipRect := Value;\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath;\r\n    FContext.rect(FClipRect.Left, FClipRect.Top, FClipRect.Right - FClipRect.Left, FClipRect.Bottom - FClipRect.Top);\r\n    FContext.clip;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.SetPixel(X,Y: Single; Clr: TColor);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.fillStyle := ColorToHtml(Clr);\r\n    FContext.fillRect(x,y, 1, 1);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.SetTransform(m11, m12, m21, m22, dx, dy: Double);\r\nvar\r\n  m: TMatrix;\r\n  px: Single;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    m := MatrixIdentity;\r\n    m.m11 := m11;\r\n    m.m12 := m12;\r\n    m.m21 := m21;\r\n    m.m22 := m22;\r\n    m.m31 := dx;\r\n    m.m32 := dy;\r\n\r\n    if ApplyPixelRatio then\r\n    begin\r\n      px := GetPixelRatio(Self);\r\n      m := MatrixMultiply(m, MatrixCreateScaling(px, px));\r\n    end;\r\n\r\n    FContext.setTransform(m.m11, m.m12, m.m21, m.m22, m.m31, m.m32);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.StretchDraw(Rect: TCanvasRectF; Graphic: TGraphic);\r\nvar\r\n  img: TJSObject;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    img := Graphic.Image;\r\n    FContext.drawImage(img, 0, 0, Graphic.width, Graphic.height, Rect.Left, Rect.Top, Rect.Right - Rect.Left, Rect.Bottom - Rect.Top);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.StretchDraw(Rect: TRect; Graphic: TGraphic);\r\nbegin\r\n  StretchDraw(CreateCanvasRectF(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom), Graphic);\r\nend;\r\n\r\nprocedure TCanvas.PathLineTo(X, Y: Integer);\r\nbegin\r\n  PathLineTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.PathLineTo(X, Y: Double);\r\nvar\r\n  dx, dy: Double;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    dx := 0;\r\n    dy := 0;\r\n    GetAccuOffset(X, Y, dx, dy);\r\n    FContext.lineTo(X + dx, Y + dy);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.PathFill;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    ApplyFill;\r\n    FContext.fill();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.PathStroke;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    ApplyStroke;\r\n    FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.PathMoveTo(X, Y: Integer);\r\nbegin\r\n  PathMoveTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.PathMoveTo(X, Y: Double);\r\nvar\r\n  dx, dy: Double;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    dx := 0;\r\n    dy := 0;\r\n    GetAccuOffset(X, Y, dx, dy);\r\n    FContext.moveTo(X + dx, Y + dy);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Polygon(const Points: array of TCanvasPointF);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    if l = 0 then\r\n      Exit;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    FContext.closePath();\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Polyline(const Points: array of TCanvasPointF);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    if l = 0 then\r\n      Exit;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(const Rect: TCanvasRectF);\r\nbegin\r\n  Ellipse(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.PathClose;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.closePath();\r\nend;\r\n\r\nprocedure TCanvas.EndScene;\r\nbegin\r\n  if Assigned(OnEndScene) then\r\n    OnEndScene(Self);\r\nend;\r\n\r\nprocedure TCanvas.FillRect(const Rect: TCanvasRectF);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Rotate(Angle: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.rotate(Angle);\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(const Rect: TCanvasRectF; CX, CY: Double);\r\nbegin\r\n  RoundRect(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom, CX, CY);\r\nend;\r\n\r\n{ TGraphic }\r\n\r\nconstructor TGraphic.Create(Img: TJSObject);\r\nbegin\r\n  FAddToQueue := True;\r\n  FEmpty := True;\r\n  FData := '';\r\n  FURL := '';\r\n  FImage := Img;\r\nend;\r\n\r\nprocedure TGraphic.AssignEvents;\r\nbegin\r\n  asm\r\n    var me = this;\r\n    this.FImage.onload = function() {\r\n       me.DoChange();\r\n      };\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.CaptureCanvas;\r\nbegin\r\n  if Assigned(FCanvas) and Assigned(FCanvas.Element) then\r\n    LoadFromResource(FCanvas.Element.toDataURL());\r\nend;\r\n\r\nconstructor TGraphic.Create;\r\nbegin\r\n  FAddToQueue := True;\r\n  FEmpty := True;\r\n  FData := '';\r\n  CreateImage;\r\n  AssignEvents;\r\nend;\r\n\r\nconstructor TGraphic.Create(URL: string);\r\nbegin\r\n  FAddToQueue := True;\r\n  FEmpty := True;\r\n  FData := '';\r\n  Create;\r\n  LoadFromURL(URL);\r\nend;\r\n\r\nprocedure TGraphic.Assign(Source: TGraphic);\r\nvar\r\n  s: string;\r\nbegin\r\n  if Assigned(Source) and Assigned(Source.FCanvas) then\r\n    LoadFromCanvas(Source.FCanvas)\r\n  else if Assigned(Source) and Assigned(Source.FImage) and not Source.Empty then\r\n  begin\r\n    asm\r\n      s = Source.FImage.src;\r\n    end;\r\n\r\n    LoadFromURL(s);\r\n  end\r\n  else if not Assigned(Source) then\r\n  begin\r\n    asm\r\n      this.FImage.src = \"\";\r\n    end;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nfunction TGraphic.Image: TJSObject;\r\nbegin\r\n  Result := FImage;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromCache(AData: String);\r\nvar\r\n  dt: string;\r\n  o: TJSObject;\r\n  b: Boolean;\r\n  s: string;\r\n  l: Boolean;\r\nbegin\r\n  FData := AData;\r\n  dt := AData;\r\n  if dt = '' then\r\n    Exit;\r\n    \r\n  if not FCache.Find(dt, o) then\r\n  begin\r\n    b := False;\r\n    s := '';\r\n    asm\r\n      s = this.FImage.src;\r\n      b = (s != '');\r\n    end;\r\n\r\n    l := b and (dt <> s);\r\n    if l then\r\n    begin\r\n      CreateImage;\r\n      AssignEvents;\r\n    end;\r\n\r\n    if (not l and (FQueue.IndexOf(dt) = -1)) or l then\r\n    begin\r\n      asm\r\n        this.FImage.src = dt;\r\n        dt = this.FImage.src;\r\n      end;\r\n\r\n      FData := dt;\r\n\r\n      Inc(FCacheCount);\r\n      if FAddToQueue then\r\n        FQueue.Add(dt);\r\n    end\r\n    else if (not l and (FQueue.IndexOf(dt) <> -1)) then\r\n    begin\r\n      asm\r\n        this.FImage.src = dt;\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    FImage := o;\r\n    DoChange;\r\n  end;\r\n\r\n  asm\r\n    this.FEmpty = (this.FImage.src == '');\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TGraphic.LoadFromCanvas(ACanvas: TCanvas);\r\nbegin\r\n  if Assigned(ACanvas) and Assigned(ACanvas.Element) then\r\n    LoadFromResource(ACanvas.Element.toDataURL());\r\nend;\r\n\r\nprocedure TGraphic.LoadFromFile(AFileName: string);\r\nbegin\r\n  LoadFromURL(AFileName);\r\nend;\r\n\r\nfunction TGraphic.GetAsImage(AType: TImageType): string;\r\nbegin\r\n  Result := '';\r\n  if Assigned(FCanvas) then\r\n    Result := FCanvas.GetAsImage(AType);\r\nend;\r\n\r\nfunction TGraphic.GetBase64Image: string;\r\nbegin\r\n  Result := '';\r\n  if Assigned(FCanvas) then\r\n    Result := FCanvas.GetBase64Image;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromResource(AResource: string; AHInstance: Integer);\r\nbegin\r\n  FEmpty := True;\r\n  LoadFromCache(AResource);\r\nend;\r\n\r\nprocedure TGraphic.LoadFromResource(AResource: string);\r\nbegin\r\n  LoadFromResource(AResource, 0);\r\nend;\r\n\r\nprocedure TGraphic.LoadFromStream(AStream: TStream);\r\nbegin\r\n  DoChange;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromURL(AURL: string; AHInstance: Integer);\r\nbegin\r\n  FEmpty := True;\r\n  LoadFromCache(AURL);\r\nend;\r\n\r\nprocedure TGraphic.LoadFromURL(AURL: string);\r\nbegin\r\n  LoadFromURL(AURL, 0);\r\nend;\r\n\r\nprocedure TGraphic.RecreateCanvas;\r\nbegin\r\n  if not Assigned(FCanvasElement) then\r\n    FCanvasElement := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n\r\n  if Assigned(FCanvasElement) then\r\n  begin\r\n    FCanvasElement.height := Height;\r\n    FCanvasElement.width := Width;\r\n    if not Assigned(FCanvas) then\r\n    begin\r\n      FCanvas := TCanvas.Create(FCanvasElement);\r\n      FCanvas.OnBeginScene := DoBeginScene;\r\n      FCanvas.OnEndScene := DoEndScene;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TGraphic.CreateFromResource(AResource: String;\r\n  AInstance: NativeUInt): TGraphic;\r\nbegin\r\n  Result := TGraphic.Create;\r\n  Result.LoadFromResource(AResource);\r\nend;\r\n\r\nclass function TGraphic.CreateFromURL(AURL: String): TGraphic;\r\nbegin\r\n  Result := CreateFromURL(AURL, 0);\r\nend;\r\n\r\nclass function TGraphic.CreateFromURL(AURL: String;\r\n  AInstance: NativeUInt): TGraphic;\r\nbegin\r\n  Result := TGraphic.Create;\r\n  Result.LoadFromURL(AURL);\r\nend;\r\n\r\nclass function TGraphic.CreateFromResource(AResource: string): TGraphic;\r\nbegin\r\n  Result := CreateFromResource(AResource, 0);\r\nend;\r\n\r\nprocedure TGraphic.CreateImage;\r\nbegin\r\n  asm\r\n    this.FImage = new Image();\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.DoBeginScene(Sender: TObject);\r\nbegin\r\n  FCanvas.Clear;\r\nend;\r\n\r\nprocedure TGraphic.DoChange;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  FEmpty := (Width = 0) and (Height = 0);\r\n  if not FEmpty and (FData <> '') and not FCache.Exists(FData) then\r\n  begin\r\n    FCache.Add(TGraphicCache.Create(FImage, FData));\r\n    i := FQueue.IndexOf(FData);\r\n    if (i >= 0) and (i <= FQueue.Count - 1) then\r\n      FQueue.Delete(i);\r\n\r\n    Dec(FCacheCount);\r\n    if FCacheCount = 0 then\r\n    begin\r\n      if Assigned(Application.OnImageCacheReady) then\r\n        Application.OnImageCacheReady(Application);\r\n    end;\r\n  end;\r\n\r\n  if Assigned(FOnChange) then\r\n    FOnChange(Self);\r\nend;\r\n\r\nprocedure TGraphic.DoEndScene(Sender: TObject);\r\nbegin\r\n  FAddToQueue := False;\r\n  CaptureCanvas;\r\n  FAddToQueue := True;\r\nend;\r\n\r\nfunction TGraphic.Empty: Boolean;\r\nbegin\r\n  Result := FEmpty;\r\nend;\r\n\r\nprocedure TGraphic.SetHeight(const Value: Integer);\r\nbegin\r\n  asm\r\n    this.FImage.height = Value;\r\n  end;\r\n  RecreateCanvas;\r\n  DoChange;\r\nend;\r\n\r\nprocedure TGraphic.SetSize(AWidth, AHeight: Integer);\r\nbegin\r\n  Width := AWidth;\r\n  Height := AHeight;\r\nend;\r\n\r\nprocedure TGraphic.SetURL(const URL: string);\r\nbegin\r\n  LoadFromURL(URL);\r\nend;\r\n\r\nprocedure TGraphic.SetWidth(const Value: Integer);\r\nbegin\r\n  asm\r\n    this.FImage.width = Value;\r\n  end;\r\n  RecreateCanvas;\r\n  DoChange;\r\nend;\r\n\r\nfunction TGraphic.GetWidth: Integer;\r\nvar\r\n  w: integer;\r\nbegin\r\n  w := 0;\r\n  if Assigned(FImage) then\r\n  begin\r\n    asm\r\n      w = this.FImage.width;\r\n    end;\r\n  end;\r\n  Result := w;\r\nend;\r\n\r\nfunction TGraphic.GetCanvas: TCanvas;\r\nbegin\r\n  if not Assigned(FCanvas) then\r\n    RecreateCanvas;\r\n\r\n  Result := FCanvas;\r\nend;\r\n\r\nfunction TGraphic.GetHeight: Integer;\r\nvar\r\n  h: integer;\r\nbegin\r\n  h := 0;\r\n  if Assigned(FImage) then\r\n  begin\r\n    asm\r\n      h = this.FImage.height;\r\n    end;\r\n  end;\r\n  Result := h;\r\nend;\r\n\r\n{ TGraphicCache }\r\n\r\nconstructor TGraphicCache.Create(AImage: TJSObject; AID: string);\r\nbegin\r\n  FImage := AImage;\r\n  FID := AID;\r\nend;\r\n\r\n{ TGraphicCacheList }\r\n\r\nfunction TGraphicCacheList.Exists(AID: string): Boolean;\r\nvar\r\n  I: Integer;\r\n  it: TGraphicCache;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Count - 1 do\r\n  begin\r\n    it := Items[I] as TGraphicCache;\r\n    if (it.ID = AID) and Assigned(it.Image) then\r\n    begin\r\n      Result := True;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TGraphicCacheList.Find(AID: string; var FImage: TJSObject): Boolean;\r\nvar\r\n  I: Integer;\r\n  it: TGraphicCache;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Count - 1 do\r\n  begin\r\n    it := Items[I] as TGraphicCache;\r\n    if (it.ID = AID) and Assigned(it.Image) then\r\n    begin\r\n      FImage := it.Image;\r\n      Result := True;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TURLPicture }\r\n\r\nprocedure TURLPicture.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TURLPicture) then\r\n  begin\r\n    FFileName := (Source as TURLPicture).FileName;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TURLPicture.Changed;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TURLPicture.DataChanged;\r\nbegin\r\n  if Assigned(OnDataChange) then\r\n    OnDataChange(Self);\r\nend;\r\n\r\nfunction TURLPicture.GetData: TBinaryString;\r\nbegin\r\n  Result := FData;\r\nend;\r\n\r\nprocedure TURLPicture.LoadFromFile(AFileName: string);\r\nbegin\r\n  FFilename := AFileName;\r\n  Changed;\r\nend;\r\n\r\nprocedure TURLPicture.SetData(const Value: TBinaryString);\r\nbegin\r\n  if (FData <> Value) then\r\n  begin\r\n    FData := Value;\r\n    DataChanged;\r\n  end;\r\nend;\r\n\r\n\r\ninitialization\r\nbegin\r\n  FCache := TGraphicCacheList.Create;\r\n  FQueue := TStringList.Create;\r\nend;\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Controls;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Graphics, Types, SysUtils, Web;\r\n\r\nconst\r\n  VK_CANCEL = 3;\r\n  VK_BACK = 8;\r\n  VK_TAB = 9;\r\n  VK_RETURN = 13;\r\n  VK_SHIFT = 16;\r\n  VK_CONTROL = 17;\r\n  VK_MENU = 18;\r\n  VK_PAUSE = 19;\r\n  VK_CAPITAL = 20;\r\n  VK_ESCAPE = 27;\r\n  VK_SPACE = 32;\r\n  VK_PRIOR = 33;\r\n  VK_NEXT = 34;\r\n  VK_END = 35;\r\n  VK_HOME = 36;\r\n  VK_LEFT = 37;\r\n  VK_UP = 38;\r\n  VK_RIGHT = 39;\r\n  VK_DOWN = 40;\r\n  VK_PRINT = 42;\r\n  VK_SNAPSHOT = 44;\r\n  VK_INSERT = 45;\r\n  VK_DELETE = 46;\r\n  VK_HELP = 47;\r\n  VK_LWIN = 91;\r\n  VK_RWIN = 92;\r\n  VK_NUMPAD0 = 96;\r\n  VK_NUMPAD1 = 97;\r\n  VK_NUMPAD2 = 98;\r\n  VK_NUMPAD3 = 99;\r\n  VK_NUMPAD4 = 100;\r\n  VK_NUMPAD5 = 101;\r\n  VK_NUMPAD6 = 102;\r\n  VK_NUMPAD7 = 103;\r\n  VK_NUMPAD8 = 104;\r\n  VK_NUMPAD9 = 105;\r\n  VK_MULTIPLY = 106;\r\n  VK_ADD = 107;\r\n  VK_SEPARATOR = 108;\r\n  VK_SUBTRACT = 109;\r\n  VK_DECIMAL = 110;\r\n  VK_DIVIDE = 111;\r\n  VK_F1 = 112;\r\n  VK_F2 = 113;\r\n  VK_F3 = 114;\r\n  VK_F4 = 115;\r\n  VK_F5 = 116;\r\n  VK_F6 = 117;\r\n  VK_F7 = 118;\r\n  VK_F8 = 119;\r\n  VK_F9 = 120;\r\n  VK_F10 = 121;\r\n  VK_F11 = 122;\r\n  VK_F12 = 123;\r\n  VK_F13 = 124;\r\n  VK_F14 = 125;\r\n  VK_F15 = 126;\r\n  VK_F16 = 127;\r\n  VK_F17 = 128;\r\n  VK_F18 = 129;\r\n  VK_F19 = 130;\r\n  VK_F20 = 131;\r\n  VK_F21 = 132;\r\n  VK_F22 = 133;\r\n  VK_F23 = 134;\r\n  VK_F24 = 135;\r\n  VK_NUMLOCK = 144;\r\n\r\ntype\r\n  TCursor = Integer;\r\n\r\nconst\r\n  crDefault     = 0;\r\n  crNone        = 1;\r\n  crArrow       = 2;\r\n  crCross       = 3;\r\n  crIBeam       = 4;\r\n  crSize        = 22;\r\n  crSizeNESW    = 6;\r\n  crSizeNS      = 7;\r\n  crSizeNWSE    = 8;\r\n  crSizeWE      = 9;\r\n  crUpArrow     = 10;\r\n  crHourGlass   = 11;\r\n  crDrag        = 12;\r\n  crNoDrop      = 13;\r\n  crHSplit      = 14;\r\n  crVSplit      = 15;\r\n  crMultIDrag   = 16;\r\n  crSQLWait     = 17;\r\n  crNo          = 18;\r\n  crAppStart    = 19;\r\n  crHelp        = 20;\r\n  crHandPoint   = 21;\r\n  crSizeAll     = 22;\r\n\r\ntype\r\n  TCSSCodeManager = class;\r\n  Single = Double;\r\n  TDragState = (dsDragEnter, dsDragLeave, dsDragMove);\r\n  TDragMode = (dmManual, dmAutomatic);\r\n  TDragKind = (dkDrag, dkDock);\r\n  TDragObject = class(TObject);\r\n\r\n  TAlign = (alNone, alTop, alBottom, alLeft, alRight, alClient, alCustom);\r\n  TMouseButton = (mbLeft, mbRight, mbMiddle);\r\n  TBorderStyle = (bsNone, bsSingle);\r\n  TSizeStyle = (ssPercent, ssAbsolute, ssAuto);\r\n  TScrollStyle = (ssNone, ssHorizontal, ssVertical, ssBoth);\r\n  TStyleElements = set of (seFont, seClient, seBorder);\r\n\r\n  TAnchorKind = (akLeft, akTop, akRight, akBottom);\r\n  TAnchors = set of TAnchorKind;\r\n\r\n  TMaterialGlyph = string;\r\n\r\n  TElementClassName = type string;\r\n  TElementID = type string;\r\n  TElementFont = (efProperty, efCSS);\r\n  TElementPosition = (epAbsolute, epRelative, epIgnore);\r\n\r\n  TElementEvent = (eeClick, eeMouseDown, eeMouseUp, eeMouseMove, eeDblClick, eeKeyPress, eeKeyDown, eeKeyUp);\r\n  TEventPropagation = set of TElementEvent;\r\n\r\n  // Classes\r\n  TShiftState = set of (ssShift, ssAlt, ssCtrl,\r\n    ssLeft, ssRight, ssMIDdle, ssDouble, ssTouch, ssPen, ssCommand);\r\n\r\n  TTextDirection = (tdDefault, tdLeftToRight, tdRightToLeft, tdInherit);\r\n\r\n  TDragSourceObject = class(TObject)\r\n  private\r\n    FJSEvent: TJSEvent;\r\n    FObject: TObject;\r\n  public\r\n    property Event: TJSEvent read FJSEvent write FJSEvent;\r\n    property &Object: TObject read FObject write FObject;\r\n  end;\r\n\r\n  TNotifyEvent = procedure(Sender: TObject) of object;\r\n  TMouseEvent = procedure(Sender: TObject; Button: TMouseButton; Shift: TShiftState; X,Y: Integer) of object;\r\n  TMouseWheelEvent = procedure(Sender: TObject; Shift: TShiftState; WheelDelta: Integer; MousePos: TPoint; var Handled: Boolean) of object;\r\n  TMouseMoveEvent = procedure(Sender: TObject; Shift: TShiftState; X,Y: Integer) of object;\r\n  TKeyEvent = procedure(Sender: TObject; var AKey: Word; Shift: TShiftState) of object;\r\n  TKeyPressEvent = procedure(Sender: TObject; var AChar: Char) of object;\r\n  TTouchEvent = procedure(Sender: TObject; X,Y: integer) of object;\r\n\r\n  TDragOverEvent = procedure(Sender, Source: TObject; X, Y: Integer; State: TDragState; var Accept: Boolean) of object;\r\n  TDragDropEvent = procedure(Sender, Source: TObject; X, Y: Integer) of object;\r\n  TStartDragEvent = procedure(Sender: TObject; var DragObject: TDragObject) of object;\r\n  TEndDragEvent = procedure(Sender, Target: TObject; X, Y: Integer) of object;\r\n\r\n  TControlStyleValue = (csAcceptsControls, csSetCaption);\r\n  TControlStyle = set of TControlStyleValue;\r\n\r\n  TMargins = class(TPersistent)\r\n  private \r\n    FOnChange: TNotifyEvent;\r\n    FLeft, FTop, FRight, FBottom: Integer;\r\n  protected\r\n    procedure SetLeft(const Value: integer);\r\n    procedure SetTop(const Value: integer);\r\n    procedure SetRight(const Value: integer);\r\n    procedure SetBottom(const Value: integer);\r\n    procedure DoChange; virtual;\r\n  public\r\n    constructor Create; reintroduce;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Left: Integer read FLeft write SetLeft default 3;\r\n    property Top: Integer read FTop write SetTop default 3;\r\n    property Right: Integer read FRight write SetRight default 3;\r\n    property Bottom: Integer read FBottom write SetBottom default 3;\r\n  end;\r\n\r\n  TPadding = class(TPersistent)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    FLeft, FTop, FRight, FBottom: Integer;\r\n  protected\r\n    procedure SetLeft(const Value: integer);\r\n    procedure SetTop(const Value: integer);\r\n    procedure SetRight(const Value: integer);\r\n    procedure SetBottom(const Value: integer);\r\n    procedure DoChange; virtual;\r\n  public\r\n    constructor Create; reintroduce;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Left: Integer read FLeft write SetLeft default 0;\r\n    property Top: Integer read FTop write SetTop default 0;\r\n    property Right: Integer read FRight write SetRight default 0;\r\n    property Bottom: Integer read FBottom write SetBottom default 0;\r\n  end;\r\n\r\n  TPercentSize = 0..100;\r\n\r\n  TControl = class(TComponent)\r\n  private\r\n    FCaptureDown: Boolean;\r\n    FMouseInsideLayer: Boolean;\r\n    FLayer: TJSElement;\r\n    FCaptured: Boolean;\r\n    FControlCreated: Boolean;\r\n    FUpdateCount: integer;\r\n    FBlockUpdateElement: Boolean;\r\n    FElement: TJSElement;\r\n    FID: string;\r\n    FNew: Boolean;\r\n    FContainer: TJSElement;\r\n    FElementEvent, FLastElementEvent: TJSEvent;\r\n    FElementClassName: string;\r\n    FColor: TColor;\r\n    FFont: TFont;\r\n    FParent, FPrevParent: TControl;\r\n    FControls: array of TControl;\r\n    FOnDragOver: TDragOverEvent;\r\n    FOnDragDrop: TDragDropEvent;\r\n    FOnStartDrag: TStartDragEvent;\r\n    FonEndDrag: TEndDragEvent;\r\n    FOnClick: TNotifyEvent;\r\n    FOnDblClick: TNotifyEvent;\r\n    FOnMouseDown: TMouseEvent;\r\n    FOnMouseUp: TMouseEvent;\r\n    FOnMouseMove: TMouseMoveEvent;\r\n    FOnKeyDown: TKeyEvent;\r\n    FOnKeyUp: TKeyEvent;\r\n    FOnKeyPress: TKeyPressEvent;\r\n    FOnEnter: TNotifyEvent;\r\n    FOnExit: TNotifyEvent;\r\n    FEnabled: Boolean;\r\n    FHint: string;\r\n    FRole: string;\r\n    FShowHint: Boolean;\r\n    FTabOrder: Integer;\r\n    FTabStop: Boolean;\r\n    FVisible: Boolean;\r\n    FWidth: Integer;\r\n    FHeight: Integer;\r\n    FTag: Integer;\r\n    FAlign: TAlign;\r\n    FAnchors: TAnchors;\r\n    FAlignWithMargins: boolean;\r\n    FIsAligning: boolean;\r\n    FOnMouseEnter: TNotifyEvent;\r\n    FOnMouseLeave: TNotifyEvent;\r\n    FCursor: TCursor;\r\n    FDoubleBuffered: Boolean;\r\n    FControlStyle: TControlStyle;\r\n    FMargins: TMargins;\r\n    FOnMouseWheel: TMouseWheelEvent;\r\n    FParentDoubleBuffered: Boolean;\r\n    FParentColor: Boolean;\r\n    FParentFont: Boolean;\r\n    FOnTouchMove: TTouchEvent;\r\n    FOnTouchStart: TTouchEvent;\r\n    FOnTouchEnd: TTouchEvent;\r\n    FOnTouchCancel: TTouchEvent;\r\n    FLinkTouchEvents: Boolean;\r\n    FWidthStyle: TSizeStyle;\r\n    FHeightStyle: TSizeStyle;\r\n    FWidthPercent: TPercentSize;\r\n    FHeightPercent: TPercentSize;\r\n    FOrigRect: TRect;\r\n    FOrigParentRect: TRect;\r\n    FIsResizing: boolean;\r\n    FShowFocus: boolean;\r\n    FBorderWidth: integer;\r\n    FOrigTop: integer;\r\n    FOrigLeft: integer;\r\n    FUpdateTopLeft: boolean;\r\n    FEnablePropagation: Boolean;\r\n    FParentShowHint: Boolean;\r\n    FScriptLoaded: Boolean;\r\n    FControlScriptCount: Integer;\r\n    FControlScriptCountLoaded: Integer;\r\n    FRequiredScripts: TStringList;\r\n    FElementFont: TElementFont;\r\n    FElementPosition: TElementPosition;\r\n    FParentElement: TJSHTMLElement;\r\n    FTagObject: TObject;\r\n    FClipChildren: Boolean;\r\n    FTextDirection: TTextDirection;\r\n    FEventStopPropagation: TEventPropagation;\r\n    FParentElementID: string;\r\n    FOnResize: TNotifyEvent;\r\n    FMouseMovePtr: pointer;\r\n    FMouseDownPtr: pointer;\r\n    FMouseUpPtr: pointer;\r\n    FMouseEnterPtr: pointer;\r\n    FMouseLeavePtr: pointer;\r\n    FClickPtr: pointer;\r\n    FDblClickPtr: pointer;\r\n    FKeyDownPtr: pointer;\r\n    FKeyUpPtr: pointer;\r\n    FKeyPressPtr: pointer;\r\n    FInputPtr: pointer;\r\n    FTouchStartPtr: pointer;\r\n    FTouchEndPtr: pointer;\r\n    FTouchMovePtr: pointer;\r\n    FTouchCancelPtr: pointer;\r\n    FExitPtr: pointer;\r\n    FEnterPtr: pointer;\r\n    FWheelPtr: pointer;\r\n    FLayerMouseEnterPtr: pointer;\r\n    FLayerMouseLeavePtr: pointer;\r\n    FScriptLoadedPtr: pointer;\r\n    FChildOrder: integer;\r\n    FAllowTouch: boolean;\r\n//    FDesignSize: TPoint;\r\n//    FExplicitLeft: integer;\r\n//    FExplicitTop: integer;\r\n//    FExplicitWidth: integer;\r\n//    FExplicitHeight: integer;\r\n    function GetControlsCount: Integer;\r\n    function GetControls(Index: Integer): TControl;\r\n    procedure SetVisible(AValue: Boolean);\r\n    procedure SetWidth(AValue: Integer); virtual;\r\n    procedure SetHeight(AValue: Integer); virtual;\r\n    procedure SetHint(AValue: string);\r\n    procedure SetShowHint(AValue: Boolean);\r\n    procedure SetTabOrder(AValue: Integer);\r\n    procedure SetTabStop(AValue: Boolean);\r\n    procedure SetAlign(const Value: TAlign);\r\n    procedure SetAlignWithMargins(const Value: boolean);\r\n    procedure SetCursor(const Value: TCursor);\r\n    function GetBoundsRect: TRect;\r\n    procedure SetBoundsRect(const Value: TRect);\r\n    procedure SetID(const Value: string);\r\n    procedure SetMargins(const Value: TMargins);\r\n    procedure SetAnchors(const Value: TAnchors);\r\n    function GetElementEvent: TJSEvent;\r\n    function GetClientOrigin: TPoint;\r\n    procedure SetHeightStyle(const Value: TSizeStyle);\r\n    procedure SetWidthStyle(const Value: TSizeStyle);\r\n    procedure SetHeightPercent(const Value: TPercentSize);\r\n    procedure SetWidthPercent(const Value: TPercentSize);\r\n    procedure SetShowFocus(const Value: boolean);\r\n    procedure SetBorderWidth(const Value: integer);\r\n    function GetIsLinked: boolean;\r\n    procedure SetScriptLoaded(const Value: boolean);\r\n    procedure SetRequiredScripts(const Value: TStringList);\r\n    procedure SetElementFont(const Value: TElementFont);\r\n    procedure SetElementPosition(const Value: TElementPosition);\r\n    procedure SetParentElement(const Value: TJSHTMLElement);\r\n    procedure SetClipChildren(const Value: Boolean);\r\n    function GetClientHeight: Integer;\r\n    function GetClientWidth: Integer;\r\n    procedure SetClientHeight(const Value: Integer);\r\n    procedure SetClientWidth(const Value: Integer);\r\n    procedure SetParentElementID(const Value: string);\r\n    procedure SetChildOrderEx(const Value: integer);\r\n    function GetRole: string;\r\n    procedure SetRole(const Value: string);\r\n    function GetContainer: TJSElement; virtual;\r\n    function GetChildContainer: TJSElement; virtual;\r\n    procedure SetParentFont(const Value: boolean);\r\n    procedure SetParentColor(const Value: boolean);\r\n  protected\r\n    procedure SetEnabled(Value: Boolean); virtual;\r\n    procedure RecreateCanvas; virtual;\r\n    procedure VisibleChanging; virtual;\r\n    procedure ColorChanging; virtual;\r\n    function GetWidth: Integer; virtual;\r\n    function GetHeight: Integer; virtual;\r\n    function GetOuterWidth: integer; virtual;\r\n    function GetOuterHeight: integer; virtual;\r\n    function GetDesignWidth: integer; virtual;\r\n    function GetDesignHeight: integer; virtual;\r\n    function GetDesignLeft: integer; virtual;\r\n    function GetDesignTop: integer; virtual;\r\n    function GetLeft: Integer; override;\r\n    function GetTop: Integer; override;\r\n    function HandleAllocated: Boolean; virtual;\r\n    function CreateElement: TJSElement; virtual;\r\n    function ContainerElement: TJSElement; virtual;\r\n    function IsStructuralElement: boolean; virtual;\r\n    procedure RecreateElement; virtual;\r\n    procedure BindElement; virtual;\r\n    procedure CreateInitialize; virtual;\r\n    procedure ClearControls; virtual;\r\n    function GetMouseEventButton(Event: TJSMouseEvent): TMouseButton; virtual;\r\n    function GetMouseEventShiftState(Event: TJSMouseEvent): TShiftState; virtual;\r\n    function GetKeyBoardEventShiftState(Event: TJSKeyBoardEvent): TShiftState; virtual;\r\n    function GetMouseWheelEventShiftState(Event: TJSWheelEvent): TShiftState; virtual;\r\n    function GetTouchEventShiftState(Event: TJSTouchEvent): TShiftState; virtual;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoWheel(Event: TJSWheelEvent): Boolean; virtual;\r\n    function HandleDoDblClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseDown(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseLeave(Event: TJSMouseEvent): Boolean; virtual;\r\n    function LayerHandleDoMouseEnter(Event: TJSMouseEvent): Boolean; virtual;\r\n    function LayerHandleDoMouseLeave(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseEnter(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleDoKeyUp(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleDoKeyPress(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleDoInput(Event: TJSMessageEvent): Boolean; virtual;\r\n    function HandleDoExit(Event: TEventListenerEvent): Boolean; virtual;\r\n    function HandleDoEnter(Event: TJSFocusEvent): Boolean; virtual;\r\n    function HandleDoTouchStart(Event: TJSTouchEvent): Boolean; virtual;\r\n    function HandleDoTouchMove(Event: TJSTouchEvent): Boolean; virtual;\r\n    function HandleDoTouchEnd(Event: TJSTouchEvent): Boolean; virtual;\r\n    function HandleDoTouchCancel(Event: TJSTouchEvent): Boolean; virtual;\r\n    procedure HandleFontChanged(Sender: TObject);\r\n    procedure ParentFontChanged;\r\n    procedure DoExit; virtual;\r\n    procedure DoEnter; virtual;\r\n    procedure Click; virtual;\r\n    procedure UpdateElement; virtual;\r\n    procedure UpdateElementSize; virtual;\r\n    procedure UpdateElementVisual; virtual;\r\n    procedure UpdateElementData; virtual;\r\n    procedure UpdateParent; virtual;\r\n    procedure UpdateControlSize(AWidth, AHeight: integer); virtual;\r\n    procedure InternalUpdateParent; virtual;\r\n    procedure UpdateChildren(AControl: TControl); virtual;\r\n    procedure PersistinHTML; virtual;\r\n    procedure InitFromHTML; virtual;\r\n    procedure DisableTab; virtual;\r\n    procedure EnableTab; virtual;\r\n\r\n    procedure SetElementClassName(AValue: string); virtual;\r\n    procedure SetColor(AValue: TColor); virtual;\r\n    procedure SetFont(AValue: TFont); virtual;\r\n    procedure SetParent(AValue: TControl); virtual;\r\n    procedure RegisterParent(AValue: TControl); virtual;\r\n    procedure UnRegisterParent(AValue: TControl); virtual;\r\n\r\n    procedure SetLeft(AValue: Integer); override;\r\n    procedure SetTop(AValue: Integer); override;\r\n\r\n    procedure MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); virtual;\r\n    procedure MouseDown(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); virtual;\r\n    procedure MouseMove(Shift: TShiftState; X,Y: Integer); virtual;\r\n\r\n    procedure TouchStart(X,Y: Integer); virtual;\r\n    procedure TouchMove(X,Y: Integer); virtual;\r\n    procedure TouchEnd(X,Y: Integer); virtual;\r\n    procedure TouchCancel(X,Y: Integer); virtual;\r\n\r\n    procedure DoMouseEnter; virtual;\r\n    procedure DoMouseLeave; virtual;\r\n    procedure MouseWheel(Shift: TShiftState; WheelDelta: Integer; var Handled: Boolean); virtual;\r\n    procedure DblClick; virtual;\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); virtual;\r\n    procedure KeyPress(var Key: Char); virtual;\r\n    procedure KeyUp(var Key: Word; Shift: TShiftState); virtual;\r\n    procedure SetFocus; virtual;\r\n    procedure DoMarginsChanged(Sender: TObject); virtual;\r\n    procedure DoRealign; virtual;\r\n    procedure DoBoundsChange; virtual;\r\n    procedure DoEndDrag(Target: TObject; X, Y: Integer); virtual;\r\n    procedure DoStartDrag(var DragObject: TDragObject); virtual;\r\n    procedure DragOver(Source: TObject; X, Y: Integer; State: TDragState;\r\n      var Accept: Boolean); virtual;\r\n    function IsFocused: Boolean; virtual;\r\n    function Focused: Boolean; virtual;\r\n    function GetID: string;\r\n    function GetElementHandle: TJSHTMLElement; virtual;\r\n    function GetElementBindHandle: TJSEventTarget; virtual;\r\n    function GetElement: TJSElement;\r\n    function GetKeyCode(AValue: string; IgnoreCase: boolean = true): Integer;\r\n    function IsKeyCharacter(AValue: string): Boolean;\r\n    function GetClientRect: TRect; virtual;\r\n    property Container: TJSElement read GetContainer write FContainer;\r\n    property ChildContainer: TJSElement read GetChildContainer;\r\n    property ElementBindHandle: TJSEventTarget read GetElementBindHandle;\r\n    property Element: TJSElement read GetElement;\r\n    property ElementEvent: TJSEvent read GetElementEvent write FElementEvent;\r\n\r\n    procedure CreateControl; virtual;\r\n    procedure ClearMethodPointers; virtual;\r\n    procedure GetMethodPointers; virtual;\r\n    function EventsBound: boolean;\r\n    procedure BindEvents; virtual;\r\n    procedure UnbindEvents; virtual;\r\n    procedure AlignControls(AControl: TControl; var ARect: TRect); virtual;\r\n    procedure AlignControl(AControl: TControl); virtual;\r\n    procedure InitAnchoring; virtual;\r\n    function AnchoringInitialized: boolean;\r\n    procedure InitScript; virtual;\r\n    procedure Realign; virtual;\r\n    procedure Loaded; override;\r\n    procedure InternalResize; virtual;\r\n    procedure FontChanged; virtual;\r\n    procedure DisposeOf;\r\n\r\n    property Color: TColor read FColor write SetColor;\r\n    property ControlCreated: boolean read FControlCreated;\r\n    property Font: TFont read FFont write SetFont;\r\n    property ClientOrigin: TPoint read GetClientOrigin;\r\n    property OrigRect: TRect read FOrigRect;\r\n\r\n    property OnClick: TNotifyEvent read FOnClick write FOnClick;\r\n    property OnResize: TNotifyEvent read FOnResize write FOnResize;\r\n    property OnDblClick: TNotifyEvent read FOnDblClick write FOnDblClick;\r\n    property ControlStyle: TControlStyle read FControlStyle write FControlStyle;\r\n    procedure HookElement;\r\n    procedure CreateWithID(AID: string); virtual;\r\n    procedure AddInstanceStyle(const css: string); virtual;\r\n    procedure AddControlStyle(const css: string); virtual;\r\n    procedure AddControlLink(const linkid, link: string); virtual;\r\n    procedure AddControlScriptLink(const link: string); virtual;\r\n    procedure AddControlScriptSource(const source: string); virtual;\r\n    function AddRequiredScripts: boolean;\r\n    procedure AddRequiredScript(const link: string); virtual;\r\n    procedure ResetAnchoring; virtual;\r\n    procedure UpdateAnchoring; virtual;\r\n    procedure UpdateChildAnchoring; virtual;\r\n    procedure SetElementPointer(AElement: TJSHTMLElement; ACursor: TCursor);\r\n    function GetWebClassName: string; virtual;\r\n    function GetCSSManager: TCSSCodeManager; virtual;\r\n    function IsUpdating: boolean;\r\n    function CanShowFocus: boolean; virtual;\r\n    procedure RequiredScriptLoaded(Event: TJSEvent); virtual;\r\n    procedure InjectCSS; virtual;\r\n    procedure StartCapture; virtual;\r\n    property LinkTouchEvents: Boolean read FLinkTouchEvents write FLinkTouchEvents;\r\n    property OnTouchStart: TTouchEvent read FOnTouchStart write FOnTouchStart;\r\n    property OnTouchMove: TTouchEvent read FOnTouchMove write FOnTouchMove;\r\n    property OnTouchEnd: TTouchEvent read FOnTouchEnd write FOnTouchEnd;\r\n    property OnTouchCancel: TTouchEvent read FOnTouchCancel write FOnTouchCancel;\r\n    property ShowFocus: boolean read FShowFocus write SetShowFocus;\r\n    property BorderWidth: integer read FBorderWidth write SetBorderWidth;\r\n    property ControlScriptCount: integer read FControlScriptCount write FControlScriptCount;\r\n    property ControlScriptCountLoaded: integer read FControlScriptCountLoaded write FControlScriptCountLoaded;\r\n    property RequiredScripts: TStringList read FRequiredScripts write SetRequiredScripts;\r\n    property Role: string read GetRole write SetRole;\r\n    property TextDirection: TTextDirection read FTextDirection write  FTextDirection;\r\n    function RequiredBaseURL: string; virtual;\r\n    procedure SetBoundsInt(X, Y, AWidth, AHeight: Integer); virtual;\r\n  public\r\n    constructor Create(ID: string); virtual; overload;\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure DragDrop(Source: TObject; X, Y: Integer); virtual;\r\n    procedure Resize; virtual;\r\n    procedure Capture;\r\n    procedure ApplyName;\r\n    procedure ReleaseCapture;\r\n    procedure BringToFront;\r\n    procedure SendToBack;\r\n    procedure PreventDefault;\r\n    procedure StopPropagation;\r\n    procedure BeginUpdate; override;\r\n    procedure EndUpdate; override;\r\n    procedure Invalidate; virtual;\r\n    procedure SetParentComponent(Value: TComponent); override;\r\n    procedure SetBounds(X, Y, AWidth, AHeight: Integer); virtual;\r\n    procedure XYToClient(X,Y: single; var AClientX, AClientY: single); virtual;\r\n    procedure ClientToXY(AClientX, AClientY: single; var X,Y: single); virtual;\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); override;\r\n    function Captured: Boolean; virtual;\r\n    function MakeScreenshot: TBitmap; virtual;\r\n    function ClientToScreen(const Point: TPoint): TPoint; virtual;\r\n    function ScreenToClient(const Point: TPoint): TPoint; virtual;\r\n    function CanFocus: Boolean; virtual;\r\n    property AllowTouch: boolean read FAllowTouch write FAllowTouch;\r\n    property EventStopPropagation: TEventPropagation read FEventStopPropagation write FEventStopPropagation;\r\n    property ChildOrder: integer read FChildOrder write SetChildOrderEx;\r\n    property Controls[Index: Integer]: TControl read GetControls;\r\n    property ControlCount: Integer read GetControlsCount;\r\n    property Parent: TControl read FParent write SetParent;\r\n    property ParentElement: TJSHTMLElement read FParentElement write SetParentElement;\r\n    property ParentElementID: string read FParentElementID write  SetParentElementID;\r\n    property BoundsRect: TRect read GetBoundsRect write SetBoundsRect;\r\n    property DoubleBuffered: Boolean read FDoubleBuffered write FDoubleBuffered default false;\r\n    property ParentDoubleBuffered: Boolean read FParentDoubleBuffered write FParentDoubleBuffered default true;\r\n    property ParentColor: boolean read FParentColor write SetParentColor default false;\r\n    property ParentFont: boolean read FParentFont write SetParentFont default true;\r\n    property Align: TAlign read FAlign write SetAlign default alNone;\r\n    property AlignWithMargins: boolean read FAlignWithMargins write SetAlignWithMargins default false;\r\n    property ElementHandle: TJSHTMLElement read GetElementHandle;\r\n    property ElementClassName: TElementClassName read FElementClassName write SetElementClassName;\r\n    property ElementFont: TElementFont read FElementFont write SetElementFont default efProperty;\r\n    property ElementPosition: TElementPosition read FElementPosition write SetElementPosition default epAbsolute;\r\n    property ElementID: TElementID read GetID write SetID;\r\n    property Margins: TMargins read FMargins write SetMargins;\r\n    property ClientRect: TRect read GetClientRect;\r\n    property EnablePropagation: Boolean read FEnablePropagation write FEnablePropagation default False;\r\n    property ScriptLoaded: boolean read FScriptLoaded write SetScriptLoaded;\r\n    property ClipChildren: Boolean read FClipChildren write SetClipChildren default True;\r\n\r\n    property Anchors: TAnchors read FAnchors write SetAnchors default [akLeft, akTop];\r\n    property Cursor: TCursor read FCursor write SetCursor default crDefault;\r\n    property Enabled: Boolean read FEnabled write SetEnabled default true;\r\n    property HeightStyle: TSizeStyle read FHeightStyle write SetHeightStyle default ssAbsolute;\r\n    property Height: Integer read GetHeight write SetHeight;\r\n    property HeightPercent: TPercentSize read FHeightPercent write SetHeightPercent default 100;\r\n    property Hint: string read FHint write SetHint;\r\n    property IsLinked: boolean read GetIsLinked;\r\n    property ShowHint: Boolean read FShowHint write SetShowHint default false;\r\n    property ParentShowHint: Boolean read FParentShowHint write FParentShowHint;\r\n    property TabOrder: Integer read FTabOrder write SetTabOrder;\r\n    property TabStop: Boolean read FTabStop write SetTabStop default true;\r\n    property Tag: Integer read FTag write FTag default 0;\r\n    property TagObject: TObject read FTagObject write FTagObject;\r\n    property Visible: Boolean read FVisible write SetVisible default true;\r\n    property WidthStyle: TSizeStyle read FWidthStyle write SetWidthStyle default ssAbsolute;\r\n    property ClientHeight: Integer read GetClientHeight write SetClientHeight;\r\n    property ClientWidth: Integer read GetClientWidth write SetClientWidth;\r\n    property Width: Integer read GetWidth write SetWidth;\r\n    property WidthPercent: TPercentSize read FWidthPercent write SetWidthPercent default 100;\r\n\r\n    property OnDragOver: TDragOverEvent read FOnDragOver write FOnDragOver;\r\n    property OnDragDrop: TDragDropEvent read FOnDragDrop write FOnDragDrop;\r\n    property OnStartDrag: TStartDragEvent read FOnStartDrag write FOnStartDrag;\r\n    property OnEndDrag: TEndDragEvent read FOnEndDrag write FOnEndDrag;\r\n\r\n    property OnMouseWheel: TMouseWheelEvent read FOnMouseWheel write FOnMouseWheel;\r\n    property OnMouseDown: TMouseEvent read FOnMouseDown write FOnMouseDown;\r\n    property OnMouseUp: TMouseEvent read FOnMouseUp write FOnMouseUp;\r\n    property OnMouseMove: TMouseMoveEvent read FOnMouseMove write FOnMouseMove;\r\n    property OnMouseEnter: TNotifyEvent read FOnMouseEnter write FOnMouseEnter;\r\n    property OnMouseLeave: TNotifyEvent read FOnMouseLeave write FOnMouseLeave;\r\n    //Note: On Android the OnKeyUp and OnKeyDown events do not return the correct KeyCode.\r\n    //This is a known issue:\r\n    //https://bugs.chromium.org/p/chromium/issues/detail?id=118639\r\n    //https://stackoverflow.com/questions/36753548/keycode-on-android-is-always-229\r\n    //Workaround: Use the Char parameter of the OnKeyPress event instead\r\n    property OnKeyUp: TKeyEvent read FOnKeyUp write FOnKeyUp;\r\n    property OnKeyDown: TKeyEvent read FOnKeyDown write FOnKeyDown;\r\n    //\r\n    //Note: On Android the OnKeyPress event is not triggered.\r\n    //The OnInput event is used instead to trigger the OnKeyPress event.\r\n    property OnKeyPress: TKeyPressEvent read FOnKeyPress write FOnKeyPress;\r\n    //\r\n    property OnEnter: TNotifyEvent read FOnEnter write FOnEnter;\r\n    property OnExit: TNotifyEvent read FOnExit write FOnExit;\r\n  published\r\n//    property DesignSize: TPoint read FDesignSize write FDesignSize stored false;\r\n//    property ExplicitLeft: integer read FExplicitLeft write FExplicitLeft stored false;\r\n//    property ExplicitTop: integer read FExplicitTop write FExplicitTop stored false;\r\n//    property ExplicitWidth: integer read FExplicitWidth write FExplicitWidth stored false;\r\n//    property ExplicitHeight: integer read FExplicitHeight write FExplicitHeight stored false;\r\n  end;\r\n\r\n  TWinControl = class(TControl)\r\n  published\r\n    property Cursor;\r\n    property ElementClassName;\r\n    property Enabled;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property ShowHint;\r\n    property Tag;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseEnter;\r\n    property OnMouseLeave;\r\n    property OnKeyUp;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TCustomControl = class(TWinControl)\r\n  private\r\n    FCaption: string;\r\n    FPixelRatio: Single;\r\n    FPainting: boolean;\r\n    FCanvas: TCanvas;\r\n    FElementCanvas: TJSHTMLCanvasElement;\r\n    FBorderStyle: TBorderStyle;\r\n    FBorderColor: TColor;\r\n    FCustomBorder: boolean;\r\n    function GetCanvas: TCanvas;\r\n  protected\r\n    procedure RenderDesigning(ACaption: string; AElement: TJSElement; AControl: TCustomControl; ADisplay: Boolean);\r\n    function GetPixelRatio: Single;\r\n    procedure RecreateCanvas; override;\r\n    procedure SetBorderStyle(const AValue: TBorderStyle); virtual;\r\n    procedure SetBorderColor(const AValue: TColor); virtual;\r\n    procedure SetName(const NewName: TComponentName); override;\r\n    procedure SetCaption(const AValue: string); virtual;\r\n    procedure CreateControl; override;\r\n    procedure Loaded; override;\r\n    procedure UpdateElementVisual; override;\r\n    function CreateElement: TJSElement; override;\r\n    function GetCanvasHeightOffset: Integer; virtual;\r\n    function GetCanvasWidthOffset: Integer; virtual;\r\n    property BorderStyle: TBorderStyle read FBorderStyle write SetBorderStyle default bsSingle;\r\n    property BorderColor: TColor read FBorderColor write SetBorderColor default clSilver;\r\n    procedure BindElement; override;\r\n    procedure BindEvents; override;\r\n    procedure Paint; virtual;\r\n    property CustomBorder: boolean read FCustomBorder write FCustomBorder;\r\n    property Caption: string read FCaption write SetCaption;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    function MakeScreenShot: TBitmap; override;\r\n    procedure Resize; override;\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property ElementCanvas: TJSHTMLCanvasElement read FElementCanvas;\r\n    procedure Invalidate; override;\r\n  end;\r\n\r\n  TjQueryCustomControl = class(TWinControl)\r\n  private\r\n    FIsInitialized: boolean;\r\n    procedure InitJQueryOnce;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure Loaded; override;\r\n    procedure SetParent(AValue: TControl); override;\r\n    function GetJQID: string;\r\n    procedure InitJQuery; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property ElementPosition;\r\n  end;\r\n\r\n  TGraphicControl = class(TCustomControl);\r\n\r\n  TScrollingGraphicControl = class(TCustomControl)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure UpdateElement; override;\r\n  end;\r\n\r\n  TCustomHTMLDiv = class(TCustomControl)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  end;\r\n\r\n  TControlManager = class(TComponent)\r\n  private\r\n    FInstanceCount: integer;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    function GetInstanceNumber: integer;\r\n    procedure Reset;\r\n  end;\r\n\r\n  TCSSCodeFragment = class(TCollectionItem)\r\n  private\r\n    FControlClassname: string;\r\n    FCSS: TStringList;\r\n    procedure SetCSS(const Value: TStringList);\r\n  public\r\n    constructor Create(Collection: TCollection); override;\r\n    destructor Destroy; override;\r\n  published\r\n    property ControlClassname: string read FControlClassname write FControlClassname;\r\n    property CSS: TStringList read FCSS write SetCSS;\r\n  end;\r\n\r\n  TCSSCodeFragments = class(TOwnedCollection)\r\n  private\r\n    function GetItemEx(Index: integer): TCSSCodeFragment;\r\n    procedure SetItemEx(Index: integer; const Value: TCSSCodeFragment);\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TCSSCodeFragment; reintroduce;\r\n    function Insert(Index: integer): TCSSCodeFragment; reintroduce;\r\n    property Items[Index: integer]: TCSSCodeFragment read GetItemEx write SetItemEx;\r\n  end;\r\n\r\n  TCSSCodeManager = class(TComponent)\r\n  private\r\n    FCSSFragments: TCSSCodeFragments;\r\n    procedure SetCSSFragments(const Value: TCSSCodeFragments);\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function GetClassFragment(AClassname: string): TCSSCodeFragment;\r\n    function GetClassCSS(AClassname: string): string;\r\n  published\r\n    property CSSFragments: TCSSCodeFragments read FCSSFragments write SetCSSFragments;\r\n  end;\r\n\r\nfunction FindGlobalComponent(const Name: string): TComponent;\r\nfunction GetMousePos: TPoint;\r\nfunction FindUniqueName(const Name: string): string;\r\nfunction GetScrollBarHeight: integer;\r\nfunction GetScrollBarWidth: integer;\r\nprocedure SetHTMLElementFont(AElement: TJSHTMLElement; AFont: TFont; UseCSS: boolean);\r\nprocedure SetHTMLElementColor(AElement: TJSHTMLElement; AColor: TColor; UseCSS: boolean);\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Forms, Math, TypInfo;\r\n\r\nvar\r\n  ControlManager: TControlManager;\r\n  FMouseX, FMouseY: Integer;\r\n  ScrollBW, ScrollBH: Integer;\r\n\r\nconst\r\n  cStyleBkgColor = 'background-color';\r\n\r\nprocedure SetHTMLElementFont(AElement: TJSHTMLElement; AFont: TFont; UseCSS: boolean);\r\nvar\r\n  s: string;\r\nbegin\r\n  if UseCSS then\r\n  begin\r\n    AElement.style.removeProperty('font-family');\r\n    AElement.style.removeProperty('font-style');\r\n    AElement.style.removeProperty('font-weight');\r\n    AElement.style.removeProperty('text-decoration');\r\n  end\r\n  else\r\n  begin\r\n    AElement.style.setProperty('font-family', AFont.Name);\r\n\r\n    AElement.style.setProperty('font-style', 'normal');\r\n\r\n    if fsBold in AFont.Style then\r\n      AElement.style.setProperty('font-weight', 'bold')\r\n    else\r\n      AElement.style.setProperty('font-weight', '');\r\n\r\n    if fsItalic in AFont.Style then\r\n       AElement.style.setProperty('font-style', 'italic');\r\n\r\n    s := '';\r\n\r\n    if fsUnderline in AFont.Style then\r\n      s := 'underline';\r\n\r\n    if fsStrikeOut in AFont.Style then\r\n    begin\r\n      if s <> ''  then\r\n         s := s + ' ';\r\n       s:= s + 'line-through';\r\n    end;\r\n\r\n    if (s <> '') then\r\n      AElement.style.setProperty('text-decoration', s);\r\n\r\n    AElement.style.setProperty('font-size', IntToStr(AFont.Size) + 'pt');\r\n  end;\r\nend;\r\n\r\nprocedure SetHTMLElementColor(AElement: TJSHTMLElement; AColor: TColor; UseCSS: boolean);\r\nbegin\r\n  if UseCSS or (AColor = clNone) then\r\n    AElement.style.removeProperty(cStyleBkgColor)\r\n  else\r\n    AElement.style.setProperty(cStyleBkgColor, ColorToHTML(AColor));\r\nend;\r\n\r\n\r\nfunction IsAndroid: Boolean;\r\nvar\r\n  sagent: string;\r\nbegin\r\n  asm\r\n    sagent = navigator.userAgent;\r\n  end;\r\n  Result := (pos('Android', sagent) > 0);\r\nend;\r\n\r\nfunction GetMousePos: TPoint;\r\nbegin\r\n  Result := Point(FMouseX, FMouseY);\r\nend;\r\n\r\nfunction GetScrollBarWidth: integer;\r\nvar\r\n  res: integer;\r\nbegin\r\n  res := ScrollBW;\r\n\r\n  if res = 0 then\r\n  begin\r\n\r\n    asm\r\n      var outer = document.createElement(\"div\");\r\n      outer.style.visibility = \"hidden\";\r\n      outer.style.width = \"100px\";\r\n      outer.style.msOverflowStyle = \"scrollbar\"; // needed for WinJS apps\r\n\r\n      document.body.appendChild(outer);\r\n\r\n      var widthNoScroll = outer.offsetWidth;\r\n      // force scrollbars\r\n      outer.style.overflow = \"scroll\";\r\n\r\n      // add innerdiv\r\n      var inner = document.createElement(\"div\");\r\n      inner.style.width = \"100%\";\r\n      outer.appendChild(inner);\r\n\r\n      var widthWithScroll = inner.offsetWidth;\r\n\r\n      // remove divs\r\n      outer.parentNode.removeChild(outer);\r\n\r\n      res = widthNoScroll - widthWithScroll;\r\n    end;\r\n    ScrollBW := res;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction GetScrollBarHeight: integer;\r\nvar\r\n  res: integer;\r\nbegin\r\n  res := ScrollBH;\r\n\r\n  if res = 0 then\r\n  begin\r\n    asm\r\n      var outer = document.createElement(\"div\");\r\n      outer.style.visibility = \"hidden\";\r\n      outer.style.height = \"100px\";\r\n      outer.style.msOverflowStyle = \"scrollbar\"; // needed for WinJS apps\r\n\r\n      document.body.appendChild(outer);\r\n\r\n      var HeightNoScroll = outer.offsetHeight;\r\n      // force scrollbars\r\n      outer.style.overflow = \"scroll\";\r\n\r\n      // add innerdiv\r\n      var inner = document.createElement(\"div\");\r\n      inner.style.height = \"100%\";\r\n      outer.appendChild(inner);\r\n\r\n      var HeightWithScroll = inner.offsetHeight;\r\n\r\n      // remove divs\r\n      outer.parentNode.removeChild(outer);\r\n\r\n      res = HeightNoScroll - HeightWithScroll;\r\n\r\n      res = 0;\r\n    end;\r\n    ScrollBH := res;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction FindGlobalComponent(const Name: string): TComponent;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nfunction FindUniqueName(const Name: string): string;\r\nbegin\r\n  Result := Name + IntToStr(ControlManager.GetInstanceNumber);\r\nend;\r\n\r\n{ TMargins }\r\n\r\nprocedure TMargins.SetLeft(const Value: integer);\r\nbegin\r\n  if (Value <> FLeft) then\r\n  begin\r\n    FLeft := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.SetTop(const Value: integer);\r\nbegin\r\n  if (Value <> FTop) then\r\n  begin\r\n    FTop := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.SetRight(const Value: integer);\r\nbegin\r\n  if (Value <> FRight) then\r\n  begin\r\n    FRight := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.SetBottom(const Value: integer);\r\nbegin\r\n  if (Value <> FBottom) then\r\n  begin\r\n    FBottom := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.DoChange; \r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{ TControl }\r\n\r\nfunction TControl.MakeScreenshot: TBitmap;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nprocedure TControl.MouseDown(Button: TMouseButton; Shift: TShiftState; X,\r\n  Y: Integer);\r\nbegin\r\n  if Assigned(OnMouseDown) then\r\n   OnMouseDown(Self, Button, Shift, X, Y);\r\nend;\r\n\r\nprocedure TControl.MouseMove(Shift: TShiftState; X, Y: Integer);\r\nbegin\r\n  if Assigned(OnMouseMove) then\r\n   OnMouseMove(Self, Shift, X, Y);\r\nend;\r\n\r\nprocedure TControl.MouseUp(Button: TMouseButton; Shift: TShiftState; X,\r\n  Y: Integer);\r\nbegin\r\n  if Assigned(OnMouseUp) then\r\n   OnMouseUp(Self, Button, Shift, X, Y);\r\nend;\r\n\r\nprocedure TControl.MouseWheel(Shift: TShiftState; WheelDelta: Integer;\r\n  var Handled: Boolean);\r\nbegin\r\n  if Assigned(OnMouseWheel) then\r\n    OnMouseWheel(Self, Shift, WheelDelta, Point(0, 0), Handled);\r\nend;\r\n\r\nprocedure TControl.DoMouseLeave;\r\nbegin\r\n  if Assigned(OnMouseLeave) then\r\n    OnMouseLeave(Self);\r\nend;\r\n\r\nprocedure TControl.DoMouseEnter;\r\nbegin\r\n  if Assigned(OnMouseEnter) then\r\n    OnMouseEnter(Self);\r\nend;\r\n\r\nprocedure TControl.AlignControls(AControl: TControl; var ARect: TRect);\r\nvar\r\n  j: Integer;\r\n\r\n  procedure DoPosition(Control: TControl; AAlign: TAlign);\r\n  var\r\n    dl, dt, dr, db: integer;\r\n  begin\r\n    if not Control.AnchoringInitialized then\r\n      InitAnchoring;\r\n\r\n    Control.FUpdateTopLeft := true;\r\n\r\n    if Control.AlignWithMargins then\r\n    begin\r\n      dl := Control.Margins.Left;\r\n      dt := Control.Margins.Top;\r\n      db := Control.Margins.Bottom;\r\n      dr := Control.Margins.Right;\r\n    end\r\n    else\r\n    begin\r\n      dl := 0;\r\n      dt := 0;\r\n      db := 0;\r\n      dr := 0;\r\n    end;\r\n\r\n    case AAlign of\r\n      alTop:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Left + dl, ARect.Top + dt, ARect.Right - ARect.Left - dl - dr, Control.Height);\r\n        ARect.Top := ARect.Top + Control.Height + dt + db;\r\n      end;\r\n      alBottom:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Left + dl, ARect.Bottom - Control.Height - db - 1, ARect.Right - ARect.Left - dl - dr - 1, Control.Height);\r\n        ARect.Bottom := ARect.Bottom - Control.Height - dt - db;\r\n      end;\r\n      alLeft:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Left + dl, ARect.Top + dt, Control.Width, ARect.Bottom - ARect.Top - dt - db);\r\n        ARect.Left := ARect.Left + Control.Width + dl + dr;\r\n      end;\r\n      alRight:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Right - Control.Width - dr, ARect.Top + dt, Control.Width, ARect.Bottom - ARect.Top - db - dt);\r\n        ARect.Right := ARect.Right - Control.Width - dr - dl;\r\n      end;\r\n      alClient:\r\n      begin\r\n        Control.SetBoundsInt(ARect.Left + dl, ARect.Top + dt, ARect.Right - ARect.Left - dl - dr, ARect.Bottom - ARect.Top - db - dt);\r\n        ARect.Left := 0;\r\n        ARect.Top := 0;\r\n        ARect.Right := 0;\r\n        ARect.Bottom := 0;\r\n      end;\r\n    end;\r\n\r\n    Control.FUpdateTopLeft := false;\r\n  end;\r\n\r\n  procedure DoAlign(AAlign: TAlign);\r\n  var\r\n    i,j,ins: Integer;\r\n    il: TList;\r\n  begin\r\n    il := TList.Create;\r\n\r\n    for i := 0 to ControlCount - 1 do\r\n    begin\r\n      if (Controls[i].Align = AAlign) and (Controls[i].Visible) then\r\n      begin\r\n        ins := il.Count;\r\n\r\n        for j := il.Count - 1 downto 0 do\r\n        begin\r\n          case AAlign of\r\n          alTop:\r\n            if Controls[i].FOrigTop < TControl(il.Items[j]).FOrigTop then\r\n              ins := j;\r\n          alLeft:\r\n            if Controls[i].FOrigLeft < TControl(il.Items[j]).FOrigLeft then\r\n              ins := j;\r\n          alRight:\r\n            if Controls[i].FOrigLeft + Controls[i].Width > TControl(il.Items[j]).FOrigLeft + TControl(il.Items[j]).Width then\r\n              ins := j;\r\n          alBottom:\r\n            if Controls[i].FOrigTop + Controls[i].Height > TControl(il.Items[j]).FOrigTop + TControl(il.Items[j]).Height then\r\n              ins := j;\r\n          end;\r\n        end;\r\n        il.Insert(ins, Controls[i]);\r\n      end;\r\n    end;\r\n\r\n    for i := 0 to il.Count - 1 do\r\n    begin\r\n      DoPosition(TControl(il.Items[i]), AAlign);\r\n    end;\r\n\r\n    il.Free;\r\n  end;\r\n\r\nbegin\r\n  DoAlign(alTop);\r\n  DoAlign(alBottom);\r\n  DoAlign(alLeft);\r\n  DoAlign(alRight);\r\n  DoAlign(alClient);\r\n  DoAlign(alCustom);\r\n\r\n  for j := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[j].AlignControl(Controls[j]);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.ApplyName;\r\nvar\r\n  s, prefix: String;\r\n  frm: TCustomForm;\r\nbegin\r\n  s := ClassName;\r\n  Delete(s, 1, 1);\r\n\r\n  prefix := '';\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n    prefix := frm.ClassName;\r\n\r\n  SetID(prefix+'_'+FindUniqueName(s));\r\nend;\r\n\r\nconstructor TControl.Create(ID: string);\r\nbegin\r\n  CreateWithID(ID);\r\nend;\r\n\r\nprocedure TControl.HookElement;\r\nvar\r\n  el: TJSElement;\r\n  i: integer;\r\nbegin\r\n  el := document.getElementByID(FID);\r\n  Container := el;\r\n  BindElement;\r\n  BindEvents;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].HookElement;\r\nend;\r\n\r\nfunction TControl.CanFocus: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.CanShowFocus: boolean;\r\nbegin\r\n  Result := FShowFocus;\r\nend;\r\n\r\nprocedure TControl.Capture;\r\nbegin\r\n  FCaptureDown := True;\r\n  window.setTimeout(@StartCapture, 100);\r\nend;\r\n\r\nprocedure TControl.StartCapture;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if not FCaptureDown then\r\n    Exit;\r\n\r\n  if Captured then\r\n    ReleaseCapture;\r\n\r\n  FMouseInsideLayer := true;\r\n\r\n  FLayer := document.createElement('SPAN');\r\n  document.body.appendChild(FLayer);\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.addEventListener('mouseenter', FLayerMouseEnterPtr);\r\n  eh.addEventListener('mouseleave', FLayerMouseLeavePtr);\r\n  eh.addEventListener('mousedown', FMouseDownPtr);\r\n  eh.addEventListener('mouseup', FMouseUpPtr);\r\n  eh.addEventListener('mousemove', FMouseMovePtr);\r\n  eh.addEventListener('touchstart', FTouchStartPtr);\r\n  eh.addEventListener('touchmove', FTouchMovePtr);\r\n  eh.addEventListener('touchend', FTouchEndPtr);\r\n  eh.addEventListener('touchcancel', FTouchCancelPtr);\r\n\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.setProperty('position', 'absolute');\r\n\r\n  eh.style.setProperty('z-index', '999999');\r\n\r\n  FCaptured := True;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TControl.Captured: Boolean;\r\nbegin\r\n  Result := FCaptured and Assigned(FLayer);\r\nend;\r\n\r\nprocedure TControl.ClearControls;\r\nbegin\r\n  SetLength(FControls, 0);\r\nend;\r\n\r\nprocedure TControl.Click;\r\nbegin\r\n  if Assigned(OnClick) and Enabled then\r\n    OnClick(Self);\r\nend;\r\n\r\nfunction TControl.ClientToScreen(const Point: TPoint): TPoint;\r\nvar\r\n  Origin: TPoint;\r\nbegin\r\n  Origin := ClientOrigin;\r\n  Result.X := Point.X + Origin.X;\r\n  Result.Y := Point.Y + Origin.Y;\r\nend;\r\n\r\nprocedure TControl.ColorChanging;\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.ContainerElement: TJSElement;\r\nbegin\r\n  Result := document.body;\r\nend;\r\n\r\nfunction TControl.RequiredBaseURL: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nprocedure TControl.RequiredScriptLoaded(Event: TJSEvent);\r\nbegin\r\n  (Event.Target as TJSHTMLScriptElement).Title := 'tmswebloaded';\r\n  inc(FControlScriptCountLoaded);\r\nend;\r\n\r\nconstructor TControl.Create(AOwner: TComponent);\r\nvar\r\n  s: string;\r\n  lPrefix, lName: string;\r\n  frm: TCustomForm;\r\n\r\nbegin\r\n  FTabStop := true;\r\n  FAllowTouch := true;\r\n  ClearMethodPointers;\r\n\r\n  inherited Create(AOwner);\r\n\r\n  FScriptLoaded := false;\r\n  FElementFont := efProperty;\r\n  FElementPosition := epAbsolute;\r\n  FParentElement := nil;\r\n  FTextDirection := tdDefault;\r\n\r\n  s := ClassName;\r\n  Delete(s, 1, 1);\r\n\r\n  lPrefix := '';\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n    lPrefix := frm.ClassName;\r\n\r\n  lName := lPrefix+'_'+FindUniqueName(s);\r\n\r\n  CreateWithID(lName);\r\n  if Assigned(AOwner) and not (csDesigning in AOwner.ComponentState) then\r\n    Name := lName;\r\n\r\n  EventStopPropagation := [eeClick, eeDblClick, eeMouseUp, eeMouseMove, eeMouseDown, eeKeypress, eeKeyDown, eeKeyUp];\r\nend;\r\n\r\nprocedure TControl.CreateControl;\r\nbegin\r\n  if not Assigned(FElement) then\r\n  begin\r\n    FElement := CreateElement;\r\n\r\n    if Assigned(FElement) then\r\n    begin\r\n      FControlCreated := True;\r\n      Container := FElement;\r\n      if not (ElementID = 'body') then\r\n        Container['id'] := ElementID;\r\n      Container['zindex'] := '0';\r\n      if FElementClassName <> '' then\r\n        Container['class'] := FElementClassName;\r\n\r\n      BindEvents;\r\n      UpdateElement;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nprocedure TControl.CreateInitialize;\r\nbegin\r\n  FRequiredScripts := TStringList.Create;\r\n  FOrigRect := Rect(-1,-1,-1,-1);\r\n  FClipChildren := True;\r\nend;\r\n\r\nprocedure TControl.CreateWithID(AID: string);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  ClearMethodPointers;\r\n\r\n  FUpdateCount := 0;\r\n\r\n  FControlCreated := False;\r\n  FLinkTouchEvents := True;\r\n  FIsResizing := false;\r\n\r\n  if (Assigned(Owner) and (csLoading in Owner.ComponentState)) or not Assigned(Owner) then\r\n    Loading;\r\n\r\n  FElementPosition := epAbsolute;\r\n  FWidthStyle := ssAbsolute;\r\n  FHeightStyle := ssAbsolute;\r\n\r\n  el := document.getElementByID(AID);\r\n\r\n  FNew := not Assigned(el);\r\n\r\n  // the HTML element is not found\r\n  if FNew then\r\n  begin\r\n    Container := nil;\r\n  end\r\n  else\r\n  begin\r\n    Container := el;\r\n    FControlCreated := true;\r\n    FElementPosition := epRelative;\r\n    BindElement;\r\n    BindEvents;\r\n  end;\r\n\r\n  FID := AID;\r\n  FFont := TFont.Create;\r\n  FFont.OnChange := HandleFontChanged;\r\n  FEnabled := True;\r\n  FVisible := True;\r\n  FLeft := 0;\r\n  FTop := 0;\r\n  FAlign := alNone;\r\n  FAlignWithMargins := false;\r\n  FIsAligning := false;\r\n  FParentFont := true;\r\n  FParentColor := false;\r\n  FAnchors := [akLeft, akTop];\r\n  FShowFocus := false;\r\n  FBorderWidth := 0;\r\n  FEnablePropagation := False;\r\n\r\n  FColor := clNone;\r\n\r\n  FMargins := TMargins.Create;\r\n  FMargins.OnChange := DoMarginsChanged;\r\n\r\n  FParent := nil;\r\n  FPrevParent := nil;\r\n\r\n  ClearControls;\r\n  CreateInitialize;\r\nend;\r\n\r\nprocedure TControl.BindElement;\r\nbegin\r\nend;\r\n\r\nprocedure TControl.AddControlLink(const linkid, link: string);\r\nbegin\r\n  asm\r\n    function writeLinkOnce(linkName, linkText) {\r\n        var linkElement = document.getElementById(linkName);\r\n        if (linkElement)\r\n          return;\r\n        linkElement = document.createElement('link');\r\n        linkElement.id = linkName;\r\n        linkElement.setAttribute('rel', 'stylesheet');\r\n        linkElement.setAttribute('type', 'text/css');\r\n        linkElement.setAttribute('href', linkText);\r\n        document.getElementsByTagName('head')[0].appendChild(linkElement);\r\n    }\r\n    writeLinkOnce(linkid,link);\r\n  end;\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure TControl.AddControlScriptLink(const link: string);\r\nvar\r\n  id: string;\r\n  script: TJSHTMLScriptElement;\r\n\r\nbegin\r\n  id := ClassName;\r\n\r\n  if not Assigned(document.getElementById(id)) then\r\n  begin\r\n    script := TJSHTMLScriptElement(document.createElement('script'));\r\n    script.id := id;\r\n    script.src := link;\r\n    script.type_ := 'text/javascript';\r\n    document.head.appendChild(script);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.AddControlScriptSource(const source: string);\r\nvar\r\n  id: string;\r\n  script: TJSHTMLScriptElement;\r\n\r\nbegin\r\n  id := ClassName;\r\n\r\n  if not Assigned(document.getElementById(id)) then\r\n  begin\r\n    script := TJSHTMLScriptElement(document.createElement('script'));\r\n    script.id := id;\r\n    script.innerHTML := source;\r\n    script.type_ := 'text/javascript';\r\n    document.head.appendChild(script);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TControl.AddControlStyle(const css: string);\r\nvar\r\n  cssname: string;\r\nbegin\r\n  cssname := ClassName;\r\n\r\n  asm\r\n    function writeStylesOnce(styleName, cssText) {\r\n        var styleElement = document.getElementById(styleName);\r\n        if (styleElement) {\r\n             styleElement.innerHTML = cssText;\r\n          return;\r\n          }\r\n        styleElement = document.createElement('style');\r\n        styleElement.type = 'text/css';\r\n        styleElement.id = styleName;\r\n        styleElement.innerHTML = cssText;\r\n        document.getElementsByTagName('head')[0].appendChild(styleElement);\r\n    }\r\n    writeStylesOnce(cssname,css);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.AddInstanceStyle(const css: string);\r\nvar\r\n  cssname: string;\r\nbegin\r\n  cssname := Name + '_style';\r\n\r\n  asm\r\n    function writeStylesOnce(styleName, cssText) {\r\n        var styleElement = document.getElementById(styleName);\r\n        if (styleElement) {\r\n          styleElement.innerHTML = cssText;\r\n          return;\r\n          }\r\n        styleElement = document.createElement('style');\r\n        styleElement.type = 'text/css';\r\n        styleElement.id = styleName;\r\n        styleElement.innerHTML = cssText;\r\n        document.getElementsByTagName('head')[0].appendChild(styleElement);\r\n    }\r\n    writeStylesOnce(cssname,css);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.AddRequiredScript(const link: string);\r\nvar\r\n  id: string;\r\n  script: TJSHTMLScriptElement;\r\n\r\nbegin\r\n  script := TJSHTMLScriptElement(document.createElement('script'));\r\n  script.src := link;\r\n  script.type_ := 'text/javascript';\r\n  script.title := 'tmswebloading';\r\n\r\n  if not Assigned(FScriptLoadedPtr) then\r\n    FScriptLoadedPtr := @RequiredScriptLoaded;\r\n\r\n  script.addEventListener('load', FScriptLoadedPtr);\r\n  document.head.appendChild(script);\r\nend;\r\n\r\nfunction TControl.AddRequiredScripts: boolean;\r\nvar\r\n  i,j: integer;\r\n  el: TJSElement;\r\n  scr: TJSHTMLScriptElement;\r\n  found, loading: boolean;\r\nbegin\r\n  FControlScriptCount := 0;\r\n\r\n  for j := 0 to RequiredScripts.Count - 1 do\r\n  begin\r\n    found := false;\r\n    loading := false;\r\n\r\n    for i := 0 to document.head.children.length - 1 do\r\n    begin\r\n      el := TJSElement(document.head.children[i]);\r\n      if (el.tagName = 'SCRIPT') then\r\n      begin\r\n        scr := TJSHTMLScriptElement(el);\r\n        if (pos(RequiredScripts[j], scr.src) > 0) then\r\n        begin\r\n          found := true;\r\n\r\n          if scr.title = 'tmswebloading' then\r\n          begin\r\n            loading := true;\r\n            if not Assigned(FScriptLoadedPtr) then\r\n              FScriptLoadedPtr := @RequiredScriptLoaded;\r\n            scr.addEventListener('load', FScriptLoadedPtr);\r\n          end;\r\n\r\n          break;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if not found then\r\n    begin\r\n      inc(FControlScriptCount);\r\n      AddRequiredScript( RequiredBaseURL + RequiredScripts[j]);\r\n    end;\r\n\r\n    if found and loading then\r\n      inc(FControlScriptCount);\r\n  end;\r\n\r\n  Result := (FControlScriptCount > 0);\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TControl.AlignControl(AControl: TControl);\r\nvar\r\n  r: TRect;\r\n  cr: TJSDOMRect;\r\n  ovf, ovfx, ovfy: string;\r\n  eh: TJSHTMLElement;\r\n  el: TJSElement;\r\n  frm: TCustomForm;\r\n  ctop: integer;\r\n  vscrl: integer;\r\n\r\nbegin\r\n  if FIsAligning then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  frm := GetParentForm(Self);\r\n\r\n  if Assigned(frm) and frm.IsUpdating then\r\n    Exit;\r\n\r\n  ctop := 0;\r\n\r\n  if Assigned(frm) and (frm.FormContainer <> '') and (AControl is TCustomForm) then\r\n  begin\r\n    el := document.getElementById(frm.FormContainer);\r\n    if Assigned(el) then\r\n    begin\r\n      cr := el.getBoundingClientRect;\r\n      ctop := Round(cr.Top);\r\n    end;\r\n  end;\r\n\r\n  FIsAligning := true;\r\n\r\n  if not Assigned(AControl) then\r\n    Exit;\r\n\r\n  eh := AControl.ElementHandle;\r\n\r\n  if Assigned(eh) then\r\n  begin\r\n    ovf := eh.style.getPropertyValue('overflow');\r\n    ovfx := eh.style.getPropertyValue('overflow-x');\r\n    ovfy := eh.style.getPropertyValue('overflow-y');\r\n    if ClipChildren then\r\n      eh.style.setProperty('overflow', 'hidden')\r\n    else\r\n      eh.style.setProperty('overflow', '');\r\n  end;\r\n\r\n  r := GetClientRect;\r\n\r\n  if r.Bottom + ctop > window.innerHeight then\r\n    r.Bottom := window.innerHeight - ctop;\r\n\r\n  if Assigned(eh) and (eh.tagName = 'BODY') then\r\n  begin\r\n    vscrl := 0;\r\n\r\n    if (document.body.scrollHeight > document.body.clientHeight) then\r\n      vscrl := 16;\r\n\r\n    if frm.FormContainer <> '' then\r\n    begin\r\n      r.Bottom := Round(Min(r.Bottom - 2, window.innerHeight - 2));\r\n      r.Right := Round(Min(r.Right - 2 - vscrl, window.innerWidth - 2));\r\n    end\r\n    else\r\n    begin\r\n      r.Bottom := frm.Height;\r\n      r.Right := frm.Width;\r\n    end;\r\n  end;\r\n\r\n  // limit size to browser window size anyway\r\n  if AControl is TCustomForm then\r\n  begin\r\n    if r.Bottom > window.outerHeight then\r\n      r.Bottom := window.outerHeight;\r\n\r\n    if r.Right > window.outerWidth then\r\n      r.Right := window.outerWidth;\r\n  end;\r\n\r\n  if AControl.IsStructuralElement then\r\n    r := Parent.GetClientRect;\r\n\r\n  AlignControls(AControl, r);\r\n\r\n  if Assigned(eh) then\r\n  begin\r\n    eh.style.setProperty('overflow', ovf);\r\n    eh.style.setProperty('overflow-x', ovfx);\r\n    eh.style.setProperty('overflow-y', ovfy);\r\n  end;\r\n\r\n  FIsAligning := false;\r\nend;\r\n\r\nprocedure TControl.DblClick;\r\nbegin\r\n  if Assigned(OnDblClick) then\r\n    OnDblClick(Self);\r\nend;\r\n\r\ndestructor TControl.Destroy;\r\nvar\r\n  i: integer;\r\n  ctrl: TControl;\r\nbegin\r\n  UnbindEvents;\r\n\r\n  for i := ControlCount - 1 downto 0 do\r\n  begin\r\n    ctrl := Controls[i];\r\n    ctrl.Free;\r\n  end;\r\n\r\n  if Assigned(Container) and Assigned(Parent) and Assigned(Parent.GetChildContainer) then\r\n  begin\r\n    if Parent.GetChildContainer = Container.parentNode then\r\n    begin\r\n      Parent.GetChildContainer.removeChild(Container);\r\n    end;\r\n\r\n    Container := nil;\r\n    Parent := nil;\r\n    FControlCreated := False;\r\n  end;\r\n\r\n  FRequiredScripts.Free;\r\n  FMargins.Free;\r\n  FFont.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TControl.DisableTab;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if TabStop and CanFocus and Assigned(Container) then\r\n    Container.setAttribute('tabindex','-1');\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[i].DisableTab;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.DisposeOf;\r\nvar\r\n  t: TControl;\r\nbegin\r\n  t := Self;\r\n  t.Free;\r\nend;\r\n\r\nprocedure TControl.Assign(Source: TPersistent);\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.GetElement: TJSElement;\r\nbegin\r\n  Result := document.getElementByID(GetID);\r\nend;\r\n\r\nfunction TControl.GetElementBindHandle: TJSEventTarget;\r\nbegin\r\n  Result := TJSEventTarget(GetElementHandle);\r\nend;\r\n\r\nfunction TControl.GetElementEvent: TJSEvent;\r\nbegin\r\n  Result := FElementEvent;\r\nend;\r\n\r\nprocedure TControl.SetEnabled(Value: Boolean);\r\nbegin\r\n  if (FEnabled <> Value) then\r\n  begin\r\n    FEnabled := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetVisible(AValue: Boolean);\r\nbegin\r\n  if (FVisible <> AValue) then\r\n  begin\r\n    VisibleChanging;\r\n    FVisible := AValue;\r\n    UpdateElement;\r\n    DoRealign;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetWidth(AValue: Integer);\r\nbegin\r\n  if (FWidth <> AValue) then\r\n  begin\r\n    FWidth := AValue;\r\n\r\n    ResetAnchoring;\r\n\r\n    DoBoundsChange;\r\n\r\n    // still do element height updating at runtime\r\n    if IsLinked and not IsUpdating and Assigned(ElementHandle) then\r\n    begin\r\n      if AValue >= 0 then\r\n        ElementHandle.style.setProperty('height',IntTostr(AValue))\r\n      else\r\n        ElementHandle.style.removeProperty('height');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetWidthPercent(const Value: TPercentSize);\r\nbegin\r\n  if (FWidthPercent <> Value) then\r\n  begin\r\n    FWidthPercent := Value;\r\n    UpdateElementSize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetWidthStyle(const Value: TSizeStyle);\r\nbegin\r\n  if (FWidthStyle <> Value) then\r\n  begin\r\n    FWidthStyle := Value;\r\n    UpdateElementSize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.StopPropagation;\r\nbegin\r\n  if Assigned(ElementEvent) and not EnablePropagation then\r\n    ElementEvent.stopPropagation;\r\nend;\r\n\r\nprocedure TControl.TouchCancel(X, Y: Integer);\r\nbegin\r\n  if Assigned(OnTouchCancel) then\r\n    OnTouchCancel(Self, X, Y);\r\nend;\r\n\r\nprocedure TControl.TouchEnd(X, Y: Integer);\r\nbegin\r\n  if Assigned(OnTouchEnd) then\r\n    OnTouchEnd(Self, X, Y);\r\nend;\r\n\r\nprocedure TControl.TouchMove(X, Y: Integer);\r\nbegin\r\n  if Assigned(OnTouchMove) then\r\n    OnTouchMove(Self, X, Y);\r\nend;\r\n\r\nprocedure TControl.TouchStart(X, Y: Integer);\r\nbegin\r\n  if Assigned(OnTouchStart) then\r\n    OnTouchStart(Self, X, Y);\r\nend;\r\n\r\nprocedure TControl.SetHeight(AValue: Integer);\r\nvar\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if FHeight <> AValue then\r\n  begin\r\n    if (Align in [alLeft, alRight, alClient]) and Assigned(ElementHandle) then\r\n    begin\r\n      dr := ElementHandle.getBoundingClientRect;\r\n      if dr.top + AValue >= window.innerHeight then\r\n      begin\r\n        AValue := Round(window.innerHeight - dr.top);\r\n      end;\r\n    end;\r\n\r\n    FHeight := AValue;\r\n\r\n    ResetAnchoring;\r\n\r\n    DoBoundsChange;\r\n\r\n    // still do element height updating at runtime\r\n    if IsLinked and not IsUpdating and Assigned(ElementHandle) then\r\n    begin\r\n      if AValue >= 0 then\r\n        ElementHandle.style.setProperty('height',IntTostr(AValue))\r\n      else\r\n        ElementHandle.style.removeProperty('height');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHeightPercent(const Value: TPercentSize);\r\nbegin\r\n  if (FHeightPercent <> Value) then\r\n  begin\r\n    FHeightPercent := Value;\r\n    UpdateElementSize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHeightStyle(const Value: TSizeStyle);\r\nbegin\r\n  if (FHeightStyle <> Value) then\r\n  begin\r\n    FHeightStyle := Value;\r\n    UpdateElementSize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetLeft(AValue: Integer);\r\nbegin\r\n  if FLeft <> AValue then\r\n  begin\r\n    FLeft := AValue;\r\n\r\n    ResetAnchoring;\r\n\r\n    if not FUpdateTopLeft then\r\n      FOrigLeft := AValue;\r\n\r\n    UpdateElementSize;\r\n    RecreateCanvas;\r\n    InternalResize;\r\n\r\n    if not (csLoading in ComponentState) and (Align <> alNone) and Assigned(Parent) then\r\n    begin\r\n      DoRealign;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetMargins(const Value: TMargins);\r\nbegin\r\n  FMargins.Assign(Value);\r\nend;\r\n\r\nprocedure TControl.SetTop(AValue: Integer);\r\nbegin\r\n  if FTop <> AValue then\r\n  begin\r\n    FTop := AValue;\r\n\r\n    ResetAnchoring;\r\n\r\n    if not FUpdateTopLeft then\r\n      FOrigTop := AValue;\r\n    UpdateElementSize;\r\n    RecreateCanvas;\r\n    InternalResize;\r\n\r\n    if not (csLoading in ComponentState) and (Align <> alNone) and Assigned(Parent) then\r\n    begin\r\n      DoRealign;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetScriptLoaded(const Value: boolean);\r\nbegin\r\n  FScriptLoaded := Value;\r\nend;\r\n\r\nprocedure TControl.SetShowFocus(const Value: boolean);\r\nbegin\r\n  if (FShowFocus <> Value) then\r\n  begin\r\n    FShowFocus := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetShowHint(AValue: Boolean);\r\nbegin\r\n  if FShowHint <> AValue then\r\n  begin\r\n    FShowHint := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHint(AValue: string);\r\nbegin\r\n  if FHint <> AValue then\r\n  begin\r\n    FHint := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetID(const Value: string);\r\nvar\r\n  eh: TJSElement;\r\nbegin\r\n  if FNew and (FID <> Value) then\r\n  begin\r\n    eh := document.getElementById(Value);\r\n    if Assigned(eh) then\r\n    begin\r\n      UnbindEvents;\r\n      if Assigned(FContainer) then\r\n        FContainer.parentElement.RemoveChild(FContainer);\r\n\r\n      CreateWithID(Value);\r\n\r\n      FID := Value;\r\n      Exit;\r\n    end;\r\n  end;\r\n\r\n  FID := Value;\r\n  if Assigned(FContainer) then\r\n    FContainer['id'] := Value;  \r\nend;\r\n\r\nprocedure TControl.SetTabOrder(AValue: Integer);\r\nbegin\r\n  if FTabOrder <> AValue then\r\n  begin\r\n    FTabOrder := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetTabStop(AValue: Boolean);\r\nbegin\r\n  if FTabStop <> AValue then\r\n  begin\r\n    FTabStop := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nfunction TControl.ScreenToClient(const Point: TPoint): TPoint;\r\nvar\r\n  Origin: TPoint;\r\nbegin\r\n  Origin := ClientOrigin;\r\n  Result.X := Point.X - Origin.X;\r\n  Result.Y := Point.Y - Origin.Y;\r\nend;\r\n\r\nprocedure TControl.SendToBack;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if ((ElementPosition <> epAbsolute) or IsLinked) and Assigned(ElementHandle.parentElement) then\r\n    begin\r\n      ElementHandle.parentElement.insertBefore(ElementHandle, ElementHandle.parentElement.firstElementChild);\r\n    end\r\n    else\r\n      ElementHandle.style.setProperty('z-index', '0');\r\n  end\r\nend;\r\n\r\nprocedure TControl.BeginUpdate;\r\nbegin\r\n  inc(FUpdateCount);\r\nend;\r\n\r\nprocedure TControl.Invalidate;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.EnableTab;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if Assigned(FContainer) then\r\n  begin\r\n    if TabStop and CanFocus then\r\n    begin\r\n      FContainer['tabindex'] := IntToStr(TabOrder + 1)\r\n    end\r\n    else\r\n    begin\r\n      FContainer.removeAttribute('tabindex');\r\n    end;\r\n  end;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[i].EnableTab;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.EndUpdate;\r\nbegin\r\n  if (FUpdateCount > 0) then\r\n  begin\r\n    dec(FUpdateCount);\r\n\r\n    if FUpdateCount = 0 then\r\n      UpdateElement;\r\n  end;\r\nend;\r\n\r\nfunction TControl.EventsBound: boolean;\r\nbegin\r\n  Result := Assigned(FWheelPtr);\r\nend;\r\n\r\nfunction TControl.IsUpdating: boolean;\r\nbegin\r\n  Result := FUpdateCount > 0;\r\nend;\r\n\r\nprocedure TControl.SetAlign(const Value: TAlign);\r\nbegin\r\n  if FAlign <> Value then\r\n  begin\r\n    FAlign := Value;\r\n    DoRealign;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetAlignWithMargins(const Value: boolean);\r\nbegin\r\n  if FAlignWithMargins <> Value then\r\n  begin\r\n    FAlignWithMargins := Value;\r\n    DoRealign;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.DoMarginsChanged(Sender: TObject);\r\nbegin\r\n  DoRealign;\r\nend;\r\n\r\nprocedure TControl.DoRealign;\r\nbegin\r\n  if Assigned(Parent) and not Parent.IsUpdating then\r\n  begin\r\n    Parent.AlignControl(Parent);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetAnchors(const Value: TAnchors);\r\nbegin\r\n  if (FAnchors <> Value) then\r\n  begin\r\n    FAnchors := Value;\r\n    if not (csLoading in ComponentState) then\r\n      UpdateAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBorderWidth(const Value: integer);\r\nbegin\r\n  if (FBorderWidth <> Value) then\r\n  begin\r\n    FBorderWidth := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBoundsInt(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  if (X <> Left) or (Y <> Top) or (AWidth <> Width) or (AHeight <> Height) then\r\n  begin\r\n    FBlockUpdateElement := True;\r\n    FLeft := X;\r\n    FTop := Y;\r\n    FWidth := AWidth;\r\n    FHeight := AHeight;\r\n    FBlockUpdateElement := False;\r\n    UpdateElementSize;\r\n    if Align <> alNone then\r\n      DoRealign\r\n    else\r\n      Realign;\r\n\r\n    RecreateCanvas;\r\n    //InternalResize;\r\n    DoBoundsChange;\r\n    Invalidate;\r\n    UpdateChildAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBounds(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  SetBoundsInt(X, Y, AWidth, AHeight);\r\n  FWidth := AWidth;\r\n  FHeight := AHeight;\r\n  ResetAnchoring;\r\nend;\r\n\r\nprocedure TControl.SetBoundsRect(const Value: TRect);\r\nbegin\r\n  SetBoundsInt(Value.Left, Value.Top, Value.Right - Value.Left, Value.Bottom - Value.Top);\r\nend;\r\n\r\nprocedure TControl.SetElementClassName(AValue: string);\r\nbegin\r\n  if (FElementClassName <> AValue) then\r\n  begin\r\n    FElementClassName := AValue;\r\n    if Assigned(FContainer) then\r\n      FContainer['class'] := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetElementFont(const Value: TElementFont);\r\nbegin\r\n  if (FElementFont <> Value) then\r\n  begin\r\n    FElementFont := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetElementPointer(AElement: TJSHTMLElement;\r\n  ACursor: TCursor);\r\nbegin\r\n  case ACursor of\r\n    crDefault: AElement.style.setProperty('cursor', 'default');\r\n    crArrow: AElement.style.setProperty('cursor', 'auto');\r\n    crNone: AElement.style.setProperty('cursor', 'none');\r\n    crCross: AElement.style.setProperty('cursor', 'crosshair');\r\n    crIBeam: AElement.style.setProperty('cursor', 'text');\r\n    crSizeNESW: AElement.style.setProperty('cursor', 'nesw-resize');\r\n    crSizeNS: AElement.style.setProperty('cursor', 'ns-resize');\r\n    crSizeNWSE: AElement.style.setProperty('cursor', 'nwse-resize');\r\n    crSizeWE: AElement.style.setProperty('cursor', 'ew-resize');\r\n    crUpArrow: AElement.style.setProperty('cursor', '');\r\n    crHourGlass: AElement.style.setProperty('cursor', 'wait');\r\n    crDrag: AElement.style.setProperty('cursor', '');\r\n    crNoDrop: AElement.style.setProperty('cursor', 'no-drop');\r\n    crHSplit: AElement.style.setProperty('cursor', 'col-resize');\r\n    crVSplit: AElement.style.setProperty('cursor', 'row-resize');\r\n    crMultIDrag: AElement.style.setProperty('cursor', '');\r\n    crSQLWait: AElement.style.setProperty('cursor', 'progress');\r\n    crNo: AElement.style.setProperty('cursor', 'not-allowed');\r\n    crAppStart: AElement.style.setProperty('cursor', 'wait');\r\n    crHelp: AElement.style.setProperty('cursor', 'help');\r\n    crHandPoint: AElement.style.setProperty('cursor', 'pointer');\r\n    crSizeAll: AElement.style.setProperty('cursor', 'move');\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TControl.SetElementPosition(const Value: TElementPosition);\r\nbegin\r\n  if (FElementPosition <> Value) then\r\n  begin\r\n    FElementPosition := Value;\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      UpdateElementSize;\r\n      RecreateCanvas;\r\n      InternalResize;\r\n    end;\r\n  end;\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure TControl.SetFocus;\r\nvar\r\n  e: TJSHTMLElement;\r\nbegin\r\n  if not CanFocus then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    e := ElementHandle;\r\n    asm\r\n      setTimeout(function() {e.focus();}, 1);\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TControl.SetFont(AValue: TFont);\r\nbegin\r\n  FFont.Name := AValue.Name;\r\n  FFont.Size := AValue.Size;\r\n  FFont.Style := AValue.Style;\r\n  FFont.Color := AValue.Color;\r\nend;\r\n\r\nprocedure TControl.SetChildOrderEx(const Value: integer);\r\nbegin\r\n  FChildOrder := Value;\r\nend;\r\n\r\nprocedure TControl.SetClientHeight(const Value: Integer);\r\nbegin\r\n  Height := Value;\r\nend;\r\n\r\nprocedure TControl.SetClientWidth(const Value: Integer);\r\nbegin\r\n  Width := Value;\r\nend;\r\n\r\nprocedure TControl.SetClipChildren(const Value: Boolean);\r\nbegin\r\n  FClipChildren := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TControl.SetColor(AValue: TColor);\r\nbegin\r\n  FColor := AValue;\r\n  UpdateElement;\r\n  ColorChanging;\r\nend;\r\n\r\nprocedure TControl.SetCursor(const Value: TCursor);\r\nbegin\r\n  FCursor := Value;\r\n\r\n  if (ElementClassName = '') and Assigned(ElementHandle) then\r\n  begin\r\n    SetElementPointer(ElementHandle, Value);\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetID: string;\r\nbegin\r\n  Result := FID;\r\nend;\r\n\r\nfunction TControl.GetIsLinked: boolean;\r\nbegin\r\n  Result := not FNew;\r\nend;\r\n\r\nfunction TControl.GetElementHandle: TJSHTMLElement;\r\nbegin\r\n  Result := nil;\r\n  if Assigned(FContainer) and FControlCreated then\r\n    Result := TJSHTMLElement(FContainer);\r\nend;\r\n\r\nfunction TControl.GetMouseEventButton(Event: TJSMouseEvent): TMouseButton;\r\nbegin\r\n  Result := mbLeft;\r\n  case Event.button of\r\n    0: Result := mbLeft;\r\n    1: Result := mbMiddle;\r\n    2: Result := mbRight;\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetMouseEventShiftState(Event: TJSMouseEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\n\r\n  if Event.buttons and 1 = 1 then\r\n     Result := Result + [ssLeft];\r\n\r\n  if Event.buttons and 2 = 2 then\r\n     Result := Result + [ssRight];\r\n\r\n  if Event.buttons and 4 = 4 then\r\n     Result := Result + [ssMiddle];\r\nend;\r\n\r\nfunction TControl.GetMouseWheelEventShiftState(\r\n  Event: TJSWheelEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nfunction TControl.GetOuterHeight: integer;\r\nbegin\r\n  Result := FHeight - FBorderWidth;\r\nend;\r\n\r\nfunction TControl.GetOuterWidth: integer;\r\nbegin\r\n  Result := FWidth - FBorderWidth;\r\nend;\r\n\r\nfunction TControl.GetRole: string;\r\nbegin\r\n  Result := FRole;\r\n  if Assigned(ElementHandle) then\r\n    Result := ElementHandle.getAttribute('role');\r\nend;\r\n\r\nfunction TControl.GetKeyboardEventShiftState(Event: TJSKeyboardEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nprocedure TControl.ClearMethodPointers;\r\nbegin\r\n  FWheelPtr := nil;\r\n  FClickPtr := nil;\r\n  FDblClickPtr := nil;\r\n  FMouseDownPtr := nil;\r\n  FMouseUpPtr := nil;\r\n  FMouseMovePtr := nil;\r\n  FMouseLeavePtr := nil;\r\n  FMouseEnterPtr := nil;\r\n  FKeyDownPtr := nil;\r\n  FKeyUpPtr := nil;\r\n  FKeypressPtr := nil;\r\n  FInputPtr := nil;\r\n  FEnterPtr := nil;\r\n  FExitPtr := nil;\r\n  FTouchStartPtr := nil;\r\n  FTouchEndPtr := nil;\r\n  FTouchMovePtr := nil;\r\n  FTouchCancelPtr := nil;\r\n  FLayerMouseLeavePtr := nil;\r\n  FLayerMouseEnterPtr := nil;\r\n  FScriptLoadedPtr := nil;\r\nend;\r\n\r\nprocedure TControl.GetMethodPointers;\r\nbegin\r\n  if FWheelPtr = nil then\r\n  begin\r\n    FWheelPtr := @HandleDoWheel;\r\n    FClickPtr := @HandleDoClick;\r\n    FDblClickPtr := @HandleDoDblClick;\r\n    FMouseDownPtr := @HandleDoMouseDown;\r\n    FMouseUpPtr := @HandleDoMouseUp;\r\n    FMouseMovePtr := @HandleDoMouseMove;\r\n    FMouseLeavePtr := @HandleDoMouseLeave;\r\n    FMouseEnterPtr := @HandleDoMouseEnter;\r\n    FKeyDownPtr := @HandleDoKeyDown;\r\n    FKeyUpPtr := @HandleDoKeyUp;\r\n    FKeypressPtr := @HandleDoKeyPress;\r\n    FInputPtr := @HandleDoInput;\r\n    FEnterPtr := @HandleDoEnter;\r\n    FExitPtr := @HandleDoExit;\r\n    FTouchStartPtr := @HandleDoTouchStart;\r\n    FTouchEndPtr := @HandleDoTouchEnd;\r\n    FTouchMovePtr := @HandleDoTouchMove;\r\n    FTouchCancelPtr := @HandleDoTouchCancel;\r\n    FLayerMouseLeavePtr := @LayerHandleDoMouseLeave;\r\n    FLayerMouseEnterPtr := @LayerHandleDoMouseEnter;\r\n    FScriptLoadedPtr := @RequiredScriptLoaded;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.BindEvents;\r\nvar\r\n  eh: TJSEventTarget;\r\nbegin\r\n  if Assigned(ElementBindHandle) then\r\n  begin\r\n    GetMethodPointers;\r\n    eh := ElementBindHandle;\r\n    eh.addEventListener('wheel', FWheelPtr);\r\n    eh.addEventListener('click', FClickPtr);\r\n    eh.addEventListener('dblclick', FDblClickPtr);\r\n    eh.addEventListener('mousedown', FMouseDownPtr);\r\n    eh.addEventListener('mouseup', FMouseUpPtr);\r\n    eh.addEventListener('mousemove', FMouseMovePtr);\r\n    eh.addEventListener('mouseleave', FMouseLeavePtr);\r\n    eh.addEventListener('mouseenter', FMouseEnterPtr);\r\n    eh.addEventListener('keydown', FKeyDownPtr);\r\n    eh.addEventListener('keyup', FKeyUpPtr);\r\n    eh.addEventListener('keypress', FKeyPressPtr);\r\n    eh.addEventListener('input', FInputPtr);\r\n    eh.addEventListener('focus', FEnterPtr);\r\n    eh.addEventListener('blur', FExitPtr);\r\n\r\n    eh.addEventListener('touchstart', FTouchStartPtr);\r\n    eh.addEventListener('touchmove', FTouchMovePtr);\r\n    eh.addEventListener('touchend', FTouchEndPtr);\r\n    eh.addEventListener('touchcancel', FTouchCancelPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.BringToFront;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if ((ElementPosition <> epAbsolute) or IsLinked) and Assigned(ElementHandle.parentElement) then\r\n    begin\r\n      ElementHandle.parentElement.appendChild(ElementHandle);\r\n    end\r\n    else\r\n      ElementHandle.style.setProperty('z-index', '999998');\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetChildContainer: TJSElement;\r\nbegin\r\n  Result := FContainer;\r\nend;\r\n\r\nprocedure TControl.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n    Proc(Controls[i]);\r\nend;\r\n\r\nfunction TControl.GetClientHeight: Integer;\r\nbegin\r\n  Result := Height;\r\nend;\r\n\r\nfunction TControl.GetClientOrigin: TPoint;\r\nvar\r\n  r: TJSDomRect;\r\nbegin\r\n  Result := Point(0, 0);\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    r := ElementHandle.getBoundingClientRect;\r\n    Result := Point(Round(r.Left), Round(r.Top));\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetClientRect: TRect;\r\nbegin\r\n  Result := Rect(0, 0, GetWidth, GetHeight);\r\nend;\r\n\r\nfunction TControl.GetClientWidth: Integer;\r\nbegin\r\n  Result := Width;\r\nend;\r\n\r\nfunction TControl.GetKeyCode(AValue: string; IgnoreCase: boolean = true): Integer;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  i := -1;\r\n\r\n  case AValue of\r\n    'Up': i := 38;\r\n    'Down': i := 40;\r\n    'Left': i := 37;\r\n    'Right': i := 39;\r\n    TJSKeyNames.BackSpace: i := 8;\r\n    TJSKeyNames.Tab: i := 9;\r\n    TJSKeyNames.Enter: i := 13;\r\n    TJSKeyNames.Shift: i := 16;\r\n    TJSKeyNames.Control: i := 17;\r\n    TJSKeyNames.Alt: i := 18;\r\n    TJSKeyNames.Pause: i := 19;\r\n    TJSKeyNames.CapsLock: i := 20;\r\n    TJSKeyNames.Escape: i := 27;\r\n    TJSKeyNames.PageUp: i := 33;\r\n    TJSKeyNames.PageDown: i := 34;\r\n    TJSKeyNames._End: i := 35;\r\n    TJSKeyNames.Home: i := 36;\r\n    TJSKeyNames.ArrowLeft: i := 37;\r\n    TJSKeyNames.ArrowUp: i := 38;\r\n    TJSKeyNames.ArrowRight: i := 39;\r\n    TJSKeyNames.ArrowDown: i := 40;\r\n    TJSKeyNames.Insert: i := 45;\r\n    TJSKeyNames.Delete: i := 46;\r\n\r\n    TJSKeyNames.F1: i := 112;\r\n    TJSKeyNames.F2: i := 113;\r\n    TJSKeyNames.F3: i := 114;\r\n    TJSKeyNames.F4: i := 115;\r\n    TJSKeyNames.F5: i := 116;\r\n    TJSKeyNames.F6: i := 117;\r\n    TJSKeyNames.F7: i := 118;\r\n    TJSKeyNames.F8: i := 119;\r\n    TJSKeyNames.F9: i := 120;\r\n    TJSKeyNames.F10: i := 121;\r\n    TJSKeyNames.F11: i := 122;\r\n    TJSKeyNames.F12: i := 123;\r\n    TJSKeyNames.F13: i := 124;\r\n    TJSKeyNames.F14: i := 125;\r\n    TJSKeyNames.F15: i := 126;\r\n    TJSKeyNames.F16: i := 127;\r\n    TJSKeyNames.F17: i := 128;\r\n    TJSKeyNames.F18: i := 129;\r\n    TJSKeyNames.F19: i := 130;\r\n    TJSKeyNames.F20: i := 131;\r\n    else\r\n    begin\r\n      if Assigned(AValue) and (Length(AValue) > 0) then\r\n      begin\r\n        i := Ord(AValue[1]);\r\n        if IgnoreCase and (i >= 97) and (i <= 122)  then\r\n          i := i and $DF;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Result := i;\r\nend;\r\n\r\nfunction TControl.GetLeft: Integer;\r\nbegin\r\n  Result := FLeft;\r\n  if (Result = -1) and Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n    Result := Round(ElementHandle.offsetLeft);\r\nend;\r\n\r\nfunction TControl.GetTop: Integer;\r\nbegin\r\n  Result := FTop;\r\n  if (Result = -1) and Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n    Result := Round(ElementHandle.offsetTop);\r\nend;\r\n\r\nfunction TControl.GetTouchEventShiftState(Event: TJSTouchEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nfunction TControl.GetWebClassName: string;\r\nbegin\r\n  Result := ClassName;\r\n  Delete(Result, 1, 1);\r\n  Result := 'TWeb' + Result;\r\nend;\r\n\r\nfunction TControl.GetWidth: Integer;\r\nvar\r\n  cr: TJSDOMRect;\r\nbegin\r\n  Result := FWidth;\r\n\r\n  if Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n  begin\r\n    if (Result = -1) then\r\n    begin\r\n      Result := Round(ElementHandle.offsetWidth);\r\n    end;\r\n\r\n    if (WidthStyle <> ssAbsolute) then\r\n    begin\r\n      cr := ElementHandle.getBoundingClientRect;\r\n      Result := Round(cr.Right - cr.Left);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetHeight: Integer;\r\nvar\r\n  cr: TJSDOMRect;\r\nbegin\r\n  Result := FHeight;\r\n\r\n  if Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n  begin\r\n    if (Result = -1) then\r\n    begin\r\n      Result := Round(ElementHandle.offsetHeight);\r\n    end;\r\n\r\n    if (HeightStyle <> ssAbsolute) then\r\n    begin\r\n      cr := ElementHandle.getBoundingClientRect;\r\n      Result := Round(cr.Bottom - cr.Top);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.KeyDown(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  if Assigned(OnKeyDown) then\r\n    OnKeyDown(Self, Key, Shift);\r\nend;\r\n\r\nprocedure TControl.KeyPress(var Key: Char);\r\nbegin\r\n  if Assigned(OnKeyPress) then\r\n    OnKeyPress(Self, Key);\r\nend;\r\n\r\nprocedure TControl.KeyUp(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  if Assigned(OnKeyUp) then\r\n    OnKeyUp(Self, Key, Shift);\r\nend;\r\n\r\nfunction TControl.LayerHandleDoMouseEnter(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if (Event.buttons = 0) and Captured and not FMouseInsideLayer then\r\n  begin\r\n    ReleaseCapture;\r\n    HandleDoMouseUp(Event);\r\n    HandleDoMouseLeave(Event);\r\n  end;\r\n  FMouseInsideLayer := True;\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.LayerHandleDoMouseLeave(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FMouseInsideLayer := False;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TControl.Loaded;\r\nvar\r\n  i: integer;\r\nbegin\r\n  inherited;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    // handle relative child positions\r\n    if (Controls[i].ElementPosition in [epRelative, epIgnore]) and not (Controls[i].IsLinked) and (Controls[i].ChildOrder >= 0) then\r\n    begin\r\n      if (Controls[i].ChildOrder < ChildContainer.childNodes.Length) then\r\n      begin\r\n        ChildContainer.insertBefore(Controls[i].Container, ChildContainer.childNodes[Controls[i].ChildOrder]);\r\n      end;\r\n    end;\r\n\r\n    Controls[i].Loaded;\r\n  end;\r\n\r\n  case Align of\r\n    alClient:\r\n    begin\r\n      if Assigned(Parent) then\r\n        SetBoundsInt(0, 0, Parent.FWidth, Parent.FHeight);\r\n    end;\r\n  end;\r\n\r\n  Resize;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TControl.HandleAllocated: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeClick in EventStopPropagation) then\r\n    StopPropagation;\r\n  Click;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoDblClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeDblClick in EventStopPropagation) then\r\n    StopPropagation;\r\n  DblClick;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nprocedure TControl.XYToClient(X,Y: single; var AClientX, AClientY: single);\r\nvar\r\n  p: TControl;\r\n  cr: TJSDOMRect;\r\nbegin\r\n  if (ElementPosition = epAbsolute) then\r\n  begin\r\n    AClientX := X - Left + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n    AClientY := Y - Top + document.body.scrollTop + document.documentElement.scrollTop;\r\n  end\r\n  else\r\n  begin\r\n    AClientX := X +  document.body.scrollLeft + document.documentElement.scrollLeft;\r\n    AClientY := Y + document.body.scrollTop + document.documentElement.scrollTop;\r\n  end;\r\n\r\n  p := Parent;\r\n  while Assigned(p) do\r\n  begin\r\n    if (p.isLinked) then\r\n    begin\r\n      // subtract the calculated position\r\n      cr := p.ElementHandle.getBoundingClientRect;\r\n      AClientX := AClientX - cr.Left;\r\n      AClientY := AClientY - cr.Top;\r\n    end;\r\n\r\n    if (p is TCustomForm) then\r\n    begin\r\n      if Assigned((p as TCustomForm).Container) and ((p as TCustomForm).FormContainer = '') and ((p as TCustomForm).FormFileName <> '') and ((p as TCustomForm).Popup) then\r\n      begin\r\n        cr := (p as TCustomForm).Container.getBoundingClientRect;\r\n        AClientX := AClientX - cr.Left;\r\n        AClientY := AClientY - cr.Top;\r\n      end;\r\n    end;\r\n\r\n    // only subtract for absolute positioned elements\r\n    if (p.ElementPosition = epAbsolute) then\r\n    begin\r\n      AClientX := AClientX - p.Left;\r\n      AClientY := AClientY - p.Top;\r\n    end;\r\n    p := p.Parent;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.ClientToXY(AClientX, AClientY: single; var X,Y: single);\r\nvar\r\n  p: TControl;\r\n  cr: TJSDOMRect;\r\nbegin\r\n  X := AClientX + Left - document.body.scrollLeft - document.documentElement.scrollLeft;\r\n  Y := AClientY + Top - document.body.scrollTop - document.documentElement.scrollTop;\r\n\r\n  p := Parent;\r\n  while Assigned(p) do\r\n  begin\r\n\r\n    if (p is TCustomForm) then\r\n    begin\r\n\r\n      if Assigned((p as TCustomForm).Container) and ((p as TCustomForm).FormContainer = '') and ((p as TCustomForm).FormFileName <> '') and ((p as TCustomForm).Popup) then\r\n      begin\r\n        cr := (p as TCustomForm).Container.getBoundingClientRect;\r\n        X := X + cr.Left;\r\n        Y := Y + cr.Top;\r\n      end;\r\n    end;\r\n\r\n    X := X + p.Left;\r\n    Y := Y + p.Top;\r\n    p := p.Parent;\r\n  end;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseDown(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  ss: TShiftState;\r\n  mb: TMouseButton;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeMouseDown in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  if not CanFocus then\r\n    PreventDefault;\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n  mb := GetMouseEventButton(Event);\r\n\r\n  MouseDown(mb, ss, Trunc(l), Trunc(t));\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseUp(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  ss: TShiftState;\r\n  mb: TMouseButton;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeMouseUp in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n  mb := GetMouseEventButton(Event);\r\n\r\n  MouseUp(mb, ss, Trunc(l), Trunc(t));\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoWheel(Event: TJSWheelEvent): Boolean;\r\nvar\r\n  ss: TShiftState;\r\n  h: Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  ss := GetMouseWheelEventShiftState(Event);\r\n\r\n  h := True;\r\n  MouseWheel(ss, Trunc(-Event.deltay), h);\r\n  Result := h;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nprocedure TControl.ParentFontChanged;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n    begin\r\n      if Controls[i].ParentFont then\r\n      begin\r\n        Controls[i].Font.Assign(Font);\r\n        Controls[i].FontChanged;\r\n        Controls[i].ParentFontChanged;\r\n      end;\r\n    end;\r\nend;\r\n\r\nprocedure TControl.HandleFontChanged(Sender: TObject);\r\nbegin\r\n  if (FUpdateCount = 0) then\r\n  begin\r\n    ParentFont := false;\r\n    ParentFontChanged;\r\n  end;\r\n\r\n  FontChanged;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchStart(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  FLastElementEvent := Event;\r\n\r\n  StopPropagation;\r\n\r\n  if not FAllowTouch then\r\n    PreventDefault;\r\n\r\n  if Event.Touches.length > 0 then\r\n  begin\r\n    touch := Event.touches.Touches[0];\r\n\r\n    XYToClient(touch.clientX, touch.clientY, l, t);\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n    begin\r\n      MouseDown(mbLeft, ss, Trunc(l), Trunc(t));\r\n    end;\r\n\r\n    TouchStart(Trunc(l), Trunc(t));\r\n  end;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchMove(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  FLastElementEvent := Event;\r\n\r\n  StopPropagation;\r\n\r\n  if not FAllowTouch then\r\n    PreventDefault;\r\n\r\n  if Captured then\r\n    PreventDefault;\r\n\r\n  if Event.Touches.length > 0 then\r\n  begin\r\n    touch := Event.touches.Touches[0];\r\n\r\n    XYToClient(touch.clientX, touch.clientY, l, t);\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n      MouseMove(ss, Trunc(l), Trunc(t));\r\n\r\n    TouchMove(Trunc(l), Trunc(t));\r\n  end;\r\n  FElementEvent := nil;\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchEnd(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n\r\n  if not FAllowTouch then\r\n    PreventDefault;\r\n\r\n  ReleaseCapture;\r\n  StopPropagation;\r\n\r\n  if Assigned(FLastElementEvent) and (TJSTouchEvent(FLastElementEvent).Touches.length > 0) then\r\n  begin\r\n    touch := TJSTouchEvent(FLastElementEvent).touches.Touches[0];\r\n\r\n    XYToClient(touch.clientX, touch.clientY, l, t);\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n    begin\r\n      MouseUp(mbLeft, ss, Trunc(l), Trunc(t));\r\n    end;\r\n\r\n    TouchEnd(Trunc(l), Trunc(t));\r\n  end;\r\n  FElementEvent := nil;\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchCancel(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  ReleaseCapture;\r\n  StopPropagation;\r\n\r\n  if Event.Touches.length > 0 then\r\n  begin\r\n    touch := Event.touches.Touches[0];\r\n\r\n    XYToClient(touch.clientX, touch.clientY, l, t);\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n    begin\r\n      MouseUp(mbLeft, ss, Trunc(l), Trunc(t));\r\n    end;\r\n\r\n    TouchCancel(Trunc(l), Trunc(t));\r\n  end;\r\n  FElementEvent := nil;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TControl.DragDrop(Source: TObject; X, Y: Integer);\r\nbegin\r\n  if Assigned(OnDragDrop) then\r\n    OnDragDrop(Self, Source, X, Y);\r\nend;\r\n\r\nprocedure TControl.DragOver(Source: TObject; X, Y: Integer;\r\n  State: TDragState; var Accept: Boolean);\r\nbegin\r\n  if Assigned(OnDragOver) then\r\n    OnDragOver(Self, Source, X, Y, State, Accept);\r\nend;\r\n\r\nprocedure TControl.DoBoundsChange;\r\nvar\r\n  b: boolean;\r\n  frm: TCustomForm;\r\nbegin\r\n  UpdateElementSize;\r\n  RecreateCanvas;\r\n\r\n  if FIsResizing then\r\n    Exit;\r\n\r\n  FIsResizing := true;\r\n\r\n  InternalResize;\r\n\r\n  DoRealign;\r\n\r\n  b := false;\r\n\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n  begin\r\n    b := frm.IsResizing;\r\n    b := b or (TControl(frm).FUpdateCount > 0);\r\n  end;\r\n\r\n  b := b or (FUpdateCount > 0);\r\n  b := b or FIsAligning;\r\n\r\n  if not b then\r\n    UpdateChildAnchoring;\r\n\r\n  FIsResizing := false;\r\nend;\r\n\r\nprocedure TControl.DoEndDrag(Target: TObject; X, Y: Integer);\r\nbegin\r\n  if Assigned(OnEndDrag) then\r\n    OnEndDrag(Self, Target, X, Y);\r\nend;\r\n\r\nprocedure TControl.DoStartDrag(var DragObject: TDragObject); \r\nbegin\r\n  if Assigned(OnStartDrag) then\r\n    OnStartDrag(Self, DragObject);\r\nend;\r\n\r\nfunction TControl.Focused: Boolean;\r\nbegin\r\n  Result := FContainer = document.activeElement;\r\nend;\r\n\r\n\r\nprocedure TControl.FontChanged;\r\nbegin\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseLeave(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if Captured then\r\n    Exit;\r\n\r\n  Event.stopPropagation;\r\n  DoMouseLeave;\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseEnter(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if Captured then\r\n    Exit;\r\n\r\n  Event.stopPropagation;\r\n  DoMouseEnter;\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeMouseMove in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n\r\n  MouseMove(ss, Trunc(l), Trunc(t));\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\n  ss: TShiftState;\r\n  undef: boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeKeyDown in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  asm\r\n    undef = (Event.key == undefined);\r\n  end;\r\n\r\n  if not undef then\r\n  begin\r\n    k := GetKeyCode(Event.Key, true);\r\n\r\n    ss := GetKeyboardEventShiftState(Event);\r\n\r\n    KeyDown(k, ss);\r\n  end;\r\n\r\n  Result := True;\r\n  if k = 0 then\r\n    PreventDefault;\r\n\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoKeyUp(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\n  ss: TShiftState;\r\n  c: Char;\r\n  undef: boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeKeyUp in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  asm\r\n    undef = (Event.key == undefined);\r\n  end;\r\n\r\n  if not undef then\r\n  begin\r\n    k := GetKeyCode(Event.Key, true);\r\n\r\n    ss := GetKeyboardEventShiftState(Event);\r\n\r\n    // #27 is not send as char in the browser\r\n    if (k = 27) then\r\n    begin\r\n      c := #27;\r\n      KeyPress(c);\r\n    end;\r\n\r\n    KeyUp(k, ss);\r\n  end;\r\n\r\n  Result := True;\r\n  if k = 0 then\r\n    PreventDefault;\r\n  FelementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoKeyPress(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  c: Char;\r\nbegin\r\n  FElementEvent := Event;\r\n  if (eeKeyPress in EventStopPropagation) then\r\n    StopPropagation;\r\n\r\n  if IsKeyCharacter(Event.Key) then\r\n  begin\r\n    c := Chr(GetKeyCode(Event.Key, false));\r\n    KeyPress(c);\r\n  end;\r\n\r\n  Result := True;\r\n  if c = #0 then\r\n    PreventDefault;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoInput(Event: TJSMessageEvent): Boolean;\r\nvar\r\n  c: Char;\r\n  stemp: string;\r\nbegin\r\n  //Note: On Android the OnKeyPress event is not triggered.\r\n  //The OnInput event is used instead to trigger the OnKeyPress event.\r\n  if IsAndroid then\r\n  begin\r\n    if (eeKeyPress in EventStopPropagation) then\r\n      StopPropagation;\r\n\r\n    c := #0;\r\n    if Assigned(Event.Data) and (Event.Data.toString <> '') then\r\n    begin\r\n      stemp := Event.Data.toString;\r\n      c := stemp[Length(stemp)];\r\n      KeyPress(c);\r\n    end;\r\n\r\n    Result := True;\r\n    if c = #0 then\r\n      PreventDefault;\r\n    FElementEvent := nil;\r\n  end;\r\nend;\r\n\r\nfunction TControl.HandleDoEnter(Event: TJSFocusEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  DoEnter;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoExit(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  DoExit;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TControl.SetParent(AValue: TControl);\r\nbegin\r\n  if FParent <> AValue then\r\n  begin\r\n    if Assigned(FParent) then\r\n      FParent.UnRegisterParent(Self);\r\n\r\n    FPrevParent := FParent;\r\n    FParent := AValue;\r\n\r\n    UpdateParent;\r\n    UpdateElement;\r\n    InitScript;\r\n\r\n    if Assigned(FParent) then\r\n      FParent.RegisterParent(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetParentColor(const Value: boolean);\r\nbegin\r\n  if (FParentColor <> Value) and Value and Assigned(Parent) then\r\n  begin\r\n    Color := Parent.Color;\r\n  end;\r\n\r\n  FParentColor := Value;\r\nend;\r\n\r\nprocedure TControl.SetParentComponent(Value: TComponent);\r\nbegin\r\n  if (Parent <> Value) and (Value is TControl) then\r\n   SetParent(TControl(Value));\r\nend;\r\n\r\nprocedure TControl.SetParentElement(const Value: TJSHTMLElement);\r\nbegin\r\n  if FNew then\r\n  begin\r\n    ElementPosition := epRelative;\r\n    CreateControl;\r\n    FParentElement := Value;\r\n\r\n    if Assigned(FParentElement) then\r\n    begin\r\n      FParentElement.appendChild(Container);\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    if Assigned(FParentElement) then\r\n      FParentElement.removeChild(Container);\r\n\r\n    FParentElement := Value;\r\n\r\n    if Assigned(FParentElement) then\r\n      FParentElement.appendChild(Container);\r\n  end;\r\n\r\n  UpdateElement;\r\n  InitScript;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TControl.SetParentElementID(const Value: string);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  FParentElementID := Value;\r\n\r\n  el := TJSHTMLElement(document.getElementById(FParentElementID));\r\n\r\n  if Assigned(el) then\r\n    SetParentElement(el);\r\nend;\r\n\r\nprocedure TControl.SetParentFont(const Value: boolean);\r\nbegin\r\n  if (Value <> FParentFont) and (Value) and Assigned(Parent) then\r\n  begin\r\n    Font.Assign(Parent.Font);\r\n    UpdateElement;\r\n  end;\r\n\r\n  FParentFont := Value;\r\nend;\r\n\r\nprocedure TControl.SetRequiredScripts(const Value: TStringList);\r\nbegin\r\n  FRequiredScripts.Assign(Value);\r\nend;\r\n\r\nprocedure TControl.SetRole(const Value: string);\r\nbegin\r\n  FRole := Value;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if Value = '' then\r\n      ElementHandle.removeAttribute('role')\r\n    else\r\n      ElementHandle.setAttribute('role', Value);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.Realign;\r\nbegin\r\n  AlignControl(Self);\r\nend;\r\n\r\nprocedure TControl.RecreateCanvas;\r\nbegin\r\nend;\r\n\r\nprocedure TControl.RecreateElement;\r\nbegin\r\n  if Assigned(Container) then\r\n  begin\r\n    UnbindEvents;\r\n    Container.parentNode.removeChild(Container);\r\n    FElement := nil;\r\n    CreateControl;\r\n\r\n    if Assigned(Parent) and Assigned(Parent.Container) then\r\n      Parent.ChildContainer.appendChild(Container);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.RegisterParent(AValue: TControl);\r\nbegin\r\n  SetLength(FControls, Length(FControls) + 1);\r\n  FControls[Length(FControls) - 1] := AValue;\r\nend;\r\n\r\nprocedure TControl.ReleaseCapture;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  FCaptureDown := False;\r\n\r\n  if FCaptured and Assigned(FLayer) then\r\n  begin\r\n    eh := TJSHTMLElement(FLayer);\r\n    eh.removeEventListener('mouseenter', FLayerMouseEnterPtr);\r\n    eh.removeEventListener('mouseleave', FLayerMouseLeavePtr);\r\n    eh.removeEventListener('mousedown', FMouseDownPtr);\r\n    eh.removeEventListener('mouseup', FMouseUpPtr);\r\n    eh.removeEventListener('mousemove', FMouseMovePtr);\r\n    eh.removeEventListener('touchstart', FTouchStartPtr);\r\n    eh.removeEventListener('touchmove', FTouchMovePtr);\r\n    eh.removeEventListener('touchend', FTouchEndPtr);\r\n    eh.removeEventListener('touchcancel', FTouchEndPtr);\r\n\r\n    document.body.removeChild(eh);\r\n    FCaptured := False;\r\n    FLayer := nil;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.ResetAnchoring;\r\nbegin\r\n  FOrigRect := Rect(-1,-1,-1,-1);\r\n  InitAnchoring;\r\nend;\r\n\r\nprocedure TControl.Resize;\r\nbegin\r\n  if Assigned(FOnResize) then\r\n    FOnResize(Self);\r\nend;\r\n\r\nfunction TControl.AnchoringInitialized: boolean;\r\nbegin\r\n  Result := (OrigRect.Left <> -1) or (OrigRect.Top <> -1);\r\nend;\r\n\r\nprocedure TControl.InitAnchoring;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if AnchoringInitialized then\r\n    Exit;\r\n\r\n  if (Self is TForm) then\r\n    FOrigRect := Rect(0, 0, GetDesignWidth, GetDesignHeight)\r\n  else\r\n    FOrigRect := Rect(GetDesignLeft, GetDesignTop, GetDesignLeft + GetDesignWidth, GetDesignTop + GetDesignHeight);\r\n\r\n  if Assigned(Parent) then\r\n  begin\r\n    if (Parent is TForm) then\r\n      FOrigParentRect := Rect(0, 0, Parent.GetDesignWidth, Parent.GetDesignHeight)\r\n    else\r\n    begin\r\n      //InitAnchoring;\r\n      if not Parent.AnchoringInitialized then\r\n        Parent.InitAnchoring;\r\n\r\n      FOrigParentRect := Rect(Parent.GetDesignLeft, Parent.GetDesignTop, Parent.GetDesignLeft + Parent.GetDesignWidth, Parent.GetDesignTop + Parent.GetDesignHeight);\r\n    end;\r\n  end;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].InitAnchoring;\r\nend;\r\n\r\nprocedure TControl.InjectCSS;\r\nvar\r\n  cssname,css: string;\r\n  cssmgr: TCSSCodeManager;\r\nbegin\r\n  cssname := GetWebClassname;\r\n\r\n  css := '';\r\n\r\n  cssmgr := GetCSSManager;\r\n\r\n  if Assigned(cssmgr) then\r\n    css := cssmgr.GetClassCSS(cssname);\r\n\r\n  if (css <> '') then\r\n    AddControlStyle(css);\r\nend;\r\n\r\nprocedure TControl.InternalResize;\r\nbegin\r\n  if (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  Resize;\r\nend;\r\n\r\nprocedure TControl.InternalUpdateParent;\r\nvar\r\n  p: TControl;\r\nbegin\r\n  p := FPrevParent;\r\n  if FNew then\r\n  begin\r\n    CreateControl;\r\n\r\n    if Assigned(Container) then\r\n    begin\r\n      if Assigned(Parent) and not Assigned(Parent.Container) then\r\n        Parent.CreateControl;\r\n\r\n      if (Parent <> p) and Assigned(p) and Assigned(p.Container) then\r\n        p.ChildContainer.removeChild(Container);\r\n\r\n      if Assigned(Parent) and Assigned(Parent.Container) then\r\n      begin\r\n        Parent.ChildContainer.appendChild(Container);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.IsFocused: Boolean;\r\nbegin\r\n  Result := FContainer = document.activeElement;\r\nend;\r\n\r\nfunction TControl.IsKeyCharacter(AValue: string): Boolean;\r\nbegin\r\n  case AValue of\r\n    'Up',\r\n    'Down',\r\n    'Left',\r\n    'Right',\r\n    TJSKeyNames.Shift,\r\n    TJSKeyNames.Control,\r\n    TJSKeyNames.Alt,\r\n    TJSKeyNames.Pause,\r\n    TJSKeyNames.CapsLock,\r\n    TJSKeyNames.PageUp,\r\n    TJSKeyNames.PageDown,\r\n    TJSKeyNames._End,\r\n    TJSKeyNames.Home,\r\n    TJSKeyNames.ArrowLeft,\r\n    TJSKeyNames.ArrowUp,\r\n    TJSKeyNames.ArrowRight,\r\n    TJSKeyNames.ArrowDown,\r\n    TJSKeyNames.Insert,\r\n    TJSKeyNames.Delete,\r\n    TJSKeyNames.F1,\r\n    TJSKeyNames.F2,\r\n    TJSKeyNames.F3,\r\n    TJSKeyNames.F4,\r\n    TJSKeyNames.F5,\r\n    TJSKeyNames.F6,\r\n    TJSKeyNames.F7,\r\n    TJSKeyNames.F8,\r\n    TJSKeyNames.F9,\r\n    TJSKeyNames.F10,\r\n    TJSKeyNames.F11,\r\n    TJSKeyNames.F12,\r\n    TJSKeyNames.F13,\r\n    TJSKeyNames.F14,\r\n    TJSKeyNames.F15,\r\n    TJSKeyNames.F16,\r\n    TJSKeyNames.F17,\r\n    TJSKeyNames.F18,\r\n    TJSKeyNames.F19,\r\n    TJSKeyNames.F20: Result := False;\r\n    else\r\n      Result := True;\r\n  end;\r\nend;\r\n\r\nfunction TControl.IsStructuralElement: boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nprocedure TControl.UnbindEvents;\r\nvar\r\n  eh: TJSEventTarget;\r\nbegin\r\n  if Assigned(ElementBindHandle) then\r\n  begin\r\n    eh := ElementBindHandle;\r\n\r\n    eh.removeEventListener('wheel', FWheelPtr);\r\n    eh.removeEventListener('click', FClickPtr);\r\n    eh.removeEventListener('dblclick', FDblClickPtr);\r\n    eh.removeEventListener('mousedown', FMouseDownPtr);\r\n    eh.removeEventListener('mouseup', FMouseUpPtr);\r\n    eh.removeEventListener('mousemove', FMouseMovePtr);\r\n    eh.removeEventListener('mouseleave', FMouseLeavePtr);\r\n    eh.removeEventListener('mouseenter', FMouseEnterPtr);\r\n    eh.removeEventListener('keydown', FKeyDownPtr);\r\n    eh.removeEventListener('keyup', FKeyUpPtr);\r\n    eh.removeEventListener('keypress', FKeyPressPtr);\r\n    eh.removeEventListener('focus', FEnterPtr);\r\n    eh.removeEventListener('blur', FExitPtr);\r\n\r\n    eh.removeEventListener('touchstart', FTouchStartPtr);\r\n    eh.removeEventListener('touchmove', FTouchMovePtr);\r\n    eh.removeEventListener('touchend', FTouchEndPtr);\r\n    eh.removeEventListener('touchcancel', FTouchEndPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UnRegisterParent(AValue: TControl);\r\nvar\r\n  i: Integer;\r\n  flg: Boolean;\r\nbegin\r\n  flg := false;\r\n\r\n  for i := 0 to Length(FControls) - 1 do\r\n  begin\r\n    if (FControls[i] = AValue) then\r\n    begin\r\n      flg := True;\r\n    end;\r\n\r\n    if (flg) and (i < Length(FControls) - 1) then\r\n      FControls[i] := FControls[i+1];\r\n  end;\r\n\r\n  if flg then\r\n    SetLength(FControls, Length(FControls) - 1);\r\nend;\r\n\r\nprocedure TControl.UpdateAnchoring;\r\nvar\r\n  dxr,dyr: integer;\r\n  dxo,dyo: integer;\r\n  dxw,dyw: integer;\r\n  br,r: TRect;\r\nbegin\r\n  if (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  if not FControlCreated then\r\n    Exit;\r\n\r\n  if (OrigRect.Left = -1) and (OrigRect.Top = -1) then\r\n    InitAnchoring;\r\n\r\n  if Assigned(Parent) and not Parent.AnchoringInitialized then\r\n    Exit;\r\n\r\n  if (Align <> alClient) then\r\n  begin\r\n    if Assigned(Parent) and not (Self is TForm) then\r\n    begin\r\n      r := Parent.BoundsRect;\r\n\r\n      dxr := (r.Right - r.Left) - (FOrigParentRect.Right - FOrigParentRect.Left);\r\n      dyr := (r.Bottom - r.Top) - (FOrigParentRect.Bottom - FOrigParentRect.Top);\r\n\r\n      br := FOrigRect;\r\n\r\n      dxo := 0;\r\n      dyo := 0;\r\n      dxw := 0;\r\n      dyw := 0;\r\n\r\n      if (akRight in Anchors) then\r\n      begin\r\n        if (akLeft in Anchors) then\r\n          dxw := dxr\r\n        else\r\n          dxo := dxr;\r\n      end;\r\n\r\n      if (akBottom in Anchors) then\r\n      begin\r\n        if (akTop in Anchors) then\r\n          dyw := dyr\r\n        else\r\n          dyo := dyr;\r\n      end;\r\n\r\n      if (akBottom in Anchors) or (akRight in Anchors) then\r\n      begin\r\n        SetBoundsInt(br.Left + dxo, br.Top + dyo, br.Right - br.Left + dxw, br.Bottom - br.Top  + dyw);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  UpdateChildAnchoring;\r\nend;\r\n\r\nprocedure TControl.UpdateChildAnchoring;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[i].UpdateAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateChildren(AControl: TControl);\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\nbegin\r\n  if Assigned(AControl) then\r\n  begin\r\n    AControl.DoRealign;\r\n    if AControl is TCustomControl then\r\n    begin\r\n      (AControl as TCustomControl).RecreateCanvas;\r\n      (AControl as TCustomControl).Invalidate;\r\n    end;\r\n\r\n    for I := 0 to AControl.ControlCount - 1 do\r\n    begin\r\n      c := AControl.Controls[I];\r\n      UpdateChildren(c);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.PersistinHTML;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].PersistinHTML;\r\nend;\r\n\r\nprocedure TControl.InitFromHTML;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].InitFromHTML;\r\nend;\r\n\r\nprocedure TControl.InitScript;\r\nbegin\r\n  // script to initialize any javascript control\r\nend;\r\n\r\nprocedure TControl.PreventDefault;\r\nbegin\r\n  if Assigned(ElementEvent) then\r\n    ElementEvent.preventDefault;\r\nend;\r\n\r\nprocedure TControl.UpdateElement;\r\nbegin\r\n  if FBlockUpdateElement or (FUpdateCount > 0) then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) and (ElementHandle <> ContainerElement) and not IsUpdating then\r\n  begin\r\n    UpdateElementData;\r\n\r\n    if not IsLinked then\r\n    begin\r\n      UpdateElementVisual;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateElementData;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  eh := ElementHandle;\r\n  if Assigned(eh) then\r\n  begin\r\n    if not (csDesigning in ComponentState) then\r\n    begin\r\n      if Visible then\r\n        eh.style.setProperty('display', '')\r\n      else\r\n        eh.style.setProperty('display', 'none');\r\n    end;\r\n\r\n    EnableTab;\r\n\r\n    if Enabled then\r\n      FContainer.removeAttribute('disabled')\r\n    else\r\n      FContainer.setAttribute('disabled','');\r\n\r\n    if IsLinked and (Hint = '') then\r\n      Exit;\r\n\r\n    if (Role <> '') then\r\n      FContainer['role'] := FRole;\r\n\r\n    if ShowHint and (Hint <> '') then\r\n       FContainer['title'] := Hint\r\n    else\r\n       FContainer.removeAttribute('title');\r\n\r\n    if not Enabled then\r\n      eh.style.removeProperty('color');\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateElementSize;\r\nvar\r\n  eh: TJSHTMLElement;\r\n  offsLeft,offsTop,ow: integer;\r\n  ctrl: TControl;\r\n  cr: TJSDOMRect;\r\n\r\nbegin\r\n  if FBlockUpdateElement or (FUpdateCount > 0) then\r\n    Exit;\r\n\r\n  if IsLinked then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) and (ElementHandle <> ContainerElement) then\r\n  begin\r\n    eh := ElementHandle;\r\n\r\n    offsLeft := 0;\r\n    offsTop := 0;\r\n\r\n    ctrl := Parent;\r\n    while Assigned(ctrl) do\r\n    begin\r\n      // found in the hierarchy a free floating control, so take its position in account\r\n      if ctrl.IsLinked and Assigned(ctrl.ElementHandle) and (ctrl.ElementHandle['position'] <> 'absolute') then\r\n      begin\r\n        cr := ctrl.ElementHandle.getBoundingClientRect;\r\n        offsLeft := Round(cr.Left);\r\n        offsTop := Round(cr.Top);\r\n        break;\r\n      end;\r\n      ctrl := ctrl.Parent;\r\n    end;\r\n\r\n    if Assigned(Parent) and (Parent.IsStructuralElement) then\r\n    begin\r\n      offsLeft := Parent.Left;\r\n      offsTop := Parent.Top;\r\n    end;\r\n\r\n    if (ElementPosition = epAbsolute) then\r\n    begin\r\n      if FTop <> -1 then\r\n        eh.style.setProperty('top', IntToStr(FTop + offsTop) + 'px')\r\n      else\r\n        eh.style.setProperty('top', '');\r\n\r\n      if FLeft <> -1 then\r\n        eh.style.setProperty('left', IntToStr(FLeft + offsLeft) + 'px')\r\n      else\r\n        eh.style.setProperty('left', '');\r\n    end\r\n    else\r\n    begin\r\n      eh.style.removeProperty('top');\r\n      eh.style.removeProperty('left');\r\n    end;\r\n\r\n    if (FWidthStyle = ssAbsolute) then\r\n    begin\r\n      ow := GetOuterWidth;\r\n\r\n      if FWidth <> -1 then\r\n        eh.style.setProperty('width', IntToStr(ow) + 'px')\r\n      else\r\n        eh.style.removeProperty('width');\r\n    end;\r\n\r\n    if (FWidthStyle = ssAuto) then\r\n    begin\r\n      eh.style.removeProperty('width');\r\n    end;\r\n\r\n    if (FHeightStyle = ssAbsolute) then\r\n    begin\r\n      if FHeight <> -1 then\r\n        eh.style.setProperty('height', IntToStr(GetOuterHeight) + 'px')\r\n      else\r\n        eh.style.removeProperty('height');\r\n    end;\r\n\r\n    if (FHeightStyle = ssAuto) then\r\n    begin\r\n      eh.style.removeProperty('height');\r\n    end;\r\n\r\n    if (FWidthStyle = ssPercent) then\r\n    begin\r\n      if FWidth <> -1 then\r\n        eh.style.setProperty('width', IntToStr(FWidthPercent) + '%')\r\n      else\r\n        eh.style.removeProperty('width');\r\n    end;\r\n\r\n    if (FHeightStyle = ssPercent) then\r\n    begin\r\n      if FHeight <> -1 then\r\n        eh.style.setProperty('height', IntToStr(FHeightPercent) + '%')\r\n      else\r\n        eh.style.removeProperty('height');\r\n    end;\r\n\r\n    if FElementPosition = epAbsolute then\r\n      eh.style.setProperty('position', 'absolute')\r\n    else if FElementPosition = epRelative then\r\n      eh.style.setProperty('position', 'relative')\r\n    else\r\n      eh.style.removeProperty('position');\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateElementVisual;\r\nvar\r\n  eh: TJSHTMLElement;\r\n  useCSS: boolean;\r\nbegin\r\n  eh := ElementHandle;\r\n\r\n  if not Assigned(eh) then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n//  if (csLoading in ComponentState) then\r\n//    Exit;\r\n\r\n  if ParentFont and Assigned(Parent) then\r\n  begin\r\n    Font.Assign(Parent.Font);\r\n  end;\r\n\r\n  if ElementClassName = '' then\r\n  begin\r\n    if ClipChildren then\r\n      eh.style.setProperty('overflow', 'hidden')\r\n    else\r\n      eh.style.setProperty('overflow', '');\r\n  end;\r\n\r\n  if (ElementClassName = '') then\r\n  begin\r\n    SetElementPointer(eh, Cursor);\r\n  end;\r\n\r\n  if Captured then\r\n    TJSHTMLElement(FLayer).style.setProperty('cursor', eh.style.getPropertyValue('cursor'));\r\n\r\n  if (ElementClassName <> '') or CanShowFocus then\r\n    eh.style.setProperty('outline', '')\r\n  else\r\n    eh.style.setProperty('outline', 'none');\r\n\r\n  UpdateElementSize;\r\n\r\n  case FTextDirection of\r\n  tdDefault: eh.style.removeProperty('direction');\r\n  tdRightToLeft: eh.style.setProperty('direction','rtl');\r\n  tdLeftToRight: eh.style.setProperty('direction','ltr');\r\n  tdInherit: eh.style.setProperty('direction','inherit');\r\n  end;\r\n\r\n  if ElementClassName = '' then\r\n  begin\r\n    eh.style.setProperty('webkit-user-select', 'none');\r\n    eh.style.setProperty('moz-user-select', 'none');\r\n    eh.style.setProperty('khtml-user-select', 'none');\r\n    eh.style.setProperty('ms-user-select', 'none');\r\n    eh.style.setProperty('user-select', 'none');\r\n    eh.style.setProperty('-webkit-tap-highlight-color', 'transparent');\r\n  end;\r\n\r\n  SetHTMLElementColor(eh, Color, not ((ElementClassName = '') and not IsLinked));\r\n\r\n  useCSS := not ((ElementClassName = '') and (ElementFont = efProperty) and not IsLinked);\r\n\r\n  SetHTMLElementFont(eh, Font, useCSS);\r\n\r\n  if not useCSS then\r\n  begin\r\n    if Enabled then\r\n      eh.style.setProperty('color', ColorToHtml(Font.Color));\r\n  end\r\n  else\r\n  begin\r\n    eh.style.removeProperty('color');\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateParent;\r\nbegin\r\n  InternalUpdateParent;\r\n  if (csLoading in ComponentState) and Assigned(Parent) and not (csLoading in Parent.ComponentState) then\r\n    Loaded;\r\n  UpdateChildren(FPrevParent);\r\n  UpdateChildren(Parent);\r\nend;\r\n\r\nprocedure TControl.UpdateControlSize(AWidth, AHeight: integer);\r\nbegin\r\n  FWidth := AWidth;\r\n  FHeight := AHeight;\r\nend;\r\n\r\nprocedure TControl.VisibleChanging;\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.GetBoundsRect: TRect;\r\nbegin\r\n  Result.Left := Left;\r\n  Result.Top := Top;\r\n  Result.Right := Left + Width;\r\n  Result.Bottom := Top + Height;\r\nend;\r\n\r\nfunction TControl.GetControlsCount: Integer;\r\nbegin\r\n  Result := Length(FControls);\r\nend;\r\n\r\nfunction TControl.GetCSSManager: TCSSCodeManager;\r\nvar\r\n  frm: TCustomForm;\r\n  i: integer;\r\nbegin\r\n  Result := nil;\r\n\r\n  frm := GetParentForm(Self);\r\n\r\n  if Assigned(frm) then\r\n  begin\r\n    for i := 0 to frm.ComponentCount - 1 do\r\n    begin\r\n      if frm.Components[i] is TCSSCodeManager then\r\n      begin\r\n        Result := frm.Components[i] as TCSSCodeManager;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetDesignHeight: integer;\r\nbegin\r\n  Result := FHeight;\r\nend;\r\n\r\nfunction TControl.GetDesignLeft: integer;\r\nbegin\r\n  Result := FLeft;\r\nend;\r\n\r\nfunction TControl.GetDesignTop: integer;\r\nbegin\r\n  Result := FTop;\r\nend;\r\n\r\nfunction TControl.GetDesignWidth: integer;\r\nbegin\r\n  Result := FWidth;\r\nend;\r\n\r\nfunction TControl.GetContainer: TJSElement;\r\nbegin\r\n  Result := FContainer;\r\nend;\r\n\r\nfunction TControl.GetControls(Index: Integer): TControl;\r\nbegin\r\n  Result := FControls[Index];\r\nend;\r\n\r\nprocedure TControl.DoEnter;\r\nbegin\r\n  if Assigned(OnEnter) then\r\n    OnEnter(Self);\r\nend;\r\n\r\nprocedure TControl.DoExit;\r\nbegin\r\n  if Assigned(OnExit) then\r\n    OnExit(Self);\r\nend;\r\n\r\n{ TCustomControl }\r\n\r\nprocedure TCustomControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FCaption := '';\r\n  ControlStyle := ControlStyle + [csSetCaption];\r\n  FBorderStyle := bsSingle;\r\n  FBorderColor := clSilver;\r\n  FPainting := false;\r\n  FWidth := 100;\r\n  FHeight := 25;\r\n  FWidthPercent := 100;\r\n  FHeightPercent := 100;\r\n  FCustomBorder := false;\r\nend;\r\n\r\nprocedure TCustomControl.BindElement;\r\nbegin\r\n  if (Container.TagName <> 'CANVAS') and not FControlCreated then\r\n  begin\r\n    FElementCanvas := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n    Container.appendChild(FElementCanvas);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.BindEvents;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomControl.CreateControl;\r\nbegin\r\n  inherited;\r\n  RecreateCanvas;\r\nend;\r\n\r\nfunction TCustomControl.CreateElement: TJSElement;\r\nbegin\r\n  FElementCanvas := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n  if csAcceptsControls in ControlStyle then\r\n  begin\r\n    Result := document.createElement('SPAN');\r\n    Result.appendChild(FElementCanvas);\r\n    FElementCanvas['id'] := ElementID + '_Canvas';\r\n    FElementCanvas['zindex'] := '-1';\r\n  end\r\n  else\r\n    Result := FElementCanvas;\r\nend;\r\n\r\ndestructor TCustomControl.Destroy;\r\nbegin\r\n  if Assigned(FCanvas) then\r\n    FCanvas.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TCustomControl.GetCanvas: TCanvas;\r\nbegin\r\n  if not Assigned(FCanvas) then\r\n  begin\r\n    CreateControl;\r\n  end;\r\n  Result := FCanvas;\r\nend;\r\n\r\nfunction TCustomControl.GetCanvasHeightOffset: Integer;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TCustomControl.GetCanvasWidthOffset: Integer;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TCustomControl.GetPixelRatio: Single;\r\nvar\r\n  res: single;\r\nbegin\r\n  asm\r\n    var ctx = document.createElement(\"canvas\").getContext(\"2d\"),\r\n        dpr = window.devicePixelRatio || 1,\r\n        bsr = ctx.webkitBackingStorePixelRatio ||\r\n              ctx.mozBackingStorePixelRatio ||\r\n              ctx.msBackingStorePixelRatio ||\r\n              ctx.oBackingStorePixelRatio ||\r\n              ctx.backingStorePixelRatio || 1;\r\n    res = dpr / bsr\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nprocedure TCustomControl.Invalidate;\r\nvar\r\n  px: Single;\r\n  frm: TCustomForm;\r\nbegin\r\n  inherited;\r\n\r\n  if (Parent = nil) or (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n    if frm.IsUpdating then\r\n      Exit;\r\n\r\n  px := GetPixelRatio;\r\n  if (px <> FPixelRatio) then\r\n    RecreateCanvas;\r\n\r\n  FPixelRatio := GetPixelRatio;\r\n\r\n  FPainting := true;\r\n\r\n  if Assigned(FCanvas) then\r\n    FCanvas.Clear;\r\n\r\n  Paint;\r\n  FPainting := false;\r\nend;\r\n\r\nprocedure TCustomControl.Loaded;\r\nbegin\r\n  inherited;\r\n  Invalidate;\r\nend;\r\n\r\nfunction TCustomControl.MakeScreenShot: TBitmap;\r\nbegin\r\n  Result := TBitmap.Create;\r\n  Result.LoadFromCanvas(Canvas);\r\nend;\r\n\r\nprocedure TCustomControl.Paint;\r\nbegin\r\nend;\r\n\r\nprocedure TCustomControl.RecreateCanvas;\r\nvar\r\n  px: Single;\r\n  el: TJSHTMLCanvasElement;\r\n  h, w: Integer;\r\nbegin\r\n  if Assigned(FElementCanvas) then\r\n  begin\r\n    if not FPainting then\r\n    begin\r\n      el := TJSHTMLCanvasElement(document.getElementByID(GetID+'_Canvas'));\r\n\r\n      // it is already found\r\n      if Assigned(el) then\r\n      begin\r\n        FElementCanvas := el;\r\n        FCanvas.Free;\r\n        FCanvas := nil;\r\n      end;\r\n\r\n      px := GetPixelRatio;\r\n      h := Height - GetCanvasHeightOffset;\r\n      w := Width - GetCanvasWidthOffset;\r\n\r\n      if ElementPosition = epRelative then\r\n        FElementCanvas.style.setProperty('position', 'relative')\r\n      else\r\n        FElementCanvas.style.setProperty('position', 'absolute');\r\n\r\n      FElementCanvas.style.setProperty('height', IntToStr(h) + 'px');\r\n      FElementCanvas.style.setProperty('width', IntToStr(w) + 'px');\r\n      FElementCanvas.height := Round(h * px);\r\n      FElementCanvas.width := Round(w * px);\r\n    end;\r\n\r\n    if not Assigned(FCanvas) then\r\n      FCanvas := TCanvas.Create(FElementCanvas);\r\n\r\n    FCanvas.ApplyPixelRatio := True;\r\n    FCanvas.SetTransform(1, 0, 0, 1, 0, 0);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.RenderDesigning(ACaption: string; AElement: TJSElement;\r\n  AControl: TCustomControl; ADisplay: Boolean);\r\nvar\r\n  LContainer, LLabel: TJSHTMLElement;\r\n  LHasLabel: boolean;\r\nbegin\r\n  LContainer := TJSHTMLElement(AElement);\r\n  LLabel := TJSHTMLElement(LContainer.firstChild);\r\n  LHasLabel := Assigned(LLabel) and (LLabel.getAttribute('data-design') = '1');\r\n\r\n  if (csDesigning in AControl.ComponentState) and (ADisplay) and (ElementClassName = '') then\r\n  begin\r\n    if LHasLabel then\r\n      Exit;\r\n    LContainer.innerHTML := '';\r\n    LLabel := TJSHTMLElement(document.createElement('DIV'));\r\n    LLabel.setAttribute('data-design','1');\r\n    LLabel.innerHTML := ACaption;\r\n    LLabel.style.setProperty('position','relative');\r\n    LLabel.style.setProperty('top','50%');\r\n    LLabel.style.setProperty('left','50%');\r\n    LLabel.style.setProperty('transform','translateY(-50%)');\r\n    LLabel.style.setProperty('transform','translateX(-50%)');\r\n    LLabel.style.setProperty('display','inline-block');\r\n    LContainer.style.setProperty('border','1px solid gray');\r\n    LContainer.style.setProperty('background-color','silver');\r\n    CustomBorder := True;\r\n    LContainer.appendChild(LLabel);\r\n  end\r\n  else\r\n  begin\r\n    if LHasLabel then\r\n    begin\r\n      LContainer.removeChild(LContainer.firstChild);\r\n      LContainer.style.removeProperty('border');\r\n      LContainer.style.removeProperty('background-color');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.Resize;\r\nbegin\r\n  inherited;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TCustomControl.SetBorderColor(const AValue: TColor);\r\nbegin\r\n  if (FBorderColor <> AValue) then\r\n  begin\r\n    FBorderColor := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.SetBorderStyle(const AValue: TBorderStyle);\r\nbegin\r\n  if FBorderStyle <> AValue then\r\n  begin\r\n    FBorderStyle := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.SetCaption(const AValue: string);\r\nbegin\r\n  FCaption := AValue;\r\n  ControlStyle := ControlStyle - [csSetCaption];\r\nend;\r\n\r\nprocedure TCustomControl.SetName(const NewName: TComponentName);\r\nvar\r\n  cs: TControlStyle;\r\n  ownername: string;\r\nbegin\r\n  ownername := '';\r\n  if (Self is TFrame) then\r\n  begin\r\n    ownername := 'F'+ FindUniqueName(Name) + '_';\r\n  end;\r\n\r\n  inherited SetName(ownername + NewName);\r\n\r\n  if (csSetCaption in ControlStyle) and (csDesigning in ComponentState) and not (csLoading in ComponentState) then\r\n  begin\r\n    if Assigned(Owner) and (csLoading in Owner.ComponentState) then\r\n      Exit;\r\n\r\n    cs := ControlStyle;\r\n    SetCaption(NewName);\r\n    ControlStyle := cs;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if not IsLinked and (ElementClassName = '') then\r\n    begin\r\n      if BorderStyle = bsSingle then // default border style\r\n      begin\r\n        if CustomBorder then\r\n        begin\r\n          ElementHandle.style.setProperty('border-style', 'solid');\r\n          ElementHandle.style.setProperty('border-width', '1px');\r\n          ElementHandle.style.setProperty('border-color', ColorToHTML(BorderColor));\r\n        end\r\n        else\r\n          ElementHandle.style.setProperty('border-style', '')\r\n      end\r\n      else\r\n        ElementHandle.style.setProperty('border-style', 'none');\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TScrollingGraphicControl }\r\n\r\nprocedure TScrollingGraphicControl.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle.style.setProperty('overflow', 'auto');\r\nend;\r\n\r\n\r\nfunction TScrollingGraphicControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\n{ TMargins }\r\n\r\nprocedure TMargins.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TMargins then\r\n  begin\r\n    FLeft := (Source as TMargins).Left;\r\n    FTop := (Source as TMargins).Top;\r\n    FBottom := (Source as TMargins).Bottom;\r\n    FRight := (Source as TMargins).Right;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nconstructor TMargins.Create;\r\nbegin\r\n  FLeft := 3;\r\n  FTop := 3;\r\n  FBottom := 3;\r\n  FRight := 3;\r\nend;\r\n\r\n{ TControlManager }\r\n\r\nconstructor TControlManager.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FInstanceCount := 0;\r\nend;\r\n\r\nfunction TControlManager.GetInstanceNumber: integer;\r\nbegin\r\n  Inc(FInstanceCount);\r\n  Result := FInstanceCount;\r\nend;\r\n\r\nprocedure TControlManager.Reset;\r\nbegin\r\n  FInstanceCount := 0;\r\nend;\r\n\r\n{ TCSSCodeFragment }\r\n\r\nconstructor TCSSCodeFragment.Create(Collection: TCollection);\r\nbegin\r\n  inherited;\r\n  FCSS := TStringList.Create;\r\nend;\r\n\r\ndestructor TCSSCodeFragment.Destroy;\r\nbegin\r\n  FCSS.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCSSCodeFragment.SetCSS(const Value: TStringList);\r\nbegin\r\n  FCSS.Assign(Value);\r\nend;\r\n\r\n{ TCSSCodeFragments }\r\n\r\nfunction TCSSCodeFragments.Add: TCSSCodeFragment;\r\nbegin\r\n  Result := TCSSCodeFragment(inherited Add);\r\nend;\r\n\r\nconstructor TCSSCodeFragments.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TCSSCodeFragment);\r\nend;\r\n\r\nfunction TCSSCodeFragments.GetItemEx(Index: integer): TCSSCodeFragment;\r\nbegin\r\n  Result := TCSSCodeFragment(inherited Items[Index]);\r\nend;\r\n\r\nfunction TCSSCodeFragments.Insert(Index: integer): TCSSCodeFragment;\r\nbegin\r\n  Result := TCSSCodeFragment(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TCSSCodeFragments.SetItemEx(Index: integer;\r\n  const Value: TCSSCodeFragment);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TCSSCodeManager }\r\n\r\nconstructor TCSSCodeManager.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FCSSFragments := TCSSCodeFragments.Create(Self);\r\n  FCSSFragments.PropName := 'CSSFragments';\r\nend;\r\n\r\ndestructor TCSSCodeManager.Destroy;\r\nbegin\r\n  FCSSFragments.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TCSSCodeManager.GetClassCSS(AClassname: string): string;\r\nvar\r\n  CSSCodeFragment: TCSSCodeFragment;\r\nbegin\r\n  Result := '';\r\n\r\n  CSSCodeFragment := GetClassFragment(AClassName);\r\n\r\n  if Assigned(CSSCodeFragment) then\r\n    Result := CSSCodeFragment.CSS.Text;\r\nend;\r\n\r\nfunction TCSSCodeManager.GetClassFragment(AClassname: string): TCSSCodeFragment;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := nil;\r\n  for i := 0 to CSSFragments.Count - 1 do\r\n  begin\r\n    if CSSFragments.Items[i].ControlClassName = AClassname then\r\n      Result := CSSFragments.Items[i];\r\n  end;\r\nend;\r\n\r\nprocedure TCSSCodeManager.SetCSSFragments(const Value: TCSSCodeFragments);\r\nbegin\r\n  FCSSFragments.Assign(Value);\r\nend;\r\n\r\n{ TjQueryCustomContol }\r\n\r\nfunction TjQueryCustomControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure TjQueryCustomControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FIsInitialized := false;\r\nend;\r\n\r\nfunction TjQueryCustomControl.GetJQID: string;\r\nbegin\r\n  Result := '#' + GetID;\r\nend;\r\n\r\nprocedure TjQueryCustomControl.InitJQuery;\r\nbegin\r\n  //\r\nend;\r\n\r\nprocedure TjQueryCustomControl.InitJQueryOnce;\r\nbegin\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if FIsInitialized then\r\n    Exit;\r\n\r\n  FIsInitialized := true;\r\n  InitJQuery;\r\nend;\r\n\r\nprocedure TjQueryCustomControl.Loaded;\r\nbegin\r\n  inherited;\r\n  InitJQueryOnce;\r\nend;\r\n\r\nprocedure TjQueryCustomControl.SetParent(AValue: TControl);\r\nbegin\r\n  inherited;\r\n  InitJQueryOnce;\r\nend;\r\n\r\n{ TPadding }\r\n\r\nprocedure TPadding.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TPadding) then\r\n  begin\r\n    FLeft := (Source as TPadding).Left;\r\n    FRight := (Source as TPadding).Right;\r\n    FTop := (Source as TPadding).Top;\r\n    FBottom := (Source as TPadding).Bottom;\r\n  end;\r\nend;\r\n\r\nconstructor TPadding.Create;\r\nbegin\r\n  inherited;\r\n  FLeft := 0;\r\n  FTop := 0;\r\n  FRight := 0;\r\n  FBottom := 0;\r\nend;\r\n\r\nprocedure TPadding.DoChange;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TPadding.SetBottom(const Value: integer);\r\nbegin\r\n  if (FBottom <> Value) then\r\n  begin\r\n    FBottom := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TPadding.SetLeft(const Value: integer);\r\nbegin\r\n  if (FLeft <> Value) then\r\n  begin\r\n    FLeft := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TPadding.SetRight(const Value: integer);\r\nbegin\r\n  if (FRight <> Value) then\r\n  begin\r\n    FRight := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TPadding.SetTop(const Value: integer);\r\nbegin\r\n  if (FTop <> Value) then\r\n  begin\r\n    FTop := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\n{ TCustomHTMLDiv }\r\n\r\nfunction TCustomHTMLDiv.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\ninitialization\r\n  ScrollBW := 0;\r\n  ScrollBH := 0;\r\n  ControlManager := TControlManager.Create(nil);\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Modules;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes;\r\n\r\ntype\r\n  TDataModuleClass = class of TDataModule;\r\n  TDataModule = class(TComponent)\r\n  strict private\r\n    FHeight: Integer;\r\n    FOldCreateOrder: Boolean;\r\n    FOnCreate: TNotifyEvent;\r\n    FOnDestroy: TNotifyEvent;\r\n    FWidth: Integer;\r\n  strict protected\r\n    procedure DoCreate; virtual;\r\n    procedure DoDestroy; virtual;\r\n    procedure LoadDFMValues; virtual;\r\n  public\r\n    constructor CreateNew(AOwner: TComponent; Dummy: Integer = 0); virtual;\r\n    procedure AfterConstruction; override;\r\n    procedure BeforeDestruction; override;\r\n    property Height: Integer read FHeight write FHeight;\r\n    property OldCreateOrder: Boolean read FOldCreateOrder write FOldCreateOrder;\r\n    property Width: Integer read FWidth write FWidth;\r\n  published\r\n    property OnCreate: TNotifyEvent read FOnCreate write FOnCreate;\r\n    property OnDestroy: TNotifyEvent read FOnDestroy write FOnDestroy;\r\n  end;\r\n  TWebDataModule = TDataModule;\r\n\r\nimplementation\r\n\r\nconstructor TDataModule.CreateNew(AOwner: TComponent; Dummy: Integer);\r\nbegin\r\n  inherited Create(AOwner);\r\nend;\r\n\r\n{ TDataModule }\r\n\r\nprocedure TDataModule.AfterConstruction;\r\nbegin\r\n  inherited AfterConstruction;\r\n  if not OldCreateOrder then\r\n    DoCreate;\r\nend;\r\n\r\nprocedure TDataModule.BeforeDestruction;\r\nbegin\r\n  inherited BeforeDestruction;\r\n  if not OldCreateOrder then\r\n    DoDestroy;\r\nend;\r\n\r\nprocedure TDataModule.DoCreate;\r\nbegin\r\n  LoadDFMValues;\r\n  if Assigned(FOnCreate) then\r\n    FOnCreate(Self);\r\nend;\r\n\r\nprocedure TDataModule.DoDestroy;\r\nbegin\r\n  if Assigned(FOnDestroy) then\r\n    FOnDestroy(Self);\r\nend;\r\n\r\nprocedure TDataModule.LoadDFMValues;\r\nbegin\r\nend;\r\n\r\nend.\r\n","unit WEBLib.Lang;\r\n\r\ninterface\r\n\r\ntype\r\n\r\n  TUILanguage = (\r\n        lNone,\r\n        lAfar,\r\n        lAbkhazian,\r\n        lAvestan,\r\n        lAfrikaans,\r\n        lAkan,\r\n        lAmharic,\r\n        lAragonese,\r\n        lArabic,\r\n        lAssamese,\r\n        lAvaric,\r\n        lAymara,\r\n        lAzerbaijani,\r\n        lBashkir,\r\n        lBelarusian,\r\n        lBulgarian,\r\n        lBihari,\r\n        lBislama,\r\n        lBambara,\r\n        lBengali,\r\n        lTibetan,\r\n        lBreton,\r\n        lBosnian,\r\n        lCatalan,\r\n        lChechen,\r\n        lChamorro,\r\n        lCorsican,\r\n        lCree,\r\n        lCzech,\r\n        lOldSlavic,\r\n        lChuvash,\r\n        lWelsh,\r\n        lDanish,\r\n        lGerman,\r\n        lDivehi,\r\n        lDzongkha,\r\n        lEwe,\r\n        lEnglish,\r\n        lEsperanto,\r\n        lSpanish,\r\n        lEstonian,\r\n        lBasque,\r\n        lPersian,\r\n        lFulah,\r\n        lFinnish,\r\n        lFijian,\r\n        lFaroese,\r\n        lFrench,\r\n        lWesternFrisian,\r\n        lIrish,\r\n        lGaelic,\r\n        lGalician,\r\n        lGuarani,\r\n        lGujarati,\r\n        lManx,\r\n        lHausa,\r\n        lHebrew,\r\n        lHindi,\r\n        lHiriMotu,\r\n        lCroatian,\r\n        lHaitian,\r\n        lHungarian,\r\n        lArmenian,\r\n        lHerero,\r\n        lInterlingua,\r\n        lIndonesian,\r\n        lInterlingue,\r\n        lIgbo,\r\n        lSichuanYi,\r\n        lInupiaq,\r\n        lIdo,\r\n        lIcelandic,\r\n        lItalian,\r\n        lInuktitut,\r\n        lJapanese,\r\n        lJavanese,\r\n        lGeorgian,\r\n        lKongo,\r\n        lKikuyu,\r\n        lKuanyama,\r\n        lKazakh,\r\n        lKalaallisut,\r\n        lCentralKhmer,\r\n        lKannada,\r\n        lKorean,\r\n        lKanuri,\r\n        lKashmiri,\r\n        lKurdish,\r\n        lKomi,\r\n        lCornish,\r\n        lKirghiz,\r\n        lLatin,\r\n        lLuxembourgish,\r\n        lGanda,\r\n        lLimburgan,\r\n        lLingala,\r\n        lLao,\r\n        lLithuanian,\r\n        lLubaKatanga,\r\n        lLatvian,\r\n        lMalagasy,\r\n        lMarshallese,\r\n        lMaori,\r\n        lMacedonian,\r\n        lMalayalam,\r\n        lMongolian,\r\n        lMarathi,\r\n        lMalay,\r\n        lMaltese,\r\n        lBurmese,\r\n        lNauru,\r\n        lNdebele,\r\n        lNepali,\r\n        lNdonga,\r\n        lDutch,\r\n        lNorwegian,\r\n        lNavajo,\r\n        lChichewa,\r\n        lOccitan,\r\n        lOjibwa,\r\n        lOromo,\r\n        lOriya,\r\n        lOssetian,\r\n        lPanjabi,\r\n        lPali,\r\n        lPolish,\r\n        lPushto,\r\n        lPortuguese,\r\n        lQuechua,\r\n        lRomansh,\r\n        lRundi,\r\n        lRomanian,\r\n        lRussian,\r\n        lKinyarwanda,\r\n        lSanskrit,\r\n        lSardinian,\r\n        lSindhi,\r\n        lNorthernSami,\r\n        lSango,\r\n        lSinhala,\r\n        lSlovak,\r\n        lSlovenian,\r\n        lSamoan,\r\n        lShona,\r\n        lSomali,\r\n        lAlbanian,\r\n        lSerbian,\r\n        lSwati,\r\n        lSotho,\r\n        lSundanese,\r\n        lSwedish,\r\n        lSwahili,\r\n        lTamil,\r\n        lTelugu,\r\n        lTajik,\r\n        lThai,\r\n        lTigrinya,\r\n        lTurkmen,\r\n        lTagalog,\r\n        lTswana,\r\n        lTonga,\r\n        lTurkish,\r\n        lTsonga,\r\n        lTatar,\r\n        lTwi,\r\n        lTahitian,\r\n        lUighur,\r\n        lUkrainian,\r\n        lUrdu,\r\n        lUzbek,\r\n        lVenda,\r\n        lVietnamese,\r\n        lWalloon,\r\n        lWolof,\r\n        lXhosa,\r\n        lYiddish,\r\n        lYoruba,\r\n        lZhuang,\r\n        lChinese,\r\n        lZulu);\r\n\r\nfunction GetLanguageISO639_1Code(ALang: TUILanguage): string;\r\n\r\nimplementation\r\n\r\nfunction GetLanguageISO639_1Code(ALang: TUILanguage): string;\r\nbegin\r\n  case ALang of\r\n    lNone: Result := '';\r\n    lAfar: Result := 'aa';\r\n    lAbkhazian: Result := 'ab';\r\n    lAvestan: Result := 'ae';\r\n    lAfrikaans: Result := 'af';\r\n    lAkan: Result := 'ak';\r\n    lAmharic: Result := 'am';\r\n    lAragonese: Result := 'an';\r\n    lArabic: Result := 'ar';\r\n    lAssamese: Result := 'as';\r\n    lAvaric: Result := 'av';\r\n    lAymara: Result := 'ay';\r\n    lAzerbaijani: Result := 'az';\r\n    lBashkir: Result := 'ba';\r\n    lBelarusian: Result := 'be';\r\n    lBulgarian: Result := 'bg';\r\n    lBihari: Result := 'bh';\r\n    lBislama: Result := 'bi';\r\n    lBambara: Result := 'bm';\r\n    lBengali: Result := 'bn';\r\n    lTibetan: Result := 'bo';\r\n    lBreton: Result := 'br';\r\n    lBosnian: Result := 'bd';\r\n    lCatalan: Result := 'ca';\r\n    lChechen: Result := 'ce';\r\n    lChamorro: Result := 'ch';\r\n    lCorsican: Result := 'co';\r\n    lCree: Result := 'cr';\r\n    lCzech: Result := 'cs';\r\n    lOldSlavic: Result := 'cu';\r\n    lChuvash: Result := 'cv';\r\n    lWelsh: Result := 'cy';\r\n    lDanish: Result := 'da';\r\n    lGerman: Result := 'de';\r\n    lDivehi: Result := 'dv';\r\n    lDzongkha: Result := 'dz';\r\n    lEwe: Result := 'ee';\r\n    lEnglish: Result := 'en';\r\n    lEsperanto: Result := 'eo';\r\n    lSpanish: Result := 'es';\r\n    lEstonian: Result := 'et';\r\n    lBasque: Result := 'eu';\r\n    lPersian: Result := 'fa';\r\n    lFulah: Result := 'ff';\r\n    lFinnish: Result := 'fi';\r\n    lFijian: Result := 'fj';\r\n    lFaroese: Result := 'fo';\r\n    lFrench: Result := 'fr';\r\n    lWesternFrisian: Result := 'fy';\r\n    lIrish: Result := 'ga';\r\n    lGaelic: Result := 'gd';\r\n    lGalician: Result := 'gl';\r\n    lGuarani: Result := 'gn';\r\n    lGujarati: Result := 'gu';\r\n    lManx: Result := 'gv';\r\n    lHausa: Result := 'ha';\r\n    lHebrew: Result := 'he';\r\n    lHindi: Result := 'hi';\r\n    lHiriMotu: Result := 'ho';\r\n    lCroatian: Result := 'hr';\r\n    lHaitian: Result := 'ht';\r\n    lHungarian: Result := 'hu';\r\n    lArmenian: Result := 'hy';\r\n    lHerero: Result := 'hz';\r\n    lInterlingua: Result := 'ia';\r\n    lIndonesian: Result := 'id';\r\n    lInterlingue: Result := 'ie';\r\n    lIgbo: Result := 'ig';\r\n    lSichuanYi: Result := 'ii';\r\n    lInupiaq: Result := 'ik';\r\n    lIdo: Result := 'id';\r\n    lIcelandic: Result := 'is';\r\n    lItalian: Result := 'it';\r\n    lInuktitut: Result := 'iu';\r\n    lJapanese: Result := 'ja';\r\n    lJavanese: Result := 'jv';\r\n    lGeorgian: Result := 'ka';\r\n    lKongo: Result := 'kg';\r\n    lKikuyu: Result := 'ki';\r\n    lKuanyama: Result := 'kj';\r\n    lKazakh: Result := 'kk';\r\n    lKalaallisut: Result := 'kl';\r\n    lCentralKhmer: Result := 'km';\r\n    lKannada: Result := 'kn';\r\n    lKorean: Result := 'ko';\r\n    lKanuri: Result := 'kr';\r\n    lKashmiri: Result := 'ks';\r\n    lKurdish: Result := 'ku';\r\n    lKomi: Result := 'kv';\r\n    lCornish: Result := 'kw';\r\n    lKirghiz: Result := 'ky';\r\n    lLatin: Result := 'la';\r\n    lLuxembourgish: Result := 'lb';\r\n    lGanda: Result := 'lg';\r\n    lLimburgan: Result := 'li';\r\n    lLingala: Result := 'ln';\r\n    lLao: Result := 'lo';\r\n    lLithuanian: Result := 'lt';\r\n    lLubaKatanga: Result := 'lu';\r\n    lLatvian: Result := 'lv';\r\n    lMalagasy: Result := 'mg';\r\n    lMarshallese: Result := 'mh';\r\n    lMaori: Result := 'mi';\r\n    lMacedonian: Result := 'mk';\r\n    lMalayalam: Result := 'ml';\r\n    lMongolian: Result := 'mn';\r\n    lMarathi: Result := 'mr';\r\n    lMalay: Result := 'ms';\r\n    lMaltese: Result := 'mt';\r\n    lBurmese: Result := 'my';\r\n    lNauru: Result := 'na';\r\n    lNdebele: Result := 'nb';\r\n    lNepali: Result := 'nd';\r\n    lNdonga: Result := 'ng';\r\n    lDutch: Result := 'nl';\r\n    lNorwegian: Result := 'no';\r\n    lNavajo: Result := 'nv';\r\n    lChichewa: Result := 'ny';\r\n    lOccitan: Result := 'oc';\r\n    lOjibwa: Result := 'oj';\r\n    lOromo: Result := 'om';\r\n    lOriya: Result := 'or';\r\n    lOssetian: Result := 'os';\r\n    lPanjabi: Result := 'pa';\r\n    lPali: Result := 'pi';\r\n    lPolish: Result := 'pl';\r\n    lPushto: Result := 'ps';\r\n    lPortuguese: Result := 'pt';\r\n    lQuechua: Result := 'qu';\r\n    lRomansh: Result := 'rm';\r\n    lRundi: Result := 'rn';\r\n    lRomanian: Result := 'ro';\r\n    lRussian: Result := 'ru';\r\n    lKinyarwanda: Result := 'rw';\r\n    lSanskrit: Result := 'sa';\r\n    lSardinian: Result := 'sc';\r\n    lSindhi: Result := 'sd';\r\n    lNorthernSami: Result := 'se';\r\n    lSango: Result := 'sg';\r\n    lSinhala: Result := 'si';\r\n    lSlovak: Result := 'sk';\r\n    lSlovenian: Result := 'sl';\r\n    lSamoan: Result := 'sm';\r\n    lShona: Result := 'sn';\r\n    lSomali: Result := 'so';\r\n    lAlbanian: Result := 'sq';\r\n    lSerbian: Result := 'sr';\r\n    lSwati: Result := 'ss';\r\n    lSotho: Result := 'st';\r\n    lSundanese: Result := 'su';\r\n    lSwedish: Result := 'sv';\r\n    lSwahili: Result := 'sw';\r\n    lTamil: Result := 'ta';\r\n    lTelugu: Result := 'te';\r\n    lTajik: Result := 'tg';\r\n    lThai: Result := 'th';\r\n    lTigrinya: Result := 'ti';\r\n    lTurkmen: Result := 'tk';\r\n    lTagalog: Result := 'tl';\r\n    lTswana: Result := 'tn';\r\n    lTonga: Result := 'to';\r\n    lTurkish: Result := 'tr';\r\n    lTsonga: Result := 'ts';\r\n    lTatar: Result := 'tt';\r\n    lTwi: Result := 'tw';\r\n    lTahitian: Result := 'ty';\r\n    lUighur: Result := 'ug';\r\n    lUkrainian: Result := 'uk';\r\n    lUrdu: Result := 'ur';\r\n    lUzbek: Result := 'uz';\r\n    lVenda: Result := 've';\r\n    lVietnamese: Result := 'vi';\r\n    lWalloon: Result := 'wa';\r\n    lWolof: Result := 'wo';\r\n    lXhosa: Result := 'xh';\r\n    lYiddish: Result := 'yi';\r\n    lYoruba: Result := 'yo';\r\n    lZhuang: Result := 'za';\r\n    lChinese: Result := 'zh';\r\n    lZulu: Result := 'zu';\r\n  end;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.JSON;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, Web, JS, SysUtils;\r\n\r\ntype\r\n  TJSONObject = class;\r\n  TJSONString = class;\r\n\r\n  TJSONAncestor = class(TObject)\r\n  private\r\n  protected\r\n    function GetStrValue: string; virtual;\r\n    procedure SetStrValue(const Value: string); virtual;\r\n  public\r\n    property Value: string read GetStrValue write SetStrValue;\r\n  end;\r\n\r\n  TJSONValue = class(TJSONAncestor)\r\n  private\r\n    fjv: JSValue;\r\n  protected\r\n    property jv: JSValue read fjv write fjv;\r\n  public\r\n    constructor Create(AJSValue: JSValue); overload;\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONPair = class(TObject)\r\n  private\r\n    fjv: TJSONValue;\r\n    fjs: TJSONString;\r\n  public\r\n    constructor Create; overload;\r\n    constructor Create(const Str: string; const Value: TJSONValue); overload;\r\n    constructor Create(const Str: string; const Value: string); overload;\r\n    destructor Destroy; override;\r\n    property JsonValue: TJSONValue read fjv write fjv;\r\n    property JsonString: TJSONString read fjs write fjs;\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONPairList = class(TList);\r\n\r\n  TJSONObject = class(TJSONValue)\r\n  private\r\n    fjo: TJSObject;\r\n    FMembers: TJSONPairList;\r\n    function GetPair(const I: Integer): TJSONPair;\r\n    function GetCount: Integer;\r\n    function GetItem(const Index: Integer): TJSONValue;\r\n  protected\r\n    property jo: TJSObject read fjo write fjo;\r\n    procedure AddDescendant(const Descendent: TJSONPair); virtual;\r\n    function JSONValueFromJS(const AJSValue: JSValue): TJSONValue;\r\n  public\r\n    constructor Create; overload;\r\n    constructor Create(AObject: TJSObject); overload;\r\n    destructor Destroy; override;\r\n    property JSObject: TJSObject read fjo;\r\n    class function ParseJSONValue(const data: string): TJSONValue;\r\n    function GetJSONValue(Name: string): string;\r\n    function Get(Name: string): TJSONPair; overload;\r\n    function Get(Index: Integer): TJSONPair; overload;\r\n    function GetValue(const Name: string): TJSONValue;\r\n    property Items[const Index: Integer]: TJSONValue read GetItem;\r\n    property Values[const Name: string]: TJSONValue read GetValue;\r\n    property Pairs[const Index: Integer]: TJSONPair read GetPair;\r\n    property Count: Integer read GetCount;\r\n    function AddPair(const Pair: TJSONPair): TJSONObject; overload;\r\n    function AddPair(const Str: string; const Val: TJSONValue): TJSONObject; overload;\r\n    function AddPair(const Str: string; const Val: string): TJSONObject; overload;\r\n    function AddPair(const Str: string; const Val: Integer): TJSONObject; overload;\r\n\r\n    function ToJSON: string;\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONString = class(TJSONValue)\r\n  private\r\n    FValue: string;\r\n  protected\r\n    function GetStrValue: string; override;\r\n    procedure SetStrValue(const Value: string); override;\r\n  public\r\n    constructor Create(AString: string); overload;\r\n  end;\r\n\r\n  TJSONNumber = class(TJSONString)\r\n  private\r\n    FInt: integer;\r\n    FDouble: Double;\r\n  protected\r\n    function GetStrValue: string; override;\r\n    procedure SetStrValue(const Value: string); override;\r\n  public\r\n    constructor Create(ANumber: integer); overload;\r\n    constructor Create(ANumber: double); overload;\r\n\r\n    property AsInt: integer read FInt write FInt;\r\n    property AsDouble: Double read FDouble write FDouble;\r\n    property AsFloat: Double read FDouble write FDouble;\r\n  end;\r\n\r\n  TJSONTrue = class(TJSONValue)\r\n  protected\r\n    function GetStrValue: string; override;\r\n  public\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONFalse = class(TJSONValue)\r\n  protected\r\n    function GetStrValue: string; override;\r\n  public\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONNull = class(TJSONValue)\r\n  protected\r\n    function GetStrValue: string; override;\r\n  public\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSONArray = class(TJSONObject)\r\n  private\r\n    fja: TJSArray;\r\n    function GetItem(index: integer): TJSONValue;\r\n    procedure SetItem(index: integer; const Value: TJSONValue);\r\n    function GetCount: integer; reintroduce;\r\n    function GetJA: TJSArray;\r\n  protected\r\n    property ja: TJSArray read GetJA write fja;\r\n  public\r\n    constructor Create(AArray: TJSArray); overload;\r\n    property Count: integer read GetCount;\r\n    property Items[index: integer]: TJSONValue read GetItem write SetItem; default;\r\n    procedure Add(const Element: string); overload;\r\n    procedure Add(const Element: boolean); overload;\r\n    procedure Add(const Element: integer); overload;\r\n    procedure Add(const Element: double); overload;\r\n    procedure Add(const Element: TJSONObject); overload;\r\n    procedure Add(const Element: TJSONPair); overload;\r\n\r\n    function ToString: string; override;\r\n  end;\r\n\r\n  TJSON = class(TObject)\r\n    function Parse(s: string): TJSONObject;\r\n  end;\r\n\r\n\r\nimplementation\r\n\r\n\r\nfunction JSONObjectToString(const v: JSValue): string; assembler;\r\nasm\r\n  return v+\"\";\r\nend;\r\n\r\n{ TJSON }\r\n\r\nfunction TJSON.Parse(s: string): TJSONObject;\r\nvar\r\n  O: TJSObject;\r\nbegin\r\n  O := TJSJSON.parseObject(s);\r\n\r\n  if isArray(O) then\r\n  begin\r\n    Result := TJSONArray.Create(TJSArray(O));\r\n  end\r\n  else\r\n  begin\r\n    Result := TJSONObject.Create(O);\r\n  end;\r\nend;\r\n\r\n{ TJSONArray }\r\n\r\nprocedure TJSONArray.Add(const Element: string);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: integer);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: boolean);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: TJSONObject);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: double);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nprocedure TJSONArray.Add(const Element: TJSONPair);\r\nbegin\r\n  ja.push(Element);\r\nend;\r\n\r\nconstructor TJSONArray.Create(AArray: TJSArray);\r\nbegin\r\n  inherited Create;\r\n  ja := AArray;\r\nend;\r\n\r\nfunction TJSONArray.GetCount: integer;\r\nbegin\r\n  Result := ja.Length;\r\nend;\r\n\r\nfunction TJSONArray.GetItem(index: integer): TJSONValue;\r\nvar\r\n  jv: JSValue;\r\nbegin\r\n  jv := ja[Index];\r\n  if (jv is TJSONObject) or (jv is TJSONArray) then\r\n    Result := TJSONValue(jv)\r\n  else\r\n    Result := JSONValueFromJS(jv);\r\nend;\r\n\r\nfunction TJSONArray.GetJA: TJSArray;\r\nbegin\r\n  if not Assigned(fja) then\r\n    fja := TJSArray.new;\r\n\r\n  Result := fja;\r\nend;\r\n\r\nprocedure TJSONArray.SetItem(index: integer; const Value: TJSONValue);\r\nbegin\r\n  if Value is TJSONObject then\r\n    ja[index] := TJSONObject(Value).jo;\r\nend;\r\n\r\nfunction TJSONArray.ToString: string;\r\nvar\r\n  i: integer;\r\n  jv: TJSONValue;\r\n  comma: string;\r\nbegin\r\n  Result := '[';\r\n  comma := '';\r\n\r\n  for i := 0 to Count - 1 do\r\n  begin\r\n    jv := Items[i];\r\n\r\n    if Assigned(jv) then\r\n    begin\r\n      if (jv is TJSONObject) then\r\n      begin\r\n        Result := Result + comma + (jv as TJSONObject).ToString;\r\n      end\r\n      else\r\n        Result := Result + comma + jv.ToString;\r\n\r\n      comma := ',';\r\n    end;\r\n  end;\r\n\r\n  Result := Result + ']';\r\nend;\r\n\r\n{ TJSONObject }\r\n\r\nconstructor TJSONObject.Create;\r\nbegin\r\n  inherited Create;\r\n  FMembers := TJSONPairList.Create;\r\n  fjo := nil;\r\nend;\r\n\r\nfunction TJSONObject.AddPair(const Pair: TJSONPair): TJSONObject;\r\nvar\r\n  LObj: TJSONObject;\r\nbegin\r\n  if Assigned(Pair) then\r\n  begin\r\n    AddDescendant(Pair);\r\n    LObj := TJSONObject(ParseJSONValue(ToJSON));\r\n  end;\r\n  Result := LObj;\r\nend;\r\n\r\nfunction TJSONObject.AddPair(const Str: string;\r\n  const Val: TJSONValue): TJSONObject;\r\nbegin\r\n  AddPair(TJSONPair.Create(Str, Val));\r\n  Result := Self;\r\nend;\r\n\r\nprocedure TJSONObject.AddDescendant(const Descendent: TJSONPair);\r\nbegin\r\n  FMembers.Add(Descendent);\r\nend;\r\n\r\nfunction TJSONObject.AddPair(const Str, Val: string): TJSONObject;\r\nbegin\r\n  AddPair(TJSONPair.Create(Str, Val));\r\n  Result := Self;\r\nend;\r\n\r\nfunction TJSONObject.AddPair(const Str: string; const Val: Integer): TJSONObject;\r\nbegin\r\n  AddPair(TJSONPair.Create(Str, TJSONNumber.Create(Val)));\r\n  Result := Self;\r\nend;\r\n\r\nconstructor TJSONObject.Create(AObject: TJSObject);\r\nbegin\r\n  inherited Create;\r\n  FMembers := TJSONPairList.Create;\r\n  jo := AObject;\r\nend;\r\n\r\ndestructor TJSONObject.Destroy;\r\nbegin\r\n  FMembers.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TJSONObject.Get(Index: Integer): TJSONPair;\r\nbegin\r\n  Result := Get(TJSObject.keys(jo)[Index]);\r\nend;\r\n\r\nfunction TJSONObject.Get(Name: string): TJSONPair;\r\nvar\r\n  jv: JSValue;\r\n  jsv: TJSONValue;\r\nbegin\r\n  Result := nil;\r\n  jv :=  jo.Properties[Name];\r\n\r\n  if Assigned(jv) then\r\n  begin\r\n    Result := TJSONPair.Create;\r\n    jsv := JSONValueFromJS(jv);\r\n    Result.JsonString.Value := Name;\r\n    Result.JsonValue := jsv;\r\n  end;\r\nend;\r\n\r\nfunction TJSONObject.GetCount: Integer;\r\nbegin\r\n  Result := Length(TJSObject.keys(jo));\r\nend;\r\n\r\nfunction TJSONObject.GetItem(const Index: Integer): TJSONValue;\r\nvar\r\n  jv: JSValue;\r\nbegin\r\n  jv := jo[TJSObject.keys(jo)[Index]];\r\n  Result := JSONValueFromJS(jv);\r\nend;\r\n\r\nfunction TJSONObject.GetJSONValue(Name: string): string;\r\nvar\r\n  jv: JSValue;\r\nbegin\r\n  jv :=  jo.Properties[Name];\r\n  Result := JSONObjectToString(jv);\r\nend;\r\n\r\nfunction TJSONObject.GetPair(const I: Integer): TJSONPair;\r\nbegin\r\n  if (I >= 0) and (I < FMembers.Count) then\r\n    Result := TJSONPair(FMembers[I])\r\n  else\r\n    Result := nil;\r\nend;\r\n\r\nfunction TJSONObject.GetValue(const Name: string): TJSONValue;\r\nvar\r\n  jp: TJSONPair;\r\nbegin\r\n  Result := nil;\r\n\r\n  jp := Get(Name);\r\n  if Assigned(jp) then\r\n    Result := jp.JsonValue;\r\nend;\r\n\r\nfunction TJSONObject.JSONValueFromJS(const AJSValue: JSValue): TJSONValue;\r\nbegin\r\n\r\n  Result := nil;\r\n  if isArray(AJSValue) then\r\n  begin\r\n    Result := TJSONArray.Create;\r\n    (Result as TJSONArray).ja := TJSArray(AJSValue);\r\n  end\r\n  else\r\n  if isObject(AJSValue) then\r\n  begin\r\n    Result := TJSONObject.Create;\r\n    (Result as TJSONObject).jo := TJSObject(AJSValue);\r\n  end\r\n  else\r\n  if isString(AJSValue) then\r\n  begin\r\n    Result := TJSONString.Create;\r\n    (Result as TJSONString).Value := string(AJSValue);\r\n  end\r\n  else\r\n  if isNumber(AJSValue) then\r\n  begin\r\n    Result := TJSONNumber.Create;\r\n    (Result as TJSONNumber).Value := string(AJSValue);\r\n    (Result as TJSONNumber).AsInt := integer(AJSValue);\r\n    (Result as TJSONNumber).AsDouble := double(AJSValue);\r\n  end\r\n  else\r\n  if isBoolean(AJSValue) then\r\n  begin\r\n    if toBoolean(AJSValue) then\r\n      Result := TJSONTrue.Create\r\n    else\r\n      Result := TJSONFalse.Create;\r\n  end;\r\n\r\n  if Assigned(Result) then\r\n    Result.jv := AJSValue;\r\nend;\r\n\r\nclass function TJSONObject.ParseJSONValue(const data: string): TJSONValue;\r\nvar\r\n  O: TJSObject;\r\nbegin\r\n  O := TJSJSON.parseObject(data);\r\n\r\n  if isArray(O) then\r\n  begin\r\n    Result := TJSONArray.Create;\r\n    (Result as TJSONArray).ja := TJSArray(O);\r\n  end\r\n  else if isNull(O) then\r\n    Result := TJSONNull.Create\r\n  else\r\n  begin\r\n    Result := TJSONObject.Create;\r\n    (Result as TJSONObject).jo := O;\r\n  end;\r\nend;\r\n\r\nfunction TJSONObject.ToJSON: string;\r\nvar\r\n  s: string;\r\n  Size: Integer;\r\n  I: Integer;\r\n  jp: TJSONPair;\r\nbegin\r\n  if Assigned(jo) then\r\n    Size := Count\r\n  else\r\n    Size := FMembers.Count;\r\n\r\n  if (Self is TJSONArray) then\r\n  begin\r\n    Result := (Self as TJSONArray).ToString;\r\n  end\r\n  else\r\n  begin\r\n    s := '{';\r\n    if Size > 0 then\r\n    begin\r\n      if Assigned(jo) then\r\n      begin\r\n        jp := TJSONPair(Get(0));\r\n        if Assigned(jp) then\r\n          s := s + jp.ToString\r\n      end\r\n      else\r\n        s := s + TJSONPair(FMembers[0]).ToString;\r\n    end;\r\n\r\n    for I := 1 to Size - 1 do\r\n    begin\r\n      s := s + ',';\r\n      if Assigned(jo) then\r\n      begin\r\n        jp := TJSONPair(Get(I));\r\n        if Assigned(jp) then\r\n          s := s + jp.ToString;\r\n      end\r\n      else\r\n        s := s + TJSONPair(FMembers[I]).ToString;\r\n    end;\r\n    s := s + '}';\r\n    Result := s;\r\n  end;\r\nend;\r\n\r\nfunction TJSONObject.ToString: string;\r\nbegin\r\n  Result := ToJSON;\r\nend;\r\n\r\n{ TJSONPair }\r\n\r\nconstructor TJSONPair.Create;\r\nbegin\r\n  inherited;\r\n  fjs := TJSONString.Create;\r\nend;\r\n\r\nconstructor TJSONPair.Create(const Str: string; const Value: TJSONValue);\r\nbegin\r\n  inherited Create;\r\n  JsonString := TJSONString.Create(Str);\r\n  JsonValue := Value;\r\nend;\r\n\r\nconstructor TJSONPair.Create(const Str, Value: string);\r\nbegin\r\n  inherited Create;\r\n  JsonString := TJSONString.Create(Str);\r\n  JsonValue := TJSONString.Create(Value);\r\nend;\r\n\r\ndestructor TJSONPair.Destroy;\r\nbegin\r\n  fjs.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TJSONPair.ToString: string;\r\nbegin\r\n  if (JsonValue is TJSONObject) then\r\n    Result := '\"' + JsonString.GetStrValue + '\":' + (JsonValue as TJSONObject).ToJSON\r\n  else\r\n  begin\r\n    if (JsonString <> nil) and (JsonValue <> nil) then\r\n      Result := '\"' + JsonString.GetStrValue + '\":' + JsonValue.ToString\r\n    else\r\n      Result := '';\r\n  end;\r\nend;\r\n\r\n{ TJSONAncestor }\r\n\r\nfunction TJSONAncestor.GetStrValue: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nprocedure TJSONAncestor.SetStrValue(const Value: string);\r\nbegin\r\n  //\r\nend;\r\n\r\n{ TJSONString }\r\n\r\nconstructor TJSONString.Create(AString: string);\r\nbegin\r\n  inherited Create;\r\n  jv := AString;\r\n  FValue := AString;\r\nend;\r\n\r\nfunction TJSONString.GetStrValue: string;\r\nbegin\r\n  Result := FValue;\r\nend;\r\n\r\nprocedure TJSONString.SetStrValue(const Value: string);\r\nbegin\r\n  FValue := Value;\r\nend;\r\n\r\n{ TJSONNumber }\r\n\r\nconstructor TJSONNumber.Create(ANumber: integer);\r\nbegin\r\n  inherited Create;\r\n  jv := ANumber;\r\nend;\r\n\r\nconstructor TJSONNumber.Create(ANumber: double);\r\nbegin\r\n  inherited Create;\r\n  jv := ANumber;\r\nend;\r\n\r\nfunction TJSONNumber.GetStrValue: string;\r\nbegin\r\n  Result := FloatToStr(FDouble);\r\nend;\r\n\r\nprocedure TJSONNumber.SetStrValue(const Value: string);\r\nbegin\r\n  FInt := StrToInt(Value);\r\n  FDouble := StrToFloat(Value);\r\nend;\r\n\r\n{ TJSONTrue }\r\n\r\nfunction TJSONTrue.GetStrValue: string;\r\nbegin\r\n   Result := 'true';\r\nend;\r\n\r\nfunction TJSONTrue.ToString: string;\r\nbegin\r\n  Result := GetStrValue;\r\nend;\r\n\r\n{ TJSONFalse }\r\n\r\nfunction TJSONFalse.GetStrValue: string;\r\nbegin\r\n  Result := 'false';\r\nend;\r\n\r\n\r\nfunction TJSONFalse.ToString: string;\r\nbegin\r\n  Result := GetStrValue;\r\nend;\r\n\r\n{ TJSONNull }\r\n\r\nfunction TJSONNull.GetStrValue: string;\r\nbegin\r\n  Result := 'null';\r\nend;\r\n\r\n\r\nfunction TJSONNull.ToString: string;\r\nbegin\r\n  Result := GetStrValue;\r\nend;\r\n\r\n{ TJSONValue }\r\n\r\nconstructor TJSONValue.Create(AJSValue: JSValue);\r\nbegin\r\n  inherited Create;\r\n  jv := AJSValue;\r\nend;\r\n\r\n\r\nfunction TJSONValue.ToString: string;\r\nbegin\r\n  Result := TJSJSON.stringify(jv);\r\nend;\r\n\r\nend.\r\n","unit WEBLib.Consts;\r\n\r\ninterface\r\n\r\nresourcestring\r\n  SWarning = 'Warning';\r\n  SError = 'Error';\r\n  SInformation = 'Information';\r\n  SConfirm = 'Confirm';\r\n  SOK = 'OK';\r\n  SCancel = 'Cancel';\r\n  SYes = 'Yes';\r\n  SNo = 'No';\r\n  SAbort = 'Abort';\r\n  SRetry = 'Retry';\r\n  SIgnore = 'Ignore';\r\n  SHelp = 'Help';\r\n  SClose = 'Close';\r\n  SAll = 'All';\r\n  SYesToAll = 'Yes to all';\r\n  SNoToAll = 'No to all';\r\n\r\n  SReadError = 'Stream read error';\r\n  SWriteError = 'Stream write error';\r\n  SCannotGetFile = 'Cannot get the file from the URL %s because of the error %d!';\r\n\r\n  SErrorLoadFromFile = 'There was an error during the download of the file %s!';\r\n  SLoadFromFileAborted = 'The download of the file %s was abroted!';\r\n\r\nimplementation\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            Copyright (c) 2019                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Utils;\r\n\r\ninterface\r\n\r\nuses\r\n  Types, Web, SysUtils, Classes, JS;\r\n\r\ntype\r\n  TInterfaceList = class;\r\n\r\n  Int64 = NativeInt {unimplemented}; // only 53 bits at runtime\r\n\r\n  TProc = reference to procedure;\r\n  TProcBoolean = reference to procedure(AValue: Boolean);\r\n  TProcInteger = reference to procedure(AValue: Integer);\r\n  TProcString = reference to procedure(AValue: string);\r\n\r\n  EConvertError = class(Exception);\r\n\r\n  EEncodingError = class(Exception);\r\n\r\n  EStreamError = class(Exception);\r\n  EStringStreamError = class(EStreamError);\r\n  EFilerError = class(EStreamError);\r\n  EReadError = class(EFilerError);\r\n  EWriteError = class(EFilerError);\r\n\r\n  TBytesHelper = record helper for TBytes\r\n  strict private\r\n    function get_Length: Integer;\r\n    procedure set_Length(const AValue: Integer);\r\n  public\r\n    function Compare(const ARight: TBytes): Integer;\r\n    function High: Integer;\r\n    function Low: Integer;\r\n    function SubBytes(const AStartIndex: Integer): TBytes; overload; inline;\r\n    function SubBytes(const AStartIndex, ALength: Integer): TBytes; overload; inline;\r\n    property Length: Integer read get_Length write set_Length;\r\n  end;\r\n\r\n  TWords = array of Word;\r\n  TWordsHelper = record helper for TWords\r\n  strict private\r\n    function get_Length: Integer;\r\n    procedure set_Length(const AValue: Integer);\r\n  public\r\n    class function FromBytes(const ABytes: TBytes): TWords; static;\r\n    function High: Integer;\r\n    function Low: Integer;\r\n    function ToBytes: TBytes;\r\n    property Length: Integer read get_Length write set_Length;\r\n  end;\r\n\r\n  TCharHelper = record helper for Char\r\n  public const\r\n    Length = 1;\r\n    Size = 2;\r\n  public\r\n    function ToUpper: Char; overload;\r\n    class function ToUpper(const AValue: Char): Char; overload; assembler; static;\r\n  end;\r\n\r\n  TIntegerHelper = record helper for Integer\r\n  public\r\n    function Equals(const AValue: Integer): Boolean; inline;\r\n    function NotEquals(const AValue: Integer): Boolean; inline;\r\n    function ToString: string; overload;\r\n    class function ToString(const AValue: Integer): string; overload; assembler; static;\r\n  end;\r\n\r\n  TLongIntHelper = record helper for LongInt\r\n  public\r\n    function Equals(const AValue: LongInt): Boolean; inline;\r\n    function NotEquals(const AValue: LongInt): Boolean; inline;\r\n    function ToString: string; overload;\r\n    class function ToString(const AValue: LongInt): string; overload; assembler; static;\r\n  end;\r\n\r\n  TWordHelper = record helper for Word\r\n  public\r\n    class function FromBytes(const ALow, AHigh: Byte): Word; static;\r\n    procedure ToBytes(out ALow, AHigh: Byte);\r\n  end;\r\n\r\n  TStringHelper = record helper for string\r\n  strict private\r\n    function get_Chars(const AIndex: Integer): Char; inline;\r\n    function get_Length: Integer; inline;\r\n    function Pos(const ASubStr, AStr: string; const AOffset: Integer): Integer;\r\n    function Reverse: string;\r\n    procedure set_Chars(const AIndex: Integer; const AValue: Char); inline;\r\n    procedure set_Length(const AValue: Integer); inline;\r\n  public const\r\n    Empty = '';\r\n  public\r\n    function CompareTo(const AValue: string): Integer; overload;\r\n    class function CompareTo(const ALeft, ARight: string): Integer; overload; assembler; static;\r\n    function Equals(const AValue: string): Boolean;\r\n    function FirstChar: Char;\r\n    function Format(const AArgs: array of JSValue): string; overload;\r\n    class function Format(const AValue: string; const AArgs: array of JSValue): string; overload; static;\r\n    function High: Integer; overload; inline;\r\n    function IndexOf(const AValue: Char): Integer; overload; inline;\r\n    function IndexOf(const AValue: string; const AStartIndex, ACount: Integer): Integer; overload;\r\n    function IsEmpty: Boolean; inline;\r\n    function IsNumber: Boolean;\r\n    function LastIndexOf(const AValue: Char): Integer; overload; inline;\r\n    class function Low: Integer; static; inline;\r\n    function NotEquals(const AValue: string): Boolean;\r\n    function NotIsEmpty: Boolean; inline;\r\n    function Remove(const AStartIndex: Integer): string; overload; inline;\r\n    function Remove(const AStartIndex, ACount: Integer): string; overload; inline;\r\n    function Substring(const AStartIndex: Integer): string; overload; inline;\r\n    function Substring(const AStartIndex, ALength: Integer): string; overload; inline;\r\n    function ToLower: string;\r\n    function ToUpper: string;\r\n    property Chars[const AIndex: Integer]: Char read get_Chars write set_Chars;\r\n    property Length: Integer read get_Length write set_Length;\r\n  end;\r\n\r\n  TDateTimeHelper = record helper for TDateTime\r\n  public\r\n    function Equals(const AValue: TDateTime): Boolean; inline;\r\n    function NotEquals(const AValue: TDateTime): Boolean; inline;\r\n  end;\r\n\r\n  TMonthNameArray = array[1..12] of string;\r\n  TMonthNames = TMonthNameArray;\r\n  TDayNames = array[1..7] of string;\r\n  TFormatSettings = record\r\n  strict private\r\n    class function GetBrowserLocale: string; assembler; static;\r\n    class function GetLocaleShortDayName(const ADayOfWeek: Integer; const ALocale: string): string; assembler; static;\r\n    class function GetLocaleDecimalSeparator(const ALocale: string): string; assembler; static;\r\n    class function GetLocaleLongMonthName(const AMonth: Integer; const ALocale: string): string; assembler; static;\r\n    class function GetLocaleLongDayName(const ADayOfWeek: Integer; const ALocale: string): string; assembler; static;\r\n    class function GetLocaleShortMonthName(const AMonth: Integer; const ALocale: string): string; assembler; static;\r\n    class function GetLocaleShortDateFormat(ALocale: string): string; static;\r\n  public\r\n    CurrencyDecimals: Byte;\r\n    CurrencyFormat: Byte;\r\n    CurrencyString: string;\r\n    DateSeparator: Char;\r\n    DateTimeToStrFormat: array[Boolean] of string;\r\n    DecimalSeparator: string;\r\n    LongDateFormat: string;\r\n    LongDayNames: TDayNames;\r\n    LongMonthNames: TMonthNames;\r\n    LongTimeFormat: string;\r\n    NegCurrFormat: Byte;\r\n    ShortDateFormat: string;\r\n    ShortDayNames: TDayNames;\r\n    ShortMonthNames: TMonthNames;\r\n    ShortTimeFormat: string;\r\n    ThousandSeparator: string;\r\n    TimeAMString: string;\r\n    TimePMString: string;\r\n    TimeSeparator: Char;\r\n    TwoDigitYearCenturyWindow: Word;\r\n  public\r\n    class function Create: TFormatSettings; overload; static;\r\n    class function Create(const ALocale: string): TFormatSettings; overload; static;\r\n  end;\r\n\r\n  TEncoding = class(TObject)\r\n  strict private class var\r\n    FANSI: TEncoding;\r\n    FUnicode: TEncoding;\r\n  strict private\r\n    class function get_ANSI: TEncoding; static;\r\n    class function get_Default: TEncoding; static;\r\n    class function get_Unicode: TEncoding; static;\r\n  public\r\n    function GetByteCount(const AChars: string): Integer; overload; virtual; abstract;\r\n    function GetByteCount(const AChars: string; const ACharCount: Integer): Integer; overload;\r\n    function GetByteCount(const AChars: string; const ACharIndex, ACharCount: Integer): Integer; overload; inline;\r\n    function GetBytes(const AChars: string): TBytes; overload; virtual; abstract;\r\n    function GetBytes(const AChars: string; const ACharCount: Integer): TBytes; overload;\r\n    function GetBytes(const AChars: string; const ACharIndex, ACharCount: Integer): TBytes; overload; inline;\r\n    function GetString(const ABytes: TBytes): string; overload; virtual; abstract;\r\n    function GetString(const ABytes: TBytes; const ACharCount: Integer): string; overload;\r\n    function GetString(const ABytes: TBytes; const ACharIndex, ACharCount: Integer): string; overload; inline;\r\n    class function IsStandardEncoding(AEncoding: TEncoding): Boolean; static;\r\n    class property ANSI: TEncoding read get_ANSI;\r\n    class property Default: TEncoding read get_Default;\r\n    class property Unicode: TEncoding read get_Unicode;\r\n  end;\r\n\r\n  TANSIEncoding = class(TEncoding)\r\n  public\r\n    function GetByteCount(const AChars: string): Integer; overload; override;\r\n    function GetBytes(const AChars: string): TBytes; overload; override;\r\n    function GetString(const ABytes: TBytes): string; overload; override;\r\n  end;\r\n\r\n  TUnicodeEncoding = class(TEncoding)\r\n  strict private\r\n    procedure InternalGetBytes(const AChars: string; out ABytes: TBytes);\r\n  public\r\n    function GetByteCount(const AChars: string): Integer; overload; override;\r\n    function GetBytes(const AChars: string): TBytes; overload; override;\r\n    function GetString(const ABytes: TBytes): string; overload; override;\r\n  end;\r\n\r\n  TStream = class(TObject)\r\n  private\r\n    FPosition: Int64;\r\n    FSize: Int64;\r\n  protected\r\n    procedure set_Size(const ANewSize: Int64); virtual;\r\n  public\r\n    function CopyFrom(const ASource: TStream; ACount: Int64): Int64;\r\n    function Read(var ABuffer: TBytes; const ACount: Longint): Longint; overload;\r\n    function Read(var ABuffer: TBytes; const AOffset, ACount: Longint): Longint; overload; virtual;\r\n    procedure ReadBuffer(var ABuffer: TBytes; const ACount: NativeInt); overload;\r\n    procedure ReadBuffer(var Buffer: TBytes; const AOffset, ACount: NativeInt); overload;\r\n    function Write(const ABuffer: TBytes; const ACount: Longint): Longint; overload; virtual;\r\n    function Write(const ABuffer: TBytes; const AOffset, ACount: Longint): Longint; overload;\r\n    procedure WriteBuffer(const ABuffer: TBytes; const ACount: NativeInt); overload;\r\n    procedure WriteBuffer(const Buffer: TBytes; Offset, Count: NativeInt); overload;\r\n    property Position: Int64 read FPosition write FPosition;\r\n    property Size: Int64 read FSize write set_Size;\r\n  end;\r\n\r\n  TCustomMemoryStream = class(TStream)\r\n  private\r\n    FBytes: TBytes;\r\n    FCapacity: NativeInt;\r\n    procedure set_Capacity(const ANewCapacity: NativeInt);\r\n  protected\r\n    procedure set_Size(const ANewSize: Int64); override;\r\n    property Capacity: NativeInt read FCapacity write set_Capacity;\r\n  public\r\n    procedure Clear;\r\n    procedure LoadFromStream(const AStream: TStream);\r\n    function Read(var ABuffer: TBytes; const AOffset, ACount: Longint): Longint; overload; override;\r\n    procedure SaveToStream(const AStream: TStream);\r\n    function Write(const ABuffer: TBytes; const ACount: Longint): Longint; overload; override;\r\n    property Bytes: TBytes read FBytes;\r\n  end;\r\n\r\n  TMemoryStream = class(TCustomMemoryStream)\r\n  end;\r\n\r\n  TBytesStream = class(TMemoryStream)\r\n  end;\r\n\r\n  TStringStream = class(TBytesStream)\r\n  private\r\n    FEncoding: TEncoding;\r\n    FFileName: string;\r\n    FOwnsEncoding: Boolean;\r\n    FError: TProcString;\r\n    FLoaded: TProc;\r\n    FRequest: TJSXMLHTTPRequest;\r\n    function GetDataString: string;\r\n    function OnAbort(AEvent: TEventListenerEvent): Boolean;\r\n    function OnError(AEvent: TEventListenerEvent): Boolean;\r\n    function OnLoad(AEvent: TEventListenerEvent): Boolean;\r\n  public\r\n    constructor Create; overload;\r\n    constructor Create(const AString: string); overload;\r\n    constructor Create(const AString: string; AEncoding: TEncoding; AOwnsEncoding: Boolean = True); overload;\r\n    destructor Destroy; override;\r\n    procedure LoadFromFile(const AFileName: string); overload;\r\n    procedure LoadFromFile(const AFileName: string; const ALoaded: TProc); overload;\r\n    procedure LoadFromFile(const AFileName: string; const ALoaded: TProc; const AError: TProcString); overload;\r\n    function ReadString(ACount: Integer): string;\r\n    procedure WriteString(const AString: string);\r\n    property DataString: string read GetDataString;\r\n  end;\r\n\r\n  IInterfaceList = interface\r\n  ['{285DEA8A-B865-11D1-AAA7-00C04FB17A72}']\r\n    function Add(const AItem: IInterface): Integer;\r\n    procedure Clear;\r\n    procedure Delete(const AIndex: Integer);\r\n    procedure Exchange(const AIndex1, AIndex2: Integer);\r\n    function Expand: TInterfaceList;\r\n    function First: IInterface;\r\n    function get_Capacity: Integer;\r\n    function get_Count: Integer;\r\n    function get_Items(const AIndex: Integer): IInterface;\r\n    function IndexOf(const AItem: IInterface): Integer;\r\n    function IndexOfItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\n    procedure Insert(const AIndex: Integer; const AItem: IInterface);\r\n    function Last: IInterface;\r\n    procedure Lock;\r\n    function Remove(const AItem: IInterface): Integer;\r\n    function RemoveItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\n    procedure set_Capacity(const AValue: Integer);\r\n    procedure set_Count(const AValue: Integer);\r\n    procedure set_Items(const AIndex: Integer; const AItem: IInterface);\r\n    procedure Unlock;\r\n    property Count: Integer read get_Count write set_Count;\r\n    property Items[const AIndex: Integer]: IInterface read get_Items write set_Items; default;\r\n  end;\r\n\r\n  TInterfaceListEnumerator = class(TObject)\r\n  strict private\r\n    FIndex: Integer;\r\n    FInterfaceList: TInterfaceList;\r\n    function get_Current: IInterface; inline;\r\n  public\r\n    constructor Create(const AInterfaceList: TInterfaceList);\r\n    function MoveNext: Boolean;\r\n    property Current: IInterface read get_Current;\r\n  end;\r\n\r\n  IInterfaceListEx = interface(IInterfaceList)\r\n    ['{FDB39D70-65B9-4995-9436-6084ACA05DB3}']\r\n    function GetEnumerator: TInterfaceListEnumerator;\r\n  end;\r\n\r\n  TInterfaceList = class(TInterfacedObject, IInterfaceList, IInterfaceListEx)\r\n  strict private\r\n    FList: TFPList;\r\n  strict protected\r\n    function Add(const AItem: IInterface): Integer;\r\n    procedure Clear;\r\n    procedure Delete(const AIndex: Integer);\r\n    procedure Exchange(const AIndex1, AIndex2: Integer);\r\n    function Expand: TInterfaceList;\r\n    function First: IInterface;\r\n    function GetEnumerator: TInterfaceListEnumerator;\r\n    function get_Capacity: Integer;\r\n    function get_Count: Integer;\r\n    function get_Items(const AIndex: Integer): IInterface;\r\n    function IndexOf(const AItem: IInterface): Integer;\r\n    function IndexOfItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\n    procedure Insert(const AIndex: Integer; const AItem: IInterface);\r\n    function Last: IInterface;\r\n    procedure Lock;\r\n    function Remove(const AItem: IInterface): Integer;\r\n    function RemoveItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\n    procedure set_Capacity(const AValue: Integer);\r\n    procedure set_Count(const AValue: Integer);\r\n    procedure set_Items(const AIndex: Integer; const AItem: IInterface);\r\n    procedure Unlock;\r\n    property Capacity: Integer read get_Capacity write set_Capacity;\r\n    property Items[const AIndex: Integer]: IInterface read get_Items write set_Items; default;\r\n  protected\r\n    property Count: Integer read get_Count write set_Count;\r\n  public\r\n    constructor Create;\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TPath = record\r\n  public\r\n    class function Combine(const APath1, APath2: string): string; static;\r\n    class function GetDirectoryName(const AFileName: string): string; static;\r\n  end;\r\n\r\n  TDirectory = record\r\n  public\r\n    class function GetCurrentDirectory: string; static;\r\n  end;\r\n\r\nfunction DateTimeToStr(const ADateTime: TDateTime; const AFormatSettings: TFormatSettings; const AForceTimeIfZero: Boolean = False): string;\r\nfunction FormatDateTime(const AFormatStr: string; const AFormatSettings: TFormatSettings; const ADateTime: TDateTime): string;\r\n\r\nprocedure UseVariable(const AValue: IInterface); overload;\r\nprocedure UseVariable(const AValue: Integer); overload;\r\nprocedure UseVariable(const AValue: string); overload;\r\n\r\nvar\r\n  FormatSettings: TFormatSettings;\r\n\r\nimplementation\r\n\r\nuses\r\n  Math, WEBLib.Consts;\r\n\r\ntype\r\n  TFormatDateTimeHelper = record\r\n  strict private\r\n    class procedure StoreFormat(var AResult: string; var AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek: Word; const AFormatStr: string; const AFormatSettings: TFormatSettings; const ADateTime: TDateTime; ANesting: Integer; ATimeFlag: Boolean); static;\r\n    class procedure StoreInt(var AResult: string; const AValue, ADigits: Integer); static;\r\n    class procedure StoreStr(var AResult: string; const AFormatStr: string; const APos, ALength: Integer); static;\r\n    class procedure StoreString(var AResult: string; const AString: string); static;\r\n  public\r\n    class function FormatDateTime(const AFormatStr: string; const AFormatSettings: TFormatSettings; const ADateTime: TDateTime): string; static;\r\n  end;\r\n\r\nfunction DateTimeToStr(const ADateTime: TDateTime; const AFormatSettings: TFormatSettings; const AForceTimeIfZero: Boolean = False): string;\r\nbegin\r\n  Result := FormatDateTime(AFormatSettings.DateTimeToStrFormat[AForceTimeIfZero], AFormatSettings, ADateTime);\r\nend;\r\n\r\nfunction FormatDateTime(const AFormatStr: string; const AFormatSettings: TFormatSettings; const ADateTime: TDateTime): string;\r\nbegin\r\n  Result := TFormatDateTimeHelper.FormatDateTime(AFormatStr, AFormatSettings, ADateTime);\r\nend;\r\n\r\nprocedure UseVariable(const AValue: IInterface);\r\nbegin\r\nend;\r\n\r\nprocedure UseVariable(const AValue: Integer);\r\nbegin\r\nend;\r\n\r\nprocedure UseVariable(const AValue: string);\r\nbegin\r\nend;\r\n\r\n{ TBytesHelper }\r\n\r\nfunction TBytesHelper.Compare(const ARight: TBytes): Integer;\r\nvar\r\n  lCount: Integer;\r\nbegin\r\n  if Length > ARight.Length then\r\n    Exit(GreaterThanValue);\r\n\r\n  if Length < ARight.Length then\r\n    Exit(LessThanValue);\r\n\r\n  Result := EqualsValue;\r\n  for lCount := Low to High do\r\n  begin\r\n    if Self[lCount] > ARight[lCount] then\r\n      Exit(GreaterThanValue);\r\n    if Self[lCount] < ARight[lCount] then\r\n      Exit(LessThanValue);\r\n  end;\r\nend;\r\n\r\nfunction TBytesHelper.get_Length: Integer;\r\nbegin\r\n  Result := System.Length(Self);\r\nend;\r\n\r\nfunction TBytesHelper.High: Integer;\r\nbegin\r\n  Result := System.High(Self);\r\nend;\r\n\r\nfunction TBytesHelper.Low: Integer;\r\nbegin\r\n  Result := System.Low(Self);\r\nend;\r\n\r\nprocedure TBytesHelper.set_Length(const AValue: Integer);\r\nbegin\r\n  System.SetLength(Self, AValue);\r\nend;\r\n\r\nfunction TBytesHelper.SubBytes(const AStartIndex: Integer): TBytes;\r\nbegin\r\n  Result := System.Copy(Self, AStartIndex, Length);\r\nend;\r\n\r\nfunction TBytesHelper.SubBytes(const AStartIndex, ALength: Integer): TBytes;\r\nbegin\r\n  Result := System.Copy(Self, AStartIndex, ALength);\r\nend;\r\n\r\n{ TWordsHelper }\r\n\r\nclass function TWordsHelper.FromBytes(const ABytes: TBytes): TWords;\r\nconst\r\n  cBytesPerWord = 2;\r\nvar\r\n  lCount: Integer;\r\n  lLow: Byte;\r\n  lHigh: Byte;\r\nbegin\r\n  lCount := ABytes.Length;\r\n  if Odd(lCount) then\r\n    Inc(lCount);\r\n  Result.Length := lCount div cBytesPerWord;\r\n\r\n  lCount := ABytes.Low;\r\n  while lCount <= ABytes.High do\r\n  begin\r\n    lLow := ABytes[lCount];\r\n    if lCount + 1 <= ABytes.High then\r\n      lHigh := ABytes[lCount + 1]\r\n    else\r\n      lHigh := 0;\r\n\r\n    Result[lCount div cBytesPerWord] := Word.FromBytes(lLow, lHigh);\r\n    Inc(lCount, cBytesPerWord);\r\n  end;\r\n\r\nend;\r\n\r\nfunction TWordsHelper.get_Length: Integer;\r\nbegin\r\n  Result := System.Length(Self);\r\nend;\r\n\r\nfunction TWordsHelper.High: Integer;\r\nbegin\r\n  Result := System.High(Self);\r\nend;\r\n\r\nfunction TWordsHelper.Low: Integer;\r\nbegin\r\n  Result := System.Low(Self);\r\nend;\r\n\r\nprocedure TWordsHelper.set_Length(const AValue: Integer);\r\nbegin\r\n  System.SetLength(Self, AValue);\r\nend;\r\n\r\nfunction TWordsHelper.ToBytes: TBytes;\r\nconst\r\n  cBytesPerWord = 2;\r\nvar\r\n  lLow: Byte;\r\n  lHigh: Byte;\r\n  lCount: Integer;\r\n  lNewIndex: Integer;\r\nbegin\r\n  Result.Length := Length * cBytesPerWord;\r\n  for lCount := Low to High do\r\n  begin\r\n    Self[lCount].ToBytes(lLow, lHigh);\r\n    lNewIndex := lCount * cBytesPerWord;\r\n    Result[lNewIndex] := lLow;\r\n    Result[lNewIndex + 1] := lHigh;\r\n  end;\r\nend;\r\n\r\n{ TCharHelper }\r\n\r\nfunction TCharHelper.ToUpper: Char;\r\nbegin\r\n  Result := ToUpper(Self);\r\nend;\r\n\r\nclass function TCharHelper.ToUpper(const AValue: Char): Char; assembler;\r\nasm\r\n  return AValue.toUpperCase();\r\nend;\r\n\r\n{ TIntegerHelper }\r\n\r\nfunction TIntegerHelper.Equals(const AValue: Integer): Boolean;\r\nbegin\r\n  Result := Self = AValue;\r\nend;\r\n\r\nfunction TIntegerHelper.NotEquals(const AValue: Integer): Boolean;\r\nbegin\r\n  Result := not Equals(AValue);\r\nend;\r\n\r\nfunction TIntegerHelper.ToString: string;\r\nbegin\r\n  Result := ToString(Self);\r\nend;\r\n\r\nclass function TIntegerHelper.ToString(const AValue: Integer): string; assembler;\r\nasm\r\n  return AValue.toString();\r\nend;\r\n\r\n{ TLongIntHelper }\r\n\r\nfunction TLongIntHelper.Equals(const AValue: LongInt): Boolean;\r\nbegin\r\n  Result := Self = AValue;\r\nend;\r\n\r\nfunction TLongIntHelper.NotEquals(const AValue: LongInt): Boolean;\r\nbegin\r\n  Result := not Equals(AValue);\r\nend;\r\n\r\nfunction TLongIntHelper.ToString: string;\r\nbegin\r\n  Result := ToString(Self);\r\nend;\r\n\r\nclass function TLongIntHelper.ToString(const AValue: LongInt): string;\r\nasm\r\n  return AValue.toString();\r\nend;\r\n\r\n{ TWordHelper }\r\n\r\nclass function TWordHelper.FromBytes(const ALow, AHigh: Byte): Word;\r\nconst\r\n  cMask: Byte = $FF;\r\n  cBitPerByte = 8;\r\nbegin\r\n  Result := ALow + (AHigh and (cMask shl cBitPerByte));\r\nend;\r\n\r\nprocedure TWordHelper.ToBytes(out ALow, AHigh: Byte);\r\nconst\r\n  cMask: Byte = $FF;\r\n  cBitPerByte = 8;\r\nbegin\r\n  ALow := Self and cMask;\r\n  AHigh := Self and (cMask shl cBitPerByte);\r\nend;\r\n\r\n{ TStringHelper }\r\n\r\nfunction TStringHelper.CompareTo(const AValue: string): Integer;\r\nbegin\r\n  Result := CompareTo(Self, AValue);\r\nend;\r\n\r\nclass function TStringHelper.CompareTo(const ALeft, ARight: string): Integer; assembler;\r\nasm\r\n  return ALeft.localeCompare(ARight);\r\nend;\r\n\r\nfunction TStringHelper.Equals(const AValue: string): Boolean;\r\nbegin\r\n  Result := Self = AValue;\r\nend;\r\n\r\nfunction TStringHelper.FirstChar: Char;\r\nbegin\r\n  if NotIsEmpty then\r\n    Result := Chars[0]\r\n  else\r\n    Result := #0;\r\nend;\r\n\r\nfunction TStringHelper.Format(const AArgs: array of JSValue): string;\r\nbegin\r\n  Result := SysUtils.Format(Self, AArgs);\r\nend;\r\n\r\nclass function TStringHelper.Format(const AValue: string; const AArgs: array of JSValue): string;\r\nbegin\r\n  Result := SysUtils.Format(AValue, AArgs);\r\nend;\r\n\r\nfunction TStringHelper.get_Chars(const AIndex: Integer): Char;\r\nbegin\r\n  Result := Self[AIndex + 1];\r\nend;\r\n\r\nfunction TStringHelper.get_Length: Integer;\r\nbegin\r\n  Result := System.Length(Self);\r\nend;\r\n\r\nfunction TStringHelper.High: Integer;\r\nbegin\r\n  Result := Length - 1;\r\nend;\r\n\r\nfunction TStringHelper.IndexOf(const AValue: Char): Integer;\r\nbegin\r\n  Result := Pos(AValue, Self, 1) - 1;\r\nend;\r\n\r\nfunction TStringHelper.IndexOf(const AValue: string; const AStartIndex, ACount: Integer): Integer;\r\nbegin\r\n  Result := Pos(AValue, Self, AStartIndex + 1) - 1;\r\n  if (Result + AValue.Length) > (AStartIndex + ACount) then\r\n    Result := -1;\r\nend;\r\n\r\nfunction TStringHelper.IsEmpty: Boolean;\r\nbegin\r\n  Result := Self = Empty;\r\nend;\r\n\r\nfunction TStringHelper.IsNumber: Boolean;\r\nconst\r\n  cNumbers = ['0'..'9'];\r\nvar\r\n  lCount: Integer;\r\nbegin\r\n  if IsEmpty then\r\n    Exit(False);\r\n\r\n  for lCount := 0 to Length - 1 do\r\n  begin\r\n    if not (Chars[lCount] in cNumbers) then\r\n      Exit(False);\r\n  end;\r\n  Result := True;\r\nend;\r\n\r\nfunction TStringHelper.LastIndexOf(const AValue: Char): Integer;\r\nbegin\r\n  Result := Reverse.IndexOf(AValue);\r\n  if Result >= 0 then\r\n    Result := Length - Result - 1;\r\nend;\r\n\r\nclass function TStringHelper.Low: Integer;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TStringHelper.NotEquals(const AValue: string): Boolean;\r\nbegin\r\n  Result := not Equals(AValue);\r\nend;\r\n\r\nfunction TStringHelper.NotIsEmpty: Boolean;\r\nbegin\r\n  Result := Self <> Empty;\r\nend;\r\n\r\nfunction TStringHelper.Pos(const ASubStr, AStr: string; const AOffset: Integer): Integer;\r\nasm\r\n  return AStr.indexOf(ASubStr, AOffset - 1) + 1;\r\nend;\r\n\r\nfunction TStringHelper.Remove(const AStartIndex: Integer): string;\r\nbegin\r\n  Result := Remove(AStartIndex, 1);\r\nend;\r\n\r\nfunction TStringHelper.Remove(const AStartIndex, ACount: Integer): string;\r\nbegin\r\n  Result := SubString(0, AStartIndex - 1) + SubString(AStartIndex + ACount);\r\nend;\r\n\r\nfunction TStringHelper.Reverse: string;\r\nvar\r\n  lCount: Integer;\r\nbegin\r\n  Result := Empty;\r\n  Result.Length := Length;\r\n  for lCount := 0 to Length - 1 do\r\n    Result.Chars[Length - lCount - 1] := Self.Chars[lCount];\r\nend;\r\n\r\nprocedure TStringHelper.set_Chars(const AIndex: Integer; const AValue: Char);\r\nbegin\r\n  Self[AIndex + 1] := AValue;\r\nend;\r\n\r\nprocedure TStringHelper.set_Length(const AValue: Integer);\r\nbegin\r\n  System.SetLength(Self, AValue);\r\nend;\r\n\r\nfunction TStringHelper.Substring(const AStartIndex: Integer): string;\r\nbegin\r\n  Result := System.Copy(Self, AStartIndex + 1, Self.Length);\r\nend;\r\n\r\nfunction TStringHelper.Substring(const AStartIndex, ALength: Integer): string;\r\nbegin\r\n  Result := System.Copy(Self, AStartIndex + 1, ALength);\r\nend;\r\n\r\nfunction TStringHelper.ToLower: string;\r\nvar\r\n  lValue: string;\r\nbegin\r\n  lValue := Self;\r\n  asm\r\n    lValue = lValue.toLowerCase();\r\n  end;\r\n  Result := lValue;\r\nend;\r\n\r\nfunction TStringHelper.ToUpper: string;\r\nvar\r\n  lValue: string;\r\nbegin\r\n  lValue := Self;\r\n  asm\r\n    lValue = lValue.toUpperCase();\r\n  end;\r\n  Result := lValue;\r\nend;\r\n\r\n{ TDateTimeHelper }\r\n\r\nfunction TDateTimeHelper.Equals(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result := SameValue(Self, AValue);\r\nend;\r\n\r\nfunction TDateTimeHelper.NotEquals(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result := not SameValue(Self, AValue);\r\nend;\r\n\r\n{ TFormatSettings }\r\n\r\nclass function TFormatSettings.Create: TFormatSettings;\r\nbegin\r\n  Result := Create(GetBrowserLocale);\r\nend;\r\n\r\nclass function TFormatSettings.Create(const ALocale: string): TFormatSettings;\r\nconst\r\n  cDateSeps: array of Char = ['/', '.', '-'];\r\n  cTimeSeps: array of Char = [':', '.', '-'];\r\n  cDecSeps: array of Char = [',', '.'];\r\n  cThousandSeps: array of Char = ['.', ','];\r\nvar\r\n  lTimeStr: string;\r\n  lCount: Integer;\r\nbegin\r\n  Result.LongDayNames[1] := 'Sunday';\r\n  Result.LongDayNames[2] := 'Monday';\r\n  Result.LongDayNames[3] := 'Tuesday';\r\n  Result.LongDayNames[4] := 'Wednesday';\r\n  Result.LongDayNames[5] := 'Thursday';\r\n  Result.LongDayNames[6] := 'Friday';\r\n  Result.LongDayNames[7] := 'Saturday';\r\n  Result.ShortDayNames[1] := 'Sun';\r\n  Result.ShortDayNames[2] := 'Mon';\r\n  Result.ShortDayNames[3] := 'Tue';\r\n  Result.ShortDayNames[4] := 'Wed';\r\n  Result.ShortDayNames[5] := 'Thu';\r\n  Result.ShortDayNames[6] := 'Fri';\r\n  Result.ShortDayNames[7] := 'Sat';\r\n  Result.ShortMonthNames[1] := 'Jan';\r\n  Result.ShortMonthNames[2] := 'Feb';\r\n  Result.ShortMonthNames[3] := 'Mar';\r\n  Result.ShortMonthNames[4] := 'Apr';\r\n  Result.ShortMonthNames[5] := 'May';\r\n  Result.ShortMonthNames[6] := 'Jun';\r\n  Result.ShortMonthNames[7] := 'Jul';\r\n  Result.ShortMonthNames[8] := 'Aug';\r\n  Result.ShortMonthNames[9] := 'Sep';\r\n  Result.ShortMonthNames[10] := 'Oct';\r\n  Result.ShortMonthNames[11] := 'Nov';\r\n  Result.ShortMonthNames[12] := 'Dec';\r\n  Result.LongMonthNames[1] := 'January';\r\n  Result.LongMonthNames[2] := 'February';\r\n  Result.LongMonthNames[3] := 'March';\r\n  Result.LongMonthNames[4] := 'April';\r\n  Result.LongMonthNames[5] := 'May';\r\n  Result.LongMonthNames[6] := 'June';\r\n  Result.LongMonthNames[7] := 'July';\r\n  Result.LongMonthNames[8] := 'August';\r\n  Result.LongMonthNames[9] := 'September';\r\n  Result.LongMonthNames[10] := 'October';\r\n  Result.LongMonthNames[11] := 'November';\r\n  Result.LongMonthNames[12] := 'December';\r\n  Result.DateTimeToStrFormat[False] := 'c';\r\n  Result.DateTimeToStrFormat[True] := 'f';\r\n  Result.DateSeparator := '-';\r\n  Result.TimeSeparator := ':';\r\n  Result.ShortDateFormat := 'yyyy-mm-dd';\r\n  Result.LongDateFormat := 'ddd, yyyy-mm-dd';\r\n  Result.ShortTimeFormat := 'hh:nn';\r\n  Result.LongTimeFormat := 'hh:nn:ss';\r\n  Result.DecimalSeparator := '.';\r\n  Result.ThousandSeparator := ',';\r\n  Result.TimeAMString := 'AM';\r\n  Result.TimePMString := 'PM';\r\n  Result.TwoDigitYearCenturyWindow := 50;\r\n\r\n  Result.ShortDateFormat := GetLocaleShortDateFormat(ALocale);\r\n\r\n  for lCount := Low(cDateSeps) to High(cDateSeps) do\r\n  begin\r\n    if Result.ShortDateFormat.IndexOf(cDateSeps[lCount]) >= 0 then\r\n      Result.DateSeparator := cDateSeps[lCount];\r\n  end;\r\n\r\n  asm\r\n    var lEvent = new Date('Jan 1, 1980 06:07:08 GMT+00:00');\r\n    var lLoc = \"\";\r\n    if (ALocale == \"\")\r\n      lLoc = navigator.language;\r\n    else\r\n      lLoc = ALocale;\r\n    lTimeStr = lEvent.toLocaleTimeString(lLoc);\r\n  end;\r\n\r\n  for lCount := Low(cTimeSeps) to High(cTimeSeps) do\r\n  begin\r\n    if lTimeStr.IndexOf(cTimeSeps[lCount]) >= 0 then\r\n      Result.TimeSeparator := cTimeSeps[lCount];\r\n  end;\r\n\r\n  for lCount := Low(Result.ShortDayNames) to High(Result.ShortDayNames) do\r\n    Result.ShortDayNames[lCount] := GetLocaleShortDayName(lCount, ALocale);\r\n  for lCount := Low(Result.LongDayNames) to High(Result.LongDayNames) do\r\n    Result.LongDayNames[lCount] := GetLocaleLongDayName(lCount, ALocale);\r\n\r\n  for lCount := Low(Result.ShortMonthNames) to High(Result.ShortMonthNames) do\r\n    Result.ShortMonthNames[lCount] := GetLocaleShortMonthName(lCount, ALocale);\r\n  for lCount := Low(Result.LongMonthNames) to High(Result.LongMonthNames) do\r\n    Result.LongMonthNames[lCount] := GetLocaleLongMonthName(lCount, ALocale);\r\n\r\n  Result.DecimalSeparator := GetLocaleDecimalSeparator(ALocale);\r\n\r\n  for lCount := Low(cDecSeps) to High(cDecSeps) do\r\n  begin\r\n    if Result.DecimalSeparator = cDecSeps[lCount] then\r\n    begin\r\n      Result.ThousandSeparator := cThousandSeps[lCount];\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TFormatSettings.GetBrowserLocale: string;\r\nasm\r\n  return navigator.language;\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleDecimalSeparator(const ALocale: string): string; assembler;\r\nasm\r\n  var lNumber = 1.1;\r\n  lNumber = lNumber.toLocaleString(ALocale).substring(1, 2);\r\n  return lNumber;\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleLongDayName(const ADayOfWeek: Integer; const ALocale: string): string; assembler;\r\nasm\r\n  var lBaseDate = new Date(2017, 0, 1); // Sunday\r\n  lBaseDate.setDate(lBaseDate.getDate() + ADayOfWeek - 1);\r\n  return lBaseDate.toLocaleDateString(ALocale, { weekday: 'long' });\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleLongMonthName(const AMonth: Integer; const ALocale: string): string; assembler;\r\nasm\r\n  var lBaseDate = new Date(2017, AMonth - 1, 1);\r\n  return lBaseDate.toLocaleDateString(ALocale, { AMonth: 'long' });\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleShortDateFormat(ALocale: string): string;\r\nconst\r\n  cDeli = '-';\r\n  cShortLength = 2;\r\nvar\r\n  lIndex: Integer;\r\nbegin\r\n  Result := string.Empty;\r\n\r\n  ALocale := ALocale.ToLower;\r\n\r\n  lIndex := ALocale.IndexOf(cDeli);\r\n\r\n  if lIndex >= 0 then\r\n    // ensure the first part is lowercase, second part is uppercase\r\n    ALocale := ALocale.SubString(0, lIndex) + ALocale.SubString(lIndex).ToUpper\r\n  else\r\n  begin\r\n    // when the locale is the main locale specifier only without country\r\n    if ALocale.Length = cShortLength then\r\n      ALocale := ALocale + cDeli + ALocale.ToUpper;\r\n  end;\r\n\r\n  asm\r\n    var lFormats = {\r\n      \"ar-SA\" : \"dd/MM/yy\",\r\n      \"bg-BG\" : \"dd.M.yyyy\",\r\n      \"ca-ES\" : \"dd/MM/yyyy\",\r\n      \"zh-TW\" : \"yyyy/M/d\",\r\n      \"cs-CZ\" : \"d.M.yyyy\",\r\n      \"da-DK\" : \"dd-MM-yyyy\",\r\n      \"de-DE\" : \"dd.MM.yyyy\",\r\n      \"el-GR\" : \"d/M/yyyy\",\r\n      \"en-US\" : \"M/d/yyyy\",\r\n      \"fi-FI\" : \"d.M.yyyy\",\r\n      \"fr-FR\" : \"dd/MM/yyyy\",\r\n      \"he-IL\" : \"dd/MM/yyyy\",\r\n      \"hu-HU\" : \"yyyy. MM. dd.\",\r\n      \"is-IS\" : \"d.M.yyyy\",\r\n      \"it-IT\" : \"dd/MM/yyyy\",\r\n      \"ja-JP\" : \"yyyy/MM/dd\",\r\n      \"ko-KR\" : \"yyyy-MM-dd\",\r\n      \"nl-NL\" : \"d-M-yyyy\",\r\n      \"nb-NO\" : \"dd.MM.yyyy\",\r\n      \"pl-PL\" : \"yyyy-MM-dd\",\r\n      \"pt-BR\" : \"d/M/yyyy\",\r\n      \"ro-RO\" : \"dd.MM.yyyy\",\r\n      \"ru-RU\" : \"dd.MM.yyyy\",\r\n      \"hr-HR\" : \"d.M.yyyy\",\r\n      \"sk-SK\" : \"d. M. yyyy\",\r\n      \"sq-AL\" : \"yyyy-MM-dd\",\r\n      \"sv-SE\" : \"yyyy-MM-dd\",\r\n      \"th-TH\" : \"d/M/yyyy\",\r\n      \"tr-TR\" : \"dd.MM.yyyy\",\r\n      \"ur-PK\" : \"dd/MM/yyyy\",\r\n      \"id-ID\" : \"dd/MM/yyyy\",\r\n      \"uk-UA\" : \"dd.MM.yyyy\",\r\n      \"be-BY\" : \"dd.MM.yyyy\",\r\n      \"sl-SI\" : \"d.M.yyyy\",\r\n      \"et-EE\" : \"d.MM.yyyy\",\r\n      \"lv-LV\" : \"yyyy.MM.dd.\",\r\n      \"lt-LT\" : \"yyyy.MM.dd\",\r\n      \"fa-IR\" : \"MM/dd/yyyy\",\r\n      \"vi-VN\" : \"dd/MM/yyyy\",\r\n      \"hy-AM\" : \"dd.MM.yyyy\",\r\n      \"az-Latn-AZ\" : \"dd.MM.yyyy\",\r\n      \"eu-ES\" : \"yyyy/MM/dd\",\r\n      \"mk-MK\" : \"dd.MM.yyyy\",\r\n      \"af-ZA\" : \"yyyy/MM/dd\",\r\n      \"ka-GE\" : \"dd.MM.yyyy\",\r\n      \"fo-FO\" : \"dd-MM-yyyy\",\r\n      \"hi-IN\" : \"dd-MM-yyyy\",\r\n      \"ms-MY\" : \"dd/MM/yyyy\",\r\n      \"kk-KZ\" : \"dd.MM.yyyy\",\r\n      \"ky-KG\" : \"dd.MM.yy\",\r\n      \"sw-KE\" : \"M/d/yyyy\",\r\n      \"uz-Latn-UZ\" : \"dd/MM yyyy\",\r\n      \"tt-RU\" : \"dd.MM.yyyy\",\r\n      \"pa-IN\" : \"dd-MM-yy\",\r\n      \"gu-IN\" : \"dd-MM-yy\",\r\n      \"ta-IN\" : \"dd-MM-yyyy\",\r\n      \"te-IN\" : \"dd-MM-yy\",\r\n      \"kn-IN\" : \"dd-MM-yy\",\r\n      \"mr-IN\" : \"dd-MM-yyyy\",\r\n      \"sa-IN\" : \"dd-MM-yyyy\",\r\n      \"mn-MN\" : \"yy.MM.dd\",\r\n      \"gl-ES\" : \"dd/MM/yy\",\r\n      \"kok-IN\" : \"dd-MM-yyyy\",\r\n      \"syr-SY\" : \"dd/MM/yyyy\",\r\n      \"dv-MV\" : \"dd/MM/yy\",\r\n      \"ar-IQ\" : \"dd/MM/yyyy\",\r\n      \"zh-CN\" : \"yyyy/M/d\",\r\n      \"de-CH\" : \"dd.MM.yyyy\",\r\n      \"en-GB\" : \"dd/MM/yyyy\",\r\n      \"es-MX\" : \"dd/MM/yyyy\",\r\n      \"fr-BE\" : \"d/MM/yyyy\",\r\n      \"it-CH\" : \"dd.MM.yyyy\",\r\n      \"nl-BE\" : \"d/MM/yyyy\",\r\n      \"nn-NO\" : \"dd.MM.yyyy\",\r\n      \"pt-PT\" : \"dd-MM-yyyy\",\r\n      \"sr-Latn-CS\" : \"d.M.yyyy\",\r\n      \"sv-FI\" : \"d.M.yyyy\",\r\n      \"az-Cyrl-AZ\" : \"dd.MM.yyyy\",\r\n      \"ms-BN\" : \"dd/MM/yyyy\",\r\n      \"uz-Cyrl-UZ\" : \"dd.MM.yyyy\",\r\n      \"ar-EG\" : \"dd/MM/yyyy\",\r\n      \"zh-HK\" : \"d/M/yyyy\",\r\n      \"de-AT\" : \"dd.MM.yyyy\",\r\n      \"en-AU\" : \"d/MM/yyyy\",\r\n      \"es-ES\" : \"dd/MM/yyyy\",\r\n      \"fr-CA\" : \"yyyy-MM-dd\",\r\n      \"sr-Cyrl-CS\" : \"d.M.yyyy\",\r\n      \"ar-LY\" : \"dd/MM/yyyy\",\r\n      \"zh-SG\" : \"d/M/yyyy\",\r\n      \"de-LU\" : \"dd.MM.yyyy\",\r\n      \"en-CA\" : \"dd/MM/yyyy\",\r\n      \"es-GT\" : \"dd/MM/yyyy\",\r\n      \"fr-CH\" : \"dd.MM.yyyy\",\r\n      \"ar-DZ\" : \"dd-MM-yyyy\",\r\n      \"zh-MO\" : \"d/M/yyyy\",\r\n      \"de-LI\" : \"dd.MM.yyyy\",\r\n      \"en-NZ\" : \"d/MM/yyyy\",\r\n      \"es-CR\" : \"dd/MM/yyyy\",\r\n      \"fr-LU\" : \"dd/MM/yyyy\",\r\n      \"ar-MA\" : \"dd-MM-yyyy\",\r\n      \"en-IE\" : \"dd/MM/yyyy\",\r\n      \"es-PA\" : \"MM/dd/yyyy\",\r\n      \"fr-MC\" : \"dd/MM/yyyy\",\r\n      \"ar-TN\" : \"dd-MM-yyyy\",\r\n      \"en-ZA\" : \"yyyy/MM/dd\",\r\n      \"es-DO\" : \"dd/MM/yyyy\",\r\n      \"ar-OM\" : \"dd/MM/yyyy\",\r\n      \"en-JM\" : \"dd/MM/yyyy\",\r\n      \"es-VE\" : \"dd/MM/yyyy\",\r\n      \"ar-YE\" : \"dd/MM/yyyy\",\r\n      \"en-029\" : \"MM/dd/yyyy\",\r\n      \"es-CO\" : \"dd/MM/yyyy\",\r\n      \"ar-SY\" : \"dd/MM/yyyy\",\r\n      \"en-BZ\" : \"dd/MM/yyyy\",\r\n      \"es-PE\" : \"dd/MM/yyyy\",\r\n      \"ar-JO\" : \"dd/MM/yyyy\",\r\n      \"en-TT\" : \"dd/MM/yyyy\",\r\n      \"es-AR\" : \"dd/MM/yyyy\",\r\n      \"ar-LB\" : \"dd/MM/yyyy\",\r\n      \"en-ZW\" : \"M/d/yyyy\",\r\n      \"es-EC\" : \"dd/MM/yyyy\",\r\n      \"ar-KW\" : \"dd/MM/yyyy\",\r\n      \"en-PH\" : \"M/d/yyyy\",\r\n      \"es-CL\" : \"dd-MM-yyyy\",\r\n      \"ar-AE\" : \"dd/MM/yyyy\",\r\n      \"es-UY\" : \"dd/MM/yyyy\",\r\n      \"ar-BH\" : \"dd/MM/yyyy\",\r\n      \"es-PY\" : \"dd/MM/yyyy\",\r\n      \"ar-QA\" : \"dd/MM/yyyy\",\r\n      \"es-BO\" : \"dd/MM/yyyy\",\r\n      \"es-SV\" : \"dd/MM/yyyy\",\r\n      \"es-HN\" : \"dd/MM/yyyy\",\r\n      \"es-NI\" : \"dd/MM/yyyy\",\r\n      \"es-PR\" : \"dd/MM/yyyy\",\r\n      \"am-ET\" : \"d/M/yyyy\",\r\n      \"tzm-Latn-DZ\" : \"dd-MM-yyyy\",\r\n      \"iu-Latn-CA\" : \"d/MM/yyyy\",\r\n      \"sma-NO\" : \"dd.MM.yyyy\",\r\n      \"mn-Mong-CN\" : \"yyyy/M/d\",\r\n      \"gd-GB\" : \"dd/MM/yyyy\",\r\n      \"en-MY\" : \"d/M/yyyy\",\r\n      \"prs-AF\" : \"dd/MM/yy\",\r\n      \"bn-BD\" : \"dd-MM-yy\",\r\n      \"wo-SN\" : \"dd/MM/yyyy\",\r\n      \"rw-RW\" : \"M/d/yyyy\",\r\n      \"qut-GT\" : \"dd/MM/yyyy\",\r\n      \"sah-RU\" : \"MM.dd.yyyy\",\r\n      \"gsw-FR\" : \"dd/MM/yyyy\",\r\n      \"co-FR\" : \"dd/MM/yyyy\",\r\n      \"oc-FR\" : \"dd/MM/yyyy\",\r\n      \"mi-NZ\" : \"dd/MM/yyyy\",\r\n      \"ga-IE\" : \"dd/MM/yyyy\",\r\n      \"se-SE\" : \"yyyy-MM-dd\",\r\n      \"br-FR\" : \"dd/MM/yyyy\",\r\n      \"smn-FI\" : \"d.M.yyyy\",\r\n      \"moh-CA\" : \"M/d/yyyy\",\r\n      \"arn-CL\" : \"dd-MM-yyyy\",\r\n      \"ii-CN\" : \"yyyy/M/d\",\r\n      \"dsb-DE\" : \"d. M. yyyy\",\r\n      \"ig-NG\" : \"d/M/yyyy\",\r\n      \"kl-GL\" : \"dd-MM-yyyy\",\r\n      \"lb-LU\" : \"dd/MM/yyyy\",\r\n      \"ba-RU\" : \"dd.MM.yy\",\r\n      \"nso-ZA\" : \"yyyy/MM/dd\",\r\n      \"quz-BO\" : \"dd/MM/yyyy\",\r\n      \"yo-NG\" : \"d/M/yyyy\",\r\n      \"ha-Latn-NG\" : \"d/M/yyyy\",\r\n      \"fil-PH\" : \"M/d/yyyy\",\r\n      \"ps-AF\" : \"dd/MM/yy\",\r\n      \"fy-NL\" : \"d-M-yyyy\",\r\n      \"ne-NP\" : \"M/d/yyyy\",\r\n      \"se-NO\" : \"dd.MM.yyyy\",\r\n      \"iu-Cans-CA\" : \"d/M/yyyy\",\r\n      \"sr-Latn-RS\" : \"d.M.yyyy\",\r\n      \"si-LK\" : \"yyyy-MM-dd\",\r\n      \"sr-Cyrl-RS\" : \"d.M.yyyy\",\r\n      \"lo-LA\" : \"dd/MM/yyyy\",\r\n      \"km-KH\" : \"yyyy-MM-dd\",\r\n      \"cy-GB\" : \"dd/MM/yyyy\",\r\n      \"bo-CN\" : \"yyyy/M/d\",\r\n      \"sms-FI\" : \"d.M.yyyy\",\r\n      \"as-IN\" : \"dd-MM-yyyy\",\r\n      \"ml-IN\" : \"dd-MM-yy\",\r\n      \"en-IN\" : \"dd-MM-yyyy\",\r\n      \"or-IN\" : \"dd-MM-yy\",\r\n      \"bn-IN\" : \"dd-MM-yy\",\r\n      \"tk-TM\" : \"dd.MM.yy\",\r\n      \"bs-Latn-BA\" : \"d.M.yyyy\",\r\n      \"mt-MT\" : \"dd/MM/yyyy\",\r\n      \"sr-Cyrl-ME\" : \"d.M.yyyy\",\r\n      \"se-FI\" : \"d.M.yyyy\",\r\n      \"zu-ZA\" : \"yyyy/MM/dd\",\r\n      \"xh-ZA\" : \"yyyy/MM/dd\",\r\n      \"tn-ZA\" : \"yyyy/MM/dd\",\r\n      \"hsb-DE\" : \"d. M. yyyy\",\r\n      \"bs-Cyrl-BA\" : \"d.M.yyyy\",\r\n      \"tg-Cyrl-TJ\" : \"dd.MM.yy\",\r\n      \"sr-Latn-BA\" : \"d.M.yyyy\",\r\n      \"smj-NO\" : \"dd.MM.yyyy\",\r\n      \"rm-CH\" : \"dd/MM/yyyy\",\r\n      \"smj-SE\" : \"yyyy-MM-dd\",\r\n      \"quz-EC\" : \"dd/MM/yyyy\",\r\n      \"quz-PE\" : \"dd/MM/yyyy\",\r\n      \"hr-BA\" : \"d.M.yyyy.\",\r\n      \"sr-Latn-ME\" : \"d.M.yyyy\",\r\n      \"sma-SE\" : \"yyyy-MM-dd\",\r\n      \"en-SG\" : \"d/M/yyyy\",\r\n      \"ug-CN\" : \"yyyy-M-d\",\r\n      \"sr-Cyrl-BA\" : \"d.M.yyyy\",\r\n      \"es-US\" : \"M/d/yyyy\"};\r\n    return lFormats[ALocale] || 'dd/MM/yyyy';\r\n  end;\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleShortDayName(const ADayOfWeek: Integer; const ALocale: string): string; assembler;\r\nasm\r\n  var lBaseDate = new Date(2017, 0, 1); // Sunday\r\n  lBaseDate.setDate(lBaseDate.getDate() + ADayOfWeek - 1);\r\n\r\n  var lLoc = \"\";\r\n  if (ALocale == '')\r\n    lLoc = navigator.language\r\n  else\r\n    lLoc = ALocale;\r\n\r\n  return lBaseDate.toLocaleDateString(lLoc, { weekday: 'short' });\r\nend;\r\n\r\nclass function TFormatSettings.GetLocaleShortMonthName(const AMonth: Integer; const ALocale: string): string; assembler;\r\nasm\r\n  var lBaseDate = new Date(2017, AMonth - 1, 1);\r\n  var lLoc = \"\";\r\n  if (ALocale == '')\r\n    lLoc = navigator.language\r\n  else\r\n    lLoc = ALocale;\r\n  return lBaseDate.toLocaleDateString(lLoc, { AMonth: 'short' });\r\nend;\r\n\r\n{ TFormatDateTimeHelper }\r\n\r\nclass function TFormatDateTimeHelper.FormatDateTime(const AFormatStr: string; const AFormatSettings: TFormatSettings; const ADateTime: TDateTime): string;\r\nvar\r\n  lYear: Word;\r\n  lMonth: Word;\r\n  lDay: Word;\r\n  lDayOfWeek: Word;\r\n  lHour: Word;\r\n  lMinute: Word;\r\n  lSecond: Word;\r\n  lMilliSecond: Word;\r\nbegin\r\n  Result := '';\r\n  DecodeDateFully(ADateTime, lYear, lMonth, lDay, lDayOfWeek);\r\n  DecodeTime(ADateTime, lHour, lMinute, lSecond, lMilliSecond);\r\n  // Writeln(DateTime,'->',lYear,',', lMonth, ',',lDay, ',',lDayOfWeek,',',lHour, ',',lMinute, ',',lSecond, ',',lMilliSecond);\r\n  if AFormatStr <> '' then\r\n    StoreFormat(Result, lYear, lMonth, lDay, lHour, lMinute, lSecond, lMilliSecond, lDayOfWeek, AFormatStr, AFormatSettings, ADateTime, 0, False)\r\n  else\r\n    StoreFormat(Result, lYear, lMonth, lDay, lHour, lMinute, lSecond, lMilliSecond, lDayOfWeek, 'C', AFormatSettings, ADateTime, 0, False);\r\nend;\r\n\r\nclass procedure TFormatDateTimeHelper.StoreFormat(var AResult: string; var AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek: Word; const AFormatStr: string; const AFormatSettings: TFormatSettings; const ADateTime: TDateTime; ANesting: Integer; ATimeFlag: Boolean);\r\nconst\r\n  cAMPMFormat1 = 'A/P';\r\n  cAMPMFormat2 = 'AMPM';\r\n  cAMPMFormat3 = 'AM/PM';\r\nvar\r\n  lToken: Char;\r\n  lLastFormatToken: Char;\r\n  lPrevLastToken: Char;\r\n  lCount: Integer;\r\n  lClock12: Boolean;\r\n  lBuffer: Integer;\r\n  lIsInterval: Boolean;\r\n  lTemp: Integer;\r\n  lFormatCurrent: Integer;\r\n  lFormatEnd: Integer;\r\nbegin\r\n  if ANesting > 1 then  // 0 is original string, 1 is included FormatString\r\n    Exit;\r\n  lFormatCurrent := 1;\r\n  lFormatEnd := AFormatStr.Length;\r\n  lClock12 := False;\r\n  lIsInterval := False;\r\n  // look for unquoted 12-hour clock lToken\r\n  lTemp := 1;\r\n  while lTemp <= lFormatEnd do\r\n    begin\r\n    lToken := AFormatStr[lTemp];\r\n    case lToken of\r\n      '''', '\"':\r\n      begin\r\n        Inc(lTemp);\r\n        while (lTemp < lFormatEnd) and (AFormatStr[lTemp] <> lToken) do\r\n          Inc(lTemp);\r\n      end;\r\n      'A', 'a':\r\n      begin\r\n        if cAMPMFormat1.Equals(AFormatStr.Substring(lTemp - 1, cAMPMFormat1.Length))\r\n          or cAMPMFormat2.Equals(AFormatStr.Substring(lTemp - 1, cAMPMFormat2.Length))\r\n          or cAMPMFormat3.Equals(AFormatStr.Substring(lTemp - 1, cAMPMFormat3.Length))then\r\n        begin\r\n          lClock12 := True;\r\n          Break;\r\n        end;\r\n      end;\r\n    end;  // case\r\n    Inc(lTemp);\r\n  end ;\r\n  lToken := #255;\r\n  lLastFormatToken := ' ';\r\n  lPrevLastToken := 'H';\r\n  while lFormatCurrent <= lFormatEnd do\r\n  begin\r\n    lToken := AFormatStr[lFormatCurrent];\r\n    lToken := lToken.ToUpper;\r\n   //  Writeln('Treating token at pos ',lFormatCurrent,', : ',lToken,' (',AFormatStr,')');\r\n    lCount := 1;\r\n    lTemp := lFormatCurrent + 1;\r\n    case lToken of\r\n      '''', '\"':\r\n      begin\r\n        while (lTemp < lFormatEnd) and (AFormatStr[lTemp] <> lToken) do\r\n          Inc(lTemp);\r\n        Inc(lTemp);\r\n        lCount := lTemp - lFormatCurrent;\r\n        StoreStr(AResult, AFormatStr, lFormatCurrent + 1, lCount - 2);\r\n      end ;\r\n      'A':\r\n      begin\r\n        if cAMPMFormat2.Equals(AFormatStr.Substring(lFormatCurrent - 1, cAMPMFormat2.Length)) then\r\n        begin\r\n          lCount := 4;\r\n          if AHour < 12 then\r\n            StoreString(AResult, AFormatSettings.TimeAMString)\r\n          else\r\n            StoreString(AResult, AFormatSettings.TimePMString);\r\n        end\r\n        else if cAMPMFormat3.Equals(AFormatStr.Substring(lFormatCurrent - 1, cAMPMFormat3.Length)) then\r\n        begin\r\n          lCount := 5;\r\n          if AHour < 12 then\r\n            StoreStr(AResult, AFormatStr, lFormatCurrent, 2)\r\n          else\r\n            StoreStr(AResult, AFormatStr, lFormatCurrent + 3, 2);\r\n        end\r\n        else if cAMPMFormat1.Equals(AFormatStr.Substring(lFormatCurrent - 1, cAMPMFormat1.Length)) then\r\n        begin\r\n          lCount := 3;\r\n          if AHour < 12 then\r\n            StoreStr(AResult, AFormatStr, lFormatCurrent, 1)\r\n          else\r\n            StoreStr(AResult, AFormatStr, lFormatCurrent + 2, 1);\r\n        end\r\n        else\r\n          raise EConvertError.Create('Illegal character in format string');\r\n      end ;\r\n      '/':\r\n      begin\r\n        //  Writeln('Detected date separator');\r\n        StoreString(AResult, AFormatSettings.DateSeparator);\r\n      end;\r\n      ':': StoreString(AResult, AFormatSettings.TimeSeparator);\r\n      ' ', 'C', 'D', 'H', 'M', 'N', 'S', 'T', 'Y', 'Z', 'F' :\r\n      begin\r\n        // Writeln(lFormatCurrent,' Special Token: ',lToken,', Count: ',lCount,', P: ',lTemp);\r\n        while (lTemp <= lFormatEnd) and (AFormatStr.Chars[lTemp - 1].ToUpper = lToken) do\r\n          Inc(lTemp);\r\n        lCount := lTemp - lFormatCurrent;\r\n        // Writeln(lFormatCurrent,' Special Token: ',lToken,', Count: ',lCount,', P: ',lTemp);\r\n        case lToken of\r\n          ' ': StoreStr(AResult, AFormatStr, lFormatCurrent, lCount);\r\n          'Y': begin\r\n            if lCount > 2 then\r\n              StoreInt(AResult, AYear, 4)\r\n            else\r\n              StoreInt(AResult, AYear mod 100, 2);\r\n          end;\r\n          'M': begin\r\n      if lIsInterval and ((lPrevLastToken = 'H') or ATimeFlag) then\r\n        StoreInt(AResult, AMinute + (AHour + Trunc(Abs(ADateTime))*24)*60, 0)\r\n      else\r\n            if (lLastFormatToken = 'H') or ATimeFlag then\r\n            begin\r\n              if lCount = 1 then\r\n                StoreInt(AResult, AMinute, 0)\r\n              else\r\n                StoreInt(AResult, AMinute, 2);\r\n            end\r\n            else\r\n            begin\r\n              case lCount of\r\n                1: StoreInt(AResult, AMonth, 0);\r\n                2: StoreInt(AResult, AMonth, 2);\r\n                3: StoreString(AResult, AFormatSettings.ShortMonthNames[AMonth]);\r\n              else\r\n                StoreString(AResult, AFormatSettings.LongMonthNames[AMonth]);\r\n              end;\r\n            end;\r\n          end;\r\n          'D': begin\r\n            case lCount of\r\n              1: StoreInt(AResult, ADay, 0);\r\n              2: StoreInt(AResult, ADay, 2);\r\n              3: StoreString(AResult, AFormatSettings.ShortDayNames[ADayOfWeek]);\r\n              4: StoreString(AResult, AFormatSettings.LongDayNames[ADayOfWeek]);\r\n              5: StoreFormat(AResult, AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek, AFormatSettings.ShortDateFormat, AFormatSettings, ADateTime, ANesting + 1, False);\r\n            else\r\n              StoreFormat(AResult, AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek, AFormatSettings.LongDateFormat, AFormatSettings, ADateTime, ANesting + 1, False);\r\n            end ;\r\n          end ;\r\n          'H':\r\n      if lIsInterval then\r\n        StoreInt(AResult, AHour + Trunc(Abs(ADateTime))*24, 0)\r\n      else\r\n      if lClock12 then\r\n            begin\r\n              lBuffer := AHour mod 12;\r\n              if lBuffer=0 then lBuffer:=12;\r\n              if lCount = 1 then\r\n                StoreInt(AResult, lBuffer, 0)\r\n              else\r\n                StoreInt(AResult, lBuffer, 2);\r\n            end\r\n            else begin\r\n              if lCount = 1 then\r\n                StoreInt(AResult, AHour, 0)\r\n              else\r\n                StoreInt(AResult, AHour, 2);\r\n            end;\r\n          'N': if lIsInterval then\r\n           StoreInt(AResult, AMinute + (AHour + Trunc(Abs(ADateTime))*24)*60, 0)\r\n   else\r\n   if lCount = 1 then\r\n                 StoreInt(AResult, AMinute, 0)\r\n               else\r\n                 StoreInt(AResult, AMinute, 2);\r\n          'S': if lIsInterval then\r\n           StoreInt(AResult, ASecond + (AMinute + (AHour + Trunc(Abs(ADateTime))*24)*60)*60, 0)\r\n         else\r\n         if lCount = 1 then\r\n                 StoreInt(AResult, ASecond, 0)\r\n               else\r\n                 StoreInt(AResult, ASecond, 2);\r\n          'Z': if lCount = 1 then\r\n                 StoreInt(AResult, AMilliSecond, 0)\r\n               else\r\n                 StoreInt(AResult, AMilliSecond, 3);\r\n          'T': if lCount = 1 then\r\n                 StoreFormat(AResult, AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek, AFormatSettings.ShortTimeFormat, AFormatSettings, ADateTime, ANesting + 1, True)\r\n               else\r\n                 StoreFormat(AResult, AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek, AFormatSettings.LongTimeFormat, AFormatSettings, ADateTime, ANesting + 1, True);\r\n          'C': begin\r\n                 StoreFormat(AResult, AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek, AFormatSettings.ShortDateFormat, AFormatSettings, ADateTime, ANesting + 1, False);\r\n                 if (AHour <> 0) or (AMinute <> 0) or (ASecond <> 0) then\r\n                   begin\r\n                    StoreString(AResult, ' ');\r\n                    StoreFormat(AResult, AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek, AFormatSettings.LongTimeFormat, AFormatSettings, ADateTime, ANesting + 1, True);\r\n                   end;\r\n               end;\r\n          'F': begin\r\n                 StoreFormat(AResult, AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek, AFormatSettings.ShortDateFormat, AFormatSettings, ADateTime, ANesting + 1, False);\r\n                 StoreString(AResult, ' ');\r\n                 StoreFormat(AResult, AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond, ADayOfWeek, AFormatSettings.LongTimeFormat, AFormatSettings, ADateTime, ANesting + 1, True);\r\n               end;\r\n        end;\r\n        lPrevLastToken := lLastFormatToken;\r\n        lLastFormatToken := lToken;\r\n      end;\r\n      else\r\n        StoreString(AResult, lToken);\r\n    end;\r\n    Inc(lFormatCurrent, lCount);\r\n  end;\r\nend;\r\n\r\nclass procedure TFormatDateTimeHelper.StoreInt(var AResult: string; const AValue, ADigits: Integer);\r\nconst\r\n  cFillChar = '0';\r\nvar\r\n  lBuffer: string;\r\nbegin\r\n  lBuffer := AValue.ToString;\r\n  while (lBuffer.Length < ADigits) do\r\n    lBuffer := cFillChar + lBuffer;\r\n  StoreString(AResult, lBuffer);\r\nend;\r\n\r\nclass procedure TFormatDateTimeHelper.StoreStr(var AResult: string; const AFormatStr: string; const APos, ALength: Integer);\r\nbegin\r\n  AResult := AResult + Copy(AFormatStr, APos, ALength);\r\nend;\r\n\r\nclass procedure TFormatDateTimeHelper.StoreString(var AResult: string; const AString: string);\r\nbegin\r\n  AResult := AResult + AString;\r\nend;\r\n\r\n{ TEncoding }\r\n\r\nfunction TEncoding.GetByteCount(const AChars: string; const ACharCount: Integer): Integer;\r\nbegin\r\n  Result := GetByteCount(AChars.Substring(0, ACharCount));\r\nend;\r\n\r\nfunction TEncoding.GetByteCount(const AChars: string; const ACharIndex, ACharCount: Integer): Integer;\r\nbegin\r\n  Result := GetByteCount(AChars.Substring(ACharIndex, ACharCount));\r\nend;\r\n\r\nfunction TEncoding.GetBytes(const AChars: string; const ACharCount: Integer): TBytes;\r\nbegin\r\n  Result := GetBytes(AChars.Substring(0, ACharCount));\r\nend;\r\n\r\nfunction TEncoding.GetBytes(const AChars: string; const ACharIndex, ACharCount: Integer): TBytes;\r\nbegin\r\n  Result := GetBytes(AChars.Substring(ACharIndex, ACharCount));\r\nend;\r\n\r\nfunction TEncoding.GetString(const ABytes: TBytes; const ACharCount: Integer): string;\r\nbegin\r\n  Result := GetString(ABytes.SubBytes(0, ACharCount));\r\nend;\r\n\r\nfunction TEncoding.GetString(const ABytes: TBytes; const ACharIndex, ACharCount: Integer): string;\r\nbegin\r\n  Result := GetString(ABytes.SubBytes(ACharIndex, ACharCount));\r\nend;\r\n\r\nclass function TEncoding.get_ANSI: TEncoding;\r\nbegin\r\n  if FANSI = nil then\r\n    FANSI := TANSIEncoding.Create;\r\n  Result := FANSI;\r\nend;\r\n\r\nclass function TEncoding.get_Default: TEncoding;\r\nbegin\r\n  Result := ANSI;\r\nend;\r\n\r\nclass function TEncoding.get_Unicode: TEncoding;\r\nbegin\r\n  if FUnicode = nil then\r\n    FUnicode := TUnicodeEncoding.Create;\r\n  Result := FUnicode;\r\nend;\r\n\r\nclass function TEncoding.IsStandardEncoding(AEncoding: TEncoding): Boolean;\r\nbegin\r\n  Result := (AEncoding <> nil) and ((AEncoding = FANSI) or (AEncoding = FUnicode));\r\nend;\r\n\r\n{ TANSIEncoding }\r\n\r\nfunction TANSIEncoding.GetByteCount(const AChars: string): Integer;\r\nbegin\r\n  Result := AChars.Length;\r\nend;\r\n\r\nfunction TANSIEncoding.GetBytes(const AChars: string): TBytes;\r\nbegin\r\n  Result := BytesOf(AChars);\r\nend;\r\n\r\nfunction TANSIEncoding.GetString(const ABytes: TBytes): string;\r\nbegin\r\n  Result := StringOf(ABytes);\r\nend;\r\n\r\n{ TUnicodeEncoding }\r\n\r\nfunction TUnicodeEncoding.GetByteCount(const AChars: string): Integer;\r\nbegin\r\n  Result := Char.Size * AChars.Length;\r\nend;\r\n\r\nfunction TUnicodeEncoding.GetBytes(const AChars: string): TBytes;\r\nbegin\r\n  InternalGetBytes(AChars, Result);\r\nend;\r\n\r\nfunction TUnicodeEncoding.GetString(const ABytes: TBytes): string;\r\nvar\r\n  lWords: TWords;\r\n  lBuffer: string;\r\nbegin\r\n  lBuffer := string.Empty;\r\n  lWords := TWords.FromBytes(ABytes);\r\n  if lWords <> nil then\r\n  begin\r\n    asm\r\n      for (var lCount = 0; lCount < lWords.length; lCount++)\r\n        lBuffer += String.fromCharCode(lWords[lCount]);\r\n    end;\r\n  end;\r\n  Result := lBuffer;\r\nend;\r\n\r\nprocedure TUnicodeEncoding.InternalGetBytes(const AChars: string; out ABytes: TBytes);\r\nvar\r\n  lWords: TWords;\r\nbegin\r\n  lWords := nil;\r\n  asm\r\n    for (var lCount = 0; lCount < AChars.length; lCount++)\r\n      lWords.push(AChars.charCodeAt(lCount));\r\n  end;\r\n  ABytes := lWords.ToBytes;\r\nend;\r\n\r\n{ TStream }\r\n\r\nfunction TStream.CopyFrom(const ASource: TStream; ACount: Int64): Int64;\r\nconst\r\n  MaxBufSize = $F000;\r\nvar\r\n  lBufSize: Integer;\r\n  lCount: Integer;\r\n  lBuffer: TBytes;\r\nbegin\r\n  if ACount <= 0 then\r\n  begin\r\n    ASource.Position := 0;\r\n    ACount := ASource.Size;\r\n  end;\r\n  Result := ACount;\r\n  if ACount > MaxBufSize then\r\n    lBufSize := MaxBufSize\r\n  else\r\n    lBufSize := ACount;\r\n  lBuffer.Length := lBufSize;\r\n  try\r\n    while ACount <> 0 do\r\n    begin\r\n      if ACount > lBufSize then\r\n        lCount := lBufSize\r\n      else\r\n        lCount := ACount;\r\n      ASource.ReadBuffer(lBuffer, lCount);\r\n      WriteBuffer(lBuffer, lCount);\r\n      Dec(ACount, lCount);\r\n    end;\r\n  finally\r\n    lBuffer.Length := 0;\r\n  end;\r\nend;\r\n\r\nfunction TStream.Read(var ABuffer: TBytes; const ACount: Longint): Longint;\r\nbegin\r\n  Result := Read(ABuffer, 0, ACount);\r\nend;\r\n\r\nfunction TStream.Read(var ABuffer: TBytes; const AOffset, ACount: Longint): Longint;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nprocedure TStream.ReadBuffer(var ABuffer: TBytes; const ACount: NativeInt);\r\nbegin\r\n  ReadBuffer(ABuffer, 0, ACount);\r\nend;\r\n\r\nprocedure TStream.ReadBuffer(var Buffer: TBytes; const AOffset, ACount: NativeInt);\r\nvar\r\n  lTotalCount,\r\n  lReadCount: NativeInt;\r\nbegin\r\n  lTotalCount := Read(Buffer, AOffset, ACount);\r\n  if lTotalCount < 0 then\r\n    raise EReadError.Create(SReadError);\r\n\r\n  while (lTotalCount < ACount) do\r\n  begin\r\n    { Try to read a contiguous block of <ACount> size }\r\n    lReadCount := Read(Buffer, AOffset + lTotalCount, (ACount - lTotalCount));\r\n\r\n    { Check if we read something and decrease the number of bytes left to read }\r\n    if lReadCount <= 0 then\r\n      raise EReadError.Create(SReadError)\r\n    else\r\n      Inc(lTotalCount, lReadCount);\r\n  end\r\nend;\r\n\r\nprocedure TStream.set_Size(const ANewSize: Int64);\r\nbegin\r\nend;\r\n\r\nfunction TStream.Write(const ABuffer: TBytes; const ACount: Longint): Longint;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TStream.Write(const ABuffer: TBytes; const AOffset, ACount: Longint): Longint;\r\nvar\r\n  lBytes: TBytes;\r\n  lCount: Integer;\r\nbegin\r\n  Result := 0;\r\n  if ABuffer.Length - AOffset > 0 then\r\n  begin\r\n    lBytes.Length := ABuffer.Length - AOffset;\r\n    for lCount := AOffset to ABuffer.Length - 1 do\r\n      lBytes[lCount - AOffset] := ABuffer[lCount];\r\n\r\n    Result := Write(lBytes, ACount);\r\n  end;\r\nend;\r\n\r\nprocedure TStream.WriteBuffer(const ABuffer: TBytes; const ACount: NativeInt);\r\nbegin\r\n  WriteBuffer(ABuffer, 0, ACount);\r\nend;\r\n\r\nprocedure TStream.WriteBuffer(const Buffer: TBytes; Offset, Count: NativeInt);\r\nvar\r\n  lTotalCount,\r\n  lWrittenCount: NativeInt;\r\nbegin\r\n  lTotalCount := Write(Buffer, Offset, Count);\r\n  if lTotalCount < 0 then\r\n    raise EWriteError.Create(SWriteError);\r\n\r\n  while lTotalCount < Count do\r\n  begin\r\n    lWrittenCount := Write(Buffer, Offset + lTotalCount, (Count - lTotalCount));\r\n\r\n    if lWrittenCount <= 0 then\r\n      raise EWriteError.Create(SWriteError)\r\n    else\r\n      Inc(lTotalCount, lWrittenCount);\r\n  end;\r\nend;\r\n\r\n{ TCustomMemoryStream }\r\n\r\nprocedure TCustomMemoryStream.Clear;\r\nbegin\r\n  FBytes.Length := 0;\r\n  FCapacity := 0;\r\n  FPosition := 0;\r\nend;\r\n\r\nprocedure TCustomMemoryStream.LoadFromStream(const AStream: TStream);\r\nvar\r\n  lCount: Int64;\r\nbegin\r\n  AStream.Position := 0;\r\n  lCount := AStream.Size;\r\n  Size := lCount;\r\n  if lCount <> 0 then\r\n    AStream.ReadBuffer(FBytes, lCount);\r\nend;\r\n\r\nfunction TCustomMemoryStream.Read(var ABuffer: TBytes; const AOffset, ACount: Longint): Longint;\r\nvar\r\n  lCount: Integer;\r\nbegin\r\n  if (FPosition >= 0) and (ACount >= 0) then\r\n  begin\r\n    if FSize > FPosition then\r\n    begin\r\n      if FSize > ACount + FPosition then\r\n        Result := ACount\r\n      else\r\n        Result := FSize - FPosition;\r\n\r\n      ABuffer.Length := Min(Size, ACount);\r\n\r\n      for lCount := AOffset + FPosition to Min(Size - 1, AOffset + FPosition + ACount - 1) do\r\n        ABuffer[lCount - AOffset - FPosition] := FBytes[lCount];\r\n\r\n      Inc(FPosition, Result);\r\n      Exit;\r\n    end;\r\n  end;\r\n  Result := 0;\r\nend;\r\n\r\nprocedure TCustomMemoryStream.SaveToStream(const AStream: TStream);\r\nbegin\r\n  if FSize > 0 then\r\n    AStream.WriteBuffer(FBytes, FSize);\r\nend;\r\n\r\nprocedure TCustomMemoryStream.set_Capacity(const ANewCapacity: NativeInt);\r\nbegin\r\n  FBytes.Length := ANewCapacity;\r\n  FCapacity := ANewCapacity;\r\nend;\r\n\r\nprocedure TCustomMemoryStream.set_Size(const ANewSize: Int64);\r\nvar\r\n  lOldPosition: Longint;\r\nbegin\r\n  lOldPosition := FPosition;\r\n  Capacity := ANewSize;\r\n  FSize := ANewSize;\r\n  if lOldPosition > ANewSize then\r\n    Position := ANewSize;\r\nend;\r\n\r\nfunction TCustomMemoryStream.Write(const ABuffer: TBytes; const ACount: Longint): Longint;\r\nvar\r\n  lPos: Int64;\r\n  lCount: Integer;\r\nbegin\r\n  if (FPosition >= 0) and (ACount >= 0) then\r\n  begin\r\n    lPos := FPosition + ACount;\r\n    if lPos > 0 then\r\n    begin\r\n      if lPos > FSize then\r\n      begin\r\n        if lPos > FCapacity then\r\n          Capacity := lPos;\r\n        FSize := lPos;\r\n      end;\r\n\r\n      for lCount := 0 to ABuffer.Length - 1 do\r\n        FBytes[FPosition + lCount] := ABuffer[lCount];\r\n\r\n      FPosition := lPos;\r\n      Result := ACount;\r\n      Exit;\r\n    end;\r\n  end;\r\n  Result := 0;\r\nend;\r\n\r\n{ TStringStream }\r\n\r\nconstructor TStringStream.Create;\r\nbegin\r\n  Create(string.Empty, TEncoding.Default, False);\r\nend;\r\n\r\nconstructor TStringStream.Create(const AString: string);\r\nbegin\r\n  Create(AString, TEncoding.Default, False);\r\nend;\r\n\r\nconstructor TStringStream.Create(const AString: string; AEncoding: TEncoding; AOwnsEncoding: Boolean);\r\nbegin\r\n  inherited Create;\r\n  FEncoding := AEncoding;\r\n  FOwnsEncoding := AOwnsEncoding and not TEncoding.IsStandardEncoding(AEncoding);\r\n  FBytes := FEncoding.GetBytes(AString);\r\n  FSize := FBytes.Length;\r\n  FCapacity := FSize;\r\nend;\r\n\r\ndestructor TStringStream.Destroy;\r\nbegin\r\n  if FOwnsEncoding then\r\n    FEncoding.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TStringStream.GetDataString: string;\r\nbegin\r\n  Result := FEncoding.GetString(FBytes);\r\nend;\r\n\r\nprocedure TStringStream.LoadFromFile(const AFileName: string);\r\nconst\r\n  cStatusOK = 200;\r\nvar\r\n  lStatus: Integer;\r\n  lResponse: string;\r\nbegin\r\n  lResponse := string.Empty;\r\n  lStatus := cStatusOK;\r\n  asm\r\n    var lRequest = new XMLHttpRequest();\r\n    lRequest.open(\"GET\", AFileName, false);\r\n    lRequest.send();\r\n\r\n    if (lRequest.status == cStatusOK)\r\n      lResponse = lRequest.responseText\r\n    else\r\n      lStatus = lRequest.status;\r\n  end;\r\n\r\n  if lStatus <> cStatusOK then\r\n    raise EStringStreamError.CreateFmt(SCannotGetFile, [AFileName, lStatus]);\r\n  WriteString(lResponse);\r\nend;\r\n\r\nprocedure TStringStream.LoadFromFile(const AFileName: string; const ALoaded: TProc);\r\nbegin\r\n  LoadFromFile(AFileName, ALoaded, nil);\r\nend;\r\n\r\nprocedure TStringStream.LoadFromFile(const AFileName: string; const ALoaded: TProc; const AError: TProcString);\r\nconst\r\n  cAbortMethod = 'abort';\r\n  cErrorMethod = 'error';\r\n  cGetMethod = 'GET';\r\n  cLoadMethod = 'load';\r\nbegin\r\n  FLoaded := ALoaded;\r\n  FError := AError;\r\n  FFileName := AFileName;\r\n  FRequest := TJSXMLHttpRequest.New;\r\n  FRequest.AddEventListener(cAbortMethod, @OnAbort);\r\n  FRequest.AddEventListener(cErrorMethod, @OnError);\r\n  FRequest.AddEventListener(cLoadMethod, @OnLoad);\r\n  try\r\n    FRequest.Open(cGetMethod, AFileName, True);\r\n    FRequest.Send;\r\n  except\r\n    on E: Exception do\r\n    begin\r\n      if Assigned(AError) then\r\n        AError(E.Message)\r\n      else\r\n        raise;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TStringStream.OnAbort(AEvent: TEventListenerEvent): Boolean;\r\nbegin\r\n  Result := True;\r\n  if Assigned(FError) then\r\n    FError(Format(SLoadFromFileAborted, [FFileName]));\r\nend;\r\n\r\nfunction TStringStream.OnError(AEvent: TEventListenerEvent): Boolean;\r\nbegin\r\n  Result := True;\r\n  if Assigned(FError) then\r\n    FError(Format(SErrorLoadFromFile, [FFileName]));\r\nend;\r\n\r\nfunction TStringStream.OnLoad(AEvent: TEventListenerEvent): Boolean;\r\nconst\r\n  cStatusOK = 200;\r\n  cStatusLastOK = 208;\r\nvar\r\n  lReq: TJSXMLHttpRequest;\r\nbegin\r\n  lReq := TJSXMLHttpRequest(AEvent.target);\r\n\r\n  if (lReq.Status < cStatusOK) or (lReq.Status > cStatusLastOK) then\r\n  begin\r\n    if Assigned(FError) then\r\n      FError(Format(SCannotGetFile, [FFileName, FRequest.Status]))\r\n    else\r\n      raise EStringStreamError.CreateFmt(SCannotGetFile, [FFileName, lReq.Status]);\r\n  end;\r\n  WriteString(lReq.ResponseText);\r\n  Result := True;\r\n  if Assigned(FLoaded) then\r\n    FLoaded();\r\nend;\r\n\r\nfunction TStringStream.ReadString(ACount: Integer): string;\r\nvar\r\n  lBytes: TBytes;\r\n  lCount: Integer;\r\nbegin\r\n  if ACount > Size - Position then\r\n    ACount := Size - Position;\r\n\r\n  lBytes.Length := ACount;\r\n  for lCount := Position to ACount + Position - 1 do\r\n    lBytes[lCount - Position] := FBytes[lCount];\r\n\r\n  Result := FEncoding.GetString(lBytes);\r\n  Position := Position + ACount;\r\nend;\r\n\r\nprocedure TStringStream.WriteString(const AString: string);\r\nvar\r\n  lBytes: TBytes;\r\nbegin\r\n  lBytes := FEncoding.GetBytes(AString);\r\n  Write(lBytes, lBytes.Length);\r\nend;\r\n\r\n{ TInterfaceList }\r\n\r\nconstructor TInterfaceList.Create;\r\nbegin\r\n  inherited Create;\r\n  FList := TFPList.Create;\r\nend;\r\n\r\ndestructor TInterfaceList.Destroy;\r\nbegin\r\n  Clear;\r\n  FList.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TInterfaceList.Add(const AItem: IInterface): Integer;\r\nbegin\r\n  Result := FList.Add(nil);\r\n  Items[Result] := AItem;\r\nend;\r\n\r\nprocedure TInterfaceList.Clear;\r\nvar\r\n  lCount: Integer;\r\nbegin\r\n  for lCount := 0 to FList.Count - 1 do\r\n    Items[lCount] := nil;\r\n  FList.Clear;\r\nend;\r\n\r\nprocedure TInterfaceList.Delete(const AIndex: Integer);\r\nbegin\r\n  Items[AIndex] := nil;\r\n  FList.Delete(AIndex);\r\nend;\r\n\r\nprocedure TInterfaceList.Exchange(const AIndex1, AIndex2: Integer);\r\nbegin\r\n  FList.Exchange(AIndex1, AIndex2);\r\nend;\r\n\r\nfunction TInterfaceList.Expand: TInterfaceList;\r\nbegin\r\n  FList.Expand;\r\n  Result := Self;\r\nend;\r\n\r\nfunction TInterfaceList.First: IInterface;\r\nbegin\r\n  Result := Items[0];\r\nend;\r\n\r\nfunction TInterfaceList.GetEnumerator: TInterfaceListEnumerator;\r\nbegin\r\n  Result := TInterfaceListEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TInterfaceList.get_Capacity: Integer;\r\nbegin\r\n  Result := FList.Capacity;\r\nend;\r\n\r\nfunction TInterfaceList.get_Count: Integer;\r\nbegin\r\n  Result := FList.Count;\r\nend;\r\n\r\nfunction TInterfaceList.get_Items(const AIndex: Integer): IInterface;\r\nbegin\r\n  Result := IInterface(FList[AIndex]);\r\nend;\r\n\r\nfunction TInterfaceList.IndexOf(const AItem: IInterface): Integer;\r\nbegin\r\n  Result := IndexOfItem(AItem, TDirection.FromBeginning);\r\nend;\r\n\r\nfunction TInterfaceList.IndexOfItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\nbegin\r\n  Result := FList.IndexOfItem(AItem, ADirection);\r\nend;\r\n\r\nprocedure TInterfaceList.Insert(const AIndex: Integer; const AItem: IInterface);\r\nbegin\r\n  FList.Insert(AIndex, nil);\r\n  Items[AIndex] := AItem;\r\nend;\r\n\r\nfunction TInterfaceList.Last: IInterface;\r\nbegin\r\n  Result := Items[Count - 1];\r\nend;\r\n\r\nprocedure TInterfaceList.Lock;\r\nbegin\r\nend;\r\n\r\nfunction TInterfaceList.Remove(const AItem: IInterface): Integer;\r\nbegin\r\n  Result := RemoveItem(AItem, TDirection.FromBeginning);\r\nend;\r\n\r\nfunction TInterfaceList.RemoveItem(const AItem: IInterface; const ADirection: TDirection): Integer;\r\nbegin\r\n  Result := FList.IndexOfItem(AItem, ADirection);\r\n  if Result > -1 then\r\n    Delete(Result);\r\nend;\r\n\r\nprocedure TInterfaceList.set_Capacity(const AValue: Integer);\r\nbegin\r\n  FList.Capacity := AValue;\r\nend;\r\n\r\nprocedure TInterfaceList.set_Count(const AValue: Integer);\r\nbegin\r\n  FList.Count := AValue;\r\nend;\r\n\r\nprocedure TInterfaceList.set_Items(const AIndex: Integer; const AItem: IInterface);\r\nbegin\r\n  if FList[AIndex] <> nil then\r\n    IInterface(FList[AIndex])._Release;\r\n  FList[AIndex] := AItem;\r\n  if AItem <> nil then\r\n    AItem._AddRef;\r\nend;\r\n\r\nprocedure TInterfaceList.Unlock;\r\nbegin\r\nend;\r\n\r\n{ TInterfaceListEnumerator }\r\n\r\nconstructor TInterfaceListEnumerator.Create(const AInterfaceList: TInterfaceList);\r\nbegin\r\n  inherited Create;\r\n  FIndex := -1;\r\n  FInterfaceList := AInterfaceList;\r\nend;\r\n\r\nfunction TInterfaceListEnumerator.get_Current: IInterface;\r\nbegin\r\n  Result := FInterfaceList[FIndex];\r\nend;\r\n\r\nfunction TInterfaceListEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Result := FIndex < FInterfaceList.Count - 1;\r\n  if Result then\r\n    Inc(FIndex);\r\nend;\r\n\r\n{ TPath }\r\n\r\nclass function TPath.Combine(const APath1, APath2: string): string;\r\nbegin\r\n  if APath1.NotIsEmpty and (APath1.Chars[APath1.Length - 1] <> PathDelim) then\r\n    Result := APath1 + PathDelim + APath2\r\n  else\r\n    Result := APath1 + APath2;\r\nend;\r\n\r\nclass function TPath.GetDirectoryName(const AFileName: string): string;\r\nvar\r\n  lIndex: Integer;\r\nbegin\r\n  lIndex := AFileName.LastIndexOf(PathDelim);\r\n  if lIndex >= 0 then\r\n    Result := AFileName.SubString(0, lIndex)\r\n  else\r\n    Result := AFileName;\r\nend;\r\n\r\n{ TDirectory }\r\n\r\nclass function TDirectory.GetCurrentDirectory: string;\r\nbegin\r\n  Result := TPath.GetDirectoryName(window.document.location.href);\r\nend;\r\n\r\ninitialization\r\n  FormatSettings := TFormatSettings.Create;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.WebTools;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, Web, JS;\r\n\r\nfunction DoubleToHTML(d: double): string;\r\n\r\nprocedure MessageBeep(AType: integer);\r\nprocedure OutputDebugString(const s: string);\r\nfunction GetTickCount: longint;\r\nfunction GetQueryParam(AName: string): string;\r\nfunction HasQueryParam(AName: string; var AValue: string): boolean;\r\nfunction EscapeHTML(AValue: string): string;\r\n\r\nfunction GetLocaleShortDateFormat(ALocale: string = ''): string;\r\nfunction GetLocaleLongDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nfunction GetLocaleShortDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nfunction GetLocaleLongMonthName(Month: integer; ALocale: string = ''): string;\r\nfunction GetLocaleShortMonthName(Month: integer; ALocale: string = ''): string;\r\nfunction GetLocaleDecimalSeparator(ALocale: string = ''): string;\r\nfunction GetLocaleThousandSeparator(ALocale: string = ''): string;\r\nfunction LocaleFormatCurrency(Value: double; ACurrency: string; ALocale: string = ''): string;\r\nfunction GetLocaleCurrency(ALocale: string = ''): string;\r\nfunction GetBrowserLocale: string;\r\nfunction ProcessAccelerator(AValue: string; var Accelerator: string): string;\r\nfunction GetBase64Image(AImage: TJSHTMLElement; AWidth: integer = 0; AHeight: integer = 0): string;\r\nprocedure DebugBreak;\r\nfunction HexImageDecode(s: string): TJSUint8Array;\r\nfunction HexImageEncodeFromBase64(s: string): string;\r\nfunction HexImageEncode(a: TJSUint8Array): string;\r\nfunction HexImageDecodeAsBase64(s: string): string;\r\nfunction EmptyImage: string;\r\n\r\nimplementation\r\n\r\nuses\r\n  SysUtils, WEBLib.Utils;\r\n\r\nfunction EmptyImage: string;\r\nbegin\r\n  Result := 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\r\nend;\r\n\r\n\r\nfunction HexImageDecode(s: string): TJSUint8Array;\r\nvar\r\n  i,j,l: integer;\r\n  res: TJSUint8Array;\r\n  c1,c2: byte;\r\n  hdr: byte;\r\nbegin\r\n  l := Length(s) div 2;\r\n  j := 0;\r\n\r\n  c1 := ord(s[1]) - 48;\r\n  if c1 >= 10 then\r\n    c1 := c1 - 7;\r\n\r\n  c2 := ord(s[2]) -48;\r\n  if c2 >= 10 then\r\n    c2 := c2 - 7;\r\n\r\n  hdr := 1 + (c2 +  (c1 shl 4));\r\n\r\n  i := pos('4A5045474',s);\r\n  // possible extra 4 bytes when TJPEGImage?\r\n  if (i > 1) and (i < 10) then\r\n    inc(hdr,4);\r\n\r\n  i := pos('4269746D6',s);\r\n  // possible extra 4 bytes when TBitmap?\r\n  if (i > 1) and (i < 10) then\r\n    inc(hdr,4);\r\n\r\n  res := TJSUint8Array.new(l - hdr);\r\n\r\n  for i := hdr + 1 to l do\r\n  begin\r\n    c1 := ord(s[i*2 - 1]) - 48;\r\n    if c1 >= 10 then\r\n      c1 := c1 - 7;\r\n\r\n    c2 := ord(s[i*2]) -48;\r\n    if c2 >= 10 then\r\n      c2 := c2 - 7;\r\n\r\n    c2 := c2 +  (c1 shl 4);\r\n\r\n    res[j] := c2;\r\n    inc(j);\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction HexImageEncode(a: TJSUint8Array): string;\r\nvar\r\n  i,l: integer;\r\n  b: byte;\r\n  s,ls: string;\r\nbegin\r\n  Result := '';\r\n\r\n  l := a.length;\r\n\r\n  if l = 0 then\r\n    Exit;\r\n\r\n  l := (l and $FF) shl 24 + (l and $FF00) shl 8 +  (l and $FF0000) shr 8 + (l and $FF000000) shr 24;\r\n\r\n  ls := '';\r\n\r\n  if (a[0] = 137) and (a[1] = 80) then\r\n  begin\r\n    s := 'TPngImage';\r\n    b := Length(s);\r\n  end;\r\n\r\n  if (a[0] = $FF) and (a[1] = $D8) then\r\n  begin\r\n    s := 'TJPEGImage';\r\n    b := Length(s);\r\n    ls := inttohex(l,8);\r\n  end;\r\n\r\n  if (a[0] = 66) and (a[1] = 77) then\r\n  begin\r\n    s := 'TBitmap';\r\n    b := Length(s);\r\n    ls := inttohex(l,8);\r\n  end;\r\n\r\n  if (a[0] = 71) and (a[1] = 73) then\r\n  begin\r\n    s := 'TGIFImage';\r\n    b := Length(s);\r\n  end;\r\n\r\n  Result := inttohex(b,2);\r\n\r\n  for i := 1 to length(s) do\r\n  begin\r\n    b := ord(s[i]);\r\n    Result := Result + inttohex(b,2);\r\n  end;\r\n\r\n  Result := Result + ls;\r\n\r\n  for i := 0 to a.length - 1 do\r\n  begin\r\n    b := a[i];\r\n    Result := Result + inttohex(b,2);\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\n\r\nfunction HexImageEncodeFromBase64(s: string): string;\r\nvar\r\n  ja: TJSUint8Array;\r\nbegin\r\n  asm\r\n    s = s.replace(/^data:image\\/\\S+;base64,/, \"\");\r\n    //ja = Uint8Array.from(atob(s), c => c.charCodeAt(0))\r\n    ja = Uint8Array.from(atob(s), function(c) { return c.charCodeAt(0);} )\r\n  end;\r\n\r\n  Result := HexImageEncode(ja);\r\nend;\r\n\r\nfunction HexImageDecodeAsBase64(s: string): string;\r\nvar\r\n  ja: TJSUint8Array;\r\nbegin\r\n  ja := HexImageDecode(s);\r\n  asm\r\n    s = btoa(new Uint8Array(ja).reduce(function (data, byte) {\r\n      return data + String.fromCharCode(byte);\r\n      }, ''));\r\n  end;\r\n  Result := s;\r\nend;\r\n\r\nfunction GetBase64Image(AImage: TJSHTMLElement; AWidth: integer = 0; AHeight: integer = 0): string;\r\nvar\r\n  s: string;\r\n  m: TJSHTMLElement;\r\nbegin\r\n  s := '';\r\n  m := AImage;\r\n  asm\r\n    function getBase64Image(img) {\r\n      var canvas = document.createElement(\"canvas\");\r\n      if (AWidth == 0) {\r\n        canvas.width = img.width; }\r\n        else {\r\n        canvas.width = AWidth; }\r\n      if (AHeight == 0) {\r\n      canvas.height = img.height; }\r\n      else {\r\n        canvas.height = AHeight; }\r\n      var ctx = canvas.getContext(\"2d\");\r\n      if ((AWidth == 0) || (AHeight == 0)) {\r\n         ctx.drawImage(img, 0, 0); }\r\n      else {\r\n         ctx.drawImage(img, 0, 0, AWidth, AHeight); }\r\n      var dataURL = canvas.toDataURL(\"image/png\");\r\n      return dataURL.replace(/^data:image\\/(png|jpg);base64,/, \"\");\r\n    }\r\n    s = getBase64Image(m);\r\n  end;\r\n  Result := s;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure DebugBreak;\r\n  asm\r\n    debugger;\r\n  end;\r\n\r\nfunction DoubleToHTML(d: double): string;\r\nbegin\r\n  Result := Format('%g',[d]);\r\n  Result := StringReplace(Result, ',','.',[rfReplaceAll]);\r\nend;\r\n\r\nprocedure OutputDebugString(const s: string);\r\nbegin\r\n  asm\r\n    console.log(s);\r\n  end;\r\nend;\r\n\r\nfunction GetTickCount: longint;\r\nvar\r\n  n: longint;\r\nbegin\r\n  asm\r\n    var d = new Date();\r\n    n = d.getTime();\r\n  end;\r\n\r\n  Result := n;\r\nend;\r\n\r\nfunction HasQueryParam(AName: string; var AValue: string): boolean;\r\nvar\r\n  found: boolean;\r\n  s: string;\r\nbegin\r\n  s := '';\r\n  asm\r\n    var query = window.location.search.substring(1);\r\n    var res = \"\";\r\n    found = false;\r\n    var vars = query.split('&');\r\n    for (var i = 0; i < vars.length; i++) {\r\n       var pair = vars[i].split('=');\r\n      if (decodeURIComponent(pair[0]) == AName) {\r\n          res = decodeURIComponent(pair[1]);\r\n          found = true;\r\n       }\r\n    }\r\n    s = res;\r\n  end;\r\n\r\n  AValue := s;\r\n  Result := found;\r\nend;\r\n\r\nfunction GetQueryParam(AName: string): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  HasQueryParam(AName,res);\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction GetLocaleShortDateFormat(ALocale: string = ''): string;\r\nbegin\r\n  Result := TFormatSettings.Create(ALocale).ShortDateFormat;\r\nend;\r\n\r\nfunction GetLocaleLongDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(2017, 0, 1); // Sunday\r\n    baseDate.setDate(baseDate.getDate() + DayOfWeek - 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { weekday: 'long' });\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleShortDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(2017, 0, 1); // Sunday\r\n    baseDate.setDate(baseDate.getDate() + DayOfWeek - 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { weekday: 'short' });\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleLongMonthName(Month: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(2017, Month - 1, 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { month: 'long' });\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleShortMonthName(Month: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(2017, Month - 1, 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { month: 'short' });\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleDecimalSeparator(ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var n = 1.1;\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    n = n.toLocaleString(loc).substring(1, 2);\r\n    res = n;\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleThousandSeparator(ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var n = 1000.1;\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n    n = n.toLocaleString(loc).substring(1, 2);\r\n    res = n;\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction LocaleFormatCurrency(Value: double; ACurrency: string; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n\r\n  asm\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n    var number = Value;\r\n    res = number.toLocaleString(loc, { style: 'currency', currency: ACurrency });\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleCurrency(ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var curr =\r\n      {\"BD\": \"BDT\", \"BE\": \"EUR\", \"BF\": \"XOF\", \"BG\": \"BGN\", \"BA\": \"BAM\", \"BB\": \"BBD\", \"WF\": \"XPF\",\r\n       \"BL\": \"EUR\", \"BM\": \"BMD\", \"BN\": \"BND\", \"BO\": \"BOB\", \"BH\": \"BHD\", \"BI\": \"BIF\", \"BJ\": \"XOF\",\r\n       \"BT\": \"BTN\", \"JM\": \"JMD\", \"BV\": \"NOK\", \"BW\": \"BWP\", \"WS\": \"WST\", \"BQ\": \"USD\", \"BR\": \"BRL\",\r\n       \"BS\": \"BSD\", \"JE\": \"GBP\", \"BY\": \"BYR\", \"BZ\": \"BZD\", \"RU\": \"RUB\", \"RW\": \"RWF\", \"RS\": \"RSD\",\r\n       \"TL\": \"USD\", \"RE\": \"EUR\", \"TM\": \"TMT\", \"TJ\": \"TJS\", \"RO\": \"RON\", \"TK\": \"NZD\", \"GW\": \"XOF\",\r\n       \"GU\": \"USD\", \"GT\": \"GTQ\", \"GS\": \"GBP\", \"GR\": \"EUR\", \"GQ\": \"XAF\", \"GP\": \"EUR\", \"JP\": \"JPY\",\r\n       \"GY\": \"GYD\", \"GG\": \"GBP\", \"GF\": \"EUR\", \"GE\": \"GEL\", \"GD\": \"XCD\", \"GB\": \"GBP\", \"GA\": \"XAF\",\r\n       \"SV\": \"USD\", \"GN\": \"GNF\", \"GM\": \"GMD\", \"GL\": \"DKK\", \"GI\": \"GIP\", \"GH\": \"GHS\", \"OM\": \"OMR\",\r\n       \"TN\": \"TND\", \"JO\": \"JOD\", \"HR\": \"HRK\", \"HT\": \"HTG\", \"HU\": \"HUF\", \"HK\": \"HKD\", \"HN\": \"HNL\",\r\n       \"HM\": \"AUD\", \"VE\": \"VEF\", \"PR\": \"USD\", \"PS\": \"ILS\", \"PW\": \"USD\", \"PT\": \"EUR\", \"SJ\": \"NOK\",\r\n       \"PY\": \"PYG\", \"IQ\": \"IQD\", \"PA\": \"PAB\", \"PF\": \"XPF\", \"PG\": \"PGK\", \"PE\": \"PEN\", \"PK\": \"PKR\",\r\n       \"PH\": \"PHP\", \"PN\": \"NZD\", \"PL\": \"PLN\", \"PM\": \"EUR\", \"ZM\": \"ZMK\", \"EH\": \"MAD\", \"EE\": \"EUR\",\r\n       \"EG\": \"EGP\", \"ZA\": \"ZAR\", \"EC\": \"USD\", \"IT\": \"EUR\", \"VN\": \"VND\", \"SB\": \"SBD\", \"ET\": \"ETB\",\r\n       \"SO\": \"SOS\", \"ZW\": \"ZWL\", \"SA\": \"SAR\", \"ES\": \"EUR\", \"ER\": \"ERN\", \"ME\": \"EUR\", \"MD\": \"MDL\",\r\n       \"MG\": \"MGA\", \"MF\": \"EUR\", \"MA\": \"MAD\", \"MC\": \"EUR\", \"UZ\": \"UZS\", \"MM\": \"MMK\", \"ML\": \"XOF\",\r\n       \"MO\": \"MOP\", \"MN\": \"MNT\", \"MH\": \"USD\", \"MK\": \"MKD\", \"MU\": \"MUR\", \"MT\": \"EUR\", \"MW\": \"MWK\",\r\n       \"MV\": \"MVR\", \"MQ\": \"EUR\", \"MP\": \"USD\", \"MS\": \"XCD\", \"MR\": \"MRO\", \"IM\": \"GBP\", \"UG\": \"UGX\",\r\n       \"TZ\": \"TZS\", \"MY\": \"MYR\", \"MX\": \"MXN\", \"IL\": \"ILS\", \"FR\": \"EUR\", \"IO\": \"USD\", \"SH\": \"SHP\",\r\n       \"FI\": \"EUR\", \"FJ\": \"FJD\", \"FK\": \"FKP\", \"FM\": \"USD\", \"FO\": \"DKK\", \"NI\": \"NIO\", \"NL\": \"EUR\",\r\n       \"NO\": \"NOK\", \"NA\": \"NAD\", \"VU\": \"VUV\", \"NC\": \"XPF\", \"NE\": \"XOF\", \"NF\": \"AUD\", \"NG\": \"NGN\",\r\n       \"NZ\": \"NZD\", \"NP\": \"NPR\", \"NR\": \"AUD\", \"NU\": \"NZD\", \"CK\": \"NZD\", \"XK\": \"EUR\", \"CI\": \"XOF\",\r\n       \"CH\": \"CHF\", \"CO\": \"COP\", \"CN\": \"CNY\", \"CM\": \"XAF\", \"CL\": \"CLP\", \"CC\": \"AUD\", \"CA\": \"CAD\",\r\n       \"CG\": \"XAF\", \"CF\": \"XAF\", \"CD\": \"CDF\", \"CZ\": \"CZK\", \"CY\": \"EUR\", \"CX\": \"AUD\", \"CR\": \"CRC\",\r\n       \"CW\": \"ANG\", \"CV\": \"CVE\", \"CU\": \"CUP\", \"SZ\": \"SZL\", \"SY\": \"SYP\", \"SX\": \"ANG\", \"KG\": \"KGS\",\r\n       \"KE\": \"KES\", \"SS\": \"SSP\", \"SR\": \"SRD\", \"KI\": \"AUD\", \"KH\": \"KHR\", \"KN\": \"XCD\", \"KM\": \"KMF\",\r\n       \"ST\": \"STD\", \"SK\": \"EUR\", \"KR\": \"KRW\", \"SI\": \"EUR\", \"KP\": \"KPW\", \"KW\": \"KWD\", \"SN\": \"XOF\",\r\n       \"SM\": \"EUR\", \"SL\": \"SLL\", \"SC\": \"SCR\", \"KZ\": \"KZT\", \"KY\": \"KYD\", \"SG\": \"SGD\", \"SE\": \"SEK\",\r\n       \"SD\": \"SDG\", \"DO\": \"DOP\", \"DM\": \"XCD\", \"DJ\": \"DJF\", \"DK\": \"DKK\", \"VG\": \"USD\", \"DE\": \"EUR\",\r\n       \"YE\": \"YER\", \"DZ\": \"DZD\", \"US\": \"USD\", \"UY\": \"UYU\", \"YT\": \"EUR\", \"UM\": \"USD\", \"LB\": \"LBP\",\r\n       \"LC\": \"XCD\", \"LA\": \"LAK\", \"TV\": \"AUD\", \"TW\": \"TWD\", \"TT\": \"TTD\", \"TR\": \"TRY\", \"LK\": \"LKR\",\r\n       \"LI\": \"CHF\", \"LV\": \"EUR\", \"TO\": \"TOP\", \"LT\": \"LTL\", \"LU\": \"EUR\", \"LR\": \"LRD\", \"LS\": \"LSL\",\r\n       \"TH\": \"THB\", \"TF\": \"EUR\", \"TG\": \"XOF\", \"TD\": \"XAF\", \"TC\": \"USD\", \"LY\": \"LYD\", \"VA\": \"EUR\",\r\n       \"VC\": \"XCD\", \"AE\": \"AED\", \"AD\": \"EUR\", \"AG\": \"XCD\", \"AF\": \"AFN\", \"AI\": \"XCD\", \"VI\": \"USD\",\r\n       \"IS\": \"ISK\", \"IR\": \"IRR\", \"AM\": \"AMD\", \"AL\": \"ALL\", \"AO\": \"AOA\", \"AQ\": \"\", \"AS\": \"USD\",\r\n       \"AR\": \"ARS\", \"AU\": \"AUD\", \"AT\": \"EUR\", \"AW\": \"AWG\", \"IN\": \"INR\", \"AX\": \"EUR\", \"AZ\": \"AZN\",\r\n       \"IE\": \"EUR\", \"ID\": \"IDR\", \"UA\": \"UAH\", \"QA\": \"QAR\", \"MZ\": \"MZN\"}\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n    loc = loc.substring(3,5);\r\n    loc = loc.toUpperCase();\r\n    res = curr[loc] || '';\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\n\r\n\r\nfunction GetBrowserLocale: string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    res = navigator.language\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction ProcessAccelerator(AValue: string; var Accelerator: string): string;\r\nvar\r\n  i,l: integer;\r\n  res: string;\r\nbegin\r\n  l := Length(AValue);\r\n\r\n  Accelerator := '';\r\n\r\n  res := '';\r\n\r\n  i := 1;\r\n  while (i <= l) do\r\n  begin\r\n    if (AValue[i] = '&') then\r\n    begin\r\n      if (i + 1 <= l) and (AValue[i + 1] <> '&') then\r\n      begin\r\n        res := res + '<u>' + AValue[i + 1] + '</u>';\r\n        Accelerator := AValue[i + 1];\r\n      end\r\n      else\r\n      if (i + 1 <= l) and (AValue[i + 1] = '&') then\r\n        res := res + '&';\r\n      inc(i, 2);\r\n    end\r\n    else\r\n    begin\r\n      res := res + AValue[i];\r\n      inc(i);\r\n    end;\r\n\r\n  end;\r\n\r\n  Result := res;\r\n\r\nend;\r\n\r\nfunction EscapeHTML(AValue: string): string;\r\nvar\r\n  s: string;\r\nbegin\r\n  s := AValue;\r\n  asm\r\n    function escapeHTML(AString) {\r\n      return AString.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');\r\n    }\r\n    s = escapeHTML(s);\r\n  end;\r\n  Result := s;\r\nend;\r\n\r\n{$HINTS OFF}\r\n\r\nprocedure MessageBeep(AType: integer);\r\nbegin\r\n  asm\r\n    var snd = new Audio(\"data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeI\"+\r\n        \"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\"+\r\n\t\"eFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZ\"+\r\n\t\"B4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZ\"+\r\n\t\"TGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRP\"+\r\n\t\"gUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCk\"+\r\n\t\"QjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk\"+\r\n\t\"4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb////////////////////////////////////////////////////////////////////////////////////////////\"+\r\n\t\"////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\"+\r\n\t\"////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\"+\r\n\t\"/////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=\");\r\n    snd.play();\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nend.\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.WebCtrls;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Controls, WEBLib.Graphics, SysUtils, Web, JS;\r\n\r\ntype\r\n  TBrowserSandboxType = (stAllowForms, stAllowModals, stAllowOrientationLock, stAllowPointerLock, stAllowPopups, stAllowPopupsToEscapeSandbox,\r\n    stAllowPresentation, stAllowSameOrigin, stAllowScripts, stAllowTopNavigation, stAllowTopNavigationByUserActivation);\r\n\r\n  TBrowserSandboxTypes = set of TBrowserSandboxType;\r\n\r\n  TBrowserReferrerPolicy = (rfNone, rfNoReferrer, rfNoReferrerWhenDowngrade, rfOrigin, rfOriginWhenCrossOrigin, rfUnsafeUrl);\r\n\r\n  TBrowserControl = class(TCustomControl)\r\n  private\r\n    FURL: string;\r\n    FSandbox: TBrowserSandboxTypes;\r\n    FReferrerPolicy: TBrowserReferrerPolicy;\r\n    procedure SetURL(const Value: string);\r\n    procedure SetSandbox(const Value: TBrowserSandboxTypes);\r\n    procedure SetReferrerPolicy(const Value: TBrowserReferrerPolicy);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure BindEvents; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure Navigate(const AURL: string);\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property ReferrerPolicy: TBrowserReferrerPolicy read FReferrerPolicy write SetReferrerPolicy;\r\n    property Sandbox: TBrowserSandboxTypes read FSandbox write SetSandbox;\r\n    property URL: string read FURL write SetURL;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseMove;\r\n    property OnMouseUp;\r\n  end;\r\n\r\n  TWebBrowserControl = class(TBrowserControl);\r\n\r\n  TYoutube = class(TCustomControl)\r\n  private \r\n    FVideoID: string;\r\n    FAllowFullScreen: boolean;\r\n    FAutoPlay: boolean;\r\n    procedure SetAllowFullScreen(const Value: boolean);\r\n  protected\r\n    procedure SetVideoID(const Value: string);\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AllowFullScreen: boolean read FAllowFullScreen write SetAllowFullScreen;\r\n    property AutoPlay: boolean read FAutoPlay write FAutoPlay;\r\n    property VideoID: string read FVideoID write SetVideoID;\r\n  end;\r\n\r\n  TWebYoutube = class(TYoutube);\r\n\r\n  TMapClickEvent = procedure(Sender: TObject; Lon, Lat: double) of object;\r\n  TMapZoomEvent = procedure(Sender: TObject; ZoomLevel: integer) of object;\r\n  TMapMarkerClickEvent = procedure(Sender: TObject; AIndex: integer; AMarker: TJSObject) of object;\r\n  TMapPolygonClickEvent = procedure(Sender: TObject; AIndex: integer; APolygon: TJSObject) of object;\r\n  TMapPolylineClickEvent = procedure(Sender: TObject; AIndex: integer; APolyline: TJSObject) of object;\r\n  TMapCircleClickEvent = procedure(Sender: TObject; AIndex: integer; ACircle: TJSObject) of object;\r\n  TMapRectangleClickEvent = procedure(Sender: TObject; AIndex: integer; ARectangle: TJSObject) of object;\r\n  TMapKMLClickEvent = procedure(Sender: TObject; AIndex: integer; AKML: TJSObject) of object;\r\n\r\n  TGoogleMarkerColor = (mcDefault, mcRed, mcBlue, mcGreen, mcPurple, mcYellow);\r\n  TGoogleMarkerShape = (msPin, msPinDot, msFlag, msBookmark, msFlagSmall, msHome, msFavorite, msStar, msCustom);\r\n  TGoogleTravelMode = (tmDriving, tmWalking, tmBicycling, tmTransit);\r\n  TGoogleMapType = (mtDefault, mtSatellite, mtHybrid, mtTerrain);\r\n  TGoogleMapStyle = (mstDefault, mstNightMode, mstCustom);\r\n\r\n  TGoogleMaps = class;\r\n\r\n  TGoogleMapsOptions = class(TPersistent)\r\n  private\r\n    FOwner: TGoogleMaps;\r\n    FCustomStyle: TStringList;\r\n    FMapStyle: TGoogleMapStyle;\r\n    FDefaultLongitude: Double;\r\n    FDefaultLatitude: Double;\r\n    FDefaultZoomLevel: Integer;\r\n    procedure SetCustomStyle(const Value: TStringList);\r\n    procedure SetMapStyle(const Value: TGoogleMapStyle);\r\n    procedure SetDefaultLatitude(const Value: Double);\r\n    procedure SetDefaultLongitude(const Value: Double);\r\n    procedure SetDefaultZoomLevel(const Value: Integer);\r\n  public\r\n    constructor Create(AGoogleMaps: TGoogleMaps);\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property CustomStyle: TStringList read FCustomStyle write SetCustomStyle;\r\n    property MapStyle: TGoogleMapStyle read FMapStyle write SetMapStyle default mstDefault;\r\n    property DefaultLatitude: Double read FDefaultLatitude write SetDefaultLatitude default -34.397;\r\n    property DefaultLongitude: Double read FDefaultLongitude write SetDefaultLongitude default 150.644;\r\n    property DefaultZoomLevel: Integer read FDefaultZoomLevel write SetDefaultZoomLevel default 8;\r\n  end;\r\n\r\n  TGoogleMaps = class(TCustomControl)\r\n  private\r\n    FUpdateCount: integer;\r\n    FReq: TJSXMLHttpRequest;\r\n    FAPIKey: string;\r\n    FMap: TJSHTMLElement;\r\n    FDirectionsService: TJSElement;\r\n    FDirectionsDisplay: TJSElement;\r\n    FCode: boolean;\r\n    FBound: boolean;\r\n    FOnMapClick: TMapClickEvent;\r\n    FOnMapDblClick: TMapClickEvent;\r\n    FOnMapZoom: TMapZoomEvent;\r\n    FOnMapPan: TMapClickEvent;\r\n    FOnGeoCoded: TMapClickEvent;\r\n    FOnMapIdle: TNotifyEvent;\r\n    FOnMapLoaded: TNotifyEvent;\r\n    FOnMarkerClick: TMapMarkerClickEvent;\r\n    FOnPolygonClick: TMapPolygonClickEvent;\r\n    FOnPolylineClick: TMapPolylineClickEvent;\r\n    FOnCircleClick: TMapCircleClickEvent;\r\n    FOnRectangleClick: TMapRectangleClickEvent;\r\n    FOnKMLClick: TMapKMLClickEvent;\r\n    FOptions: TGoogleMapsOptions;\r\n    procedure SetAPIKey(const Value: string);\r\n    function GetMarker(AIndex: integer): TJSObject;\r\n    function GetCircle(AIndex: integer): TJSObject;\r\n    function GetRectangle(AIndex: integer): TJSObject;\r\n    function GetPolygon(AIndex: integer): TJSObject;\r\n    function GetPolyline(AIndex: integer): TJSObject;\r\n  protected\r\n    function GetMap: TJSHTMLElement;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure BindEvents; override;\r\n    procedure HandleMapClick(e: TJSEvent);\r\n    procedure HandleMapDblClick(e: TJSEvent);\r\n    procedure HandleMapPan(e: TJSEvent);\r\n    procedure HandleMapZoom(e: TJSEvent);\r\n    procedure HandleMapIdle(e: TJSEvent);\r\n    procedure HandleMarkerClick(e: TJSEvent);\r\n    procedure HandlePolygonClick(e: TJSEvent);\r\n    procedure HandlePolylineClick(e: TJSEvent);\r\n    procedure HandleCircleClick(e: TJSEvent);\r\n    procedure HandleRectangleClick(e: TJSEvent);\r\n    procedure HandleKMLClick(e: TJSEvent);\r\n    function HandleResponse(Event: TEventListenerEvent): boolean;\r\n    function HandleAbort(Event: TEventListenerEvent): boolean;\r\n    function TravelModeStr(ATravelMode: TGoogleTravelMode): string;\r\n    function DoLoaded(Event: TEventListenerEvent): boolean; virtual;\r\n    procedure Loaded; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure SetCenter(Lat, Lon: Double);\r\n    function GetCenter(var Lat, Lon: Double): Boolean;\r\n    function GetBounds(var NorthEastLat, NorthEastLon, SouthWestLat, SouthWestLon: Double): Boolean;\r\n    procedure SetDoubleClickZoom(AValue: Boolean);\r\n    procedure SetDraggable(AValue: Boolean);\r\n    procedure SetScrollWheel(AValue: Boolean);\r\n    procedure SetMapType(AMapType: TGoogleMapType = mtDefault);\r\n    procedure SetZoom(Zoom: integer);\r\n    procedure PanTo(Lat, Lon: double);\r\n    procedure AddGPX(AGPX: string; AColor: TColor = clRed; AWidth: integer = 2; AOpacity: Double = 1);\r\n    procedure AddKML(Url: string; ZoomToBounds: Boolean = true);\r\n    procedure AddPolyLine(Points: TJSArray; AColor: TColor = clRed;AWidth: integer = 2; AOpacity: Double = 1);\r\n    procedure AddPolygon(Points: TJSArray; AFillColor: TColor = clRed; AStrokeColor: TColor = clBlack; AWidth: Integer = 2; AOpacity: Double = 1);\r\n    procedure AddCircle(Lat, Lon: double; Radius: Integer; AFillColor: TColor = clRed; AStrokeColor: TColor = clBlack; AWidth: Integer = 2; AOpacity: double = 1);\r\n    procedure AddRectangle(NorthEastLat, NorthEastLon, SouthWestLat, SouthWestLon: double; AFillColor: TColor = clRed; AStrokeColor: TColor = clBlack; AWidth: integer = 2; AOpacity: double = 1);\r\n    procedure AddMarker(Lat,Lon: Double; Title: string = ''); overload;\r\n    procedure AddMarker(Lat,Lon: Double; Color: TGoogleMarkerColor; Title: string = ''); overload;\r\n    procedure AddMarker(Lat,Lon: Double; Color: TColor; PinLetter: string; Title: string = ''); overload;\r\n    procedure AddMarker(Lat,Lon: Double; PinIcon: string; Title: string); overload;\r\n    procedure AddMarker(Lat,Lon: Double; Shape: TGoogleMarkerShape; Color: TColor; Title: string = ''); overload;\r\n    procedure AddMarker(Lat,Lon: Double; Shape: TGoogleMarkerShape; Color: TColor = clRed; BorderColor: TColor = clBlack; Scale: Double = 1; CustomShape: string = ''; Title: string = ''); overload;\r\n    procedure SetMarkerTitle(AIndex: Integer; ATitle: string);\r\n    procedure SetMarkerLocation(AIndex: Integer; Lat, Lon: Double);\r\n    procedure SetMarkerIcon(AIndex: Integer; Url: string);\r\n    procedure SetCircleCenter(AIndex: Integer; Lat, Lon: Double);\r\n    procedure SetCircleRadius(AIndex, Radius: Integer);\r\n    procedure SetCircleColors(AIndex: Integer; AFillColor, AStrokeColor: TColor);\r\n    procedure SetRectangleLocation(AIndex: Integer; NorthEastLat, NorthEastLon, SouthWestLat, SouthWestLon: Double);\r\n    procedure SetRectangleColors(AIndex: Integer; AFillColor, AStrokeColor: TColor);\r\n    procedure SetPolylineColor(AIndex: Integer; AColor: TColor);\r\n    procedure SetPolylinePoints(AIndex: Integer; Points: TJSArray);\r\n    procedure SetPolygonColors(AIndex: Integer; AFillColor, AStrokeColor: TColor);\r\n    procedure SetPolygonPoints(AIndex: Integer; Points: TJSArray);\r\n    procedure FitBounds(LatMin, LonMin, LatMax, LonMax: Double);\r\n    procedure ClearMarkers;\r\n    procedure ClearKMLs;\r\n    procedure ClearPolylines;\r\n    procedure ClearPolygons;\r\n    procedure ClearCircles;\r\n    procedure ClearRectangles;\r\n    procedure ShowDirections(Source, Destination: string; ATravelMode: TGoogleTravelMode = tmDriving; WayPoints: TStringList = nil; OptimizeWayPoints: Boolean = False; AvoidHighways: Boolean = False; AvoidTolls: Boolean = False); overload;\r\n    procedure ShowDirections(SourceLon, SourceLat, DestLon, DestLat: Double; ATravelMode: TGoogleTravelMode = tmDriving; WayPoints: TStringList = nil; OptimizeWayPoints: Boolean = False; AvoidHighways: Boolean = False; AvoidTolls: Boolean = False); overload;\r\n    procedure ShowStreetView(Lat, Lon: Double; Heading: Integer = 0; Zoom: Integer = 0; Pitch: Integer = 0);\r\n    procedure HideStreetView;\r\n    procedure RemoveDirections;\r\n    procedure RemoveMarker(AIndex: Integer);\r\n    procedure RemovePolygon(AIndex: Integer);\r\n    procedure RemovePolyline(AIndex: Integer);\r\n    procedure RemoveCircle(AIndex: Integer);\r\n    procedure RemoveRectangle(AIndex: Integer);\r\n    procedure GeoCode(const Address: string);\r\n    property Markers[AIndex: Integer]: TJSObject read GetMarker;\r\n    property Polygons[AIndex: Integer]: TJSObject read GetPolygon;\r\n    property Polylines[AIndex: Integer]: TJSObject read GetPolyline;\r\n    property Circles[AIndex: Integer]: TJSObject read GetCircle;\r\n    property Rectangles[AIndex: Integer]: TJSObject read GetRectangle;\r\n  published\r\n    property Align;\r\n    property Options: TGoogleMapsOptions read FOptions write FOptions;\r\n    property APIKey: string read FAPIKey write SetAPIKey;\r\n    property OnGeoCoded: TMapClickEvent read FOnGeoCoded write FOnGeoCoded;\r\n    property OnMapClick: TMapClickEvent read FOnMapClick write FOnMapClick;\r\n    property OnMapDblClick: TMapClickEvent read FOnMapDblClick write FOnMapDblClick;\r\n    property OnMapIdle: TNotifyEvent read FOnMapIdle write FOnMapIdle;\r\n    property OnMapPan: TMapClickEvent read FOnMapPan write FOnMapPan;\r\n    property OnMapLoaded: TNotifyEvent read FOnMapLoaded write FOnMapLoaded;\r\n    property OnMapZoom: TMapZoomEvent read FOnMapZoom write FOnMapZoom;\r\n    property OnMarkerClick: TMapMarkerClickEvent read FOnMarkerClick write FOnMarkerClick;\r\n    property OnPolygonClick: TMapPolygonClickEvent read FOnPolygonClick write FOnPolygonClick;\r\n    property OnPolylineClick: TMapPolylineClickEvent read FOnPolylineClick write FOnPolylineClick;\r\n    property OnCircleClick: TMapCircleClickEvent read FOnCircleClick write FOnCircleClick;\r\n    property OnRectangleClick: TMapRectangleClickEvent read FOnRectangleClick write FOnRectangleClick;\r\n    property OnKMLClick: TMapKMLClickEvent read FOnKMLClick write FOnKMLClick;\r\n  end;\r\n\r\n  TWebGoogleMaps = class(TGoogleMaps);\r\n\r\n  TDriveView = (dvList, dvGrid);\r\n\r\n  TGoogleDrive = class(TWinControl)\r\n  private\r\n    FView: TDriveView;\r\n    FFolderID: string;\r\n    procedure SetFolderID(const Value: string);\r\n    procedure SetView(const Value: TDriveView);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property FolderID: string read FFolderID write SetFolderID;\r\n    property View: TDriveView read FView write SetView;\r\n  end;\r\n\r\n  TWebGoogleDrive = class(TGoogleDrive);\r\n\r\n  TTwitterFeed = class(TCustomControl)\r\n  private\r\n    FCode: boolean;\r\n    FUpdatedFeed: boolean;\r\n    FFeed: string;\r\n    FFeedLinkText: string;\r\n    procedure SetFeed(const Value: string);\r\n    procedure SetFeedLinkText(const Value: string);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Feed: string read FFeed write SetFeed;\r\n    property FeedLinkText: string read FFeedLinkText write SetFeedLinkText;\r\n    property Visible;\r\n  end;\r\n\r\n  TWebTwitterFeed = class(TTwitterFeed);\r\n\r\n  TFilesDroppedEvent = procedure(Sender: TObject; AFileList: TStringList) of object;\r\n\r\n  TFileAsTextEvent = procedure(Sender: TObject; AFileIndex: integer; AText: string) of object;\r\n\r\n  TFileAsBase64Event = procedure(Sender: TObject; AFileIndex: integer; ABase64: string) of object;\r\n\r\n  TFileAsDataURLEvent = procedure(Sender: TObject; AFileIndex: integer; AURL: string) of object;\r\n\r\n  TFileAsArrayBufferEvent = procedure(Sender: TObject; AFileIndex: integer; ABuffer: TJSArrayBuffer) of object;\r\n\r\n  TFileUploadEvent = procedure(Sender: TObject; AFileIndex: integer) of object;\r\n\r\n  TFileUploadErrorEvent = procedure(Sender: TObject; AFileIndex: integer; AError: string) of object;\r\n\r\n  TFileUploadProgressEvent = procedure(Sender: TObject; AFileIndex: integer; APosition, ATotalSize: longint) of object;\r\n\r\n  TFileGetAsBase64 = procedure(Sender: TObject; ABase64: string) of object;\r\n\r\n  TFileGetAsText = procedure(Sender: TObject; AText: string) of object;\r\n\r\n  TFileGetAsURL = procedure(Sender: TObject; AURL: string) of object;\r\n\r\n  TFileGetAsArrayBuffer = procedure(Sender: TObject; ABuffer: TJSArrayBuffer) of object;\r\n\r\n  TGetAsStringProc = reference to procedure(AValue: string);\r\n\r\n  TGetAsArrayBufferProc = reference to procedure(AValue: TJSArrayBuffer);\r\n\r\n  TFile = class(TCollectionItem)\r\n  private\r\n    FModified: TDateTime;\r\n    FName: string;\r\n    FMimeType: string;\r\n    FSize: integer;\r\n    FFileObject: TJSHTMLFile;\r\n    FTag: integer;\r\n    FObject: TObject;\r\n    FOnGetFileAsBase64: TFileGetAsBase64;\r\n    FOnGetFileAsArrayBuffer: TFileGetAsArrayBuffer;\r\n    FOnGetFileAsText: TFileGetAsText;\r\n    FOnGetFileAsURL: TFileGetAsURL;\r\n    FGetAsString: TGetAsStringProc;\r\n    FGetAsArrayBuffer: TGetAsArrayBufferProc;\r\n  protected\r\n    function HandleFileLoadAsText(Event: TJSEvent): boolean;\r\n    function HandleFileLoadAsBase64(Event: TJSEvent): boolean;\r\n    function HandleFileLoadAsArrayBuffer(Event: TJSEvent): boolean;\r\n    function HandleFileLoadAsDataURL(Event: TJSEvent): boolean;\r\n\r\n    function HandleFileUploadProgress(Event: TJSEvent): boolean;\r\n    function HandleFileUploadComplete(Event: TJSEvent): boolean;\r\n    function HandleFileUploadError(Event: TJSEvent): boolean;\r\n    function HandleFileUploadAbort(Event: TJSEvent): boolean;\r\n    function GetControl: TCustomControl;\r\n  public\r\n    property FileObject: TJSHTMLFile read FFileObject write FFileObject;\r\n    property Name: string read FName write FName;\r\n    property MimeType: string read FMimeType write FMimeType;\r\n    property Modified: TDateTime read FModified write FModified;\r\n    property &Object: TObject read FObject write FObject;\r\n    property Size: integer read FSize write FSize;\r\n    property Tag: integer read FTag write FTag;\r\n    procedure GetFileAsText; overload;\r\n    procedure GetFileAsText(GetAsString: TGetAsStringProc); overload;\r\n    procedure GetFileAsBase64; overload;\r\n    procedure GetFileAsBase64(GetAsString: TGetAsStringProc); overload;\r\n    procedure GetFileAsArrayBuffer; overload;\r\n    procedure GetFileAsArrayBuffer(GetAsArrayBuffer: TGetAsArrayBufferProc); overload;\r\n    procedure GetFileAsDataURL; overload;\r\n    procedure GetFileAsDataURL(GetAsString: TGetAsStringProc); overload;\r\n    procedure Upload(AAction: string);\r\n    property OnGetFileAsText: TFileGetAsText read FOnGetFileAsText write FOnGetFileAsText;\r\n    property OnGetFileAsBase64: TFileGetAsBase64 read FOnGetFileAsBase64 write FOnGetFileAsBase64;\r\n    property OnGetFileAsURL: TFileGetAsURL read FOnGetFileAsURL write FOnGetFileAsURL;\r\n    property OnGetFileAsArrayBuffer: TFileGetAsArrayBuffer read FOnGetFileAsArrayBuffer write FOnGetFileAsArrayBuffer;\r\n  end;\r\n\r\n  TFilePicker = class;\r\n\r\n  TFiles = class(TCollection)\r\n  private\r\n    FOwner: TCustomControl;\r\n    function GetItem(Index: integer): TFile; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TFile);\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Owner: TPersistent; reintroduce;\r\n    property Items[Index: integer]: TFile read GetItem write SetItem; default;\r\n    function Add: TFile; reintroduce;\r\n    function Insert(Index: integer): TFile; reintroduce;\r\n    procedure Clear; reintroduce;\r\n  end;\r\n\r\n  TFileUpload = class(TCustomControl)\r\n  private\r\n    FAccept: string;\r\n    FCreateRef: string;\r\n    FEventInit: boolean;\r\n    FFiles: TFiles;\r\n    FFileList: TStringList;\r\n    FOnDroppedFiles: TFilesDroppedEvent;\r\n    FMultiFile: boolean;\r\n    FShowFiles: boolean;\r\n    FDragCaption: string;\r\n    FOnGetFileAsArrayBuffer: TFileAsArrayBufferEvent;\r\n    FOnFileAsText: TFileAsTextEvent;\r\n    FOnFileAsBase64: TFileAsBase64Event;\r\n    FOnFileAsDataURL: TFileAsDataURLEvent;\r\n    FOnUploadFileAbort: TFileUploadEvent;\r\n    FOnUploadFileComplete: TFileUploadEvent;\r\n    FOnUploadFileProgress: TFileUploadProgressEvent;\r\n    FOnUploadFileError: TFileUploadErrorEvent;\r\n    procedure SetDragCaption(const Value: string);\r\n    procedure SetAccept(const Value: string);\r\n  protected\r\n    procedure SetCaption(const AValue: string); override;\r\n    function HandleFiles(files: TJSHTMLFileList): string;\r\n    function DoHandleChange(e: TJSEvent): boolean;\r\n    function HandleDroppedFiles(Event: TJSDragEvent): boolean;\r\n    function HandleDragOver(Event: TJSDragEvent): boolean;\r\n    function HandleDragEnd(Event: TJSDragEvent): boolean;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    destructor Destroy; override;\r\n    procedure CreateInitialize; override;\r\n    property Files: TFiles read FFiles;\r\n    procedure Clear;\r\n  published\r\n    property Accept: string read FAccept write SetAccept;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property DragCaption: string read FDragCaption write SetDragCaption;\r\n    property Multifile: boolean read FMultiFile write FMultiFile default false;\r\n    property ShowFiles: boolean read FShowFiles write FShowFiles default false;\r\n    property OnDroppedFiles: TFilesDroppedEvent read FOnDroppedFiles write FOnDroppedFiles;\r\n    property OnGetFileAsText: TFileAsTextEvent read FOnFileAsText write FOnFileAsText;\r\n    property OnGetFileAsArrayBuffer: TFileAsArrayBufferEvent read FOnGetFileAsArrayBuffer write FOnGetFileAsArrayBuffer;\r\n    property OnGetFileAsBase64: TFileAsBase64Event read FOnFileAsBase64 write FOnFileAsBase64;\r\n    property OnGetFileAsDataURL: TFileAsDataURLEvent read FOnFileAsDataURL write FOnFileAsDataURL;\r\n    property OnUploadFileComplete: TFileUploadEvent read FOnUploadFileComplete write FOnUploadFileComplete;\r\n    property OnUploadFileAbort: TFileUploadEvent read FOnUploadFileAbort write FOnUploadFileAbort;\r\n    property OnUploadFileError: TFileUploadErrorEvent read FOnUploadFileError write FOnUploadFileError;\r\n    property OnUploadFileProgress: TFileUploadProgressEvent read FOnUploadFileProgress write FOnUploadFileProgress;\r\n  end;\r\n\r\n  TWebFileUpload = class(TFileUpload);\r\n\r\n  TFilePicker = class(TCustomControl)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    FMultiFile: boolean;\r\n    FFiles: TFiles;\r\n    FOnFileAsText: TFileAsTextEvent;\r\n    FOnGetFileAsArrayBuffer: TFileAsArrayBufferEvent;\r\n    FAccept: string;\r\n    FOnFileAsBase64: TFileAsBase64Event;\r\n    FChangePtr: pointer;\r\n    FOnFileAsDataURL: TFileAsDataURLEvent;\r\n    FOnUploadFileAbort: TFileUploadEvent;\r\n    FOnUploadFileComplete: TFileUploadEvent;\r\n    FOnUploadFileProgress: TFileUploadProgressEvent;\r\n    FOnUploadFileError: TFileUploadErrorEvent;\r\n    procedure SetMultiFile(const Value: boolean);\r\n    function DoHandleChange(e: TJSEvent): boolean;\r\n    procedure SetAccept(const Value: string);\r\n  protected\r\n    procedure UpdateElement; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure BindEvents; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    property Files: TFiles read FFiles;\r\n    procedure Clear;\r\n  published\r\n    property Accept: string read FAccept write SetAccept;\r\n    property ChildOrder;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property Multifile: boolean read FMultiFile write SetMultiFile;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnGetFileAsText: TFileAsTextEvent read FOnFileAsText write FOnFileAsText;\r\n    property OnGetFileAsArrayBuffer: TFileAsArrayBufferEvent read FOnGetFileAsArrayBuffer write FOnGetFileAsArrayBuffer;\r\n    property OnGetFileAsBase64: TFileAsBase64Event read FOnFileAsBase64 write FOnFileAsBase64;\r\n    property OnGetFileAsDataURL: TFileAsDataURLEvent read FOnFileAsDataURL write FOnFileAsDataURL;\r\n    property OnUploadFileComplete: TFileUploadEvent read FOnUploadFileComplete write FOnUploadFileComplete;\r\n    property OnUploadFileAbort: TFileUploadEvent read FOnUploadFileAbort write FOnUploadFileAbort;\r\n    property OnUploadFileError: TFileUploadErrorEvent read FOnUploadFileError write FOnUploadFileError;\r\n    property OnUploadFileProgress: TFileUploadProgressEvent read FOnUploadFileProgress write FOnUploadFileProgress;\r\n  end;\r\n\r\n  TWebFilePicker = class(TFilePicker);\r\n\r\n  THTMLDiv = class(TCustomControl)\r\n  private\r\n    FHTML: TStrings;\r\n    procedure SetHTML(const Value: TStrings);\r\n  protected\r\n    procedure UpdateElementData; override;\r\n    procedure HTMLChanged(Sender: TObject);\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ChildOrder;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HTML: TStrings read FHTML write SetHTML;\r\n    property Role;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnTouchStart;\r\n    property OnTouchEnd;\r\n    property OnTouchMove;\r\n    property OnTouchCancel;\r\n  end;\r\n\r\n  TWebHTMLDiv = class(THTMLDiv);\r\n\r\n  THTMLSpan = class(TCustomControl)\r\n  private\r\n    FHTML: TStrings;\r\n    procedure SetHTML(const Value: TStrings);\r\n  protected\r\n    procedure UpdateElementData; override;\r\n    procedure HTMLChanged(Sender: TObject);\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ChildOrder;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HTML: TStrings read FHTML write SetHTML;\r\n    property Role;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnTouchStart;\r\n    property OnTouchEnd;\r\n    property OnTouchMove;\r\n    property OnTouchCancel;\r\n  end;\r\n\r\n  TWebHTMLSpan = class(THTMLSpan);\r\n\r\n  THTMLAnchor = class(TCustomControl)\r\n  private\r\n    FHref: string;\r\n    FTarget: string;\r\n    procedure SetHref(const Value: string);\r\n    procedure SetTarget(const Value: string);\r\n  protected\r\n    procedure SetCaption(const Value: string); override;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElementData; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HRef: string read FHref write SetHref;\r\n    property Target: string read FTarget write SetTarget;\r\n    property Role;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n  end;\r\n\r\n  TWebHTMLAnchor = class(THTMLAnchor);\r\n\r\n  TURLValidatorEvent = procedure(Sender: TObject; IsValid: boolean) of object;\r\n\r\n  TURLValidator = class(TComponent)\r\n  private\r\n    FURL: string;\r\n    FOnValidated: TURLValidatorEvent;\r\n  protected\r\n    procedure HandleResult(IsValid: boolean);\r\n  public\r\n    procedure Validate;\r\n  published\r\n    property URL: string read FURL write FURL;\r\n    property OnValidated: TURLValidatorEvent read FOnValidated write FOnValidated;\r\n  end;\r\n\r\n  TWebURLValidator = class(TURLValidator);\r\n\r\n\r\n\r\nimplementation\r\n\r\n{ TYouTube }\r\n\r\nfunction TYoutube.CreateElement: TJSElement;\r\nvar\r\n  LLabel: TJSHTMLElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Result := document.createElement('DIV');\r\n    LLabel := TJSHTMLElement(document.createElement('DIV'));\r\n    LLabel.innerHTML := 'TWebYouTube';\r\n    BorderStyle := bsSingle;\r\n    LLabel['align'] := 'center';\r\n    LLabel.style.setProperty('border','1px solid gray');\r\n    LLabel.style.setProperty('vertical-align','middle');\r\n    LLabel.style.setProperty('display','table-cell');\r\n    Result.appendChild(LLabel);\r\n  end\r\n  else\r\n  begin\r\n    Result := document.createElement('IFRAME');\r\n    Result.setAttribute('id', GetID);\r\n    Result.setAttribute('frameborder','0');\r\n  end;\r\nend;\r\n\r\nprocedure TYoutube.UpdateElement;\r\nvar\r\n  FURL: string;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n\r\n  if (csDesigning in ComponentState) and (FVideoID = '') then\r\n  begin\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      TJSHTMLElement(ElementHandle).style.setProperty('display','table');\r\n      TJSHTMLElement(ElementHandle).style.setProperty('background-color','silver');\r\n    end;\r\n  end;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    if FVideoID <> '' then\r\n    begin\r\n      FURL := 'https://www.youtube.com/embed/' + FVideoID;\r\n      if AutoPlay then \r\n        FURL := FURL + '?autoplay=1';\r\n      Container.setAttribute('src', FURL);\r\n    end;\r\n    if FAllowFullScreen then\r\n      Container.setAttribute('allowfullscreen','allowfullscreen')\r\n    else\r\n      Container.removeAttribute('allowfullscreen');\r\n  end;\r\nend;\r\n\r\nprocedure TYoutube.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nprocedure TYoutube.SetAllowFullScreen(const Value: boolean);\r\nbegin\r\n  FAllowFullScreen := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TYoutube.SetVideoID(const Value: string);\r\nbegin\r\n  FVideoID := Value;\r\n  UpdateElement;\r\nend;\r\n\r\n{ TGoogleMaps }\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMaps.AddPolyLine(Points: TJSArray; AColor: TColor = clRed; AWidth: integer = 2; AOpacity: double = 1);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandlePolylineClick;\r\n  map := GetMap;\r\n  clr := ColorToHTML(AColor);\r\n\r\n  asm\r\n    var poly = new google.maps.Polyline({\r\n      map: map,\r\n  \t  path: Points,\r\n\t    strokeColor: clr,\r\n  \t  strokeOpacity: AOpacity,\r\n  \t  strokeWeight: AWidth\r\n  \t});\r\n\r\n    poly.idx = this.FPolylines.length;\r\n    poly.addListener('click', function() { ptr(poly); } );\r\n    this.FPolylines.push(poly);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddRectangle(NorthEastLat, NorthEastLon, SouthWestLat,\r\n  SouthWestLon: double; AFillColor, AStrokeColor: TColor; AWidth: integer;\r\n  AOpacity: double);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clrF,clrS: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleRectangleClick;\r\n  map := GetMap;\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n\r\n  asm\r\n    var NELatLng = {lat: NorthEastLat, lng: NorthEastLon};\r\n    var SWLatLng = {lat: SouthWestLat, lng: SouthWestLon};\r\n    var rect = new google.maps.Rectangle({\r\n      map: map,\r\n  \t  bounds: new google.maps.LatLngBounds(NELatLng, SWLatLng),\r\n      fillColor: clrF,\r\n      fillOpacity: AOpacity,\r\n\t    strokeColor: clrS,\r\n  \t  strokeOpacity: AOpacity,\r\n  \t  strokeWeight: AWidth\r\n  \t});\r\n\r\n    rect.idx = this.FRectangles.length;\r\n    rect.addListener('click', function() { ptr(rect); } );\r\n    this.FRectangles.push(rect);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddPolygon(Points: TJSArray; AFillColor: TColor = clRed; AStrokeColor: TColor = clBlack; AWidth: integer = 2; AOpacity: double = 1);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clrF,clrS: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandlePolygonClick;\r\n  map := GetMap;\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n\r\n  asm\r\n    var poly = new google.maps.Polygon({\r\n      map: map,\r\n  \t  paths: Points,\r\n      fillColor: clrF,\r\n      fillOpacity: AOpacity,\r\n\t    strokeColor: clrS,\r\n  \t  strokeOpacity: AOpacity,\r\n  \t  strokeWeight: AWidth\r\n  \t});\r\n\r\n    poly.idx = this.FPolygons.length;\r\n    poly.addListener('click', function() { ptr(poly); } );\r\n    this.FPolygons.push(poly);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddCircle(Lat, Lon: double; Radius: Integer;\r\n  AFillColor, AStrokeColor: TColor; AWidth: integer; AOpacity: double);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clrF,clrS: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleCircleClick;\r\n  map := GetMap;\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n\r\n  asm\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n    var circle = new google.maps.Circle({\r\n      map: map,\r\n  \t  center: myLatLng,\r\n      radius: Radius,\r\n      fillColor: clrF,\r\n      fillOpacity: AOpacity,\r\n\t    strokeColor: clrS,\r\n  \t  strokeOpacity: AOpacity,\r\n  \t  strokeWeight: AWidth\r\n  \t});\r\n\r\n    circle.idx = this.FCircles.length;\r\n    circle.addListener('click', function() { ptr(circle); } );\r\n    this.FCircles.push(circle);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Title: string);\r\nvar\r\n  map: TJSHTMLElement;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n  map := GetMap;\r\n  asm\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title\r\n        });\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Color: TGoogleMarkerColor; Title: string);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n\r\n  case Color of\r\n  mcDefault: clr := '';\r\n  mcRed: clr := 'red-dot.png';\r\n  mcGreen: clr := 'green-dot.png';\r\n  mcYellow: clr := 'yellow-dot.png';\r\n  mcPurple: clr := 'purple-dot.png';\r\n  mcBlue: clr := 'blue-dot.png';\r\n  end;\r\n\r\n  map := GetMap;\r\n  asm\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title\r\n        });\r\n\r\n    if (clr != \"\") {\r\n      marker.setIcon('http://maps.google.com/mapfiles/ms/icons/' + clr);\r\n    }\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Color: TColor; PinLetter: string; Title: string);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr,url: string;\r\n  ch: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n\r\n  clr := ColorToHTML(Color);\r\n  delete(clr,1,1);\r\n  map := GetMap;\r\n  asm\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n\r\n    url = \"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=\"+ PinLetter + \"|\" + clr;\r\n\r\n    var pinImage = new google.maps.MarkerImage(url);\r\n\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title,\r\n          icon: pinImage\r\n        });\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; PinIcon, Title: string);\r\nvar\r\n  map: TJSHTMLElement;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n\r\n  map := GetMap;\r\n  asm\r\n    var pinImage = new google.maps.MarkerImage(PinIcon);\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title,\r\n          icon: pinImage\r\n        });\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Shape: TGoogleMarkerShape;\r\n  Color: TColor; Title: string);\r\n begin\r\n   AddMarker(Lat, Lon, Shape, Color, clBlack, 1, Title);\r\n end;\r\n\r\nprocedure TGoogleMaps.AddGPX(AGPX: string; AColor: TColor; AWidth: integer;\r\n  AOpacity: double);\r\nvar\r\n  Points: TJSArray;\r\n  LatMax,LonMax,LatMin,LonMin: double;\r\nbegin\r\n  Points := TJSArray.new;\r\n  asm\r\n    var parser = new DOMParser();\r\n    var doc = parser.parseFromString(AGPX, 'text/xml');\r\n    var trk = doc.getElementsByTagName(\"trk\")[0];\r\n    var name = trk.getElementsByTagName(\"name\")[0];\r\n    var trkseg = doc.getElementsByTagName(\"trkseg\")[0];\r\n    var i = trkseg.getElementsByTagName(\"trkpt\").length;\r\n    var trkpt;\r\n    var j;\r\n    var lat;\r\n    var lon;\r\n    var bounds = new google.maps.LatLngBounds ();\r\n\r\n    for (j= 0; j < i; j++)\r\n    {\r\n      trkpt = trkseg.getElementsByTagName(\"trkpt\")[j];\r\n      lat = trkpt.getAttribute('lat');\r\n      lon = trkpt.getAttribute('lon');\r\n\r\n      var p = new google.maps.LatLng(lat, lon);\r\n  \t  Points.push(p);\r\n      bounds.extend(p);\r\n    }\r\n    LatMax = bounds.getNorthEast().lat();\r\n    LonMax = bounds.getNorthEast().lng();\r\n\r\n    LatMin = bounds.getSouthWest().lat();\r\n    LonMin = bounds.getSouthWest().lng();\r\n  end;\r\n\r\n  AddPolyLine(Points, AColor, AWidth, AOpacity);\r\n  FitBounds(LatMin, LonMin, LatMax, LonMax);\r\nend;\r\n\r\nprocedure TGoogleMaps.AddKML(Url: string; ZoomToBounds: Boolean);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr: string;\r\n  ptr: Pointer;\r\nbegin\r\n  ptr := @HandleKMLClick;\r\n  map := GetMap;\r\n\r\n  asm\r\n    var kml = new google.maps.KmlLayer(Url, {\r\n      map: map,\r\n      clickable: true,\r\n      preserveViewport: !ZoomToBounds\r\n  \t});\r\n\r\n    kml.idx = this.FKMLs.length;\r\n    kml.addListener('click', function() { ptr(kml); } );\r\n    this.FKMLs.push(kml);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.AddMarker(Lat, Lon: double; Shape: TGoogleMarkerShape;\r\n  Color: TColor; BorderColor: TColor; Scale: Double; CustomShape: string; Title: string);\r\nvar\r\n  map: TJSHTMLElement;\r\n  clr: string;\r\n  bclr: string;\r\n  pth: string;\r\n  scl: string;\r\n  ptr: pointer;\r\nbegin\r\n  ptr := @HandleMarkerClick;\r\n  map := GetMap;\r\n  clr := ColorToHTML(Color);\r\n  bclr := ColorToHTML(BorderColor);\r\n  scl := StringReplace(FloatToStr(Scale), ',', '.', []);\r\n\r\n  case Shape of\r\n  msPin: pth:= 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z';\r\n  msPinDot: pth := 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30 a 2,2 0 1,1 4,0 2,2 0 1,1 -4,0';\r\n  msFlag:  pth := 'M 0,0 -1,-2 V -43 H 1 V -2 z M 1,-40 H 30 V -20 H 1 z';\r\n  msBookmark: pth := 'M17 3h-10c-1.1 0-1.99.9-1.99 2l-.01 16 7-3 7 3v-16c0-1.1-.9-2-2-2z';\r\n  msFlagSmall: pth := 'M14.4 6l-.4-2h-9v17h2v-7h5.6l.4 2h7v-10z';\r\n  msHome: pth := 'M10 20v-6h4v6h5v-8h3l-10-9-10 9h3v8z';\r\n  msFavorite: pth := 'M12 21.35l-1.45-1.32c-5.15-4.67-8.55-7.75-8.55-11.53 0-3.08 2.42-5.5 5.5-5.5 1.74 0 3.41.81 4.5 2.09 1.09-1.28 2.76-2.09 4.5-2.09 3.08 0 5.5 2.42 5.5 5.5 0 3.78-3.4 6.86-8.55 11.54l-1.45 1.31z';\r\n  msStar: pth := 'M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z';\r\n  msCustom: pth := CustomShape;\r\n  end;\r\n\r\n  asm\r\n    function pinSymbol(color, bcolor, scale) {\r\n    return {\r\n        path: pth,\r\n        fillColor: color,\r\n        fillOpacity: 1,\r\n        strokeColor: bcolor,\r\n        strokeWeight: 1,\r\n        scale: parseFloat(scale),\r\n        };\r\n    }\r\n    var myLatLng = {lat: Lat, lng: Lon};\r\n    var marker = new google.maps.Marker({\r\n          position: myLatLng,\r\n          map: map,\r\n          title: Title,\r\n          icon: pinSymbol(clr, bclr, scl)\r\n        });\r\n    marker.idx = this.FMarkers.length;\r\n    marker.addListener('click', function() { ptr(marker); } );\r\n\r\n    this.FMarkers.push(marker);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.BindEvents;\r\nvar\r\n  map: TJSHTMLElement;\r\n  ptr1,ptr2,ptr3,ptr4,ptr5: pointer;\r\n  dirsvc, dirdispl: TJSElement;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  map := GetMap;\r\n\r\n  if Assigned(map) and not FBound and not (csDesigning in ComponentState) then\r\n  begin\r\n    ptr1 := @HandleMapClick;\r\n    ptr2 := @HandleMapDblClick;\r\n    ptr3 := @HandleMapPan;\r\n    ptr4 := @HandleMapZoom;\r\n    ptr5 := @HandleMapIdle;\r\n\r\n    asm\r\n      this.FMarkers = [];\r\n      this.FPolygons = [];\r\n      this.FPolylines = [];\r\n      this.FCircles = [];\r\n      this.FRectangles = [];\r\n      this.FKMLs = [];\r\n    end;\r\n\r\n\r\n    asm\r\n      dirsvc = new google.maps.DirectionsService;\r\n      dirdispl = new google.maps.DirectionsRenderer;\r\n      dirdispl.setMap(map);\r\n      map.addListener('click', ptr1);\r\n      map.addListener('dblclick', ptr2);\r\n      map.addListener('center_changed',ptr3);\r\n      map.addListener('zoom_changed',ptr4);\r\n      map.addListener('tilesloaded',ptr5);\r\n    end;\r\n\r\n    FDirectionsService := dirsvc;\r\n    FDirectionsDisplay := dirdispl;\r\n\r\n    FBound := true;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\nprocedure TGoogleMaps.ClearCircles;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FCircles.length; i++) {\r\n          this.FCircles[i].setMap(null);\r\n          }\r\n    this.FMarkers = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearKMLs;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FKMLs.length; i++) {\r\n          this.FKMLs[i].setMap(null);\r\n          }\r\n    this.FKMLs = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearMarkers;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FMarkers.length; i++) {\r\n          this.FMarkers[i].setMap(null);\r\n          }\r\n    this.FMarkers = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearPolygons;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FPolygons.length; i++) {\r\n          this.FPolygons[i].setMap(null);\r\n          }\r\n    this.FPolyLines = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearPolyLines;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FPolylines.length; i++) {\r\n          this.FPolylines[i].setMap(null);\r\n          }\r\n    this.FPolyLines = [];\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ClearRectangles;\r\nbegin\r\n  asm\r\n    for (var i = 0; i < this.FRectangles.length; i++) {\r\n          this.FRectangles[i].setMap(null);\r\n          }\r\n    this.FRectangles = [];\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.CreateElement: TJSElement;\r\nbegin\r\n  FDirectionsService := nil;\r\n  FDirectionsDisplay := nil;\r\n\r\n  Result := document.createElement('DIV');\r\n  Result.setAttribute('id', GetID);\r\n  FMap := nil;\r\nend;\r\n\r\nprocedure TGoogleMaps.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FOptions := TGoogleMapsOptions.Create(Self);\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nfunction TGoogleMaps.DoLoaded(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  BindEvents;\r\n  Result := true;\r\n\r\n  Options.SetMapStyle(Options.MapStyle);\r\n\r\n  if Assigned(OnMapLoaded) then\r\n    OnMapLoaded(Self);\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMaps.FitBounds(LatMin, LonMin, LatMax, LonMax: double);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n\r\n  asm\r\n    var ne = new google.maps.LatLng(LatMax, LonMax);\r\n    var sw = new google.maps.LatLng(LatMin, LonMin);\r\n    var bounds = new google.maps.LatLngBounds(sw,ne);\r\n    map.fitBounds(bounds);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TGoogleMaps.Loaded;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TGoogleMaps.GeoCode(const Address: string);\r\nvar\r\n  FURL: string;\r\nbegin\r\n  FReq := TJSXMLHttpRequest.new;\r\n  FReq.addEventListener('load', @HandleResponse);\r\n  FReq.addEventListener('abort',@HandleAbort);\r\n\r\n  FURL := 'https://maps.googleapis.com/maps/api/geocode/json?address=' + encodeURIComponent(Address) +'&key=' + APIKey;\r\n  FReq.open('GET', FURL);\r\n  FReq.send;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMaps.PanTo(Lat, Lon: double);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) then\r\n  begin\r\n    asm\r\n      map.panTo(new google.maps.LatLng(Lat, Lon));\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetMap: TJSHTMLElement;\r\nvar\r\n  map: TJSHTMLElement;\r\n  id: string;\r\nbegin\r\n  if Assigned(FMap) then\r\n    Result := FMap\r\n  else\r\n  begin\r\n    map := nil;\r\n\r\n    id := GetID;\r\n    asm\r\n      var el = document.getElementById(id);\r\n      if (el != null) {\r\n        map = el.gMap;\r\n      }\r\n    end;\r\n\r\n    Result := map;\r\n    if Assigned(map) then\r\n      FMap := Result;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetBounds(var NorthEastLat, NorthEastLon, SouthWestLat,\r\n  SouthWestLon: Double): Boolean;\r\nvar\r\n  neLon, neLat, swLon, swLat: String;\r\nbegin\r\n  Result := false;\r\n  NorthEastLon := -1;\r\n  NorthEastLat := -1;\r\n  SouthWestLon := -1;\r\n  SouthWestLat := -1;\r\n\r\n  asm\r\n    neLon = map.getBounds().getNorthEast().lng().toString();\r\n    neLat = map.getBounds().getNorthEast().lat().toString();\r\n    swLon = map.getBounds().getSouthWest().lng().toString();\r\n    swLat = map.getBounds().getSouthWest().lat().toString();\r\n  end;\r\n\r\n  if (neLon <> '') and (neLat <> '') and (swLon <> '') and (swLat <> '') then\r\n  begin\r\n    NorthEastLon := StrToFloat(swLon);\r\n    NorthEastLat := StrToFloat(swLat);\r\n    SouthWestLon := StrToFloat(swLon);\r\n    SouthWestLat := StrToFloat(swLat);\r\n    Result := true;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetCenter(var Lat, Lon: Double): Boolean;\r\nvar\r\n  sLon, sLat: String;\r\nbegin\r\n  Result := false;\r\n  Lon := -1;\r\n  Lat := -1;\r\n\r\n  asm\r\n    sLon = map.getCenter().lng().toString();\r\n    sLat = map.getCenter().lat().toString();\r\n  end;\r\n\r\n  if (sLon <> '') and (sLat <> '') then\r\n  begin\r\n    Lon := StrToFloat(sLon);\r\n    Lat := StrToFloat(sLat);\r\n    Result := true;\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.GetCircle(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FCircles[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction TGoogleMaps.GetMarker(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FMarkers[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TGoogleMaps.GetPolygon(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FPolygon[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TGoogleMaps.GetPolyline(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FPolyline[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TGoogleMaps.GetRectangle(AIndex: integer): TJSObject;\r\nvar\r\n  res: TJSObject;\r\nbegin\r\n  asm\r\n    res = this.FGetRectangle[AIndex];\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TGoogleMaps.HandleAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  //\r\n  Result := true;\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleCircleClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnCircleClick) then\r\n    OnCircleClick(Self, idx, TJSObject(e));\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleKMLClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnKMLClick) then\r\n    OnKMLClick(Self, idx, TJSObject(e));\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleRectangleClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnRectangleClick) then\r\n    OnRectangleClick(Self, idx, TJSObject(e));\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapClick(e: TJSEvent);\r\nvar\r\n  lon,lat: double;\r\nbegin\r\n  asm\r\n    lon = e.latLng.lng();\r\n    lat = e.latLng.lat();\r\n  end;\r\n\r\n  if Assigned(OnMapClick) then\r\n    OnMapClick(Self, lon, lat);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapDblClick(e: TJSEvent);\r\nvar\r\n  lon,lat: double;\r\nbegin\r\n  asm\r\n    lon = e.latLng.lng();\r\n    lat = e.latLng.lat();\r\n  end;\r\n\r\n  if Assigned(OnMapDblClick) then\r\n    OnMapDblClick(Self, lon, lat);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapIdle(e: TJSEvent);\r\nbegin\r\n  if Assigned(OnMapIdle) then\r\n    OnMapIdle(Self);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapPan(e: TJSEvent);\r\nvar\r\n  lon,lat: double;\r\nbegin\r\n  asm\r\n    var c = map.getCenter();\r\n    lon = c.lng();\r\n    lat = c.lat();\r\n  end;\r\n\r\n  if Assigned(OnMapPan) then\r\n    OnMapPan(Self, lon, lat);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMapZoom(e: TJSEvent);\r\nvar\r\n  map: TJSHTMLElement;\r\n  zoom: integer;\r\nbegin\r\n  map := GetMap;\r\n  asm\r\n    zoom = map.getZoom();\r\n  end;\r\n  if Assigned(OnMapZoom) then\r\n    OnMapZoom(Self, zoom);\r\nend;\r\n\r\nprocedure TGoogleMaps.HandleMarkerClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnMarkerClick) then\r\n    OnMarkerClick(Self, idx, TJSObject(e));\r\nend;\r\n\r\n\r\nprocedure TGoogleMaps.HandlePolygonClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnPolygonClick) then\r\n    OnPolygonClick(Self, idx, TJSObject(e));\r\nend;\r\n\r\nprocedure TGoogleMaps.HandlePolylineClick(e: TJSEvent);\r\nvar\r\n  idx: integer;\r\nbegin\r\n  asm\r\n    idx = e.idx;\r\n  end;\r\n\r\n  if Assigned(OnPolylineClick) then\r\n    OnPolylineClick(Self, idx, TJSObject(e));\r\nend;\r\n\r\nfunction TGoogleMaps.HandleResponse(Event: TEventListenerEvent): boolean;\r\nvar\r\n  fnd: boolean;\r\n  reslat, reslon: double;\r\nbegin\r\n  Result := true;\r\n  fnd := false;\r\n\r\n  asm\r\n    var s = Event.target.responseText;\r\n    var js = JSON.parse(s);\r\n    if (js.status == \"OK\") {\r\n      fnd = true;\r\n      var lat = js.results[0].geometry.location.lat;\r\n      var lng = js.results[0].geometry.location.lng;\r\n      reslon = lng;\r\n      reslat = lat;\r\n    }\r\n  end;\r\n\r\n  if fnd and Assigned(OnGeoCoded) then\r\n  begin\r\n    OnGeoCoded(Self, reslon, reslat);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemoveDirections;\r\nvar\r\n  dirdispl: TJSElement;\r\nbegin\r\n  if not Assigned(FDirectionsDisplay) then\r\n    BindEvents;\r\n\r\n  dirdispl := FDirectionsDisplay;\r\n\r\n  asm\r\n    dirdispl.setMap(null);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\nprocedure TGoogleMaps.SetAPIKey(const Value: string);\r\nbegin\r\n  if FAPIKey <> Value then\r\n  begin\r\n    FAPIKey := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMaps.SetCenter(Lat, Lon: double);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  asm\r\n    map.setCenter(new google.maps.LatLng(Lat, Lon));\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetDoubleClickZoom(AValue: Boolean);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  asm\r\n    map.setOptions( {disableDoubleClickZoom:!AValue} );\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetDraggable(AValue: Boolean);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  asm\r\n    map.setOptions( {draggable:AValue} );\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMapType(AMapType: TGoogleMapType);\r\nvar\r\n  map: TJSHTMLElement;\r\n  smt: string;\r\nbegin\r\n  map := GetMap;\r\n\r\n  case AMapType of\r\n    mtDefault: smt := 'roadmap';\r\n    mtSatellite: smt := 'satellite';\r\n    mtHybrid: smt := 'hybrid';\r\n    mtTerrain: smt := 'terrain';\r\n  end;\r\n\r\n  asm\r\n    map.setMapTypeId(smt);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemoveCircle(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FCircles[AIndex].setMap(null);\r\n      this.FCircles.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TGoogleMaps.RemoveMarker(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FMarkers.length)\r\n    {\r\n      this.FMarkers[AIndex].setMap(null);\r\n      this.FMarkers.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemovePolygon(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FPolygons[AIndex].setMap(null);\r\n      this.FPolygons.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemovePolyline(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolylines.length)\r\n    {\r\n      this.FPolylines[AIndex].setMap(null);\r\n      this.FPolylines.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.RemoveRectangle(AIndex: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FRectangles[AIndex].setMap(null);\r\n      this.FRectangles.splice(AIndex, 1);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMarkerIcon(AIndex: Integer; Url: string);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FMarkers.length)\r\n    {\r\n      this.FMarkers[AIndex].setIcon(Url);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMarkerLocation(AIndex: Integer; Lat, Lon: Double);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FMarkers.length)\r\n    {\r\n      this.FMarkers[AIndex].setPosition(new google.maps.LatLng(Lat, Lon));\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetMarkerTitle(AIndex: Integer; ATitle: string);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FMarkers.length)\r\n    {\r\n      this.FMarkers[AIndex].setTitle(ATitle);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetPolygonColors(AIndex: Integer; AFillColor,\r\n  AStrokeColor: TColor);\r\nvar\r\n  clrF, clrS: string;\r\nbegin\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FPolygons[AIndex].setOptions({ fillColor: clrF, strokeColor: clrS });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetPolygonPoints(AIndex: Integer; Points: TJSArray);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolygons.length)\r\n    {\r\n      this.FPolygons[AIndex].setOptions({ path: Points });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetPolylineColor(AIndex: Integer; AColor: TColor);\r\nvar\r\n  clr: string;\r\nbegin\r\n  clr := ColorToHTML(AColor);\r\n  asm\r\n    if (AIndex < this.FPolylines.length)\r\n    {\r\n      this.FPolylines[AIndex].setOptions({ strokeColor: clr });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetPolylinePoints(AIndex: Integer; Points: TJSArray);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FPolylines.length)\r\n    {\r\n      this.FPolylines[AIndex].setOptions({ path: Points });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetRectangleColors(AIndex: Integer; AFillColor,\r\n  AStrokeColor: TColor);\r\nvar\r\n  clrF, clrS: string;\r\nbegin\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n  asm\r\n    if (AIndex < this.FRectangles.length)\r\n    {\r\n      this.FRectangles[AIndex].setOptions({ fillColor: clrF, strokeColor: clrS });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetRectangleLocation(AIndex: Integer; NorthEastLat,\r\n  NorthEastLon, SouthWestLat, SouthWestLon: double);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FRectangles.length)\r\n    {\r\n      var NELatLng = {lat: NorthEastLat, lng: NorthEastLon};\r\n      var SWLatLng = {lat: SouthWestLat, lng: SouthWestLon};\r\n      this.FRectangles[AIndex].setOptions({ bounds: new google.maps.LatLngBounds(NELatLng, SWLatLng) });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetCircleCenter(AIndex: Integer; Lat, Lon: Double);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FCircles.length)\r\n    {\r\n      this.FCircles[AIndex].setCenter(new google.maps.LatLng(Lat, Lon));\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetCircleColors(AIndex: Integer; AFillColor,\r\n  AStrokeColor: TColor);\r\nvar\r\n  clrF, clrS: string;\r\nbegin\r\n  clrF := ColorToHTML(AFillColor);\r\n  clrS := ColorToHTML(AStrokeColor);\r\n  asm\r\n    if (AIndex < this.FCircles.length)\r\n    {\r\n      this.FCircles[AIndex].setOptions({ fillColor: clrF, strokeColor: clrS });\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetCircleRadius(AIndex, Radius: Integer);\r\nbegin\r\n  asm\r\n    if (AIndex < this.FCircles.length)\r\n    {\r\n      this.FCircles[AIndex].setRadius(Radius);\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetScrollWheel(AValue: Boolean);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  asm\r\n    map.setOptions( {scrollWheel:AValue} );\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.SetZoom(Zoom: Integer);\r\nvar\r\n  map: TJSHTMLElement;\r\nbegin\r\n  map := GetMap;\r\n  if Assigned(map) then\r\n  begin\r\n    asm\r\n      map.setZoom(Zoom);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ShowDirections(SourceLon, SourceLat, DestLon,\r\n  DestLat: double; ATravelMode: TGoogleTravelMode = tmDriving;\r\n  WayPoints: TStringList = nil; OptimizeWayPoints: Boolean = False;\r\n  AvoidHighways: Boolean = False; AvoidTolls: Boolean = False);\r\nvar\r\n  dirsvc,dirdispl,map: TJSElement;\r\n  tm: string;\r\n  wp: TJSArray;\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(FDirectionsDisplay) then\r\n    BindEvents;\r\n\r\n  dirsvc := FDirectionsService;\r\n  dirdispl := FDirectionsDisplay;\r\n  map := GetMap;\r\n  tm := TravelModeStr(ATravelMode);\r\n  wp := TJSArray.New;\r\n  if WayPoints <> nil then\r\n  begin\r\n    for I := 0 to WayPoints.Count - 1 do\r\n      wp.Push(New(['location', WayPoints[I]]));\r\n  end;\r\n\r\n  asm\r\n    var sourcelatlon = new google.maps.LatLng(SourceLat, SourceLon);\r\n    var destlatlon = new google.maps.LatLng(DestLat, DestLon);\r\n\r\n    dirdispl.setMap(map);\r\n    dirsvc.route({\r\n          origin: sourcelatlon,\r\n          destination: destlatlon,\r\n          waypoints: wp,\r\n          optimizeWaypoints: OptimizeWayPoints,\r\n          avoidHighways: AvoidHighways,\r\n          avoidTolls: AvoidTolls,\r\n          travelMode: tm\r\n        }, function(response, status) {\r\n          if (status === 'OK') {\r\n            dirdispl.setDirections(response);\r\n          } else {\r\n            window.alert('Directions request failed due to ' + status);\r\n          }\r\n        });\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.HideStreetView;\r\nvar\r\n  map: TJSElement;\r\nbegin\r\n  map := GetMap;\r\n  asm\r\n    map.streetView.setVisible(false);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ShowStreetView(Lat, Lon: Double; Heading, Zoom,\r\n  Pitch: Integer);\r\nvar\r\n  map: TJSElement;\r\n  mapid: string;\r\nbegin\r\n  map := GetMap;\r\n  mapid := GetID;\r\n  asm\r\n    var LatLng = {lat: Lat, lng: Lon};\r\n    var panorama = new google.maps.StreetViewPanorama(\r\n        document.getElementById(mapid), {\r\n          position: LatLng,\r\n          pov: {\r\n            heading: Heading,\r\n            zoom: Zoom,\r\n            pitch: Pitch\r\n          }\r\n        });\r\n    map.setStreetView(panorama);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.ShowDirections(Source, Destination: string;\r\n  ATravelMode: TGoogleTravelMode; WayPoints: TStringList; OptimizeWayPoints,\r\n  AvoidHighways, AvoidTolls: Boolean);\r\nvar\r\n  dirsvc,dirdispl,map: TJSElement;\r\n  tm: string;\r\n  wp: TJSArray;\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(FDirectionsDisplay) then\r\n    BindEvents;\r\n\r\n  dirsvc := FDirectionsService;\r\n  dirdispl := FDirectionsDisplay;\r\n  map := GetMap;\r\n  tm := TravelModeStr(ATravelMode);\r\n  wp := TJSArray.New;\r\n  if WayPoints <> nil then\r\n  begin\r\n    for I := 0 to WayPoints.Count - 1 do\r\n      wp.Push(New(['location', WayPoints[I]]));\r\n  end;\r\n\r\n  asm\r\n    dirdispl.setMap(map);\r\n\r\n    dirsvc.route({\r\n          origin: Source,\r\n          destination: Destination,\r\n          waypoints: wp,\r\n          optimizeWaypoints: OptimizeWayPoints,\r\n          avoidHighways: AvoidHighways,\r\n          avoidTolls: AvoidTolls,\r\n          travelMode: tm\r\n        }, function(response, status) {\r\n          if (status === 'OK') {\r\n            dirdispl.setDirections(response);\r\n          } else {\r\n            window.alert('Directions request failed due to ' + status);\r\n          }\r\n        });\r\n  end;\r\nend;\r\n\r\nfunction TGoogleMaps.TravelModeStr(ATravelMode: TGoogleTravelMode): string;\r\nbegin\r\n  Result := 'DRIVING';\r\n  case ATravelMode of\r\n    tmDriving: Result := 'DRIVING';\r\n    tmWalking: Result := 'WALKING';\r\n    tmBicycling: Result := 'BICYCLING';\r\n    tmTransit: Result := 'TRANSIT';\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMaps.UpdateElement;\r\nvar\r\n  map: TJSHTMLElement;\r\n  id: string;\r\n  srcurl: string;\r\n  scriptsrc: string;\r\n  scr: TJSElement;\r\n  sp: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if FUpdateCount > 0 then\r\n    Exit;\r\n\r\n  if not FCode and (FAPIKey <> '') then\r\n  begin\r\n    FCode := true;\r\n    id := GetID;\r\n\r\n    srcurl := 'https://maps.googleapis.com/maps/api/js?key=' + FAPIKey + '&callback=initMap'+id;\r\n\r\n    scriptsrc := 'function initMap'+id+'() { '+#13#10+\r\n         'var el = document.getElementById(\"'+id+'\");'+#13#10+\r\n         'if (el == null) { alert(\"Google Maps DIV element not found!\"); }'+#13#10+\r\n         'map = new google.maps.Map(el, {'+#13#10+\r\n         'center: {lat: ' + StringReplace(FloatToStr(Options.DefaultLatitude), ',', '.', [rfReplaceAll]) + ', lng: ' + StringReplace(FloatToStr(Options.DefaultLongitude), ',', '.', [rfReplaceAll]) + '},'+#13#10+\r\n         'zoom: ' + IntToStr(Options.DefaultZoomLevel) + '});'+#13#10+\r\n         'el.gMap = map;'+#13#10+\r\n         '}';\r\n\r\n    scr := document.createElement('script');\r\n    scr.addEventListener('load',@DoLoaded);\r\n    asm\r\n      scr.defer = true;\r\n      scr.async = true;\r\n      scr.src = srcurl;\r\n      scr.type = 'text/javascript';\r\n    end;\r\n    document.head.appendChild(scr);\r\n\r\n    asm\r\n      var script = document.createElement('script');\r\n      script.innerHTML = scriptsrc;\r\n      document.head.appendChild(script);\r\n    end;\r\n  end\r\n  else if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('border', '1px solid gray');\r\n    ElementHandle.style.setProperty('background-color', '#eee');\r\n    if (ElementHandle.childElementCount = 0) then\r\n    begin\r\n      sp := TJSHTMLElement(document.createElement('SPAN'));\r\n\r\n      srcurl := '<br>Set the Google Maps JavaScript API key via WebGoogleMaps.APIKey in order to see the map.<br>'+\r\n                'Request the key via <a href=\"https://developers.google.com/maps/documentation/javascript/get-api-key\">this page</a>';\r\n      sp.innerHTML := srcurl;\r\n      ElementHandle.appendChild(sp);\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\n{ TFileUpload }\r\n\r\n// https://css-tricks.com/drag-and-drop-file-uploading/\r\n// https://html5demos.com/dnd-upload/\r\n\r\nfunction isAdvancedUpload: boolean; assembler;\r\nasm\r\n  var div = document.createElement('div');\r\n  return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\r\nend;\r\n\r\n\r\nprocedure TFileUpload.Clear;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := document.getElementByID('FP'+ElementId);\r\n  if Assigned(el) then\r\n  begin\r\n    el['type'] := '';\r\n    el['type'] := 'file';\r\n  end;\r\n\r\n  el := document.getElementById(ElementID+'fileslist');\r\n  if Assigned(el) then\r\n  begin\r\n    el.innerHTML := '';\r\n  end;\r\n\r\n  while Files.Count > 0 do\r\n    Files.Delete(0);\r\nend;\r\n\r\nconstructor TFileUpload.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n\r\n  Caption := 'Choose a file';\r\n  FDragCaption := 'or drag it here';\r\n\r\n  FFiles := TFiles.Create(Self);\r\n\r\n  FFileList := TStringList.Create;\r\n\r\n\r\n  AddControlStyle(\r\n  '  \t.box'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\tfont-size: 1.25rem; /* 20 */'+\r\n\t'\t\t\t\tbackground-color: #c8dadf;'+\r\n\t' \t\t\tposition: relative;'+\r\n\t'\t    \tpadding: 2px 2px;'+\r\n\t'\t\t}'+\r\n\t'\t\t.box.has-advanced-upload'+\r\n\t'\t\t{'+\r\n\t'\t\t\toutline: 2px dashed #92b0b3;'+\r\n\t'\t\t\toutline-offset: -10px;'+\r\n\t'\t\t\t-webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;'+\r\n\t'\t\t\ttransition: outline-offset .15s ease-in-out, background-color .15s linear;'+\r\n\t'\t\t}'+\r\n\t'\t\t.box.is-dragover'+\r\n\t'\t\t{'+\r\n\t'\t\t\toutline-offset: -20px;'+\r\n\t'\t\t\toutline-color: #c8dadf;'+\r\n\t'\t\t\tbackground-color: #fff;'+\r\n\t'\t\t}'+\r\n\t'\t\t\t.box__dragndrop,'+\r\n\t'\t\t\t.box__icon'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\tdisplay: none;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box.has-advanced-upload .box__dragndrop'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\tdisplay: inline;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box.has-advanced-upload .box__icon'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\twidth: 100%;'+\r\n\t'\t\t\t\theight: 80px;'+\r\n\t'\t\t\t\tfill: #92b0b3;'+\r\n  '\t\t\t\tdisplay: block;'+\r\n\t'\t\t\t\tmargin-bottom: 40px;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box.is-uploading .box__input,'+\r\n\t'\t\t\t.box.is-success .box__input,'+\r\n\t'\t\t\t.box.is-error .box__input'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\tvisibility: hidden;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box__uploading,'+\r\n\t'\t\t\t.box__success,'+\r\n\t'\t\t\t.box__error'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\tdisplay: none;'+\r\n\t'\t\t\t}'+\r\n\t'\t\t\t.box.is-uploading .box__uploading,'+\r\n\t'\t\t\t.box.is-success .box__success,'+\r\n\t'\t\t\t.box.is-error .box__error'+\r\n\t'\t\t\t{'+\r\n\t'\t\t\t\tdisplay: block;'+\r\n\t'\t\t\t\tposition: absolute;'+\r\n\t'\t\t\t\ttop: 50%;'+\r\n\t'       right: 0;'+\r\n  '\t\t\t\tleft: 0;'+\r\n\t'\t   \t\t-webkit-transform: translateY( -50% );'+\r\n\t'\t\t\t\t\ttransform: translateY( -50% );'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__uploading'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tfont-style: italic;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__success'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\t-webkit-animation: appear-from-inside .25s ease-in-out;'+\r\n\t'\t\t\t\t\tanimation: appear-from-inside .25s ease-in-out;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t\t@-webkit-keyframes appear-from-inside'+\r\n\t'\t\t\t\t\t{'+\r\n\t'\t\t\t\t\t\tfrom\t{ -webkit-transform: translateY( -50% ) scale( 0 ); }'+\r\n\t'\t\t\t\t\t\t75%\t\t{ -webkit-transform: translateY( -50% ) scale( 1.1 ); }'+\r\n\t'\t\t\t\t\t\tto\t\t{ -webkit-transform: translateY( -50% ) scale( 1 ); }'+\r\n\t'\t\t\t\t\t}'+\r\n\t'\t\t\t\t\t@keyframes appear-from-inside'+\r\n\t'\t\t\t\t\t{'+\r\n\t'\t\t\t\t\t\tfrom\t{ transform: translateY( -50% ) scale( 0 ); }'+\r\n\t'\t\t\t\t\t\t75%\t\t{ transform: translateY( -50% ) scale( 1.1 ); }'+\r\n\t'\t\t\t\t\t\tto\t\t{ transform: translateY( -50% ) scale( 1 ); }'+\r\n\t'\t\t\t\t\t}'+\r\n\t'\t\t\t\t.box__restart'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tfont-weight: 700;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__restart:focus,'+\r\n\t'\t\t\t\t.box__restart:hover'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tcolor: #39bfd3;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__file'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\twidth: 0.1px;'+\r\n\t'\t\t\t\t\theight: 0.1px;'+\r\n\t'\t\t\t\t\topacity: 0;'+\r\n\t'\t\t\t\t\toverflow: hidden;'+\r\n\t'\t\t\t\t\tposition: absolute;'+\r\n\t'\t\t\t\t\tz-index: -1;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__file + label'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tmax-width: 80%;'+\r\n\t'\t\t\t\t\ttext-overflow: ellipsis;'+\r\n\t'\t\t\t\t\twhite-space: nowrap;'+\r\n\t'\t\t\t\t\tcursor: pointer;'+\r\n\t'\t\t\t\t\tdisplay: inline-block;'+\r\n\t'\t\t\t\t\toverflow: hidden;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__file + label:hover strong,'+\r\n\t'\t\t\t\t.box__file:focus + label strong,'+\r\n\t'\t\t\t\t.box__file.has-focus + label strong'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tcolor: #39bfd3;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t.box__file:focus + label,'+\r\n\t'\t\t\t\t.box__file.has-focus + label'+\r\n\t'\t\t\t\t{'+\r\n\t' \t\t\t\t\toutline: 1px dotted #000;'+\r\n\t'\t\t\t\t\toutline: -webkit-focus-ring-color auto 5px;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t\t.box__file + label *'+\r\n\t'\t\t\t\t\t{'+\r\n\t'\t\t\t\t\t\t/* pointer-events: none; */ /* in case of FastClick lib use */'+\r\n\t'\t\t\t\t\t}'+\r\n\t'\t\t\t\t.box__button'+\r\n\t'\t\t\t\t{'+\r\n\t'\t\t\t\t\tfont-weight: 700;'+\r\n\t'\t\t\t\t\tcolor: #e5edf1;'+\r\n\t'\t\t\t\t\tbackground-color: #39bfd3;'+\r\n\t'\t\t\t\t\tdisplay: none;'+\r\n\t'\t\t\t\t\tpadding: 8px 16px;'+\r\n\t'\t\t\t\t\tmargin: 10px auto 0;'+\r\n\t'\t\t\t\t}'+\r\n\t'\t\t\t\t\t.box__button:hover,'+\r\n\t'\t\t\t\t\t.box__button:focus'+\r\n\t'\t\t\t\t\t{'+\r\n\t'\t\t\t\t\t\tbackground-color: #0f3c4b;'+\r\n\t'\t\t\t\t\t}'\r\n  );\r\n\r\nend;\r\n\r\nfunction TFileUpload.CreateElement: TJSElement;\r\nbegin\r\n  FCreateRef := Name;\r\n  Result := document.createElement('FORM');\r\n  Result.setAttribute('method','post');\r\n  Result.setAttribute('class','box');\r\n  Result.setAttribute('enctype','multipart/form-data');\r\n//    <span style=\"display:inline-block;\">\r\n  Result.innerHTML :=\r\n   '<div class=\"box__input\" style=\"text-align: center;\">' +\r\n   '<svg class=\"box__icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"43\" viewBox=\"0 0 50 43\">'+\r\n   '<path d=\"M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z\"/></svg>'+\r\n   '<input class=\"box__file\" type=\"file\" name=\"files[]\" id=\"FP'+Name+'\" data-multiple-caption=\"{count} files selected\" multiple/>' +\r\n   '<label for=\"FP'+Name+'\"><strong id=\"'+Name+'lbl\">'+Caption+'</strong>&nbsp;<span class=\"box__dragndrop\" id=\"'+Name+'drag\">'+FDragCaption+'</span>.</label>' +\r\n   '<button class=\"box__button\" type=\"submit\">Upload</button>' +\r\n   '<br><span style=\"display:inline-block;\" id=\"'+Name+'fileslist\"></span>' +\r\n   '</div><div class=\"box__uploading\">Uploading&hellip;</div>';\r\n\r\n   Result.addEventListener('drop', @HandleDroppedFiles);\r\n\r\n   Result.addEventListener('dragenter', @HandleDragOver);\r\n   Result.addEventListener('dragover', @HandleDragOver);\r\n\r\n   Result.addEventListener('dragend', @HandleDragEnd);\r\n   Result.addEventListener('dragleave', @HandleDragEnd);\r\n\r\n   if isAdvancedUpload then\r\n     Result.classList.add( 'has-advanced-upload' );\r\nend;\r\n\r\nprocedure TFileUpload.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FMultifile := false;\r\n  FShowFiles := false;\r\n  FEventInit := false;\r\n  Width := 170;\r\n  Height := 190;\r\nend;\r\n\r\ndestructor TFileUpload.Destroy;\r\nbegin\r\n  FFiles.Free;\r\n  FFilelist.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TFileUpload.DoHandleChange(e: TJSEvent): boolean;\r\nvar\r\n  el: TJSHTMLElement;\r\n  curfiles: TJSHTMLFileList;\r\nbegin\r\n  Result := true;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    el := TJSHTMLElement(e.target);\r\n    if Assigned(el) then\r\n    begin\r\n      asm\r\n        curfiles = el.files;\r\n      end;\r\n      HandleFiles(curfiles);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TFileUpload.HandleDragEnd(Event: TJSDragEvent): boolean;\r\nbegin\r\n  Result := true;\r\n  Event.preventDefault();\r\n  Event.stopPropagation();\r\n\r\n  Container.setAttribute('class','box has-advanced-upload');\r\nend;\r\n\r\nfunction TFileUpload.HandleDragOver(Event: TJSDragEvent): boolean;\r\nbegin\r\n  Result := true;\r\n  Event.preventDefault();\r\n  Event.stopPropagation();\r\n\r\n  Container.setAttribute('class','box has-advanced-upload is-dragover');\r\nend;\r\n\r\nfunction TFileUpload.HandleDroppedFiles(Event: TJSDragEvent): boolean;\r\nvar\r\n  droppedfiles: TJSHTMLFileList;\r\n  span: TJSHTMLElement;\r\n  szFiles: string;\r\n\r\nbegin\r\n  Result := true;\r\n  Event.preventDefault();\r\n  Event.stopPropagation();\r\n\r\n  droppedFiles := Event.dataTransfer.files;\r\n  szFiles := HandleFiles(droppedfiles);\r\n\r\n  if ShowFiles then\r\n  begin\r\n    span := TJSHTMLElement(document.getElementById(ElementID+'fileslist'));\r\n    span.innerHTML := szFiles;\r\n  end;\r\n\r\n  Container.setAttribute('class','box has-advanced-upload');\r\nend;\r\n\r\nfunction TFileUpload.HandleFiles(files: TJSHTMLFileList): string;\r\nvar\r\n  i,sz: integer;\r\n  afile: TJSHTMLFile;\r\n  szFiles, m: string;\r\n  d: TJSDate;\r\nbegin\r\n  szFiles := '';\r\n\r\n  while FFiles.Count > 0 do\r\n    FFiles.Delete(0);\r\n  while FFileList.Count > 0 do\r\n    FFileList.Delete(0);\r\n\r\n  for i := 0 to files.length - 1 do\r\n  begin\r\n    afile := files.item(i);\r\n\r\n    asm\r\n      d = new Date(afile.lastModified);\r\n      m = afile.type;\r\n      sz = afile.size;\r\n    end;\r\n\r\n    with FFiles.Add do\r\n    begin\r\n      FileObject := afile;\r\n      Name := afile.Name;\r\n      MimeType := m;\r\n      Size := sz;\r\n      Modified := EncodeDate(d.Year + 1900, d.Month + 1, d.Date)+EncodeTime(d.Hours, d.Minutes, d.Seconds, d.Milliseconds);\r\n    end;\r\n\r\n    if Assigned(FFileList) then\r\n      FFileList.Add(afile.name);\r\n\r\n    if ShowFiles then\r\n    begin\r\n      if i > 0 then\r\n        szFiles := szFiles + '<br>';\r\n\r\n      szFiles := szFiles + afile.name;\r\n    end;\r\n\r\n    if not MultiFile then\r\n      break;\r\n  end;\r\n\r\n  Result := szFiles;\r\n\r\n  if Assigned(OnDroppedFiles) then\r\n    OnDroppedFiles(Self, FFileList);\r\nend;\r\n\r\nprocedure TFileUpload.SetAccept(const Value: string);\r\nbegin\r\n  if FAccept <> Value then\r\n  begin\r\n    FAccept := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TFileUpload.SetCaption(const AValue: string);\r\nbegin\r\n  if (Caption <> AValue) then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TFileUpload.SetDragCaption(const Value: string);\r\nbegin\r\n  FDragCaption := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TFileUpload.UpdateElement;\r\nvar\r\n  el:TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    el := TJSHTMLElement(document.getElementById('FP'+FCreateRef));\r\n\r\n    if Assigned(el) then\r\n    begin\r\n      if not FEventInit then\r\n      begin\r\n        FEventInit := true;\r\n        el.addEventListener('change', @DoHandleChange);\r\n      end;\r\n\r\n      if MultiFile then\r\n        el.SetAttribute('multiple','')\r\n      else\r\n        el.RemoveAttribute('multiple');\r\n\r\n      if FAccept <> '' then\r\n        el.SetAttribute('accept',FAccept)\r\n      else\r\n        el.RemoveAttribute('accept');\r\n    end;\r\n\r\n    el := TJSHTMLElement(document.getElementById(FCreateRef+'lbl'));\r\n    if Assigned(el) then\r\n    begin\r\n      el.innerHTML := Caption;\r\n    end;\r\n\r\n    el := TJSHTMLElement(document.getElementById(FCreateRef+'drag'));\r\n    if Assigned(el) then\r\n    begin\r\n      el.innerHTML := FDragCaption;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TTwitterFeed }\r\n\r\nfunction TTwitterFeed.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nprocedure TTwitterFeed.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nprocedure TTwitterFeed.SetFeed(const Value: string);\r\nbegin\r\n  FFeed := Value;\r\n  FUpdatedFeed := false;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TTwitterFeed.SetFeedLinkText(const Value: string);\r\nbegin\r\n  FFeedLinkText := Value;\r\n  UpdateElement;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TTwitterFeed.UpdateElement;\r\nvar\r\n  srcurl: string;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) and not IsUpdating and not FCode then\r\n  begin\r\n    srcurl := 'https://platform.twitter.com/widgets.js';\r\n\r\n    asm\r\n      var script = document.createElement('script');\r\n      script.src = srcurl;\r\n      script.async = true;\r\n      script.type = 'text/javascript';\r\n      script.charset = 'utf-8';\r\n      document.head.appendChild(script);\r\n    end;\r\n\r\n    FCode := true;\r\n  end;\r\n\r\n  if Assigned(ElementHandle) and not IsUpdating and not FUpdatedFeed then\r\n  begin\r\n    if (Feed <> '') then\r\n    begin\r\n      BorderStyle := bsNone;\r\n      ElementHandle.innerHTML :=\r\n        '<a class=\"twitter-timeline\" href=\"https://twitter.com/' + Feed +'\" data-chrome=\"nofooter noborders\">'+ FeedLinkText + '</a>';\r\n      asm\r\n        twttr.widgets.load()\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      if (csDesigning in ComponentState) then\r\n        RenderDesigning(ClassName, Container, Self, True);\r\n    end;\r\n    FUpdatedFeed := true;\r\n  end;\r\n\r\n  if Assigned(ElementHandle)  then\r\n    ElementHandle.style.setProperty('overflow-y','auto');\r\nend;\r\n{$HINTS ON}\r\n\r\n{ TBrowserControl }\r\n\r\nprocedure TBrowserControl.BindEvents;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nfunction TBrowserControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('IFRAME');\r\nend;\r\n\r\nprocedure TBrowserControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nprocedure TBrowserControl.Navigate(const AURL: string);\r\nbegin\r\n  URL := AURL;\r\nend;\r\n\r\nprocedure TBrowserControl.SetReferrerPolicy(\r\n  const Value: TBrowserReferrerPolicy);\r\nbegin\r\n  FReferrerPolicy := Value;\r\n  UpdateElementVisual;\r\nend;\r\n\r\nprocedure TBrowserControl.SetSandbox(const Value: TBrowserSandboxTypes);\r\nbegin\r\n  FSandbox := Value;\r\n  UpdateElementVisual;\r\nend;\r\n\r\nprocedure TBrowserControl.SetURL(const Value: string);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  FURL := Value;\r\n  el := ElementHandle;\r\n  el.setAttribute('src',Value);\r\nend;\r\n\r\nprocedure TBrowserControl.UpdateElementVisual;\r\nvar\r\n  SandboxStr: string;\r\n\r\n  procedure AppendStr(var s: string; appstr: string);\r\n  begin\r\n    if s = '' then\r\n      s := appstr\r\n    else\r\n      s := s + ' ' + appstr;\r\n  end;\r\n\r\nbegin\r\n  inherited;\r\n\r\n\r\n  if BorderStyle = bsSingle then\r\n    ElementHandle.style.setProperty('border','1px solid silver')\r\n  else\r\n    ElementHandle.style.setProperty('border','0px');\r\n\r\n  SandboxStr := '';\r\n\r\n  if stAllowForms in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-forms');\r\n  if stAllowModals in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-modals');\r\n  if stAllowOrientationLock in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-orientation-lock');\r\n  if stAllowPointerLock in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-pointer-lock');\r\n  if stAllowPopups in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-popups');\r\n  if stAllowPopupsToEscapeSandbox in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-popups-to-escape-sandbox');\r\n  if stAllowPresentation in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-presentation');\r\n  if stAllowSameOrigin in Sandbox then\r\n    AppendStr(SandboxStr, 'allow-same-origin');\r\n  if stAllowScripts in  Sandbox then\r\n    AppendStr(SandboxStr, 'allow-scripts');\r\n  if stAllowTopNavigation in  Sandbox then\r\n    AppendStr(SandboxStr, 'allow-top-navigation');\r\n  if stAllowTopNavigationByUserActivation in  Sandbox then\r\n    AppendStr(SandboxStr, 'allow-top-navigation-by-user-activation');\r\n\r\n  if SandboxStr <> '' then\r\n  begin\r\n    ElementHandle.setAttribute('sandbox',SandboxStr);\r\n  end;\r\n\r\n  case ReferrerPolicy of\r\n    rfNoReferrer: ElementHandle.setAttribute('referrerpolicy','no-referrer');\r\n    rfNoReferrerWhenDowngrade: ElementHandle.setAttribute('referrerpolicy','no-referrer-when-downgrade');\r\n    rfOrigin: ElementHandle.setAttribute('referrerpolicy','origin');\r\n    rfOriginWhenCrossOrigin: ElementHandle.setAttribute('referrerpolicy','origin-when-cross-origin');\r\n    rfUnsafeUrl: ElementHandle.setAttribute('referrerpolicy','unsafe-url');\r\n  end;\r\nend;\r\n\r\n{ TGoogleDrive }\r\n\r\nfunction TGoogleDrive.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('IFRAME');\r\n  Result.setAttribute('frameborder','0');\r\nend;\r\n\r\nprocedure TGoogleDrive.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nprocedure TGoogleDrive.SetFolderID(const Value: string);\r\nbegin\r\n  if (FFolderID <> Value) then\r\n  begin\r\n    FFolderID := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleDrive.SetView(const Value: TDriveView);\r\nbegin\r\n  if (FView <> Value) then\r\n  begin\r\n    FView := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleDrive.UpdateElement;\r\nvar\r\n  vs: string;\r\nbegin\r\n  inherited;\r\n\r\n  case View of\r\n  dvList: vs := 'list';\r\n  dvGrid: vs := 'grid';\r\n  end;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.setAttribute('src','https://drive.google.com/embeddedfolderview?id='+ FolderID + '&embedded=true#' + vs);\r\n    TJSHTMLElement(ElementHandle).style.setProperty('border','0');\r\n  end;\r\nend;\r\n\r\n{ TFilePicker }\r\n\r\nprocedure TFilePicker.BindEvents;\r\nvar\r\n  eh: TJSEventTarget;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementBindHandle) then\r\n  begin\r\n    eh := ElementBindHandle;\r\n    eh.addEventListener('change',@DoHandleChange);\r\n  end;\r\nend;\r\n\r\nprocedure TFilePicker.Clear;\r\nbegin\r\n  ElementHandle['type'] := '';\r\n  ElementHandle['type'] := 'file';\r\n\r\n  while Files.Count > 0 do\r\n    Files.Delete(0);\r\nend;\r\n\r\nfunction TFilePicker.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('INPUT');\r\n  Result.setAttribute('type','file');\r\nend;\r\n\r\nprocedure TFilePicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FFiles := TFiles.Create(Self);\r\nend;\r\n\r\ndestructor TFilePicker.Destroy;\r\nbegin\r\n  FFiles.Free;\r\n  inherited;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TFilePicker.DoHandleChange(e: TJSEvent): boolean;\r\nvar\r\n  i,l,sz: integer;\r\n  eh: TJSElement;\r\n  s,m: string;\r\n  f: TFile;\r\n  d: TJSDate;\r\n  jsfile: TJSHTMLFile;\r\nbegin\r\n  Result := true;\r\n\r\n  // clear existing collection\r\n  while FFiles.Count > 0 do\r\n    FFiles.Delete(0);\r\n\r\n  eh := ElementHandle;  \r\n\r\n  asm\r\n    var curFiles = eh.files;\r\n    l = curFiles.length;\r\n  end;\r\n\r\n  for i := 0 to l - 1 do\r\n  begin\r\n    f := FFiles.Add;\r\n\r\n    asm\r\n      jsfile = curFiles[i];\r\n      s = curFiles[i].name;\r\n      m = curFiles[i].type;\r\n      sz = curFiles[i].size;\r\n      d = new Date(curFiles[i].lastModified);\r\n    end;\r\n\r\n    f.FileObject := jsfile;\r\n    f.Name := s;\r\n    f.MimeType := m;\r\n    f.Size := sz;\r\n    f.Modified := EncodeDate(d.Year + 1900, d.Month + 1, d.Date)+EncodeTime(d.Hours, d.Minutes, d.Seconds, d.Milliseconds);\r\n  end;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TFilePicker.GetMethodPointers;\r\nbegin\r\n  if FChangePtr = nil then\r\n  begin\r\n    FChangePtr := @DoHandleChange;\r\n    inherited;\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TFilePicker.SetAccept(const Value: string);\r\nbegin\r\n  if (FAccept <> Value) then\r\n  begin\r\n    FAccept := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TFilePicker.SetMultiFile(const Value: boolean);\r\nbegin\r\n  if (FMultiFile <> Value) then\r\n  begin\r\n    FMultiFile := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TFilePicker.UpdateElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if MultiFile then\r\n      ElementHandle.SetAttribute('multiple','')\r\n    else\r\n      ElementHandle.RemoveAttribute('multiple');\r\n\r\n    if FAccept <> '' then\r\n      ElementHandle.SetAttribute('accept',FAccept)\r\n    else\r\n      ElementHandle.RemoveAttribute('accept');\r\n  end;\r\nend;\r\n\r\n{ TFiles }\r\n\r\nfunction TFiles.Add: TFile;\r\nbegin\r\n  Result := TFile(inherited Add);\r\nend;\r\n\r\nprocedure TFiles.Clear;\r\nvar\r\n  fc: integer;\r\nbegin\r\n  fc := Count;\r\n  inherited Clear;\r\n\r\n  if fc > 0 then\r\n  begin\r\n    if (FOwner is TFilePicker) then\r\n      (FOwner as TFilePicker).Clear;\r\n    if (FOwner is TFileUpload) then\r\n      (FOwner as TFileUpload).Clear;\r\n  end;\r\nend;\r\n\r\nconstructor TFiles.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(TFile);\r\n  FOwner := TFilePicker(AOwner);\r\nend;\r\n\r\nfunction TFiles.GetItem(Index: integer): TFile;\r\nbegin\r\n  Result := TFile(inherited Items[Index]);\r\nend;\r\n\r\nfunction TFiles.Insert(Index: integer): TFile;\r\nbegin\r\n  Result := TFile(inherited Insert(Index));\r\nend;\r\n\r\nfunction TFiles.Owner: TPersistent;\r\nbegin\r\n  Result := FOwner;\r\nend;\r\n\r\nprocedure TFiles.SetItem(Index: integer; const Value: TFile);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TFile }\r\n\r\n{$HINTS OFF}\r\nfunction TFile.GetControl: TCustomControl;\r\nbegin\r\n  Result := nil;\r\n\r\n  if Assigned(Collection) and Assigned((Collection as TFiles).Owner) then\r\n  begin\r\n    if (Collection as TFiles).Owner is TCustomControl then\r\n      Result := (Collection as TFiles).Owner as TCustomControl;\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsArrayBuffer;\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsArrayBuffer;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsArrayBuffer(f);\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsArrayBuffer(GetAsArrayBuffer: TGetAsArrayBufferProc);\r\nbegin\r\n  FGetAsArrayBuffer := GetAsArrayBuffer;\r\n  GetFileAsArrayBuffer;\r\nend;\r\n\r\nprocedure TFile.GetFileAsBase64(GetAsString: TGetAsStringProc);\r\nbegin\r\n  FGetAsString := GetAsString;\r\n  GetFileAsBase64;\r\nend;\r\n\r\nprocedure TFile.GetFileAsDataURL(GetAsString: TGetAsStringProc);\r\nbegin\r\n  FGetAsString := GetAsString;\r\n  GetFileAsDataURL;\r\nend;\r\n\r\nprocedure TFile.GetFileAsText;\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsText;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsText(f);\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsBase64;\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsBase64;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsArrayBuffer(f);\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsDataURL;\r\nvar\r\n  ptr: pointer;\r\n  f: TJSHTMLFile;\r\nbegin\r\n  ptr := @HandleFileLoadAsDataURL;\r\n  f := FileObject;\r\n\r\n  asm\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load',ptr);\r\n    reader.readAsDataURL(f);\r\n  end;\r\nend;\r\n\r\nprocedure TFile.GetFileAsText(GetAsString: TGetAsStringProc);\r\nbegin\r\n  FGetAsString := GetAsString;\r\n  GetFileAsText;\r\nend;\r\n\r\nprocedure TFile.Upload(AAction: string);\r\nvar\r\n  f: TJSHTMLFile;\r\n  fd: TJSFormData;\r\n  req: TJSXMLHttpRequest;\r\n  ptrProgress, ptrComplete, ptrError, ptrAbort: pointer;\r\nbegin\r\n  f := FileObject;\r\n\r\n  fd := TJSFormData.new;\r\n  fd.Append('file1',f);\r\n\r\n  req := TJSXMLHttpRequest.new;\r\n\r\n  ptrProgress := @HandleFileUploadProgress;\r\n  ptrComplete := @HandleFileUploadComplete;\r\n  ptrError := @HandleFileUploadError;\r\n  ptrAbort := @HandleFileUploadAbort;\r\n\r\n  req.addEventListener('load', ptrComplete);\r\n  req.addEventListener('error', ptrError);\r\n  req.addEventListener('abort', ptrAbort);\r\n  req.upload.addEventListener('progress', ptrProgress);\r\n\r\n  req.Open('POST',AAction, true);\r\n  req.Send(fd);\r\nend;\r\n\r\n\r\n{$HINTS ON}\r\n\r\nfunction TFile.HandleFileLoadAsArrayBuffer(Event: TJSEvent): boolean;\r\nvar\r\n  ja: TJSArrayBuffer;\r\n  ctrl: TCustomControl;\r\nbegin\r\n  Result := true;\r\n  asm\r\n    ja = event.target.result;\r\n  end;\r\n\r\n  if Assigned(FGetAsArrayBuffer) then\r\n    FGetAsArrayBuffer(ja);\r\n\r\n  FGetAsArrayBuffer := nil;\r\n\r\n  if Assigned(OnGetFileAsArrayBuffer) then\r\n    OnGetFileAsArrayBuffer(Self, ja);\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnGetFileAsArrayBuffer) then\r\n      (ctrl as TFilePicker).OnGetFileAsArrayBuffer(ctrl, Index, ja);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnGetFileAsArrayBuffer) then\r\n      (ctrl as TFileUpload).OnGetFileAsArrayBuffer(ctrl, Index, ja);\r\n  end;\r\nend;\r\n\r\n\r\nfunction TFile.HandleFileLoadAsBase64(Event: TJSEvent): boolean;\r\nvar\r\n  s: string;\r\n  ctrl: TCustomControl;\r\nbegin\r\n  Result := true;\r\n\r\n  asm\r\n    function _arrayBufferToBase64( buffer ) {\r\n    var binary = '';\r\n    var bytes = new Uint8Array( buffer );\r\n    var len = bytes.byteLength;\r\n    for (var i = 0; i < len; i++) {\r\n        binary += String.fromCharCode( bytes[ i ] );\r\n    }\r\n    return window.btoa( binary );\r\n    }\r\n    s = _arrayBufferToBase64(event.target.result);\r\n  end;\r\n\r\n  if Assigned(FGetAsString) then\r\n    FGetAsString(s);\r\n\r\n  FGetAsString := nil;\r\n\r\n  if Assigned(OnGetFileAsBase64) then\r\n    OnGetFileAsBase64(Self, s);\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnGetFileAsBase64) then\r\n      (ctrl as TFilePicker).OnGetFileAsBase64(ctrl, Index, s);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnGetFileAsBase64) then\r\n      (ctrl as TFileUpload).OnGetFileAsBase64(ctrl, Index, s);\r\n  end;\r\nend;\r\n\r\n\r\nfunction TFile.HandleFileLoadAsDataURL(Event: TJSEvent): boolean;\r\nvar\r\n  s: string;\r\n  ctrl: TCustomControl;\r\nbegin\r\n  Result := true;\r\n  asm\r\n    s = event.target.result;\r\n  end;\r\n\r\n  if Assigned(FGetAsString) then\r\n    FGetAsString(s);\r\n\r\n  FGetAsString := nil;\r\n\r\n  if Assigned(OnGetFileAsURL) then\r\n    OnGetFileAsURL(Self, s);\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnGetFileAsDataURL) then\r\n      (ctrl as TFilePicker).OnGetFileAsDataURL(ctrl, Index, s);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnGetFileAsDataURL) then\r\n      (ctrl as TFileUpload).OnGetFileAsDataURL(ctrl, Index, s);\r\n  end;\r\nend;\r\n\r\nfunction TFile.HandleFileLoadAsText(Event: TJSEvent): boolean;\r\nvar\r\n  s:string;\r\n  ctrl: TCustomControl;\r\nbegin\r\n  Result := true;\r\n  asm\r\n    s = event.target.result;\r\n  end;\r\n\r\n  if Assigned(FGetAsString) then\r\n    FGetAsString(s);\r\n\r\n  FGetAsString := nil;\r\n\r\n  if Assigned(OnGetFileAsText) then\r\n    OnGetFileAsText(Self, s);\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnGetFileAsText) then\r\n      (ctrl as TFilePicker).OnGetFileAsText(ctrl, Index, s);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnGetFileAsText) then\r\n      (ctrl as TFileUpload).OnGetFileAsText(ctrl, Index, s);\r\n  end;\r\nend;\r\n\r\nfunction TFile.HandleFileUploadAbort(Event: TJSEvent): boolean;\r\nvar\r\n  ctrl: TCustomControl;\r\nbegin\r\n  Result := true;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnUploadFileAbort) then\r\n      (ctrl as TFilePicker).OnUploadFileAbort(ctrl, Index);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnUploadFileAbort) then\r\n      (ctrl as TFileUpload).OnUploadFileAbort(ctrl, Index);\r\n  end;\r\n\r\nend;\r\n\r\nfunction TFile.HandleFileUploadComplete(Event: TJSEvent): boolean;\r\nvar\r\n  ctrl: TCustomControl;\r\nbegin\r\n  Result := true;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnUploadFileComplete) then\r\n      (ctrl as TFilePicker).OnUploadFileComplete(ctrl, Index);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnUploadFileComplete) then\r\n      (ctrl as TFileUpload).OnUploadFileComplete(ctrl, Index);\r\n  end;\r\nend;\r\n\r\nfunction TFile.HandleFileUploadError(Event: TJSEvent): boolean;\r\nvar\r\n  err: string;\r\n  ctrl: TCustomControl;\r\nbegin\r\n  asm\r\n    err = Event.target.status;\r\n  end;\r\n  Result := true;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (ctrl as TFilePicker).OnUploadFileError) then\r\n      (ctrl as TFilePicker).OnUploadFileError(ctrl, Index, err);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (ctrl as TFileUpload).OnUploadFileError) then\r\n      (ctrl as TFileUpload).OnUploadFileError(ctrl, Index, err);\r\n  end;\r\nend;\r\n\r\nfunction TFile.HandleFileUploadProgress(Event: TJSEvent): boolean;\r\nvar\r\n  Lloaded, Ltotal: longint;\r\n  ctrl: TCustomControl;\r\nbegin\r\n  Lloaded := 0;\r\n  LTotal := 0;\r\n\r\n  asm\r\n   if (Event.lengthComputable) {\r\n      Lloaded = Event.loaded;\r\n      Ltotal = Event.total;\r\n      //console.log(Event.loaded + \" bytes of \" + Event.total); } else { console.log('no calc');\r\n   }\r\n  end;\r\n\r\n  ctrl := GetControl;\r\n\r\n  if Assigned(ctrl) then\r\n  begin\r\n    if (ctrl is TFilePicker) and Assigned( (GetControl as TFilePicker).OnUploadFileProgress) then\r\n      (ctrl as TFilePicker).OnUploadFileProgress(ctrl, Index, Lloaded, Ltotal);\r\n\r\n    if (ctrl is TFileUpload) and Assigned( (GetControl as TFileUpload).OnUploadFileProgress) then\r\n      (ctrl as TFileUpload).OnUploadFileProgress(ctrl, Index, Lloaded, Ltotal);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\n{ THTMLDiv }\r\n\r\nfunction THTMLDiv.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure THTMLDiv.CreateInitialize;\r\nbegin\r\n  FHTML := TStringList.Create;\r\n  (FHTML as TStringList).OnChange := HTMLChanged;\r\n\r\n  inherited;\r\n\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  ClipChildren := false;\r\n  TabStop := false;\r\nend;\r\n\r\ndestructor THTMLDiv.Destroy;\r\nbegin\r\n  FHTML.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure THTMLDiv.HTMLChanged(Sender: TObject);\r\nbegin\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLDiv.SetHTML(const Value: TStrings);\r\nbegin\r\n  FHTML.Assign(Value);\r\nend;\r\n\r\nprocedure THTMLDiv.UpdateElementData;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) and (FHTML.Text <> '') then\r\n    ElementHandle.innerHTML := FHTML.Text\r\n  else\r\n  begin\r\n    if (csDesigning in ComponentState) then\r\n      RenderDesigning(ClassName, Container, Self, True);\r\n  end;\r\nend;\r\n\r\n{ THTMLSpan }\r\n\r\nfunction THTMLSpan.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nprocedure THTMLSpan.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  TabStop := false;\r\n  ClipChildren := false;\r\n  FHTML := TStringList.Create;\r\n  (FHTML as TStringList).OnChange := HTMLChanged;\r\nend;\r\n\r\ndestructor THTMLSpan.Destroy;\r\nbegin\r\n  FHTML.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure THTMLSpan.HTMLChanged(Sender: TObject);\r\nbegin\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLSpan.SetHTML(const Value: TStrings);\r\nbegin\r\n  FHTML.Assign(Value);\r\nend;\r\n\r\nprocedure THTMLSpan.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) and (FHTML.Text <> '') then\r\n    ElementHandle.innerHTML := FHTML.Text\r\n  else\r\n  begin\r\n    if (csDesigning in ComponentState) then\r\n      RenderDesigning(ClassName, Container, Self, True);\r\n  end;\r\nend;\r\n\r\n{ THTMLAnchor }\r\n\r\nfunction THTMLAnchor.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('A');\r\nend;\r\n\r\nprocedure THTMLAnchor.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Caption := 'WebHTMLAnchor';\r\nend;\r\n\r\nfunction THTMLAnchor.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if Assigned(OnClick) then\r\n  begin\r\n    Event.preventDefault();\r\n    StopPropagation;\r\n    Result := false;\r\n    OnClick(Self);\r\n  end\r\n  else\r\n    Result := inherited;\r\nend;\r\n\r\nprocedure THTMLAnchor.SetCaption(const Value: string);\r\nbegin\r\n  inherited SetCaption(Value);\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLAnchor.SetHref(const Value: string);\r\nbegin\r\n  FHref := Value;\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLAnchor.SetTarget(const Value: string);\r\nbegin\r\n  FTarget := Value;\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure THTMLAnchor.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if Caption <> '' then\r\n     ElementHandle.innerHTML := Caption;\r\n    ElementHandle.setAttribute('href', FHref);\r\n    ElementHandle.setAttribute('target', FTarget);\r\n  end;\r\nend;\r\n\r\n{ TURLValidator }\r\n\r\nprocedure TURLValidator.HandleResult(IsValid: boolean);\r\nbegin\r\n  if Assigned(OnValidated) then\r\n    OnValidated(Self, IsValid);\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TURLValidator.Validate;\r\nvar\r\n  s: string;\r\n  ptr: pointer;\r\nbegin\r\n  s := URL;\r\n  ptr := @HandleResult;\r\n  asm\r\n    var request = new XMLHttpRequest();\r\n    request.open('GET', s, true);\r\n    request.onreadystatechange = function(){\r\n       if (request.readyState === 4){\r\n           ptr(request.status === 200);\r\n           }\r\n    };\r\n    request.send();\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n{ TGoogleMapsOptions }\r\n\r\nprocedure TGoogleMapsOptions.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  FCustomStyle := (Source as TGoogleMapsOptions).CustomStyle;\r\n  FMapStyle := (Source as TGoogleMapsOptions).MapStyle;\r\n  FDefaultLatitude := (Source as TGoogleMapsOptions).DefaultLatitude;\r\n  FDefaultLongitude := (Source as TGoogleMapsOptions).DefaultLongitude;\r\n  FDefaultZoomLevel := (Source as TGoogleMapsOptions).DefaultZoomLevel;\r\nend;\r\n\r\nconstructor TGoogleMapsOptions.Create(AGoogleMaps: TGoogleMaps);\r\nbegin\r\n  inherited Create;\r\n  FCustomStyle := TStringList.Create;\r\n  FMapStyle := mstDefault;\r\n  FDefaultLatitude := -34.397;\r\n  FDefaultLongitude := 150.644;\r\n  FDefaultZoomLevel := 8;\r\n  FOwner := AGoogleMaps;\r\nend;\r\n\r\ndestructor TGoogleMapsOptions.Destroy;\r\nbegin\r\n  FCustomStyle.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TGoogleMapsOptions.SetCustomStyle(const Value: TStringList);\r\nbegin\r\n  FCustomStyle.Assign(Value);\r\nend;\r\n\r\nprocedure TGoogleMapsOptions.SetDefaultLatitude(const Value: Double);\r\nbegin\r\n  if FDefaultLatitude <> Value then\r\n  begin\r\n    FDefaultLatitude := Value;\r\n    FOwner.UpdateElement;\r\n    FOwner.PanTo(DefaultLatitude, DefaultLongitude);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMapsOptions.SetDefaultLongitude(const Value: Double);\r\nbegin\r\n  if FDefaultLongitude <> Value then\r\n  begin\r\n    FDefaultLongitude := Value;\r\n    FOwner.UpdateElement;\r\n    FOwner.PanTo(DefaultLatitude, DefaultLongitude);\r\n  end;\r\nend;\r\n\r\nprocedure TGoogleMapsOptions.SetDefaultZoomLevel(const Value: Integer);\r\nbegin\r\n  if (FDefaultZoomLevel <> Value) and (Value >= 0) and (Value <= 21) then\r\n  begin\r\n    FDefaultZoomLevel := Value;\r\n    FOwner.UpdateElement;\r\n    FOwner.SetZoom(Value);\r\n  end;\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure TGoogleMapsOptions.SetMapStyle(const Value: TGoogleMapStyle);\r\nvar\r\n  map: TJSHTMLElement;\r\n  cstyle: string;\r\n  ostyle: TJSObject;\r\nbegin\r\n  FMapStyle := Value;\r\n  map := FOwner.GetMap;\r\n\r\n  if not Assigned(map) then\r\n    Exit;\r\n\r\n  if FMapStyle = mstNightMode then\r\n  begin\r\n    asm\r\n      var myStyle =\r\n      [\r\n        {\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#242f3e\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#746855\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"elementType\": \"labels.text.stroke\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#242f3e\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"administrative.locality\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#d59563\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"poi\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#d59563\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"poi.park\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#263c3f\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"poi.park\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#6b9a76\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#38414e\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road\",\r\n          \"elementType\": \"geometry.stroke\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#212a37\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#9ca5b3\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road.highway\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#746855\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road.highway\",\r\n          \"elementType\": \"geometry.stroke\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#1f2835\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"road.highway\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#f3d19c\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"transit\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#2f3948\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"transit.station\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#d59563\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"water\",\r\n          \"elementType\": \"geometry\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#17263c\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"water\",\r\n          \"elementType\": \"labels.text.fill\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#515c6d\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"featureType\": \"water\",\r\n          \"elementType\": \"labels.text.stroke\",\r\n          \"stylers\": [\r\n            {\r\n              \"color\": \"#17263c\"\r\n            }\r\n          ]\r\n        }\r\n      ];\r\n\r\n      map.setOptions({styles: myStyle});\r\n    end;\r\n  end\r\n  else if (FMapStyle = mstCustom) and (CustomStyle.Text <> '') then\r\n  begin\r\n    cstyle := CustomStyle.Text;\r\n    ostyle := TJSObject(TJSJSON.Parse(cstyle));\r\n    asm\r\n      map.setOptions({styles: ostyle});\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    asm\r\n      map.setOptions({styles: []});\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Dialogs;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Controls, Web, SysUtils, WebLib.WebTools,\r\n  WEBLib.WebCtrls, WEBLib.Graphics;\r\n\r\ntype\r\n  TMsgDlgType = (mtWarning, mtError, mtInformation, mtConfirmation, mtCustom);\r\n  TMsgDlgBtn = (mbYes, mbNo, mbOK, mbCancel, mbAbort, mbRetry, mbIgnore,\r\n    mbAll, mbNoToAll, mbYesToAll, mbHelp, mbClose);\r\n  TMsgDlgButtons = set of TMsgDlgBtn;\r\n\r\n  TDialogResult = Integer;\r\n  TDialogResultProc = reference to procedure(AValue: TDialogResult);\r\n\r\n  TCustomDialogButton = class(TCollectionItem)\r\n  private\r\n    FCaption: string;\r\n    FTag: integer;\r\n    FElementClassName: TElementClassName;\r\n  published\r\n    property Caption: string read FCaption write FCaption;\r\n    property ElementClassName: TElementClassName read FElementClassName write FElementClassName;\r\n    property Tag: integer read FTag write FTag default 0;\r\n  end;\r\n\r\n  TCustomDialogButtons = class(TOwnedCollection)\r\n  private\r\n    function GetItem(AIndex: integer): TCustomDialogButton; reintroduce;\r\n    procedure SetItem(AIndex: integer; const Value: TCustomDialogButton); reintroduce;\r\n  public\r\n    function Add: TCustomDialogButton; reintroduce;\r\n    function Insert(AIndex: integer): TCustomDialogButton; reintroduce;\r\n    property Items[AIndex: integer]: TCustomDialogButton read GetItem write SetItem; default;\r\n  end;\r\n\r\n  TMessageDlg = class(TCustomControl)\r\n  private\r\n    FOpacity: double;\r\n    FLayer: TJSElement;\r\n    FDlg: TJSElement;\r\n    FCancel: TJSElement;\r\n    FMessage: string;\r\n    FTitle: string;\r\n    FMsgDlgType: TMSgDlgType;\r\n    FOnButtonClick: TNotifyEvent;\r\n    FOnClose: TNotifyEvent;\r\n    FButtons: TMsgDlgButtons;\r\n    FDialogProc: TDialogResultProc;\r\n    FDialogResult: TDialogResult;\r\n    FMdx, FMdy: integer;\r\n    FDlgX, FDlgY: integer;\r\n    FCaptured: boolean;\r\n    FDown: boolean;\r\n    FElementTitleClassName: TElementClassName;\r\n    FElementButtonClassName: TElementClassName;\r\n    FElementContentClassName: TElementClassName;\r\n    FDialogText: TStringList;\r\n    FCustomButtons: TCustomDialogButtons;\r\n    FElementDialogClassName: TElementClassName;\r\n    procedure SetDialogText(const Value: TStringList);\r\n    procedure SetCustomButtons(const Value: TCustomDialogButtons);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    function GetDialogText(Index: integer): string; virtual;\r\n    procedure BindEvents; override;\r\n    procedure SetDialogResult(const Value: TDialogResult);\r\n    function CreateButton(Caption: string; var DoFocus: boolean; AClass: string = ''): TJSHTMLElement;\r\n    function HandleDocMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDocMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleMouseDown(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleButtonClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleKeyDown(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    procedure InitBootstrapStyle;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Close;\r\n    property DialogResult: TDialogResult read FDialogResult write SetDialogResult;\r\n    procedure Show;\r\n    function ShowDialog: Integer; overload; virtual;\r\n    function ShowDialog(Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons; AProc: TDialogResultProc = nil): TDialogResult; overload; virtual;\r\n  published\r\n    property Buttons: TMsgDlgButtons read FButtons write FButtons default [];\r\n    property CustomButtons: TCustomDialogButtons read FCustomButtons write SetCustomButtons;\r\n    property DialogText: TStringList read FDialogText write SetDialogText;\r\n    property DialogType: TMSgDlgType read FMsgDlgType write FMsgDlgType default mtCustom;\r\n    property &Message: string read FMessage write FMessage;\r\n    property Opacity: double read FOpacity write FOpacity;\r\n    property ElementButtonClassName: TElementClassName read FElementButtonClassName write FElementButtonClassName;\r\n    property ElementDialogClassName: TElementClassName read FElementDialogClassName write FElementDialogClassName;\r\n    property ElementTitleClassName: TElementClassName read FElementTitleClassName write FElementTitleClassName;\r\n    property ElementContentClassName: TElementClassName read FElementContentClassName write FElementContentClassName;\r\n    property Title: string read FTitle write FTitle;\r\n    property OnButtonClick: TNotifyEvent read FOnButtonClick write FOnButtonClick;\r\n    property OnClose: TNotifyEvent read FOnClose write FOnClose;\r\n  end;\r\n\r\n  TWebMessageDlg = class(TMessageDlg);\r\n\r\n  TWaitMessage = class(TCustomControl)\r\n  private\r\n    FLayer: TJSElement;\r\n    FPicture: TURLPicture;\r\n    FOpacity: double;\r\n    FOnShow: TNotifyEvent;\r\n    FIsWaiting: boolean;\r\n    procedure SetPicture(const Value: TURLPicture);\r\n  protected\r\n    procedure WaitDisplayed;\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Show;\r\n    procedure Hide;\r\n    property IsWaiting: boolean read FIsWaiting write FIsWaiting;\r\n    property Showing: boolean read FIsWaiting;\r\n  published\r\n    property Opacity: double read FOpacity write FOpacity;\r\n    property Picture: TURLPicture read FPicture write SetPicture;\r\n    property OnShow: TNotifyEvent read FOnShow write FOnShow;\r\n  end;\r\n\r\n  TWebWaitMessage = class(TWaitMessage);\r\n\r\n  TOpenDialogProc = reference to procedure(AFileName: string);\r\n\r\n  TOpenDialog = class(TComponent)\r\n  private\r\n    FFiles: TFiles;\r\n    FOnChange: TNotifyEvent;\r\n    FFileName: string;\r\n    FMultiFile: boolean;\r\n    FAccept: string;\r\n    FOpenDialogProc: TOpenDialogProc;\r\n  protected\r\n    procedure HandleInputChange(Event: TJSEvent); virtual;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Execute; overload;\r\n    procedure Execute(AProc: TOpenDialogProc); overload;\r\n    property FileName: string read FFileName;\r\n    property Files: TFiles read FFiles;\r\n  published\r\n    property Accept: string read FAccept write FAccept;\r\n    property MultiFile: boolean read FMultiFile write FMultiFile default false;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TWebOpenDialog = class(TOpenDialog);\r\n\r\n\r\nprocedure MessageDlg(const Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons;  AResultProc: TDialogResultProc = nil);\r\nprocedure ShowMessage(AMsg: string);\r\nfunction InputBox(const ACaption, APrompt, ADefault: string): string;\r\nfunction InputQuery(const ACaption, APrompt: string; var Value: string): Boolean; overload;\r\nfunction Confirm(const Value: string): boolean;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Forms, WebLib.Consts, JS;\r\n\r\nvar\r\n  WebLibDlg: TMessageDlg;\r\n\r\nfunction StringToHTML(AValue: string): string;\r\nbegin\r\n  Result := StringReplace(AValue,#13,'<BR>',[rfReplaceAll]);\r\n  Result := StringReplace(Result,#10,'',[rfReplaceAll]);\r\nend;\r\n\r\nprocedure ShowMessage(AMsg: string);\r\nbegin\r\n  if (Application <> nil) and (Application.MainForm <> nil) and (Application.MainForm.CSSLibrary = cssBootstrap) then\r\n  begin\r\n    MessageDlg(AMsg, mtInformation, [mbOK]);\r\n  end\r\n  else\r\n  begin\r\n    asm\r\n      alert(AMsg);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction InputBox(const ACaption, APrompt, ADefault: string): string;\r\nvar\r\n  retvalue: string;\r\nbegin\r\n//\r\n  asm\r\n    retvalue = prompt(APrompt, ADefault);\r\n    if (retvalue == null) {\r\n      retvalue = \"\";\r\n    }\r\n  end;\r\n\r\n  Result := retvalue;\r\nend;\r\n\r\nfunction InputQuery(const ACaption, APrompt: string; var Value: string): Boolean; overload;\r\nvar\r\n  retvalue: boolean;\r\n  s: string;\r\nbegin\r\n  retvalue := true;\r\n  s := Value;\r\n\r\n  asm\r\n    var text = s;\r\n    s = prompt(APrompt, text);\r\n    if (s == null) {\r\n      retvalue = false;\r\n    }\r\n  end;\r\n\r\n  if retvalue then\r\n    Value := s;\r\n\r\n  Result := retvalue;\r\nend;\r\n\r\nfunction Confirm(const Value: string): boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  asm\r\n    res = confirm(Value);\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nprocedure MessageDlg(const Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons;  AResultProc: TDialogResultProc = nil);\r\nbegin\r\n  if not Assigned(WebLibDlg) then\r\n  begin\r\n    WebLibDlg := TMessageDlg.Create(nil);\r\n    if Application.MainForm.CSSLibrary = cssBootstrap then\r\n    begin\r\n      TMessageDlg(WebLibDlg).InitBootstrapStyle;\r\n    end;\r\n  end;\r\n\r\n  WebLibDlg.ShowDialog(Msg, DlgType, Buttons, AResultProc);\r\nend;\r\n\r\n{ TMessageDlg }\r\n\r\nprocedure TMessageDlg.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FOpacity := 0.2;\r\n  FMessage := '';\r\n  FMsgDlgType := mtInformation;\r\n  FDialogText := TStringList.Create;\r\n  FDialogText.Add(SWarning); // 0\r\n  FDialogText.Add(SError);   // 1\r\n  FDialogText.Add(SInformation); // 2\r\n  FDialogText.Add(SConfirm);     // 3\r\n  FDialogText.Add('Custom');      // 4\r\n  FDialogText.Add(SOK);          // 5\r\n  FDialogText.Add(SCancel);      // 6\r\n  FDialogText.Add(SYes);         // 7\r\n  FDialogText.Add(SNo);          // 8\r\n  FDialogText.Add(SAbort);       // 9\r\n  FDialogText.Add(SRetry);       // 10\r\n  FDialogText.Add(SIgnore);      // 11\r\n  FDialogText.Add(SAll);         // 12\r\n  FDialogText.Add(SYestoAll);  // 13\r\n  FDialogText.Add(SNotoAll);   // 14\r\n  FDialogText.Add(SHelp);        // 15\r\n  FDialogText.Add(SClose);       // 16\r\n\r\n  FMsgDlgType := mtCustom;\r\n\r\n  FCustomButtons := TCustomDialogButtons.Create(Self, TCustomDialogButton);\r\n  FCustomButtons.PropName := 'CustomButtons';\r\nend;\r\n\r\ndestructor TMessageDlg.Destroy;\r\nbegin\r\n  FDialogText.Free;\r\n  FCustomButtons.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TMessageDlg.GetDialogText(Index: integer): string;\r\nbegin\r\n  Result := 'Undefined';\r\n\r\n  if Index < FDialogText.Count then\r\n    Result := FDialogText.Strings[Index];\r\nend;\r\n\r\nprocedure TMessageDlg.BindEvents;\r\nbegin\r\n//\r\nend;\r\n\r\nfunction TMessageDlg.ShowDialog: integer;\r\nbegin\r\n  Result := mrNone;\r\n  Show;\r\nend;\r\n\r\nfunction TMessageDlg.ShowDialog(Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons; AProc: TDialogResultProc = nil): TDialogResult;\r\nbegin\r\n  Result := mrNone;\r\n  FButtons := Buttons;\r\n  FMessage := Msg;\r\n  FMsgDlgType := DlgType;\r\n  FDialogProc := AProc;\r\n  DialogResult := mrNone;\r\n  Show;\r\nend;\r\n\r\nfunction TMessageDlg.CreateButton(Caption: string; var DoFocus: boolean; AClass: string = ''): TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(document.createElement('BUTTON'));\r\n  Result.innerHTML := Caption;\r\n\r\n  if Application.MainForm.CSSLibrary = cssBootstrap then\r\n  begin\r\n    Result['type'] := 'BUTTON';\r\n    Result['class'] := 'btn ' + AClass;\r\n    Result['data-dismiss'] := 'modal-dialog';\r\n  end\r\n  else\r\n  begin\r\n    Result.style.setProperty('width', '100px');\r\n    Result.style.setProperty('margin-left', '5px');\r\n    if ElementButtonClassName <> '' then\r\n      Result['class'] := ElementButtonClassName + ' ' + AClass\r\n    else\r\n      if Application.ThemeButtonClassName <> '' then\r\n        Result['class'] := Application.ThemeButtonClassName + ' ' + AClass;\r\n  end;\r\n\r\n  Result.id := Caption;\r\n  Result.addEventListener('click', @HandleButtonClick);\r\n  Result.addEventListener('keydown', @HandleKeyDown);\r\n\r\n  if DoFocus then\r\n  begin\r\n    asm\r\n      setTimeout(function() {Result.focus();}, 1);\r\n    end;\r\n    DoFocus := false;\r\n  end;\r\nend;\r\n\r\nfunction TMessageDlg.CreateElement: TJSElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n    Result := nil\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TMessageDlg.Show;\r\nvar\r\n  title, msg, icon, content, contentdiv, bar, edlg, eh, cancel: TJSHTMLElement;\r\n  adiv,ldiv,cdiv: TJSElement;\r\n  MsgSymbol, MsgColor, MsgTitle, BorderColor, BarBGColor, BarHeight, Padding: string;\r\n  btnFocus: boolean;\r\n  i: Integer;\r\n\r\nbegin\r\n  if (Application = nil) or (Application.MainForm = nil) then\r\n    Exit;\r\n\r\n  Application.LockForm(Application.MainForm);\r\n\r\n  FLayer := document.createElement('SPAN');\r\n  document.body.appendChild(FLayer);\r\n  FLayer['tabindex'] := '0';\r\n  FLayer.addEventListener('keydown', @HandleKeyDown);\r\n\r\n  btnFocus := true;\r\n  MsgTitle := FTitle;\r\n  FMessage := StringToHTML(FMessage);\r\n\r\n  case FMsgDlgType of\r\n    mtWarning: begin MsgSymbol := 'warning'; MsgColor := 'orange'; MsgTitle := GetDialogText(0); end;\r\n    mtError: begin MsgSymbol := 'cancel'; MsgColor := 'red'; MsgTitle := GetDialogText(1); end;\r\n    mtInformation: begin MsgSymbol := 'info'; MsgColor := 'blue'; MsgTitle := GetDialogText(2); end;\r\n    mtConfirmation: begin MsgSymbol := 'help'; MsgColor := 'blue'; MsgTitle := GetDialogText(3); end;\r\n    mtCustom: begin MsgSymbol := ''; MsgColor := ''; MsgTitle := GetDialogText(4); end;\r\n  end;\r\n\r\n  if Application.MainForm.CSSLibrary = cssBootstrap then\r\n  begin\r\n    FDlg := document.createElement('DIV');\r\n    FDlg['class'] := 'modal-dialog'; //  modal-dialog-centered';\r\n    FDlg['role'] := 'document';\r\n\r\n    TJSHTMLElement(FDlg).style.setProperty('z-index', '19998');\r\n\r\n    // insert opaque background on entire window\r\n    eh := TJSHTMLElement(document.createElement('SPAN'));\r\n    eh.style.setProperty('position', 'absolute');\r\n    eh.style.setProperty('top', '0');\r\n    eh.style.setProperty('left', '0');\r\n    eh.style.setProperty('right', '0');\r\n    eh.style.setProperty('bottom', '0');\r\n    eh.style.setProperty('z-index', '19997');\r\n    document.body.appendChild(eh);\r\n    eh.appendChild(FDlg);\r\n\r\n    ldiv := FDlg;\r\n\r\n    adiv := document.createElement('DIV');\r\n    adiv['class'] := 'modal-content ' + ElementDialogClassName;\r\n    ldiv.appendChild(adiv);\r\n\r\n    cdiv := adiv;\r\n    ldiv := adiv;\r\n\r\n    adiv := document.createElement('DIV');\r\n    adiv['class'] := 'modal-header';\r\n    cdiv.appendChild(adiv);\r\n\r\n    ldiv := adiv;\r\n\r\n    adiv := document.createElement('H5');\r\n    adiv['class'] := 'modal-title';\r\n    adiv.innerHTML := MsgTitle;\r\n\r\n    ldiv.appendChild(adiv);\r\n\r\n    if (mbCancel in Buttons) then\r\n    begin\r\n      adiv := document.createElement('BUTTON');\r\n      adiv['type'] := 'button';\r\n      adiv['class'] := 'close';\r\n      adiv['data-dismiss'] := 'modal-dialog';\r\n      adiv['aria-label'] := 'Close';\r\n      adiv['id'] := GetDialogText(6);\r\n      adiv.addEventListener('click', @HandleButtonClick);\r\n\r\n      ldiv.appendChild(adiv);\r\n      ldiv := adiv;\r\n\r\n      adiv := document.createElement('SPAN');\r\n      adiv['aria-hidden'] := 'true';\r\n      adiv.innerHTML := '&times;';\r\n\r\n      ldiv.appendChild(adiv);\r\n    end;\r\n\r\n    adiv := document.createElement('DIV');\r\n    adiv['class'] := 'modal-body';\r\n    cdiv.appendChild(adiv);\r\n\r\n    ldiv := adiv;\r\n\r\n    if FMsgDlgType <> mtCustom then\r\n    begin\r\n      icon := TJSHTMLElement(document.createElement('SPAN'));\r\n      icon.innerHTML := '<i class=\"material-icons\" style=\"color:' + MsgColor + '!important;font-size:48px!important\">' + MsgSymbol + '</i>';\r\n      icon.style.setProperty('display', 'inline-block');\r\n      icon.style.setProperty('float', 'left');\r\n      icon.style.setProperty('padding-right', '15px');\r\n      ldiv.appendChild(icon);\r\n    end;\r\n\r\n    adiv := document.createElement('P');\r\n    adiv.innerHTML := FMessage;\r\n\r\n    ldiv.appendChild(adiv);\r\n\r\n    adiv := document.createElement('DIV');\r\n    adiv['class'] := 'modal-footer';\r\n    cdiv.appendChild(adiv);\r\n\r\n    ldiv := adiv;\r\n\r\n    bar := TJSHTMLElement(ldiv);\r\n\r\n    FDlg := eh;\r\n  end\r\n  else\r\n  begin\r\n    Padding := '5';\r\n    BarHeight := '26';\r\n    BarBGColor := '#f1f1f1';\r\n    BorderColor := '#ababab';\r\n\r\n    FDlg := document.createElement('DIV');\r\n    document.body.appendChild(FDlg);\r\n\r\n    edlg := TJSHTMLElement(FDlg);\r\n\r\n    if ElementDialogClassName <> '' then\r\n     edlg['class'] := ElementDialogClassName;\r\n\r\n    edlg.style.setProperty('background-color', 'white');\r\n    edlg.style.setProperty('cursor', 'default');\r\n    edlg.style.setProperty('border', '1px solid ' + BorderColor);\r\n    edlg.style.setProperty('position', 'fixed');\r\n    edlg.style.setProperty('font-family', 'Arial');\r\n    edlg.style.setProperty('font-size', '10pt');\r\n    edlg.style.setProperty('min-width', '300px');\r\n    edlg.style.setProperty('min-height', '125px');\r\n    edlg.style.setProperty('max-width', '100%');\r\n    edlg.style.setProperty('max-height', '100%');\r\n    edlg.style.setProperty('top', '50%');\r\n    edlg.style.setProperty('left', '50%');\r\n    edlg.style.setProperty('transform', 'translate(-50%, -50%)');\r\n    edlg.style.setProperty('z-index', '19998');\r\n    edlg.style.setProperty('box-shadow','5px 5px 5px gray');\r\n\r\n    cancel := TJSHTMLElement(document.createElement('DIV'));\r\n    FCancel := cancel;\r\n    cancel.innerHTML := '<i id=\"Cancel\" class=\"material-icons\" style=\"font-size:16px!important\">clear</i>';\r\n    cancel.id := 'Cancel';\r\n    cancel.style.setProperty('color', ColorToHTML(Application.ThemeTextColor));\r\n    cancel.style.setProperty('position', 'fixed');\r\n    cancel.style.setProperty('top', '0');\r\n    cancel.style.setProperty('right', '0');\r\n    cancel.style.setProperty('padding', Padding + 'px');\r\n    cancel.style.setProperty('height', BarHeight + 'px');\r\n    cancel.style.setProperty('line-height', BarHeight + 'px');\r\n    cancel.addEventListener('click', @HandleButtonClick);\r\n    edlg.appendChild(cancel);\r\n\r\n    title := TJSHTMLElement(document.createElement('DIV'));\r\n    title.innerHTML := MsgTitle;\r\n\r\n    if FElementTitleClassName <> '' then\r\n    begin\r\n      title['class'] := FElementTitleClassName;\r\n    end\r\n    else\r\n    begin\r\n      title.style.setProperty('background-color', ColorToHTML(Application.ThemeColor));\r\n      title.style.setProperty('color', ColorToHTML(Application.ThemeTextColor));\r\n    end;\r\n\r\n    title.style.setProperty('cursor', 'move');\r\n    title.style.setProperty('padding-left', Padding + 'px');\r\n    title.style.setProperty('height', BarHeight + 'px');\r\n    title.style.setProperty('vertical-align','middle');\r\n    title.style.setProperty('line-height', BarHeight + 'px');\r\n    title.style.setProperty('border-bottom', '1px solid ' + BorderColor);\r\n\r\n    title.style.setProperty('-moz-user-select','none');\r\n    title.style.setProperty('-webkit-user-select','none');\r\n    title.style.setProperty('-ms-user-select','none');\r\n    title.style.setProperty('user-select','none');\r\n    title.style.setProperty('-o-user-select','none');\r\n\r\n    title.addEventListener('mousedown',@HandleMouseDown);\r\n\r\n    edlg.appendChild(title);\r\n\r\n    msg := TJSHTMLElement(document.createElement('DIV'));\r\n\r\n    msg.style.setProperty('padding', Padding + 'px');\r\n    msg.style.setProperty('height', 'auto');\r\n    msg.style.setProperty('min-height', '50px');\r\n    msg.style.setProperty('border-bottom', '1px solid ' + BorderColor);\r\n\r\n    if FMsgDlgType <> mtCustom then\r\n    begin\r\n      icon := TJSHTMLElement(document.createElement('DIV'));\r\n      icon.innerHTML := '<i class=\"material-icons\" style=\"color:' + MsgColor + '!important;font-size:48px!important\">' + MsgSymbol + '</i>';\r\n      icon.style.setProperty('display', 'inline-block');\r\n      icon.style.setProperty('float', 'left');\r\n      icon.style.setProperty('padding-right', '15px');\r\n      msg.appendChild(icon);\r\n    end;\r\n\r\n    FMessage := StringReplace(FMessage, sLineBreak, '<BR>', [rfReplaceAll]);\r\n\r\n    contentdiv := TJSHTMLElement(document.createElement('DIV'));\r\n    contentdiv.innerHTML := FMessage;\r\n    contentdiv.style.setProperty('height','auto');\r\n    contentdiv.style.setProperty('min-height','50px');\r\n    contentdiv.style.setProperty('white-space','pre-wrap');\r\n\r\n    content := TJSHTMLElement(document.createElement('LABEL'));\r\n    content.innerHTML := FMessage;\r\n\r\n    if FElementTitleClassName <> '' then\r\n    begin\r\n      content['class'] := FElementContentClassName;\r\n    end;\r\n\r\n    contentdiv.appendChild(content);\r\n\r\n    msg.appendChild(content);\r\n\r\n    edlg.appendChild(msg);\r\n\r\n    bar := TJSHTMLElement(document.createElement('DIV'));\r\n    bar.style.setProperty('background-color', BarBGColor);\r\n    bar.style.setProperty('padding', Padding + 'px');\r\n    bar.style.setProperty('min-height', BarHeight + 'px');\r\n    bar.style.setProperty('height', 'auto');\r\n    bar.style.setProperty('line-height', BarHeight + 'px');\r\n    bar.style.setProperty('text-align', 'right');\r\n    edlg.appendChild(bar);\r\n  end;\r\n\r\n  if (FButtons = []) and (CustomButtons.Count = 0) then\r\n    bar.appendChild(CreateButton(GetDialogText(5), btnFocus))\r\n  else\r\n  begin\r\n    if mbYes in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(7), btnFocus));\r\n\r\n    if mbNo in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(8), btnFocus));\r\n\r\n    if mbOK in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(5), btnFocus));\r\n\r\n    if mbCancel in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(6), btnFocus));\r\n\r\n    if mbAbort in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(9), btnFocus));\r\n\r\n    if mbRetry in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(10), btnFocus));\r\n\r\n    if mbIgnore in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(11), btnFocus));\r\n\r\n    if mbAll in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(12), btnFocus));\r\n\r\n    if mbNoToAll in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(13), btnFocus));\r\n\r\n    if mbYesToAll in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(14), btnFocus));\r\n\r\n    if mbHelp in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(15), btnFocus));\r\n\r\n    if mbClose in FButtons then\r\n      bar.appendChild(CreateButton(GetDialogText(16), btnFocus));\r\n  end;\r\n\r\n  for i := 0 to FCustomButtons.Count - 1 do\r\n  begin\r\n    bar.appendChild(CreateButton(FCustomButtons[i].Caption, btnFocus, FCustomButtons[i].ElementClassName));\r\n  end;\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.style.setProperty('background-color', 'black');\r\n  eh.style.setProperty('opacity', DoubleToHTML(Opacity));\r\n\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n  eh.style.setProperty('z-index', '19990');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.SetProperty('position','fixed');\r\nend;\r\n\r\nprocedure TMessageDlg.SetCustomButtons(const Value: TCustomDialogButtons);\r\nbegin\r\n  FCustomButtons.Assign(Value);\r\nend;\r\n\r\nprocedure TMessageDlg.SetDialogResult(const Value: TDialogResult);\r\nbegin\r\n  FDialogResult := Value;\r\n  if (FDialogResult <> mrNone) then\r\n    Close;\r\nend;\r\n\r\nprocedure TMessageDlg.SetDialogText(const Value: TStringList);\r\nbegin\r\n  FDialogText.Assign(Value);\r\nend;\r\n\r\nprocedure TMessageDlg.Close;\r\nbegin\r\n  Application.UnlockForm(Application.MainForm);\r\n\r\n  document.body.removeChild(FLayer);\r\n  document.body.removeChild(FDlg);\r\n\r\n  FDown := false;\r\n  FCaptured := false;\r\n\r\n  if Assigned(OnClose) then\r\n    OnClose(Self);\r\n\r\n  if Assigned(FDialogProc) then\r\n    FDialogProc(FDialogResult);\r\nend;\r\n\r\nfunction TMessageDlg.HandleButtonClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  id: string;\r\n  i: integer;\r\nbegin\r\n  DialogResult := mrNone;\r\n\r\n  id := event.target['id'];\r\n\r\n  if id = GetDialogText(7) then\r\n    DialogResult := mrYes\r\n  else if id = GetDialogText(8) then\r\n    DialogResult := mrNo\r\n  else if id = GetDialogText(5) then\r\n    DialogResult := mrOK\r\n  else if id = GetDialogText(6) then\r\n    DialogResult := mrCancel\r\n  else if id = GetDialogText(9) then\r\n    DialogResult := mrAbort\r\n  else if id = GetDialogText(10) then\r\n    DialogResult := mrRetry\r\n  else if id = GetDialogText(11) then\r\n    DialogResult := mrIgnore\r\n  else if id = GetDialogText(12) then\r\n    DialogResult := mrAll\r\n  else if id = GetDialogText(13) then\r\n    DialogResult := mrNoToAll\r\n  else if id = GetDialogText(14) then\r\n    DialogResult := mrYesToAll\r\n  else if id = GetDialogText(15) then\r\n    DialogResult := mrHelp\r\n  else if id = GetDialogText(16) then\r\n    DialogResult := mrClose;\r\n\r\n  if (DialogResult = mrNone) and (CustomButtons.Count > 0) then\r\n  begin\r\n    for i := 0 to CustomButtons.Count - 1 do\r\n    begin\r\n      if id = CustomButtons[i].Caption then\r\n      begin\r\n        DialogResult := 100 + i;\r\n        break;\r\n      end;\r\n\r\n    end;\r\n  end;\r\n\r\n  if Assigned(OnButtonClick) then\r\n    OnButtonClick(Self);\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TMessageDlg.HandleDocMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  deltax,deltay: double;\r\n  el: TJSHTMLElement;\r\nbegin\r\n  if FDown then\r\n  begin\r\n    deltax := Event.screenX - FMdx;\r\n    deltay := Event.screenY - FMdy;\r\n\r\n    el := TJSHTMLElement(FDlg);\r\n\r\n    el.style.setProperty('transform','');\r\n    el.style.setProperty('position','absolute');\r\n    el.style.setProperty('left', inttostr(round(FDlgX + deltax))+'px');\r\n    el.style.setProperty('top', inttostr(round(FDlgY + deltay))+'px');\r\n\r\n    el := TJSHTMLElement(FCancel);\r\n    el.style.setProperty('position', 'absolute');\r\n    el.style.setProperty('top', '0');\r\n    el.style.setProperty('right', '0');\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TMessageDlg.HandleDocMouseUp(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FDown := false;\r\n  document.body.removeEventListener('mousemove', @HandleDocMouseMove);\r\n  document.body.removeEventListener('mouseup', @HandleDocMouseUp);\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TMessageDlg.HandleMouseDown(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  r: TJSDOMRect;\r\nbegin\r\n  FMdx := Round(Event.screenX);\r\n  FMdy := Round(Event.screenY);\r\n\r\n  r := FDlg.getBoundingClientRect();\r\n\r\n  FDlgX := Round(int(r.left));\r\n  FDlgY := Round(int(r.top));\r\n\r\n  FDown := true;\r\n\r\n  if not FCaptured then\r\n  begin\r\n    FCaptured := true;\r\n    document.body.addEventListener('mousemove', @HandleDocMouseMove);\r\n    document.body.addEventListener('mouseup', @HandleDocMouseUp);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TMessageDlg.InitBootstrapStyle;\r\nbegin\r\n  FElementButtonClassName := 'btn';\r\n  FElementContentClassName := 'text-body';\r\n  FElementTitleClassName := 'text-body';\r\n  FElementDialogClassName := 'shadow-lg p-3 mb-5 bg-white rounded';\r\nend;\r\n\r\nfunction TMessageDlg.HandleKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\nbegin\r\n  k := GetKeyCode(Event.Key);\r\n  if not Assigned(k) then\r\n    Exit;\r\n  if k = VK_ESCAPE then\r\n    DialogResult := mrCancel;\r\n  Result := true;\r\nend;\r\n\r\n{ TWaitMessage }\r\n\r\nfunction TWaitMessage.CreateElement: TJSElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n    Result := nil\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TWaitMessage.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FOpacity := 0.2;\r\n  FPicture := TURLPicture.Create;\r\n  FIsWaiting := false;\r\nend;\r\n\r\ndestructor TWaitMessage.Destroy;\r\nbegin\r\n  FPicture.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TWaitMessage.Hide;\r\nbegin\r\n  if FIsWaiting then\r\n    document.body.removeChild(FLayer);\r\n  FIsWaiting := false;\r\nend;\r\n\r\nprocedure TWaitMessage.SetPicture(const Value: TURLPicture);\r\nbegin\r\n  FPicture.Assign(Value);\r\nend;\r\n\r\nprocedure TWaitMessage.Show;\r\nvar\r\n  eh,img,dv: TJSHTMLElement;\r\n  el: TJSElement;\r\nbegin\r\n  FLayer := document.createElement('SPAN');\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.style.setProperty('background-color', 'black');\r\n  eh.style.setProperty('opacity', DoubleToHTML(Opacity));\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n  eh.style.setProperty('z-index', '19999');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.SetProperty('position','fixed');\r\n\r\n  document.body.appendChild(FLayer);\r\n  FLayer['tabindex'] := '0';\r\n\r\n  el := document.createElement('DIV');\r\n  dv := TJSHTMLElement(el);\r\n  FLayer.appendChild(el);\r\n  dv.style.SetProperty('position','relative');\r\n  dv.style.SetProperty('width','100%');\r\n  dv.style.SetProperty('height','100%');\r\n\r\n  el := document.createElement('IMG');\r\n  img := TJSHTMLElement(el);\r\n  dv.appendChild(img);\r\n  img['src'] := FPicture.FileName;\r\n  img.style.setProperty('position','absolute');\r\n  img.style.setProperty('top', '0');\r\n  img.style.setProperty('left', '0');\r\n  img.style.setProperty('right', '0');\r\n  img.style.setProperty('bottom', '0');\r\n  img.style.setProperty('margin', 'auto');\r\n\r\n  FIsWaiting := true;\r\n\r\n  if Assigned(OnShow) then\r\n  begin\r\n    window.setTimeout(@WaitDisplayed, 100);\r\n  end;\r\nend;\r\n\r\nprocedure TWaitMessage.WaitDisplayed;\r\nbegin\r\n  if Assigned(OnShow) then\r\n    OnShow(Self);\r\nend;\r\n\r\n{ TCustomDialogButtons }\r\n\r\nfunction TCustomDialogButtons.Add: TCustomDialogButton;\r\nbegin\r\n  Result := TCustomDialogButton(inherited Add);\r\nend;\r\n\r\nfunction TCustomDialogButtons.GetItem(AIndex: integer): TCustomDialogButton;\r\nbegin\r\n  Result := TCustomDialogButton(inherited Items[AIndex]);\r\nend;\r\n\r\nfunction TCustomDialogButtons.Insert(AIndex: integer): TCustomDialogButton;\r\nbegin\r\n  Result := TCustomDialogButton(inherited Insert(AIndex));\r\nend;\r\n\r\nprocedure TCustomDialogButtons.SetItem(AIndex: integer;\r\n  const Value: TCustomDialogButton);\r\nbegin\r\n  inherited Items[AIndex] := Value;\r\nend;\r\n\r\n{ TOpenDialog }\r\n\r\nconstructor TOpenDialog.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  FFiles := TFiles.Create(Self);\r\nend;\r\n\r\ndestructor TOpenDialog.Destroy;\r\nbegin\r\n  FFiles.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TOpenDialog.Execute(AProc: TOpenDialogProc);\r\nbegin\r\n  FOpenDialogProc := AProc;\r\n  Execute;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TOpenDialog.Execute;\r\nvar\r\n  ic: pointer;\r\n  fp: TJSHTMLElement;\r\nbegin\r\n  ic := @HandleInputChange;\r\n  fp := TJSHTMLElement(document.createElement('input'));\r\n  fp.setAttribute('type','file');\r\n  if FMultiFile then\r\n    fp.setAttribute('multiple','');\r\n\r\n  if FAccept <> '' then\r\n    fp.SetAttribute('accept',FAccept);\r\n\r\n  fp.addEventListener('change', ic);\r\n\r\n  asm\r\n    fp.click();\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TOpenDialog.HandleInputChange(Event: TJSEvent);\r\nvar\r\n  i,l,sz: integer;\r\n  s,m: string;\r\n  f: TFile;\r\n  d: TJSDate;\r\n  jsfile: TJSHTMLFile;\r\n\r\nbegin\r\n  // clear existing collection\r\n  while FFiles.Count > 0 do\r\n    FFiles.Delete(0);\r\n\r\n  asm\r\n    var curFiles = Event.target.files;\r\n    l = curFiles.length;\r\n  end;\r\n\r\n  for i := 0 to l - 1 do\r\n  begin\r\n    f := FFiles.Add;\r\n\r\n    asm\r\n      jsfile = curFiles[i];\r\n      s = curFiles[i].name;\r\n      m = curFiles[i].type;\r\n      sz = curFiles[i].size;\r\n      d = new Date(curFiles[i].lastModified);\r\n    end;\r\n\r\n    // get the first file\r\n    if (i = 0) then\r\n      FFileName := s;\r\n\r\n    f.FileObject := jsfile;\r\n    f.Name := s;\r\n    f.MimeType := m;\r\n    f.Size := sz;\r\n    f.Modified := EncodeDate(d.Year + 1900, d.Month + 1, d.Date)+EncodeTime(d.Hours, d.Minutes, d.Seconds, d.Milliseconds);\r\n  end;\r\n\r\n  if Assigned(FOpenDialogProc) then\r\n    FOpenDialogProc(FFileName);\r\n\r\n  FOpenDialogProc := nil;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\ninitialization\r\n  WebLibDlg := nil;\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.ClientConnector;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.JSON;\r\n\r\ntype\r\n  TClientConnectorIdentifier = (ciUnknown, ciAndroid, ciiOS, ciWindows, ciMac);\r\n\r\n  TClientConnectorReceivedMessageEvent = procedure(Sender: TObject; AJSON: TJSONObject) of object;\r\n\r\n  TClientConnector = class(TComponent)\r\n  private\r\n    FOnReceivedMessage: TClientConnectorReceivedMessageEvent;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Receive(AJSON: string);\r\n    procedure Send(AJSON: TJSONObject);\r\n    procedure SendMessage(AMessage: string);\r\n  published\r\n    property OnReceivedMessage: TClientConnectorReceivedMessageEvent read FOnReceivedMessage write FOnReceivedMessage;\r\n  end;\r\n\r\n  TWebClientConnector = class(TClientConnector);\r\n\r\nimplementation\r\n\r\nuses\r\n  Math, JS, WEBLib.Forms, SysUtils, WEBLib.Dialogs;\r\n\r\nconst\r\n  Prefix: string = 'webclientevent://';\r\n\r\nconstructor TClientConnector.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  Application.ClientConnector := Self;\r\nend;\r\n\r\ndestructor TClientConnector.Destroy;\r\nbegin\r\n  Application.ClientConnector := nil;\r\n  inherited;\r\nend;\r\n\r\nprocedure TClientConnector.Receive(AJSON: string);\r\nvar\r\n  js: TJSON;\r\n  o: TJSONObject;\r\n  s: string;\r\nbegin\r\n  js := TJSON.Create;\r\n  s := decodeURIComponent(AJSON);\r\n  o := js.parse(s);\r\n  if Assigned(OnReceivedMessage) then\r\n    OnReceivedMessage(Self, o);\r\n  o.Free;\r\nend;\r\n\r\nprocedure TClientConnector.Send(AJSON: TJSONObject);\r\nvar\r\n  s: string;\r\nbegin\r\n  s := TJSJSON.stringify(AJSON.JSObject);\r\n  SendMessage(s);\r\nend;\r\n\r\nprocedure TClientConnector.SendMessage(AMessage: string);\r\nconst\r\n  MAXBUFFERCOUNT = 500;\r\nvar\r\n  s: string;\r\n  cid: TClientConnectorIdentifier;\r\n  scid: string;\r\n  sSub: string;\r\n  sc: Integer;\r\n\r\n  procedure InternalSend(m: string);\r\n  begin\r\n    case cid of\r\n      ciAndroid:\r\n      begin\r\n        asm\r\n          injectedObject.Setjsvalue(m);\r\n          injectedObject.performClick();\r\n        end;\r\n      end;\r\n      ciiOS, ciMac:\r\n      begin\r\n        asm\r\n          window.webkit.messageHandlers.bridge.postMessage(m);\r\n        end;\r\n      end;\r\n      ciWindows:\r\n      begin\r\n        asm\r\n          window.location = m;\r\n        end;\r\n      end;\r\n      ciUnknown: ShowMessage('Please perform handshake from client first.');\r\n    end;\r\n  end;\r\nbegin\r\n  s := AMessage;\r\n  asm\r\n    scid = window.TMSWEBCoreClientIdentifier;\r\n  end;\r\n\r\n  cid := ciUnknown;\r\n  case LowerCase(scid) of\r\n    'android': cid := ciAndroid;\r\n    'ios': cid := ciiOS;\r\n    'windows': cid := ciWindows;\r\n    'mac', 'macos': cid := ciMac;\r\n  end;\r\n\r\n\r\n  case LowerCase(scid) of\r\n    'mac', 'macos', 'ios': InternalSend(Prefix + encodeURIcomponent(s));\r\n    'android', 'windows':\r\n    begin\r\n      InternalSend(Prefix + 'BUFFERSTART');\r\n      while Length(s) > 0 do\r\n      begin\r\n        sc := Min(Integer(Length(s)), MAXBUFFERCOUNT);\r\n        sSub := Copy(s, 1, sc);\r\n        Delete(s, 1, sc);\r\n        InternalSend(Prefix + encodeURIcomponent(sSub));\r\n      end;\r\n      InternalSend(Prefix + 'BUFFEREND');\r\n    end;\r\n  end;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Forms;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, Types, SysUtils, WEBLib.Graphics, WEBLib.Controls, WEBLib.Modules,\r\n  WEBLib.Lang, Web, JS, WEBLib.ClientConnector\r\n  {$IFDEF SINGLEINSTANCE}\r\n  , WEBLib.WebSocketClient\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  idOK       = 1;\r\n  idCancel   = 2;\r\n  idAbort    = 3;\r\n  idRetry    = 4;\r\n  idIgnore   = 5;\r\n  idYes      = 6;\r\n  idNo       = 7;\r\n  idClose    = 8;\r\n  idHelp     = 9;\r\n  idTryAgain = 10;\r\n  idContinue = 11;\r\n  mrNone     = 0;\r\n  mrOk       = idOk;\r\n  mrCancel   = idCancel;\r\n  mrAbort    = idAbort;\r\n  mrRetry    = idRetry;\r\n  mrIgnore   = idIgnore;\r\n  mrYes      = idYes;\r\n  mrNo       = idNo;\r\n  mrClose    = idClose;\r\n  mrHelp     = idHelp;\r\n  mrTryAgain = idTryAgain;\r\n  mrContinue = idContinue;\r\n  mrAll      = mrContinue + 1;\r\n  mrNoToAll  = mrAll + 1;\r\n  mrYesToAll = mrNoToAll + 1;\r\n\r\n  FORMCAPTIONHEIGHT = 22;\r\n\r\n  rgiFirst = -1024;\r\n  rgiLast  = -513;\r\n  igiFirst = 256;\r\n  igiLast  = 511;\r\n\r\n  clTMSBlue = $E39E00;\r\n  clTMSWEB = $8F8300;\r\n\r\ntype\r\n  TDragDockObject = class;\r\n  TCustomForm = class;\r\n\r\n  TConstraintSize = 0..MaxInt;\r\n  TCloseAction = (caNone, caHide, caFree, caMinimize);\r\n  TModalResult = Integer;\r\n  TFormStyle = (fsNormal, fsStayOnTop);\r\n  TNavigationTarget = (ntBlank, ntPage);\r\n  TBiDiMode = (bdLeftToRight, bdRightToLeft, bdRightToLeftNoAlign, bdRightToLeftReadingOnly);\r\n  TGestureID = rgiFirst..igiLast;\r\n  TInteractiveGestureFlag = (gfBegin, gfInertia, gfEnd);\r\n  TInteractiveGestureFlags = set of TInteractiveGestureFlag;\r\n  TMouseActivate = (maDefault, maActivate, maActivateAndEat, maNoActivate, maNoActivateAndEat);\r\n\r\n  TSmallPoint  = record\r\n    x, y: SmallInt;\r\n  end;\r\n\r\n  TAlignInfo = record\r\n    AlignList: TList;\r\n    ControlIndex: Integer;\r\n    Align: TAlign;\r\n    Scratch: Integer;\r\n  end;\r\n\r\n  TGestureEventInfo = record\r\n    GestureID: TGestureID;\r\n    Location: TPoint;\r\n    Flags: TInteractiveGestureFlags;\r\n    Angle: Double;\r\n    InertiaVector: TSmallPoint;\r\n    Distance: Integer;\r\n    TapLocation: TSmallPoint;\r\n  end;\r\n\r\n  TOnPaintEvent = TNotifyEvent;\r\n  TCloseEvent = procedure(Sender: TObject; var Action: TCloseAction) of object;\r\n  TCloseQueryEvent = procedure(Sender: TObject; var CanClose: Boolean) of object;\r\n  TBeforeUnloadEvent = procedure(Sender: TObject; var AMessage: string) of object;\r\n  TAlignInsertBeforeEvent = function(Sender: TWinControl; C1, C2: TControl): Boolean of object;\r\n  TAlignPositionEvent = procedure(Sender: TWinControl; Control: TControl;\r\n    var NewLeft, NewTop, NewWidth, NewHeight: Integer;\r\n    var AlignRect: TRect; AlignInfo: TAlignInfo) of object;\r\n  TCanResizeEvent = procedure(Sender: TObject; var NewWidth, NewHeight: Integer;\r\n    var Resize: Boolean) of object;\r\n  TConstrainedResizeEvent = procedure(Sender: TObject; var MinWidth, MinHeight,\r\n    MaxWidth, MaxHeight: Integer) of object;\r\n  TContextPopupEvent = procedure(Sender: TObject; MousePos: TPoint; var Handled: Boolean) of object;\r\n  TDockDropEvent = procedure(Sender: TObject; Source: TDragDockObject;\r\n    X, Y: Integer) of object;\r\n  TDockOverEvent = procedure(Sender: TObject; Source: TDragDockObject;\r\n    X, Y: Integer; State: TDragState; var Accept: Boolean) of object;\r\n  TGestureEvent = procedure(Sender: TObject; const EventInfo: TGestureEventInfo;\r\n     var Handled: Boolean) of object;\r\n  TGetSiteInfoEvent = procedure(Sender: TObject; DockClient: TControl;\r\n    var InfluenceRect: TRect; MousePos: TPoint; var CanDock: Boolean) of object;\r\n  TMouseActivateEvent = procedure(Sender: TObject; Button: TMouseButton;\r\n    Shift: TShiftState; X, Y: Integer; HitTest: Integer; var MouseActivate: TMouseActivate) of object;\r\n  TMouseWheelUpDownEvent = procedure(Sender: TObject; Shift: TShiftState;\r\n    MousePos: TPoint; var Handled: Boolean) of object;\r\n  TStartDockEvent = procedure(Sender: TObject;\r\n    var DragObject: TDragDockObject) of object;\r\n  TUnDockEvent = procedure(Sender: TObject; Client: TControl;\r\n    NewTarget: TWinControl; var Allow: Boolean) of object;\r\n\r\n  TModalResultProc = reference to procedure(AValue: TModalResult);\r\n  TFormCreatedProc = reference to procedure(AForm: TObject);\r\n\r\n  TWindowState = (wsNormal, wsMinimized, wsMaximized);\r\n\r\n  TPopupMode = (pmNone, pmAuto, pmExplicit);\r\n  TPopupClose = (pcOnDeactivate, pcNever);\r\n  TPosition = (poDesigned, poDefault, poDefaultPosOnly, poDefaultSizeOnly, poScreenCenter, poDesktopCenter, poMainFormCenter, poOwnerFormCenter);\r\n\r\n  TApplicationErrorType = (aeSilent, aeDialog, aeAlert, aeFooter);\r\n\r\n  TFormBorderStyle = (fbNone, fbSingle, fbSizeable, fbDialog, fbDialogSizeable);\r\n  TFormBorder = fbNone..fbSingle;\r\n\r\n  TCSSLibrary = (cssNone, cssBootstrap);\r\n\r\n  TCustomSizeConstraints = class(TPersistent)\r\n  private\r\n    FControl: TControl;\r\n    FMaxHeight: TConstraintSize;\r\n    FMaxWidth: TConstraintSize;\r\n    FMinHeight: TConstraintSize;\r\n    FMinWidth: TConstraintSize;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetConstraints(AIndex: Integer; AValue: TConstraintSize);\r\n  protected\r\n    procedure Change; virtual;\r\n    procedure AssignTo(ADest: TPersistent); override;\r\n    property Control: TControl read FControl;\r\n    property MaxHeight: TConstraintSize index 0 read FMaxHeight write SetConstraints default 0;\r\n    property MaxWidth: TConstraintSize index 1 read FMaxWidth write SetConstraints default 0;\r\n    property MinHeight: TConstraintSize index 2 read FMinHeight write SetConstraints default 0;\r\n    property MinWidth: TConstraintSize index 3 read FMinWidth write SetConstraints default 0;\r\n  public\r\n    constructor Create(AControl: TControl); virtual;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TSizeConstraints = class(TCustomSizeConstraints)\r\n  published\r\n    property MaxHeight;\r\n    property MaxWidth;\r\n    property MinHeight;\r\n    property MinWidth;\r\n  end;\r\n\r\n  TDragDockObject = class(TObject)\r\n  strict private\r\n    FBrush: TBrush;\r\n    FDockRect: TRect;\r\n    FDropAlign: TAlign;\r\n    FDropOnControl: TControl;\r\n    FEraseDockRect: TRect;\r\n    FEraseWhenMoving: Boolean;\r\n    FFloating: Boolean;\r\n    FFrameWidth: Integer;\r\n  public\r\n    constructor Create(AControl: TControl);\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TDragObject);\r\n    property Brush: TBrush read FBrush write FBrush;\r\n    property DockRect: TRect read FDockRect write FDockRect;\r\n    property DropAlign: TAlign read FDropAlign;\r\n    property DropOnControl: TControl read FDropOnControl;\r\n    property EraseDockRect: TRect read FEraseDockRect write FEraseDockRect;\r\n    property EraseWhenMoving: Boolean read FEraseWhenMoving;\r\n    property Floating: Boolean read FFloating write FFloating;\r\n    property FrameWidth: Integer read FFrameWidth;\r\n  end;\r\n\r\n  TCustomForm = class(TWinControl)\r\n  private\r\n    FDesignContainer: TJSElement;\r\n    FLayer: TJSElement;\r\n    FPopup: Boolean;\r\n    FPopupElement: TJSHTMLElement;\r\n    FFormFileName: string;\r\n    FFormContent: string;\r\n    FFormContainer: string;\r\n    FFormElement: string;\r\n    FFormStyle: TFormStyle;\r\n    FOnCreate: TNotifyEvent;\r\n    FOnResize: TNotifyEvent;\r\n    FOnShow: TNotifyEvent;\r\n    FModalResult: TModalResult;\r\n    FOnPaint: TOnPaintEvent;\r\n    FOnDeactivate: TNotifyEvent;\r\n    FOnCloseQuery: TCloseQueryEvent;\r\n    FOnClose: TCloseEvent;\r\n    FModalProc: TModalResultProc;\r\n    FCreatedProc: TFormCreatedProc;\r\n    FWindowState: TWindowState;\r\n    FCaption: string;\r\n    FIsResizing: boolean;\r\n    FOnScroll: TNotifyEvent;\r\n    FOnUnload: TNotifyEvent;\r\n    FOnBeforeUnload: TBeforeUnloadEvent;\r\n    FPopupMode: TPopupMode;\r\n    FPopupClose: TPopupClose;\r\n    FPosition: TPosition;\r\n    FActiveControl: TWinControl;\r\n    FMdx, FMdy: integer;\r\n    FDlgX, FDlgY: integer;\r\n    FCaptured: boolean;\r\n    FDown: boolean;\r\n    FHasCaption: boolean;\r\n    FMoveSpan: TJSHTMLElement;\r\n    FCaptionElement: TJSHTMLElement;\r\n    FBorder: TFormBorderStyle;\r\n    FShadow: boolean;\r\n    FTimerID: integer;\r\n    FOrigWidth, FOrigHeight: integer;\r\n    FOnDestroy: TNotifyEvent;\r\n    FPopupOpacity: single;\r\n    FCreating: boolean;\r\n    FLoadedPtr: pointer;\r\n    FUnloadPtr: pointer;\r\n    FBeforeUnloadPtr: pointer;\r\n    FResizePtr: pointer;\r\n    FScrollPtr: pointer;\r\n    FDocMouseUpPtr: pointer;\r\n    FDocMouseMovePtr: pointer;\r\n    FTitleDownPtr: pointer;\r\n    FDoClickPtr: pointer;\r\n    FKeyDownPtr: pointer;\r\n    FCSSLibrary: TCSSLibrary;\r\n    FNoHTML: boolean;\r\n    FPrevActiveForm: TCustomForm;\r\n    FElementCaptionClassName: TElementClassName;\r\n    FMenu: TCustomControl;\r\n    procedure SetModalResult(const Value: TModalResult);\r\n    function GetFormStyle: TFormStyle;\r\n    procedure SetFormStyle(const Value: TFormStyle);\r\n    function GetCanvas: TCanvas;\r\n    procedure SetCaption(const AValue: string);\r\n    procedure SetActiveControl(const Value: TWinControl);\r\n    procedure SetShadow(const Value: boolean);\r\n    procedure SetBorder(const Value: TFormBorderStyle);\r\n    procedure SetFormContainer(const Value: string);\r\n    function GetActiveControl: TWinControl;\r\n    procedure SetWidth(AValue: Integer); override;\r\n    procedure SetHeight(AValue: Integer); override;\r\n    procedure SetLeft(AValue: Integer); override;\r\n    procedure SetTop(AValue: Integer); override;\r\n  protected\r\n    function HandleLoaded(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleScroll(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleUnload(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleBeforeUnload(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleObserver: boolean; virtual;\r\n    function HandleResize(Event: TEventListenerEvent): boolean; virtual;\r\n    function HandleDocMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDocMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleTitleDown(Event: TJSMouseEvent): Boolean; virtual;\r\n\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure Resize; reintroduce; virtual;\r\n    procedure CreateControl; override;\r\n    procedure DoClose(var CloseAction: TCloseAction); virtual;\r\n    procedure BindEvents; override;\r\n    procedure UnbindEvents; override;\r\n    procedure DoCreate; virtual;\r\n    procedure DoResize; virtual;\r\n    procedure DoShow; virtual;\r\n    procedure Paint; virtual;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; reintroduce; virtual;\r\n    function HandleKeyDown(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    procedure HandleDoResize; virtual;\r\n    function GetWidth: Integer; override;\r\n    function GetHeight: Integer; override;\r\n    function GetLeft: Integer; override;\r\n    function GetTop: Integer; override;\r\n    function GetClientRect: TRect; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    function ContainerElement: TJSElement; override;\r\n    function FormContainerElement: TJSElement; virtual;\r\n    function GetElementBindHandle: TJSEventTarget; override;\r\n    function GetElementHandle: TJSHTMLElement; override;\r\n    function CloseQuery: Boolean; virtual;\r\n    procedure LoadDFMValues; virtual;\r\n    procedure Init; virtual;\r\n    property FormContent: string read FFormContent write FFormContent;\r\n    property WindowState: TWindowState read FWindowState write FWindowState;\r\n    function IsFocused: Boolean; override;\r\n    property PopupMode: TPopupMode read FPopupMode write FPopupMode default pmNone;\r\n    property PopupClose: TPopupClose read FPopupClose write FPopupClose default pcOnDeactivate;\r\n    property Position: TPosition read FPosition write FPosition default poDefaultPosOnly;\r\n    function GetUniqueComponentName(AComponent: TComponent): string;\r\n    function CreateLayer: TJSHTMLElement;\r\n    function CreateCaption: TJSHTMLElement;\r\n    function GetCaptionHeight: integer;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    constructor Create(id: string); overload; override;\r\n    constructor Create(id: string; var AReference); overload; virtual;\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    constructor CreateNew(AOwner: TComponent; Dummy: Integer = 0); overload; virtual;\r\n    constructor CreateNew(AFileName: string); overload; virtual;\r\n    constructor CreateNew; overload; virtual;\r\n    constructor CreateNew(AProc: TFormCreatedProc); overload; virtual;\r\n    constructor CreateNew(AElementID: string; AProc: TFormCreatedProc); overload; virtual;\r\n    constructor CreateDialog(ACaption: string); virtual;\r\n    constructor CreateDialogNew(ACaption: string); virtual;\r\n\r\n    destructor Destroy; override;\r\n    procedure Close; virtual;\r\n    procedure PreventDefault; reintroduce;\r\n    property ActiveControl: TWinControl read GetActiveControl write SetActiveControl;\r\n    property ModalResult: TModalResult read FModalResult write SetModalResult;\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property CaptionElement: TJSHTMLElement read FCaptionElement;\r\n    property ElementCaptionClassName: TElementClassName read FElementCaptionClassName write FElementCaptionClassName;\r\n    procedure SetBounds(X, Y, AWidth, AHeight: Integer); override;\r\n    procedure SelectFirst;\r\n    procedure SelectNext(CurControl: TControl; GoForward: boolean; CheckTabStop: boolean);\r\n    procedure Show;\r\n    function ShowModal: Integer; overload; virtual;\r\n    function ShowModal(AProc: TModalResultProc): TModalResult; overload; virtual;\r\n    property Border: TFormBorderStyle read FBorder write SetBorder;\r\n    property Caption: string read FCaption write SetCaption;\r\n    property Color;\r\n    property CSSLibrary: TCSSLibrary read FCSSLibrary write FCSSLibrary;\r\n    property FormContainer: string read FFormContainer write SetFormContainer;\r\n    property FormFileName: string read FFormFileName write FFormFileName;\r\n    property FormStyle: TFormStyle read GetFormStyle write SetFormStyle;\r\n    property IsResizing: boolean read FIsResizing;\r\n    property Menu: TCustomControl read FMenu write FMenu;\r\n    property Popup: boolean read FPopup write FPopup;\r\n    property PopupOpacity: single read FPopupOpacity write FPopupOpacity;\r\n    property Shadow: boolean read FShadow write SetShadow;\r\n    property OnBeforeUnload: TBeforeUnloadEvent read FOnBeforeUnload write FOnBeforeUnload;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnClose: TCloseEvent read FOnClose write FOnClose;\r\n    property OnCloseQuery: TCloseQueryEvent read FOnCloseQuery write FOnCloseQuery;\r\n    property OnCreate: TNotifyEvent read FOnCreate write FOnCreate;\r\n    property OnDestroy: TNotifyEvent read FOnDestroy write FOnDestroy;\r\n    property OnDeactivate: TNotifyEvent read FOnDeactivate write FOnDeactivate;\r\n    property OnPaint: TOnPaintEvent read FOnPaint write FOnPaint;\r\n    property OnResize: TNotifyEvent read FOnResize write FOnResize;\r\n    property OnScroll: TNotifyEvent read FOnScroll write FOnScroll;\r\n    property OnShow: TNotifyEvent read FOnShow write FOnShow;\r\n    property OnUnload: TNotifyEvent read FOnUnload write FOnUnload;\r\n  end;\r\n\r\n  TFormClass = class of TForm;\r\n  TForm = class(TCustomForm)\r\n  public\r\n    property ClientHeight;\r\n    property ClientWidth;\r\n    property PopupMode;\r\n    property Position;\r\n  published\r\n    property Align;\r\n    property Caption;\r\n    property Color;\r\n    property CSSLibrary;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Font;\r\n    property FormContainer;\r\n    property FormStyle;\r\n    property Menu;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property OnClick;\r\n    property OnClose;\r\n    property OnCloseQuery;\r\n    property OnCreate;\r\n    property OnDblClick;\r\n    property OnDeactivate;\r\n    property OnResize;\r\n    property OnShow;\r\n    property OnScroll;\r\n    property OnPaint;\r\n    property OnTouchStart;\r\n    property OnTouchMove;\r\n    property OnTouchEnd;\r\n    property OnUnload;\r\n  end;\r\n\r\n  TWebForm = TForm;\r\n\r\n  TPopupMenu = class(TComponent)\r\n  end;\r\n\r\n  TTouchManager = class(TComponent)\r\n  end;\r\n\r\n  TCustomFrame = class(TCustomHTMLDiv)\r\n  private\r\n    FAlign: TAlign;\r\n    FAutoScroll: Boolean;\r\n    FAutoSize: Boolean;\r\n    FBiDiMode: TBiDiMode;\r\n    FConstraints: TSizeConstraints;\r\n    FCtl3D: Boolean;\r\n    FDockSite: Boolean;\r\n    FDragCursor: TCursor;\r\n    FDragKind: TDragKind;\r\n    FDragMode: TDragMode;\r\n    FOnAlignInsertBefore: TAlignInsertBeforeEvent;\r\n    FOnAlignPosition: TAlignPositionEvent;\r\n    FOnCanResize: TCanResizeEvent;\r\n    FOnConstrainedResize: TConstrainedResizeEvent;\r\n    FOnContextPopup: TContextPopupEvent;\r\n    FOnDockDrop: TDockDropEvent;\r\n    FOnDockOver: TDockOverEvent;\r\n    FOnEndDock: TEndDragEvent;\r\n    FOnGesture: TGestureEvent;\r\n    FOnGetSiteInfo: TGetSiteInfoEvent;\r\n    FOnMouseActivate: TMouseActivateEvent;\r\n    FOnMouseWheelDown: TMouseWheelUpDownEvent;\r\n    FOnMouseWheelUp: TMouseWheelUpDownEvent;\r\n    FOnStartDock: TStartDockEvent;\r\n    FOnUnDock: TUnDockEvent;\r\n    FPadding: TPadding;\r\n    FParentBackground: Boolean;\r\n    FParentBiDiMode: Boolean;\r\n    FParentCtl3D: Boolean;\r\n    FPopupMenu: TPopupMenu;\r\n    FTouch: TTouchManager;\r\n    FTouchManager: TTouchManager;\r\n    procedure setConstraints(const AValue: TSizeConstraints);\r\n    procedure SetPopupMenu(AValue: TPopupMenu);\r\n    procedure SetTouchManager(AValue: TTouchManager);\r\n  protected\r\n    procedure LoadDFMValues; virtual;\r\n    property Align: TAlign read FAlign write FAlign default alNone;\r\n    property AutoScroll: Boolean read FAutoScroll write FAutoScroll default False;\r\n    property AutoSize: Boolean read FAutoSize write FAutoSize default False;\r\n    property BiDiMode: TBiDiMode read FBiDiMode write FBiDiMode stored False;\r\n    property Constraints: TSizeConstraints read FConstraints write setConstraints;\r\n    property Ctl3D: Boolean read FCtl3D write FCtl3D stored False;\r\n    property DockSite: Boolean read FDockSite write FDockSite default False;\r\n    property DragCursor: TCursor read FDragCursor write FDragCursor default crDrag;\r\n    property DragKind: TDragKind read FDragKind write FDragKind default dkDrag;\r\n    property DragMode: TDragMode read FDragMode write FDragMode default dmManual;\r\n    property Padding: TPadding read FPadding write FPadding;\r\n    property ParentBackground: Boolean read FParentBackground write FParentBackground;\r\n    property ParentBiDiMode: Boolean read FParentBiDiMode write FParentBiDiMode default True;\r\n    property ParentCtl3D: Boolean read FParentCtl3D write FParentCtl3D default True;\r\n    property PopupMenu: TPopupMenu read FPopupMenu write SetPopupMenu;\r\n    property Touch: TTouchManager read FTouch write SetTouchManager;\r\n    property OnAlignInsertBefore: TAlignInsertBeforeEvent read FOnAlignInsertBefore write FOnAlignInsertBefore;\r\n    property OnAlignPosition: TAlignPositionEvent read FOnAlignPosition write FOnAlignPosition;\r\n    property OnCanResize: TCanResizeEvent read FOnCanResize write FOnCanResize;\r\n    property OnConstrainedResize: TConstrainedResizeEvent read FOnConstrainedResize write FOnConstrainedResize;\r\n    property OnContextPopup: TContextPopupEvent read FOnContextPopup write FOnContextPopup;\r\n    property OnDockDrop: TDockDropEvent read FOnDockDrop write FOnDockDrop;\r\n    property OnDockOver: TDockOverEvent read FOnDockOver write FOnDockOver;\r\n    property OnEndDock: TEndDragEvent read FOnEndDock write FOnEndDock;\r\n    property OnGesture: TGestureEvent read FOnGesture write FOnGesture;\r\n    property OnGetSiteInfo: TGetSiteInfoEvent read FOnGetSiteInfo write FOnGetSiteInfo;\r\n    property OnMouseActivate: TMouseActivateEvent read FOnMouseActivate write FOnMouseActivate;\r\n    property OnMouseWheelDown: TMouseWheelUpDownEvent read FOnMouseWheelDown write FOnMouseWheelDown;\r\n    property OnMouseWheelUp: TMouseWheelUpDownEvent read FOnMouseWheelUp write FOnMouseWheelUp;\r\n    property OnStartDock: TStartDockEvent read FOnStartDock write FOnStartDock;\r\n    property OnUnDock: TUnDockEvent read FOnUnDock write FOnUnDock;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure LoadFromForm;\r\n  end;\r\n\r\n  TFrame = class(TCustomFrame)\r\n  published\r\n    property Align;\r\n    property Anchors;\r\n    property AutoScroll;\r\n    property AutoSize;\r\n    property BiDiMode;\r\n    property Constraints;\r\n    property DockSite;\r\n    property DoubleBuffered;\r\n    property DragCursor;\r\n    property DragKind;\r\n    property DragMode;\r\n    property Enabled;\r\n    property Color nodefault;\r\n    property Ctl3D;\r\n    property Font;\r\n    property Padding;\r\n    property ParentBackground default True;\r\n    property ParentBiDiMode;\r\n    property ParentColor;\r\n    property ParentCtl3D;\r\n    property ParentDoubleBuffered;\r\n    property ParentFont;\r\n    property ParentShowHint;\r\n    property PopupMenu;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Touch;\r\n    property Visible;\r\n    property OnAlignInsertBefore;\r\n    property OnAlignPosition;\r\n    property OnCanResize;\r\n    property OnClick;\r\n    property OnConstrainedResize;\r\n    property OnContextPopup;\r\n    property OnDblClick;\r\n    property OnDockDrop;\r\n    property OnDockOver;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDock;\r\n    property OnEndDrag;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnGesture;\r\n    property OnGetSiteInfo;\r\n    property OnMouseActivate;\r\n    property OnMouseDown;\r\n    property OnMouseEnter;\r\n    property OnMouseLeave;\r\n    property OnMouseMove;\r\n    property OnMouseUp;\r\n    property OnMouseWheel;\r\n    property OnMouseWheelDown;\r\n    property OnMouseWheelUp;\r\n    property OnResize;\r\n    property OnStartDock;\r\n    property OnStartDrag;\r\n    property OnUnDock;\r\n  end;\r\n\r\n  TAppplicationError = record\r\n    AMessage: string;\r\n    AFile: string;\r\n    ALineNumber: integer;\r\n    AColNumber: integer;\r\n    AStack: string;\r\n    AError: TJSObject;\r\n  end;\r\n\r\n  TOnlineStatus = (osOnline, osOffline);\r\n\r\n  TAppplicationErrorEvent = procedure(Sender: TObject; AError: TAppplicationError; var Handled: boolean) of object;\r\n\r\n  TApplicationHashChangeEvent = procedure(Sender: TObject; AHash: string; var Handled: boolean) of object;\r\n\r\n  TApplicationOnlineChangeEvent = procedure(Sender: TObject; AStatus: TOnlineStatus) of object;\r\n\r\n  TApplicationCallBackEvent = procedure(Sender: TObject; AQuery: string) of object;\r\n\r\n  TApplication = class(TControl)\r\n  private\r\n    FMainFormOnTaskBar: Boolean;\r\n    FCanCreateForm: Boolean;\r\n    FAppInitializing: Boolean;\r\n    FLastReq: TJSXMLHttpRequest;\r\n    {$IFDEF SINGLEINSTANCE}\r\n    FWebSocket: TSocketClient;\r\n    {$ENDIF}\r\n    FActiveForm: TCustomForm;\r\n    FMainForm: TCustomForm;\r\n    FInitFormClassName: string;\r\n    FFormStack: TList;\r\n    FParameters: TStrings;\r\n    FIsRedirect: boolean;\r\n    FLanguage: TUILanguage;\r\n    FOnImageCacheReady: TNotifyEvent;\r\n    FOnError: TAppplicationErrorEvent;\r\n    FOnHashChange: TApplicationHashChangeEvent;\r\n    FAutoFormRoute: boolean;\r\n    FErrorType: TApplicationErrorType;\r\n    FClientConnector: TClientConnector;\r\n    FOnOnlineChange: TApplicationOnlineChangeEvent;\r\n    FThemeTextColor: TColor;\r\n    FThemeColor: TColor;\r\n    FThemeButtonClassName: string;\r\n    FOnOAuthToken: TApplicationCallBackEvent;\r\n    FOnOAuthCallBack: TApplicationCallBackEvent;\r\n    FOnFontCacheReady: TNotifyEvent;\r\n    function DoFormLoad(Event: TEventListenerEvent): boolean;\r\n    function DoFormAbort(Event: TEventListenerEvent): boolean;\r\n    function DoHandleError(Event: TJSErrorEvent): boolean;\r\n    function DoHashChange(Event: TEventListenerEvent): boolean;\r\n    function DoErrorClose(Event: TJSMOuseEvent): boolean;\r\n    function DoUpdateOnlineStatus(Event: TEventListenerEvent): boolean;\r\n    procedure SetLanguage(const Value: TUILanguage);\r\n    function GetIsOnline: boolean;\r\n    function GetIsMobile: boolean;\r\n    {$IFDEF SINGLEINSTANCE}\r\n    procedure DoGetDataReceived(Sender: TObject; Origin: string; Data: TJSObject);\r\n    procedure DoGetConnected(Sender: TObject);\r\n    {$ENDIF}\r\n  protected\r\n    procedure CreateNewForm(AForm: TCustomForm; HTML: string); overload; virtual;\r\n    function GetFormExtension: string;\r\n    function GetAuthorizationPageHTML(const AAuthorizationSuccess: Boolean): string;\r\n    procedure ReloadForm;\r\n    procedure ActivateChildScripts(AElement: TJSHTMLElement);\r\n  public\r\n    procedure PushForm(AForm: TCustomForm);\r\n    function PopForm: TCustomForm;\r\n    procedure LockForm(AForm: TCustomForm);\r\n    procedure UnLockForm(AForm: TCustomForm);\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function CreateNewForm(AInstanceClass: TFormClass): TCustomForm; overload;\r\n    function CreateNewForm(AInstanceClass: TFormClass; AElementID: string): TCustomForm; overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; var AReference); overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference); overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference; AProc: TFormCreatedProc); overload;\r\n    procedure CreateForm(AInstanceClass: TDataModuleClass; var AReference); overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; AElement: TJSHTMLElement; var AReference); overload;\r\n    procedure LoadForm(AForm: TCustomForm; AFormFile: string); virtual;\r\n    procedure ChangeCSS(id: string; href:string);\r\n    procedure InsertCSS(id, href: string);\r\n    procedure RemoveCSS(id: string);\r\n    procedure Initialize;\r\n    procedure InitFormatSettings(const BrowserLocale: string);\r\n    procedure ReceiveMessageFromClient(const AMessage: string);\r\n    procedure RouteForm(AParameter: string);\r\n    procedure Run;\r\n    procedure RunScript(Source: string);\r\n    procedure Navigate(const AURL: string; ATarget: TNavigationTarget = ntBlank);\r\n    procedure Download(const AURL: string);\r\n    procedure DownloadTextFile(const AText: string; AFileName: string = '');\r\n    procedure DownloadBinaryFile(const Data: TJSUint8Array; AFileName: string = '');\r\n    function EXEName: string;\r\n    function NeedsFormRouting: Boolean;\r\n    function ObjectURL(AFile: TJSHTMLFile): string;\r\n    property AutoFormRoute: boolean read FAutoFormRoute write FAutoFormRoute;\r\n    property ErrorType: TApplicationErrorType read FErrorType write FErrorType;\r\n    property IsOnline: boolean read GetIsOnline;\r\n    property IsMobile: boolean read GetIsMobile;\r\n    property ActiveForm: TCustomForm read FActiveForm;\r\n    property MainForm: TCustomForm read FMainForm;\r\n    property MainFormOnTaskBar: boolean read FMainFormOnTaskBar write FMainFormOnTaskBar;\r\n    property Parameters: TStrings read FParameters;\r\n    property Language: TUILanguage read FLanguage write SetLanguage;\r\n    property ThemeColor: TColor read FThemeColor write FThemeColor;\r\n    property ThemeTextColor: TColor read FThemeTextColor write FThemeTextColor;\r\n    property ThemeButtonClassName: string read FThemeButtonClassName write FThemeButtonClassName;\r\n    property OnError: TAppplicationErrorEvent read FOnError write FOnError;\r\n    property OnImageCacheReady: TNotifyEvent read FOnImageCacheReady write FOnImageCacheReady;\r\n    property OnFontCacheReady: TNotifyEvent read FOnFontCacheReady write FOnFontCacheReady;\r\n    property OnHashChange: TApplicationHashChangeEvent read FOnHashChange write FOnHashChange;\r\n    property OnOnlineChange: TApplicationOnlineChangeEvent read FOnOnlineChange write FOnOnlineChange;\r\n    property OnOAuthCallBack: TApplicationCallBackEvent read FOnOAuthCallBack write FOnOAuthCallBack;\r\n    property OnOAuthToken: TApplicationCallBackEvent read FOnOAuthToken write FOnOAuthToken;\r\n    property ClientConnector: TClientConnector read FClientConnector write FClientConnector;\r\n  end;\r\n\r\nfunction GetParentForm(AControl: TControl): TCustomForm;\r\nprocedure Log(v: JSValue); overload;\r\nprocedure Log(arr: array of JSValue); overload;\r\n\r\nvar\r\n  Application: TApplication;\r\n  HandShakeScript: TJSHTMLScriptElement;\r\n  VSIDE: TJSObject;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Dialogs, WEBLib.WebTools, WEBLib.JSON, Math;\r\n\r\nconst\r\n  cBodyTag = 'body';\r\n  cHTMLExt = '.html';\r\n\r\nprocedure Log(v: JSValue);\r\nbegin\r\n  asm\r\n    console.log(v);\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure Log(arr: array of JSValue);\r\nvar\r\n  i: integer;\r\n  s,su: string;\r\nbegin\r\n  s := '[';\r\n  for i := 0 to length(arr) - 1 do\r\n  begin\r\n    asm\r\n      function isPrimitive(test) {\r\n        return (test !== Object(test));\r\n      };\r\n\r\n      if (isPrimitive(arr[i])) {\r\n         var su = arr[i].toString();\r\n         if (s != \"[\") { s = s + \",\"; }\r\n         s = s + su;\r\n         }\r\n      else\r\n      {\r\n        console.log(arr[i]);\r\n         if (s != \"[\") { s = s + \",\"; }\r\n         s = s + \"#object\";\r\n      }\r\n    end;\r\n  end;\r\n\r\n  s := s + ']';\r\n\r\n  log(s);\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction GetParentForm(AControl: TControl): TCustomForm;\r\nvar\r\n  FOwner: TComponent;\r\nbegin\r\n  Result := nil;\r\n\r\n  FOwner := AControl;\r\n\r\n  while Assigned(FOwner) and not (FOwner is TCustomForm) do\r\n  begin\r\n    FOwner := FOwner.Owner;\r\n  end;\r\n\r\n  if Assigned(FOwner) and (FOwner is TCustomForm) then\r\n    Result := (FOwner as TCustomForm);\r\nend;\r\n\r\n\r\n{ TCustomForm }\r\n\r\nprocedure TCustomForm.BindEvents;\r\nbegin\r\n  inherited;\r\n  window.addEventListener('resize', FResizePtr);\r\n  window.addEventListener('load', FLoadedPtr);\r\n  document.addEventListener('scroll', FScrollPtr);\r\n  window.addEventListener('unload', FUnloadPtr);\r\n  window.addEventListener('beforeunload', FBeforeUnloadPtr);\r\n  window.addEventListener('keydown', FKeyDownPtr);\r\nend;\r\n\r\nprocedure ReleaseForm(AForm: TCustomForm);\r\nbegin\r\n  AForm.Free;\r\n  AForm := nil;\r\nend;\r\n\r\nprocedure TCustomForm.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FLoadedPtr := nil;\r\n  FUnloadPtr := nil;\r\n  FBeforeUnloadPtr := nil;\r\n  FResizePtr := nil;\r\n  FScrollPtr := nil;\r\n  FDocMouseUpPtr := nil;\r\n  FDocMouseMovePtr := nil;\r\n  FTitleDownPtr := nil;\r\n  FDoClickPtr := nil;\r\n  FKeyDownPtr := nil;\r\nend;\r\n\r\nprocedure TCustomForm.Close;\r\nvar\r\n  lAction: TCloseAction;\r\n  el: TJSElement;\r\nbegin\r\n  if CloseQuery then\r\n  begin\r\n    UnbindEvents;\r\n    ClearControls;\r\n\r\n    lAction := caHide;\r\n\r\n    if FTimerID <> -1 then\r\n    begin\r\n      window.clearInterval(FTimerID);\r\n      FTimerID := -1;\r\n    end;\r\n\r\n    if Assigned(OnClose) then\r\n      OnClose(Self, lAction);\r\n\r\n    if lAction <> caNone then\r\n    begin\r\n      if Assigned(FLayer) then\r\n      begin\r\n        if Container.parentNode = FLayer then\r\n        begin\r\n          FLayer.removeChild(Container);\r\n        end\r\n        else\r\n        begin\r\n          if Container.parentNode.parentNode = FLayer then\r\n            FLayer.removeChild(Container.parentNode);\r\n        end;\r\n\r\n        Container := nil;\r\n        if FormContainerElement = FLayer.parentNode then\r\n        begin\r\n          FormContainerElement.removeChild(FLayer);\r\n        end;\r\n        FLayer := nil;\r\n      end;\r\n\r\n      if (FormFileName = '') then\r\n      begin\r\n        if (FFormElement <> '') and Assigned(Container) then\r\n        begin\r\n          Container.innerHTML := '';\r\n          Container := nil;\r\n        end\r\n        else\r\n          if Assigned(Container) then\r\n          begin\r\n            if FormContainerElement = Container.parentNode then\r\n              FormContainerElement.removeChild(Container);\r\n            Container := nil;\r\n          end;\r\n      end\r\n      else\r\n      begin\r\n        if FFormElement <> '' then\r\n        begin\r\n          Container.innerHTML := '';\r\n          Container := nil;\r\n        end\r\n      end;\r\n\r\n      if (FFormElement <> FormContainer) and (FFormElement <> '') then\r\n      begin\r\n        el := document.getElementById(FFormElement);\r\n        if Assigned(el) then\r\n          el.innerHTML := '';\r\n      end;\r\n\r\n      DoClose(lAction);\r\n\r\n      if (lAction = caFree) and not (csDestroying in ComponentState) then\r\n      begin\r\n        ReleaseForm(Self);\r\n        if Application.FMainForm = Self then\r\n          Application.FMainForm := nil;\r\n      end;\r\n\r\n      Application.FActiveForm := FPrevActiveForm;\r\n\r\n      Visible := False;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.CloseQuery: Boolean;\r\nbegin\r\n  Result := True;\r\n  if Assigned(FOnCloseQuery) then\r\n    FOnCloseQuery(Self, Result);\r\nend;\r\n\r\nfunction TCustomForm.ContainerElement: TJSElement;\r\nbegin\r\n  Result := FormContainerElement;\r\nend;\r\n\r\nconstructor TCustomForm.Create(AOwner: TComponent);\r\nbegin\r\n  FNoHTML := false;\r\n  FCreating := true;\r\n  inherited;\r\n  FFormFileName := '';\r\n  FPopupMode := pmNone;\r\n  FPopupClose := pcOnDeactivate;\r\n  FPopup := True;\r\n  FPopupOpacity := 1.0;\r\nend;\r\n\r\nfunction TCustomForm.CreateCaption: TJSHTMLElement;\r\nvar\r\n  BarHeight: string;\r\nbegin\r\n  BarHeight := '22';\r\n  FCaptionElement := TJSHTMLElement(document.createElement('DIV'));\r\n  FCaptionElement.innerHTML := Caption;\r\n  FCaptionElement.style.setProperty('background-color', ColorToHTML(Application.ThemeColor));\r\n  FCaptionElement.style.setProperty('color', ColorToHTML(Application.ThemeTextColor));\r\n  FCaptionElement.style.setProperty('cursor', 'move');\r\n  //title.style.setProperty('padding', Padding + 'px');\r\n  FCaptionElement.style.setProperty('height', BarHeight + 'px');\r\n  FCaptionElement.style.setProperty('line-height', BarHeight + 'px');\r\n  FCaptionElement.style.setProperty('border-bottom', '1px solid black');\r\n  FCaptionElement.style.setProperty('padding-left','4px');\r\n\r\n  FCaptionElement.style.setProperty('-moz-user-select','none');\r\n  FCaptionElement.style.setProperty('-webkit-user-select','none');\r\n  FCaptionElement.style.setProperty('-ms-user-select','none');\r\n  FCaptionElement.style.setProperty('user-select','none');\r\n  FCaptionElement.style.setProperty('-o-user-select','none');\r\n\r\n  if ElementCaptionClassName <> '' then\r\n    FCaptionElement.setAttribute('class',ElementCaptionClassName);\r\n\r\n  SetHTMLElementFont(FCaptionElement, Font, not ((ElementCaptionClassName = '') and (ElementFont = efProperty)));\r\n\r\n  FCaptionElement.innerHTML := FCaption;\r\n  FCaptionElement.addEventListener('mousedown', FTitleDownPtr);\r\n  FHasCaption := true;\r\n\r\n  Result := FCaptionElement;\r\nend;\r\n\r\nprocedure TCustomForm.CreateControl;\r\nbegin\r\n  if not Visible and not FPopup then\r\n    Exit;\r\n  inherited;\r\nend;\r\n\r\nfunction TCustomForm.CreateLayer: TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(document.createElement('SPAN'));\r\n  Result.style.setProperty('top', '0');\r\n  Result.style.setProperty('left', '0');\r\n  Result.style.setProperty('right', '0');\r\n  Result.style.setProperty('bottom', '0');\r\n\r\n  Result.style.setProperty('webkit-user-select', 'none');\r\n  Result.style.setProperty('moz-user-select', 'none');\r\n  Result.style.setProperty('khtml-user-select', 'none');\r\n  Result.style.setProperty('ms-user-select', 'none');\r\n  Result.style.setProperty('user-select', 'none');\r\n  Result.style.setProperty('position', 'absolute');\r\nend;\r\n\r\nfunction TCustomForm.CreateElement: TJSElement;\r\nvar\r\n  eh,caph: TJSHTMLElement;\r\n\r\nbegin\r\n  if not FPopup and Assigned(FormContainerElement) then\r\n  begin\r\n    Result := FormContainerElement;\r\n    Exit;\r\n  end;\r\n\r\n  //if FPopup then\r\n  begin\r\n    Result := document.createElement('DIV');\r\n\r\n    FLayer := CreateLayer;\r\n    document.body.appendChild(FLayer);\r\n\r\n    eh := TJSHTMLElement(FLayer);\r\n\r\n    if FPopupClose = pcOnDeactivate then\r\n    begin\r\n      // ensure method pointers exist\r\n      GetMethodPointers;\r\n      eh.addEventListener('click', FDoClickPtr);\r\n    end;\r\n\r\n    eh.style.setProperty('z-index', '999999');\r\n\r\n    if (Border = fbSizeable) then\r\n    begin\r\n      TJSHTMLElement(Result).style.setProperty('resize','both');\r\n      TJSHTMLElement(Result).style.setProperty('overflow','auto');\r\n    end;\r\n\r\n    FHasCaption := false;\r\n\r\n    if (Border in [fbSizeable, fbDialog, fbDialogSizeable]) then\r\n    begin\r\n      caph := CreateCaption;\r\n      Result.appendChild(caph);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.LoadDFMValues;\r\nbegin\r\nend;\r\n\r\nprocedure TCustomForm.Init;\r\nbegin\r\nend;\r\n\r\nfunction TCustomForm.IsFocused: Boolean;\r\nbegin\r\n  // form is not focused only controls\r\n  Result := false;\r\nend;\r\n\r\nprocedure TCustomForm.Resize;\r\nvar\r\n  i: integer;\r\n  neww, newh: integer;\r\n  eh: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  FIsResizing := true;\r\n\r\n  if FPopup then\r\n  begin\r\n    eh := FPopupElement;\r\n    dr := eh.getBoundingClientRect;\r\n    neww := Round(dr.Right - dr.Left - 2);\r\n    if (Border in [fbDialog, fbDialogSizeable]) then\r\n      newh := Round(dr.Bottom - dr.Top - 22 - 2)\r\n    else\r\n      newh := Round(dr.Bottom - dr.Top - 2)\r\n  end\r\n  else\r\n  begin\r\n    neww := window.innerWidth;\r\n    newh := window.innerHeight;\r\n  end;\r\n\r\n  UpdateControlSize(neww, newh);\r\n\r\n  AlignControl(Self);\r\n\r\n  DoResize;\r\n\r\n  FIsResizing := false;\r\n\r\n  if not IsUpdating then\r\n  begin\r\n    if (OrigRect.Left = -1) and (OrigRect.Top = -1) then\r\n      InitAnchoring;\r\n\r\n    for i := 0 to ControlCount - 1 do\r\n      Controls[i].UpdateAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetActiveControl(const Value: TWinControl);\r\nbegin\r\n  FActiveControl := Value;\r\n  if Assigned(FActiveControl) then\r\n    FActiveControl.SetFocus;\r\nend;\r\n\r\nprocedure TCustomForm.SetBorder(const Value: TFormBorderStyle);\r\nbegin\r\n  if (FBorder <> Value) then\r\n  begin\r\n    FBorder := Value;\r\n    if Assigned(Container) then\r\n      AlignControl(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetBounds(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Resize;\r\n    SetBoundsInt(X, Y, AWidth, AHeight);\r\n  end\r\n  else\r\n    inherited SetBounds(X, Y, AWidth, AHeight);\r\nend;\r\n\r\nprocedure TCustomForm.SetCaption(const AValue: string);\r\nbegin\r\n  if FCaption <> AValue then\r\n  begin\r\n    FCaption := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetFormContainer(const Value: string);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  FFormContainer := Value;\r\n\r\n  // update container element\r\n  el := document.getElementById(Value);\r\n  if Assigned(el) then\r\n    Container := el;\r\nend;\r\n\r\nprocedure TCustomForm.SetFormStyle(const Value: TFormStyle);\r\nbegin\r\n  FFormStyle := Value;\r\nend;\r\n\r\nprocedure TCustomForm.SetHeight(AValue: Integer);\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n  if Popup then\r\n  begin\r\n    eh := FPopupElement;\r\n    if Assigned(eh) then\r\n      eh.style.setProperty('height',inttostr(avalue)+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetLeft(AValue: Integer);\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n  if Popup then\r\n  begin\r\n    eh := FPopupElement;\r\n    if Assigned(eh) then\r\n      eh.style.setProperty('left',inttostr(avalue)+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetModalResult(const Value: TModalResult);\r\nbegin\r\n  FModalResult := Value;\r\n  if (FModalResult <> mrNone) then\r\n    Close;\r\nend;\r\n\r\nprocedure TCustomForm.SetShadow(const Value: boolean);\r\nbegin\r\n  FShadow := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomForm.SetTop(AValue: Integer);\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n  if Popup then\r\n  begin\r\n    eh := FPopupElement;\r\n    if Assigned(eh) then\r\n      eh.style.setProperty('top',inttostr(avalue)+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetWidth(AValue: Integer);\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n  if Popup then\r\n  begin\r\n    eh := FPopupElement;\r\n    if Assigned(eh) then\r\n      eh.style.setProperty('width',inttostr(avalue)+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SelectFirst;\r\nbegin\r\n  if ControlCount > 0 then\r\n    Controls[0].SetFocus;\r\nend;\r\n\r\nprocedure TCustomForm.SelectNext(CurControl: TControl; GoForward: boolean; CheckTabStop: boolean);\r\nvar\r\n  i: integer;\r\nbegin\r\n  if ControlCount > 0 then\r\n  begin\r\n    for i := 0 to ControlCount - 1 do\r\n    begin\r\n      if Controls[i] = CurControl then\r\n      begin\r\n        if GoForward then\r\n        begin\r\n          if i + 1 <= ControlCount - 1  then\r\n            Controls[i + 1].SetFocus\r\n          else\r\n            Controls[0].SetFocus;\r\n        end\r\n        else\r\n        begin\r\n          if i - 1 >= 0 then\r\n            Controls[i - 1].SetFocus\r\n          else\r\n            Controls[ControlCount - 1].SetFocus;\r\n        end;\r\n        break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.Show;\r\nvar\r\n  l,t,i: integer;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if FCreating and FPopup then\r\n  begin\r\n    FCreating := false;\r\n    UpdateElement;\r\n  end;\r\n\r\n  if (FormFileName = '') then\r\n  begin\r\n    if not Assigned(Container) then\r\n    begin\r\n      if FPopup then\r\n      begin\r\n        Container := CreateElement;\r\n        FLayer.appendChild(Container);\r\n        TJSHTMLElement(FLayer).style.setProperty('background-color','silver');\r\n      end\r\n      else\r\n      begin\r\n        Container := CreateLayer;\r\n        document.body.appendChild(Container);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      if FPopup then\r\n      begin\r\n        if Position = poScreenCenter then\r\n        begin\r\n          l := Round((window.innerWidth - Width)/2);\r\n          t := Round((window.innerHeight - Height)/2);\r\n          FLeft := l;\r\n          FTop := t;\r\n        end;\r\n        TJSHTMLElement(Container).style.setProperty('left',inttostr(Left)+'px');\r\n        TJSHTMLElement(Container).style.setProperty('top',inttostr(Top)+'px');\r\n        FLayer.appendChild(Container)\r\n      end\r\n      else\r\n      begin\r\n        if Assigned(FLayer) then\r\n        begin\r\n          FLayer.appendChild(Container)\r\n        end\r\n        else\r\n        begin\r\n          document.body.appendChild(Container);\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if FPopup then\r\n    begin\r\n      if (Border = fbSizeable) then\r\n      begin\r\n        dr := Container.getBoundingClientRect;\r\n        FOrigWidth := Round(dr.Right - dr.Left);\r\n        FOrigHeight := Round(dr.Bottom - dr.Top);\r\n        FTimerID := window.setInterval(@HandleDoResize, 100);\r\n      end\r\n      else\r\n      begin\r\n        TJSHTMLElement(Container).style.setProperty('resize','');\r\n        TJSHTMLElement(Container).style.setProperty('overflow','');\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Visible := True;\r\n\r\n  DoShow;\r\n\r\n  // Auto focus control on form\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if (Controls[i].TabOrder = 0) and (Controls[i].TabStop) then\r\n      Controls[i].SetFocus;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.ShowModal: Integer;\r\nbegin\r\n  Result := ShowModal(nil);\r\nend;\r\n\r\nfunction TCustomForm.ShowModal(AProc: TModalResultProc): TModalResult;\r\nbegin\r\n  // create runtime form without HTML\r\n  if FNoHTML then\r\n  begin\r\n    FPrevActiveForm := Application.ActiveForm;\r\n    Application.FActiveForm := Self;\r\n    Application.CreateNewForm(Self, '');\r\n  end;\r\n\r\n  Result := mrNone;\r\n  FNoHTML := false;\r\n  FModalProc := AProc;\r\n  ModalResult := mrNone;\r\n  Show;\r\nend;\r\n\r\nprocedure TCustomForm.UnbindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(FLayer) and (FPopupClose = pcOnDeactivate) then\r\n    FLayer.removeEventListener('click', FDoClickPtr);\r\n\r\n  window.removeEventListener('resize', FResizePtr);\r\n  window.removeEventListener('load', FLoadedPtr);\r\n  document.removeEventListener('scroll', FScrollPtr);\r\n  window.removeEventListener('unload', FUnloadPtr);\r\n  window.removeEventListener('beforeunload', FBeforeUnloadPtr);\r\n  window.removeEventListener('keywown', FKeyDownPtr);\r\nend;\r\n\r\nprocedure TCustomForm.UpdateElement;\r\nvar\r\n  clr: string;\r\nbegin\r\n  if FCreating then\r\n    Exit;\r\n\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if (FCaption <> '') then\r\n    begin\r\n      if not FPopup then\r\n        window.document.title := FCaption\r\n      else\r\n      begin\r\n        if Assigned(FCaptionElement) then\r\n        begin\r\n          FCaptionElement.innerHTML := Caption;\r\n          SetHTMLElementFont(FCaptionElement, Font, not ((ElementCaptionClassName = '') and (ElementFont = efProperty)));\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    clr := ColorToHtml(Color);\r\n\r\n    if Assigned(Container) then\r\n    begin\r\n      if (Color <> clNone) and (ElementClassName = '') then\r\n        TJSHTMLElement(Container).style.setProperty('background-Color',clr);\r\n\r\n      if (ElementClassName = '') and not Popup then\r\n      begin\r\n        // make sure body stretches over the entire page\r\n        //TJSHTMLElement(Container).style.setProperty('height','100%');\r\n        asm\r\n          document.documentElement.style.setProperty('height','100%');\r\n        end;\r\n      end;\r\n\r\n      SetHTMLElementFont(TJSHTMLElement(Container), Font, not ((ElementClassName = '') and (ElementFont = efProperty)));\r\n    end;\r\n\r\n    if FPopup and not Assigned(FormContainerElement) then\r\n    begin\r\n      if FShadow then\r\n      begin\r\n        TJSHTMLElement(ElementHandle).style.setProperty('box-shadow','5px 5px 5px gray')\r\n      end\r\n      else\r\n        TJSHTMLElement(ElementHandle).style.setProperty('box-shadow','');\r\n\r\n      TJSHTMLElement(ElementHandle).style.setProperty('border','1px solid gray');\r\n    end\r\n    else\r\n    begin\r\n      TJSHTMLElement(ElementHandle).style.setProperty('box-shadow','');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.Paint;\r\nbegin\r\n  //\r\nend;\r\n\r\nprocedure TCustomForm.PreventDefault;\r\nbegin\r\n  ElementEvent.preventDefault();\r\nend;\r\n\r\nfunction TCustomForm.HandleObserver: boolean;\r\nbegin\r\n  Resize;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleResize(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Visible then\r\n  begin\r\n    if not Assigned(Container) then\r\n      CreateControl;\r\n\r\n    Resize;\r\n  end;\r\n\r\n  // make sure HandleObserver is not optimized away\r\n  if (1<0) then\r\n  begin\r\n    HandleObserver;\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.GetActiveControl: TWinControl;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := FActiveControl;\r\n\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if Controls[i].ElementHandle = document.activeElement then\r\n    begin\r\n      Result := TWinControl(Controls[i]);\r\n      break;\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetCanvas: TCanvas;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nfunction TCustomForm.GetCaptionHeight: integer;\r\nvar\r\n  r: TJSDOMRect;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(FCaptionElement) and (Border in [fbDialog, fbDialogSizeable]) then\r\n  begin\r\n    r := FCaptionElement.getBoundingClientRect;\r\n    Result := Round(r.Bottom - r.Top);\r\n  end;\r\n\r\nend;\r\n\r\nfunction TCustomForm.GetClientRect: TRect;\r\nbegin\r\n  Result := inherited GetClientRect;\r\n\r\n  if FHasCaption then\r\n    Result.Top := Result.Top + FORMCAPTIONHEIGHT;\r\nend;\r\n\r\nfunction TCustomForm.GetElementBindHandle: TJSEventTarget;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Result := TJSEventTarget(window);\r\n    Exit;\r\n  end;\r\n\r\n  if (FormContainer <> '') then\r\n  begin\r\n    Result := TJSEventTarget(window);\r\n  end\r\n  else\r\n  begin\r\n    if not FPopup then\r\n    begin\r\n      Result := TJSEventTarget(window);\r\n    end\r\n    else\r\n      Result := inherited GetElementBindHandle;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetElementHandle: TJSHTMLElement;\r\nbegin\r\n  if FPopup then\r\n    Result := inherited GetElementHandle\r\n  else\r\n    Result := TJSHTMLElement(FormContainerElement);\r\nend;\r\n\r\nfunction TCustomForm.GetFormStyle: TFormStyle;\r\nbegin\r\n  Result := FFormStyle;\r\nend;\r\n\r\nfunction TCustomForm.GetHeight: Integer;\r\nvar\r\n  d: integer;\r\n  s: string;\r\n  css: TJSCSSStyleDeclaration;\r\n  el: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if (FFormElement <> '') then\r\n  begin\r\n    el := TJSHTMLElement(document.getElementById(FFormElement));\r\n    if Assigned(el) then\r\n    begin\r\n      dr := el.getBoundingClientRect;\r\n      Result := Round(dr.bottom - dr.top);\r\n      Exit;\r\n    end\r\n  end;\r\n\r\n  if (ElementHandle = document.body) then\r\n  begin\r\n    css := window.getComputedStyle(ElementHandle);\r\n    s := css.getPropertyValue('margin-top');\r\n    s := Copy(s,1,Length(s)- 2);\r\n    d := StrToInt(s) - 2; // div 2;\r\n    Result := window.innerHeight - Max(0,d);\r\n  end\r\n  else\r\n  begin\r\n    if FPopup then\r\n      Result := (inherited GetHeight) + GetCaptionHeight\r\n    else\r\n    begin\r\n      Result := Round(ElementHandle.offsetHeight);\r\n      if Result = 0 then\r\n        Result:= window.innerHeight;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetLeft: Integer;\r\nvar\r\n  el: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if FPopup then\r\n  begin\r\n    Result := inherited GetLeft\r\n  end\r\n  else\r\n  begin\r\n    if (FFormElement <> '') then\r\n    begin\r\n      el := TJSHTMLElement(document.getElementById(FFormElement));\r\n      if Assigned(el) then\r\n      begin\r\n        dr := el.getBoundingClientRect;\r\n        Result := Round(dr.left);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      el := nil;\r\n      if (FormContainer <> '') then\r\n        el := TJSHTMLElement(document.getElementById(FormContainer));\r\n\r\n      if not Assigned(el) then\r\n         el := ElementHandle; \r\n\r\n      Result := Round(el.offsetLeft);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n\r\n  if FLoadedPtr = nil then\r\n  begin\r\n    FLoadedPtr := @HandleLoaded;\r\n    FUnloadPtr := @HandleUnLoad;\r\n    FBeforeUnloadPtr := @HandleBeforeUnload;\r\n    FResizePtr := @HandleResize;\r\n    FScrollPtr := @HandleScroll;\r\n    FDocMouseUpPtr := @HandleDocMouseUp;\r\n    FDocMouseMovePtr := @HandleDocMouseMove;\r\n    FTitleDownPtr := @HandleTitleDown;\r\n    FDoClickPtr := @HandleDoClick;\r\n    FKeyDownPtr := @HandleKeyDown;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetTop: Integer;\r\nvar\r\n  el: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if FPopup then\r\n    Result := inherited GetTop\r\n  else\r\n  begin\r\n    if (FFormElement <> '') then\r\n    begin\r\n      el := TJSHTMLElement(document.getElementById(FFormElement));\r\n      if Assigned(el) then\r\n      begin\r\n        dr := el.getBoundingClientRect;\r\n        Result := Round(dr.top);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      el := nil;\r\n      if (FormContainer <> '') then\r\n        el := TJSHTMLElement(document.getElementById(FormContainer));\r\n\r\n      if not Assigned(el) then\r\n          el := ElementHandle; \r\n      Result := Round(el.offsetTop);\r\n    end; \r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetUniqueComponentName(AComponent: TComponent): string;\r\nbegin\r\n  Result := ClassName + '_' + FindUniqueName(AComponent.ClassName);\r\nend;\r\n\r\nfunction TCustomForm.GetWidth: Integer;\r\nvar\r\n  dr: TJSDOMRect;\r\n  el: TJSHTMLElement;\r\n//  s: string;\r\n//  d: integer;\r\n//  css: TJSCSSStyleDeclaration;\r\nbegin\r\n  if (FFormElement <> '') then\r\n  begin\r\n    el := TJSHTMLElement(document.getElementById(FFormElement));\r\n    if Assigned(el) then\r\n    begin\r\n      dr := el.getBoundingClientRect;\r\n      Result := Round(dr.right - dr.left);\r\n      Exit;\r\n    end\r\n  end;\r\n\r\n  if (ElementHandle = document.body) then\r\n  begin\r\n    {\r\n    css := window.getComputedStyle(ElementHandle);\r\n    s := css.getPropertyValue('margin-left');\r\n    s := Copy(s,1,Length(s) - 2);\r\n    d := StrToInt(s) - 2;\r\n    Result := window.innerWidth - d + 4;\r\n    }\r\n    Result := window.innerWidth;\r\n  end\r\n  else\r\n  begin\r\n    if FPopup then\r\n      Result := inherited GetWidth\r\n    else\r\n    begin\r\n      Result := Round(ElementHandle.offsetWidth);\r\n      if Result = 0 then\r\n        Result := window.innerWidth;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.HandleBeforeUnload(Event: TEventListenerEvent): boolean;\r\nvar\r\n  msg: string;\r\nbegin\r\n  msg := '';\r\n  if Assigned(OnBeforeUnload) then\r\n    OnBeforeUnload(Self,msg);\r\n\r\n    if msg <> '' then\r\n    begin\r\n      asm\r\n        Event.returnValue = msg;\r\n        return msg;\r\n      end;\r\n    end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  Event.stopPropagation;\r\n\r\n  if FPopupClose = pcOnDeactivate then\r\n    Close;\r\n\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomForm.HandleDocMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  deltax,deltay: double;\r\n  el: TJSHTMLElement;\r\n  l,t: integer;\r\nbegin\r\n  if FDown then\r\n  begin\r\n    deltax := Event.screenX - FMdx;\r\n    deltay := Event.screenY - FMdy;\r\n\r\n    if FHasCaption then\r\n      el := TJSHTMLElement(Container.parentNode)\r\n    else\r\n      el := TJSHTMLElement(Container);\r\n\r\n    el.style.setProperty('transform','');\r\n    el.style.setProperty('position','absolute');\r\n\r\n    l := round(FDlgX + deltax);\r\n    t := round(FDlgY + deltay);\r\n\r\n    el.style.setProperty('left', inttostr(l)+'px');\r\n    el.style.setProperty('top', inttostr(t)+'px');\r\n\r\n    FLeft := l;\r\n    FTop := t;\r\n\r\n//    el := TJSHTMLElement(FCancel);\r\n//    el.style.setProperty('position', 'absolute');\r\n//    el.style.setProperty('top', '0');\r\n//    el.style.setProperty('right', '0');\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleDocMouseUp(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if FDown then\r\n  begin\r\n    FCaptured := false;\r\n    FDown := false;\r\n    document.body.removeEventListener('mousemove', FDocMouseMovePtr);\r\n    document.body.removeEventListener('mouseup', FDocMouseUpPtr);\r\n    if Assigned(FMoveSpan) then\r\n      document.body.removeChild(FMoveSpan);\r\n    FMoveSpan := nil;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomForm.HandleDoResize;\r\nvar\r\n  dr: TJSDOMRect;\r\n  neww,newh: integer;\r\nbegin\r\n  dr := Container.getBoundingClientRect;\r\n\r\n  neww := Round(dr.Right - dr.Left);\r\n  newh := Round(dr.Bottom - dr.Top);\r\n\r\n  if (neww <> FOrigWidth) or (newh <> FOrigHeight) then\r\n  begin\r\n    Width := neww;\r\n    Height := newh;\r\n\r\n    dr := Container.getBoundingClientRect;\r\n    FOrigWidth := Round(dr.Right - dr.Left);\r\n    FOrigHeight := Round(dr.Bottom - dr.Top);\r\n\r\n    AlignControl(Self);\r\n  end;\r\nend;\r\n\r\n\r\nfunction TCustomForm.HandleKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\nbegin\r\n  k := GetKeyCode(Event.Key);\r\n  if not Assigned(k) then\r\n    Exit;\r\n  if (k = VK_ESCAPE) and not (csDesigning in ComponentState) then\r\n  begin\r\n    Close;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.HandleTitleDown(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  r: TJSDOMRect;\r\nbegin\r\n  Event.StopPropagation;\r\n  Event.PreventDefault;\r\n\r\n  FPopupClose := pcNever;\r\n\r\n  FMdx := Round(Event.screenX);\r\n  FMdy := Round(Event.screenY);\r\n\r\n  if FHasCaption then\r\n    r := TJSHTMLElement(Container.parentNode).getBoundingClientRect()\r\n  else\r\n    r := TJSHTMLElement(Container).getBoundingClientRect();\r\n\r\n  FDlgX := Round(int(r.left));\r\n  FDlgY := Round(int(r.top));\r\n\r\n  FDown := true;\r\n\r\n  if not FCaptured then\r\n  begin\r\n    FCaptured := true;\r\n    FMoveSpan := TJSHTMLElement(document.createElement('SPAN'));\r\n    FMoveSpan.style.setProperty('top', '0');\r\n    FMoveSpan.style.setProperty('left', '0');\r\n    FMoveSpan.style.setProperty('right', '0');\r\n    FMoveSpan.style.setProperty('bottom', '0');\r\n    FMoveSpan.style.setProperty('position', 'absolute');\r\n\r\n    document.body.appendChild(FMoveSpan);\r\n\r\n    document.body.addEventListener('mousemove', FDocMouseMovePtr);\r\n    document.body.addEventListener('mouseup', FDocMouseUpPtr);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomForm.DoClose(var CloseAction: TCloseAction);\r\nbegin\r\n  if Assigned(FModalProc) and (CloseAction <> caNone) then\r\n  begin\r\n    FModalProc(FModalResult);\r\n    FModalProc := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.DoCreate;\r\nbegin\r\n  BeginUpdate;\r\n  LoadDFMValues;\r\n  Loaded;\r\n\r\n  if Assigned(OnCreate) then\r\n    OnCreate(Self);\r\n\r\n  FCreating := false;\r\n\r\n  EndUpdate;\r\n\r\n  UpdateChildren(Self);\r\n\r\n  AlignControl(Self);\r\n\r\n  DoResize;\r\nend;\r\n\r\nfunction TCustomForm.HandleScroll(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnScroll) then\r\n    OnScroll(Self);\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomForm.DoShow;\r\nbegin\r\n  if Assigned(OnShow) then\r\n    OnShow(Self);\r\nend;\r\n\r\nfunction TCustomForm.HandleUnload(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnUnload) then\r\n    OnUnload(Self);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.FormContainerElement: TJSElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    if Assigned(FDesignContainer) then\r\n      Result := FDesignContainer\r\n    else\r\n      Result := document.body;\r\n    Exit;\r\n  end;\r\n\r\n  if (FormContainer <> '') then\r\n  begin\r\n    //ElementID := FormContainer;\r\n    Result := document.getElementById(FormContainer);\r\n    if not Assigned(Result) then\r\n      Result := document.body;\r\n  end\r\n  else\r\n  begin\r\n    Result := document.body;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.HandleLoaded(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  Resize;\r\n  InitAnchoring;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomForm.DoResize;\r\nbegin\r\n  if Assigned(OnResize) then\r\n    OnResize(Self);\r\nend;\r\n\r\ndestructor TCustomForm.Destroy;\r\nbegin\r\n  if Visible then\r\n    Close;\r\n\r\n  if Assigned(OnDestroy) then\r\n    OnDestroy(Self);\r\n\r\n  inherited;\r\n\r\n  if Assigned(FLayer) then\r\n  begin\r\n    if FormContainerElement = FLayer.parentNode then\r\n      FormContainerElement.removeChild(FLayer);\r\n    FLayer := nil;\r\n  end;\r\nend;\r\n\r\nconstructor TCustomForm.Create(id: string);\r\nbegin\r\n  FNoHTML := false;\r\n  FCreating := true;\r\n  FFormContainer := id;\r\n  inherited Create(id);\r\n  FFormElement := '';\r\n  FModalResult := mrNone;\r\n  FFormStyle := fsNormal;\r\n  DoCreate;\r\nend;\r\n\r\nconstructor TCustomForm.Create(id: string; var AReference);\r\nbegin\r\n  FCreating := true;\r\n  FFormContainer := id;\r\n  inherited Create(id);\r\n  AReference := Self;\r\n  FFormElement := '';\r\n  FModalResult := mrNone;\r\n  FFormStyle := fsNormal;\r\n  DoCreate;\r\nend;\r\n\r\nprocedure TCustomForm.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  AllowTouch := True;\r\n  FModalResult := mrNone;\r\n  FFormStyle := fsNormal;\r\n  FBorder := fbSizeable;\r\n  FShadow := true;\r\n  FTimerID := -1;\r\n  FCaptionElement := nil;\r\n  Color := clWhite;\r\n  TJSEventTarget(window).addEventListener('load', FLoadedPtr);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AOwner: TComponent; Dummy: Integer = 0);\r\nbegin\r\n  Create(AOwner);\r\nend;\r\n\r\nconstructor TCustomForm.CreateDialog(ACaption: string);\r\nvar\r\n  AFileName: string;\r\nbegin\r\n  FCreating := true;\r\n  AFileName := ClassType.UnitName + cHTMLExt;\r\n  inherited Create(cBodyTag);\r\n  Caption := ACaption;\r\n  Popup := true;\r\n  Border := fbDialog;\r\n  FormFileName := AFileName;\r\n\r\n  Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\nconstructor TCustomForm.CreateDialogNew(ACaption: string);\r\nvar\r\n  AFileName: string;\r\nbegin\r\n  FNoHTML := true;\r\n  FCreating := true;\r\n  AFileName := ClassType.UnitName + cHTMLExt;\r\n  inherited Create(cBodyTag);\r\n  Caption := ACaption;\r\n  Popup := true;\r\n  Border := fbDialog;\r\n  FormFileName := AFileName;\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew;\r\nvar\r\n  AFileName: string;\r\nbegin\r\n  FCreating := true;\r\n  AFileName := ClassType.UnitName + cHTMLExt;\r\n  inherited Create(cBodyTag);\r\n  FormFileName := AFileName;\r\n  Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AFileName: string);\r\nbegin\r\n  FCreating := true;\r\n  inherited Create(cBodyTag);\r\n  FormFileName := AFileName;\r\n  Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AProc: TFormCreatedProc);\r\nbegin\r\n  FCreatedProc := AProc;\r\n  CreateNew;\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AElementID: string; AProc: TFormCreatedProc);\r\nvar\r\n  AFileName: string;\r\nbegin\r\n  FCreating := true;\r\n  inherited Create(AElementID);\r\n  FCreatedProc := AProc;\r\n  FFormElement := AElementID;\r\n  AFileName := ClassType.UnitName + cHTMLExt;\r\n  Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\n\r\n{ TApplication }\r\n\r\nfunction TApplication.CreateNewForm(AInstanceClass: TFormClass): TCustomForm;\r\nbegin\r\n  Result := AInstanceClass.Create(cBodyTag);\r\nend;\r\n\r\nfunction TApplication.CreateNewForm(AInstanceClass: TFormClass; AElementID: string): TCustomForm;\r\nvar\r\n  el: TJSHTMLElement;\r\n  AForm: TForm;\r\nbegin\r\n  el := TJSHTMLElement(document.getElementById(AElementID));\r\n\r\n  AForm := AInstanceClass.Create(AElementID);\r\n  AForm.FDesignContainer := el;\r\n  AForm.FormContainer := AElementID;\r\n  AForm.FFormElement := AElementID;\r\n  AForm.CreateControl;\r\n  AForm.Container := el;\r\n  AForm.Init;\r\n\r\n  Result := AForm;\r\nend;\r\n\r\nprocedure TApplication.LoadForm(AForm: TCustomForm; AFormFile: string);\r\nbegin\r\n  AForm.FPrevActiveForm := FActiveForm;\r\n\r\n  FActiveForm := AForm;\r\n\r\n  if FMainForm = nil then\r\n    FMainForm := AForm;\r\n\r\n  FLastReq := TJSXMLHttpRequest.new;\r\n  FLastReq.addEventListener('load', @DoFormLoad);\r\n  FLastReq.addEventListener('abort', @DoFormAbort);\r\n  FLastReq.open('GET', AFormFile);\r\n  FLastReq.send;\r\nend;\r\n\r\nprocedure TApplication.Navigate(const AURL: string; ATarget: TNavigationTarget );\r\nbegin\r\n  if ATarget = ntBlank then\r\n    window.open(AURL, '_blank')\r\n  else\r\n    window.location.href := AURL;\r\nend;\r\n\r\nfunction TApplication.NeedsFormRouting: Boolean;\r\nvar\r\n  s: string;\r\nbegin\r\n  Result := HasQueryParam('form', s);\r\n  if Result then\r\n    RouteForm(s);\r\nend;\r\n\r\nfunction TApplication.ObjectURL(AFile: TJSHTMLFile): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    res = URL.createObjectURL(AFile);\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference);\r\nbegin\r\n  CreateForm(AInstanceClass, AElementID, AReference, nil);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; AElement: TJSHTMLElement; var AReference); overload;\r\nbegin\r\n  CreateForm(AInstanceClass, AElement.ID, AReference, nil);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference; AProc: TFormCreatedProc);\r\nvar\r\n  LFileName: string;\r\n\r\n  function DoStatusCreate(Event: TEventListenerEvent): boolean;\r\n  var\r\n    LElem: TJSHTMLElement;\r\n    LForm: TForm;\r\n    LResponse: string;\r\n    LIsBody: boolean;\r\n  begin\r\n    // HTML of the form being loaded\r\n    asm\r\n      LResponse = Event.target.responseText;\r\n    end;\r\n\r\n    LIsBody := AElementID = cBodyTag;\r\n\r\n    if LIsBody then\r\n      LElem := TJSHTMLElement(document.body)\r\n    else\r\n      LElem := TJSHTMLElement(document.getElementById(AElementID));\r\n\r\n    LElem.innerHTML := LResponse;\r\n\r\n    LForm := AInstanceClass.Create(AElementID, AReference);\r\n    LForm.FormFileName := LFileName;\r\n\r\n    if LForm.FormContainer = '' then\r\n      LForm.FormContainer := AElementID;\r\n\r\n    if not LIsBody then\r\n    begin\r\n      LForm.FFormElement := AElementID;\r\n      LForm.Container := LElem;\r\n    end;\r\n\r\n    LForm.CreateControl;\r\n    LForm.Init;\r\n\r\n    // set previous active form\r\n    LForm.FPrevActiveForm := FActiveForm;\r\n\r\n    FActiveForm := LForm;\r\n\r\n    if FMainForm = nil then\r\n      FMainForm := LForm;\r\n\r\n    if Assigned(AProc) then\r\n      AProc(LForm);\r\n\r\n    Result := true;\r\n\r\n    ActivateChildScripts(LElem);\r\n\r\n    FActiveForm.DoShow;\r\n    // force resize\r\n    FActiveForm.Resize;\r\n  end;\r\n\r\nbegin\r\n  if FIsRedirect then\r\n    Exit;\r\n\r\n  if FAppInitializing then\r\n  begin\r\n    if FCanCreateForm then\r\n      FCanCreateForm := False\r\n    else\r\n      Exit;\r\n  end;\r\n\r\n  LFileName := AInstanceClass.UnitName + GetFormExtension;\r\n  FLastReq := TJSXMLHttpRequest.new;\r\n  FLastReq.addEventListener('load', @DoStatusCreate);\r\n  FLastReq.open('GET', lFileName);\r\n  {$IFDEF DEBUG}\r\n  FLastReq.setRequestHeader('Cache-Control', 'no-cache');\r\n  {$ENDIF}\r\n  FLastReq.send;\r\nend;\r\n\r\nprocedure TApplication.ActivateChildScripts(AElement: TJSHTMLElement);\r\nbegin\r\n  // activate possible child scripts\r\n  asm\r\n    function nodeScriptReplace(node) {\r\n            if ( nodeScriptIs(node) === true ) {\r\n                    node.parentNode.replaceChild( nodeScriptClone(node) , node );\r\n            }\r\n            else {\r\n                    var i        = 0;\r\n                    var children = node.childNodes;\r\n                    while ( i < children.length ) {\r\n                            nodeScriptReplace( children[i++] );\r\n                    }\r\n            }\r\n\r\n            return node;\r\n    }\r\n    function nodeScriptIs(node) {\r\n            return node.tagName === 'SCRIPT';\r\n    }\r\n    function nodeScriptClone(node){\r\n            var script  = document.createElement(\"script\");\r\n            script.text = node.innerHTML;\r\n            for( var i = node.attributes.length-1; i >= 0; i-- ) {\r\n                    script.setAttribute( node.attributes[i].name, node.attributes[i].value );\r\n            }\r\n            return script;\r\n    }\r\n    nodeScriptReplace(AElement);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.ReloadForm;\r\nvar\r\n  lFileName: string;\r\n\r\n  function DoStatusCreate(Event: TEventListenerEvent): boolean;\r\n  var\r\n    i: integer;\r\n    ctl: TControl;\r\n    s: string;\r\n    sl: TStringList;\r\n    response: string;\r\n\r\n  begin\r\n    asm\r\n      response = Event.target.responseText;\r\n    end;\r\n\r\n    sl := TStringList.Create;\r\n\r\n    // persist control state\r\n    for i := FActiveForm.ControlCount - 1 downto 0 do\r\n    begin\r\n      ctl := FActiveForm.Controls[i];\r\n      ctl.PersistInHTML;\r\n      ctl.ElementHandle.Id := ctl.Name;\r\n      s := ctl.Name +'='+ctl.ElementHandle.outerHTML;\r\n      sl.Add(s);\r\n    end;\r\n\r\n    for i := FActiveForm.ControlCount - 1 downto 0 do\r\n    begin\r\n      ctl := FActiveForm.Controls[i];\r\n      FActiveForm.RemoveComponent(ctl);\r\n      ctl.Free;\r\n    end;\r\n\r\n    FActiveForm.ClearControls;\r\n    FActiveForm.UnbindEvents;\r\n\r\n    // HTML of the form being loaded\r\n    document.body.innerHTML := response;\r\n\r\n    FActiveForm.CreateControl;\r\n    FActiveForm.DoCreate;\r\n    FActiveForm.Init;\r\n\r\n    // persist control state\r\n    for i := FActiveForm.ControlCount - 1 downto 0 do\r\n    begin\r\n      ctl := FActiveForm.Controls[i];\r\n      s := sl.Values[ctl.Name];\r\n      ctl.ElementHandle.outerHTML := s;\r\n      ctl.Container := document.getElementById(ctl.Name);\r\n      ctl.BindEvents;\r\n    end;\r\n\r\n    sl.Free;\r\n\r\n    FActiveForm.DoShow;\r\n\r\n    Result := true;\r\n  end;\r\n\r\nbegin\r\n  lFileName := FActiveForm.UnitName + GetFormExtension;\r\n\r\n  FLastReq := TJSXMLHttpRequest.new;\r\n  FLastReq.addEventListener('load', @DoStatusCreate);\r\n  FLastReq.open('GET', lFileName);\r\n  {$IFDEF DEBUG}\r\n  FLastReq.setRequestHeader('Cache-Control', 'no-cache');\r\n  {$ENDIF}\r\n  FLastReq.send;\r\nend;\r\n\r\nprocedure TApplication.RemoveCSS(id: string);\r\nvar\r\n  styleElement: TJSElement;\r\nbegin\r\n  styleElement := document.getElementById(id);\r\n  if Assigned(styleElement) then\r\n  begin\r\n    styleElement.parentNode.removeChild(styleElement);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.RouteForm(AParameter: string);\r\nvar\r\n  frm: TCustomForm;\r\n  fc: TFormClass;\r\nbegin\r\n  fc := TFormClass(GetClass(AParameter));\r\n  Application.CreateForm(fc, frm);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; var AReference);\r\nbegin\r\n  CreateForm(AInstanceClass, cBodyTag, AReference, nil);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TDataModuleClass; var AReference);\r\nvar\r\n  lModule: TDataModule;\r\nbegin\r\n  lModule := AInstanceClass.Create(Self);\r\n  AReference := lModule;\r\nend;\r\n\r\nprocedure TApplication.CreateNewForm(AForm: TCustomForm; HTML: string);\r\nvar\r\n  eh,op,span,childspan,formspan: TJSHTMLElement;\r\n  l,t,w,h: integer;\r\n  LCreatedProc: TFormCreatedProc;\r\n  LCaptionDiv: TJSHTMLElement;\r\n  LCaptionHeight: integer;\r\nbegin\r\n  if FMainForm = nil then\r\n    FMainForm := AForm;\r\n\r\n  span := nil;\r\n  formspan := nil;\r\n  LCaptionHeight := 0;\r\n\r\n  // form hosted in designated container\r\n  if not FActiveForm.Popup and (FActiveForm.FFormElement <> '') then\r\n  begin\r\n    FActiveForm.FLayer := nil;\r\n    eh := TJSHTMLElement(document.getElementById(FActiveForm.FFormElement));\r\n    if Assigned(eh) then\r\n    begin\r\n      eh.innerHTML := HTML;\r\n      if (FActiveForm.ElementClassname = '') then\r\n        eh.style.setProperty('background-color',ColorToHTML(FActiveForm.Color));\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    FActiveForm.ClearControls;\r\n    // transparent mouse blocking layer\r\n    FActiveForm.FLayer := FActiveForm.CreateLayer;\r\n    document.body.appendChild(FActiveForm.FLayer);\r\n    eh := TJSHTMLElement(FActiveForm.FLayer);\r\n\r\n    // insert opacity layer\r\n    if FActiveForm.Popup and (FActiveForm.PopupOpacity < 1) then\r\n    begin\r\n      op := FActiveForm.CreateLayer;\r\n      op.style.setProperty('background-color', 'black');\r\n      op.style.setProperty('opacity', DoubleToHTML(FActiveForm.PopupOpacity));\r\n      op.style.setProperty('z-index', '9998');\r\n      eh.appendChild(op);\r\n    end;\r\n\r\n    span := TJSHTMLElement(document.createElement('DIV'));\r\n    span.style.setProperty('z-index', '9999');\r\n    FActiveForm.FPopupElement := span;\r\n    if (FActiveForm.Border = fbDialogSizeable) then\r\n    begin\r\n      span.style.setProperty('resize','both');\r\n      span.style.setProperty('overflow','auto');\r\n\r\n      asm\r\n        try\r\n        {\r\n        var frm = this.FActiveForm;\r\n        const ro = new ResizeObserver( function(entries)  {\r\n           entries.forEach( function(entry) {\r\n             frm.HandleObserver();\r\n             } );\r\n        });\r\n          // Observe the scrollingElement for when the window gets resized\r\n          ro.observe(span);\r\n        }\r\n        catch(err)\r\n        {\r\n          span.style.removeProperty('resize');\r\n          span.style.removeProperty('overflow');\r\n        }\r\n      end;\r\n    end;\r\n\r\n    if FActiveForm.ElementClassName <> '' then\r\n      span.setAttribute('class',FActiveForm.ElementClassName);\r\n\r\n    if FActiveForm.Shadow then\r\n      span.style.setProperty('box-shadow','3px 3px 3px silver');\r\n\r\n    eh.appendChild(span);\r\n\r\n    if (FActiveForm.Border in [fbDialog, fbDialogSizeable]) then\r\n    begin\r\n      FActiveForm.GetMethodPointers;\r\n      LCaptionDiv := FActiveForm.CreateCaption;\r\n      span.appendChild(LCaptionDiv);\r\n      childspan := TJSHTMLElement(document.createElement('SPAN'));\r\n//      childspan.style.setProperty('position','absolute');\r\n      childspan['id']:= 'childspan';\r\n      span.appendChild(childspan);\r\n      formspan := childspan;\r\n      LCaptionHeight := 22;\r\n    end\r\n    else\r\n    begin\r\n      formspan := span;\r\n    end;\r\n\r\n    formspan.innerHTML := HTML;\r\n    FActiveForm.Container := formspan;\r\n  end;\r\n\r\n  FActiveForm.Init;\r\n  FActiveForm.LoadDFMValues;\r\n\r\n  if Assigned(FActiveForm.FLayer) then\r\n  begin\r\n    // ensure full screen background is white or adopts the form elementclassname when it is not popup\r\n    if not FActiveForm.Popup then\r\n    begin\r\n      if (FActiveForm.ElementClassName = '') then\r\n        eh.style.setProperty('background-color','white')\r\n      else\r\n      eh.setAttribute('class',FActiveForm.ElementClassName);\r\n    end;\r\n  end;\r\n\r\n\r\n  // position popup form centered\r\n  if Assigned(span) and (FActiveForm.FormContainer = '') and FActiveForm.Popup then\r\n  begin\r\n    span.style.setProperty('position', 'absolute');\r\n\r\n    l := Round((window.innerWidth - FActiveForm.Width)/2);\r\n    t := Round((window.innerHeight - FActiveForm.Height)/2);\r\n    w := FActiveForm.Width;\r\n    h := FActiveForm.Height + LCaptionHeight;\r\n\r\n    span.style.setProperty('background-color',ColorToHTML(FActiveForm.Color));\r\n    span.style.setProperty('border','1px Black solid');\r\n\r\n    span.style.setProperty('top',IntTostr(t)+'px');\r\n    span.style.setProperty('left',IntToStr(l)+'px');\r\n    span.style.setProperty('width',IntToStr(w)+'px');\r\n    span.style.setProperty('height',IntToStr(h)+'px');\r\n  end;\r\n\r\n  if Assigned(formspan) then\r\n    ActivateChildScripts(formspan);\r\n\r\n  if Assigned(FActiveForm.FCreatedProc) then\r\n  begin\r\n    LCreatedProc := FActiveForm.FCreatedProc;\r\n    FActiveForm.FCreatedProc := nil;\r\n    LCreatedProc(FActiveForm);\r\n  end;\r\n\r\n  if Assigned(FActiveForm.OnCreate) then\r\n    FActiveForm.OnCreate(FActiveForm);\r\n\r\n  FActiveForm.Realign;\r\n  FActiveForm.Loaded;\r\n  FActiveForm.InitAnchoring;\r\n  FActiveForm.UpdateChildAnchoring;\r\n  FActiveForm.FCreating := false;\r\n  FActiveForm.UpdateElement;\r\n\r\n  if not FActiveForm.EventsBound then\r\n    FActiveForm.BindEvents;\r\n\r\n  FActiveForm.DoShow;\r\nend;\r\n\r\nfunction TApplication.DoFormLoad(Event: TEventListenerEvent): boolean;\r\nvar\r\n  LResponse: string;\r\nbegin\r\n  asm\r\n    LResponse = Event.target.responseText;\r\n  end;\r\n\r\n  CreateNewForm(FActiveForm, LResponse);\r\n  Result := true;\r\nend;\r\n\r\nfunction TApplication.DoHandleError(Event: TJSErrorEvent): boolean;\r\nvar\r\n  err: TAppplicationError;\r\n  el,sp,x: TJSHTMLElement;\r\n  msg,s: string;\r\nbegin\r\n  err.AMessage := Event.message;\r\n  err.AFile := Event.filename;\r\n  err.ALineNumber := Event.lineno;\r\n  err.AColNumber := Event.colno;\r\n  err.AError := Event.error;\r\n  err.AStack := '';\r\n  s := '';\r\n  // try to get stack & RTL exception message\r\n  if Assigned(Event.error) then\r\n  begin\r\n\r\n    asm\r\n      if (Event.error.stack) {\r\n        err.AStack = Event.error.stack;\r\n      }\r\n      if (Event.error.fMessage) {\r\n        err.AMessage = Event.error.fMessage;\r\n      }\r\n    end;\r\n\r\n    asm\r\n      function objToString (obj) {\r\n      var str = '';\r\n      for (var p in obj) {\r\n          if (obj.hasOwnProperty(p)) {\r\n              str += p + '::' + obj[p] + '\\n';\r\n          }\r\n      }\r\n      return str;\r\n      }\r\n      s = objToString(Event.error);\r\n    end;\r\n  end;\r\n\r\n\r\n  Result := false;\r\n\r\n  msg := 'ERROR<br>' + err.AMessage + ' | ' + s + err.AStack + '<BR> at '+err.AFile + ' [' +inttostr(err.ALineNumber)+':'+inttostr(err.AColNumber)+']';\r\n\r\n  case ErrorType of\r\n  aeFooter:\r\n    begin\r\n      el := TJSHTMLElement(document.getElementById('tmserrormessage'));\r\n\r\n      if Assigned(el) then\r\n      begin\r\n        (el.firstChild as TJSHTMLElement).innerHTML := msg;\r\n      end\r\n      else\r\n      begin\r\n        el := TJSHTMLElement(document.createElement('DIV'));\r\n        el.setAttribute('id','tmserrormessage');\r\n        el.style.setProperty('position','absolute');\r\n        el.style.setProperty('font-family','Courier');\r\n        el.style.setProperty('font-size','8pt');\r\n        el.style.setProperty('bottom','0');\r\n        el.style.setProperty('width','100%');\r\n        el.style.setProperty('height','100px');\r\n        el.style.setProperty('background','#ff0000');\r\n        el.style.setProperty('color','#ffffff');\r\n        TJSHTMLElement(document.body).style.setProperty('padding','0');\r\n        TJSHTMLElement(document.body).style.setProperty('margin','0');\r\n        sp := TJSHTMLElement(document.createElement('SPAN'));\r\n        sp.style.setProperty('margin-left','4px');\r\n        sp.style.setProperty('float','left');\r\n        sp.style.setProperty('overflow','hidden');\r\n        sp.style.setProperty('display','block');\r\n        sp.innerHTML := msg;\r\n        el.appendChild(sp);\r\n\r\n        x := TJSHTMLElement(document.createElement('SPAN'));\r\n        x.style.setProperty('font-family','Courier');\r\n        x.style.setProperty('font-size','8pt');\r\n        x.style.setProperty('font-weight','bold');\r\n        x.style.setProperty('position','absolute');\r\n        x.style.setProperty('width','20px');\r\n        x.style.setProperty('vertical-align','top');\r\n        x.style.setProperty('cursor','pointer');\r\n        x.style.setProperty('text-align','right');\r\n        x.style.setProperty('right','4px');\r\n        x.style.setProperty('display','block');\r\n        x.innerHTML := 'X';\r\n        x.onClick := @DoErrorClose;\r\n        el.appendChild(x);\r\n\r\n        document.body.appendChild(el);\r\n      end;\r\n    end;\r\n  aeAlert: window.alert(msg);\r\n  aeDialog:\r\n    begin\r\n        AddControlLink('googlematerial', 'https://fonts.googleapis.com/icon?family=Material+Icons');\r\n      MessageDlg(msg, mtError, [mbOK]);\r\n    end;\r\n  end;\r\n\r\n  if Assigned(OnError) then\r\n    OnError(Self, err, Result);\r\nend;\r\n\r\nfunction TApplication.DoHashChange(Event: TEventListenerEvent): boolean;\r\nvar\r\n  s: string;\r\n  fc: TFormClass;\r\n  frm: TCustomForm;\r\n  bdy: TJSHTMLElement;\r\n  Handled: boolean;\r\n\r\nbegin\r\n  Result := true;\r\n\r\n  if not AutoFormRoute then\r\n    Exit;\r\n\r\n  asm\r\n    s  = location.hash;\r\n  end;\r\n\r\n  // remove hash sign to get class name\r\n  Delete(s,1,1);\r\n\r\n  Handled := false;\r\n\r\n  if Assigned(OnHashChange) then\r\n    OnHashChange(Self, s, Handled);\r\n\r\n  if Handled then\r\n    Exit;\r\n\r\n  if s = '' then\r\n    s := FInitFormClassName;\r\n\r\n  if s <> '' then\r\n  begin\r\n    if FInitFormClassName = '' then\r\n      FInitFormClassName := FActiveForm.ClassName;\r\n\r\n    fc := TFormClass(GetClass(s));\r\n\r\n    if Assigned(fc) then\r\n    begin\r\n      bdy := TJSHTMLElement(document.body);\r\n      CreateForm(fc, bdy, frm);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TApplication.DoUpdateOnlineStatus(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  Result := true;\r\n\r\n  if Assigned(OnOnlineChange) then\r\n  begin\r\n    if window.navigator.onLine then\r\n      OnOnlineChange(Self, osOnline)\r\n    else\r\n      OnOnlineChange(Self, osOffline);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.Download(const AURL: string);\r\nbegin\r\n  asm\r\n    window.location.href = AURL;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.DownloadTextFile(const AText: string; AFileName: string = '');\r\nbegin\r\n  asm\r\n    var element = document.createElement('a');\r\n    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(AText));\r\n    if (AFileName != ''){\r\n      element.setAttribute('download', AFileName);\r\n    }\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n    element.click();\r\n    document.body.removeChild(element);\r\n  end;\r\nend;\r\n\r\nfunction TApplication.EXEName: string;\r\nbegin\r\n  Result := window.document.location.href;\r\nend;\r\n\r\nprocedure TApplication.DownloadBinaryFile(const Data: TJSUint8Array; AFileName: string = '');\r\nbegin\r\n  asm\r\n    var element = document.createElement('a');\r\n    var blob = new Blob([Data], {type: \"octet/stream\"})\r\n    var url = window.URL.createObjectURL(blob);\r\n    element.href = url;\r\n    if (AFileName != ''){\r\n      element.setAttribute('download', AFileName);\r\n    }\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n    element.click();\r\n    document.body.removeChild(element);\r\n  end;\r\nend;\r\n\r\nfunction TApplication.GetAuthorizationPageHTML(const AAuthorizationSuccess: Boolean): string;\r\nconst\r\n  sExternalBrowserAuthorizationOK = '<div class=\"text2\">Application succesfully authorized</div>You can close this browser window';\r\n  sExternalBrowserAuthorizationFailed = '<div class=\"text2\">Application authorization failed</div><br/>Please try again.';\r\n  LB = #13#10;\r\n\r\n  ImageFail = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeA'+\r\n  'AAACXBIWXMAAA7DAAAOwwHHb6hkAAABtElEQVR4nO2bUY7CMAxEhz0NB+EgrDjXCg6yB+E4+9NKCAiN'+\r\n  '7XHcjf1+ED+Z6ahNHScFiqIoBNwvp+v9crpG+3hG6+sgFQFwXv7ejj+/31JBDyy+ugN4ElkJD8Hqqyu'+\r\n  'AhohYjA3D12YAGyIiMSYsXx8D6BTpFmPB9NUMQCjSJcaA7ettAEqRTTErHr5eAjCKfBSz4OXryzhgiz'+\r\n  'OzWCJd/Fs8HoFHzHeCtxf2JNgt3MMID8zXoMpAtDarEDIbidJklMJUQ6MDty6GNDSNRdxtluWwhReDU'+\r\n  'fONKADAx2jkZCsOAOAaXn4pY2let6oAAN/qTIG61lAHAOwmBFO1aQoACA/BXGqbAwDCQqCsOCkBAMND'+\r\n  'oC23aQEAw0Kg9hqoAQDuIdAbLfQAALcQXFptLgEA9BDc+oxeLbF/Qz0C7AFTT4KpX4OpC6HUpXDqxVD'+\r\n  'q5fBOLn5lbEMkdUssdVM0dVs89cZI6q2x1JujqbfHUx+Q2MPFj/LidUqsKajB05NXS4y6Zl/GurHGe6'+\r\n  'QOSpLF5jgqqxSb67C0UGzO4/KdYnN/MLEhluOTmYZY+MWvDPU122dzRVHk5g+X6Lw5aVkK9AAAAABJRU5ErkJggg==';\r\n\r\n  ImageSuccess = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaX'+\r\n  'HeAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACC0lEQVR4nO2Zv3GDMBSHv+QyQEbICM4EOW+Q9BS4o2QTU'+\r\n  '9LZBQNkg6zgETyCR0iRkOMIAv3Xk0+/zsiI931nI3iCkpKSkpKSkpKSkpJ7SDN0x2bo3nW//xCymNhp'+\r\n  'hu4E1MAN2PdVe9k6524ETODHXIHXvmpva+c9BqwpWhbgAV6Ar61zsxeggB+z+x1XJmsBG/Bj6mboWtV'+\r\n  'gtvcATfhpPvqq/ZwfzFKABTwoVobsBFjCj7kyWxmyugc4wsPCypCNAA/wY/L7C3iEP/dVe5geEC8gJD'+\r\n  'wIFxAaHgQLiAEPQgXEggeBAmLCgzABseFBkIAU8CBEQCp4ECAgJTwYChibCzYXWpmv9jCVFTwYCJgVa'+\r\n  '31BxXwucapFS4CiWOsLS4EHDQEbxRoXIAkeNgRoFqtdiDR4WBFgWOxmQRLhQdEQsSi2bobuqBqUCg8L'+\r\n  'vwDHYg991Z49zjeNd3iYCfBU7J8E6fAAT7PPOw9znpqhA3hDODz8F7Dnp2vqKmJ1O8ogQeFh+R7wjB8'+\r\n  'JrgkOD4plUICEKPCw/hyQSkI0eNh+EowtISo86L0LxJIQHR703wZDS0gCD2b9gFASksGDeUfIt4Sk8G'+\r\n  'DRE/QoITk8WDZFPUgQAQ8OXWEHCWLgwbEtbiFBFDx42BcwkCAOHjxtjGhIEAkPHneGViSIhQfPW2MLE'+\r\n  'kTDQ4C9wYmEi3T4kpKSkm+5ax+YhPsUTQAAAABJRU5ErkJggg==';\r\n\r\n  PlaceHolderImage = '#PLACEHOLDERIMAGE#';\r\n  PlaceHolderText = '#PLACEHOLDERTEXT#';\r\n  PlaceHolderColor = '#PLACEHOLDERCOLOR#';\r\n\r\n  AuthHTMLTemplate =\r\n  '<!doctype html>'+LB+\r\n  '<html lang=\"en\">'+LB+\r\n  '<head>'+LB+\r\n  '  <title>Authentication Result</title>'+LB+\r\n  '  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">'+LB+\r\n  '</head>'+LB+\r\n  '<body>'+LB+\r\n  '<style>'+LB+\r\n  '  hr'+LB+\r\n  '  {'+LB+\r\n  '    border: none;'+LB+\r\n  '    height: 1px;'+LB+\r\n  '    background-color: rgb(171, 171, 171);'+LB+\r\n  '  }'+LB+\r\n  '  div.container'+LB+\r\n  '  {'+LB+\r\n  '    position: fixed;'+LB+\r\n  '    font-family: Arial;'+LB+\r\n  '    font-size: 12pt;'+LB+\r\n  '    max-width: 100%;'+LB+\r\n  '    max-height: 100%;'+LB+\r\n  '    top: 50%;'+LB+\r\n  '    left: 50%;'+LB+\r\n  '    transform: translate(-50%, -50%);'+LB+\r\n  '  }'+LB+\r\n  '  div.section'+LB+\r\n  '  {'+LB+\r\n  '    display: inline-block;'+LB+\r\n  '    margin: 15px;'+LB+\r\n  '    padding: 5px;'+LB+\r\n  '    float: left;'+LB+\r\n  '  }'+LB+\r\n  '  div.image img'+LB+\r\n  '  {'+LB+\r\n  '    height: 100%;'+LB+\r\n  '  }'+LB+\r\n  '  div.text'+LB+\r\n  '  {'+LB+\r\n  '    padding-top: 15px;'+LB+\r\n  '  }'+LB+\r\n  '  div.text2'+LB+\r\n  '  {'+LB+\r\n  '    font-size: 18pt;'+LB+\r\n  '    color: #PLACEHOLDERCOLOR#;'+LB+\r\n  '  }'+LB+\r\n  '  span.title'+LB+\r\n  '  {'+LB+\r\n  '    font-size: 26px;'+LB+\r\n  '  }'+LB+\r\n  '</style>'+LB+\r\n  '  <div class=\"container\">'+LB+\r\n  '  <div class=\"section image\">'+LB+\r\n  '    <img src=\"#PLACEHOLDERIMAGE#\">'+LB+\r\n  '  </div>'+LB+\r\n  '  <div class=\"section text\">'+LB+\r\n  '  #PLACEHOLDERTEXT#'+LB+\r\n  '  </div>'+LB+\r\n  '  </div>'+LB+\r\n  ' </body>'+LB+\r\n  '</html>';\r\n\r\n  function ReplacePlaceHolders(APlaceHolders: array of string; APlaceHolderValues: array of string): string;\r\n  var\r\n    I: Integer;\r\n    s: string;\r\n  begin\r\n    s := AuthHTMLTemplate;\r\n    for I := 0 to Length(APlaceHolders) - 1 do\r\n      s := StringReplace(s, APlaceHolders[I], APlaceHolderValues[I], [rfReplaceAll]);\r\n\r\n    Result := s;\r\n  end;\r\n\r\nbegin\r\n  if AAuthorizationSuccess then\r\n    Result := ReplacePlaceHolders([PlaceHolderImage, PlaceHolderText, PlaceHolderColor], [ImageSuccess, sExternalBrowserAuthorizationOK, 'rgb(104, 164, 144)'])\r\n  else\r\n    Result := ReplacePlaceHolders([PlaceHolderImage, PlaceHolderText, PlaceHolderColor], [ImageFail, sExternalBrowserAuthorizationFailed, 'rgb(216, 99, 68)']);\r\nend;\r\n\r\nfunction TApplication.GetFormExtension: string;\r\nbegin\r\n  if Language <> lNone then\r\n    Result := '_' + GetLanguageISO639_1Code(Language) + cHTMLExt\r\n  else\r\n    Result := cHTMLExt;\r\nend;\r\n\r\nfunction TApplication.GetIsOnline: boolean;\r\nbegin\r\n  Result := window.navigator.onLine;\r\nend;\r\n\r\nfunction TApplication.GetIsMobile: boolean;\r\nvar\r\n  mob: boolean;\r\nbegin\r\n  asm\r\n    function TestMobile() {\r\n      var check = false;\r\n     (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);\r\n     return check;\r\n     };\r\n\r\n    mob = TestMobile();\r\n  end;\r\n\r\n  Result := mob;\r\nend;\r\n\r\n{$IFDEF SINGLEINSTANCE}\r\nprocedure TApplication.DoGetDataReceived(Sender: TObject; Origin: string;\r\n  Data: TJSObject);\r\nbegin\r\n  if Data.toString = '#reload' then\r\n  begin\r\n    asm\r\n      location.reload();\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.DoGetConnected(Sender: TObject);\r\nvar\r\n  url,agent:string;\r\nbegin\r\n  url := window.location.href;\r\n  agent := window.navigator.useragent;\r\n\r\n  if Pos('Edge', agent) > 0 then\r\n    agent := 'Edge'\r\n  else if Pos('Opera', agent) > 0 then\r\n    agent := 'Opera'\r\n  else if Pos('OPR', agent) > 0 then\r\n    agent := 'Opera'\r\n  else if Pos('Chrome', agent) > 0 then\r\n    agent := 'Chrome'\r\n  else if Pos('Safari', agent) > 0 then\r\n    agent := 'Safari'\r\n  else if Pos('Firefox', agent) > 0 then\r\n    agent := 'Firefox'\r\n  else if Pos('Trident', agent) > 0 then\r\n    agent := 'MSIE'\r\n  else\r\n    agent := '';\r\n\r\n  FWebSocket.Send(url + ';' + agent);\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TApplication.DoErrorClose(Event: TJSMouseEvent): boolean;\r\nbegin\r\n  document.body.removeChild(Event.target.parentElement);\r\n  Result := true;\r\nend;\r\n\r\nfunction TApplication.DoFormAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  ShowMessage('Failed to load form HTML template file');\r\n  Result := true;\r\nend;\r\n\r\n\r\nprocedure TApplication.InitFormatSettings(const BrowserLocale: string);\r\nvar\r\n  timestr: string;\r\n  i: integer;\r\n  locale: string;\r\nbegin\r\n  locale := BrowserLocale;\r\n\r\n  FormatSettings.ShortDateFormat := GetLocaleShortDateFormat(locale);\r\n\r\n  if (Pos('/',FormatSettings.ShortDateFormat) > 0) then\r\n    FormatSettings.DateSeparator := '/';\r\n\r\n  if (Pos('.',FormatSettings.ShortDateFormat) > 0) then\r\n    FormatSettings.DateSeparator := '.';\r\n\r\n  if (Pos('-',FormatSettings.ShortDateFormat) > 0) then\r\n    FormatSettings.DateSeparator := '-';\r\n\r\n  asm\r\n    var event = new Date('Jan 1, 1980 06:07:08 GMT+00:00');\r\n    var loc = \"\";\r\n    if (locale == \"\") { loc = navigator.language; } else\r\n    { loc = locale; }\r\n    timestr = event.toLocaleTimeString(loc);\r\n  end;\r\n\r\n  if pos(':',timestr) > 0 then\r\n    FormatSettings.TimeSeparator := ':';\r\n\r\n  if pos('.',timestr) > 0 then\r\n    FormatSettings.TimeSeparator := '.';\r\n\r\n  if pos('-',timestr) > 0 then\r\n    FormatSettings.TimeSeparator := '-';\r\n\r\n  for i := 1 to 7 do\r\n  begin\r\n    ShortDayNames[i] := GetLocaleShortDayName(i,locale);\r\n    LongDayNames[i] := GetLocaleLongDayName(i,locale);\r\n  end;\r\n\r\n  for i := 1 to 12 do\r\n  begin\r\n    ShortMonthNames[i] := GetLocaleShortMonthName(i,locale);\r\n    LongMonthNames[i] := GetLocaleLongMonthName(i,locale);\r\n  end;\r\n\r\n  FormatSettings.DecimalSeparator := GetLocaleDecimalSeparator;\r\n\r\n  if FormatSettings.DecimalSeparator = '.' then\r\n    FormatSettings.ThousandSeparator := ','\r\n  else\r\n    FormatSettings.ThousandSeparator := '.';\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TApplication.Initialize;\r\nvar\r\n  query, token: string;\r\n  p: Integer;\r\n  b: Boolean;\r\nbegin\r\n  FCanCreateForm := True;\r\n  FAppInitializing := True;\r\n  FParameters.Clear;\r\n  query := window.location.href;\r\n\r\n  InitFormatSettings(GetBrowserLocale);\r\n\r\n  FParameters.Delimiter := '&';\r\n  FParameters.StrictDelimiter := true;\r\n  p := Pos('?', query);\r\n  if p > 0 then\r\n    query := Copy(query, p + 1, Length(query));\r\n  FParameters.DelimitedText := query;\r\n\r\n  asm\r\n    b = (window.name == \"Authentication\");\r\n  end;\r\n\r\n  if (FParameters.IndexOfName('oauthcallback') <> -1) or b then\r\n  begin\r\n    if Assigned(OnOAuthCallBack) then\r\n      OnOauthCallBack(Self, query);\r\n\r\n    FIsRedirect := true;\r\n    document.body.innerHTML := GetAuthorizationPageHTML(True);\r\n    Exit;\r\n  end;\r\n\r\n  if FParameters.IndexOfName('code') <> -1 then\r\n  begin\r\n    if Assigned(OnOAuthToken) then\r\n      OnOauthToken(Self, query);\r\n    FIsRedirect := true;\r\n    token := FParameters.Values['code'];\r\n    asm\r\n      if (window.opener && window.opener.processAuthData){\r\n        window.opener.processAuthData(token);\r\n      \twindow.close();\r\n      }\r\n    end;\r\n  end;\r\n\r\n  window.addEventListener('hashchange',@DoHashChange);\r\n  window.addEventListener('online',  @DoUpdateOnlineStatus);\r\n  window.addEventListener('offline', @DoUpdateOnlineStatus);\r\n\r\n\r\n  if FParameters.IndexOfName('access_token') <> -1 then\r\n  begin\r\n    FIsRedirect := true;\r\n    token := FParameters.Values['access_token'];\r\n    asm\r\n      window.opener.processAuthData(token);\r\n    end;\r\n  \twindow.close();\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.InsertCSS(id, href: string);\r\nvar\r\n  styleElement: TJSElement;\r\nbegin\r\n\r\n  styleElement := document.getElementById(id);\r\n  if Assigned(styleElement) then\r\n  begin\r\n    asm\r\n      styleElement.href = href;\r\n    end;\r\n    Exit;\r\n  end;\r\n\r\n  styleElement := document.createElement('link');\r\n  styleElement.id := id;\r\n\r\n  asm\r\n    styleElement.rel = 'stylesheet';\r\n    styleElement.href = href;\r\n  end;\r\n\r\n  document.getElementsByTagName('head')[0].appendChild(styleElement);\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TApplication.Run;\r\nbegin\r\n  FCanCreateForm := True;\r\n  FAppInitializing := False;\r\nend;\r\n\r\nprocedure TApplication.RunScript(Source: string);\r\nbegin\r\n  asm\r\n    eval(Source);\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.ReceiveMessageFromClient(const AMessage: string);\r\nbegin\r\n  if Assigned(FClientConnector) then\r\n    FClientConnector.Receive(AMessage);\r\nend;\r\n\r\nprocedure TApplication.SetLanguage(const Value: TUILanguage);\r\nbegin\r\n  FLanguage := Value;\r\n  ReloadForm;\r\nend;\r\n\r\nprocedure TApplication.ChangeCSS(id, href: string);\r\nbegin\r\n  asm\r\n    var styleElement = document.getElementById(id);\r\n    if (styleElement) {\r\n      styleElement.href = href;\r\n      return;\r\n    }\r\n  end;\r\nend;\r\n\r\nconstructor TApplication.Create(AOwner: TComponent);\r\nbegin\r\n  FFormStack := TList.Create;\r\n  FParameters := TStringList.Create;\r\n  FMainForm := nil;\r\n  FActiveForm := nil;\r\n  FInitFormClassName := '';\r\n  FIsRedirect := false;\r\n  FAutoFormRoute := false;\r\n  FThemeColor := clTMSBlue;\r\n  FThemeTextColor := clWhite;\r\n  {$IFDEF SINGLEINSTANCE}\r\n  FWebSocket := TSocketClient.Create(Self);\r\n  FWebSocket.Port := DefaultPort;\r\n  FWebSocket.OnDataReceived := @DoGetDataReceived;\r\n  FWebSocket.OnConnect := @DoGetConnected;\r\n  FWebSocket.Connect;\r\n  {$ENDIF}\r\n\r\n  window.addEventListener('error', @DoHandleError);\r\n\r\n  FErrorType := aeSilent;\r\n  {$IFDEF DEBUG}\r\n  FErrorType := aeFooter;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF FREEWARE}\r\n  asm\r\n    alert('TMS WEB Core \\u00A9 2018 - 2020 tmssoftware.com - Trial Version');\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\ndestructor TApplication.Destroy;\r\nbegin\r\n  {$IFDEF SINGLEINSTANCE}\r\n  FWebSocket.Free;\r\n  {$ENDIF}\r\n  FFormStack.Free;\r\n  FParameters.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TApplication.LockForm(AForm: TCustomForm);\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].DisableTab;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.UnLockForm(AForm: TCustomForm);\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].EnableTab;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.PushForm(AForm: TCustomForm);\r\nvar\r\n  i: integer;\r\nbegin\r\n  // persist all control settings in HTML to be saved\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].PersistInHTML;\r\n  end;\r\n\r\n  // save with form\r\n  AForm.FormContent := document.body.innerHTML;\r\n\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].DisableTab;\r\n  end;\r\n\r\n  FFormStack.Add(AForm);\r\nend;\r\n\r\nfunction TApplication.PopForm: TCustomForm;\r\nvar\r\n  i: integer;\r\n  frm: string;\r\nbegin\r\n  if (FFormStack.Count > 0) then\r\n  begin\r\n    Result := TCustomForm(FFormStack.Items[FFormStack.Count - 1]);\r\n    frm := Result.FormContent;\r\n    FFormStack.Delete(FFormStack.Count - 1);\r\n\r\n    // restore document\r\n    document.body.innerHTML := frm;\r\n\r\n    Result.InitFromHTML;\r\n\r\n    // rebind form events\r\n    Result.BindEvents;\r\n\r\n    // rehook controls\r\n    for i := 0 to Result.ControlCount - 1 do\r\n      Result.Controls[i].HookElement;\r\n\r\n    for i := 0 to Result.ControlCount - 1 do\r\n    begin\r\n      Result.Controls[i].RecreateCanvas;\r\n      Result.Controls[i].InternalResize;\r\n    end;\r\n\r\n    Application.FActiveForm := Result;\r\n  end;\r\nend;\r\n\r\n{ TCustomFrame }\r\n\r\nconstructor TCustomFrame.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  FConstraints := TSizeConstraints.Create(Self);\r\n  FPopupMenu := TPopupMenu.Create(Self);\r\n  FTouchManager := TTouchManager.Create(Self);\r\nend;\r\n\r\ndestructor TCustomFrame.Destroy;\r\nbegin\r\n  FConstraints.Free;\r\n  FPopupMenu.Free;\r\n  FTouchManager.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TCustomFrame.LoadDFMValues;\r\nbegin\r\nend;\r\n\r\nprocedure TCustomFrame.LoadFromForm;\r\nbegin\r\n  LoadDFMValues;\r\nend;\r\n\r\nprocedure TCustomFrame.setConstraints(const AValue: TSizeConstraints);\r\nbegin\r\n  FConstraints.Assign(AValue);\r\nend;\r\n\r\nprocedure TCustomFrame.SetPopupMenu(AValue: TPopupMenu);\r\nbegin\r\n  FPopupMenu.Assign(AValue);\r\nend;\r\n\r\nprocedure TCustomFrame.SetTouchManager(AValue: TTouchManager);\r\nbegin\r\n  FTouchManager.Assign(AValue);\r\nend;\r\n\r\n{ TCustomSizeConstraints }\r\n\r\nconstructor TCustomSizeConstraints.Create(AControl: TControl);\r\nbegin\r\n  inherited Create;\r\n  FControl := AControl;\r\nend;\r\n\r\nprocedure TCustomSizeConstraints.AssignTo(ADest: TPersistent);\r\nbegin\r\n  if ADest is TCustomSizeConstraints then\r\n  begin\r\n    with TCustomSizeConstraints(ADest) do\r\n    begin\r\n      FMinHeight := Self.FMinHeight;\r\n      FMaxHeight := Self.FMaxHeight;\r\n      FMinWidth := Self.FMinWidth;\r\n      FMaxWidth := Self.FMaxWidth;\r\n      Change;\r\n    end;\r\n   end\r\n  else\r\n    inherited AssignTo(ADest);\r\nend;\r\n\r\nprocedure TCustomSizeConstraints.SetConstraints(AIndex: Integer; AValue: TConstraintSize);\r\nbegin\r\n  case AIndex of\r\n    0:\r\n      if AValue <> FMaxHeight then\r\n      begin\r\n        FMaxHeight := AValue;\r\n//        if not FControl.FIScaling then\r\n        begin\r\n          if (AValue > 0) and (AValue < FMinHeight) then\r\n            FMinHeight := AValue;\r\n          Change;\r\n        end;\r\n      end;\r\n    1:\r\n      if AValue <> FMaxWidth then\r\n      begin\r\n        FMaxWidth := AValue;\r\n//        if not FControl.FIScaling then\r\n        begin\r\n          if (AValue > 0) and (AValue < FMinWidth) then\r\n            FMinWidth := AValue;\r\n          Change;\r\n        end;\r\n      end;\r\n    2:\r\n      if AValue <> FMinHeight then\r\n      begin\r\n        FMinHeight := AValue;\r\n//        if not FControl.FIScaling then\r\n        begin\r\n          if (FMaxHeight > 0) and (AValue > FMaxHeight) then\r\n            FMaxHeight := AValue;\r\n          Change;\r\n        end;\r\n      end;\r\n    3:\r\n      if AValue <> FMinWidth then\r\n      begin\r\n        FMinWidth := AValue;\r\n //       if not FControl.FIScaling then\r\n        begin\r\n          if (FMaxWidth > 0) and (AValue > FMaxWidth) then\r\n            FMaxWidth := AValue;\r\n          Change;\r\n        end;\r\n      end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSizeConstraints.Change;\r\nbegin\r\n  if Assigned(FOnChange) then\r\n    FOnChange(Self);\r\nend;\r\n\r\n{ TDragDockObject }\r\n\r\nconstructor TDragDockObject.Create(AControl: TControl);\r\nbegin\r\n  inherited Create;\r\n  FBrush := TBrush.Create;\r\nend;\r\n\r\ndestructor TDragDockObject.Destroy;\r\nbegin\r\n  FBrush.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TDragDockObject.Assign(Source: TDragObject);\r\nbegin\r\nend;\r\n\r\n\r\ninitialization\r\nbegin\r\n  HandShakeScript := TJSHTMLScriptElement(document.createElement('script'));\r\n  HandShakeScript.id := 'HandShakeScript';\r\n  HandShakeScript.type_ := 'text/javascript';\r\n  HandShakeScript.innerHTML :=\r\n  'var IDE = null;'+#13#10+\r\n  'var TMSWEBCoreClientIdentifier = \"unknown\";'+#13#10+\r\n  'var TMSWEBCoreOAuthCallback = \"unknown\";'+#13#10+\r\n  'function HandShake(cid){'+#13#10+\r\n  '  TMSWEBCoreClientIdentifier = cid;'+#13#10+\r\n  '}';\r\n  document.body.appendChild(HandShakeScript);\r\n\r\n  Application := TApplication.Create(nil);\r\nend;\r\n\r\nend.\r\n\r\n\r\n","{$mode objfpc}\r\n\r\n{\r\n    This file is part of the Free Pascal run time library.\r\n    Copyright (c) 2018 by the Free Pascal development team\r\n\r\n    Delphi/Kylix compatibility unit, provides Date/Time handling routines.\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\nunit DateUtils;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Math;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Various constants\r\n  ---------------------------------------------------------------------}\r\n\r\nconst\r\n  DaysPerWeek        = 7;\r\n  WeeksPerFortnight  = 2;\r\n  MonthsPerYear      = 12;\r\n  YearsPerDecade     = 10;\r\n  YearsPerCentury    = 100;\r\n  YearsPerMillennium = 1000;\r\n\r\n  // ISO day numbers.\r\n  DayMonday    = 1;\r\n  DayTuesday   = 2;\r\n  DayWednesday = 3;\r\n  DayThursday  = 4;\r\n  DayFriday    = 5;\r\n  DaySaturday  = 6;\r\n  DaySunday    = 7;\r\n\r\n  // Fraction of a day\r\n  OneHour        = TDateTime(1)/HoursPerDay;\r\n  OneMinute      = TDateTime(1)/MinsPerDay;\r\n  OneSecond      = TDateTime(1)/SecsPerDay;\r\n  OneMillisecond = TDateTime(1)/MSecsPerDay;\r\n\r\n  { This is actual days per year but you need to know if it's a leap year}\r\n  DaysPerYear: array [Boolean] of Word = (365, 366);\r\n\r\n  { Used in RecodeDate, RecodeTime and RecodeDateTime for those datetime }\r\n  {  fields you want to leave alone }\r\n  RecodeLeaveFieldAsIs = 65535;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Global variables used in this unit\r\n  ---------------------------------------------------------------------}\r\n\r\nConst\r\n\r\n  { Average over a 4 year span. Valid for next 100 years }\r\n  ApproxDaysPerMonth: Double = 30.4375;\r\n  ApproxDaysPerYear: Double  = 365.25;\r\n\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Simple trimming functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateOf(const AValue: TDateTime): TDateTime;\r\nFunction TimeOf(const AValue: TDateTime): TDateTime;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Identification functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction IsInLeapYear(const AValue: TDateTime): Boolean;\r\nFunction IsPM(const AValue: TDateTime): Boolean;\r\nFunction IsValidDate(const AYear, AMonth, ADay: Word): Boolean;\r\nFunction IsValidTime(const AHour, AMinute, ASecond, AMilliSecond: Word): Boolean;\r\nFunction IsValidDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): Boolean;\r\nFunction IsValidDateDay(const AYear, ADayOfYear: Word): Boolean;\r\nFunction IsValidDateWeek(const AYear, AWeekOfYear, ADayOfWeek: Word): Boolean;\r\nFunction IsValidDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Enumeration functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WeeksInYear(const AValue: TDateTime): Word;\r\nFunction WeeksInAYear(const AYear: Word): Word;\r\nFunction DaysInYear(const AValue: TDateTime): Word;\r\nFunction DaysInAYear(const AYear: Word): Word;\r\nFunction DaysInMonth(const AValue: TDateTime): Word;\r\nFunction DaysInAMonth(const AYear, AMonth: Word): Word;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Variations on current date/time.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction Today: TDateTime;\r\nFunction Yesterday: TDateTime;\r\nFunction Tomorrow: TDateTime;\r\nFunction IsToday(const AValue: TDateTime): Boolean;\r\nFunction IsSameDay(const AValue, ABasis: TDateTime): Boolean;\r\nfunction IsSameMonth(const Avalue, ABasis: TDateTime): Boolean;\r\nFunction PreviousDayOfWeek (DayOfWeek : Word) : Word;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Extraction functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction YearOf(const AValue: TDateTime): Word;\r\nFunction MonthOf(const AValue: TDateTime): Word;\r\nFunction WeekOf(const AValue: TDateTime): Word;\r\nFunction DayOf(const AValue: TDateTime): Word;\r\nFunction HourOf(const AValue: TDateTime): Word;\r\nFunction MinuteOf(const AValue: TDateTime): Word;\r\nFunction SecondOf(const AValue: TDateTime): Word;\r\nFunction MilliSecondOf(const AValue: TDateTime): Word;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of year functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheYear(const AValue: TDateTime): TDateTime;\r\nFunction EndOfTheYear(const AValue: TDateTime): TDateTime;\r\nFunction StartOfAYear(const AYear: Word): TDateTime;\r\nFunction EndOfAYear(const AYear: Word): TDateTime;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of month functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheMonth(const AValue: TDateTime): TDateTime;\r\nFunction EndOfTheMonth(const AValue: TDateTime): TDateTime;\r\nFunction StartOfAMonth(const AYear, AMonth: Word): TDateTime;\r\nFunction EndOfAMonth(const AYear, AMonth: Word): TDateTime;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of week functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction StartOfTheWeek(const AValue: TDateTime): TDateTime;\r\nFunction EndOfTheWeek(const AValue: TDateTime): TDateTime;\r\nFunction StartOfAWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nFunction StartOfAWeek(const AYear, AWeekOfYear: Word): TDateTime; // ADayOFWeek 1\r\nFunction EndOfAWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nFunction EndOfAWeek(const AYear, AWeekOfYear: Word): TDateTime; // const ADayOfWeek: Word = 7\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of day functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheDay(const AValue: TDateTime): TDateTime;\r\nFunction EndOfTheDay(const AValue: TDateTime): TDateTime;\r\nFunction StartOfADay(const AYear, AMonth, ADay: Word): TDateTime; overload;\r\nFunction StartOfADay(const AYear, ADayOfYear: Word): TDateTime; overload;\r\nFunction EndOfADay(const AYear, AMonth, ADay: Word): TDateTime; overload;\r\nFunction EndOfADay(const AYear, ADayOfYear: Word): TDateTime; overload;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of year functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction MonthOfTheYear(const AValue: TDateTime): Word;\r\nFunction WeekOfTheYear(const AValue: TDateTime): Word; overload;\r\nFunction WeekOfTheYear(const AValue: TDateTime; out AYear: Word): Word; overload;\r\nFunction DayOfTheYear(const AValue: TDateTime): Word;\r\nFunction HourOfTheYear(const AValue: TDateTime): Word;\r\nFunction MinuteOfTheYear(const AValue: TDateTime): LongWord;\r\nFunction SecondOfTheYear(const AValue: TDateTime): LongWord;\r\nFunction MilliSecondOfTheYear(const AValue: TDateTime): NativeLargeInt;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of month functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WeekOfTheMonth(const AValue: TDateTime): Word; overload;\r\nFunction WeekOfTheMonth(const AValue: TDateTime; out AYear, AMonth: Word): Word; overload;\r\nFunction DayOfTheMonth(const AValue: TDateTime): Word;\r\nFunction HourOfTheMonth(const AValue: TDateTime): Word;\r\nFunction MinuteOfTheMonth(const AValue: TDateTime): Word;\r\nFunction SecondOfTheMonth(const AValue: TDateTime): LongWord;\r\nFunction MilliSecondOfTheMonth(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of week functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DayOfTheWeek(const AValue: TDateTime): Word;\r\nFunction HourOfTheWeek(const AValue: TDateTime): Word;\r\nFunction MinuteOfTheWeek(const AValue: TDateTime): Word;\r\nFunction SecondOfTheWeek(const AValue: TDateTime): LongWord;\r\nFunction MilliSecondOfTheWeek(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of day functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction HourOfTheDay(const AValue: TDateTime): Word;\r\nFunction MinuteOfTheDay(const AValue: TDateTime): Word;\r\nFunction SecondOfTheDay(const AValue: TDateTime): LongWord;\r\nFunction MilliSecondOfTheDay(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of hour functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction MinuteOfTheHour(const AValue: TDateTime): Word;\r\nFunction SecondOfTheHour(const AValue: TDateTime): Word;\r\nFunction MilliSecondOfTheHour(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of minute functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction SecondOfTheMinute(const AValue: TDateTime): Word;\r\nFunction MilliSecondOfTheMinute(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of second functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction MilliSecondOfTheSecond(const AValue: TDateTime): Word;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Range checking functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WithinPastYears(const ANow, AThen: TDateTime; const AYears: Integer): Boolean;\r\nFunction WithinPastMonths(const ANow, AThen: TDateTime; const AMonths: Integer): Boolean;\r\nFunction WithinPastWeeks(const ANow, AThen: TDateTime; const AWeeks: Integer): Boolean;\r\nFunction WithinPastDays(const ANow, AThen: TDateTime; const ADays: Integer): Boolean;\r\nFunction WithinPastHours(const ANow, AThen: TDateTime; const AHours: NativeLargeInt): Boolean;\r\nFunction WithinPastMinutes(const ANow, AThen: TDateTime; const AMinutes: NativeLargeInt): Boolean;\r\nFunction WithinPastSeconds(const ANow, AThen: TDateTime; const ASeconds: NativeLargeInt): Boolean;\r\nFunction WithinPastMilliSeconds(const ANow, AThen: TDateTime; const AMilliSeconds: NativeLargeInt): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Period functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction YearsBetween(const ANow, AThen: TDateTime; AExact : Boolean = False): Integer;\r\nFunction MonthsBetween(const ANow, AThen: TDateTime; AExact : Boolean = False): Integer;\r\nFunction WeeksBetween(const ANow, AThen: TDateTime): Integer;\r\nFunction DaysBetween(const ANow, AThen: TDateTime): Integer;\r\nFunction HoursBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nFunction MinutesBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nFunction SecondsBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nFunction MilliSecondsBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nProcedure PeriodBetween(const ANow, AThen: TDateTime; Out Years, months, days : Word); \r\n\r\n{ ---------------------------------------------------------------------\r\n    Timespan in xxx functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n{ YearSpan and MonthSpan are approximate values }\r\nFunction YearSpan(const ANow, AThen: TDateTime): Double;\r\nFunction MonthSpan(const ANow, AThen: TDateTime): Double;\r\nFunction WeekSpan(const ANow, AThen: TDateTime): Double;\r\nFunction DaySpan(const ANow, AThen: TDateTime): Double;\r\nFunction HourSpan(const ANow, AThen: TDateTime): Double;\r\nFunction MinuteSpan(const ANow, AThen: TDateTime): Double;\r\nFunction SecondSpan(const ANow, AThen: TDateTime): Double;\r\nFunction MilliSecondSpan(const ANow, AThen: TDateTime): Double;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Increment/decrement functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction IncYear(const AValue: TDateTime; const ANumberOfYears: Integer ): TDateTime;\r\nFunction IncYear(const AValue: TDateTime): TDateTime; // ; const ANumberOfYears: Integer = 1)\r\n// Function IncMonth is in SysUtils\r\nFunction IncWeek(const AValue: TDateTime; const ANumberOfWeeks: Integer): TDateTime;\r\nFunction IncWeek(const AValue: TDateTime): TDateTime; // ; const ANumberOfWeeks: Integer = 1)\r\nFunction IncDay(const AValue: TDateTime; const ANumberOfDays: Integer): TDateTime;\r\nFunction IncDay(const AValue: TDateTime): TDateTime; //; const ANumberOfDays: Integer = 1)\r\nFunction IncHour(const AValue: TDateTime; const ANumberOfHours: NativeLargeInt): TDateTime;\r\nFunction IncHour(const AValue: TDateTime): TDateTime; //; const ANumberOfHours: NativeLargeInt = 1\r\nFunction IncMinute(const AValue: TDateTime; const ANumberOfMinutes: NativeLargeInt): TDateTime;\r\nFunction IncMinute(const AValue: TDateTime): TDateTime; // ; const ANumberOfMinutes: NativeLargeInt = 1\r\nFunction IncSecond(const AValue: TDateTime; const ANumberOfSeconds: NativeLargeInt): TDateTime;\r\nFunction IncSecond(const AValue: TDateTime): TDateTime; // ; const ANumberOfSeconds: NativeLargeInt = 1\r\nFunction IncMilliSecond(const AValue: TDateTime; const ANumberOfMilliSeconds: NativeLargeInt): TDateTime;\r\nFunction IncMilliSecond(const AValue: TDateTime): TDateTime; // ; const ANumberOfMilliSeconds: NativeLargeInt = 1\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/Decode of complete timestamp\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nProcedure DecodeDateTime(const AValue: TDateTime; out AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word);\r\nFunction TryEncodeDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; out AValue: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying week of year and day of week\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nFunction EncodeDateWeek(const AYear, AWeekOfYear: Word): TDateTime; //; const ADayOfWeek: Word = 1\r\nProcedure DecodeDateWeek(const AValue: TDateTime; out AYear, AWeekOfYear, ADayOfWeek: Word);\r\nFunction TryEncodeDateWeek(const AYear, AWeekOfYear: Word; out AValue: TDateTime; const ADayOfWeek: Word): Boolean;\r\nFunction TryEncodeDateWeek(const AYear, AWeekOfYear: Word; out AValue: TDateTime): Boolean; //; const ADayOfWeek: Word = 1\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying day of year\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateDay(const AYear, ADayOfYear: Word): TDateTime;\r\nProcedure DecodeDateDay(const AValue: TDateTime; out AYear, ADayOfYear: Word);\r\nFunction TryEncodeDateDay(const AYear, ADayOfYear: Word; out AValue: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying week of month\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word): TDateTime;\r\nProcedure DecodeDateMonthWeek(const AValue: TDateTime; out AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word);\r\nFunction TryEncodeDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word; out AValue: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode time interval, allowing hours>24\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TryEncodeTimeInterval(Hour, Min, Sec, MSec:word; Out Time : TDateTime) : boolean;\r\nfunction EncodeTimeInterval(Hour, Minute, Second, MilliSecond:word): TDateTime;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Replace given element with supplied value.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction RecodeYear(const AValue: TDateTime; const AYear: Word): TDateTime;\r\nFunction RecodeMonth(const AValue: TDateTime; const AMonth: Word): TDateTime;\r\nFunction RecodeDay(const AValue: TDateTime; const ADay: Word): TDateTime;\r\nFunction RecodeHour(const AValue: TDateTime; const AHour: Word): TDateTime;\r\nFunction RecodeMinute(const AValue: TDateTime; const AMinute: Word): TDateTime;\r\nFunction RecodeSecond(const AValue: TDateTime; const ASecond: Word): TDateTime;\r\nFunction RecodeMilliSecond(const AValue: TDateTime; const AMilliSecond: Word): TDateTime;\r\nFunction RecodeDate(const AValue: TDateTime; const AYear, AMonth, ADay: Word): TDateTime;\r\nFunction RecodeTime(const AValue: TDateTime; const AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nFunction RecodeDateTime(const AValue: TDateTime; const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nFunction TryRecodeDateTime(const AValue: TDateTime; const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; out AResult: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Comparision of date/time\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction CompareDateTime(const A, B: TDateTime): TValueRelationship;\r\nFunction CompareDate(const A, B: TDateTime): TValueRelationship;\r\nFunction CompareTime(const A, B: TDateTime): TValueRelationship;\r\nFunction SameDateTime(const A, B: TDateTime): Boolean;\r\nFunction SameDate(const A, B: TDateTime): Boolean;\r\nFunction SameTime(const A, B: TDateTime): Boolean;\r\n\r\n{ For a given date these Functions tell you the which day of the week of the\r\n  month (or year).  If its a Thursday, they will tell you if its the first,\r\n  second, etc Thursday of the month (or year).  Remember, even though its\r\n  the first Thursday of the year it doesn't mean its the first week of the\r\n  year.  See ISO 8601 above for more information. }\r\n\r\nFunction NthDayOfWeek(const AValue: TDateTime): Word;\r\n\r\nProcedure DecodeDayOfWeekInMonth(const AValue: TDateTime; out AYear, AMonth, ANthDayOfWeek, ADayOfWeek: Word);\r\n\r\nFunction EncodeDayOfWeekInMonth(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word): TDateTime;\r\nFunction TryEncodeDayOfWeekInMonth(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word; out AValue: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Exception throwing routines\r\n  ---------------------------------------------------------------------}\r\n\r\nProcedure InvalidDateTimeError(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; const ABaseDate: TDateTime);\r\nProcedure InvalidDateTimeError(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word); // const ABaseDate: TDateTime = 0\r\nProcedure InvalidDateWeekError(const AYear, AWeekOfYear, ADayOfWeek: Word);\r\nProcedure InvalidDateDayError(const AYear, ADayOfYear: Word);\r\nProcedure InvalidDateMonthWeekError(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word);\r\nProcedure InvalidDayOfWeekInMonthError(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word);\r\n\r\n{ ---------------------------------------------------------------------\r\n    Julian and Modified Julian Date conversion support\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToJulianDate(const AValue: TDateTime): Double;\r\nFunction JulianDateToDateTime(const AValue: Double): TDateTime;\r\nFunction TryJulianDateToDateTime(const AValue: Double; out ADateTime: TDateTime): Boolean;\r\n\r\nFunction DateTimeToModifiedJulianDate(const AValue: TDateTime): Double;\r\nFunction ModifiedJulianDateToDateTime(const AValue: Double): TDateTime;\r\nFunction TryModifiedJulianDateToDateTime(const AValue: Double; out ADateTime: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Unix timestamp support.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToUnix(const AValue: TDateTime): NativeLargeInt;\r\nFunction UnixToDateTime(const AValue: NativeLargeInt): TDateTime;\r\nFunction UnixTimeStampToMac(const AValue: NativeLargeInt): NativeLargeInt;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Mac timestamp support.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToMac(const AValue: TDateTime): NativeLargeInt;\r\nFunction MacToDateTime(const AValue: NativeLargeInt): TDateTime;\r\nFunction MacTimeStampToUnix(const AValue: NativeLargeInt): NativeLargeInt;\r\n\r\n{ .....................................................................\r\n    Dos <-> Delphi datetime support\r\n  .....................................................................}\r\n\r\nFunction DateTimeToDosDateTime(const AValue: TDateTime): longint;\r\nFunction DosDateTimeToDateTime( AValue: longint): TDateTime;\r\n\r\n{ UTC <-> Local time }\r\n\r\nFunction UniversalTimeToLocal(UT: TDateTime): TDateTime;\r\nFunction UniversalTimeToLocal(UT: TDateTime; TZOffset : Integer): TDateTime;\r\nFunction LocalTimeToUniversal(LT: TDateTime): TDateTime;\r\nFunction LocalTimeToUniversal(LT: TDateTime; TZOffset: Integer): TDateTime;\r\n\r\n{ RFC 3339 support }\r\n\r\nFunction DateTimeToRFC3339(ADate :TDateTime):string;\r\nFunction DateToRFC3339(ADate :TDateTime):string;\r\nFunction TimeToRFC3339(ADate :TDateTime):string;\r\nFunction TryRFC3339ToDateTime(const Avalue: String; out ADateTime: TDateTime): Boolean;\r\nFunction RFC3339ToDateTime(const Avalue: String): TDateTime;\r\n\r\nType\r\n  {\r\n    Inverse of formatdatetime, destined for the dateutils unit of FPC.\r\n\r\n    Limitations/implementation details:\r\n    - An inverse of FormatDateTime is not 100% an inverse, simply because one can put e.g. time tokens twice in the format string,\r\n         and scandatetime wouldn't know which time to pick.\r\n    - Strings like hn can't be reversed safely. E.g. 1:2 (2 minutes after 1) delivers 12 which is parsed as 12:00 and then\r\n         misses chars for the \"n\" part.\r\n    - trailing characters are ignored.\r\n    - no support for Eastern Asian formatting characters since they are windows only.\r\n    - no MBCS support.\r\n\r\n    Extensions\r\n    - #9 eats whitespace.\r\n    - whitespace at the end of a pattern is optional.\r\n    - ? matches any char.\r\n    - Quote the above chars to really match the char.\r\n  }\r\n\r\n  { TDateTimeScanner }\r\n\r\n  TDateTimeScanner = Class\r\n  Private\r\n    FPattern: String;\r\n    FText: String;\r\n    FPatternOffset,\r\n    FLen,FPatternLen: Integer;\r\n    FPatternPos,FPos : Integer;\r\n    FY,FM,FD : Word;\r\n    FTimeval : TDateTime;\r\n    procedure ArrayMatchError;\r\n    procedure DoDateTime;\r\n    procedure SetPattern(AValue: String);\r\n    procedure SetText(AValue: String);\r\n    function ScanFixedInt(maxv:integer):integer;\r\n    function ScanPatternLength :integer;\r\n    procedure MatchChar(c:char);\r\n    function FindIMatch(const values :array of string; aTerm : string):integer;\r\n    function FindMatch(const Values : array of string):integer;\r\n    Procedure MatchPattern(const aPattern : String);\r\n    Procedure DoYear;\r\n    Procedure DoMonth;\r\n    Procedure DoDay;\r\n    Procedure DoTime;\r\n    Procedure DoAMPM;\r\n  Public\r\n    Function Scan(StartPos: integer = -1) : TDateTime;\r\n    property Pattern : String Read FPattern Write SetPattern;\r\n    Property Text : String Read FText Write SetText;\r\n    Property PatternOffset : Integer Read FPatternOffset;\r\n    Property Position: Integer read FPos;\r\n  end;\r\n\r\n  // Easy access function\r\nFunction ScanDateTime(APattern,AValue: String; APos : integer = 1) : TDateTime;\r\n\r\nimplementation\r\n\r\nuses js, rtlconsts;\r\n\r\nconst\r\n  TDateTimeEpsilon = 2.2204460493e-16;\r\n  HalfMilliSecond = OneMillisecond /2 ;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Simple trimming functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateOf(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=Trunc(AValue);\r\nend;\r\n\r\n\r\nFunction TimeOf(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=Frac(Avalue);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Identification functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction IsInLeapYear(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result:=IsLeapYear(YearOf(AValue));\r\nend;\r\n\r\n\r\nFunction IsPM(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result:=(HourOf(AValue)>=12);\r\nend;\r\n\r\n\r\nFunction IsValidMonth(AMonth : Word) : Boolean;\r\n\r\nbegin\r\n  Result:=(AMonth>=1) and (AMonth<=12);\r\nend;\r\n\r\nFunction IsValidDayOfWeek(ADayOfWeek : Word) : Boolean;\r\n\r\nbegin\r\n  Result:=(ADayOfWeek>=1) and (ADayOfWeek<=7);\r\nend;\r\n\r\nFunction IsValidWeekOfMonth(AWeekOfMonth : Word) : Boolean;\r\n\r\nbegin\r\n  Result:=(AWeekOfMonth>=1) and (AWeekOfMonth<=5);\r\nend;\r\n\r\nFunction IsValidDate(const AYear, AMonth, ADay: Word): Boolean;\r\nbegin\r\n  Result:=(AYear<>0) and (AYear<10000)\r\n          and IsValidMonth(AMonth)\r\n          and (ADay<>0) and (ADay<=MonthDays[IsleapYear(AYear),AMonth]);\r\nend;\r\n\r\n\r\nFunction IsValidTime(const AHour, AMinute, ASecond, AMilliSecond: Word): Boolean;\r\nbegin\r\n  Result:=(AHour=HoursPerDay) and (AMinute=0) and (ASecond=0) and (AMillisecond=0);\r\n  Result:=Result or\r\n          ((AHour<HoursPerDay) and (AMinute<MinsPerHour) and (ASecond<SecsPerMin) and\r\n           (AMillisecond<MSecsPerSec));\r\nend;\r\n\r\n\r\nFunction IsValidDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): Boolean;\r\nbegin\r\n  Result:=IsValidDate(AYear,AMonth,ADay) and\r\n          IsValidTime(AHour,AMinute,ASecond,AMillisecond)\r\nend;\r\n\r\n\r\nFunction IsValidDateDay(const AYear, ADayOfYear: Word): Boolean;\r\nbegin\r\n  Result:=(AYear<>0) and (ADayOfYear<>0) and (AYear<10000) and\r\n          (ADayOfYear<=DaysPerYear[IsLeapYear(AYear)]);\r\nend;\r\n\r\n\r\nFunction IsValidDateWeek(const AYear, AWeekOfYear, ADayOfWeek: Word): Boolean;\r\nbegin\r\n  Result:=(AYear<>0) and (AYear<10000)\r\n          and IsValidDayOfWeek(ADayOfWeek)\r\n          and (AWeekOfYear<>0)\r\n          and (AWeekOfYear<=WeeksInaYear(AYear));\r\n  { should we not also check whether the day of the week is not\r\n    larger than the last day of the last week in the year 9999 ?? }\r\nend;\r\n\r\n\r\nFunction IsValidDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word): Boolean;\r\n\r\nbegin\r\n  Result:=(AYear<>0) and (AYear<10000)\r\n          and IsValidMonth(AMonth)\r\n          and IsValidWeekOfMonth(AWeekOfMonth)\r\n          and IsValidDayOfWeek(ADayOfWeek);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Enumeration functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WeeksInYear(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=WeeksInAYear(YearOf(AValue));\r\nend;\r\n\r\n\r\nFunction WeeksInAYear(const AYear: Word): Word;\r\n\r\nVar\r\n  DOW : Word;\r\n\r\nbegin\r\n  Result:=52;\r\n  DOW:=DayOfTheWeek(StartOfAYear(AYear));\r\n  If (DOW=4) or ((DOW=3) and IsLeapYear(AYear)) then\r\n    Inc(Result);\r\nend;\r\n\r\n\r\nFunction DaysInYear(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=DaysPerYear[IsLeapYear(YearOf(AValue))];\r\nend;\r\n\r\n\r\nFunction DaysInAYear(const AYear: Word): Word;\r\nbegin\r\n  Result:=DaysPerYear[Isleapyear(AYear)];\r\nend;\r\n\r\n\r\nFunction DaysInMonth(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  Decodedate(AValue,Y,M,D);\r\n  Result:=MonthDays[IsLeapYear(Y),M];\r\nend;\r\n\r\n\r\nFunction DaysInAMonth(const AYear, AMonth: Word): Word;\r\nbegin\r\n  Result:=MonthDays[IsLeapYear(AYear),AMonth];\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Variations on current date/time.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction Today: TDateTime;\r\nbegin\r\n  Result:=Date();\r\nend;\r\n\r\n\r\nFunction Yesterday: TDateTime;\r\nbegin\r\n  Result:=Date()-1;\r\nend;\r\n\r\n\r\nFunction Tomorrow: TDateTime; \r\nbegin\r\n  Result:=Date()+1;\r\nend;\r\n\r\n\r\nFunction IsToday(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result:=IsSameDay(AValue,Date());\r\nend;\r\n\r\n\r\nFunction IsSameDay(const AValue, ABasis: TDateTime): Boolean;\r\n\r\nVar\r\n  D : TDateTime;\r\n\r\nbegin\r\n  D:=AValue-Trunc(ABasis);\r\n  Result:=(D>=0) and (D<1);\r\nend;\r\n\r\nfunction IsSameMonth(const Avalue, ABasis: TDateTime): Boolean;\r\nbegin\r\n     result:=( YearOf(Avalue) = YearOf(Abasis) );\r\n     result:=result and ( MonthOf(AValue) = MonthOf(ABasis) );\r\nend;\r\n\r\nconst\r\n  DOWMap: array [1..7] of Word = (7, 1, 2, 3, 4, 5, 6);\r\n\r\nFunction PreviousDayOfWeek (DayOfWeek : Word) : Word;\r\n\r\nbegin\r\n  If Not IsValidDayOfWeek(DayOfWeek) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidDayOfWeek,[DayOfWeek]);\r\n  Result:=DOWMap[DayOfWeek];\r\nend;\r\n\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Extraction functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction YearOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  D,M : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Result,D,M);\r\nend;\r\n\r\n\r\nFunction MonthOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,Result,D);\r\nend;\r\n\r\n\r\nFunction WeekOf(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=WeekOfTheYear(AValue);\r\nend;\r\n\r\n\r\nFunction DayOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,Result);\r\nend;\r\n\r\n\r\nFunction HourOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,Result,N,S,MS);\r\nend;\r\n\r\n\r\nFunction MinuteOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,Result,S,MS);\r\nend;\r\n\r\n\r\nFunction SecondOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,N,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,N,Result,MS);\r\nend;\r\n\r\n\r\nFunction MilliSecondOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,N,S : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,N,S,Result);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of year functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction StartOfTheYear(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=EncodeDate(YearOf(AValue),1,1);\r\nend;\r\n\r\n\r\nFunction EndOfTheYear(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=EncodeDateTime(YearOf(AValue),12,31,23,59,59,999);\r\nend;\r\n\r\n\r\nFunction StartOfAYear(const AYear: Word): TDateTime;\r\nbegin\r\n  Result:=EncodeDate(AYear,1,1);\r\nend;\r\n\r\n\r\nFunction EndOfAYear(const AYear: Word): TDateTime;\r\n\r\nbegin\r\n  Result:=(EncodeDateTime(AYear,12,31,23,59,59,999));\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of month functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheMonth(const AValue: TDateTime): TDateTime;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,D);\r\n  Result:=EncodeDate(Y,M,1);\r\n//  MonthDays[IsLeapYear(Y),M])\r\nend;\r\n\r\n\r\nFunction EndOfTheMonth(const AValue: TDateTime): TDateTime;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,D);\r\n  Result:=EncodeDateTime(Y,M,MonthDays[IsLeapYear(Y),M],23,59,59,999);\r\nend;\r\n\r\n\r\nFunction StartOfAMonth(const AYear, AMonth: Word): TDateTime;\r\nbegin\r\n  Result:=EncodeDate(AYear,AMonth,1);\r\nend;\r\n\r\n\r\nFunction EndOfAMonth(const AYear, AMonth: Word): TDateTime;\r\n\r\nbegin\r\n  Result:=EncodeDateTime(AYear,AMonth,MonthDays[IsLeapYear(AYear),AMonth],23,59,59,999);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of week functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction StartOfTheWeek(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=Trunc(AValue)-DayOfTheWeek(AValue)+1;\r\nend;\r\n\r\n\r\nFunction EndOfTheWeek(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=EndOfTheDay(AValue-DayOfTheWeek(AValue)+7);\r\nend;\r\n\r\n\r\nFunction StartOfAWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  Result:=EncodeDateWeek(AYear,AWeekOfYear,ADayOfWeek);\r\nend;\r\n\r\n\r\nFunction StartOfAWeek(const AYear, AWeekOfYear: Word): TDateTime;  // ADayOFWeek 1\r\nbegin\r\n  Result:=StartOfAWeek(AYear,AWeekOfYear,1)\r\nend;\r\n\r\n\r\nFunction EndOfAWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  Result := EndOfTheDay(EncodeDateWeek(AYear, AWeekOfYear, ADayOfWeek));\r\nend;\r\n\r\n\r\nFunction EndOfAWeek(const AYear, AWeekOfYear: Word): TDateTime; // const ADayOfWeek: Word = 7\r\n\r\n\r\nbegin\r\n  Result:=EndOfAWeek(AYear,AWeekOfYear,7);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of day functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheDay(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=Trunc(Avalue);\r\nend;\r\n\r\n\r\nFunction EndOfTheDay(const AValue: TDateTime): TDateTime;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,D);\r\n  Result:=EncodeDateTime(Y,M,D,23,59,59,999);\r\nend;\r\n\r\n\r\nFunction StartOfADay(const AYear, AMonth, ADay: Word): TDateTime;\r\nbegin\r\n  Result:=EncodeDate(AYear,AMonth,ADay);\r\nend;\r\n\r\n\r\nFunction StartOfADay(const AYear, ADayOfYear: Word): TDateTime;\r\nbegin\r\n  Result:=StartOfAYear(AYear)+ADayOfYear-1;\r\nend;\r\n\r\n\r\nFunction EndOfADay(const AYear, AMonth, ADay: Word): TDateTime;\r\nbegin\r\n  Result:=EndOfTheDay(EncodeDate(AYear,AMonth,ADay));\r\nend;\r\n\r\n\r\nFunction EndOfADay(const AYear, ADayOfYear: Word): TDateTime;\r\n\r\n\r\nbegin\r\n  Result:=StartOfAYear(AYear)+ADayOfYear-1+EncodeTime(23,59,59,999);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of year functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction MonthOfTheYear(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=MonthOf(AValue);\r\nend;\r\n\r\n\r\nFunction WeekOfTheYear(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,DOW : Word;\r\n\r\nbegin\r\n  DecodeDateWeek(AValue,Y,Result,DOW)\r\nend;\r\n\r\n\r\nFunction WeekOfTheYear(const AValue: TDateTime; out AYear: Word): Word;\r\n\r\nVar\r\n  DOW : Word;\r\n\r\nbegin\r\n  DecodeDateWeek(AValue,AYear,Result,DOW);\r\nend;\r\n\r\n\r\nFunction DayOfTheYear(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=Trunc(AValue-StartOfTheYear(AValue)+1);\r\nend;\r\n\r\n\r\nFunction HourOfTheYear(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=H+((DayOfTheYear(AValue)-1)*24);\r\nend;\r\n\r\n\r\nFunction MinuteOfTheYear(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=M+(H+((DayOfTheYear(AValue)-1)*24))*60;\r\nend;\r\n\r\n\r\nFunction SecondOfTheYear(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(M+(H+((DayOfTheYear(AValue)-1)*24))*60)*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheYear(const AValue: TDateTime): NativeLargeInt;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=((M+(H+((NativeLargeInt(DayOfTheYear(AValue))-1)*24))*60)*60+S)*1000+MS;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of month functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction WeekOfTheMonth(const AValue: TDateTime): Word;\r\n\r\nvar\r\n  Y,M,DOW : word;\r\n\r\nbegin\r\n  DecodeDateMonthWeek(AValue,Y,M,Result,DOW);\r\nend;\r\n\r\n\r\nFunction WeekOfTheMonth(const AValue: TDateTime; out AYear, AMonth: Word): Word;\r\n\r\nVar\r\n  DOW : Word;\r\n\r\nbegin\r\n  DecodeDateMonthWeek(AValue,AYear,AMonth,Result,DOW);\r\nend;\r\n\r\n\r\nFunction DayOfTheMonth(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,Result);\r\nend;\r\n\r\n\r\nFunction HourOfTheMonth(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Result:=(D-1)*24+H;\r\nend;\r\n\r\n\r\nFunction MinuteOfTheMonth(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Result:=((D-1)*24+H)*60+N;\r\nend;\r\n\r\n\r\nFunction SecondOfTheMonth(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Result:=(((D-1)*24+H)*60+N)*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheMonth(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Result:=((((D-1)*24+H)*60+N)*60+S)*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of week functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction DayOfTheWeek(const AValue: TDateTime): Word;\r\n\r\nbegin\r\n  Result:=DowMAP[DayOfWeek(AValue)];\r\nend;\r\n\r\n\r\nFunction HourOfTheWeek(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(DayOfTheWeek(AValue)-1)*24+H;\r\nend;\r\n\r\n\r\nFunction MinuteOfTheWeek(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=((DayOfTheWeek(AValue)-1)*24+H)*60+M;\r\nend;\r\n\r\n\r\nFunction SecondOfTheWeek(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(((DayOfTheWeek(AValue)-1)*24+H)*60+M)*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheWeek(const AValue: TDateTime): LongWord;\r\n\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=((((DayOfTheWeek(AValue)-1)*24+H)*60+M)*60+S)*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of day functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction HourOfTheDay(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=HourOf(AValue);\r\nend;\r\n\r\n\r\nFunction MinuteOfTheDay(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(H*60)+M;\r\nend;\r\n\r\n\r\nFunction SecondOfTheDay(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=((H*60)+M)*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheDay(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(((H*60)+M)*60+S)*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of hour functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction MinuteOfTheHour(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=MinuteOf(AValue);\r\nend;\r\n\r\n\r\nFunction SecondOfTheHour(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,S,M,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=M*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheHour(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,S,M,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(M*60+S)*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of minute functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction SecondOfTheMinute(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=SecondOf(AValue);\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheMinute(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,S,M,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=S*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of second functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction MilliSecondOfTheSecond(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=MilliSecondOf(AValue);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Range checking functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WithinPastYears(const ANow, AThen: TDateTime; const AYears: Integer): Boolean;\r\nbegin\r\n  Result:=YearsBetween(ANow,AThen)<=AYears;\r\nend;\r\n\r\n\r\nFunction WithinPastMonths(const ANow, AThen: TDateTime; const AMonths: Integer): Boolean;\r\nbegin\r\n  Result:=MonthsBetween(ANow,AThen)<=AMonths;\r\nend;\r\n\r\n\r\nFunction WithinPastWeeks(const ANow, AThen: TDateTime; const AWeeks: Integer): Boolean;\r\nbegin\r\n  Result:=WeeksBetween(ANow,AThen)<=AWeeks;\r\nend;\r\n\r\n\r\nFunction WithinPastDays(const ANow, AThen: TDateTime; const ADays: Integer): Boolean;\r\nbegin\r\n  Result:=DaysBetween(ANow,AThen)<=ADays;\r\nend;\r\n\r\n\r\nFunction WithinPastHours(const ANow, AThen: TDateTime; const AHours: NativeLargeInt): Boolean;\r\nbegin\r\n  Result:=HoursBetween(ANow,AThen)<=AHours;\r\nend;\r\n\r\n\r\nFunction WithinPastMinutes(const ANow, AThen: TDateTime; const AMinutes: NativeLargeInt): Boolean;\r\nbegin\r\n  Result:=MinutesBetween(ANow,AThen)<=AMinutes;\r\nend;\r\n\r\n\r\nFunction WithinPastSeconds(const ANow, AThen: TDateTime; const ASeconds: NativeLargeInt): Boolean;\r\nbegin\r\n  Result:=SecondsBetween(ANow,Athen)<=ASeconds;\r\nend;\r\n\r\n\r\nFunction WithinPastMilliSeconds(const ANow, AThen: TDateTime; const AMilliSeconds: NativeLargeInt): Boolean;\r\nbegin\r\n  Result:=MilliSecondsBetween(ANow,AThen)<=AMilliSeconds;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Period functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n{\r\n  These functions are declared as approximate by Borland.\r\n  A bit strange, since it can be calculated exactly ?\r\n\r\n  -- No, because you need rounding or truncating (JM)\r\n}\r\n\r\n\r\nFunction DateTimeDiff(const ANow, AThen: TDateTime): TDateTime;\r\nbegin\r\n  Result:= ANow - AThen;\r\n  if (ANow>0) and (AThen<0) then\r\n    Result:=Result-0.5\r\n  else if (ANow<-1.0) and (AThen>-1.0) then\r\n    Result:=Result+0.5;\r\nend;\r\n\r\n\r\nFunction YearsBetween(const ANow, AThen: TDateTime; AExact : Boolean = False): Integer;\r\n\r\nvar\r\n  yy, mm, dd: Word;\r\n  \r\nbegin\r\n  if AExact and (ANow >= -DateDelta) and (AThen >= -DateDelta) and\r\n     (ANow <= MaxDateTime) and (AThen <= MaxDateTime) then\r\n    begin\r\n    PeriodBetween(ANow, AThen, yy , mm, dd);\r\n    Result := yy;\r\n    end\r\n  else\r\n    Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)/ApproxDaysPerYear);\r\nend;\r\n\r\n\r\nFunction MonthsBetween(const ANow, AThen: TDateTime; AExact : Boolean = False): Integer;\r\n\r\nvar\r\n  y, m, d: Word;\r\n\r\nbegin\r\n  if AExact and (ANow >= -DateDelta) and (AThen >= -DateDelta) and\r\n     (ANow <= MaxDateTime) and (AThen <= MaxDateTime) then\r\n    begin\r\n    PeriodBetween(ANow, AThen, y, m, d);\r\n    Result := y*12 + m;\r\n    end\r\n  else\r\n    Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)/ApproxDaysPerMonth);\r\nend;\r\n\r\n\r\nFunction WeeksBetween(const ANow, AThen: TDateTime): Integer;\r\nbegin\r\n  Result:=Trunc(Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond) div 7;\r\nend;\r\n\r\n\r\nFunction DaysBetween(const ANow, AThen: TDateTime): Integer;\r\nbegin\r\n  Result:=Trunc(Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond);\r\nend;\r\n\r\n\r\nFunction HoursBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nbegin\r\n  Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)*HoursPerDay);\r\nend;\r\n\r\n\r\nFunction MinutesBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nbegin\r\n  Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)*MinsPerDay);\r\nend;\r\n\r\n\r\nFunction SecondsBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nbegin\r\n  Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)*SecsPerDay);\r\nend;\r\n\r\n\r\nFunction MilliSecondsBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nbegin\r\n  Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)*MSecsPerDay);\r\nend;\r\n\r\nProcedure PeriodBetween(Const ANow, AThen: TDateTime; Out Years, months, days : Word); \r\n\r\nvar\r\n  Y1, Y2, M1, M2, D1, D2: word;\r\n\r\nbegin\r\n  if (AThen>ANow) then\r\n    begin\r\n    DecodeDate(ANow,Y1,M1,D1);\r\n    DecodeDate(AThen,Y2,M2,D2);\r\n    end\r\n  else\r\n    begin  \r\n    DecodeDate(AThen,Y1,M1,D1);\r\n    DecodeDate(ANow,Y2,M2,D2);\r\n    end;\r\n  Years:=Y2-Y1;\r\n  if (M1>M2) or ((M1=M2) and (D1>D2)) then Dec(Years);\r\n  if (M1>M2) then Inc(M2,12); //already adjusted Years in that case\r\n  Months:=M2-M1;\r\n  if (D2>=D1) then\r\n    Days:=D2-D1\r\n  else\r\n    begin\r\n    if (Months=0) then\r\n      Months:=11\r\n    else\r\n      Dec(Months);\r\n    Days:=(DaysInAMonth(Y1,M1)-D1)+D2;\r\n    end;\r\nend;                    \r\n\r\n{ ---------------------------------------------------------------------\r\n    Timespan in xxx functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction YearSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))/ApproxDaysPerYear;\r\nend;\r\n\r\n\r\nFunction MonthSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))/ApproxDaysPerMonth;\r\nend;\r\n\r\n\r\nFunction WeekSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen)) / 7\r\nend;\r\n\r\n\r\nFunction DaySpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen));\r\nend;\r\n\r\n\r\nFunction HourSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))*HoursPerDay;\r\nend;\r\n\r\n\r\nFunction MinuteSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))*MinsPerDay;\r\nend;\r\n\r\n\r\nFunction SecondSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))*SecsPerDay;\r\nend;\r\n\r\n\r\nFunction MilliSecondSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))*MSecsPerDay;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Increment/decrement functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n{ TDateTime is not defined in the interval [-1.0..0.0[. Additionally, when\r\n  negative the time part must be treated using its absolute value (0.25 always\r\n  means \"6 a.m.\") -> skip the gap and convert the time part when crossing the\r\n  gap -- and take care of rounding errors }\r\nProcedure MaybeSkipTimeWarp(OldDate: TDateTime; var NewDate: TDateTime);\r\nbegin\r\n  if (OldDate>=0) and (NewDate<-TDateTimeEpsilon) then\r\n    NewDate:=int(NewDate-1.0+TDateTimeEpsilon)-frac(1.0+frac(NewDate))\r\n  else if (OldDate<=-1.0) and (NewDate>-1.0+TDateTimeEpsilon) then\r\n    NewDate:=int(NewDate+1.0-TDateTimeEpsilon)+frac(1.0-abs(frac(1.0+NewDate)));\r\nend;\r\n\r\n\r\nfunction IncNegativeTime(AValue, Addend: TDateTime): TDateTime;\r\nvar\r\n  newtime: tdatetime;\r\nbegin\r\n  newtime:=-frac(Avalue)+frac(Addend);\r\n  { handle rounding errors }\r\n  if SameValue(newtime,int(newtime)+1,TDateTimeEpsilon) then\r\n    newtime:=int(newtime)+1\r\n  else if SameValue(newtime,int(newtime),TDateTimeEpsilon) then\r\n    newtime:=int(newtime);\r\n  { time underflow -> previous day }\r\n  if newtime<-TDateTimeEpsilon then\r\n    begin\r\n      newtime:=1.0+newtime;\r\n      avalue:=int(avalue)-1;\r\n    end\r\n  { time overflow -> next day }\r\n  else if newtime>=1.0-TDateTimeEpsilon then\r\n    begin\r\n      newtime:=newtime-1.0;\r\n      avalue:=int(avalue)+1;\r\n    end;\r\n  Result:=int(AValue)+int(Addend)-newtime;\r\nend;\r\n\r\nFunction IncYear(const AValue: TDateTime; const ANumberOfYears: Integer ): TDateTime;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Y:=Y+ANumberOfYears;\r\n  If (M=2) and (D=29) And (Not IsLeapYear(Y)) then\r\n    D:=28;\r\n  Result:=EncodeDateTime(Y,M,D,H,N,S,MS);\r\nend;\r\n\r\n\r\nFunction IncYear(const AValue: TDateTime): TDateTime; // ; const ANumberOfYears: Integer = 1)\r\nbegin\r\n  Result:=IncYear(Avalue,1);\r\nend;\r\n\r\n\r\nFunction IncWeek(const AValue: TDateTime; const ANumberOfWeeks: Integer): TDateTime;\r\nbegin\r\n  Result:=AValue+ANumberOfWeeks*7;\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncWeek(const AValue: TDateTime): TDateTime; // ; const ANumberOfWeeks: Integer = 1)\r\nbegin\r\n  Result:=IncWeek(Avalue,1);\r\nend;\r\n\r\n\r\nFunction IncDay(const AValue: TDateTime; const ANumberOfDays: Integer): TDateTime;\r\nbegin\r\n  Result:=AValue+ANumberOfDays;\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncDay(const AValue: TDateTime): TDateTime; //; const ANumberOfDays: Integer = 1)\r\nbegin\r\n  Result:=IncDay(Avalue,1);\r\nend;\r\n\r\n\r\nFunction IncHour(const AValue: TDateTime; const ANumberOfHours: NativeLargeInt): TDateTime;\r\nbegin\r\n  if AValue>=0 then\r\n    Result:=AValue+ANumberOfHours/HoursPerDay\r\n  else\r\n    Result:=IncNegativeTime(Avalue,ANumberOfHours/HoursPerDay);\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncHour(const AValue: TDateTime): TDateTime; //; const ANumberOfHours: NativeLargeInt = 1\r\nbegin\r\n  Result:=IncHour(AValue,1);\r\nend;\r\n\r\n\r\nFunction IncMinute(const AValue: TDateTime; const ANumberOfMinutes: NativeLargeInt): TDateTime;\r\nbegin\r\n  if AValue>=0 then\r\n    Result:=AValue+ANumberOfMinutes/MinsPerDay\r\n  else\r\n    Result:=IncNegativeTime(Avalue,ANumberOfMinutes/MinsPerDay);\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncMinute(const AValue: TDateTime): TDateTime; // ; const ANumberOfMinutes: NativeLargeInt = 1\r\nbegin\r\n  Result:=IncMinute(AValue,1);\r\nend;\r\n\r\n\r\nFunction IncSecond(const AValue: TDateTime; const ANumberOfSeconds: NativeLargeInt): TDateTime;\r\nbegin\r\n  if AValue>=0 then\r\n    Result:=AValue+ANumberOfSeconds/SecsPerDay\r\n  else\r\n    Result:=IncNegativeTime(Avalue,ANumberOfSeconds/SecsPerDay);\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncSecond(const AValue: TDateTime): TDateTime; // ; const ANumberOfSeconds: NativeLargeInt = 1\r\nbegin\r\n  Result:=IncSecond(Avalue,1);\r\nend;\r\n\r\n\r\nFunction IncMilliSecond(const AValue: TDateTime; const ANumberOfMilliSeconds: NativeLargeInt): TDateTime;\r\nbegin\r\n  if Avalue>=0 then\r\n    Result:=AValue+ANumberOfMilliSeconds/MSecsPerDay\r\n  else\r\n    Result:=IncNegativeTime(Avalue,ANumberOfMilliSeconds/MSecsPerDay);\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncMilliSecond(const AValue: TDateTime): TDateTime; // ; const ANumberOfMilliSeconds: NativeLargeInt = 1\r\nbegin\r\n  Result:=IncMilliSecond(AValue,1);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/Decode of complete timestamp\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction EncodeDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDateTime(AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond,Result) then\r\n    InvalidDateTimeError(AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond)\r\nend;\r\n\r\n\r\nProcedure DecodeDateTime(const AValue: TDateTime; out AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word);\r\nbegin\r\n  DecodeTime(AValue,AHour,AMinute,ASecond,AMilliSecond);\r\n  if AHour=24 then // can happen due rounding issues mantis 17123\r\n    begin\r\n      AHour:=0; // rest is already zero\r\n      DecodeDate(round(AValue),AYear,AMonth,ADay);\r\n    end\r\n  else\r\n    DecodeDate(AValue,AYear,AMonth,ADay);\r\nend;\r\n\r\n\r\nFunction TryEncodeDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; out AValue: TDateTime): Boolean;\r\n\r\nVar\r\n tmp : TDateTime;\r\n\r\nbegin\r\n  Result:=TryEncodeDate(AYear,AMonth,ADay,AValue);\r\n  Result:=Result and TryEncodeTime(AHour,AMinute,ASecond,Amillisecond,Tmp);\r\n  If Result then\r\n    Avalue:=ComposeDateTime(AValue,Tmp);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying week of year and day of week\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDateWeek(AYear,AWeekOfYear,Result,ADayOfWeek) then\r\n    InvalidDateWeekError(AYear,AWeekOfYear,ADayOfWeek);\r\nend;\r\n\r\n\r\nFunction EncodeDateWeek(const AYear, AWeekOfYear: Word): TDateTime; //; const ADayOfWeek: Word = 1\r\nbegin\r\n  Result := EncodeDateWeek(AYear,AWeekOfYear,1);\r\nend;\r\n\r\n\r\nProcedure DecodeDateWeek(const AValue: TDateTime; out AYear, AWeekOfYear, ADayOfWeek: Word);\r\n\r\nvar\r\n  DOY : Integer;\r\n  D: Word;\r\n  YS : TDateTime;\r\n  YSDOW, YEDOW: Word;\r\n\r\nbegin\r\n  AYear:=YearOf(AValue);\r\n  // Correct to ISO DOW\r\n  ADayOfWeek:=DayOfWeek(AValue)-1;\r\n  If ADAyOfWeek=0 then\r\n    ADayofweek:=7;\r\n  YS:=StartOfAYear(AYear);\r\n  DOY:=Trunc(AValue-YS)+1;\r\n  YSDOW:=DayOfTheWeek(YS);\r\n  // Correct week if later than wednesday. First week never starts later than wednesday\r\n  if (YSDOW<5) then\r\n    Inc(DOY,YSDOW-1)\r\n  else\r\n    Dec(DOY,8-YSDOW);\r\n  if (DOY<=0) then // Day is in last week of previous year.\r\n    DecodeDateWeek(YS-1,AYear,AWeekOfYear,D)\r\n  else\r\n    begin\r\n    AWeekOfYear:=DOY div 7;\r\n    if ((DOY mod 7)<>0) then\r\n      Inc(AWeekOfYear);\r\n    if (AWeekOfYear>52) then // Maybe in first week of next year ?\r\n      begin\r\n      YEDOW:=YSDOW;\r\n      if IsLeapYear(AYear) then\r\n        begin\r\n        Inc(YEDOW);\r\n        if (YEDOW>7) then\r\n          YEDOW:=1;\r\n        end;\r\n      if (YEDOW<4) then // Really next year.\r\n        begin\r\n        Inc(AYear);\r\n        AWeekOfYear:=1;\r\n        end;\r\n      end;\r\n  end;\r\nend;\r\n\r\n\r\n\r\nFunction TryEncodeDateWeek(const AYear, AWeekOfYear: Word; out AValue: TDateTime; const ADayOfWeek: Word): Boolean;\r\n\r\nVar\r\n  DOW : Word;\r\n  Rest : Integer;\r\n\r\nbegin\r\n  Result:=IsValidDateWeek(Ayear,AWeekOfYear,ADayOfWeek);\r\n  If Result then\r\n    begin\r\n    AValue:=EncodeDate(AYear,1,1)+(7*(AWeekOfYear-1));\r\n    DOW:=DayOfTheWeek(AValue);\r\n    Rest:=ADayOfWeek-DOW;\r\n    If (DOW>4) then\r\n      Inc(Rest,7);\r\n    AValue:=AValue+Rest;\r\n    end;\r\nend;\r\n\r\n\r\nFunction TryEncodeDateWeek(const AYear, AWeekOfYear: Word; out AValue: TDateTime): Boolean; //; const ADayOfWeek: Word = 1\r\nbegin\r\n  Result:=TryEncodeDateWeek(AYear,AWeekOfYear,AValue,1);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying day of year\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateDay(const AYear, ADayOfYear: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDateDay(AYear,ADayOfYear,Result) then\r\n    InvalidDateDayError(AYear,ADayOfYear);\r\nend;\r\n\r\n\r\nProcedure DecodeDateDay(const AValue: TDateTime; out AYear, ADayOfYear: Word);\r\n\r\nVar\r\n  M,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,AYear,M,D);\r\n  ADayOfyear:=Trunc(AValue-EncodeDate(AYear,1,1))+1;\r\nend;\r\n\r\n\r\nFunction TryEncodeDateDay(const AYear, ADayOfYear: Word; out AValue: TDateTime): Boolean;\r\nbegin\r\n  Result:=(ADayOfYear<>0) and (ADayOfYear<=DaysPerYear [IsleapYear(AYear)]);\r\n  If Result then\r\n    AValue:=EncodeDate(AYear,1,1)+ADayOfYear-1;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying week of month\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction EncodeDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDateMonthWeek(Ayear,AMonth,AWeekOfMonth,ADayOfWeek,Result) then\r\n    InvalidDateMonthWeekError(AYear,AMonth,AWeekOfMonth,ADayOfWeek);\r\nend;\r\n\r\nProcedure DecodeDateMonthWeek(const AValue: TDateTime; out AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word);\r\n\r\nVar\r\n  D,SDOM,EDOM : Word;\r\n  SOM : TdateTime;\r\n  DOM : Integer;\r\nbegin\r\n  DecodeDate(AValue,AYear,AMonth,D);\r\n  ADayOfWeek:=DayOfTheWeek(AValue);\r\n  SOM:=EncodeDate(Ayear,Amonth,1);\r\n  SDOM:=DayOfTheWeek(SOM);\r\n  DOM:=D-1+SDOM;\r\n  If SDOM>4 then\r\n    Dec(DOM,7);\r\n  // Too early in the month. First full week is next week, day is after thursday.\r\n  If DOM<=0 Then\r\n    DecodeDateMonthWeek(SOM-1,AYear,AMonth,AWeekOfMonth,D)\r\n  else\r\n    begin\r\n    AWeekOfMonth:=(DOM div 7);\r\n    if (DOM mod 7)<>0 then\r\n      Inc(AWeekOfMonth);\r\n    EDOM:=DayOfTheWeek(EndOfAMonth(Ayear,AMonth));\r\n    // In last days of last long week, so in next month...\r\n    If (EDOM<4) and ((DaysInAMonth(AYear,Amonth)-D)<EDOM) then\r\n      begin\r\n      AWeekOfMonth:=1;\r\n      Inc(AMonth);\r\n      If (AMonth=13) then\r\n        begin\r\n        AMonth:=1;\r\n        Inc(AYear);\r\n        end;\r\n      end;\r\n    end;\r\nend;\r\n\r\nFunction TryEncodeDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word; out AValue: TDateTime): Boolean;\r\n\r\nvar\r\n  S : Word;\r\n  DOM : Integer;\r\n\r\nbegin\r\n  Result:=IsValidDateMonthWeek(AYear,AMonth,AWeekOfMonth,ADayOfWeek);\r\n  if Result then\r\n    begin\r\n    AValue:=EncodeDate(AYear,AMonth,1);\r\n    DOM:=(AWeekOfMonth-1)*7+ADayOfWeek-1;\r\n    { Correct for first week in last month.}\r\n    S:=DayOfTheWeek(AValue);\r\n    Dec(DOM,S-1);\r\n    if (S=DayFriday) or (S=DaySaturday) or (S=DaySunday) then\r\n      Inc(DOM,7);\r\n    AValue:=AValue+DOM;\r\n    end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode time interval, allowing hours>24\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TryEncodeTimeInterval(Hour, Min, Sec, MSec: word; out Time: TDateTime): boolean;\r\nbegin\r\n Result:= (Min<60) and (Sec<60) and (MSec<1000);\r\n If Result then\r\n   Time:=TDateTime(cardinal(Hour)*3600000+cardinal(Min)*60000+cardinal(Sec)*1000+MSec)/MSecsPerDay;\r\nend;\r\n\r\nfunction EncodeTimeInterval(Hour, Minute, Second, MilliSecond: word): TDateTime;\r\nbegin\r\n   If not TryEncodeTimeInterval(Hour,Minute,Second,MilliSecond,Result) then\r\n     Raise EConvertError.CreateFmt(SerrInvalidHourMinuteSecMsec,\r\n                               [Hour,Minute,Second,MilliSecond]);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Replace given element with supplied value.\r\n  ---------------------------------------------------------------------}\r\n\r\nConst\r\n  LFAI = RecodeLeaveFieldAsIS; // Less typing, readable code\r\n{\r\n  Note: We have little choice but to implement it like Borland did:\r\n  If AValue contains some 'wrong' value, it will throw an error.\r\n  To simulate this we'd have to check in each function whether\r\n  both arguments are correct. To avoid it, all is routed through\r\n  the 'central' RecodeDateTime function as in Borland's implementation.\r\n}\r\n\r\nFunction RecodeYear(const AValue: TDateTime; const AYear: Word): TDateTime;\r\n\r\nbegin\r\n  Result := RecodeDateTime(AValue,AYear,LFAI,LFAI,LFAI,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeMonth(const AValue: TDateTime; const AMonth: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,AMonth,LFAI,LFAI,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeDay(const AValue: TDateTime; const ADay: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,ADay,LFAI,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeHour(const AValue: TDateTime; const AHour: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,AHour,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeMinute(const AValue: TDateTime; const AMinute: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,LFAI,AMinute,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeSecond(const AValue: TDateTime; const ASecond: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,LFAI,LFAI,ASecond,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeMilliSecond(const AValue: TDateTime; const AMilliSecond: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,LFAI,LFAI,LFAI,AMilliSecond);\r\nend;\r\n\r\n\r\nFunction RecodeDate(const AValue: TDateTime; const AYear, AMonth, ADay: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,AYear,AMonth,ADay,LFAI,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeTime(const AValue: TDateTime; const AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,AHour,AMinute,ASecond,AMilliSecond);\r\nend;\r\n\r\n\r\nFunction RecodeDateTime(const AValue: TDateTime; const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nbegin\r\n  If Not TryRecodeDateTime(AValue,AYear,AMonth,ADay,AHour,AMinute,ASecond,AMilliSecond,Result) then\r\n    InvalidDateTimeError(AYear,AMonth,ADay,AHour,AMinute,ASecond,AMilliSecond,AValue);\r\nend;\r\n\r\n\r\nFunction TryRecodeDateTime(const AValue: TDateTime; const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; out AResult: TDateTime): Boolean;\r\n\r\n  Procedure FV (var AV{%H-} : Word; Arg : Word);\r\n\r\n  begin\r\n    If (Arg<>LFAI) then\r\n      AV:=Arg;\r\n  end;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  FV(Y,AYear);\r\n  FV(M,AMonth);\r\n  FV(D,ADay);\r\n  FV(H,AHour);\r\n  FV(N,AMinute);\r\n  FV(S,ASecond);\r\n  FV(MS,AMillisecond);\r\n  Result:=TryEncodeDateTime(Y,M,D,H,N,S,MS,AResult);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Comparision of date/time\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction CompareDateTime(const A, B: TDateTime): TValueRelationship;\r\nbegin\r\n  If SameDateTime(A,B) then\r\n    Result:=EqualsValue\r\n  else if trunc(a)=trunc(b) then\r\n    begin\r\n    if abs(frac(a))>abs(frac(b)) then \r\n      result:=GreaterThanValue\r\n    else \r\n      result:=LessThanValue;\r\n    end \r\n  else \r\n    begin\r\n    if a>b then \r\n      result:=GreaterThanValue\r\n    else \r\n      result:=LessThanValue;\r\n    end;\r\nend;\r\n\r\n\r\nFunction CompareDate(const A, B: TDateTime): TValueRelationship;\r\nbegin\r\n  If SameDate(A,B) then\r\n    Result:=EQualsValue\r\n  else if A<B then\r\n    Result:=LessThanValue\r\n  else\r\n    Result:=GreaterThanValue;\r\nend;\r\n\r\n\r\nFunction CompareTime(const A, B: TDateTime): TValueRelationship;\r\n\r\nbegin\r\n  If SameTime(A,B) then\r\n    Result:=EQualsValue\r\n  else If Frac(A)<Frac(B) then\r\n    Result:=LessThanValue\r\n  else\r\n    Result:=GreaterThanValue;\r\nend;\r\n\r\n\r\nFunction SameDateTime(const A, B: TDateTime): Boolean;\r\nbegin\r\n  Result:=Abs(A-B)<OneMilliSecond;\r\nend;\r\n\r\n\r\nFunction SameDate(const A, B: TDateTime): Boolean;\r\nbegin\r\n  Result:=Trunc(A)=Trunc(B);\r\nend;\r\n\r\n\r\nFunction SameTime(const A, B: TDateTime): Boolean;\r\n\r\nbegin\r\n  Result:=Frac(Abs(A-B))<OneMilliSecond;\r\nend;\r\n\r\n\r\nFunction InternalNthDayOfWeek(DoM : Word) : Word;\r\n\r\nbegin\r\n  Result:=(Dom-1) div 7 +1;\r\nend;\r\n\r\nFunction NthDayOfWeek(const AValue: TDateTime): Word;\r\n\r\nbegin\r\n  Result:=InternalNthDayOfWeek(DayOfTheMonth(AValue));\r\nend;\r\n\r\n\r\nProcedure DecodeDayOfWeekInMonth(const AValue: TDateTime; out AYear, AMonth, ANthDayOfWeek, ADayOfWeek: Word);\r\n\r\nvar\r\n  D: Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,AYear,AMonth,D);\r\n  ADayOfWeek:=DayOfTheWeek(AValue);\r\n  ANthDayOfWeek:=InternalNthDayOfWeek(D);\r\nend;\r\n\r\n\r\nFunction EncodeDayOfWeekInMonth(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDayOfWeekInMonth(AYear,AMonth,ANthDayOfWeek,ADayOfWeek,Result) then\r\n    InvalidDayOfWeekInMonthError(AYear,AMonth,ANthDayOfWeek,ADayOfWeek);\r\nend;\r\n\r\n\r\nFunction TryEncodeDayOfWeekInMonth(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word; out AValue: TDateTime): Boolean;\r\n\r\nVar\r\n  SOM,D : Word;\r\n\r\nbegin\r\n  SOM:=DayOfTheWeek(EncodeDate(Ayear,AMonth,1));\r\n  D:=1+ADayOfWeek-SOM+7*(ANthDayOfWeek-1);\r\n  If SOM>ADayOfWeek then\r\n    D:=D+7; // Clearer would have been Inc(ANthDayOfweek) but it's a const\r\n  Result:=TryEncodeDate(Ayear,AMonth,D,AValue);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Exception throwing routines\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\n\r\nProcedure InvalidDateTimeError(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; const ABaseDate: TDateTime);\r\n\r\n  Function DoField(Arg,Def : Word; Unknown: String) : String;\r\n\r\n  begin\r\n    if Def=0 then ;\r\n    If (Arg<>LFAI) then\r\n      Result:=Format('%.*d',[Length(Unknown),Arg])\r\n    else if (ABaseDate=0) then\r\n      Result:=Unknown\r\n    else\r\n      Result:=Format('%.*d',[Length(Unknown),Arg]);\r\n  end;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n  Msg : String;\r\n\r\nbegin\r\n  DecodeDateTime(ABasedate,Y,M,D,H,N,S,MS);\r\n  Msg:=DoField(AYear,Y,'????');\r\n  Msg:=Msg+DateSeparator+DoField(AMonth,M,'??');\r\n  Msg:=Msg+DateSeparator+DoField(ADay,D,'??');\r\n  Msg:=Msg+' '+DoField(AHour,H,'??');\r\n  Msg:=Msg+TimeSeparator+DoField(AMinute,N,'??');\r\n  Msg:=Msg+TimeSeparator+Dofield(ASecond,S,'??');\r\n  Msg:=Msg+DecimalSeparator+DoField(AMilliSecond,MS,'???');\r\n  Raise EConvertError.CreateFmt(SErrInvalidTimeStamp,[Msg]);\r\nend;\r\n\r\n\r\nProcedure InvalidDateTimeError(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word); // const ABaseDate: TDateTime = 0\r\nbegin\r\n  InvalidDateTimeError(AYear,AMonth,ADay,AHour,AMinute,ASecond,AMilliSecond,0);\r\nend;\r\n\r\n\r\nProcedure InvalidDateWeekError(const AYear, AWeekOfYear, ADayOfWeek: Word);\r\nbegin\r\n  Raise EConvertError.CreateFmt(SErrInvalidDateWeek,[AYear,AWeekOfYear,ADayOfWeek]);\r\nend;\r\n\r\n\r\nProcedure InvalidDateDayError(const AYear, ADayOfYear: Word);\r\nbegin\r\n  Raise EConvertError.CreateFmt(SErrInvalidDayOfYear,[AYear,ADayOfYear]);\r\nend;\r\n\r\n\r\nProcedure InvalidDateMonthWeekError(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word);\r\nbegin\r\n  Raise EConvertError.CreateFmt(SErrInvalidDateMonthWeek,[Ayear,AMonth,AWeekOfMonth,ADayOfWeek]);\r\nend;\r\n\r\n\r\nProcedure InvalidDayOfWeekInMonthError(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word);\r\n\r\nbegin\r\n  Raise EConvertError.CreateFmt(SErrInvalidDayOfWeekInMonth,[AYear,AMonth,ANthDayOfWeek,ADayOfWeek]);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Julian and Modified Julian Date conversion support\r\n  ---------------------------------------------------------------------}\r\n\r\n{$push}\r\n{$R-}\r\n{$Q-}\r\n\r\nFunction DateTimeToJulianDate(const AValue: TDateTime): Double;\r\nvar\r\n  day,month,year: word;\r\n  a,y,m: longint;\r\nbegin\r\n  DecodeDate ( AValue, year, month, day );\r\n  a := (14-month) div 12;\r\n  y := year + 4800 - a;\r\n  m := month + (12*a) - 3;\r\n  result := day + ((153*m+2) div 5) + (365*y)\r\n    + (y div 4) - (y div 100) + (y div 400) - 32045.5 + frac(avalue);\r\nend;\r\n\r\n\r\nFunction JulianDateToDateTime(const AValue: Double): TDateTime;\r\nbegin\r\n  if not TryJulianDateToDateTime(AValue, Result) then\r\n    raise EConvertError.CreateFmt(SInvalidJulianDate, [AValue]);\r\nend;\r\n\r\n\r\nFunction TryJulianDateToDateTime(const AValue: Double; out ADateTime: TDateTime): Boolean;\r\nvar\r\n  a,b,c,d,e,m:longint;\r\n  day,month,year: word;\r\nbegin\r\n  a := trunc(AValue + 32044.5);\r\n  b := (4*a + 3) div 146097;\r\n  c := a - (146097*b div 4);\r\n  d := (4*c + 3) div 1461;\r\n  e := c - (1461*d div 4);\r\n  m := (5*e+2) div 153;\r\n  day := e - ((153*m + 2) div 5) + 1;\r\n  month := m + 3 - 12 *  ( m div 10 );\r\n  year := (100*b) + d - 4800 + ( m div 10 );\r\n  result := TryEncodeDate ( Year, Month, Day, ADateTime );\r\n  if Result then\r\n//    ADateTime:=IncMilliSecond(IncHour(ADateTime,-12),MillisecondOfTheDay(Abs(Frac(aValue))));\r\n    ADateTime:=ADateTime+frac(AValue-0.5);\r\nend;\r\n\r\nFunction DateTimeToModifiedJulianDate(const AValue: TDateTime): Double;\r\nbegin\r\n  result := DateTimeToJulianDate(AValue) - 2400000.5;\r\nend;\r\n\r\n\r\nFunction ModifiedJulianDateToDateTime(const AValue: Double): TDateTime;\r\nbegin\r\n  result := JulianDateToDateTime(AValue + 2400000.5);\r\nend;\r\n\r\n\r\nFunction TryModifiedJulianDateToDateTime(const AValue: Double; out ADateTime: TDateTime): Boolean;\r\nbegin\r\n  Result:=TryJulianDateToDateTime(AValue + 2400000.5, ADateTime);\r\nend;\r\n\r\n{$pop}//{$R-}{$Q-} for Julian conversion functions\r\n\r\n{ ---------------------------------------------------------------------\r\n    Unix timestamp support.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToUnix(const AValue: TDateTime): NativeLargeInt;\r\n\r\nbegin\r\n  Result:=Round(DateTimeDiff(RecodeMillisecond(AValue,0),UnixEpoch)*SecsPerDay);\r\nend;\r\n\r\n\r\nFunction UnixToDateTime(const AValue: NativeLargeInt): TDateTime;\r\nbegin\r\n  Result:=IncSecond(UnixEpoch, AValue);\r\nend;\r\n\r\n\r\nFunction UnixTimeStampToMac(const AValue: NativeLargeInt): NativeLargeInt;\r\nconst\r\n  Epoch=24107 * 24 * 3600;\r\nbegin\r\n  Result:=AValue + Epoch;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Mac timestamp support.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToMac(const AValue: TDateTime): NativeLargeInt;\r\nvar\r\n  Epoch:TDateTime;\r\nbegin\r\n  Epoch:=EncodeDateTime( 1904, 1, 1, 0, 0, 0, 0 );\r\n  Result:=SecondsBetween( Epoch, AValue );\r\nend;\r\n\r\n\r\nFunction MacToDateTime(const AValue: NativeLargeInt): TDateTime;\r\nvar\r\n  Epoch:TDateTime;\r\nbegin\r\n  Epoch:=EncodeDateTime( 1904, 1, 1, 0, 0, 0, 0 );\r\n  Result:=IncSecond( Epoch, AValue );\r\nend;\r\n\r\n\r\nFunction MacTimeStampToUnix(const AValue: NativeLargeInt): NativeLargeInt;\r\nconst\r\n  Epoch=24107 * 24 * 3600;\r\nbegin\r\n  Result:=AValue - Epoch;\r\nend;\r\n\r\nFunction DateTimeToDosDateTime(const AValue: TDateTime): longint;\r\nvar year,month,day,hour,min,sec,msec : word;\r\n    zs : longint;\r\nbegin\r\n  decodedatetime(avalue,year,month,day,hour,min,sec,msec);\r\n  result:=-1980;\r\n  result:=result+year and 127;\r\n  result:=result shl 4;\r\n  result:=result+month;\r\n  result:=result shl 5;\r\n  result:=result+day;\r\n  result:=result shl 16;\r\n  zs:=hour;\r\n  zs:=zs shl 6;\r\n  zs:=zs+min;\r\n  zs:=zs shl 5;\r\n  zs:=zs+sec div 2;\r\n  result:=result+(zs and $ffff);\r\nend;\r\n\r\nFunction DosDateTimeToDateTime( AValue: longint): TDateTime;\r\nvar year,month,day,hour,min,sec : integer;\r\nbegin\r\n  sec:=(AValue and 31) * 2;\r\n  avalue:=AValue shr 5;\r\n  min:=AValue and 63;\r\n  avalue:=AValue shr 6;\r\n  hour:=AValue and 31;\r\n  avalue:=AValue shr 5;\r\n  day:=AValue and 31;\r\n  avalue:=AValue shr 5;\r\n  month:=AValue and 15;\r\n  avalue:=AValue shr 4;\r\n  year:=AValue+1980;\r\n  result:=EncodeDateTime(year,month,day,hour,min,sec,0);\r\nend;\r\n\r\n\r\n\r\nconst whitespace  = [' ',#13,#10];\r\n      hrfactor    = 1/(24);\r\n      minfactor   = 1/(24*60);\r\n      secfactor   = 1/(24*60*60);\r\n      mssecfactor = 1/(24*60*60*1000);\r\n\r\nconst AMPMformatting : array[0..2] of string =('am/pm','a/p','ampm');\r\n\r\nprocedure raiseexception(const s:string);\r\n\r\nbegin\r\n  raise EConvertError.Create(s);\r\nend;\r\n\r\n{ Conversion of UTC to local time and vice versa }\r\n\r\nFunction GetLocalTimeOffset : Integer;\r\n\r\nbegin\r\n  Result:=TJSDate.New.getTimezoneOffset();\r\nend;\r\n\r\nfunction UniversalTimeToLocal(UT: TDateTime): TDateTime;\r\n\r\nbegin\r\n  Result:=UniversalTimeToLocal(UT,-GetLocalTimeOffset);\r\nend;\r\n\r\nfunction UniversalTimeToLocal(UT: TDateTime; TZOffset : Integer): TDateTime;\r\n\r\nbegin\r\n  if (TZOffset > 0) then\r\n    Result := UT + EncodeTime(TZOffset div 60, TZOffset mod 60, 0, 0)\r\n  else if (TZOffset < 0) then\r\n    Result := UT - EncodeTime(Abs(TZOffset) div 60, Abs(TZOffset) mod 60, 0, 0)\r\n  else\r\n    Result := UT;\r\nend;\r\n \r\nFunction LocalTimeToUniversal(LT: TDateTime): TDateTime;\r\n\r\nbegin\r\n  Result:=LocalTimeToUniversal(LT,-GetLocalTimeOffset);\r\nend;\r\n\r\nFunction LocalTimeToUniversal(LT: TDateTime;TZOffset: Integer): TDateTime;\r\n\r\nbegin\r\n  if (TZOffset > 0) then\r\n    Result := LT - EncodeTime(TZOffset div 60, TZOffset mod 60, 0, 0)\r\n  else if (TZOffset < 0) then\r\n    Result := LT + EncodeTime(Abs(TZOffset) div 60, Abs(TZOffset) mod 60, 0, 0)\r\n  else\r\n    Result := LT;\r\nend;\r\n\r\n\r\n{ RFC 3339 }\r\n\r\nfunction DateTimeToRFC3339(ADate :TDateTime):string;\r\n\r\nbegin\r\n  Result:=FormatDateTime('yyyy-mm-dd\"T\"hh\":\"nn\":\"ss\".\"zzz\"Z\"',ADate);\r\nend;\r\n\r\nfunction DateToRFC3339(ADate: TDateTime): string;\r\nbegin\r\n  Result:=FormatDateTime('yyyy-mm-dd',ADate);\r\nend;\r\n\r\nfunction TimeToRFC3339(ADate :TDateTime):string;\r\n\r\nbegin\r\n  Result:=FormatDateTime('hh\":\"nn\":\"ss\".\"zzz',ADate);\r\nend;\r\n\r\nFunction TryRFC3339ToDateTime(const Avalue: String; out ADateTime: TDateTime): Boolean;\r\n\r\n//          1         2\r\n// 12345678901234567890123\r\n// yyyy-mm-ddThh:nn:ss.zzz\r\n\r\nType\r\n  TPartPos = (ppTime,ppYear,ppMonth,ppDay,ppHour,ppMinute,ppSec);\r\n  TPos = Array [TPartPos] of byte;\r\n\r\nConst\r\n  P : TPos = (11,1,6,9,12,15,18);\r\n\r\nvar\r\n  lY, lM, lD, lH, lMi, lS: Integer;\r\n\r\nbegin\r\n  if Trim(AValue) = '' then\r\n    begin\r\n    Result:=True;\r\n    ADateTime:=0;\r\n    end;\r\n  lY:=StrToIntDef(Copy(AValue,P[ppYear],4),-1);\r\n  lM:=StrToIntDef(Copy(AValue,P[ppMonth],2),-1);\r\n  lD:=StrToIntDef(Copy(AValue,P[ppDay],2),-1);\r\n  if (Length(AValue)>=P[ppTime]) then\r\n    begin\r\n    lH:=StrToIntDef(Copy(AValue,P[ppHour],2),-1);\r\n    lMi:=StrToIntDef(Copy(AValue,P[ppMinute],2),-1);\r\n    lS:=StrToIntDef(Copy(AValue,P[ppSec],2),-1);\r\n    end\r\n  else\r\n    begin\r\n    lH:=0;\r\n    lMi:=0;\r\n    lS:=0;\r\n    end;\r\n  Result:=(lY>=0) and (lM>=0) and (lD>=0) and (lH>=0) and (lMi>=0) and (ls>=0);\r\n  if Not Result then\r\n    ADateTime:=0\r\n  else\r\n    { Cannot EncodeDate if any part equals 0. EncodeTime is okay. }\r\n    if (lY = 0) or (lM = 0) or (lD = 0) then\r\n      ADateTime:=EncodeTime(lH, lMi, lS, 0)\r\n    else\r\n      ADateTime:=EncodeDate(lY, lM, lD) + EncodeTime(lH, lMi, lS, 0);\r\nend;\r\n\r\nFunction RFC3339ToDateTime(const Avalue: String): TDateTime;\r\n\r\nbegin\r\n  if Not TryRFC3339ToDateTime(AValue,Result) then\r\n    Result:=0;\r\nend;\r\n\r\nconst\r\n\r\n  SPatternCharMismatch = 'Pattern mismatch char \"%s\" at position %d.';\r\n  SNoCharMatch         = 'Mismatch char \"%s\" <> \"%s\" at pattern position %d, string position %d.';\r\n  SHHMMError           = 'mm in a sequence hh:mm is interpreted as minutes. No longer versions allowed! (Position : %d).' ;\r\n  SNoArrayMatch        = 'Can''t match any allowed value at pattern position %d, string position %d.';\r\n  //SFullpattern         = 'Couldn''t match entire pattern string. Input too short at pattern position %d.';\r\n\r\n\r\n{ TDateTimeScanner }\r\nprocedure TDateTimeScanner.ArrayMatchError;\r\n\r\nbegin\r\n  raiseexception(format(SNoArrayMatch,[FPatternPos+1,FPos]))\r\nend;\r\n\r\nprocedure TDateTimeScanner.SetPattern(AValue: String);\r\nbegin\r\n  if FPattern=AValue then Exit;\r\n  FPattern:=AValue;\r\n  FPatternLen:=Length(FPattern);\r\nend;\r\n\r\nprocedure TDateTimeScanner.SetText(AValue: String);\r\nbegin\r\n  if FText=AValue then Exit;\r\n  FText:=AValue;\r\n  FLen:=Length(FText);\r\nend;\r\n\r\nfunction TDateTimeScanner.ScanFixedInt(maxv:integer):integer;\r\n\r\nvar\r\n  c,n : char;\r\n  oi:integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  oi:=FPos;\r\n  c:=FPattern[FPatternPos];\r\n  while (FPatternPos<=FPatternLen) and (FPattern[FPatternPos]=c) do\r\n    Inc(FPatternPos);\r\n  N:=FText[FPos];\r\n  while (maxv>0) and (FPos<=FLen) and (N IN ['0'..'9']) do\r\n    begin\r\n    Result:=(Result*10)+ord(N)-48;\r\n    inc(FPos);\r\n    dec(maxv);\r\n    if FPos<=FLen then\r\n      N:=FText[FPos];\r\n    end;\r\n  if (OI=FPos) then\r\n    raiseexception(format(SPatternCharMismatch,[c,oi]));\r\nend;\r\n\r\nfunction TDateTimeScanner.FindIMatch(const values :array of string; aTerm : string):integer;\r\n\r\nvar\r\n  l,i : integer;\r\n\r\nbegin\r\n  Result:=-1;\r\n  l:=high(values);\r\n  i:=0;\r\n  while (i<=l) and (result=-1) do\r\n    begin\r\n    if SameText(Copy(aTerm,1,Length(values[i])),values[i]) then\r\n      Result:=i;\r\n    inc(i);\r\n    end;\r\nend;\r\n\r\nfunction TDateTimeScanner.FindMatch(const Values : array of string):integer;\r\n\r\nbegin\r\n  result:=FindIMatch(Values,Copy(FText,FPos,FLen-FPos+1));\r\n  if result=-1 then\r\n    arraymatcherror\r\n  else\r\n    begin\r\n    inc(FPos,length(Values[result])+1);\r\n    inc(FPatternPos,length(Values[result])+1);\r\n    inc(result); // was 0 based.\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TDateTimeScanner.MatchChar(c:char);\r\n\r\nVar\r\n  N : Char;\r\n\r\nbegin\r\n  if (FPos<=Flen) then\r\n    N:=FText[FPos]\r\n  else\r\n    N:='?';\r\n  if (N<>c) then\r\n    raiseexception(format(SNoCharMatch,[N,C,FPatternPos+FPatternOffset,FPos]));\r\n  inc(FPatternPos);\r\n  inc(FPos);\r\nend;\r\n\r\nfunction TDateTimeScanner.ScanPatternLength :integer;\r\n\r\nvar\r\n  c : char;\r\n  i : Integer;\r\n\r\nbegin\r\n  result:=FPatternPos;\r\n  I:=FPatternPos;\r\n  c:=FPattern[I];\r\n  while (I<=FPatternLen) and (FPattern[i]=c) do\r\n    inc(I);\r\n  Result:=I-Result;\r\nend;\r\n\r\nprocedure TDateTimeScanner.MatchPattern(const aPattern: String);\r\n\r\nVar\r\n  T : String;\r\n  cPos: Integer;\r\n\r\nbegin\r\n  T:=FPattern;\r\n  cPos:=FPatternPos;\r\n  FPatternOffset:=FPatternPos;\r\n  FPattern:=aPattern;\r\n  FPatternLen:=Length(aPattern);\r\n  try\r\n    Scan;\r\n  finally\r\n    FPattern:=T;\r\n    FPatternLen:=Length(aPattern);\r\n    FPatternPos:=cPos;\r\n    FPatternOffset:=0;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoDay;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  i:=ScanPatternLength;\r\n  case i of\r\n  1,2 : FD:=scanfixedint(2);\r\n  3   : FD:=findmatch(shortDayNames);\r\n  4   : FD:=findmatch(longDayNames);\r\n  5   : matchpattern(shortdateformat);\r\n  6   : matchpattern(longdateformat);\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoYear;\r\n\r\nVar\r\n  I : integer;\r\n  pivot : Integer;\r\n\r\nbegin\r\n  i:=ScanPatternLength;\r\n  FY:=scanfixedint(4);\r\n  if i<=2 then\r\n    begin\r\n    Pivot:=YearOf(Now)-TwoDigitYearCenturyWindow;\r\n    inc(FY, Pivot div 100 * 100);\r\n    if (TwoDigitYearCenturyWindow > 0) and (FY < Pivot) then\r\n      inc(FY, 100);\r\n    end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoMonth;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  I:=ScanPatternLength;\r\n  case i of\r\n  1,2: FM:=scanfixedint(2);\r\n  3:   FM:=findmatch(ShortMonthNames);\r\n  4:   FM:=findmatch(LongMonthNames);\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoTime;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  i:=ScanPatternLength;\r\n  case i of\r\n    1: matchpattern(ShortTimeFormat);\r\n    2: matchpattern(LongTimeFormat);\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoDateTime;\r\n\r\nbegin\r\n  MatchPattern(ShortDateFormat);\r\n  MatchPattern(#9);\r\n  MatchPattern(LongTimeFormat);\r\n  inc(FPatternPos);\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoAMPM;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  i:=FindIMatch(AMPMformatting,Copy(FPattern,FPatternPos,5));\r\n  case i of\r\n  0:\r\n    begin\r\n    i:=FindIMatch(['AM','PM'],Copy(FText,FPos,2));\r\n    case i of\r\n      0: ;\r\n      1: FTimeval:=FTimeval+12*hrfactor;\r\n    else\r\n      ArrayMatchError\r\n    end;\r\n    inc(FPatternPos,length(AMPMformatting[0]));\r\n    inc(FPos,2);\r\n    end;\r\n  1:\r\n    begin\r\n    case Upcase(FText[FPos]) of\r\n      'A' : ;\r\n      'P' : FTimeval:=FTimeval+12*hrfactor;\r\n    else\r\n      ArrayMatchError\r\n    end;\r\n    inc(FPatternPos,length(AMPMformatting[1]));\r\n    inc(FPos);\r\n    end;\r\n  2:\r\n    begin\r\n    i:=FindIMatch([timeamstring,timepmstring],Copy(FText,FPos,5));\r\n    case i of\r\n    0: inc(FPos,length(timeamstring));\r\n    1: begin\r\n       FTimeval:=FTimeval+12*hrfactor;\r\n       inc(FPos,length(timepmstring));\r\n       end;\r\n    else\r\n      arraymatcherror\r\n    end;\r\n    inc(FPatternPos,length(AMPMformatting[2]));\r\n    inc(FPatternPos,2);\r\n    inc(FPos,2);\r\n    end;\r\n  else  // no AM/PM match. Assume 'a' is simply a char\r\n     MatchChar(FPattern[FPatternPos]);\r\n  end;\r\nend;\r\n\r\nfunction TDateTimeScanner.Scan(StartPos: integer): TDateTime;\r\n\r\nvar\r\n  lasttoken,\r\n  activequote,\r\n  lch : char;\r\n  i : Integer;\r\n\r\nbegin\r\n  if StartPos<1 then\r\n    StartPos:=1;\r\n  if FPos<StartPos then\r\n    FPos:=StartPos;\r\n  FPatternPos:=1;\r\n  activequote:=#0;\r\n  lasttoken:=' ';\r\n  while (FPos<=FLen) and (FPatternPos<=FPatternlen) do\r\n    begin\r\n    lch:=upcase(FPattern[FPatternPos]);\r\n    if activequote<>#0 then\r\n      begin\r\n      if (activequote<>lch) then\r\n        MatchChar(lch)\r\n      else\r\n        begin\r\n        activequote:=#0;\r\n        inc(FPatternPos);\r\n        end\r\n      end\r\n    else\r\n      begin\r\n      if (lch='M') and (lasttoken='H') then\r\n        begin\r\n        i:=ScanPatternLength;\r\n        if i>2 then\r\n           raiseexception(format(SHHMMError,[FPatternOffset+FPatternPos+1]));\r\n        FTimeval:=FTimeval+scanfixedint(2)* minfactor;\r\n        end\r\n      else\r\n        case lch of\r\n        'Y': DoYear;\r\n        'M': DoMonth;\r\n        'D': DoDay;\r\n        'T': DoTime;\r\n        'H': FTimeval:=FTimeval+scanfixedint(2)* hrfactor;\r\n        'N': FTimeval:=FTimeval+scanfixedint(2)* minfactor;\r\n        'S': FTimeval:=FTimeval+scanfixedint(2)* secfactor;\r\n        'Z': FTimeval:=FTimeval+scanfixedint(3)* mssecfactor;\r\n        'A': DoAMPM;\r\n        '/': MatchChar(DateSeparator);\r\n        ':': begin\r\n             MatchChar(TimeSeparator);\r\n             lch:=lasttoken;\r\n             end;\r\n        #39,'\"' :\r\n             begin\r\n             activequote:=lch;\r\n             inc(FPatternPos);\r\n             end;\r\n        'C': DoDateTime;\r\n        '?': begin\r\n             inc(FPatternPos);\r\n             inc(FPos)\r\n             end;\r\n        #9: begin\r\n            while (FPos<=FLen) and (FText[FPos] in WhiteSpace) do\r\n              inc(FPos);\r\n            inc(FPatternPos);\r\n            end;\r\n        else\r\n          MatchChar(FPattern[FPatternPos]);\r\n        end; {case}\r\n      lasttoken:=lch;\r\n      end\r\n  end;\r\n//  if (FPatternPos<FLen) and (FPatternLen>0) and (FPattern[FPatternLen-1]<>#9) then  // allow omission of trailing whitespace\r\n//    RaiseException(format(SFullpattern,[FPatternOffset+FPatternPos]));\r\n  Result:=FTimeval;\r\n  if (FY>0) and (FM>0) and (FD>0) then\r\n    Result:=Result+EncodeDate(FY,FM,FD);\r\nend;\r\n\r\nFunction ScanDateTime(APattern,AValue: String; APos : integer = 1) : TDateTime;\r\n\r\nVar\r\n  T : TDateTimeScanner;\r\n\r\nbegin\r\n  T:=TDateTimeScanner.Create;\r\n  try\r\n    T.Pattern:=APattern;\r\n    T.Text:=AValue;\r\n    Result:=T.Scan(APos);\r\n  finally\r\n    T.Free;\r\n  end;\r\nend;\r\n\r\n\r\nend.\r\n","{\r\n    This file is part of the Free Pascal run time library.\r\n    Copyright (c) 1999-2000 by Michael Van Canneyt, member of the\r\n    Free Pascal development team\r\n\r\n    Constants used for displaying messages in DB units\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\nunit DBConst;\r\n\r\nInterface\r\n\r\nResourcestring\r\n  SActiveDataset           = 'Operation cannot be performed on an active dataset';\r\n  SBadParamFieldType       = 'Bad fieldtype for parameter \"%s\".';\r\n  SCantSetAutoIncFields    = 'AutoInc Fields are read-only';\r\n  SConnected               = 'Operation cannot be performed on a connected database';\r\n  SDatasetReadOnly         = 'Dataset is read-only.';\r\n  SDatasetRegistered       = 'Dataset already registered : \"%s\"';\r\n  SDuplicateFieldName      = 'Duplicate fieldname : \"%s\"';\r\n  SErrAssTransaction       = 'Cannot assign transaction while old transaction active!';\r\n  SErrColumnNotFound       = 'Column \"%s\" not found.';\r\n  SErrDatabasenAssigned    = 'Database not assigned!';\r\n  SErrNoDatabaseAvailable  = 'Invalid operation: Not attached to database';\r\n  SErrNoDatabaseName       = 'Database connect string (DatabaseName) not filled in!';\r\n  SErrNoSelectStatement    = 'Cannot open a non-select statement';\r\n  SErrNoStatement          = 'SQL statement not set';\r\n  SErrTransAlreadyActive   = 'Transaction already active';\r\n  SErrTransactionnSet      = 'Transaction not set';\r\n  SErrIndexResultTooLong   = 'Index result for \"%s\" too long, >100 characters (%d).';\r\n  SErrIndexBasedOnInvField = 'Field \"%s\" has an invalid field type (%s) to base index on.';\r\n  SErrIndexBasedOnUnkField = 'Index based on unknown field \"%s\".';\r\n  SErrConnTransactionnSet  = 'Transaction of connection not set';\r\n  SErrNotASQLConnection    = '\"%s\" is not a TSQLConnection';\r\n  SErrNotASQLQuery         = '\"%s\" is not a TCustomSQLQuery';\r\n  STransNotActive          = 'Operation cannot be performed on an inactive transaction';\r\n  STransActive             = 'Operation cannot be performed on an active transaction';\r\n  SFieldNotFound           = 'Field not found : \"%s\"';\r\n  SInactiveDataset         = 'Operation cannot be performed on an inactive dataset';\r\n  SInvalidDisplayValues    = '\"%s\" are not valid boolean displayvalues';\r\n  SInvalidFieldKind        = '%s : invalid field kind : ';\r\n  SInvalidBookmark         = 'Invalid bookmark';\r\n  SInvalidFieldSize        = 'Invalid field size : %d';\r\n  SInvalidTypeConversion   = 'Invalid type conversion to %s in field %s';\r\n  SNeedField               = 'Field %s is required, but not supplied.';\r\n  SNeedFieldName           = 'Field needs a name';\r\n  SNoDataset               = 'No dataset asssigned for field : \"%s\"';\r\n  SNoDatasetRegistered     = 'No such dataset registered : \"%s\"';\r\n  SNoDatasets              = 'No datasets are attached to the database';\r\n  SNoSuchRecord            = 'Could not find the requested record.';\r\n  SNoTransactionRegistered = 'No such transaction registered : \"%s\"';\r\n  SNoTransactions          = 'No transactions are attached to the database';\r\n  SNotABoolean             = '\"%s\" is not a valid boolean';\r\n  SNotAFloat               = '\"%s\" is not a valid float';\r\n  SNotAninteger            = '\"%s\" is not a valid integer';\r\n  SNotConnected            = 'Operation cannot be performed on an disconnected database';\r\n  SNotEditing              = 'Operation not allowed, dataset \"%s\" is not in an edit or insert state.';\r\n  SParameterNotFound       = 'Parameter \"%s\" not found';\r\n  SRangeError              = '%f is not between %f and %f for %s';\r\n  SReadOnlyField           = 'Field %s cannot be modified, it is read-only.';\r\n  STransactionRegistered   = 'Transaction already registered : \"%s\"';\r\n  SUniDirectional          = 'Operation cannot be performed on an unidirectional dataset';\r\n  SUnknownField            = 'No field named \"%s\" was found in dataset \"%s\"';\r\n  SUnknownFieldType        = 'Unknown field type : %s';\r\n  SUnknownParamFieldType   = 'Unknown fieldtype for parameter \"%s\".';\r\n  SMetadataUnavailable     = 'The metadata is not available for this type of database.';\r\n  SDeletedRecord           = 'The record is deleted.';\r\n  SIndexNotFound           = 'Index ''%s'' not found';\r\n  SParameterCountIncorrect = 'The number of parameters is incorrect.';\r\n  SUnsupportedParameter    = 'Parameters of the type ''%s'' are not (yet) supported.';\r\n  SFieldValueError         = 'Invalid value for field ''%s''';\r\n  SInvalidCalcType         = 'Field ''%s'' cannot be a calculated or lookup field';\r\n  SDuplicateName           = 'Duplicate name ''%s'' in %s';\r\n  SNoParseSQL              = '%s is only possible if ParseSQL is True';\r\n  SLookupInfoError         = 'Lookup information for field ''%s'' is incomplete';\r\n  SUnsupportedFieldType    = 'Fieldtype %s is not supported';\r\n  SInvPacketRecordsValue   = 'PacketRecords has to be larger then 0';\r\n  SInvPacketRecordsValueFieldNames = 'PacketRecords must be -1 if IndexFieldNames is set';\r\n  SInvalidSearchFieldType  = 'Searching in fields of type %s is not supported';\r\n  SDatasetEmpty            = 'The dataset is empty';\r\n  SFieldIsNull             = 'The field is null';\r\n  SOnUpdateError           = 'An error occurred while applying the updates in a record: %s';\r\n  SApplyRecNotSupported    = 'Applying updates is not supported by this TDataset descendent';\r\n  SNoWhereFields           = 'No %s query specified and failed to generate one. (No fields for inclusion in where statement found)';\r\n  SNoUpdateFields          = 'No %s query specified and failed to generate one. (No fields found for insert- or update-statement found)';\r\n  SNotSupported            = 'Operation is not supported by this type of database';\r\n  SDBCreateDropFailed      = 'Creation or dropping of database failed';\r\n  SMaxIndexes              = 'The maximum amount of indexes is reached';\r\n  SMinIndexes              = 'The minimum amount of indexes is 1';\r\n  STooManyFields           = 'More fields specified then really exist';\r\n// These are added for Delphi-compatilility, but not used by the fcl:\r\n  SFieldIndexError         = 'Field index out of range';\r\n  SIndexFieldMissing       = 'Cannot access index field ''%s''';\r\n  SNoFieldIndexes          = 'No index currently active';\r\n  SNotIndexField           = 'Field ''%s'' is not indexed and cannot be modified';\r\n  SErrUnknownConnectorType = 'Unknown connector type: \"%s\"';\r\n  SNoIndexFieldNameGiven   = 'There are no fields selected to base the index on';\r\n  SStreamNotRecognised     = 'The data-stream format is not recognized';\r\n  SNoReaderClassRegistered = 'There is no TDatapacketReaderClass registered for this kind of data-stream';\r\n  SErrCircularDataSourceReferenceNotAllowed = 'Circular datasource references are not allowed.';\r\n  SCommitting               = 'Committing transaction';\r\n  SRollingBack              = 'Rolling back transaction';\r\n  SCommitRetaining          = 'Commit and retaining transaction';\r\n  SRollBackRetaining        = 'Rollback and retaining transaction';\r\n  SErrNoFieldsDefined       = 'Can not create a dataset when there are no fielddefinitions or fields defined';\r\n  SErrApplyUpdBeforeRefresh = 'Must apply updates before refreshing data';\r\n  SErrNoDataset             = 'Missing (compatible) underlying dataset, can not open';\r\n  SErrDisconnectedPacketRecords = 'For disconnected TSQLQuery instances, packetrecords must be -1';\r\n  SErrImplicitNoRollBack      = 'Implicit use of transactions does not allow rollback.';\r\n  SErrNoImplicitTransaction   = 'Connection %s does not allow implicit transactions.';\r\n  SErrImplictTransactionStart = 'Error: attempt to implicitly start a transaction on Connection \"%s\", transaction \"%s\".';\r\n  SErrImplicitConnect         = 'Error: attempt to implicitly activate connection \"%s\".';\r\n  SErrFailedToUpdateRecord    = 'Failed to apply record updates: %d rows updated.';\r\n  SErrRefreshNotSingleton     = 'Refresh SQL resulted in multiple records: %d.';\r\n  SErrRefreshEmptyResult      = 'Refresh SQL resulted in empty result set.';\r\n  SErrNoKeyFieldForRefreshClause = 'No key field found to construct refresh SQL WHERE clause';\r\n  SErrFailedToFetchReturningResult = 'Failed to fetch returning result';\r\n  SLogParamValue              = 'Parameter \"%s\" value : \"%s\"';\r\n  SErrInvalidDateTime         = 'Invalid date/time value : \"%s\"';\r\n  SatEOFInternalOnly          = 'loAtEOF is for internal use only.';\r\n  SErrInsertingSameRecordtwice = 'Attempt to insert the same record twice.';\r\n  SErrDoApplyUpdatesNeedsProxy = 'Cannot apply updates without Data proxy';\r\n\r\nImplementation\r\n\r\nend.\r\n","{\r\n    This file is part of the Free Pascal run time library.\r\n    Copyright (c) 1999-2017 by Michael Van Canneyt, member of the\r\n    Free Pascal development team\r\n\r\n    DB database unit\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit DB;\r\n\r\n{$mode objfpc}\r\n\r\n{ $define dsdebug}\r\ninterface\r\n\r\nuses Classes, SysUtils, JS, Types, DateUtils;\r\n\r\nconst\r\n\r\n  dsMaxBufferCount = MAXINT div 8;\r\n  dsMaxStringSize = 8192;\r\n\r\n  // Used in AsBoolean for string fields to determine\r\n  // whether it's true or false.\r\n  YesNoChars : Array[Boolean] of char = ('N', 'Y');\r\n\r\n  SQLDelimiterCharacters = [';',',',' ','(',')',#13,#10,#9];\r\n\r\ntype\r\n\r\n{ Misc Dataset types }\r\n\r\n  TDataSetState = (dsInactive, dsBrowse, dsEdit, dsInsert, dsSetKey,\r\n    dsCalcFields, dsFilter, dsNewValue, dsOldValue, dsCurValue, dsBlockRead,\r\n    dsInternalCalc, dsOpening, dsRefreshFields);\r\n\r\n  TDataEvent = (deFieldChange, deRecordChange, deDataSetChange,\r\n    deDataSetScroll, deLayoutChange, deUpdateRecord, deUpdateState,\r\n    deCheckBrowseMode, dePropertyChange, deFieldListChange, deFocusControl,\r\n    deParentScroll,deConnectChange,deReconcileError,deDisabledStateChange);\r\n\r\n  TUpdateStatus = (usModified, usInserted, usDeleted);\r\n  TUpdateStatusSet = Set of TUpdateStatus;\r\n\r\n  TResolveStatus = (rsUnresolved, rsResolving, rsResolved, rsResolveFailed);\r\n  TResolveStatusSet = Set of TResolveStatus;\r\n\r\n  TUpdateMode = (upWhereAll, upWhereChanged, upWhereKeyOnly);\r\n  TResolverResponse = (rrSkip, rrAbort, rrMerge, rrApply, rrIgnore);\r\n\r\n  TProviderFlag = (pfInUpdate, pfInWhere, pfInKey, pfHidden, pfRefreshOnInsert,pfRefreshOnUpdate);\r\n  TProviderFlags = set of TProviderFlag;\r\n\r\n{ Forward declarations }\r\n\r\n  TFieldDef = class;\r\n  TFieldDefs = class;\r\n  TField = class;\r\n  TFields = Class;\r\n  TDataSet = class;\r\n  TDataSource = Class;\r\n  TDataLink = Class;\r\n  TDataProxy = Class;\r\n  TDataRequest = class;\r\n  TRecordUpdateDescriptor = class;\r\n  TRecordUpdateDescriptorList = class;\r\n  TRecordUpdateBatch = class;\r\n\r\n{ Exception classes }\r\n\r\n  EDatabaseError = class(Exception);\r\n\r\n  EUpdateError   = class(EDatabaseError)\r\n  private\r\n    FContext           : String;\r\n    FErrorCode         : integer;\r\n    FOriginalException : Exception;\r\n    FPreviousError     : Integer;\r\n  public\r\n    constructor Create(NativeError, Context : String;\r\n      ErrCode, PrevError : integer; E: Exception); reintroduce;\r\n    Destructor Destroy; override;\r\n    property Context : String read FContext;\r\n    property ErrorCode : integer read FErrorcode;\r\n    property OriginalException : Exception read FOriginalException;\r\n    property PreviousError : Integer read FPreviousError;\r\n  end;\r\n  \r\n\r\n{ TFieldDef }\r\n\r\n  TFieldClass = class of TField;\r\n\r\n  // Data type for field.\r\n  TFieldType = (\r\n    ftUnknown, ftString, ftInteger, ftLargeInt, ftBoolean, ftFloat, ftDate,\r\n    ftTime, ftDateTime,  ftAutoInc, ftBlob, ftMemo, ftFixedChar,\r\n    ftVariant,ftDataset\r\n  );\r\n\r\n{ TDateTimeRec }\r\n\r\n  TFieldAttribute = (faHiddenCol, faReadonly, faRequired, faLink, faUnNamed, faFixed);\r\n  TFieldAttributes = set of TFieldAttribute;\r\n\r\n{ TNamedItem }\r\n\r\n  TNamedItem = class(TCollectionItem)\r\n  private\r\n    FName: string;\r\n  protected\r\n    function GetDisplayName: string; override;\r\n    procedure SetDisplayName(const Value: string); override;\r\n  Public  \r\n    property DisplayName : string read GetDisplayName write SetDisplayName;\r\n  published\r\n    property Name : string read FName write SetDisplayName;\r\n  end;\r\n\r\n{ TDefCollection }\r\n\r\n  TDefCollection = class(TOwnedCollection)\r\n  private\r\n    FDataset: TDataset;\r\n    FUpdated: boolean;\r\n  protected\r\n    procedure SetItemName(Item: TCollectionItem); override;\r\n  public\r\n    constructor create(ADataset: TDataset; AOwner: TPersistent; AClass: TCollectionItemClass); reintroduce;\r\n    function Find(const AName: string): TNamedItem;\r\n    procedure GetItemNames(List: TStrings);\r\n    function IndexOf(const AName: string): Longint;\r\n    property Dataset: TDataset read FDataset;\r\n    property Updated: boolean read FUpdated write FUpdated;\r\n  end;\r\n\r\n{ TFieldDef }\r\n\r\n  TFieldDef = class(TNamedItem)\r\n  Private\r\n    FAttributes : TFieldAttributes;\r\n    FDataType : TFieldType;\r\n    FFieldNo : Longint;\r\n    FInternalCalcField : Boolean;\r\n    FPrecision : Longint;\r\n    FRequired : Boolean;\r\n    FSize : Integer;\r\n    Function GetFieldClass : TFieldClass;\r\n    procedure SetAttributes(AValue: TFieldAttributes);\r\n    procedure SetDataType(AValue: TFieldType);\r\n    procedure SetPrecision(const AValue: Longint);\r\n    procedure SetSize(const AValue: Integer);\r\n    procedure SetRequired(const AValue: Boolean);\r\n  public\r\n    constructor Create(ACollection : TCollection); override;\r\n    constructor Create(AOwner: TFieldDefs; const AName: string;  ADataType: TFieldType; ASize: Integer; ARequired: Boolean; AFieldNo: Longint); overload;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    function CreateField(AOwner: TComponent): TField;\r\n    property FieldClass: TFieldClass read GetFieldClass;\r\n    property FieldNo: Longint read FFieldNo;\r\n    property InternalCalcField: Boolean read FInternalCalcField write FInternalCalcField;\r\n    property Required: Boolean read FRequired write SetRequired;\r\n  Published\r\n    property Attributes: TFieldAttributes read FAttributes write SetAttributes default [];\r\n    property DataType: TFieldType read FDataType write SetDataType;\r\n    property Precision: Longint read FPrecision write SetPrecision default 0;\r\n    property Size: Integer read FSize write SetSize default 0;\r\n  end;\r\n  TFieldDefClass = Class of TFieldDef;\r\n\r\n{ TFieldDefs }\r\n\r\n  TFieldDefs = class(TDefCollection)\r\n  private\r\n    FHiddenFields : Boolean;\r\n    function GetItem(Index: Longint): TFieldDef; reintroduce;\r\n    procedure SetItem(Index: Longint; const AValue: TFieldDef); reintroduce;\r\n  Protected\r\n    Class Function FieldDefClass : TFieldDefClass; virtual;\r\n  public\r\n    constructor Create(ADataSet: TDataSet); reintroduce;\r\n//    destructor Destroy; override;\r\n    Function Add(const AName: string; ADataType: TFieldType; ASize, APrecision{%H-}: Integer; ARequired, AReadOnly: Boolean; AFieldNo : Integer) : TFieldDef; overload;\r\n    Function Add(const AName: string; ADataType: TFieldType; ASize: Word; ARequired: Boolean; AFieldNo : Integer) : TFieldDef; overload;\r\n    procedure Add(const AName: string; ADataType: TFieldType; ASize: Word; ARequired: Boolean); overload;\r\n    procedure Add(const AName: string; ADataType: TFieldType; ASize: Word); overload;\r\n    procedure Add(const AName: string; ADataType: TFieldType); overload;\r\n    function Add: TFieldDef; overload; reintroduce;\r\n    Function AddFieldDef : TFieldDef;\r\n    procedure Assign(FieldDefs: TFieldDefs); overload;\r\n    function Find(const AName: string): TFieldDef; reintroduce;\r\n//    procedure Clear;\r\n//    procedure Delete(Index: Longint);\r\n    procedure Update; overload;\r\n    Function MakeNameUnique(const AName : String) : string; virtual;\r\n    Property HiddenFields : Boolean Read FHiddenFields Write FHiddenFields;\r\n    property Items[Index: Longint]: TFieldDef read GetItem write SetItem; default;\r\n  end;\r\n  TFieldDefsClass = Class of TFieldDefs;\r\n\r\n{ TField }\r\n\r\n  TFieldKind = (fkData, fkCalculated, fkLookup, fkInternalCalc);\r\n  TFieldKinds = Set of TFieldKind;\r\n\r\n  TFieldNotifyEvent = procedure(Sender: TField) of object;\r\n  TFieldGetTextEvent = procedure(Sender: TField; var aText: string;\r\n    DisplayText: Boolean) of object;\r\n  TFieldSetTextEvent = procedure(Sender: TField; const aText: string) of object;\r\n  TFieldChars = Array of Char;\r\n\r\n{ TLookupList }\r\n\r\n  TLookupList = class(TObject)\r\n  private\r\n    FList: TFPList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    procedure Add(const AKey, AValue: JSValue);\r\n    procedure Clear;\r\n    function FirstKeyByValue(const AValue: JSValue): JSValue;\r\n    function ValueOfKey(const AKey: JSValue): JSValue;\r\n    procedure ValuesToStrings(AStrings: TStrings);\r\n  end;\r\n\r\n{ TField }\r\n\r\n  TField = class(TComponent)\r\n  private\r\n    FAlignment : TAlignment;\r\n    FAttributeSet : String;\r\n    FCalculated : Boolean;\r\n    FConstraintErrorMessage : String;\r\n    FCustomConstraint : String;\r\n    FDataSet : TDataSet;\r\n//    FDataSize : Word;\r\n    FDataType : TFieldType;\r\n    FDefaultExpression : String;\r\n    FDisplayLabel : String;\r\n    FDisplayWidth : Longint;\r\n//    FEditMask: TEditMask;\r\n    FFieldDef: TFieldDef;\r\n    FFieldKind : TFieldKind;\r\n    FFieldName : String;\r\n    FFieldNo : Longint;\r\n    FFields : TFields;\r\n    FHasConstraints : Boolean;\r\n    FImportedConstraint : String;\r\n    FIsIndexField : Boolean;\r\n    FKeyFields : String;\r\n    FLookupCache : Boolean;\r\n    FLookupDataSet : TDataSet;\r\n    FLookupKeyfields : String;\r\n    FLookupresultField : String;\r\n    FLookupList: TLookupList;\r\n    FOnChange : TFieldNotifyEvent;\r\n    FOnGetText: TFieldGetTextEvent;\r\n    FOnSetText: TFieldSetTextEvent;\r\n    FOnValidate: TFieldNotifyEvent;\r\n    FOrigin : String;\r\n    FReadOnly : Boolean;\r\n    FRequired : Boolean;\r\n    FSize : integer;\r\n    FValidChars : TFieldChars;\r\n    FValueBuffer : JSValue;\r\n    FValidating : Boolean;\r\n    FVisible : Boolean;\r\n    FProviderFlags : TProviderFlags;\r\n    function GetIndex : longint;\r\n    function GetLookup: Boolean;\r\n    procedure SetAlignment(const AValue: TAlignMent);\r\n    procedure SetIndex(const AValue: Longint);\r\n    function GetDisplayText: String;\r\n    function GetEditText: String;\r\n    procedure SetEditText(const AValue: string);\r\n    procedure SetDisplayLabel(const AValue: string);\r\n    procedure SetDisplayWidth(const AValue: Longint);\r\n    function GetDisplayWidth: integer;\r\n    procedure SetLookup(const AValue: Boolean);\r\n    procedure SetReadOnly(const AValue: Boolean);\r\n    procedure SetVisible(const AValue: Boolean);\r\n    function IsDisplayLabelStored : Boolean;\r\n    function IsDisplayWidthStored: Boolean;\r\n    function GetLookupList: TLookupList;\r\n    procedure CalcLookupValue;\r\n  protected\r\n    Procedure RaiseAccessError(const TypeName: string);\r\n    function AccessError(const TypeName: string): EDatabaseError;\r\n    procedure CheckInactive;\r\n    class procedure CheckTypeSize(AValue: Longint); virtual;\r\n    procedure Change; virtual;\r\n    procedure Bind(Binding: Boolean); virtual;\r\n    procedure DataChanged;\r\n    function GetAsBoolean: Boolean; virtual;\r\n    function GetAsBytes: TBytes; virtual;\r\n    function GetAsLargeInt: NativeInt; virtual;\r\n    function GetAsDateTime: TDateTime; virtual;\r\n    function GetAsFloat: Double; virtual;\r\n    function GetAsLongint: Longint; virtual;\r\n    function GetAsInteger: Longint; virtual;\r\n    function GetAsJSValue: JSValue; virtual;\r\n    function GetOldValue: JSValue; virtual;\r\n    function GetAsString: string; virtual;\r\n    function GetCanModify: Boolean; virtual;\r\n    function GetClassDesc: String; virtual;\r\n    function GetDataSize: Integer; virtual;\r\n    function GetDefaultWidth: Longint; virtual;\r\n    function GetDisplayName : String;\r\n    function GetCurValue: JSValue; virtual;\r\n    function GetNewValue: JSValue; virtual;\r\n    function GetIsNull: Boolean; virtual;\r\n    procedure GetText(var AText: string; ADisplayText{%H-}: Boolean); virtual;\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    procedure PropertyChanged(LayoutAffected: Boolean);\r\n    procedure SetAsBoolean(AValue{%H-}: Boolean); virtual;\r\n    procedure SetAsDateTime(AValue{%H-}: TDateTime); virtual;\r\n    procedure SetAsFloat(AValue{%H-}: Double); virtual;\r\n    procedure SetAsLongint(AValue: Longint); virtual;\r\n    procedure SetAsInteger(AValue{%H-}: Longint); virtual;\r\n    procedure SetAsLargeInt(AValue{%H-}: NativeInt); virtual;\r\n    procedure SetAsJSValue(const AValue: JSValue); virtual;\r\n    procedure SetAsString(const AValue{%H-}: string); virtual;\r\n    procedure SetDataset(AValue : TDataset); virtual;\r\n    procedure SetDataType(AValue: TFieldType);\r\n    procedure SetNewValue(const AValue: JSValue);\r\n    procedure SetSize(AValue: Integer); virtual;\r\n    procedure SetText(const AValue: string); virtual;\r\n    procedure SetVarValue(const AValue{%H-}: JSValue); virtual;\r\n    procedure SetAsBytes(const AValue{%H-}: TBytes); virtual;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function GetParentComponent: TComponent; override;\r\n    procedure SetParentComponent(Value: TComponent); override;\r\n    function HasParent: Boolean; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure AssignValue(const AValue: JSValue);\r\n    procedure Clear; virtual;\r\n    procedure FocusControl;\r\n    function GetData : JSValue;\r\n    class function IsBlob: Boolean; virtual;\r\n    function IsValidChar(InputChar: Char): Boolean; virtual;\r\n    procedure RefreshLookupList;\r\n    procedure SetData(Buffer: JSValue); overload;\r\n    procedure SetFieldType(AValue{%H-}: TFieldType); virtual;\r\n    procedure Validate(Buffer: Pointer);\r\n    property AsBoolean: Boolean read GetAsBoolean write SetAsBoolean;\r\n    property AsDateTime: TDateTime read GetAsDateTime write SetAsDateTime;\r\n    property AsFloat: Double read GetAsFloat write SetAsFloat;\r\n    property AsLongint: Longint read GetAsLongint write SetAsLongint;\r\n    property AsLargeInt: NativeInt read GetAsLargeInt write SetAsLargeInt;\r\n    property AsInteger: Longint read GetAsInteger write SetAsInteger;\r\n    property AsString: string read GetAsString write SetAsString;\r\n    property AsJSValue: JSValue read GetAsJSValue write SetAsJSValue;\r\n    property AttributeSet: string read FAttributeSet write FAttributeSet;\r\n    property Calculated: Boolean read FCalculated write FCalculated;\r\n    property CanModify: Boolean read GetCanModify;\r\n    property CurValue: JSValue read GetCurValue;\r\n    property DataSet: TDataSet read FDataSet write SetDataSet;\r\n    property DataSize: Integer read GetDataSize;\r\n    property DataType: TFieldType read FDataType;\r\n    property DisplayName: String Read GetDisplayName;\r\n    property DisplayText: String read GetDisplayText;\r\n    property FieldNo: Longint read FFieldNo;\r\n    property IsIndexField: Boolean read FIsIndexField;\r\n    property IsNull: Boolean read GetIsNull;\r\n    property Lookup: Boolean read GetLookup write SetLookup; deprecated;\r\n    property NewValue: JSValue read GetNewValue write SetNewValue;\r\n    property Size: Integer read FSize write SetSize;\r\n    property Text: string read GetEditText write SetEditText;\r\n    property ValidChars : TFieldChars read FValidChars write FValidChars;\r\n    property Value: JSValue read GetAsJSValue write SetAsJSValue;\r\n    property OldValue: JSValue read GetOldValue;\r\n    property LookupList: TLookupList read GetLookupList;\r\n    Property FieldDef : TFieldDef Read FFieldDef;\r\n  published\r\n    property Alignment : TAlignment read FAlignment write SetAlignment default taLeftJustify;\r\n    property CustomConstraint: string read FCustomConstraint write FCustomConstraint;\r\n    property ConstraintErrorMessage: string read FConstraintErrorMessage write FConstraintErrorMessage;\r\n    property DefaultExpression: string read FDefaultExpression write FDefaultExpression;\r\n    property DisplayLabel : string read GetDisplayName write SetDisplayLabel stored IsDisplayLabelStored;\r\n    property DisplayWidth: Longint read GetDisplayWidth write SetDisplayWidth stored IsDisplayWidthStored;\r\n    property FieldKind: TFieldKind read FFieldKind write FFieldKind;\r\n    property FieldName: string read FFieldName write FFieldName;\r\n    property HasConstraints: Boolean read FHasConstraints;\r\n    property Index: Longint read GetIndex write SetIndex;\r\n    property ImportedConstraint: string read FImportedConstraint write FImportedConstraint;\r\n    property KeyFields: string read FKeyFields write FKeyFields;\r\n    property LookupCache: Boolean read FLookupCache write FLookupCache;\r\n    property LookupDataSet: TDataSet read FLookupDataSet write FLookupDataSet;\r\n    property LookupKeyFields: string read FLookupKeyFields write FLookupKeyFields;\r\n    property LookupResultField: string read FLookupResultField write FLookupResultField;\r\n    property Origin: string read FOrigin write FOrigin;\r\n    property ProviderFlags : TProviderFlags read FProviderFlags write FProviderFlags;\r\n    property ReadOnly: Boolean read FReadOnly write SetReadOnly;\r\n    property Required: Boolean read FRequired write FRequired;\r\n    property Visible: Boolean read FVisible write SetVisible default True;\r\n    property OnChange: TFieldNotifyEvent read FOnChange write FOnChange;\r\n    property OnGetText: TFieldGetTextEvent read FOnGetText write FOnGetText;\r\n    property OnSetText: TFieldSetTextEvent read FOnSetText write FOnSetText;\r\n    property OnValidate: TFieldNotifyEvent read FOnValidate write FOnValidate;\r\n  end;\r\n\r\n{ TStringField }\r\n\r\n  TStringField = class(TField)\r\n  private\r\n    FFixedChar     : boolean;\r\n    FTransliterate : Boolean;\r\n  protected\r\n    class procedure CheckTypeSize(AValue: Longint); override;\r\n    function GetAsBoolean: Boolean; override;\r\n    function GetAsDateTime: TDateTime; override;\r\n    function GetAsFloat: Double; override;\r\n    function GetAsInteger: Longint; override;\r\n    function GetAsLargeInt: NativeInt; override;\r\n    function GetAsString: String; override;\r\n    function GetAsJSValue: JSValue; override;\r\n    function GetDefaultWidth: Longint; override;\r\n    procedure GetText(var AText: string; ADisplayText{%H-}: Boolean); override;\r\n    procedure SetAsBoolean(AValue: Boolean); override;\r\n    procedure SetAsDateTime(AValue: TDateTime); override;\r\n    procedure SetAsFloat(AValue: Double); override;\r\n    procedure SetAsInteger(AValue: Longint); override;\r\n    procedure SetAsLargeInt(AValue: NativeInt); override;\r\n    procedure SetAsString(const AValue: String); override;\r\n    procedure SetVarValue(const AValue: JSValue); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    procedure SetFieldType(AValue: TFieldType); override;\r\n    property FixedChar : Boolean read FFixedChar write FFixedChar;\r\n    property Transliterate: Boolean read FTransliterate write FTransliterate;\r\n    property Value: String read GetAsString write SetAsString;\r\n  published\r\n    property Size default 20;\r\n  end;\r\n\r\n\r\n{ TNumericField }\r\n\r\n  TNumericField = class(TField)\r\n  Private\r\n    FDisplayFormat : String;\r\n    FEditFormat : String;\r\n  protected\r\n    class procedure CheckTypeSize(AValue: Longint); override;\r\n    procedure RangeError(AValue, Min, Max: Double);\r\n    procedure SetDisplayFormat(const AValue: string);\r\n    procedure SetEditFormat(const AValue: string);\r\n    function  GetAsBoolean: Boolean; override;\r\n    Procedure SetAsBoolean(AValue: Boolean); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n  published\r\n    property Alignment default taRightJustify;\r\n    property DisplayFormat: string read FDisplayFormat write SetDisplayFormat;\r\n    property EditFormat: string read FEditFormat write SetEditFormat;\r\n  end;\r\n\r\n{ TLongintField }\r\n\r\n  TIntegerField = class(TNumericField)\r\n  private\r\n    FMinValue,\r\n    FMaxValue,\r\n    FMinRange,\r\n    FMaxRange  : Longint;\r\n    Procedure SetMinValue (AValue : longint);\r\n    Procedure SetMaxValue (AValue : longint);\r\n  protected\r\n    function GetAsFloat: Double; override;\r\n    function GetAsInteger: Longint; override;\r\n    function GetAsString: string; override;\r\n    function GetAsJSValue: JSValue; override;\r\n    procedure GetText(var AText: string; ADisplayText: Boolean); override;\r\n    function GetValue(var AValue: Longint): Boolean;\r\n    procedure SetAsFloat(AValue: Double); override;\r\n    procedure SetAsInteger(AValue: Longint); override;\r\n    procedure SetAsString(const AValue: string); override;\r\n    procedure SetVarValue(const AValue: JSValue); override;\r\n    function GetAsLargeInt: NativeInt; override;\r\n    procedure SetAsLargeInt(AValue: NativeInt); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    Function CheckRange(AValue : Longint) : Boolean;\r\n    property Value: Longint read GetAsInteger write SetAsInteger;\r\n  published\r\n    property MaxValue: Longint read FMaxValue write SetMaxValue default 0;\r\n    property MinValue: Longint read FMinValue write SetMinValue default 0;\r\n  end;\r\n\r\n{ TLargeintField }\r\n\r\n  TLargeintField = class(TNumericField)\r\n  private\r\n    FMinValue,\r\n    FMaxValue,\r\n    FMinRange,\r\n    FMaxRange  : NativeInt;\r\n    Procedure SetMinValue (AValue : NativeInt);\r\n    Procedure SetMaxValue (AValue : NativeInt);\r\n  protected\r\n    function GetAsFloat: Double; override;\r\n    function GetAsInteger: Longint; override;\r\n    function GetAsLargeInt: NativeInt; override;\r\n    function GetAsString: string; override;\r\n    function GetAsJSValue: JSValue; override;\r\n    procedure GetText(var AText: string; ADisplayText: Boolean); override;\r\n    function GetValue(var AValue: NativeInt): Boolean;\r\n    procedure SetAsFloat(AValue: Double); override;\r\n    procedure SetAsInteger(AValue: Longint); override;\r\n    procedure SetAsLargeInt(AValue: NativeInt); override;\r\n    procedure SetAsString(const AValue: string); override;\r\n    procedure SetVarValue(const AValue: JSValue); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    Function CheckRange(AValue : NativeInt) : Boolean;\r\n    property Value: NativeInt read GetAsLargeInt write SetAsLargeInt;\r\n  published\r\n    property MaxValue: NativeInt read FMaxValue write SetMaxValue default 0;\r\n    property MinValue: NativeInt read FMinValue write SetMinValue default 0;\r\n  end;\r\n\r\n{ TAutoIncField }\r\n\r\n  TAutoIncField = class(TIntegerField)\r\n  Protected\r\n    procedure SetAsInteger(AValue: Longint); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n  end;\r\n\r\n{ TFloatField }\r\n\r\n  TFloatField = class(TNumericField)\r\n  private\r\n    FCurrency: Boolean;\r\n    FMaxValue : Double;\r\n    FMinValue : Double;\r\n    FPrecision : Longint;\r\n    procedure SetCurrency(const AValue: Boolean);\r\n    procedure SetPrecision(const AValue: Longint);\r\n  protected\r\n    function GetAsFloat: Double; override;\r\n    function GetAsLargeInt: NativeInt; override;\r\n    function GetAsInteger: Longint; override;\r\n    function GetAsJSValue: JSValue; override;\r\n    function GetAsString: string; override;\r\n    procedure GetText(var AText: string; ADisplayText: Boolean); override;\r\n    procedure SetAsFloat(AValue: Double); override;\r\n    procedure SetAsLargeInt(AValue: NativeInt); override;\r\n    procedure SetAsInteger(AValue: Longint); override;\r\n    procedure SetAsString(const AValue: string); override;\r\n    procedure SetVarValue(const AValue: JSValue); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    Function CheckRange(AValue : Double) : Boolean;\r\n    property Value: Double read GetAsFloat write SetAsFloat;\r\n\r\n  published\r\n    property Currency: Boolean read FCurrency write SetCurrency default False;\r\n    property MaxValue: Double read FMaxValue write FMaxValue;\r\n    property MinValue: Double read FMinValue write FMinValue;\r\n    property Precision: Longint read FPrecision write SetPrecision default 15; // min 2 instellen, delphi compat\r\n  end;\r\n\r\n\r\n{ TBooleanField }\r\n\r\n  TBooleanField = class(TField)\r\n  private\r\n    FDisplayValues : String;\r\n    // First byte indicates uppercase or not.\r\n    FDisplays : Array[Boolean,Boolean] of string;\r\n    Procedure SetDisplayValues(const AValue : String);\r\n  protected\r\n    function GetAsBoolean: Boolean; override;\r\n    function GetAsString: string; override;\r\n    function GetAsJSValue: JSValue; override;\r\n    function GetAsInteger: Longint; override;\r\n    function GetDefaultWidth: Longint; override;\r\n    procedure SetAsBoolean(AValue: Boolean); override;\r\n    procedure SetAsString(const AValue: string); override;\r\n    procedure SetAsInteger(AValue: Longint); override;\r\n    procedure SetVarValue(const AValue: JSValue); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    property Value: Boolean read GetAsBoolean write SetAsBoolean;\r\n  published\r\n    property DisplayValues: string read FDisplayValues write SetDisplayValues;\r\n  end;\r\n\r\n{ TDateTimeField }\r\n\r\n  TDateTimeField = class(TField)\r\n  private\r\n    FDisplayFormat : String;\r\n    procedure SetDisplayFormat(const AValue: string);\r\n  protected\r\n    Function ConvertToDateTime(aValue : JSValue; aRaiseError : Boolean) : TDateTime; virtual;\r\n    Function DateTimeToNativeDateTime(aValue : TDateTime) : JSValue; virtual;\r\n    function GetAsDateTime: TDateTime; override;\r\n    function GetAsFloat: Double; override;\r\n    function GetAsString: string; override;\r\n    function GetAsJSValue: JSValue; override;\r\n    function GetDataSize: Integer; override;\r\n    procedure GetText(var AText: string; ADisplayText: Boolean); override;\r\n    procedure SetAsDateTime(AValue: TDateTime); override;\r\n    procedure SetAsFloat(AValue: Double); override;\r\n    procedure SetAsString(const AValue: string); override;\r\n    procedure SetVarValue(const AValue: JSValue); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    property Value: TDateTime read GetAsDateTime write SetAsDateTime;\r\n  published\r\n    property DisplayFormat: string read FDisplayFormat write SetDisplayFormat;\r\n  end;\r\n\r\n{ TDateField }\r\n\r\n  TDateField = class(TDateTimeField)\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n  end;\r\n\r\n{ TTimeField }\r\n\r\n  TTimeField = class(TDateTimeField)\r\n  protected\r\n    procedure SetAsString(const AValue: string); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n  end;\r\n\r\n{ TBinaryField }\r\n\r\n  TBinaryField = class(TField)\r\n  protected\r\n    class procedure CheckTypeSize(AValue: Longint); override;\r\n    Function BlobToBytes(aValue : JSValue) : TBytes; virtual;\r\n    Function BytesToBlob(aValue : TBytes) : JSValue; virtual;\r\n    function GetAsString: string; override;\r\n    function GetAsJSValue: JSValue; override;\r\n    function GetValue(var AValue: TBytes): Boolean;\r\n    procedure SetAsString(const AValue: string); override;\r\n    procedure SetVarValue(const AValue: JSValue); override;\r\n    Function GetAsBytes: TBytes; override;\r\n    Procedure SetAsBytes(const aValue: TBytes); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n  published\r\n    property Size default 16;\r\n  end;\r\n\r\n{ TBytesField }\r\n\r\n\r\n{ TBlobField }\r\n  TBlobStreamMode = (bmRead, bmWrite, bmReadWrite);\r\n//  TBlobType = ftBlob..ftMemo;\r\n\r\n  TBlobField = class(TBinaryField)\r\n  private\r\n    FModified : Boolean;\r\n    // Wrapper that retrieves FDataType as a TBlobType\r\n    //   function GetBlobType: TBlobType;\r\n    // Wrapper that calls SetFieldType\r\n    //   procedure SetBlobType(AValue: TBlobType);\r\n  protected\r\n    class procedure CheckTypeSize(AValue: Longint); override;\r\n    function GetBlobSize: Longint; virtual;\r\n    function GetIsNull: Boolean; override;\r\n    procedure GetText(var AText: string; ADisplayText{%H-}: Boolean); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    procedure Clear; override;\r\n    class function IsBlob: Boolean; override;\r\n    procedure SetFieldType(AValue: TFieldType); override;\r\n    property BlobSize: Longint read GetBlobSize;\r\n    property Modified: Boolean read FModified write FModified;\r\n    property Value: string read GetAsString write SetAsString;\r\n  published\r\n   // property BlobType: TBlobType read GetBlobType write SetBlobType; // default ftBlob;\r\n    property Size default 0;\r\n  end;\r\n\r\n{ TMemoField }\r\n\r\n  TMemoField = class(TBlobField)\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n  end;\r\n\r\n\r\n{ TVariantField }\r\n\r\n  TVariantField = class(TField)\r\n  protected\r\n    class procedure CheckTypeSize(aValue{%H-}: Integer); override;\r\n\r\n    function GetAsBoolean: Boolean; override;\r\n    procedure SetAsBoolean(aValue: Boolean); override;\r\n\r\n    function GetAsDateTime: TDateTime; override;\r\n    procedure SetAsDateTime(aValue: TDateTime); override;\r\n\r\n    function GetAsFloat: Double; override;\r\n    procedure SetAsFloat(aValue: Double); override;\r\n\r\n    function GetAsInteger: Longint; override;\r\n    procedure SetAsInteger(AValue: Longint); override;\r\n\r\n    function GetAsString: string; override;\r\n    procedure SetAsString(const aValue: string); override;\r\n\r\n\r\n    function GetAsJSValue: JSValue; override;\r\n    procedure SetVarValue(const aValue: JSValue); override;\r\n\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n  end;\r\n\r\n{ TIndexDef }\r\n\r\n  TIndexDefs = class;\r\n\r\n  TIndexOption = (ixPrimary, ixUnique, ixDescending, ixCaseInsensitive,\r\n    ixExpression, ixNonMaintained);\r\n  TIndexOptions = set of TIndexOption;\r\n\r\n  TIndexDef = class(TNamedItem)\r\n  Private\r\n    FCaseinsFields: string;\r\n    FDescFields: string;\r\n    FExpression : String;\r\n    FFields : String;\r\n    FOptions : TIndexOptions;\r\n    FSource : String;\r\n  protected\r\n    function GetExpression: string;\r\n    procedure SetCaseInsFields(const AValue: string); virtual;\r\n    procedure SetDescFields(const AValue: string);\r\n    procedure SetExpression(const AValue: string);\r\n  public\r\n    constructor Create(Owner: TIndexDefs; const AName, TheFields: string;\r\n      TheOptions: TIndexOptions); overload;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Expression: string read GetExpression write SetExpression;\r\n    property Fields: string read FFields write FFields;\r\n    property CaseInsFields: string read FCaseinsFields write SetCaseInsFields;\r\n    property DescFields: string read FDescFields write SetDescFields;\r\n    property Options: TIndexOptions read FOptions write FOptions;\r\n    property Source: string read FSource write FSource;\r\n  end;\r\n  TIndexDefClass = class of TIndexDef;\r\n{ TIndexDefs }\r\n\r\n  TIndexDefs = class(TDefCollection)\r\n  Private\r\n    Function  GetItem(Index: Integer): TIndexDef; reintroduce;\r\n    Procedure SetItem(Index: Integer; Value: TIndexDef); reintroduce;\r\n  public\r\n    constructor Create(ADataSet: TDataSet); virtual; overload;\r\n    procedure Add(const Name, Fields: string; Options: TIndexOptions); reintroduce;\r\n    Function AddIndexDef: TIndexDef;\r\n    function Find(const IndexName: string): TIndexDef; reintroduce;\r\n    function FindIndexForFields(const Fields{%H-}: string): TIndexDef;\r\n    function GetIndexForFields(const Fields: string;\r\n      CaseInsensitive: Boolean): TIndexDef;\r\n    procedure Update; overload; virtual;\r\n    Property Items[Index: Integer] : TIndexDef read GetItem write SetItem; default;\r\n  end;\r\n\r\n{ TCheckConstraint }\r\n\r\n  TCheckConstraint = class(TCollectionItem)\r\n  Private\r\n    FCustomConstraint : String;\r\n    FErrorMessage : String;\r\n    FFromDictionary : Boolean;\r\n    FImportedConstraint : String;\r\n  public\r\n    procedure Assign(Source{%H-}: TPersistent); override;\r\n  //  function GetDisplayName: string; override;\r\n  published\r\n    property CustomConstraint: string read FCustomConstraint write FCustomConstraint;\r\n    property ErrorMessage: string read FErrorMessage write FErrorMessage;\r\n    property FromDictionary: Boolean read FFromDictionary write FFromDictionary;\r\n    property ImportedConstraint: string read FImportedConstraint write FImportedConstraint;\r\n  end;\r\n\r\n{ TCheckConstraints }\r\n\r\n  TCheckConstraints = class(TCollection)\r\n  Private\r\n   Function GetItem(Index{%H-} : Longint) : TCheckConstraint; reintroduce;\r\n   Procedure SetItem(index{%H-} : Longint; Value{%H-} : TCheckConstraint); reintroduce;\r\n  protected\r\n    function GetOwner: TPersistent; override;\r\n  public\r\n    constructor Create(AOwner{%H-}: TPersistent); reintroduce;\r\n    function Add: TCheckConstraint; reintroduce;\r\n    property Items[Index: Longint]: TCheckConstraint read GetItem write SetItem; default;\r\n  end;\r\n\r\n  { TFieldsEnumerator }\r\n\r\n  TFieldsEnumerator = class\r\n  private\r\n    FPosition: Integer;\r\n    FFields: TFields;\r\n    function GetCurrent: TField;\r\n  public\r\n    constructor Create(AFields: TFields); reintroduce;\r\n    function MoveNext: Boolean;\r\n    property Current: TField read GetCurrent;\r\n  end;\r\n\r\n{ TFields }\r\n\r\n  TFields = Class(TObject)\r\n  Private\r\n    FDataset : TDataset;\r\n    FFieldList : TFpList;\r\n    FOnChange : TNotifyEvent;\r\n    FValidFieldKinds : TFieldKinds;\r\n  Protected\r\n    Procedure ClearFieldDefs;\r\n    Procedure Changed;\r\n    Procedure CheckfieldKind(Fieldkind : TFieldKind; Field : TField);\r\n    Function GetCount : Longint;\r\n    Function GetField (Index : Integer) : TField;\r\n    Procedure SetField(Index: Integer; Value: TField);\r\n    Procedure SetFieldIndex (Field : TField;Value : Integer);\r\n    Property OnChange : TNotifyEvent Read FOnChange Write FOnChange;\r\n    Property ValidFieldKinds : TFieldKinds Read FValidFieldKinds;\r\n  Public\r\n    Constructor Create(ADataset : TDataset); reintroduce;\r\n    Destructor Destroy;override;\r\n    Procedure Add(Field : TField);\r\n    Procedure CheckFieldName (Const Value : String);\r\n    Procedure CheckFieldNames (Const Value : String);\r\n    Procedure Clear;\r\n    Function FindField (Const Value : String) : TField;\r\n    Function FieldByName (Const Value : String) : TField;\r\n    Function FieldByNumber(FieldNo : Integer) : TField;\r\n    Function GetEnumerator: TFieldsEnumerator;\r\n    Procedure GetFieldNames (Values : TStrings);\r\n    Function IndexOf(Field : TField) : Longint;\r\n    procedure Remove(Value : TField);\r\n    Property Count : Integer Read GetCount;\r\n    Property Dataset : TDataset Read FDataset;\r\n    Property Fields [Index : Integer] : TField Read GetField Write SetField; default;\r\n  end;\r\n  TFieldsClass = Class of TFields;\r\n\r\n{ TParam }\r\n\r\n  TBlobData = TBytes;  // Delphi defines it as alias to TBytes\r\n\r\n  TParamBinding = array of integer;\r\n\r\n  TParamType = (ptUnknown, ptInput, ptOutput, ptInputOutput, ptResult);\r\n  TParamTypes = set of TParamType;\r\n\r\n  TParamStyle = (psInterbase,psPostgreSQL,psSimulated);\r\n\r\n  TParams = class;\r\n\r\n  TParam = class(TCollectionItem)\r\n  private\r\n    FValue: JSValue;\r\n    FPrecision: Integer;\r\n    FNumericScale: Integer;\r\n    FName: string;\r\n    FDataType: TFieldType;\r\n    FBound: Boolean;\r\n    FParamType: TParamType;\r\n    FSize: Integer;\r\n    Function GetDataSet: TDataSet;\r\n    Function IsParamStored: Boolean;\r\n  protected\r\n    Procedure AssignParam(Param: TParam);\r\n    Procedure AssignTo(Dest: TPersistent); override;\r\n    Function GetAsBoolean: Boolean;\r\n    Function GetAsBytes: TBytes;\r\n    Function GetAsDateTime: TDateTime;\r\n    Function GetAsFloat: Double;\r\n    Function GetAsInteger: Longint;\r\n    Function GetAsLargeInt: NativeInt;\r\n    Function GetAsMemo: string;\r\n    Function GetAsString: string;\r\n    Function GetAsJSValue: JSValue;\r\n    Function GetDisplayName: string; override;\r\n    Function GetIsNull: Boolean;\r\n    Function IsEqual(AValue: TParam): Boolean;\r\n    Procedure SetAsBlob(const AValue: TBlobData);\r\n    Procedure SetAsBoolean(AValue: Boolean);\r\n    Procedure SetAsBytes(const AValue{%H-}: TBytes);\r\n    Procedure SetAsDate(const AValue: TDateTime);\r\n    Procedure SetAsDateTime(const AValue: TDateTime);\r\n    Procedure SetAsFloat(const AValue: Double);\r\n    Procedure SetAsInteger(AValue: Longint);\r\n    Procedure SetAsLargeInt(AValue: NativeInt);\r\n    Procedure SetAsMemo(const AValue: string);\r\n    Procedure SetAsString(const AValue: string);\r\n    Procedure SetAsTime(const AValue: TDateTime);\r\n    Procedure SetAsJSValue(const AValue: JSValue);\r\n    Procedure SetDataType(AValue: TFieldType);\r\n    Procedure SetText(const AValue: string);\r\n  public\r\n    constructor Create(ACollection: TCollection); overload; override;\r\n    constructor Create(AParams: TParams; AParamType: TParamType); reintroduce; overload;\r\n    Procedure Assign(Source: TPersistent); override;\r\n    Procedure AssignField(Field: TField);\r\n    Procedure AssignToField(Field: TField);\r\n    Procedure AssignFieldValue(Field: TField; const AValue: JSValue);\r\n    Procedure AssignFromField(Field : TField);\r\n    Procedure Clear;\r\n    Property AsBlob : TBlobData read GetAsBytes  write SetAsBytes;\r\n    Property AsBoolean : Boolean read GetAsBoolean write SetAsBoolean;\r\n    Property AsBytes : TBytes read GetAsBytes write SetAsBytes;\r\n    Property AsDate : TDateTime read GetAsDateTime write SetAsDate;\r\n    Property AsDateTime : TDateTime read GetAsDateTime write SetAsDateTime;\r\n    Property AsFloat : Double read GetAsFloat write SetAsFloat;\r\n    Property AsInteger : LongInt read GetAsInteger write SetAsInteger;\r\n    Property AsLargeInt : NativeInt read GetAsLargeInt write SetAsLargeInt;\r\n    Property AsMemo : string read GetAsMemo write SetAsMemo;\r\n    Property AsSmallInt : LongInt read GetAsInteger write SetAsInteger;\r\n    Property AsString : string read GetAsString write SetAsString;\r\n    Property AsTime : TDateTime read GetAsDateTime write SetAsTime;\r\n    Property Bound : Boolean read FBound write FBound;\r\n    Property Dataset : TDataset Read GetDataset;\r\n    Property IsNull : Boolean read GetIsNull;\r\n    Property Text : string read GetAsString write SetText;\r\n  published\r\n    Property DataType : TFieldType read FDataType write SetDataType;\r\n    Property Name : string read FName write FName;\r\n    Property NumericScale : Integer read FNumericScale write FNumericScale default 0;\r\n    Property ParamType : TParamType read FParamType write FParamType;\r\n    Property Precision : Integer read FPrecision write FPrecision default 0;\r\n    Property Size : Integer read FSize write FSize default 0;\r\n    Property Value : JSValue read GetAsJSValue write SetAsJSValue stored IsParamStored;\r\n  end;\r\n  TParamClass = Class of TParam;\r\n\r\n{ TParams }\r\n\r\n  TParams = class(TCollection)\r\n  private\r\n    FOwner: TPersistent;\r\n    Function  GetItem(Index: Integer): TParam; reintroduce;\r\n    Function  GetParamValue(const ParamName: string): JSValue;\r\n    Procedure SetItem(Index: Integer; Value: TParam); reintroduce;\r\n    Procedure SetParamValue(const ParamName: string; const Value: JSValue);\r\n  protected\r\n    Procedure AssignTo(Dest: TPersistent); override;\r\n    Function  GetDataSet: TDataSet;\r\n    Function  GetOwner: TPersistent; override;\r\n    Class Function ParamClass : TParamClass; virtual;\r\n  public\r\n    Constructor Create(AOwner: TPersistent; AItemClass : TCollectionItemClass); overload;\r\n    Constructor Create(AOwner: TPersistent); overload;\r\n    Constructor Create; overload; reintroduce;\r\n    Procedure AddParam(Value: TParam);\r\n    Procedure AssignValues(Value: TParams);\r\n    Function  CreateParam(FldType: TFieldType; const ParamName: string; ParamType: TParamType): TParam;\r\n    Function  FindParam(const Value: string): TParam;\r\n    Procedure GetParamList(List: TList; const ParamNames: string);\r\n    Function  IsEqual(Value: TParams): Boolean;\r\n    Function  ParamByName(const Value: string): TParam;\r\n    Function  ParseSQL(SQL: String; DoCreate: Boolean): String; overload;\r\n    Function  ParseSQL(SQL: String; DoCreate, EscapeSlash, EscapeRepeat : Boolean; ParameterStyle : TParamStyle): String; overload;\r\n    Function  ParseSQL(SQL: String; DoCreate, EscapeSlash, EscapeRepeat : Boolean; ParameterStyle : TParamStyle; out ParamBinding: TParambinding): String; overload;\r\n    Function  ParseSQL(SQL: String; DoCreate, EscapeSlash, EscapeRepeat : Boolean; ParameterStyle : TParamStyle; out ParamBinding: TParambinding; out ReplaceString : string): String; overload;\r\n    Procedure RemoveParam(Value: TParam);\r\n    Procedure CopyParamValuesFromDataset(ADataset : TDataset; CopyBound : Boolean);\r\n    Property Dataset : TDataset Read GetDataset;\r\n    Property Items[Index: Integer] : TParam read GetItem write SetItem; default;\r\n    function Add: TParam; reintroduce;\r\n    Property ParamValues[const ParamName: string] : JSValue read GetParamValue write SetParamValue;\r\n  end;\r\n\r\n{ TDataSet }\r\n  \r\n  TBookmarkFlag = (bfCurrent, bfBOF, bfEOF, bfInserted);\r\n  TBookmark = record\r\n    Data : JSValue;\r\n    Flag : TBookmarkFlag;\r\n  end; // Bookmark is always the index in the data array.\r\n  TBookmarkStr = string; // JSON encoded version of the above\r\n\r\n  TGetMode = (gmCurrent, gmNext, gmPrior);\r\n  TGetResult = (grOK, grBOF, grEOF, grError);\r\n\r\n  TResyncMode = set of (rmExact, rmCenter);\r\n  TDataAction = (daFail, daAbort, daRetry);\r\n  TUpdateAction = (uaFail, uaAbort, uaSkip, uaRetry, uaApplied);\r\n  TUpdateKind = (ukModify, ukInsert, ukDelete);\r\n\r\n  TLocateOption = (loCaseInsensitive, loPartialKey, loFromCurrent);\r\n  TLocateOptions = set of TLocateOption;\r\n  TDataOperation = procedure of object;\r\n\r\n  TDataSetNotifyEvent = procedure(DataSet: TDataSet) of object;\r\n  TDataSetErrorEvent = procedure(DataSet: TDataSet; E: EDatabaseError;\r\n    var DataAction: TDataAction) of object;\r\n\r\n  TFilterOption = (foCaseInsensitive, foNoPartialCompare);\r\n  TFilterOptions = set of TFilterOption;\r\n\r\n  TLoadOption = (loNoOpen,loNoEvents,loAtEOF,loCancelPending);\r\n  TLoadOptions = Set of TLoadOption;\r\n  TDatasetLoadEvent = procedure(DataSet: TDataSet; Data : JSValue) of object;\r\n  TDatasetLoadFailEvent = procedure(DataSet: TDataSet; ID : Integer; Const ErrorMsg : String) of object;\r\n\r\n  TFilterRecordEvent = procedure(DataSet: TDataSet;\r\n    var Accept: Boolean) of object;\r\n  TDatasetClass = Class of TDataset;\r\n\r\n  TRecordState = (rsNew,rsClean,rsUpdate,rsDelete);\r\n  TDataRecord = record\r\n    data : JSValue;\r\n    state : TRecordState;\r\n    bookmark : JSValue;\r\n    bookmarkFlag : TBookmarkFlag;\r\n  end;\r\n  TBuffers = Array of TDataRecord;\r\n\r\n  TResolveInfo = record\r\n    Data : JSValue;\r\n    Status : TUpdateStatus;\r\n    ResolveStatus : TResolveStatus;\r\n    Error : String; // Only filled on error.\r\n    BookMark : TBookmark;\r\n    _private : JSValue; // for use by descendents of TDataset\r\n  end;\r\n  TResolveInfoArray = Array of TResolveInfo;\r\n\r\n  // Record so we can extend later on\r\n  TResolveResults = record\r\n    Records : TResolveInfoArray;\r\n  end;\r\n\r\n  TOnRecordResolveEvent = Procedure (Sender : TDataset; info : TResolveInfo) of object;\r\n  TApplyUpdatesEvent = Procedure (Sender : TDataset; info : TResolveResults) of object;\r\n\r\n{------------------------------------------------------------------------------}\r\n\r\n  TDataSet = class(TComponent)\r\n  Private\r\n    FAfterApplyUpdates: TApplyUpdatesEvent;\r\n    FAfterLoad: TDatasetNotifyEvent;\r\n    FBeforeApplyUpdates: TDatasetNotifyEvent;\r\n    FBeforeLoad: TDatasetNotifyEvent;\r\n    FBlockReadSize: Integer;\r\n    FCalcBuffer: TDataRecord;\r\n    FCalcFieldsCount: Longint;\r\n    FOnLoadFail: TDatasetLoadFailEvent;\r\n    FOnRecordResolved: TOnRecordResolveEvent;\r\n    FOpenAfterRead : boolean;\r\n    FActiveRecord: Longint;\r\n    FAfterCancel: TDataSetNotifyEvent;\r\n    FAfterClose: TDataSetNotifyEvent;\r\n    FAfterDelete: TDataSetNotifyEvent;\r\n    FAfterEdit: TDataSetNotifyEvent;\r\n    FAfterInsert: TDataSetNotifyEvent;\r\n    FAfterOpen: TDataSetNotifyEvent;\r\n    FAfterPost: TDataSetNotifyEvent;\r\n    FAfterRefresh: TDataSetNotifyEvent;\r\n    FAfterScroll: TDataSetNotifyEvent;\r\n    FAutoCalcFields: Boolean;\r\n    FBOF: Boolean;\r\n    FBeforeCancel: TDataSetNotifyEvent;\r\n    FBeforeClose: TDataSetNotifyEvent;\r\n    FBeforeDelete: TDataSetNotifyEvent;\r\n    FBeforeEdit: TDataSetNotifyEvent;\r\n    FBeforeInsert: TDataSetNotifyEvent;\r\n    FBeforeOpen: TDataSetNotifyEvent;\r\n    FBeforePost: TDataSetNotifyEvent;\r\n    FBeforeRefresh: TDataSetNotifyEvent;\r\n    FBeforeScroll: TDataSetNotifyEvent;\r\n    FBlobFieldCount: Longint;\r\n    FBuffers : TBuffers;\r\n    // The actual length of FBuffers is FBufferCount+1\r\n    FBufferCount: Longint;\r\n    FConstraints: TCheckConstraints;\r\n    FDisableControlsCount : Integer;\r\n    FDisableControlsState : TDatasetState;\r\n    FCurrentRecord: Longint;\r\n    FDataSources : TFPList;\r\n    FDefaultFields: Boolean;\r\n    FEOF: Boolean;\r\n    FEnableControlsEvent : TDataEvent;\r\n    FFieldList : TFields;\r\n    FFieldDefs: TFieldDefs;\r\n    FFilterOptions: TFilterOptions;\r\n    FFilterText: string;\r\n    FFiltered: Boolean;\r\n    FFound: Boolean;\r\n    FInternalCalcFields: Boolean;\r\n    FModified: Boolean;\r\n    FOnCalcFields: TDataSetNotifyEvent;\r\n    FOnDeleteError: TDataSetErrorEvent;\r\n    FOnEditError: TDataSetErrorEvent;\r\n    FOnFilterRecord: TFilterRecordEvent;\r\n    FOnNewRecord: TDataSetNotifyEvent;\r\n    FOnPostError: TDataSetErrorEvent;\r\n    FRecordCount: Longint;\r\n    FIsUniDirectional: Boolean;\r\n    FState : TDataSetState;\r\n    FInternalOpenComplete: Boolean;\r\n    FDataProxy : TDataProxy;\r\n    FDataRequestID : Integer;\r\n    FUpdateBatchID : Integer;\r\n    FChangeList : TFPList;\r\n    FBatchList : TFPList;\r\n    FInApplyupdates : Boolean;\r\n    FLoadCount : Integer;\r\n    FMinLoadID : Integer;\r\n    Procedure DoInsertAppend(DoAppend : Boolean);\r\n    Procedure DoInternalOpen;\r\n    Function  GetBuffer (Index : longint) : TDataRecord;\r\n    function GetDataProxy: TDataProxy;\r\n    function GetIsLoading: Boolean;\r\n    Procedure RegisterDataSource(ADataSource : TDataSource);\r\n    procedure SetConstraints(Value: TCheckConstraints);\r\n    procedure SetDataProxy(AValue: TDataProxy);\r\n    Procedure ShiftBuffersForward;\r\n    Procedure ShiftBuffersBackward;\r\n    Function  TryDoing (P : TDataOperation; Ev : TDatasetErrorEvent) : Boolean;\r\n    Function GetActive : boolean;\r\n    Procedure UnRegisterDataSource(ADataSource : TDataSource);\r\n    procedure SetBlockReadSize(AValue: Integer); virtual;\r\n    Procedure SetFieldDefs(AFieldDefs: TFieldDefs);\r\n    procedure DoInsertAppendRecord(const Values: array of jsValue; DoAppend : boolean);\r\n    // Callback for Tdataproxy.DoGetData;\r\n    function ResolveRecordUpdate(anUpdate: TRecordUpdateDescriptor): Boolean;\r\n    procedure HandleRequestResponse(ARequest: TDataRequest);\r\n  protected\r\n    // Proxy methods\r\n    // Override this to integrate package in local data\r\n    // call OnRecordResolved\r\n    procedure DoOnRecordResolved(anUpdate: TRecordUpdateDescriptor); virtual;\r\n    // Convert TRecordUpdateDescriptor to ResolveInfo\r\n    function RecordUpdateDescriptorToResolveInfo(anUpdate: TRecordUpdateDescriptor): TResolveInfo; virtual;\r\n    function DoResolveRecordUpdate(anUpdate{%H-}: TRecordUpdateDescriptor): Boolean; virtual;\r\n    Function GetRecordUpdates(AList: TRecordUpdateDescriptorList) : Integer; virtual;\r\n    procedure ResolveUpdateBatch(Sender: TObject; aBatch: TRecordUpdateBatch); virtual;\r\n    Function DataPacketReceived(ARequest{%H-}: TDataRequest) : Boolean; virtual;\r\n    function DoLoad(aOptions: TLoadOptions; aAfterLoad: TDatasetLoadEvent): Boolean; virtual;\r\n    function DoGetDataProxy: TDataProxy; virtual;\r\n    Procedure InitChangeList; virtual;\r\n    Procedure DoneChangeList; virtual;\r\n    Procedure ClearChangeList;\r\n    procedure ResetUpdateDescriptors;\r\n    Function IndexInChangeList(aBookmark: TBookmark): Integer; virtual;\r\n    Function AddToChangeList(aChange : TUpdateStatus) : TRecordUpdateDescriptor ; virtual;\r\n    Procedure RemoveFromChangeList(R : TRecordUpdateDescriptor); virtual;\r\n    Procedure DoApplyUpdates;\r\n    procedure RecalcBufListSize;\r\n    procedure ActivateBuffers; virtual;\r\n    procedure BindFields(Binding: Boolean);\r\n    procedure BlockReadNext; virtual;\r\n    function  BookmarkAvailable: Boolean;\r\n    procedure CalculateFields(Var Buffer: TDataRecord); virtual;\r\n    procedure CheckActive; virtual;\r\n    procedure CheckInactive; virtual;\r\n    procedure CheckBiDirectional;\r\n    procedure Loaded; override;\r\n    procedure ClearBuffers; virtual;\r\n    procedure ClearCalcFields(var Buffer{%H-}: TDataRecord); virtual;\r\n    procedure CloseBlob(Field{%H-}: TField); virtual;\r\n    procedure CloseCursor; virtual;\r\n    procedure CreateFields; virtual;\r\n    procedure DataEvent(Event: TDataEvent; Info: JSValue); virtual;\r\n    procedure DestroyFields; virtual;\r\n    procedure DoAfterCancel; virtual;\r\n    procedure DoAfterClose; virtual;\r\n    procedure DoAfterDelete; virtual;\r\n    procedure DoAfterEdit; virtual;\r\n    procedure DoAfterInsert; virtual;\r\n    procedure DoAfterOpen; virtual;\r\n    procedure DoAfterPost; virtual;\r\n    procedure DoAfterScroll; virtual;\r\n    procedure DoAfterRefresh; virtual;\r\n    procedure DoBeforeCancel; virtual;\r\n    procedure DoBeforeClose; virtual;\r\n    procedure DoBeforeDelete; virtual;\r\n    procedure DoBeforeEdit; virtual;\r\n    procedure DoBeforeInsert; virtual;\r\n    procedure DoBeforeOpen; virtual;\r\n    procedure DoBeforePost; virtual;\r\n    procedure DoBeforeScroll; virtual;\r\n    procedure DoBeforeRefresh; virtual;\r\n    procedure DoOnCalcFields; virtual;\r\n    procedure DoOnNewRecord; virtual;\r\n    procedure DoBeforeLoad; virtual;\r\n    procedure DoAfterLoad; virtual;\r\n    procedure DoBeforeApplyUpdates; virtual;\r\n    procedure DoAfterApplyUpdates(const ResolveInfo: TResolveResults); virtual;\r\n    function  FieldByNumber(FieldNo: Longint): TField;\r\n    function  FindRecord(Restart{%H-}, GoForward{%H-}: Boolean): Boolean; virtual;\r\n    function  GetBookmarkStr: TBookmarkStr; virtual;\r\n    procedure GetCalcFields(Var Buffer: TDataRecord); virtual;\r\n    function  GetCanModify: Boolean; virtual;\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); override;\r\n    function  GetFieldClass(FieldType: TFieldType): TFieldClass; virtual;\r\n    Function  GetfieldCount : Integer;\r\n    function  GetFieldValues(const FieldName : string) : JSValue; virtual;\r\n    function  GetIsIndexField(Field{%H-}: TField): Boolean; virtual;\r\n    function  GetIndexDefs(IndexDefs : TIndexDefs; IndexTypes : TIndexOptions) : TIndexDefs;\r\n    function  GetNextRecords: Longint; virtual;\r\n    function  GetNextRecord: Boolean; virtual;\r\n    function  GetPriorRecords: Longint; virtual;\r\n    function  GetPriorRecord: Boolean; virtual;\r\n    function  GetRecordCount: Longint; virtual;\r\n    function  GetRecNo: Longint; virtual;\r\n    procedure InitFieldDefs; virtual;\r\n    procedure InitFieldDefsFromfields;\r\n    procedure InitRecord(var Buffer: TDataRecord); virtual;\r\n    procedure InternalCancel; virtual;\r\n    procedure InternalEdit; virtual;\r\n    procedure InternalInsert; virtual;\r\n    procedure InternalRefresh; virtual;\r\n    procedure OpenCursor(InfoQuery: Boolean); virtual;\r\n    procedure OpenCursorcomplete; virtual;\r\n    procedure RefreshInternalCalcFields(Var Buffer{%H-}: TDataRecord); virtual;\r\n    procedure RestoreState(const Value: TDataSetState);\r\n    Procedure SetActive (Value : Boolean); virtual;\r\n    procedure SetBookmarkStr(const Value: TBookmarkStr); virtual;\r\n    procedure SetBufListSize(Value: Longint); virtual;\r\n    procedure SetChildOrder(Child: TComponent; Order: Longint); override;\r\n    procedure SetCurrentRecord(Index: Longint); virtual;\r\n    procedure SetDefaultFields(const Value: Boolean);\r\n    procedure SetFiltered(Value: Boolean); virtual;\r\n    procedure SetFilterOptions(Value: TFilterOptions); virtual;\r\n    procedure SetFilterText(const Value: string); virtual;\r\n    procedure SetFieldValues(const FieldName: string; Value: JSValue); virtual;\r\n    procedure SetFound(const Value: Boolean); virtual;\r\n    procedure SetModified(Value: Boolean);\r\n    procedure SetName(const NewName: TComponentName); override;\r\n    procedure SetOnFilterRecord(const Value: TFilterRecordEvent); virtual;\r\n    procedure SetRecNo(Value{%H-}: Longint); virtual;\r\n    procedure SetState(Value: TDataSetState);\r\n    function SetTempState(const Value: TDataSetState): TDataSetState;\r\n    Function TempBuffer: TDataRecord;\r\n    procedure UpdateIndexDefs; virtual;\r\n    property ActiveRecord: Longint read FActiveRecord;\r\n    property CurrentRecord: Longint read FCurrentRecord;\r\n    property BlobFieldCount: Longint read FBlobFieldCount;\r\n    property Buffers[Index: Longint]: TDataRecord read GetBuffer;\r\n    property BufferCount: Longint read FBufferCount;\r\n    property CalcBuffer: TDataRecord read FCalcBuffer;\r\n    property CalcFieldsCount: Longint read FCalcFieldsCount;\r\n    property InternalCalcFields: Boolean read FInternalCalcFields;\r\n    property Constraints: TCheckConstraints read FConstraints write SetConstraints;\r\n    function AllocRecordBuffer: TDataRecord; virtual;\r\n    procedure FreeRecordBuffer(var Buffer{%H-}: TDataRecord); virtual;\r\n    procedure GetBookmarkData(Buffer{%H-}: TDataRecord; var Data{%H-}: TBookmark); virtual;\r\n    function GetBookmarkFlag(Buffer{%H-}: TDataRecord): TBookmarkFlag; virtual;\r\n    function GetDataSource: TDataSource; virtual;\r\n    function GetRecordSize: Word; virtual;\r\n    procedure InternalAddRecord(Buffer{%H-}: Pointer; AAppend{%H-}: Boolean); virtual;\r\n    procedure InternalDelete; virtual;\r\n    procedure InternalFirst; virtual;\r\n    procedure InternalGotoBookmark(ABookmark{%H-}: TBookmark); virtual;\r\n    procedure InternalHandleException(E: Exception); virtual;\r\n    procedure InternalInitRecord(var Buffer{%H-}: TDataRecord); virtual;\r\n    procedure InternalLast; virtual;\r\n    procedure InternalPost; virtual;\r\n    procedure InternalSetToRecord(Buffer{%H-}: TDataRecord); virtual;\r\n    procedure SetBookmarkFlag(Var Buffer{%H-}: TDataRecord; Value{%H-}: TBookmarkFlag); virtual;\r\n    procedure SetBookmarkData(Var Buffer{%H-}: TDataRecord; Data{%H-}: TBookmark); virtual;\r\n    procedure SetUniDirectional(const Value: Boolean);\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    // These use the active buffer\r\n    function GetFieldData(Field: TField): JSValue;  virtual; overload;\r\n    procedure SetFieldData(Field: TField; AValue : JSValue);  virtual; overload;\r\n    function GetFieldData(Field: TField; Buffer: TDatarecord): JSValue;  virtual; overload;\r\n    procedure SetFieldData(Field: TField; var Buffer: TDatarecord; AValue : JSValue);  virtual; overload;\r\n    class function FieldDefsClass : TFieldDefsClass; virtual;\r\n    class function FieldsClass : TFieldsClass; virtual;\r\n  protected { abstract methods }\r\n    function GetRecord(var Buffer: TDataRecord; GetMode: TGetMode; DoCheck: Boolean): TGetResult; virtual; abstract;\r\n    procedure InternalClose; virtual; abstract;\r\n    procedure InternalOpen; virtual; abstract;\r\n    procedure InternalInitFieldDefs; virtual; abstract;\r\n    function IsCursorOpen: Boolean; virtual; abstract;\r\n    property DataProxy : TDataProxy Read GetDataProxy Write SetDataProxy;\r\n    Property LoadCount : Integer Read FLoadCount;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function ActiveBuffer: TDataRecord;\r\n    procedure Append;\r\n    procedure AppendRecord(const Values: array of jsValue);\r\n    function BookmarkValid(ABookmark{%H-}: TBookmark): Boolean; virtual;\r\n    function ConvertToDateTime(aField : TField; aValue : JSValue; ARaiseException : Boolean) : TDateTime; virtual;\r\n    function ConvertDateTimeToNative(aField : TField; aValue : TDateTime) : JSValue; virtual;\r\n    Class function DefaultConvertToDateTime(aField : TField; aValue : JSValue; ARaiseException{%H-} : Boolean) : TDateTime; virtual;\r\n    Class function DefaultConvertDateTimeToNative(aField : TField; aValue : TDateTime) : JSValue; virtual;\r\n    Function BlobDataToBytes(aValue : JSValue) : TBytes; virtual;\r\n    Class Function DefaultBlobDataToBytes(aValue : JSValue) : TBytes; virtual;\r\n    Function BytesToBlobData(aValue : TBytes) : JSValue ; virtual;\r\n    Class Function DefaultBytesToBlobData(aValue : TBytes) : JSValue; virtual;\r\n    procedure Cancel; virtual;\r\n    procedure CheckBrowseMode;\r\n    procedure ClearFields;\r\n    procedure Close;\r\n    Procedure ApplyUpdates;\r\n    function  ControlsDisabled: Boolean;\r\n    function CompareBookmarks(Bookmark1{%H-}, Bookmark2{%H-}: TBookmark): Longint; virtual;\r\n    procedure CursorPosChanged;\r\n    procedure Delete; virtual;\r\n    procedure DisableControls;\r\n    procedure Edit;\r\n    procedure EnableControls;\r\n    function FieldByName(const FieldName: string): TField;\r\n    function FindField(const FieldName: string): TField;\r\n    function FindFirst: Boolean; virtual;\r\n    function FindLast: Boolean; virtual;\r\n    function FindNext: Boolean; virtual;\r\n    function FindPrior: Boolean; virtual;\r\n    procedure First;\r\n    procedure FreeBookmark(ABookmark{%H-}: TBookmark); virtual;\r\n    function GetBookmark: TBookmark; virtual;\r\n    function GetCurrentRecord(Buffer{%H-}: TDataRecord): Boolean; virtual;\r\n    procedure GetFieldList(List: TList; const FieldNames: string); overload;\r\n    procedure GetFieldList(List: TFPList; const FieldNames: string); overload;\r\n    procedure GetFieldNames(List: TStrings);\r\n    procedure GotoBookmark(const ABookmark: TBookmark);\r\n    procedure Insert; reintroduce;\r\n    procedure InsertRecord(const Values: array of JSValue);\r\n    function IsEmpty: Boolean;\r\n    function IsLinkedTo(ADataSource: TDataSource): Boolean;\r\n    function IsSequenced: Boolean; virtual;\r\n    procedure Last;\r\n    Function Load(aOptions : TLoadOptions; aAfterLoad : TDatasetLoadEvent) : Boolean;\r\n    function Locate(const KeyFields{%H-}: string; const KeyValues{%H-}: JSValue; Options{%H-}: TLocateOptions) : boolean; virtual;\r\n    function Lookup(const KeyFields{%H-}: string; const KeyValues{%H-}: JSValue; const ResultFields{%H-}: string): JSValue; virtual;\r\n    function MoveBy(Distance: Longint): Longint;\r\n    procedure Next;\r\n    procedure Open;\r\n    procedure Post; virtual;\r\n    procedure Prior;\r\n    procedure Refresh;\r\n    procedure Resync(Mode: TResyncMode); virtual;\r\n    Procedure CancelLoading;\r\n    procedure SetFields(const Values: array of JSValue);\r\n    procedure UpdateCursorPos;\r\n    procedure UpdateRecord;\r\n    Function GetPendingUpdates : TResolveInfoArray;\r\n    Property Loading : Boolean Read GetIsLoading;\r\n    property BlockReadSize: Integer read FBlockReadSize write SetBlockReadSize;\r\n    property BOF: Boolean read FBOF;\r\n    property Bookmark: TBookmark read GetBookmark write GotoBookmark;\r\n    property CanModify: Boolean read GetCanModify;\r\n    property DataSource: TDataSource read GetDataSource;\r\n    property DefaultFields: Boolean read FDefaultFields;\r\n    property EOF: Boolean read FEOF;\r\n    property FieldCount: Longint read GetFieldCount;\r\n    property FieldDefs: TFieldDefs read FFieldDefs write SetFieldDefs;\r\n    property Found: Boolean read FFound;\r\n    property Modified: Boolean read FModified;\r\n    property IsUniDirectional: Boolean read FIsUniDirectional default False;\r\n    property RecordCount: Longint read GetRecordCount;\r\n    property RecNo: Longint read GetRecNo write SetRecNo;\r\n    property RecordSize: Word read GetRecordSize;\r\n    property State: TDataSetState read FState;\r\n    property Fields : TFields read FFieldList;\r\n    property FieldValues[FieldName : string] : JSValue read GetFieldValues write SetFieldValues; default;\r\n    property Filter: string read FFilterText write SetFilterText;\r\n    property Filtered: Boolean read FFiltered write SetFiltered default False;\r\n    property FilterOptions: TFilterOptions read FFilterOptions write SetFilterOptions;\r\n    property Active: Boolean read GetActive write SetActive default False;\r\n    property AutoCalcFields: Boolean read FAutoCalcFields write FAutoCalcFields default true;\r\n    property BeforeOpen: TDataSetNotifyEvent read FBeforeOpen write FBeforeOpen;\r\n    property AfterOpen: TDataSetNotifyEvent read FAfterOpen write FAfterOpen;\r\n    property BeforeClose: TDataSetNotifyEvent read FBeforeClose write FBeforeClose;\r\n    property AfterClose: TDataSetNotifyEvent read FAfterClose write FAfterClose;\r\n    property BeforeInsert: TDataSetNotifyEvent read FBeforeInsert write FBeforeInsert;\r\n    property AfterInsert: TDataSetNotifyEvent read FAfterInsert write FAfterInsert;\r\n    property BeforeEdit: TDataSetNotifyEvent read FBeforeEdit write FBeforeEdit;\r\n    property AfterEdit: TDataSetNotifyEvent read FAfterEdit write FAfterEdit;\r\n    property BeforePost: TDataSetNotifyEvent read FBeforePost write FBeforePost;\r\n    property AfterPost: TDataSetNotifyEvent read FAfterPost write FAfterPost;\r\n    property BeforeCancel: TDataSetNotifyEvent read FBeforeCancel write FBeforeCancel;\r\n    property AfterCancel: TDataSetNotifyEvent read FAfterCancel write FAfterCancel;\r\n    property BeforeDelete: TDataSetNotifyEvent read FBeforeDelete write FBeforeDelete;\r\n    property AfterDelete: TDataSetNotifyEvent read FAfterDelete write FAfterDelete;\r\n    property BeforeScroll: TDataSetNotifyEvent read FBeforeScroll write FBeforeScroll;\r\n    property AfterScroll: TDataSetNotifyEvent read FAfterScroll write FAfterScroll;\r\n    property BeforeRefresh: TDataSetNotifyEvent read FBeforeRefresh write FBeforeRefresh;\r\n    property BeforeLoad : TDatasetNotifyEvent Read FBeforeLoad Write FBeforeLoad;\r\n    Property AfterLoad : TDatasetNotifyEvent Read FAfterLoad Write FAfterLoad;\r\n    Property BeforeApplyUpdates : TDatasetNotifyEvent Read FBeforeApplyUpdates Write FBeforeApplyUpdates;\r\n    Property AfterApplyUpdates : TApplyUpdatesEvent Read FAfterApplyUpdates Write FAfterApplyUpdates;\r\n    property AfterRefresh: TDataSetNotifyEvent read FAfterRefresh write FAfterRefresh;\r\n    property OnCalcFields: TDataSetNotifyEvent read FOnCalcFields write FOnCalcFields;\r\n    property OnDeleteError: TDataSetErrorEvent read FOnDeleteError write FOnDeleteError;\r\n    property OnEditError: TDataSetErrorEvent read FOnEditError write FOnEditError;\r\n    property OnFilterRecord: TFilterRecordEvent read FOnFilterRecord write SetOnFilterRecord;\r\n    property OnNewRecord: TDataSetNotifyEvent read FOnNewRecord write FOnNewRecord;\r\n    Property OnRecordResolved : TOnRecordResolveEvent Read FOnRecordResolved Write FOnRecordResolved;\r\n    property OnPostError: TDataSetErrorEvent read FOnPostError write FOnPostError;\r\n    property OnLoadFail : TDatasetLoadFailEvent Read FOnLoadFail Write FOnLoadFail;\r\n  end;\r\n\r\n{ TDataLink }\r\n\r\n  TDataLink = class(TPersistent)\r\n  private\r\n    FFirstRecord,\r\n    FBufferCount : Integer;\r\n    FActive,\r\n    FDataSourceFixed,\r\n    FEditing,\r\n    FReadOnly,\r\n    FUpdatingRecord,\r\n    FVisualControl : Boolean;\r\n    FDataSource : TDataSource;\r\n    Function  CalcFirstRecord(Index : Integer) : Integer;\r\n    Procedure CalcRange;\r\n    Procedure CheckActiveAndEditing;\r\n    Function  GetDataset : TDataset;\r\n    procedure SetActive(AActive: Boolean);\r\n    procedure SetDataSource(Value: TDataSource);\r\n    Procedure SetReadOnly(Value : Boolean);\r\n  protected\r\n    procedure ActiveChanged; virtual;\r\n    procedure CheckBrowseMode; virtual;\r\n    procedure DataEvent(Event: TDataEvent; Info: JSValue); virtual;\r\n    procedure DataSetChanged; virtual;\r\n    procedure DataSetScrolled(Distance{%H-}: Integer); virtual;\r\n    procedure EditingChanged; virtual;\r\n    procedure FocusControl(Field{%H-}: JSValue); virtual;\r\n    function  GetActiveRecord: Integer; virtual;\r\n    function  GetBOF: Boolean; virtual;\r\n    function  GetBufferCount: Integer; virtual;\r\n    function  GetEOF: Boolean; virtual;\r\n    function  GetRecordCount: Integer; virtual;\r\n    procedure LayoutChanged; virtual;\r\n    function  MoveBy(Distance: Integer): Integer; virtual;\r\n    procedure RecordChanged(Field{%H-}: TField); virtual;\r\n    procedure SetActiveRecord(Value: Integer); virtual;\r\n    procedure SetBufferCount(Value: Integer); virtual;\r\n    procedure UpdateData; virtual;\r\n    property VisualControl: Boolean read FVisualControl write FVisualControl;\r\n    property FirstRecord: Integer read FFirstRecord write FFirstRecord;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    function  Edit: Boolean;\r\n    procedure UpdateRecord;\r\n    property Active: Boolean read FActive;\r\n    property ActiveRecord: Integer read GetActiveRecord write SetActiveRecord;\r\n    property BOF: Boolean read GetBOF;\r\n    property BufferCount: Integer read GetBufferCount write SetBufferCount;\r\n    property DataSet: TDataSet read GetDataSet;\r\n    property DataSource: TDataSource read FDataSource write SetDataSource;\r\n    property DataSourceFixed: Boolean read FDataSourceFixed write FDataSourceFixed;\r\n    property Editing: Boolean read FEditing;\r\n    property Eof: Boolean read GetEOF;\r\n    property ReadOnly: Boolean read FReadOnly write SetReadOnly;\r\n    property RecordCount: Integer read GetRecordCount;\r\n  end;\r\n\r\n{ TDetailDataLink }\r\n\r\n  TDetailDataLink = class(TDataLink)\r\n  protected\r\n    function GetDetailDataSet: TDataSet; virtual;\r\n  public\r\n    property DetailDataSet: TDataSet read GetDetailDataSet;\r\n  end;\r\n\r\n{ TMasterDataLink }\r\n\r\n  TMasterDataLink = class(TDetailDataLink)\r\n  private\r\n    FDetailDataSet: TDataSet;\r\n    FFieldNames: string;\r\n    FFields: TList;\r\n    FOnMasterChange: TNotifyEvent;\r\n    FOnMasterDisable: TNotifyEvent;\r\n    procedure SetFieldNames(const Value: string);\r\n  protected\r\n    procedure ActiveChanged; override;\r\n    procedure CheckBrowseMode; override;\r\n    function GetDetailDataSet: TDataSet; override;\r\n    procedure LayoutChanged; override;\r\n    procedure RecordChanged(Field: TField); override;\r\n    Procedure DoMasterDisable; virtual;\r\n    Procedure DoMasterChange; virtual;\r\n  public\r\n    constructor Create(ADataSet: TDataSet);virtual; reintroduce;\r\n    destructor Destroy; override;\r\n    property FieldNames: string read FFieldNames write SetFieldNames;\r\n    property Fields: TList read FFields;\r\n    property OnMasterChange: TNotifyEvent read FOnMasterChange write FOnMasterChange;\r\n    property OnMasterDisable: TNotifyEvent read FOnMasterDisable write FOnMasterDisable;\r\n  end;\r\n\r\n{ TMasterParamsDataLink }\r\n\r\n  TMasterParamsDataLink = Class(TMasterDataLink)\r\n  Private\r\n    FParams : TParams;\r\n    Procedure SetParams(AValue : TParams);\r\n  Protected\r\n    Procedure DoMasterDisable; override;\r\n    Procedure DoMasterChange; override;\r\n  Public\r\n    constructor Create(ADataSet: TDataSet); override;\r\n    Procedure RefreshParamNames; virtual;\r\n    Procedure CopyParamsFromMaster(CopyBound : Boolean); virtual;\r\n    Property Params : TParams Read FParams Write SetParams;\r\n  end;\r\n\r\n{ TDataSource }\r\n\r\n  TDataChangeEvent = procedure(Sender: TObject; Field: TField) of object;\r\n\r\n  TDataSource = class(TComponent)\r\n  private\r\n    FDataSet: TDataSet;\r\n    FDataLinks: TList;\r\n    FEnabled: Boolean;\r\n    FAutoEdit: Boolean;\r\n    FState: TDataSetState;\r\n    FOnStateChange: TNotifyEvent;\r\n    FOnDataChange: TDataChangeEvent;\r\n    FOnUpdateData: TNotifyEvent;\r\n    procedure DistributeEvent(Event: TDataEvent; Info: JSValue);\r\n    procedure RegisterDataLink(DataLink: TDataLink);\r\n    Procedure ProcessEvent(Event : TDataEvent; Info : JSValue);\r\n    procedure SetDataSet(ADataSet: TDataSet);\r\n    procedure SetEnabled(Value: Boolean);\r\n    procedure UnregisterDataLink(DataLink: TDataLink);\r\n  protected\r\n    Procedure DoDataChange (Info : Pointer);virtual;\r\n    Procedure DoStateChange; virtual;\r\n    Procedure DoUpdateData;\r\n    property DataLinks: TList read FDataLinks;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Edit;\r\n    function IsLinkedTo(ADataSet{%H-}: TDataSet): Boolean;\r\n    property State: TDataSetState read FState;\r\n  published\r\n    property AutoEdit: Boolean read FAutoEdit write FAutoEdit default True;\r\n    property DataSet: TDataSet read FDataSet write SetDataSet;\r\n    property Enabled: Boolean read FEnabled write SetEnabled default True;\r\n    property OnStateChange: TNotifyEvent read FOnStateChange write FOnStateChange;\r\n    property OnDataChange: TDataChangeEvent read FOnDataChange write FOnDataChange;\r\n    property OnUpdateData: TNotifyEvent read FOnUpdateData write FOnUpdateData;\r\n  end;\r\n\r\n\r\n  { TDataRequest }\r\n  TDataRequestResult = (rrFail,rrEOF,rrOK);\r\n  TDataRequestEvent = Procedure (ARequest : TDataRequest) of object;\r\n\r\n  TDataRequest = Class(TObject)\r\n  private\r\n    FBookmark: TBookMark;\r\n    FCurrent: TBookMark;\r\n    FDataset: TDataset;\r\n    FErrorMsg: String;\r\n    FEvent: TDatasetLoadEvent;\r\n    FLoadOptions: TLoadOptions;\r\n    FRequestID: Integer;\r\n    FSuccess: TDataRequestResult;\r\n    FData : JSValue;\r\n    FAfterRequest : TDataRequestEvent;\r\n    FDataProxy : TDataProxy;\r\n  Protected\r\n    Procedure DoAfterRequest;\r\n  Public\r\n    Constructor Create(aDataProxy : TDataProxy; aOptions: TLoadOptions; aAfterRequest: TDataRequestEvent; aAfterLoad: TDatasetLoadEvent); virtual; reintroduce;\r\n    property DataProxy : TDataProxy Read FDataProxy;\r\n    Property Dataset : TDataset Read FDataset;\r\n    Property Bookmark : TBookMark Read FBookmark;\r\n    Property RequestID : Integer Read FRequestID;\r\n    Property LoadOptions : TLoadOptions Read FLoadOptions;\r\n    Property Current : TBookMark Read FCurrent;\r\n    Property Success : TDataRequestResult Read FSuccess Write FSuccess;\r\n    Property Event : TDatasetLoadEvent Read FEvent;\r\n    Property ErrorMsg : String Read FErrorMsg Write FErrorMsg;\r\n    Property Data : JSValue read FData Write FData;\r\n  end;\r\n  TDataRequestClass = Class of TDataRequest;\r\n\r\n  { TRecordUpdateDescriptor }\r\n\r\n  TRecordUpdateDescriptor = Class(TObject)\r\n  private\r\n    FBookmark: TBookmark;\r\n    FData: JSValue;\r\n    FDataset: TDataset;\r\n    FProxy: TDataProxy;\r\n    FResolveStatus: TResolveStatus;\r\n    FResolveError: String;\r\n    FServerData: JSValue;\r\n    FStatus: TUpdateStatus;\r\n  Protected\r\n    Procedure SetResolveStatus(aValue : TResolveStatus); virtual;\r\n    Procedure Reset;\r\n  Public\r\n    Constructor Create(aProxy : TDataProxy; aDataset : TDataset; aBookmark : TBookMark; AData : JSValue; AStatus : TUpdateStatus); reintroduce;\r\n    Procedure Resolve(aData : JSValue);\r\n    Procedure ResolveFailed(aError : String);\r\n    Property Proxy : TDataProxy read FProxy;\r\n    Property Dataset : TDataset Read FDataset;\r\n    Property OriginalStatus : TUpdateStatus Read FStatus; deprecated;\r\n    Property Status : TUpdateStatus Read FStatus;\r\n    Property ResolveStatus : TResolveStatus Read FResolveStatus;\r\n    Property ServerData : JSValue Read FServerData;\r\n    Property Data : JSValue Read FData;\r\n    Property Bookmark : TBookmark Read FBookmark;\r\n    Property ResolveError : String Read FResolveError ;\r\n  end;\r\n  TRecordUpdateDescriptorClass = Class of TRecordUpdateDescriptor;\r\n\r\n  { TRecordUpdateDescriptorList }\r\n\r\n  TRecordUpdateDescriptorList = Class(TFPList)\r\n  private\r\n    function GetUpdate(AIndex : Integer): TRecordUpdateDescriptor;\r\n  Public\r\n    Property UpdateDescriptors[AIndex : Integer] : TRecordUpdateDescriptor Read GetUpdate; Default;\r\n  end;\r\n\r\n  { TRecordUpdateBatch }\r\n  TUpdateBatchStatus = (ubsPending,ubsProcessing,ubsProcessed,ubsResolved);\r\n  TResolveBatchEvent = Procedure (Sender : TObject; ARequest : TRecordUpdateBatch) of object;\r\n\r\n  TRecordUpdateBatch = class(TObject)\r\n  private\r\n    FBatchID: Integer;\r\n    FDataset: TDataset;\r\n    FLastChangeIndex: Integer;\r\n    FList: TRecordUpdateDescriptorList;\r\n    FOnResolve: TResolveBatchEvent;\r\n    FOwnsList: Boolean;\r\n    FStatus: TUpdateBatchStatus;\r\n  Protected\r\n    Property LastChangeIndex : Integer Read FLastChangeIndex;\r\n  Public\r\n    Constructor Create (aBatchID : Integer; AList : TRecordUpdateDescriptorList; AOwnsList : Boolean); reintroduce;\r\n    Destructor Destroy; override;\r\n    Procedure FreeList;\r\n    Property Dataset : TDataset Read FDataset Write FDataset;\r\n    Property OnResolve : TResolveBatchEvent Read FOnResolve Write FOnResolve;\r\n    Property OwnsList : Boolean Read FOwnsList;\r\n    property BatchID : Integer Read FBatchID;\r\n    Property Status : TUpdateBatchStatus Read FStatus Write FStatus;\r\n    Property List : TRecordUpdateDescriptorList Read FList;\r\n  end;\r\n  TRecordUpdateBatchClass = Class of TRecordUpdateBatch;\r\n\r\n  { TDataProxy }\r\n\r\n  TDataProxy = Class(TComponent)\r\n  Protected\r\n    Function GetDataRequestClass : TDataRequestClass; virtual;\r\n    Function GetUpdateDescriptorClass : TRecordUpdateDescriptorClass; virtual;\r\n    Function GetUpdateBatchClass : TRecordUpdateBatchClass; virtual;\r\n    // Use this to call resolve event, and free the batch.\r\n    Procedure ResolveBatch(aBatch : TRecordUpdateBatch);\r\n  Public\r\n    Function GetDataRequest(aOptions: TLoadOptions; aAfterRequest: TDataRequestEvent; aAfterLoad: TDatasetLoadEvent) : TDataRequest; virtual;\r\n    Function GetUpdateDescriptor(aDataset : TDataset; aBookmark : TBookMark; AData : JSValue; AStatus : TUpdateStatus) : TRecordUpdateDescriptor; virtual;\r\n    function GetRecordUpdateBatch(aBatchID: Integer; AList: TRecordUpdateDescriptorList; AOwnsList: Boolean=True): TRecordUpdateBatch; virtual;\r\n    // actual calls to do the work. Dataset wi\r\n    Function DoGetData(aRequest : TDataRequest) : Boolean; virtual; abstract;\r\n    // TDataProxy is responsible for calling OnResolve and if not, Freeing the batch.\r\n    Function ProcessUpdateBatch(aBatch : TRecordUpdateBatch): Boolean; virtual; abstract;\r\n  end;\r\n\r\nconst\r\n  {\r\n  TFieldType = (\r\n    ftUnknown, ftString, ftInteger, ftLargeInt, ftBoolean, ftFloat, ftDate,\r\n    ftTime, ftDateTime,  ftAutoInc, ftBlob, ftMemo, ftFixedChar,\r\n    ftVariant\r\n  );\r\n  }\r\n\r\nConst\r\n  Fieldtypenames : Array [TFieldType] of String =\r\n    (\r\n      {ftUnknown} 'Unknown',\r\n      {ftString} 'String',\r\n      {ftInteger} 'Integer',\r\n      {ftLargeint} 'NativeInt',\r\n      {ftBoolean} 'Boolean',\r\n      {ftFloat} 'Float',\r\n      {ftDate} 'Date',\r\n      {ftTime} 'Time',\r\n      {ftDateTime} 'DateTime',\r\n      {ftAutoInc} 'AutoInc',\r\n      {ftBlob} 'Blob',\r\n      {ftMemo} 'Memo',\r\n      {ftFixedChar} 'FixedChar',\r\n      {ftVariant} 'Variant',\r\n      {ftDataset} 'Dataset'\r\n    );\r\n\r\n  DefaultFieldClasses : Array [TFieldType] of TFieldClass =\r\n    (\r\n      { ftUnknown} Tfield,\r\n      { ftString} TStringField,\r\n      { ftInteger} TIntegerField,\r\n      { ftLargeint} TLargeIntField,\r\n      { ftBoolean} TBooleanField,\r\n      { ftFloat} TFloatField,\r\n      { ftDate} TDateField,\r\n      { ftTime} TTimeField,\r\n      { ftDateTime} TDateTimeField,\r\n      { ftAutoInc} TAutoIncField,\r\n      { ftBlob} TBlobField,\r\n      { ftMemo} TMemoField,\r\n      { ftFixedChar} TStringField,\r\n      { ftVariant} TVariantField,\r\n      { ftDataset} Nil\r\n    );\r\n\r\n  dsEditModes = [dsEdit, dsInsert, dsSetKey];\r\n  dsWriteModes = [dsEdit, dsInsert, dsSetKey, dsCalcFields, dsFilter,\r\n                  dsNewValue, dsInternalCalc, dsRefreshFields];\r\n  // Correct list of all field types that are BLOB types.\r\n  // Please use this instead of checking TBlobType which will give\r\n  // incorrect results\r\n  ftBlobTypes = [ftBlob, ftMemo];\r\n\r\n\r\n{ Auxiliary functions }\r\n\r\nProcedure DatabaseError (Const Msg : String); overload;\r\nProcedure DatabaseError (Const Msg : String; Comp : TComponent); overload;\r\nProcedure DatabaseErrorFmt (Const Fmt : String; Const Args : Array Of JSValue); overload;\r\nProcedure DatabaseErrorFmt (Const Fmt : String; Const Args : Array Of JSValue; Comp : TComponent); overload;\r\nFunction ExtractFieldName(Const Fields: String; var Pos: Integer): String;\r\n\r\n// function SkipComments(var p: PChar; EscapeSlash, EscapeRepeat : Boolean) : boolean;\r\n\r\n// operator Enumerator(ADataSet: TDataSet): TDataSetEnumerator;\r\n \r\nimplementation\r\n\r\nuses DBConst,TypInfo;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Auxiliary functions\r\n  ---------------------------------------------------------------------}\r\n\r\nProcedure DatabaseError (Const Msg : String);\r\n\r\nbegin\r\n  Raise EDataBaseError.Create(Msg);\r\nend;\r\n\r\nProcedure DatabaseError (Const Msg : String; Comp : TComponent);\r\n\r\nbegin\r\n  if assigned(Comp) and (Comp.Name <> '') then\r\n    Raise EDatabaseError.CreateFmt('%s : %s',[Comp.Name,Msg])\r\n  else\r\n    DatabaseError(Msg);\r\nend;\r\n\r\nProcedure DatabaseErrorFmt (Const Fmt : String; Const Args : Array Of JSValue);\r\n\r\nbegin\r\n  Raise EDatabaseError.CreateFmt(Fmt,Args);\r\nend;\r\n\r\nProcedure DatabaseErrorFmt (Const Fmt : String; Const Args : Array Of JSValue;\r\n                            Comp : TComponent);\r\nbegin\r\n  if assigned(comp) then\r\n    Raise EDatabaseError.CreateFmt(Format('%s : %s',[Comp.Name,Fmt]),Args)\r\n  else\r\n    DatabaseErrorFmt(Fmt, Args);\r\nend;\r\n\r\nfunction ExtractFieldName(const Fields: string; var Pos: Integer): string;\r\nvar\r\n  i: Integer;\r\n  FieldsLength: Integer;\r\nbegin\r\n  i:=Pos;\r\n  FieldsLength:=Length(Fields);\r\n  while (i<=FieldsLength) and (Fields[i]<>';') do Inc(i);\r\n  Result:=Trim(Copy(Fields,Pos,i-Pos));\r\n  if (i<=FieldsLength) and (Fields[i]=';') then Inc(i);\r\n  Pos:=i;\r\nend;\r\n\r\n{ TRecordUpdateBatch }\r\n\r\nconstructor TRecordUpdateBatch.Create(aBatchID: Integer; AList: TRecordUpdateDescriptorList; AOwnsList : Boolean);\r\nbegin\r\n  FBatchID:=aBatchID;\r\n  FList:=AList;\r\n  FOwnsList:=AOwnsList;\r\n  FStatus:=ubsPending;\r\nend;\r\n\r\ndestructor TRecordUpdateBatch.Destroy;\r\nbegin\r\n  if OwnsList then\r\n    FreeList;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TRecordUpdateBatch.FreeList;\r\nbegin\r\n  FreeAndNil(FList);\r\nend;\r\n\r\n{ TRecordUpdateDescriptorList }\r\n\r\nfunction TRecordUpdateDescriptorList.GetUpdate(AIndex : Integer): TRecordUpdateDescriptor;\r\nbegin\r\n  Result:=TRecordUpdateDescriptor(Items[AIndex]);\r\nend;\r\n\r\n{ TRecordUpdateDescriptor }\r\n\r\nprocedure TRecordUpdateDescriptor.SetResolveStatus(aValue: TResolveStatus);\r\nbegin\r\n  FResolveStatus:=AValue;\r\nend;\r\n\r\nprocedure TRecordUpdateDescriptor.Reset;\r\nbegin\r\n  FResolveStatus:=rsUnresolved;\r\n  FResolveError:='';\r\n  FServerData:=Null;\r\nend;\r\n\r\nconstructor TRecordUpdateDescriptor.Create(aProxy: TDataProxy; aDataset: TDataset; aBookmark: TBookMark; AData: JSValue;\r\n  AStatus: TUpdateStatus);\r\nbegin\r\n  FDataset:=aDataset;\r\n  FBookmark:=aBookmark;\r\n  FData:=AData;\r\n  FStatus:=AStatus;\r\n  FProxy:=aProxy;\r\nend;\r\n\r\n\r\nprocedure TRecordUpdateDescriptor.Resolve(aData: JSValue);\r\nbegin\r\n  SetResolveStatus(rsResolved);\r\n  FServerData:=AData;\r\nend;\r\n\r\nprocedure TRecordUpdateDescriptor.ResolveFailed(aError: String);\r\nbegin\r\n  SetResolveStatus(rsResolveFailed);\r\n  FResolveError:=AError;\r\nend;\r\n\r\n{ TDataRequest }\r\n\r\nprocedure TDataRequest.DoAfterRequest;\r\nbegin\r\n  if Assigned(FAfterRequest) then\r\n    FAfterRequest(Self);\r\nend;\r\n\r\nconstructor TDataRequest.Create(aDataProxy : TDataProxy; aOptions: TLoadOptions; aAfterRequest: TDataRequestEvent; aAfterLoad: TDatasetLoadEvent);\r\nbegin\r\n  FDataProxy:=aDataProxy;\r\n  FLoadOptions:=aOptions;\r\n  FEvent:=aAfterLoad;\r\n  FAfterRequest:=aAfterRequest;\r\nend;\r\n\r\n{ TDataProxy }\r\n\r\nfunction TDataProxy.GetDataRequestClass: TDataRequestClass;\r\nbegin\r\n  Result:=TDataRequest;\r\nend;\r\n\r\nfunction TDataProxy.GetUpdateDescriptorClass: TRecordUpdateDescriptorClass;\r\nbegin\r\n  Result:=TRecordUpdateDescriptor;\r\nend;\r\n\r\nfunction TDataProxy.GetUpdateBatchClass: TRecordUpdateBatchClass;\r\nbegin\r\n  Result:=TRecordUpdateBatch;\r\nend;\r\n\r\nprocedure TDataProxy.ResolveBatch(aBatch: TRecordUpdateBatch);\r\nbegin\r\n  try\r\n    If Assigned(ABatch.FOnResolve) then\r\n      ABatch.FOnResolve(Self,ABatch);\r\n  finally\r\n    aBatch.Free;\r\n  end;\r\nend;\r\n\r\nfunction TDataProxy.GetDataRequest(aOptions: TLoadOptions; aAfterRequest : TDataRequestEvent; aAfterLoad: TDatasetLoadEvent): TDataRequest;\r\nbegin\r\n  Result:=GetDataRequestClass.Create(Self,aOptions,aAfterRequest,aAfterLoad);\r\nend;\r\n\r\nfunction TDataProxy.GetUpdateDescriptor(aDataset : TDataset; aBookmark: TBookMark; AData: JSValue; AStatus: TUpdateStatus): TRecordUpdateDescriptor;\r\nbegin\r\n  Result:=GetUpdateDescriptorClass.Create(Self,aDataset, aBookmark,AData,AStatus);\r\nend;\r\n\r\nfunction TDataProxy.GetRecordUpdateBatch(aBatchID: Integer; AList: TRecordUpdateDescriptorList; AOwnsList : Boolean = True): TRecordUpdateBatch;\r\nbegin\r\n  Result:=GetUpdateBatchClass.Create(aBatchID,AList,AOwnsList);\r\nend;\r\n\r\n\r\n{ EUpdateError }\r\nconstructor EUpdateError.Create(NativeError, Context : String;\r\n                                ErrCode, PrevError : integer; E: Exception);\r\n                                \r\nbegin\r\n  Inherited CreateFmt(NativeError,[Context]);\r\n  FContext := Context;\r\n  FErrorCode := ErrCode;\r\n  FPreviousError := PrevError;\r\n  FOriginalException := E;\r\nend;\r\n\r\nDestructor EUpdateError.Destroy;\r\n\r\nbegin\r\n  FOriginalException.Free;\r\n  Inherited;\r\nend;\r\n\r\n{ TNamedItem }\r\n\r\nfunction TNamedItem.GetDisplayName: string;\r\nbegin\r\n  Result := FName;\r\nend;\r\n\r\nprocedure TNamedItem.SetDisplayName(const Value: string);\r\nVar TmpInd : Integer;\r\nbegin\r\n  if FName=Value then exit;\r\n  if (Value <> '') and (Collection is TFieldDefs ) then\r\n    begin\r\n    TmpInd :=  (TDefCollection(Collection).IndexOf(Value));\r\n    if (TmpInd >= 0) and (TmpInd <> Index) then\r\n      DatabaseErrorFmt(SDuplicateName, [Value, Collection.ClassName]);\r\n    end;\r\n  FName:=Value;\r\n  inherited SetDisplayName(Value);\r\nend;\r\n\r\n{ TDefCollection }\r\n\r\nprocedure TDefCollection.SetItemName(Item: TCollectionItem);\r\n\r\nVar\r\n  N : TNamedItem;\r\n  TN : String;\r\n\r\nbegin\r\n  N:=Item as TNamedItem;\r\n  if N.Name = '' then\r\n    begin\r\n    TN:=Copy(ClassName, 2, 5) + IntToStr(N.ID+1);\r\n    if assigned(Dataset) then\r\n      TN:=Dataset.Name+TN;\r\n    N.Name:=TN;\r\n    end\r\n  else\r\n    inherited SetItemName(Item);\r\nend;\r\n\r\nconstructor TDefCollection.create(ADataset: TDataset; AOwner: TPersistent;\r\n  AClass: TCollectionItemClass);\r\nbegin\r\n  inherited Create(AOwner,AClass);\r\n  FDataset := ADataset;\r\nend;\r\n\r\nfunction TDefCollection.Find(const AName: string): TNamedItem;\r\nvar i: integer;\r\nbegin\r\n  Result := Nil;\r\n  for i := 0 to Count - 1 do\r\n    if AnsiSameText(TNamedItem(Items[i]).Name, AName) then\r\n    begin\r\n    Result := TNamedItem(Items[i]);\r\n    Break;\r\n    end;\r\nend;\r\n\r\nprocedure TDefCollection.GetItemNames(List: TStrings);\r\nvar i: LongInt;\r\nbegin\r\n  for i := 0 to Count - 1 do\r\n    List.Add(TNamedItem(Items[i]).Name);\r\nend;\r\n\r\nfunction TDefCollection.IndexOf(const AName: string): Longint;\r\nvar i: LongInt;\r\nbegin\r\n  Result := -1;\r\n  for i := 0 to Count - 1 do\r\n    if AnsiSameText(TNamedItem(Items[i]).Name, AName) then\r\n    begin\r\n    Result := i;\r\n    Break;\r\n    end;\r\nend;\r\n\r\n{ TIndexDef }\r\n\r\nprocedure TIndexDef.SetDescFields(const AValue: string);\r\nbegin\r\n  if FDescFields=AValue then exit;\r\n  if AValue <> '' then FOptions:=FOptions + [ixDescending];\r\n  FDescFields:=AValue;\r\nend;\r\n\r\nprocedure TIndexDef.Assign(Source: TPersistent);\r\nvar idef : TIndexDef;\r\nbegin\r\n  idef := nil;\r\n  if Source is TIndexDef then\r\n    idef := Source as TIndexDef;\r\n  if Assigned(idef) then\r\n     begin\r\n     FName := idef.Name;\r\n     FFields := idef.Fields;\r\n     FOptions := idef.Options;\r\n     FCaseinsFields := idef.CaseInsFields;\r\n     FDescFields := idef.DescFields;\r\n     FSource := idef.Source;\r\n     FExpression := idef.Expression;\r\n     end\r\n  else\r\n    inherited Assign(Source);\r\nend;\r\n\r\nfunction TIndexDef.GetExpression: string;\r\nbegin\r\n  Result := FExpression;\r\nend;\r\n\r\nprocedure TIndexDef.SetExpression(const AValue: string);\r\nbegin\r\n  FExpression := AValue;\r\nend;\r\n\r\nprocedure TIndexDef.SetCaseInsFields(const AValue: string);\r\nbegin\r\n  if FCaseinsFields=AValue then exit;\r\n  if AValue <> '' then FOptions:=FOptions + [ixCaseInsensitive];\r\n  FCaseinsFields:=AValue;\r\nend;\r\n\r\nconstructor TIndexDef.Create(Owner: TIndexDefs; const AName, TheFields: string;\r\n      TheOptions: TIndexOptions);\r\n\r\nbegin\r\n  FName := aname;\r\n  inherited create(Owner);\r\n  FFields := TheFields;\r\n  FOptions := TheOptions;\r\nend;\r\n\r\n\r\n{ TIndexDefs }\r\n\r\nFunction TIndexDefs.GetItem (Index : integer) : TIndexDef;\r\n\r\nbegin\r\n  Result:=(Inherited GetItem(Index)) as TIndexDef;\r\nend;\r\n\r\nProcedure TIndexDefs.SetItem(Index: Integer; Value: TIndexDef);\r\nbegin\r\n  Inherited SetItem(Index,Value);\r\nend;\r\n\r\nconstructor TIndexDefs.Create(ADataSet: TDataSet);\r\n\r\nbegin\r\n  inherited create(ADataset, Owner, TIndexDef);\r\nend;\r\n\r\n\r\nFunction TIndexDefs.AddIndexDef: TIndexDef;\r\n\r\nbegin\r\n//  Result := inherited add as TIndexDef;\r\n  Result:=TIndexDefClass(Self.ItemClass).Create(Self,'','',[]);\r\nend;\r\n\r\nprocedure TIndexDefs.Add(const Name, Fields: string; Options: TIndexOptions);\r\n\r\nbegin\r\n  TIndexDefClass(Self.ItemClass).Create(Self,Name,Fields,Options);\r\nend;\r\n\r\nfunction TIndexDefs.Find(const IndexName: string): TIndexDef;\r\nbegin\r\n  Result := (inherited Find(IndexName)) as TIndexDef;\r\n  if (Result=Nil) Then\r\n    DatabaseErrorFmt(SIndexNotFound, [IndexName], FDataSet);\r\nend;\r\n\r\nfunction TIndexDefs.FindIndexForFields(const Fields: string): TIndexDef;\r\n\r\nbegin\r\n  //!! To be implemented\r\n  Result:=nil;\r\nend;\r\n\r\n\r\nfunction TIndexDefs.GetIndexForFields(const Fields: string;\r\n  CaseInsensitive: Boolean): TIndexDef;\r\n\r\nvar\r\n  i, FieldsLen: integer;\r\n  Last: TIndexDef;\r\nbegin\r\n  Last := nil;\r\n  FieldsLen := Length(Fields);\r\n  for i := 0 to Count - 1 do\r\n  begin\r\n    Result := Items[I];\r\n    if (Result.Options * [ixDescending, ixExpression] = []) and\r\n       (not CaseInsensitive or (ixCaseInsensitive in Result.Options)) and\r\n       AnsiSameText(Fields, Result.Fields) then\r\n    begin\r\n      Exit;\r\n    end else\r\n    if AnsiSameText(Fields, Copy(Result.Fields, 1, FieldsLen)) and\r\n       ((Length(Result.Fields) = FieldsLen) or\r\n       (Result.Fields[FieldsLen + 1] = ';')) then\r\n    begin\r\n      if (Last = nil) or\r\n         ((Last <> nil) And (Length(Last.Fields) > Length(Result.Fields))) then\r\n           Last := Result;\r\n    end;\r\n  end;\r\n  Result := Last;\r\nend;\r\n\r\nprocedure TIndexDefs.Update;\r\n\r\nbegin\r\n  if (not updated) and assigned(Dataset) then\r\n    begin\r\n    Dataset.UpdateIndexDefs;\r\n    updated := True;\r\n    end;\r\nend;\r\n\r\n{ TCheckConstraint }\r\n\r\nprocedure TCheckConstraint.Assign(Source: TPersistent);\r\n\r\nbegin\r\n  //!! To be implemented\r\nend;\r\n\r\n\r\n\r\n{ TCheckConstraints }\r\n\r\nFunction TCheckConstraints.GetItem(Index : Longint) : TCheckConstraint;\r\n\r\nbegin\r\n  //!! To be implemented\r\n  Result := nil;\r\nend;\r\n\r\n\r\nProcedure TCheckConstraints.SetItem(index : Longint; Value : TCheckConstraint);\r\n\r\nbegin\r\n  //!! To be implemented\r\nend;\r\n\r\n\r\nfunction TCheckConstraints.GetOwner: TPersistent;\r\n\r\nbegin\r\n  //!! To be implemented\r\n  Result := nil;\r\nend;\r\n\r\n\r\nconstructor TCheckConstraints.Create(AOwner: TPersistent);\r\n\r\nbegin\r\n  //!! To be implemented\r\n  inherited Create(TCheckConstraint);\r\nend;\r\n\r\n\r\nfunction TCheckConstraints.Add: TCheckConstraint;\r\n\r\nbegin\r\n  //!! To be implemented\r\n  Result := nil;\r\nend;\r\n\r\n{ TLookupList }\r\n\r\nconstructor TLookupList.Create;\r\n\r\nbegin\r\n  FList := TFPList.Create;\r\nend;\r\n\r\ndestructor TLookupList.Destroy;\r\n\r\nbegin\r\n  Clear;\r\n  FList.Destroy;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TLookupList.Add(const AKey, AValue: JSValue);\r\n\r\nvar LookupRec: TJSObject;\r\n\r\nbegin\r\n  LookupRec:=New(['Key',AKey,'Value',AValue]);\r\n  FList.Add(LookupRec);\r\nend;\r\n\r\nprocedure TLookupList.Clear;\r\n\r\nbegin\r\n  FList.Clear;\r\nend;\r\n\r\nfunction TLookupList.FirstKeyByValue(const AValue: JSValue): JSValue;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  for i := 0 to FList.Count - 1 do\r\n    with TJSObject(FList[i]) do\r\n      if Properties['Value'] = AValue then\r\n        begin\r\n        Result := Properties['Key'];\r\n        exit;\r\n        end;\r\n  Result := Null;\r\nend;\r\n\r\nfunction TLookupList.ValueOfKey(const AKey: JSValue): JSValue;\r\n\r\n  Function VarArraySameValues(VarArray1,VarArray2 : TJSValueDynArray) : Boolean;\r\n  // This only works for one-dimensional vararrays with a lower bound of 0\r\n  // and equal higher bounds wich only contains JSValues.\r\n  // The vararrays returned by GetFieldValues do apply.\r\n  var i : integer;\r\n  begin\r\n    Result := True;\r\n    if (Length(VarArray1)<>Length(VarArray2)) then\r\n      exit;\r\n    for i := 0 to Length(VarArray1) do\r\n      begin\r\n      if VarArray1[i]<>VarArray2[i] then\r\n        begin\r\n        Result := false;\r\n        Exit;\r\n        end;\r\n    end;\r\n  end;\r\n\r\nvar I: Integer;\r\nbegin\r\n  Result := Null;\r\n  if IsNull(AKey) then Exit;\r\n  i := FList.Count - 1;\r\n  if IsArray(AKey) then\r\n    while (i >= 0) And not VarArraySameValues(TJSValueDynArray(TJSOBject(FList.Items[I]).Properties['Key']),TJSValueDynArray(AKey)) do Dec(i)\r\n  else\r\n    while (i >= 0) And (TJSObject(FList[I]).Properties['Key'] <> AKey) do Dec(i);\r\n  if i >= 0 then Result := TJSObject(FList[I]).Properties['Value'];\r\nend;\r\n\r\nprocedure TLookupList.ValuesToStrings(AStrings: TStrings);\r\n\r\nvar\r\n  i: Integer;\r\n  p: TJSObject;\r\n\r\nbegin\r\n  AStrings.Clear;\r\n  for i := 0 to FList.Count - 1 do\r\n    begin\r\n    p := TJSObject(FList[i]);\r\n    AStrings.AddObject(String(p.properties['Value']), TObject(p));\r\n    end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    TDataSet\r\n  ---------------------------------------------------------------------}\r\n\r\nConst\r\n  DefaultBufferCount = 10;\r\n\r\nconstructor TDataSet.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  FFieldDefs:=FieldDefsClass.Create(Self);\r\n  FFieldList:=FieldsClass.Create(Self);\r\n  FDataSources:=TFPList.Create;\r\n  FConstraints:=TCheckConstraints.Create(Self);\r\n  SetLength(FBuffers,1);\r\n  FActiveRecord := 0;\r\n  FEOF := True;\r\n  FBOF := True;\r\n  FIsUniDirectional := False;\r\n  FAutoCalcFields := True;\r\n  FDataRequestID:=0;\r\nend;\r\n\r\n\r\n\r\ndestructor TDataSet.Destroy;\r\n\r\nvar\r\n  i: Integer;\r\n\r\nbegin\r\n  Active:=False;\r\n  FFieldDefs.Free;\r\n  FFieldList.Free;\r\n  With FDataSources do\r\n    begin\r\n    While Count>0 do\r\n      TDataSource(Items[Count - 1]).DataSet:=Nil;\r\n    Destroy;\r\n    end;\r\n  for i := 0 to FBufferCount do\r\n    FreeRecordBuffer(FBuffers[i]);\r\n  FConstraints.Free;\r\n  SetLength(FBuffers,1);\r\n  Inherited Destroy;\r\nend;\r\n\r\n// This procedure must be called when the first record is made/read\r\nprocedure TDataSet.ActivateBuffers;\r\n\r\nbegin\r\n  FBOF:=False;\r\n  FEOF:=False;\r\n  FActiveRecord:=0;\r\nend;\r\n\r\nprocedure TDataSet.BindFields(Binding: Boolean);\r\n\r\nvar i, FieldIndex: Integer;\r\n    FieldDef: TFieldDef;\r\n    Field: TField;\r\n\r\nbegin\r\n  { FieldNo is set to -1 for calculated/lookup fields, to 0 for unbound field\r\n    and for bound fields it is set to FieldDef.FieldNo }\r\n  FCalcFieldsCount := 0;\r\n  FBlobFieldCount := 0;\r\n  for i := 0 to Fields.Count - 1 do\r\n    begin\r\n    Field := Fields[i];\r\n    Field.FFieldDef := Nil;\r\n    if not Binding then\r\n      Field.FFieldNo := 0\r\n    else if Field.FieldKind in [fkCalculated, fkLookup] then\r\n      begin\r\n      Field.FFieldNo := -1;\r\n      Inc(FCalcFieldsCount);\r\n      end\r\n    else\r\n      begin\r\n      FieldIndex := FieldDefs.IndexOf(Field.FieldName);\r\n      if FieldIndex = -1 then\r\n        DatabaseErrorFmt(SFieldNotFound,[Field.FieldName],Self)\r\n      else\r\n        begin\r\n        FieldDef := FieldDefs[FieldIndex];\r\n        Field.FFieldDef := FieldDef;\r\n        Field.FFieldNo := FieldDef.FieldNo;\r\n        if FieldDef.InternalCalcField then\r\n          FInternalCalcFields := True;\r\n        if Field.IsBlob then\r\n          begin\r\n          Field.FSize := FieldDef.Size;\r\n          Inc(FBlobFieldCount);\r\n          end;\r\n        // synchronize CodePage between TFieldDef and TField\r\n        // character data in record buffer and field buffer should have same CodePage\r\n        end;\r\n      end;\r\n    Field.Bind(Binding);\r\n    end;\r\nend;\r\n\r\nfunction TDataSet.BookmarkAvailable: Boolean;\r\n\r\nConst BookmarkStates = [dsBrowse,dsEdit,dsInsert];\r\n\r\nbegin\r\n  Result:=(Not IsEmpty) and  not FIsUniDirectional and (State in BookmarkStates)\r\n          and (getBookMarkFlag(ActiveBuffer)=bfCurrent);\r\nend;\r\n\r\nprocedure TDataSet.CalculateFields(var Buffer: TDataRecord);\r\nvar\r\n  i: Integer;\r\n  OldState: TDatasetState;\r\nbegin\r\n  FCalcBuffer := Buffer; \r\n  if FState <> dsInternalCalc then\r\n  begin\r\n    OldState := FState;\r\n    FState := dsCalcFields;\r\n    try\r\n      ClearCalcFields(FCalcBuffer);\r\n      if not IsUniDirectional then\r\n        for i := 0 to FFieldList.Count - 1 do\r\n          if FFieldList[i].FieldKind = fkLookup then\r\n            FFieldList[i].CalcLookupValue;\r\n    finally\r\n      DoOnCalcFields;\r\n      FState := OldState;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TDataSet.CheckActive;\r\n\r\nbegin\r\n  If Not Active then\r\n    DataBaseError(SInactiveDataset,Self);\r\nend;\r\n\r\nprocedure TDataSet.CheckInactive;\r\n\r\nbegin\r\n  If Active then\r\n    DataBaseError(SActiveDataset,Self);\r\nend;\r\n\r\nprocedure TDataSet.ClearBuffers;\r\n\r\nbegin\r\n  FRecordCount:=0;\r\n  FActiveRecord:=0;\r\n  FCurrentRecord:=-1;\r\n  FBOF:=True;\r\n  FEOF:=True;\r\nend;\r\n\r\nprocedure TDataSet.ClearCalcFields(var Buffer: TDataRecord);\r\n\r\nbegin\r\n  // Empty\r\nend;\r\n\r\nprocedure TDataSet.CloseBlob(Field: TField);\r\n\r\nbegin\r\n  //!! To be implemented\r\nend;\r\n\r\nprocedure TDataSet.CloseCursor;\r\n\r\nbegin\r\n  ClearBuffers;\r\n  SetBufListSize(0);\r\n  Fields.ClearFieldDefs;\r\n  InternalClose;\r\n  FInternalOpenComplete := False;\r\nend;\r\n\r\nprocedure TDataSet.CreateFields;\r\n\r\nVar I : longint;\r\n\r\nbegin\r\n{$ifdef DSDebug}\r\n  Writeln ('Creating fields');\r\n  Writeln ('Count : ',fielddefs.Count);\r\n  For I:=0 to FieldDefs.Count-1 do\r\n    Writeln('Def ',I,' : ',Fielddefs.items[i].Name,'(',Fielddefs.items[i].FieldNo,')');\r\n{$endif}\r\n  For I:=0 to FieldDefs.Count-1 do\r\n    With FieldDefs.Items[I] do\r\n      If DataType<>ftUnknown then\r\n        begin\r\n        {$ifdef DSDebug}\r\n        Writeln('About to create field ',FieldDefs.Items[i].Name);\r\n        {$endif}\r\n        CreateField(self);\r\n        end;\r\nend;\r\n\r\nprocedure TDataSet.DataEvent(Event: TDataEvent; Info: JSValue);\r\n\r\n  procedure HandleFieldChange(aField: TField);\r\n  begin\r\n    if aField.FieldKind in [fkData, fkInternalCalc] then\r\n      SetModified(True);\r\n      \r\n    if State <> dsSetKey then begin\r\n      if aField.FieldKind = fkData then begin\r\n        if FInternalCalcFields then\r\n          RefreshInternalCalcFields(FBuffers[FActiveRecord])\r\n        else if FAutoCalcFields and (FCalcFieldsCount <> 0) then\r\n          CalculateFields(FBuffers[FActiveRecord]);\r\n      end;\r\n      aField.Change;\r\n    end;\r\n  end;\r\n  \r\n  procedure HandleScrollOrChange;\r\n  begin\r\n    if State <> dsInsert then\r\n      UpdateCursorPos;\r\n  end;\r\n\r\nvar\r\n  i: Integer;\r\nbegin\r\n  case Event of\r\n    deFieldChange   : HandleFieldChange(TField(Info));\r\n    deDataSetChange,\r\n    deDataSetScroll : HandleScrollOrChange;\r\n    deLayoutChange  : FEnableControlsEvent:=deLayoutChange;    \r\n  end;\r\n\r\n  if not ControlsDisabled and (FState <> dsBlockRead) then begin\r\n    for i := 0 to FDataSources.Count - 1 do\r\n      TDataSource(FDataSources[i]).ProcessEvent(Event, Info);\r\n  end;\r\nend;\r\n\r\nprocedure TDataSet.DestroyFields;\r\n\r\nbegin\r\n  FFieldList.Clear;\r\nend;\r\n\r\nprocedure TDataSet.DoAfterCancel;\r\n\r\nbegin\r\n If assigned(FAfterCancel) then\r\n   FAfterCancel(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterClose;\r\n\r\nbegin\r\n If assigned(FAfterClose) and not (csDestroying in ComponentState) then\r\n   FAfterClose(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterDelete;\r\n\r\nbegin\r\n If assigned(FAfterDelete) then\r\n   FAfterDelete(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterEdit;\r\n\r\nbegin\r\n If assigned(FAfterEdit) then\r\n   FAfterEdit(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterInsert;\r\n\r\nbegin\r\n If assigned(FAfterInsert) then\r\n   FAfterInsert(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterOpen;\r\n\r\nbegin\r\n If assigned(FAfterOpen) then\r\n   FAfterOpen(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterPost;\r\n\r\nbegin\r\n If assigned(FAfterPost) then\r\n   FAfterPost(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterScroll;\r\n\r\nbegin\r\n If assigned(FAfterScroll) then\r\n   FAfterScroll(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterRefresh;\r\n\r\nbegin\r\n If assigned(FAfterRefresh) then\r\n   FAfterRefresh(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeCancel;\r\n\r\nbegin\r\n If assigned(FBeforeCancel) then\r\n   FBeforeCancel(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeClose;\r\n\r\nbegin\r\n If assigned(FBeforeClose) and not (csDestroying in ComponentState) then\r\n   FBeforeClose(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeDelete;\r\n\r\nbegin\r\n If assigned(FBeforeDelete) then\r\n   FBeforeDelete(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeEdit;\r\n\r\nbegin\r\n If assigned(FBeforeEdit) then\r\n   FBeforeEdit(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeInsert;\r\n\r\nbegin\r\n If assigned(FBeforeInsert) then\r\n   FBeforeInsert(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeOpen;\r\n\r\nbegin\r\n If assigned(FBeforeOpen) then\r\n   FBeforeOpen(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforePost;\r\n\r\nbegin\r\n If assigned(FBeforePost) then\r\n   FBeforePost(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeScroll;\r\n\r\nbegin\r\n If assigned(FBeforeScroll) then\r\n   FBeforeScroll(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeRefresh;\r\n\r\nbegin\r\n If assigned(FBeforeRefresh) then\r\n   FBeforeRefresh(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoInternalOpen;\r\n\r\nbegin\r\n  InternalOpen;\r\n  FInternalOpenComplete := True;\r\n{$ifdef dsdebug}\r\n  Writeln ('Calling internal open');\r\n{$endif}\r\n{$ifdef dsdebug}\r\n  Writeln ('Calling RecalcBufListSize');\r\n{$endif}\r\n  FRecordCount := 0;\r\n  RecalcBufListSize;\r\n  FBOF := True;\r\n  FEOF := (FRecordCount = 0);\r\n  if Assigned(DataProxy) then\r\n    InitChangeList;\r\nend;\r\n\r\nprocedure TDataSet.DoOnCalcFields;\r\n\r\nbegin\r\n If Assigned(FOnCalcfields) then\r\n   FOnCalcFields(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoOnNewRecord;\r\n\r\nbegin\r\n If assigned(FOnNewRecord) then\r\n   FOnNewRecord(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeLoad;\r\nbegin\r\n  If Assigned(FBeforeLoad) then\r\n    FBeforeLoad(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterLoad;\r\nbegin\r\n  if Assigned(FAfterLoad) then\r\n    FAfterLoad(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoBeforeApplyUpdates;\r\n\r\nbegin\r\n  If Assigned(FBeforeApplyUpdates) then\r\n    FBeforeApplyUpdates(Self);\r\nend;\r\n\r\nprocedure TDataSet.DoAfterApplyUpdates(const ResolveInfo: TResolveResults);\r\n\r\nbegin\r\n  If Assigned(FAfterApplyUpdates) then\r\n    FAfterApplyUpdates(Self,ResolveInfo);\r\nend;\r\n\r\nfunction TDataSet.FieldByNumber(FieldNo: Longint): TField;\r\n\r\nbegin\r\n  Result:=FFieldList.FieldByNumber(FieldNo);\r\nend;\r\n\r\nfunction TDataSet.FindRecord(Restart, GoForward: Boolean): Boolean;\r\n\r\nbegin\r\n  //!! To be implemented\r\n  Result:=false;\r\nend;\r\n\r\n\r\nfunction TDataSet.GetBookmarkStr: TBookmarkStr;\r\n\r\nVar\r\n  B : TBookMark;\r\n\r\nbegin\r\n  Result:='';\r\n  If BookMarkAvailable then\r\n    begin\r\n    GetBookMarkData(ActiveBuffer,B);\r\n    Result:=TJSJSON.stringify(B);\r\n    end\r\nend;\r\n\r\nfunction TDataSet.GetBuffer(Index: longint): TDataRecord;\r\n\r\nbegin\r\n  Result:=FBuffers[Index];\r\nend;\r\n\r\nfunction TDataSet.DoGetDataProxy: TDataProxy;\r\n\r\nbegin\r\n  Result:=nil;\r\nend;\r\n\r\nprocedure TDataSet.InitChangeList;\r\n\r\nbegin\r\n  DoneChangeList;\r\n  FChangeList:=TFPList.Create;\r\nend;\r\n\r\nprocedure TDataSet.ClearChangeList;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  If not Assigned(FChangeList) then\r\n    exit;\r\n  For I:=0 to FChangeList.Count-1 do\r\n    begin\r\n    TObject(FChangeList[i]).Destroy;\r\n    FChangeList[i]:=Nil;\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.ResetUpdateDescriptors;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  For I:=0 to FChangeList.Count-1 do\r\n    TRecordUpdateDescriptor(FChangeList[i]).Reset;\r\nend;\r\n\r\nfunction TDataSet.IndexInChangeList(aBookmark: TBookmark): Integer;\r\n\r\nbegin\r\n  Result:=-1;\r\n  if Not assigned(FChangeList) then\r\n    exit;\r\n  Result:=FChangeList.Count-1;\r\n  While (Result>=0) and (CompareBookmarks(aBookMark,TRecordUpdateDescriptor(FChangeList[Result]).Bookmark)<>0) do\r\n    Dec(Result);\r\nend;\r\n\r\nfunction TDataSet.AddToChangeList(aChange: TUpdateStatus): TRecordUpdateDescriptor;\r\n\r\nVar\r\n  B : TBookmark;\r\n  I : Integer;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  if Not Assigned(FChangeList) then\r\n    Exit;\r\n  B:=GetBookmark;\r\n  I:=IndexInChangeList(B);\r\n  if (I=-1) then\r\n    begin\r\n    if Assigned(DataProxy) then\r\n      Result:=DataProxy.GetUpdateDescriptor(Self,B,ActiveBuffer.data,aChange)\r\n    else\r\n      Result:=TRecordUpdateDescriptor.Create(Nil,Self,B,ActiveBuffer.data,aChange);\r\n    FChangeList.Add(Result);\r\n    end\r\n  else\r\n    begin\r\n    Result:=TRecordUpdateDescriptor(FChangeList[i]);\r\n    Case aChange of\r\n      usDeleted : Result.FStatus:=usDeleted;\r\n      usInserted : DatabaseError(SErrInsertingSameRecordtwice,Self);\r\n      usModified : Result.FData:=ActiveBuffer.Data;\r\n    end\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.RemoveFromChangeList(R: TRecordUpdateDescriptor);\r\n\r\nbegin\r\n  if Not (Assigned(R) and Assigned(FChangeList)) then\r\n    Exit;\r\nend;\r\n\r\nfunction TDataSet.GetRecordUpdates(AList: TRecordUpdateDescriptorList): Integer;\r\n\r\nVar\r\n  I,MinIndex : integer;\r\n\r\nbegin\r\n  MinIndex:=0; // Check batch list for minimal index ?\r\n  For I:=MinIndex to FChangeList.Count-1 do\r\n    if TRecordUpdateDescriptor(FChangeList[i]).ResolveStatus=rsUnResolved  then\r\n      Alist.Add(FChangeList[i]);\r\n  Result:=FChangeList.Count;\r\nend;\r\n\r\nfunction TDataSet.ResolveRecordUpdate(anUpdate: TRecordUpdateDescriptor): Boolean;\r\n\r\n// This must return true if the record may be removed from the list of 'modified' records.\r\n// If it returns false, the record is kept in the list of modified records.\r\n\r\nbegin\r\n  try\r\n    Result:=DoResolveRecordUpdate(anUpdate);\r\n    If not Result then\r\n      anUpdate.SetResolveStatus(rsResolveFailed);\r\n  except\r\n    On E : Exception do\r\n      begin\r\n      anUpdate.ResolveFailed(E.Classname+': '+E.Message);\r\n      Result:=False;\r\n      end;\r\n  end;\r\n  DoOnRecordResolved(anUpdate);\r\nend;\r\n\r\nfunction TDataSet.RecordUpdateDescriptorToResolveInfo(anUpdate: TRecordUpdateDescriptor): TResolveInfo;\r\n\r\nbegin\r\n  Result.BookMark:=anUpdate.Bookmark;\r\n  Result.Data:=anUpdate.Data;\r\n  Result.Status:=anUpdate.Status;\r\n  Result.Error:=anUpdate.ResolveError;\r\nend;\r\n\r\nprocedure TDataSet.DoOnRecordResolved(anUpdate: TRecordUpdateDescriptor) ;\r\n\r\nVar\r\n  Info : TResolveInfo;\r\n\r\nbegin\r\n  if Not Assigned(OnRecordResolved) then exit;\r\n  Info:=RecordUpdateDescriptorToResolveInfo(anUpdate);\r\n  OnRecordResolved(Self,Info);\r\nend;\r\n\r\nprocedure TDataSet.ResolveUpdateBatch(Sender: TObject; aBatch : TRecordUpdateBatch);\r\n\r\nVar\r\n  BI,RI,Idx: integer;\r\n  RUD : TRecordUpdateDescriptor;\r\n  doRemove : Boolean;\r\n  Results : TResolveResults;\r\n\r\nbegin\r\n  if Assigned(FBatchList) and (aBatch.Dataset=Self) then\r\n    BI:=FBatchList.IndexOf(aBatch)\r\n  else\r\n    BI:=-1;\r\n  if (BI=-1) then\r\n    Exit;\r\n  FBatchList.Delete(Bi);\r\n  SetLength(Results.Records, aBatch.List.Count);\r\n  For RI:=0 to aBatch.List.Count-1 do\r\n    begin\r\n    RUD:=aBatch.List[RI];\r\n    Results.Records[RI]:=RecordUpdateDescriptorToResolveInfo(RUD);\r\n    aBatch.List.Items[RI]:=Nil;\r\n    Idx:=IndexInChangeList(RUD.Bookmark);\r\n    if (Idx<>-1) then\r\n      begin\r\n      doRemove:=False;\r\n      if (RUD.ResolveStatus=rsResolved) then\r\n        DoRemove:=ResolveRecordUpdate(RUD)\r\n      else\r\n        // What if not resolvable.. ?\r\n        DoRemove:=(RUD.ResolveStatus=rsResolved);\r\n      If DoRemove then\r\n        begin\r\n        RUD.Free;\r\n        FChangeList.Delete(Idx);\r\n        end\r\n      else\r\n        RUD.Reset; // So we try it again in next applyupdates.\r\n      end;\r\n    end;\r\n  if (FBatchList.Count=0) then\r\n    FreeAndNil(FBatchList);\r\n  DoAfterApplyUpdates(Results);\r\nend;\r\n\r\nprocedure TDataSet.DoApplyUpdates;\r\n\r\nVar\r\n  B : TRecordUpdateBatch;\r\n  l : TRecordUpdateDescriptorList;\r\n  I : integer;\r\n\r\nbegin\r\n  if Not Assigned(DataProxy) then\r\n    DatabaseError(SErrDoApplyUpdatesNeedsProxy,Self);\r\n  if FInApplyupdates then\r\n    exit;\r\n  try\r\n    FInApplyupdates:=True;\r\n    if Not (Assigned(FChangeList) and (FChangeList.Count>0)) then\r\n      Exit;\r\n    L:=TRecordUpdateDescriptorList.Create;\r\n    try\r\n      I:=GetRecordUpdates(L);\r\n    except\r\n      L.Free;\r\n      Raise;\r\n    end;\r\n    Inc(FUpdateBatchID);\r\n    For I:=0 to L.Count-1 do\r\n      TRecordUpdateDescriptor(L[i]).SetResolveStatus(rsResolving);\r\n    B:=DataProxy.GetRecordUpdateBatch(FUpdateBatchID,L,True);\r\n    B.FDataset:=Self;\r\n    B.FLastChangeIndex:=I;\r\n    B.OnResolve:=@ResolveUpdateBatch;\r\n    If not Assigned(FBatchlist) then\r\n      FBatchlist:=TFPList.Create;\r\n    FBatchList.Add(B);\r\n    DataProxy.ProcessUpdateBatch(B);\r\n  Finally\r\n    FInApplyupdates:=False;\r\n  end;\r\nend;\r\n\r\nprocedure TDataSet.DoneChangeList;\r\n\r\nbegin\r\n  ClearChangeList;\r\n  FreeAndNil(FChangeList);\r\nend;\r\n\r\nfunction TDataSet.GetDataProxy: TDataProxy;\r\n\r\nbegin\r\n  If (FDataProxy=Nil) then\r\n    DataProxy:=DoGetDataProxy;\r\n  Result:=FDataProxy;\r\nend;\r\n\r\nfunction TDataSet.GetIsLoading: Boolean;\r\nbegin\r\n//  Writeln(Name,' GetIsLoading Loadcount : ',LoadCount);\r\n  Result:=(FLoadCount>0);\r\nend;\r\n\r\nfunction TDataSet.DataPacketReceived(ARequest: TDataRequest): Boolean;\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\nprocedure TDataSet.HandleRequestResponse(ARequest: TDataRequest);\r\n\r\nVar\r\n  DataAdded : Boolean;\r\n\r\nbegin\r\n  if Not Assigned(ARequest) then\r\n    exit;\r\n//  Writeln(Name,' Check request response: ',ARequest.FRequestID,', min: ',FMinLoadID,' Loadcount:',FLoadCount);\r\n  if ARequest.FRequestID<=FMinLoadID then\r\n    begin\r\n    ARequest.Destroy;\r\n    Exit;\r\n    end;\r\n  Dec(FloadCount);\r\n//  Writeln(Name,' Handle request response: ',ARequest.FRequestID,', min: ',FMinLoadID,' Loadcount:',FLoadCount);\r\n  Case ARequest.Success of\r\n  rrFail:\r\n    begin\r\n    if Assigned(FOnLoadFail) then\r\n      FOnLoadFail(Self,aRequest.RequestID,aRequest.ErrorMsg);\r\n    end;\r\n  rrEOF,\r\n  rrOK :\r\n    begin\r\n    DataAdded:=False;\r\n    // Notify caller\r\n    if Assigned(ARequest.Event) then\r\n      ARequest.Event(Self,aRequest.Data);\r\n    // allow descendent to integrate data.\r\n    // Must be done before user is notified or dataset is opened...\r\n    if (ARequest.Success<>rrEOF) then\r\n      DataAdded:=DataPacketReceived(aRequest);\r\n    // Open if needed.\r\n    if Not (Active or (loNoOpen in aRequest.LoadOptions)) then\r\n      begin\r\n      // Notify user\r\n      if not (loNoEvents in aRequest.LoadOptions) then\r\n        DoAfterLoad;\r\n      Open\r\n      end\r\n    else\r\n      begin\r\n      if (loAtEOF in aRequest.LoadOptions) and DataAdded then\r\n        FEOF:=False;\r\n      if not (loNoEvents in aRequest.LoadOptions) then\r\n        DoAfterLoad;\r\n      end;\r\n    end;\r\n  end;\r\n  aRequest.Destroy;\r\nend;\r\n\r\nfunction TDataSet.DoResolveRecordUpdate(anUpdate: TRecordUpdateDescriptor): Boolean;\r\nbegin\r\n  Result:=True;\r\nend;\r\n\r\nprocedure TDataSet.GetCalcFields(var Buffer: TDataRecord);\r\n\r\nbegin\r\n  if (FCalcFieldsCount > 0) or FInternalCalcFields then\r\n    CalculateFields(Buffer);\r\nend;\r\n\r\nfunction TDataSet.GetCanModify: Boolean;\r\n\r\nbegin\r\n  Result:= not FIsUnidirectional;\r\nend;\r\n\r\nprocedure TDataSet.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\n\r\nvar\r\n I: Integer;\r\n Field: TField;\r\n\r\nbegin\r\n for I := 0 to Fields.Count - 1 do begin\r\n   Field := Fields[I];\r\n   if (Field.Owner = Root) then\r\n     Proc(Field);\r\n end;\r\nend;\r\n\r\nfunction TDataSet.GetDataSource: TDataSource;\r\nbegin\r\n  Result:=nil;\r\nend;\r\n\r\nfunction TDataSet.GetRecordSize: Word;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nprocedure TDataSet.InternalAddRecord(Buffer: Pointer; AAppend: Boolean);\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\nprocedure TDataSet.InternalDelete;\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\nprocedure TDataSet.InternalFirst;\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\nprocedure TDataSet.InternalGotoBookmark(ABookmark: TBookmark);\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\n\r\nfunction TDataSet.GetFieldData(Field: TField; Buffer: TDatarecord): JSValue;\r\n\r\nbegin\r\n  Result:=TJSObject(buffer.data).Properties[Field.FieldName];\r\nend;\r\n\r\n\r\nprocedure TDataSet.SetFieldData(Field: TField; var Buffer: TDatarecord; AValue: JSValue);\r\n\r\nbegin\r\n  TJSObject(buffer.data).Properties[Field.FieldName]:=AValue;\r\nend;\r\n\r\n\r\nfunction TDataSet.GetFieldClass(FieldType: TFieldType): TFieldClass;\r\n\r\nbegin\r\n  Result := DefaultFieldClasses[FieldType];\r\nend;\r\n\r\nfunction TDataSet.GetIsIndexField(Field: TField): Boolean;\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\nfunction TDataSet.GetIndexDefs(IndexDefs: TIndexDefs; IndexTypes: TIndexOptions\r\n  ): TIndexDefs;\r\n  \r\nvar i,f : integer;\r\n    IndexFields : TStrings;\r\n    \r\nbegin\r\n  IndexDefs.Update;\r\n  Result := TIndexDefs.Create(Self);\r\n  Result.Assign(IndexDefs);\r\n  i := 0;\r\n  IndexFields := TStringList.Create;\r\n  while i < result.Count do\r\n    begin\r\n    if (not ((IndexTypes = []) and (result[i].Options = []))) and\r\n       ((IndexTypes * result[i].Options) = []) then\r\n      begin\r\n      result.Delete(i);\r\n      dec(i);\r\n      end\r\n    else\r\n      begin\r\n//      ExtractStrings([';'],[' '],result[i].Fields,Indexfields);\r\n      for f := 0 to IndexFields.Count-1 do\r\n        if FindField(Indexfields[f]) = nil  then\r\n         begin\r\n        result.Delete(i);\r\n        dec(i);\r\n        break;\r\n        end;\r\n      end;\r\n    inc(i);\r\n    end;\r\n  IndexFields.Free;\r\nend;\r\n\r\nfunction TDataSet.GetNextRecord: Boolean;\r\n\r\nVar\r\n   T : TDataRecord;\r\n\r\nbegin\r\n{$ifdef dsdebug}\r\n  Writeln ('Getting next record. Internal RecordCount : ',FRecordCount);\r\n  Writeln ('Getting next record. Internal buffercount : ',FBufferCount);\r\n{$endif}\r\n  If FRecordCount>0 Then\r\n    SetCurrentRecord(FRecordCount-1);\r\n  Result:=GetRecord(FBuffers[FBufferCount],gmNext,True)=grOK;\r\n  if Result then\r\n    begin\r\n    If FRecordCount=0 then ActivateBuffers;\r\n    if FRecordCount=FBufferCount then\r\n      ShiftBuffersBackward\r\n    else\r\n      begin\r\n      Inc(FRecordCount);\r\n      FCurrentRecord:=FRecordCount - 1;\r\n      T:=FBuffers[FCurrentRecord];\r\n      FBuffers[FCurrentRecord]:=FBuffers[FBufferCount];\r\n      FBuffers[FBufferCount]:=T;\r\n      end;\r\n    end\r\n  else\r\n    CursorPosChanged;\r\n{$ifdef dsdebug}\r\n  Writeln ('Result getting next record : ',Result);\r\n{$endif}\r\nend;\r\n\r\nfunction TDataSet.GetNextRecords: Longint;\r\n\r\nbegin\r\n  Result:=0;\r\n{$ifdef dsdebug}\r\n  Writeln ('Getting next record(s), need :',FBufferCount);\r\n{$endif}\r\n  While (FRecordCount<FBufferCount) and GetNextRecord do\r\n    Inc(Result);\r\n{$ifdef dsdebug}\r\n  Writeln ('Result Getting next record(S), GOT :',RESULT);\r\n{$endif}\r\nend;\r\n\r\nfunction TDataSet.GetPriorRecord: Boolean;\r\n\r\nbegin\r\n{$ifdef dsdebug}\r\n  Writeln ('GetPriorRecord: Getting previous record');\r\n{$endif}\r\n  CheckBiDirectional;\r\n  If FRecordCount>0 Then SetCurrentRecord(0);\r\n  Result:=GetRecord(FBuffers[FBufferCount],gmPrior,True)=grOK;\r\n  if Result then\r\n    begin\r\n      If FRecordCount=0 then ActivateBuffers;\r\n      ShiftBuffersForward;\r\n\r\n      if FRecordCount<FBufferCount then\r\n        Inc(FRecordCount);\r\n    end\r\n  else\r\n    CursorPosChanged;\r\n{$ifdef dsdebug}\r\n  Writeln ('Result getting prior record : ',Result);\r\n{$endif}\r\nend;\r\n\r\nfunction TDataSet.GetPriorRecords: Longint;\r\n\r\nbegin\r\n  Result:=0;\r\n{$ifdef dsdebug}\r\n  Writeln ('Getting previous record(s), need :',FBufferCount);\r\n{$endif}\r\n  While (FRecordCount<FBufferCount) and GetPriorRecord do\r\n    Inc(Result);\r\nend;\r\n\r\nfunction TDataSet.GetRecNo: Longint;\r\n\r\nbegin\r\n  Result := -1;\r\nend;\r\n\r\nfunction TDataSet.GetRecordCount: Longint;\r\n\r\nbegin\r\n  Result := -1;\r\nend;\r\n\r\nprocedure TDataSet.InitFieldDefs;\r\n\r\nbegin\r\n  if IsCursorOpen then\r\n    InternalInitFieldDefs\r\n  else\r\n    begin\r\n    try\r\n      OpenCursor(True);\r\n    finally\r\n      CloseCursor;\r\n      end;\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.SetBlockReadSize(AValue: Integer);\r\nbegin\r\n  // the state is changed even when setting the same BlockReadSize (follows Delphi behavior)\r\n  // e.g., state is dsBrowse and BlockReadSize is 1. Setting BlockReadSize to 1 will change state to dsBlockRead\r\n  FBlockReadSize := AValue;\r\n  if AValue > 0 then\r\n  begin\r\n    CheckActive; \r\n    SetState(dsBlockRead);\r\n  end\t\r\n  else\r\n  begin\r\n    //update state only when in dsBlockRead \r\n    if FState = dsBlockRead then\r\n      SetState(dsBrowse);\r\n  end;\t\r\nend;\r\n\r\nprocedure TDataSet.SetFieldDefs(AFieldDefs: TFieldDefs);\r\n\r\nbegin\r\n  Fields.ClearFieldDefs;\r\n  FFieldDefs.Assign(AFieldDefs);\r\nend;\r\n\r\nprocedure TDataSet.DoInsertAppendRecord(const Values: array of jsValue; DoAppend: boolean);\r\nvar i : integer;\r\n    ValuesSize : integer;\r\nbegin\r\n  ValuesSize:=Length(Values);\r\n  if ValuesSize>FieldCount then DatabaseError(STooManyFields,self);\r\n  if DoAppend then\r\n    Append\r\n  else\r\n    Insert;\r\n  for i := 0 to ValuesSize-1 do\r\n    Fields[i].AssignValue(Values[i]);\r\n  Post;\r\nend;\r\n\r\nprocedure TDataSet.InitFieldDefsFromfields;\r\nvar i : integer;\r\n\r\nbegin\r\n  if FieldDefs.Count = 0 then\r\n    begin\r\n    FieldDefs.BeginUpdate;\r\n    try\r\n      for i := 0 to Fields.Count-1 do with Fields[i] do\r\n        if not (FieldKind in [fkCalculated,fkLookup]) then // Do not add fielddefs for calculated/lookup fields.\r\n          begin\r\n          FFieldDef:=FieldDefs.FieldDefClass.Create(FieldDefs,FieldName,DataType,Size,Required,FieldDefs.Count+1);\r\n          with FFieldDef do\r\n            begin\r\n            if Required then Attributes := Attributes + [faRequired];\r\n            if ReadOnly then Attributes := Attributes + [faReadOnly];\r\n            end;\r\n          end;\r\n    finally\r\n      FieldDefs.EndUpdate;\r\n      end;\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.InitRecord(var Buffer: TDataRecord);\r\n\r\nbegin\r\n  InternalInitRecord(Buffer);\r\n  ClearCalcFields(Buffer);\r\nend;\r\n\r\nprocedure TDataSet.InternalCancel;\r\n\r\nbegin\r\n  //!! To be implemented\r\nend;\r\n\r\nprocedure TDataSet.InternalEdit;\r\n\r\nbegin\r\n  //!! To be implemented\r\nend;\r\n\r\nprocedure TDataSet.InternalRefresh;\r\n\r\nbegin\r\n  //!! To be implemented\r\nend;\r\n\r\nprocedure TDataSet.OpenCursor(InfoQuery: Boolean);\r\n\r\nbegin\r\n  if InfoQuery then\r\n    InternalInitFieldDefs\r\n  else if State <> dsOpening then\r\n    DoInternalOpen;\r\nend;\r\n\r\nprocedure TDataSet.OpenCursorcomplete;\r\nbegin\r\n  try\r\n    if FState = dsOpening then DoInternalOpen\r\n  finally\r\n    if FInternalOpenComplete then\r\n      begin\r\n      SetState(dsBrowse);\r\n      DoAfterOpen;\r\n      if not IsEmpty then\r\n        DoAfterScroll;\r\n      end\r\n    else\r\n      begin\r\n      SetState(dsInactive);\r\n      CloseCursor;\r\n      end;\r\n  end;\r\nend;\r\n\r\nprocedure TDataSet.RefreshInternalCalcFields(var Buffer: TDataRecord);\r\n\r\nbegin\r\n  //!! To be implemented\r\nend;\r\n\r\nfunction TDataSet.SetTempState(const Value: TDataSetState): TDataSetState;\r\n\r\nbegin\r\n  result := FState;\r\n  FState := value;\r\n  inc(FDisableControlsCount);\r\nend;\r\n\r\nprocedure TDataSet.RestoreState(const Value: TDataSetState);\r\n\r\nbegin\r\n  FState := value;\r\n  dec(FDisableControlsCount);\r\nend;\r\n\r\nfunction TDataSet.GetActive: boolean;\r\n\r\nbegin\r\n  result := (FState <> dsInactive) and (FState <> dsOpening);\r\nend;\r\n\r\nprocedure TDataSet.InternalHandleException(E :Exception);\r\n\r\nbegin\r\n  ShowException(E,Nil);\r\nend;\r\n\r\nprocedure TDataSet.InternalInitRecord(var Buffer: TDataRecord);\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\nprocedure TDataSet.InternalLast;\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\nprocedure TDataSet.InternalPost;\r\n\r\n  Procedure CheckRequiredFields;\r\n\r\n  Var I : longint;\r\n\r\n  begin\r\n    For I:=0 to FFieldList.Count-1 do\r\n      With FFieldList[i] do\r\n        // Required fields that are NOT autoinc !! Autoinc cannot be set !!\r\n        if Required and not ReadOnly and\r\n           (FieldKind=fkData) and Not (DataType=ftAutoInc) and IsNull then\r\n          DatabaseErrorFmt(SNeedField,[DisplayName],Self);\r\n  end;\r\n\r\nbegin\r\n  CheckRequiredFields;\r\nend;\r\n\r\nprocedure TDataSet.InternalSetToRecord(Buffer: TDataRecord);\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\nprocedure TDataSet.SetBookmarkFlag(var Buffer: TDataRecord; Value: TBookmarkFlag);\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\nprocedure TDataSet.SetBookmarkData(var Buffer: TDataRecord; Data: TBookmark);\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\nprocedure TDataSet.SetUniDirectional(const Value: Boolean);\r\nbegin\r\n  FIsUniDirectional := Value;\r\nend;\r\n\r\nprocedure TDataSet.Notification(AComponent: TComponent; Operation: TOperation);\r\nbegin\r\n  inherited Notification(AComponent, Operation);\r\n  if (Operation=opRemove) and (AComponent=FDataProxy) then\r\n    FDataProxy:=Nil;\r\nend;\r\n\r\nclass function TDataSet.FieldDefsClass: TFieldDefsClass;\r\nbegin\r\n  Result:=TFieldDefs;\r\nend;\r\n\r\nclass function TDataSet.FieldsClass: TFieldsClass;\r\nbegin\r\n  Result:=TFields;\r\nend;\r\n\r\nprocedure TDataSet.SetActive(Value: Boolean);\r\n\r\nbegin\r\n  if value and (Fstate = dsInactive) then\r\n    begin\r\n    if csLoading in ComponentState then\r\n      begin\r\n      FOpenAfterRead := true;\r\n      exit;\r\n      end\r\n    else\r\n      begin\r\n      DoBeforeOpen;\r\n      FEnableControlsEvent:=deLayoutChange;\r\n      FInternalCalcFields:=False;\r\n      try\r\n        FDefaultFields:=FieldCount=0;\r\n        OpenCursor(False);\r\n      finally\r\n        if FState <> dsOpening then OpenCursorComplete;\r\n        end;\r\n      end;\r\n    FModified:=False;\r\n    end\r\n  else if not value and (Fstate <> dsinactive) then\r\n    begin\r\n    DoBeforeClose;\r\n    SetState(dsInactive);\r\n    FDataRequestID:=0;\r\n    DoneChangeList;\r\n    CloseCursor;\r\n    DoAfterClose;\r\n    FModified:=False;\r\n    end\r\nend;\r\n\r\nprocedure TDataSet.Loaded;\r\n\r\nbegin\r\n  inherited;\r\n  try\r\n    if FOpenAfterRead then SetActive(true);\r\n  except\r\n    on E : Exception do\r\n      if csDesigning in Componentstate then\r\n        InternalHandleException(E);\r\n      else\r\n        raise;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TDataSet.RecalcBufListSize;\r\n\r\nvar\r\n  i, j, ABufferCount: Integer;\r\n  DataLink: TDataLink;\r\n\r\nbegin\r\n{$ifdef dsdebug}\r\n  Writeln('Recalculating buffer list size - check cursor');\r\n{$endif}\r\n  If Not IsCursorOpen Then\r\n    Exit;\r\n{$ifdef dsdebug}\r\n  Writeln('Recalculating buffer list size');\r\n{$endif}\r\n  if IsUniDirectional then\r\n    ABufferCount := 1\r\n  else\r\n    ABufferCount := DefaultBufferCount;\r\n{$ifdef dsdebug}\r\n  Writeln('Recalculating buffer list size, start count: ',ABufferCount);\r\n{$endif}\r\n  for i := 0 to FDataSources.Count - 1 do\r\n    for j := 0 to TDataSource(FDataSources[i]).DataLinks.Count - 1 do\r\n      begin\r\n      DataLink:=TDataLink(TDataSource(FDataSources[i]).DataLinks[j]);\r\n      if ABufferCount<DataLink.BufferCount then\r\n        ABufferCount:=DataLink.BufferCount;\r\n      end;\r\n{$ifdef dsdebug}\r\n  Writeln('Recalculating buffer list size, end  count: ',ABufferCount);\r\n{$endif}\r\n\r\n  If (FBufferCount=ABufferCount) Then\r\n    exit;\r\n\r\n{$ifdef dsdebug}\r\n  Writeln('Setting buffer list size');\r\n{$endif}\r\n  SetBufListSize(ABufferCount);\r\n{$ifdef dsdebug}\r\n  Writeln('Getting next buffers');\r\n{$endif}\r\n  GetNextRecords;\r\n  if (FRecordCount < FBufferCount) and not IsUniDirectional then\r\n    begin\r\n    FActiveRecord := FActiveRecord + GetPriorRecords;\r\n    CursorPosChanged;\r\n    end;\r\n{$Ifdef dsDebug}\r\n  WriteLn(\r\n    'SetBufferCount: FActiveRecord=',FActiveRecord,\r\n    ' FCurrentRecord=',FCurrentRecord,\r\n    ' FBufferCount= ',FBufferCount,\r\n    ' FRecordCount=',FRecordCount);\r\n{$Endif}\r\nend;\r\n\r\nprocedure TDataSet.SetBookmarkStr(const Value: TBookmarkStr);\r\n\r\nVar\r\n  O: TJSObject;\r\n  B : TBookmark;\r\n\r\nbegin\r\n  O:=TJSJSON.parseObject(Value);\r\n  B.Flag:=TBookmarkFlag(O.Properties['flag']);\r\n  B.Data:=O.Properties['Index'];\r\n  GotoBookMark(B)\r\nend;\r\n\r\nprocedure TDataSet.SetBufListSize(Value: Longint);\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  if Value < 0 then Value := 0;\r\n  If Value=FBufferCount Then\r\n    exit;\r\n  // Less buffers, shift buffers.\r\n  if value>FBufferCount then\r\n    begin\r\n    SetLength(FBuffers,Value+1); // FBuffers[FBufferCount] is used as a temp buffer\r\n    For I:=FBufferCount to Value do\r\n      FBuffers[i]:=AllocRecordBuffer;\r\n    end\r\n  else if value<FBufferCount then\r\n    if (value>=0) and (FActiveRecord>Value-1) then\r\n      begin\r\n      for i := 0 to (FActiveRecord-Value) do\r\n        ShiftBuffersBackward;\r\n      FActiveRecord := Value -1;\r\n      end;\r\n  SetLength(FBuffers,Value+1); // FBuffers[FBufferCount] is used as a temp buffer\r\n  FBufferCount:=Value;\r\n  if FRecordCount > FBufferCount then\r\n    FRecordCount := FBufferCount;\r\n\r\nend;\r\n\r\nprocedure TDataSet.SetChildOrder(Child: TComponent; Order: Longint);\r\n\r\nvar\r\n  Field: TField;\r\nbegin\r\n  Field := Child as TField;\r\n  if Fields.IndexOf(Field) >= 0 then\r\n    Field.Index := Order;\r\nend;\r\n\r\nprocedure TDataSet.SetCurrentRecord(Index: Longint);\r\n\r\nbegin\r\n  If FCurrentRecord<>Index then\r\n    begin\r\n{$ifdef DSdebug}\r\n    Writeln ('Setting current record to: ',index);\r\n{$endif}\r\n    if not FIsUniDirectional then Case GetBookMarkFlag(FBuffers[Index]) of\r\n      bfCurrent : InternalSetToRecord(FBuffers[Index]);\r\n      bfBOF : InternalFirst;\r\n      bfEOF : InternalLast;\r\n      end;\r\n    FCurrentRecord:=Index;\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.SetDefaultFields(const Value: Boolean);\r\nbegin\r\n  FDefaultFields := Value;\r\nend;\r\n\r\nprocedure TDataSet.CheckBiDirectional;\r\n\r\nbegin\r\n  if FIsUniDirectional then DataBaseError(SUniDirectional,Self);\r\nend;\r\n\r\nprocedure TDataSet.SetFilterOptions(Value: TFilterOptions);\r\n\r\nbegin\r\n  CheckBiDirectional;\r\n  FFilterOptions := Value;\r\nend;\r\n\r\nprocedure TDataSet.SetFilterText(const Value: string);\r\n\r\nbegin\r\n  FFilterText := value;\r\nend;\r\n\r\nprocedure TDataSet.SetFiltered(Value: Boolean);\r\n\r\nbegin\r\n  if Value then CheckBiDirectional;\r\n  FFiltered := value;\r\nend;\r\n\r\nprocedure TDataSet.SetFound(const Value: Boolean);\r\nbegin\r\n  FFound := Value;\r\nend;\r\n\r\nprocedure TDataSet.SetModified(Value: Boolean);\r\n\r\nbegin\r\n  FModified := value;\r\nend;\r\n\r\nprocedure TDataSet.SetName(const NewName: TComponentName);\r\n\r\n  function CheckName(const FieldName: string): string;\r\n  var i,j: integer;\r\n  begin\r\n    Result := FieldName;\r\n    i := 0;\r\n    j := 0;\r\n    while (i < Fields.Count) do begin\r\n      if Result = Fields[i].FieldName then begin\r\n        inc(j);\r\n        Result := FieldName + IntToStr(j);\r\n      end else Inc(i);\r\n    end;\r\n  end;\r\n\r\nvar\r\n  i: integer;\r\n  nm: string;\r\n  old: string;\r\n\r\nbegin\r\n  if Self.Name = NewName then Exit;\r\n  old := Self.Name;\r\n  inherited SetName(NewName);\r\n  if (csDesigning in ComponentState) then\r\n    for i := 0 to Fields.Count - 1 do begin\r\n      nm := old + Fields[i].FieldName;\r\n      if Copy(Fields[i].Name, 1, Length(nm)) = nm then\r\n        Fields[i].Name := CheckName(NewName + Fields[i].FieldName);\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.SetOnFilterRecord(const Value: TFilterRecordEvent);\r\n\r\nbegin\r\n  CheckBiDirectional;\r\n  FOnFilterRecord := Value;\r\nend;\r\n\r\nprocedure TDataSet.SetRecNo(Value: Longint);\r\n\r\nbegin\r\n  //!! To be implemented\r\nend;\r\n\r\nprocedure TDataSet.SetState(Value: TDataSetState);\r\n\r\nbegin\r\n  If Value<>FState then\r\n    begin\r\n    FState:=Value;\r\n    if Value=dsBrowse then\r\n      FModified:=false;\r\n    DataEvent(deUpdateState,0);\r\n    end;\r\nend;\r\n\r\nfunction TDataSet.TempBuffer: TDataRecord;\r\n\r\nbegin\r\n  Result := FBuffers[FRecordCount];\r\nend;\r\n\r\nprocedure TDataSet.UpdateIndexDefs;\r\n\r\nbegin\r\n  // Empty Abstract\r\nend;\r\n\r\nfunction TDataSet.AllocRecordBuffer: TDataRecord;\r\nbegin\r\n  Result.data:=Null;\r\n  Result.state:=rsNew;\r\n//  Result := nil;\r\nend;\r\n\r\nprocedure TDataSet.FreeRecordBuffer(var Buffer: TDataRecord);\r\nbegin\r\n  // empty stub\r\nend;\r\n\r\nprocedure TDataSet.GetBookmarkData(Buffer: TDataRecord; var Data: TBookmark);\r\nbegin\r\n\r\nend;\r\n\r\n\r\nfunction TDataSet.GetBookmarkFlag(Buffer: TDataRecord): TBookmarkFlag;\r\nbegin\r\n  Result := bfCurrent;\r\nend;\r\n\r\nfunction TDataSet.ControlsDisabled: Boolean;\r\n\r\nbegin\r\n  Result := (FDisableControlsCount > 0);\r\nend;\r\n\r\nfunction TDataSet.ActiveBuffer: TDataRecord;\r\n\r\nbegin\r\n{$ifdef dsdebug}\r\n  Writeln ('Active buffer requested. Returning record number: ',ActiveRecord);\r\n{$endif}\r\n  if FactiveRecord<>-1 then\r\n    Result:=FBuffers[FActiveRecord]\r\n  else\r\n    Result:=Default(TDataRecord);\r\nend;\r\n\r\nfunction TDataSet.GetFieldData(Field: TField): JSValue;\r\nbegin\r\n  Result:=GetFieldData(Field,ActiveBuffer);\r\nend;\r\n\r\nprocedure TDataSet.SetFieldData(Field: TField; AValue: JSValue);\r\nbegin\r\n  SetFieldData(Field,FBuffers[FActiveRecord],AValue);\r\nend;\r\n\r\nprocedure TDataSet.Append;\r\n\r\nbegin\r\n  DoInsertAppend(True);\r\nend;\r\n\r\nprocedure TDataSet.InternalInsert;\r\n\r\nbegin\r\n  //!! To be implemented\r\nend;\r\n\r\nprocedure TDataSet.AppendRecord(const Values: array of jsValue);\r\n\r\nbegin\r\n  DoInsertAppendRecord(Values,True);\r\nend;\r\n\r\nfunction TDataSet.BookmarkValid(ABookmark: TBookmark): Boolean;\r\n{\r\n  Should be overridden by descendant objects.\r\n}\r\nbegin\r\n  Result:=False\r\nend;\r\n\r\n\r\n\r\nfunction TDataSet.ConvertToDateTime(aField: TField; aValue: JSValue; ARaiseException: Boolean): TDateTime;\r\nbegin\r\n  Result:=DefaultConvertToDateTime(aField,aValue,ARaiseException);\r\nend;\r\n\r\nclass function TDataSet.DefaultConvertToDateTime(aField: TField; aValue: JSValue; ARaiseException: Boolean): TDateTime;\r\nbegin\r\n  Result:=0;\r\n  if IsString(aValue) then\r\n    begin\r\n    if not TryRFC3339ToDateTime(String(AValue),Result) then\r\n      Raise EConvertError.CreateFmt(SErrInvalidDateTime,[String(aValue)])\r\n    end\r\n  else if IsNumber(aValue) then\r\n    Result:=TDateTime(AValue)\r\nend;\r\n\r\nfunction TDataSet.ConvertDateTimeToNative(aField: TField; aValue : TDateTime) : JSValue;\r\n\r\nbegin\r\n  Result:=DefaultConvertDateTimeToNative(aField, aValue);\r\nend;\r\n\r\nclass function TDataSet.DefaultConvertDateTimeToNative(aField: TField; aValue: TDateTime): JSValue;\r\n\r\nbegin\r\n  Result:=DateTimeToRFC3339(aValue);\r\nend;\r\n\r\nfunction TDataSet.BlobDataToBytes(aValue: JSValue): TBytes;\r\nbegin\r\n  Result:=DefaultBlobDataToBytes(aValue);\r\nend;\r\n\r\nclass function TDataSet.DefaultBlobDataToBytes(aValue: JSValue): TBytes;\r\n\r\nVar\r\n  S : String;\r\n  I,J,L : Integer;\r\n\r\nbegin\r\n  SetLength(Result,0);\r\n  // We assume a string, hex-encoded.\r\n  if isString(AValue) then\r\n    begin\r\n    S:=String(Avalue);\r\n    L:=Length(S);\r\n    SetLength(Result,(L+1) div 2);\r\n    I:=1;\r\n    J:=0;\r\n    While (I<L) do\r\n      begin\r\n      Result[J]:=StrToInt('$'+Copy(S,I,2));\r\n      Inc(I,2);\r\n      Inc(J,1);\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction TDataSet.BytesToBlobData(aValue: TBytes): JSValue;\r\n\r\nbegin\r\n  Result:=DefaultBytesToBlobData(aValue);\r\nend;\r\n\r\nclass function TDataSet.DefaultBytesToBlobData(aValue: TBytes): JSValue;\r\n\r\nVar\r\n  S : String;\r\n  I : Integer;\r\n\r\nbegin\r\n  if Length(AValue)=0 then\r\n    Result:=Null\r\n  else\r\n    begin\r\n    S:='';\r\n    For I:=0 to Length(AValue) do\r\n      TJSString(S).Concat(IntToHex(aValue[i],2));\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.Cancel;\r\n\r\nbegin\r\n  If State in [dsEdit,dsInsert] then\r\n    begin\r\n    DataEvent(deCheckBrowseMode,0);\r\n    DoBeforeCancel;\r\n    UpdateCursorPos;\r\n    InternalCancel;\r\n    if (State = dsInsert) and (FRecordCount = 1) then\r\n      begin\r\n      FEOF := true;\r\n      FBOF := true;\r\n      FRecordCount := 0;\r\n      InitRecord(FBuffers[FActiveRecord]);\r\n      SetState(dsBrowse);\r\n      DataEvent(deDatasetChange,0);\r\n      end\r\n    else\r\n      begin\r\n      SetState(dsBrowse);\r\n      SetCurrentRecord(FActiveRecord);\r\n      resync([]);\r\n      end;\r\n    DoAfterCancel;\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.CheckBrowseMode;\r\n\r\nbegin\r\n  CheckActive;\r\n  DataEvent(deCheckBrowseMode,0);\r\n  Case State of\r\n    dsEdit,dsInsert:\r\n      begin\r\n      UpdateRecord;\r\n      If Modified then\r\n        Post\r\n      else\r\n        Cancel;\r\n      end;\r\n    dsSetKey: Post;\r\n  end;\r\nend;\r\n\r\nprocedure TDataSet.ClearFields;\r\n\r\n\r\nbegin\r\n  DataEvent(deCheckBrowseMode, 0);\r\n  InternalInitRecord(FBuffers[FActiveRecord]);\r\n  if State <> dsSetKey then\r\n    GetCalcFields(FBuffers[FActiveRecord]);\r\n  DataEvent(deRecordChange, 0);\r\nend;\r\n\r\nprocedure TDataSet.Close;\r\n\r\nbegin\r\n  Active:=False;\r\nend;\r\n\r\nprocedure TDataSet.ApplyUpdates;\r\nbegin\r\n  DoBeforeApplyUpdates;\r\n  DoApplyUpdates;\r\nend;\r\n\r\nfunction TDataSet.CompareBookmarks(Bookmark1, Bookmark2: TBookmark): Longint;\r\n\r\nbegin\r\n  Result:=0;\r\nend;\r\n\r\nprocedure TDataSet.CursorPosChanged;\r\n\r\n\r\nbegin\r\n  FCurrentRecord:=-1;\r\nend;\r\n\r\nprocedure TDataSet.Delete;\r\n\r\nVar\r\n  R : TRecordUpdateDescriptor;\r\n\r\nbegin\r\n  If Not CanModify then\r\n    DatabaseError(SDatasetReadOnly,Self);\r\n  If IsEmpty then\r\n    DatabaseError(SDatasetEmpty,Self);\r\n  if State in [dsInsert] then\r\n  begin\r\n    Cancel;\r\n  end else begin\r\n    DataEvent(deCheckBrowseMode,0);\r\n{$ifdef dsdebug}\r\n    writeln ('Delete: checking required fields');\r\n{$endif}\r\n    DoBeforeDelete;\r\n    DoBeforeScroll;\r\n    R:=AddToChangeList(usDeleted);\r\n    If Not TryDoing(@InternalDelete,OnDeleteError) then\r\n      begin\r\n      if Assigned(R) then\r\n        RemoveFromChangeList(R);\r\n      exit;\r\n      end;\r\n{$ifdef dsdebug}\r\n    writeln ('Delete: Internaldelete succeeded');\r\n{$endif}\r\n    SetState(dsBrowse);\r\n{$ifdef dsdebug}\r\n    writeln ('Delete: Browse mode set');\r\n{$endif}\r\n    SetCurrentRecord(FActiveRecord);\r\n    Resync([]);\r\n    DoAfterDelete;\r\n    DoAfterScroll;\r\n  end;\r\nend;\r\n\r\nprocedure TDataSet.DisableControls;\r\n\r\n\r\nbegin\r\n  If FDisableControlsCount=0 then\r\n    begin\r\n    { Save current state,\r\n      needed to detect change of state when enabling controls.\r\n    }\r\n    FDisableControlsState:=FState;\r\n    FEnableControlsEvent:=deDatasetChange;\r\n    end;\r\n  Inc(FDisableControlsCount);\r\nend;\r\n\r\nprocedure TDataSet.DoInsertAppend(DoAppend: Boolean);\r\n\r\n\r\n  procedure DoInsert(DoAppend : Boolean);\r\n\r\n  Var\r\n    BookBeforeInsert : TBookmark;\r\n    TempBuf : TDataRecord;\r\n    I : integer;\r\n\r\n  begin\r\n  // need to scroll up al buffers after current one,\r\n  // but copy current bookmark to insert buffer.\r\n  If FRecordCount > 0 then\r\n    BookBeforeInsert:=Bookmark;\r\n\r\n  if not DoAppend then\r\n    begin\r\n    if FRecordCount > 0 then\r\n      begin\r\n      TempBuf := FBuffers[FBufferCount];\r\n      for I:=FBufferCount downto FActiveRecord+1 do\r\n        FBuffers[I]:=FBuffers[I-1];\r\n      FBuffers[FActiveRecord]:=TempBuf;\r\n      end;\r\n    end\r\n  else if FRecordCount=FBufferCount then\r\n    ShiftBuffersBackward\r\n  else\r\n    begin\r\n    if FRecordCount>0 then\r\n      inc(FActiveRecord);\r\n    end;\r\n\r\n  // Active buffer is now edit buffer. Initialize.\r\n  InitRecord(FBuffers[FActiveRecord]);\r\n  CursorPosChanged;\r\n\r\n  // Put bookmark in edit buffer.\r\n  if FRecordCount=0 then\r\n    SetBookmarkFlag(FBuffers[FActiveRecord],bfEOF)\r\n  else\r\n    begin\r\n    fBOF := false;\r\n    // 29:01:05, JvdS: Why is this here?!? It can result in records with the same bookmark-data?\r\n    // I would say that the 'internalinsert' should do this. But I don't know how Tdbf handles it\r\n\r\n    // 1-apr-06, JvdS: It just sets the bookmark of the newly inserted record to the place\r\n    // where the record should be inserted. So it is ok.\r\n    if FRecordCount > 0 then\r\n      begin\r\n      SetBookMarkData(FBuffers[FActiveRecord],BookBeforeInsert);\r\n      FreeBookmark(BookBeforeInsert);\r\n      end;\r\n    end;\r\n\r\n  InternalInsert;\r\n\r\n  // update buffer count.\r\n  If FRecordCount<FBufferCount then\r\n    Inc(FRecordCount);\r\n  end;\r\n\r\nbegin\r\n  CheckBrowseMode;\r\n  If Not CanModify then\r\n    DatabaseError(SDatasetReadOnly,Self);\r\n  DoBeforeInsert;\r\n  DoBeforeScroll;\r\n  If Not DoAppend then\r\n    begin\r\n{$ifdef dsdebug}\r\n    Writeln ('going to insert mode');\r\n{$endif}\r\n    DoInsert(false);\r\n    end\r\n  else\r\n    begin\r\n{$ifdef dsdebug}\r\n    Writeln ('going to append mode');\r\n{$endif}\r\n    ClearBuffers;\r\n    InternalLast;\r\n    GetPriorRecords;\r\n    if FRecordCount>0 then\r\n      FActiveRecord:=FRecordCount-1;\r\n    DoInsert(True);\r\n    SetBookmarkFlag(FBuffers[FActiveRecord],bfEOF);\r\n    FBOF :=False;\r\n    FEOF := true;\r\n    end;\r\n  SetState(dsInsert);\r\n  try\r\n    DoOnNewRecord;\r\n  except\r\n    SetCurrentRecord(FActiveRecord);\r\n    resync([]);\r\n    raise;\r\n  end;\r\n  // mark as not modified.\r\n  FModified:=False;\r\n  // Final events.\r\n  DataEvent(deDatasetChange,0);\r\n  DoAfterInsert;\r\n  DoAfterScroll;\r\n{$ifdef dsdebug}\r\n  Writeln ('Done with append');\r\n{$endif}\r\nend;\r\n\r\nprocedure TDataSet.Edit;\r\n\r\nbegin\r\n  If State in [dsEdit,dsInsert] then exit;\r\n  CheckBrowseMode;\r\n  If Not CanModify then\r\n    DatabaseError(SDatasetReadOnly,Self);\r\n  If FRecordCount = 0 then\r\n    begin\r\n    Append;\r\n    Exit;\r\n    end;\r\n  DoBeforeEdit;\r\n  If Not TryDoing(@InternalEdit,OnEditError) then exit;\r\n  GetCalcFields(FBuffers[FActiveRecord]);\r\n  SetState(dsEdit);\r\n  DataEvent(deRecordChange,0);\r\n  DoAfterEdit;\r\nend;\r\n\r\nprocedure TDataSet.EnableControls;\r\n\r\n\r\nbegin\r\n  if FDisableControlsCount > 0 then\r\n    Dec(FDisableControlsCount);\r\n\r\n  if FDisableControlsCount = 0 then begin\r\n    if FState <> FDisableControlsState then\r\n      DataEvent(deUpdateState, 0);\r\n\r\n    if (FState <> dsInactive) and (FDisableControlsState <> dsInactive) then\r\n      DataEvent(FEnableControlsEvent, 0);\r\n  end;\r\nend;\r\n\r\nfunction TDataSet.FieldByName(const FieldName: string): TField;\r\n\r\n\r\nbegin\r\n  Result:=FindField(FieldName);\r\n  If Result=Nil then\r\n    DatabaseErrorFmt(SFieldNotFound,[FieldName],Self);\r\nend;\r\n\r\nfunction TDataSet.FindField(const FieldName: string): TField;\r\n\r\n\r\nbegin\r\n  Result:=FFieldList.FindField(FieldName);\r\nend;\r\n\r\nfunction TDataSet.FindFirst: Boolean;\r\n\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\nfunction TDataSet.FindLast: Boolean;\r\n\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\nfunction TDataSet.FindNext: Boolean;\r\n\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\nfunction TDataSet.FindPrior: Boolean;\r\n\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\nprocedure TDataSet.First;\r\n\r\n\r\nbegin\r\n  CheckBrowseMode;\r\n  DoBeforeScroll;\r\n  if not FIsUniDirectional then\r\n    ClearBuffers\r\n  else if not FBof then\r\n    begin\r\n    Active := False;\r\n    Active := True;\r\n    end;\r\n  try\r\n    InternalFirst;\r\n    if not FIsUniDirectional then GetNextRecords;\r\n  finally\r\n    FBOF:=True;\r\n    DataEvent(deDatasetChange,0);\r\n    DoAfterScroll;\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.FreeBookmark(ABookmark: TBookmark);\r\n\r\n\r\nbegin\r\n  {$ifdef noautomatedbookmark}\r\n   FreeMem(ABookMark,FBookMarkSize);\r\n  {$endif}\r\nend;\r\n\r\nfunction TDataSet.GetBookmark: TBookmark;\r\n\r\n\r\nbegin\r\n  if BookmarkAvailable then\r\n    GetBookMarkdata(ActiveBuffer,Result)\r\n  else\r\n    Result.Data:=Null;\r\nend;\r\n\r\nfunction TDataSet.GetCurrentRecord(Buffer: TDataRecord): Boolean;\r\n\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\nprocedure TDataSet.GetFieldList(List: TList; const FieldNames: string);\r\n\r\nvar\r\n  F: TField;\r\n  N: String;\r\n  StrPos: Integer;\r\n\r\nbegin\r\n  if (FieldNames = '') or (List = nil) then\r\n    Exit;\r\n  StrPos := 1;\r\n  repeat\r\n    N := ExtractFieldName(FieldNames, StrPos);\r\n    F := FieldByName(N);\r\n    List.Add(F);\r\n  until StrPos > Length(FieldNames);\r\nend;\r\n\r\nprocedure TDataSet.GetFieldList(List: TFPList; const FieldNames: string);\r\nvar\r\n  F: TField;\r\n  N: String;\r\n  StrPos: Integer;\r\n\r\nbegin\r\n  if (FieldNames = '') or (List = nil) then\r\n    Exit;\r\n  StrPos := 1;\r\n  repeat\r\n    N := ExtractFieldName(FieldNames, StrPos);\r\n    F := FieldByName(N);\r\n    List.Add(F);\r\n  until StrPos > Length(FieldNames);\r\nend;\r\n\r\nprocedure TDataSet.GetFieldNames(List: TStrings);\r\n\r\n\r\nbegin\r\n  FFieldList.GetFieldNames(List);\r\nend;\r\n\r\nprocedure TDataSet.GotoBookmark(const ABookmark: TBookmark);\r\n\r\n\r\nbegin\r\n  If Not IsNull(ABookMark.Data) then\r\n    begin\r\n    CheckBrowseMode;\r\n    DoBeforeScroll;\r\n{$ifdef dsdebug}\r\n    Writeln('Gotobookmark: ',ABookMark.Data);\r\n{$endif}\r\n    InternalGotoBookMark(ABookMark);\r\n    Resync([rmExact,rmCenter]);\r\n    DoAfterScroll;\r\n    end;\r\nend;\r\n\r\nprocedure TDataSet.Insert;\r\n\r\nbegin\r\n  DoInsertAppend(False);\r\nend;\r\n\r\nprocedure TDataSet.InsertRecord(const Values: array of JSValue);\r\n\r\nbegin\r\n  DoInsertAppendRecord(Values,False);\r\nend;\r\n\r\nfunction TDataSet.IsEmpty: Boolean;\r\n\r\nbegin\r\n  Result:=(fBof and fEof) and\r\n          (not (State = dsInsert)); // After an insert on an empty dataset, both fBof and fEof are true\r\nend;\r\n\r\nfunction TDataSet.IsLinkedTo(ADataSource: TDataSource): Boolean;\r\n\r\nbegin\r\n//!! Not tested, I never used nested DS\r\n  if (ADataSource = nil) or (ADataSource.Dataset = nil) then begin\r\n    Result := False\r\n  end else if ADataSource.Dataset = Self then begin\r\n    Result := True;\r\n  end else begin\r\n    Result := ADataSource.Dataset.IsLinkedTo(ADataSource.Dataset.DataSource);\r\n  end;\r\n//!! DataSetField not implemented\r\nend;\r\n\r\nfunction TDataSet.IsSequenced: Boolean;\r\n\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nprocedure TDataSet.Last;\r\n\r\nbegin\r\n  CheckBiDirectional;\r\n  CheckBrowseMode;\r\n  DoBeforeScroll;\r\n  ClearBuffers;\r\n  try\r\n    // Writeln('FActiveRecord before last',FActiveRecord);\r\n    InternalLast;\r\n    // Writeln('FActiveRecord after last',FActiveRecord);\r\n    GetPriorRecords;\r\n    // Writeln('FRecordCount: ',FRecordCount);\r\n    if FRecordCount>0 then\r\n      FActiveRecord:=FRecordCount-1;\r\n    // Writeln('FActiveRecord ',FActiveRecord);\r\n  finally\r\n    FEOF:=true;\r\n    DataEvent(deDataSetChange, 0);\r\n    DoAfterScroll;\r\n    end;\r\nend;\r\n\r\nfunction TDataSet.DoLoad(aOptions: TLoadOptions; aAfterLoad: TDatasetLoadEvent): Boolean;\r\n\r\nVar\r\n  Request : TDataRequest;\r\n\r\nbegin\r\n  if not (loNoEvents in aOptions) then\r\n    DoBeforeLoad;\r\n  Result:=DataProxy<>Nil;\r\n  if Not Result then\r\n    Exit;\r\n  Request:=DataProxy.GetDataRequest(aOptions,@HandleRequestResponse,aAfterLoad);\r\n  Request.FDataset:=Self;\r\n  If Active then\r\n    Request.FBookmark:=GetBookmark;\r\n  Inc(FDataRequestID);\r\n  Request.FRequestID:=FDataRequestID;\r\n  if DataProxy.DoGetData(Request) then\r\n    Inc(FLoadCount)\r\n  else\r\n    Request.Free;\r\n//  Writeln(Name,' End of Load call. Count: ',LoadCount);\r\nend;\r\n\r\n\r\nfunction TDataSet.Load(aOptions: TLoadOptions; aAfterLoad: TDatasetLoadEvent): Boolean;\r\n\r\nbegin\r\n  if loAtEOF in aOptions then\r\n    DatabaseError(SatEOFInternalOnly,Self);\r\n  if loCancelPending in aOptions then\r\n    CancelLoading;\r\n  Result:=DoLoad(aOptions,aAfterLoad);\r\nend;\r\n\r\nfunction TDataSet.MoveBy(Distance: Longint): Longint;\r\nVar\r\n  TheResult: Integer;\r\n\r\n  Function ScrollForward : Integer;\r\n  begin\r\n    Result:=0;\r\n{$ifdef dsdebug}\r\n    Writeln('Scrolling forward : ',Distance);\r\n    Writeln('Active buffer : ',FActiveRecord);\r\n    Writeln('RecordCount   : ',FRecordCount);\r\n    WriteLn('BufferCount   : ',FBufferCount);\r\n{$endif}\r\n    FBOF:=False;\r\n    While (Distance>0) and not FEOF do\r\n      begin\r\n      If FActiveRecord<FRecordCount-1 then\r\n        begin\r\n        Inc(FActiveRecord);\r\n        Dec(Distance);\r\n        Inc(TheResult); //Inc(Result);\r\n        end\r\n      else\r\n        begin\r\n{$ifdef dsdebug}\r\n       Writeln('Moveby : need next record');\r\n{$endif}\r\n        If GetNextRecord then\r\n          begin\r\n          Dec(Distance);\r\n          Dec(Result);\r\n          Inc(TheResult); //Inc(Result);\r\n          end\r\n        else\r\n          begin\r\n          FEOF:=true;\r\n          // Allow to load more records.\r\n          DoLoad([loNoOpen,loAtEOF],Nil);\r\n          end;\r\n        end;\r\n      end\r\n  end;\r\n\r\n  Function ScrollBackward : Integer;\r\n  begin\r\n    CheckBiDirectional;\r\n    Result:=0;\r\n{$ifdef dsdebug}\r\n    Writeln('Scrolling backward : ',Abs(Distance));\r\n    Writeln('Active buffer : ',FActiveRecord);\r\n    Writeln('RecordCunt    : ',FRecordCount);\r\n    WriteLn('BufferCount   : ',FBufferCount);\r\n{$endif}\r\n    FEOF:=False;\r\n    While (Distance<0) and not FBOF do\r\n      begin\r\n      If FActiveRecord>0 then\r\n        begin\r\n        Dec(FActiveRecord);\r\n        Inc(Distance);\r\n        Dec(TheResult); //Dec(Result);\r\n        end\r\n      else\r\n        begin\r\n       {$ifdef dsdebug}\r\n       Writeln('Moveby : need next record');\r\n       {$endif}\r\n        If GetPriorRecord then\r\n          begin\r\n          Inc(Distance);\r\n          Inc(Result);\r\n          Dec(TheResult); //Dec(Result);\r\n          end\r\n        else\r\n          FBOF:=true;\r\n        end;\r\n      end\r\n  end;\r\n\r\nVar\r\n  Scrolled : Integer;\r\n\r\nbegin\r\n  CheckBrowseMode;\r\n  Result:=0; TheResult:=0;\r\n  DoBeforeScroll;\r\n  If (Distance = 0) or\r\n     ((Distance>0) and FEOF) or\r\n     ((Distance<0) and FBOF) then\r\n    exit;\r\n  Try\r\n    Scrolled := 0;\r\n    If Distance>0 then\r\n      Scrolled:=ScrollForward\r\n    else\r\n      Scrolled:=ScrollBackward;\r\n  finally\r\n{$ifdef dsdebug}\r\n    WriteLn('ActiveRecord=', FActiveRecord,' FEOF=',FEOF,' FBOF=',FBOF);\r\n{$Endif}\r\n    DataEvent(deDatasetScroll,Scrolled);\r\n    DoAfterScroll;\r\n    Result:=TheResult;\r\n  end;\r\nend;\r\n\r\nprocedure TDataSet.Next;\r\n\r\nbegin\r\n  if BlockReadSize>0 then\r\n    BlockReadNext\r\n  else\r\n    MoveBy(1);\r\nend;\r\n\r\nprocedure TDataSet.BlockReadNext;\r\nbegin\r\n  MoveBy(1);\r\nend;\r\n\r\nprocedure TDataSet.Open;\r\n\r\nbegin\r\n  Active:=True;\r\nend;\r\n\r\nprocedure TDataSet.Post;\r\n\r\nConst\r\n  UpdateStates : Array[Boolean] of TUpdateStatus = (usModified,usInserted);\r\n\r\nVar\r\n  R : TRecordUpdateDescriptor;\r\n  WasInsert : Boolean;\r\n\r\nbegin\r\n  UpdateRecord;\r\n  if State in [dsEdit,dsInsert] then\r\n    begin\r\n    DataEvent(deCheckBrowseMode,0);\r\n{$ifdef dsdebug}\r\n    writeln ('Post: checking required fields');\r\n{$endif}\r\n    DoBeforePost;\r\n    WasInsert:=State=dsInsert;\r\n    If Not TryDoing(@InternalPost,OnPostError) then exit;\r\n    CursorPosChanged;\r\n{$ifdef dsdebug}\r\n    writeln ('Post: Internalpost succeeded');\r\n{$endif}\r\n// First set the state to dsBrowse, then the Resync, to prevent the calling of\r\n// the deDatasetChange event, while the state is still 'editable', while the db isn't\r\n    SetState(dsBrowse);\r\n    Resync([]);\r\n    // We get the new values here, since the bookmark should now be correct to find the record later on when doing applyupdates.\r\n    R:=AddToChangeList(UpdateStates[wasInsert]);\r\n    if Assigned(R) then\r\n      R.FBookmark:=BookMark;\r\n{$ifdef dsdebug}\r\n    writeln ('Post: Browse mode set');\r\n{$endif}\r\n    DoAfterPost;\r\n    end\r\n  else if State<>dsSetKey then\r\n    DatabaseErrorFmt(SNotEditing, [Name], Self);\r\nend;\r\n\r\nprocedure TDataSet.Prior;\r\n\r\nbegin\r\n  MoveBy(-1);\r\nend;\r\n\r\nprocedure TDataSet.Refresh;\r\n\r\nbegin\r\n  CheckbrowseMode;\r\n  DoBeforeRefresh;\r\n  UpdateCursorPos;\r\n  InternalRefresh;\r\n{ SetCurrentRecord is called by UpdateCursorPos already, so as long as\r\n  InternalRefresh doesn't do strange things this should be ok. }\r\n//  SetCurrentRecord(FActiveRecord);\r\n  Resync([]);\r\n  DoAfterRefresh;\r\nend;\r\n\r\nprocedure TDataSet.RegisterDataSource(ADataSource: TDataSource);\r\n\r\nbegin\r\n  FDataSources.Add(ADataSource);\r\n  RecalcBufListSize;\r\nend;\r\n\r\n\r\nprocedure TDataSet.Resync(Mode: TResyncMode);\r\n\r\nvar i,count : integer;\r\n\r\nbegin\r\n  // See if we can find the requested record.\r\n{$ifdef dsdebug}\r\n    Writeln ('Resync called');\r\n{$endif}\r\n  if FIsUnidirectional then Exit;\r\n// place the cursor of the underlying dataset to the active record\r\n//  SetCurrentRecord(FActiveRecord);\r\n\r\n// Now look if the data on the current cursor of the underlying dataset is still available\r\n  If GetRecord(FBuffers[0],gmCurrent,False)<>grOk Then\r\n// If that fails and rmExact is set, then raise an exception\r\n    If rmExact in Mode then\r\n      DatabaseError(SNoSuchRecord,Self)\r\n// else, if rmexact is not set, try to fetch the next  or prior record in the underlying dataset\r\n    else if (GetRecord(FBuffers[0],gmNext,True)<>grOk) and\r\n            (GetRecord(FBuffers[0],gmPrior,True)<>grOk) then\r\n      begin\r\n{$ifdef dsdebug}\r\n      Writeln ('Resync: fuzzy resync');\r\n{$endif}\r\n      // nothing found, invalidate buffer and bail out.\r\n      ClearBuffers;\r\n      // Make sure that the active record is 'empty', ie: that all fields are null\r\n      InternalInitRecord(FBuffers[FActiveRecord]);\r\n      DataEvent(deDatasetChange,0);\r\n      exit;\r\n      end;\r\n  FCurrentRecord := 0;\r\n  FEOF := false;\r\n  FBOF := false;\r\n\r\n// If we've arrived here, FBuffer[0] is the current record\r\n  If (rmCenter in Mode) then\r\n    count := (FRecordCount div 2)\r\n  else\r\n    count := FActiveRecord;\r\n  i := 0;\r\n  FRecordCount := 1;\r\n  FActiveRecord := 0;\r\n\r\n// Fill the buffers before the active record\r\n  while (i < count) and GetPriorRecord do\r\n    inc(i);\r\n  FActiveRecord := i;\r\n// Fill the rest of the buffer\r\n  GetNextRecords;\r\n// If the buffer is not full yet, try to fetch some more prior records\r\n  if FRecordCount < FBufferCount then FActiveRecord:=FActiveRecord+getpriorrecords;\r\n// That's all folks!\r\n  DataEvent(deDatasetChange,0);\r\nend;\r\n\r\nprocedure TDataSet.CancelLoading;\r\nbegin\r\n  FMinLoadID:=FDataRequestID;\r\n  FloadCount:=0;\r\nend;\r\n\r\nprocedure TDataSet.SetFields(const Values: array of JSValue);\r\n\r\nVar I  : longint;\r\nbegin\r\n  For I:=0 to high(Values) do\r\n    Fields[I].AssignValue(Values[I]);\r\nend;\r\n\r\nfunction TDataSet.TryDoing(P: TDataOperation; Ev: TDatasetErrorEvent): Boolean;\r\n\r\nVar Retry : TDataAction;\r\n\r\nbegin\r\n{$ifdef dsdebug}\r\n  Writeln ('Trying to do');\r\n  If P=Nil then writeln ('Procedure to call is nil !!!');\r\n{$endif dsdebug}\r\n  Result:=True;\r\n  Retry:=daRetry;\r\n  while Retry=daRetry do\r\n    Try\r\n{$ifdef dsdebug}\r\n      Writeln ('Trying : updatecursorpos');\r\n{$endif dsdebug}\r\n      UpdateCursorPos;\r\n{$ifdef dsdebug}\r\n      Writeln ('Trying to do it');\r\n{$endif dsdebug}\r\n      P();\r\n      exit;\r\n    except\r\n      On E : EDatabaseError do\r\n        begin\r\n        retry:=daFail;\r\n        If Assigned(Ev) then\r\n          Ev(Self,E,Retry);\r\n        Case Retry of\r\n          daFail : Raise;\r\n          daAbort : Abort;\r\n        end;\r\n        end;\r\n    else\r\n      Raise;\r\n    end;\r\n{$ifdef dsdebug}\r\n  Writeln ('Exit Trying to do');\r\n{$endif dsdebug}\r\nend;\r\n\r\nprocedure TDataSet.UpdateCursorPos;\r\n\r\nbegin\r\n  If FRecordCount>0 then\r\n    SetCurrentRecord(FActiveRecord);\r\nend;\r\n\r\nprocedure TDataSet.UpdateRecord;\r\n\r\nbegin\r\n  if not (State in dsEditModes) then\r\n    DatabaseErrorFmt(SNotEditing, [Name], Self);\r\n  DataEvent(deUpdateRecord, 0);\r\nend;\r\n\r\nfunction TDataSet.GetPendingUpdates: TResolveInfoArray;\r\n\r\nVar\r\n  L : TRecordUpdateDescriptorList;\r\n  I : integer;\r\n\r\nbegin\r\n  L:=TRecordUpdateDescriptorList.Create;\r\n  try\r\n    SetLength(Result,GetRecordUpdates(L));\r\n    For I:=0 to L.Count-1 do\r\n      Result[i]:=RecordUpdateDescriptorToResolveInfo(L[i]);\r\n  finally\r\n    L.Free;\r\n  end;\r\nend;\r\n\r\n\r\n\r\nprocedure TDataSet.SetConstraints(Value: TCheckConstraints);\r\nbegin\r\n  FConstraints.Assign(Value);\r\nend;\r\n\r\nprocedure TDataSet.SetDataProxy(AValue: TDataProxy);\r\nbegin\r\n  If AValue=FDataProxy then\r\n    exit;\r\n  if Assigned(FDataProxy) then\r\n    FDataProxy.RemoveFreeNotification(Self);\r\n  FDataProxy:=AValue;\r\n  if Assigned(FDataProxy) then\r\n    FDataProxy.FreeNotification(Self)\r\nend;\r\n\r\nfunction TDataSet.GetfieldCount: Integer;\r\n\r\nbegin\r\n  Result:=FFieldList.Count;\r\nend;\r\n\r\nprocedure TDataSet.ShiftBuffersBackward;\r\n\r\nvar\r\n  TempBuf : TDataRecord;\r\n  I : Integer;\r\n\r\nbegin\r\n  TempBuf := FBuffers[0];\r\n  For I:=1 to FBufferCount do\r\n    FBuffers[I-1]:=FBuffers[i];\r\n  FBuffers[FBufferCount]:=TempBuf;\r\nend;\r\n\r\nprocedure TDataSet.ShiftBuffersForward;\r\n\r\nvar\r\n  TempBuf : TDataRecord;\r\n  I : Integer;\r\n\r\nbegin\r\n  TempBuf := FBuffers[FBufferCount];\r\n  For I:=FBufferCount downto 1 do\r\n    FBuffers[I]:=FBuffers[i-1];\r\n  FBuffers[0]:=TempBuf;\r\nend;\r\n\r\nfunction TDataSet.GetFieldValues(const FieldName: string): JSValue;\r\n\r\nvar\r\n  i: Integer;\r\n  FieldList: TList;\r\n  A : TJSValueDynArray;\r\n\r\nbegin\r\n  FieldList := TList.Create;\r\n  try\r\n    GetFieldList(FieldList, FieldName);\r\n    if FieldList.Count>1 then\r\n      begin\r\n      SetLength(A,FieldList.Count);\r\n      for i := 0 to FieldList.Count - 1 do\r\n        A[i] := TField(FieldList[i]).Value;\r\n      Result:=A;\r\n      end\r\n    else\r\n      Result := FieldByName(FieldName).Value;\r\n  finally\r\n    FieldList.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TDataSet.SetFieldValues(const FieldName: string; Value: JSValue);\r\n\r\nvar\r\n  i : Integer;\r\n  FieldList: TList;\r\n  A : TJSValueDynArray;\r\n\r\nbegin\r\n  if IsArray(Value) then\r\n    begin\r\n    FieldList := TList.Create;\r\n    try\r\n      GetFieldList(FieldList, FieldName);\r\n      A:=TJSValueDynArray(Value);\r\n      if (FieldList.Count = 1) and (Length(A)>0) then\r\n        // Allow for a field type that can deal with an array\r\n        FieldByName(FieldName).Value := Value\r\n      else\r\n        for i := 0 to FieldList.Count - 1 do\r\n          TField(FieldList[i]).Value := A[i];\r\n    finally\r\n      FieldList.Free;\r\n    end;\r\n    end\r\n  else\r\n    FieldByName(FieldName).Value := Value;\r\nend;\r\n\r\nfunction TDataSet.Locate(const KeyFields: string; const KeyValues: JSValue;\r\n  Options: TLocateOptions): boolean;\r\n\r\nbegin\r\n  CheckBiDirectional;\r\n  Result := False;\r\nend;\r\n\r\nfunction TDataSet.Lookup(const KeyFields: string; const KeyValues: JSValue;\r\n  const ResultFields: string): JSValue;\r\n\r\nbegin\r\n  CheckBiDirectional;\r\n  Result := Null;\r\nend;\r\n\r\n\r\nprocedure TDataSet.UnRegisterDataSource(ADataSource: TDataSource);\r\n\r\nbegin\r\n  FDataSources.Remove(ADataSource);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    TFieldDef\r\n  ---------------------------------------------------------------------}\r\n\r\nconstructor TFieldDef.Create(ACollection: TCollection);\r\n\r\nbegin\r\n  Inherited Create(ACollection);\r\n  FFieldNo:=Index+1;\r\nend;\r\n\r\nconstructor TFieldDef.Create(AOwner: TFieldDefs; const AName: string; ADataType: TFieldType; ASize: Integer; ARequired: Boolean;\r\n  AFieldNo: Longint);\r\nbegin\r\n{$ifdef dsdebug }\r\n  Writeln('TFieldDef.Create : ',Aname,'(',AFieldNo,')');\r\n{$endif}\r\n  Inherited Create(AOwner);\r\n  Name:=Aname;\r\n  FDatatype:=ADatatype;\r\n  FSize:=ASize;\r\n  FRequired:=ARequired;\r\n  FPrecision:=-1;\r\n  FFieldNo:=AFieldNo;\r\nend;\r\n\r\ndestructor TFieldDef.Destroy;\r\n\r\nbegin\r\n  Inherited destroy;\r\nend;\r\n\r\nprocedure TFieldDef.Assign(Source: TPersistent);\r\nvar fd: TFieldDef;\r\nbegin\r\n  fd := nil;\r\n  if Source is TFieldDef then\r\n    fd := Source as TFieldDef;\r\n  if Assigned(fd) then begin\r\n    Collection.BeginUpdate;\r\n    try\r\n      Name := fd.Name;\r\n      DataType := fd.DataType;\r\n      Size := fd.Size;\r\n      Precision := fd.Precision;\r\n      FRequired := fd.Required;\r\n    finally\r\n      Collection.EndUpdate;\r\n    end;\r\n  end\r\n  else\r\n    inherited Assign(Source);\r\nend;\r\n\r\nfunction TFieldDef.CreateField(AOwner: TComponent): TField;\r\n\r\nvar TheField : TFieldClass;\r\n\r\nbegin\r\n{$ifdef dsdebug}\r\n  Writeln ('Creating field '+FNAME);\r\n{$endif dsdebug}\r\n  TheField:=GetFieldClass;\r\n  if TheField=Nil then\r\n    DatabaseErrorFmt(SUnknownFieldType,[FName]);\r\n  Result:=TheField.Create(AOwner);\r\n  Try\r\n    Result.FFieldDef:=Self;\r\n    Result.Size:=FSize;\r\n    Result.Required:=FRequired;\r\n    Result.FFieldName:=FName;\r\n    Result.FDisplayLabel:=DisplayName;\r\n    Result.FFieldNo:=Self.FieldNo;\r\n    Result.SetFieldType(DataType);\r\n    Result.FReadOnly:=(faReadOnly in Attributes);\r\n{$ifdef dsdebug}\r\n    Writeln ('TFieldDef.CreateField : Result Fieldno : ',Result.FieldNo,'; Self : ',FieldNo);\r\n    Writeln ('TFieldDef.CreateField : Trying to set dataset');\r\n{$endif dsdebug}\r\n    Result.Dataset:=TFieldDefs(Collection).Dataset;\r\n   if (Result is TFloatField) then\r\n      TFloatField(Result).Precision := FPrecision;\r\n  except\r\n    Result.Free;\r\n    Raise;\r\n  end;\r\nend;\r\n\r\nprocedure TFieldDef.SetAttributes(AValue: TFieldAttributes);\r\nbegin\r\n  FAttributes := AValue;\r\n  Changed(False);\r\nend;\r\n\r\nprocedure TFieldDef.SetDataType(AValue: TFieldType);\r\nbegin\r\n  FDataType := AValue;\r\n  Changed(False);\r\nend;\r\n\r\nprocedure TFieldDef.SetPrecision(const AValue: Longint);\r\nbegin\r\n  FPrecision := AValue;\r\n  Changed(False);\r\nend;\r\n\r\nprocedure TFieldDef.SetSize(const AValue: Integer);\r\nbegin\r\n  FSize := AValue;\r\n  Changed(False);\r\nend;\r\n\r\nprocedure TFieldDef.SetRequired(const AValue: Boolean);\r\nbegin\r\n  FRequired := AValue;\r\n  Changed(False);\r\nend;\r\n\r\nfunction TFieldDef.GetFieldClass: TFieldClass;\r\n\r\nbegin\r\n  //!! Should be owner as tdataset but that doesn't work ??\r\n\r\n  If Assigned(Collection) And\r\n     (Collection is TFieldDefs) And\r\n     Assigned(TFieldDefs(Collection).Dataset) then\r\n    Result:=TFieldDefs(Collection).Dataset.GetFieldClass(FDataType)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    TFieldDefs\r\n  ---------------------------------------------------------------------}\r\n\r\n{\r\ndestructor TFieldDefs.Destroy;\r\n\r\nbegin\r\n  FItems.Free;\r\n  // This will destroy all fielddefs since we own them...\r\n  Inherited Destroy;\r\nend;\r\n}\r\n\r\nprocedure TFieldDefs.Add(const AName: string; ADataType: TFieldType);\r\n\r\nbegin\r\n  Add(AName,ADatatype,0,False);\r\nend;\r\n\r\nprocedure TFieldDefs.Add(const AName: string; ADataType: TFieldType; ASize : Word);\r\n\r\nbegin\r\n  Add(AName,ADatatype,ASize,False);\r\nend;\r\n\r\nprocedure TFieldDefs.Add(const AName: string; ADataType: TFieldType; ASize: Word;\r\n  ARequired: Boolean);\r\n\r\nbegin\r\n  If Length(AName)=0 Then\r\n    DatabaseError(SNeedFieldName,Dataset);\r\n  // the fielddef will register itself here as an owned component.\r\n  // fieldno is 1 based !\r\n  BeginUpdate;\r\n  try\r\n    Add(AName,ADataType,ASize,ARequired,Count+1);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nfunction TFieldDefs.Add: TFieldDef;\r\nbegin\r\n  Result := TFieldDef(inherited Add);\r\nend;\r\n\r\nfunction TFieldDefs.GetItem(Index: Longint): TFieldDef;\r\n\r\nbegin\r\n  Result := TFieldDef(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TFieldDefs.SetItem(Index: Longint; const AValue: TFieldDef);\r\nbegin\r\n  inherited Items[Index] := AValue;\r\nend;\r\n\r\nclass function TFieldDefs.FieldDefClass: TFieldDefClass;\r\nbegin\r\n  Result:=TFieldDef;\r\nend;\r\n\r\nconstructor TFieldDefs.Create(ADataSet: TDataSet);\r\nbegin\r\n  Inherited Create(ADataset, Owner, FieldDefClass);\r\nend;\r\n\r\nfunction TFieldDefs.Add(const AName: string; ADataType: TFieldType; ASize, APrecision: Integer;\r\n  ARequired, AReadOnly: Boolean; AFieldNo: Integer): TFieldDef;\r\nbegin\r\n  Result:=FieldDefClass.Create(Self, MakeNameUnique(AName), ADataType, ASize, ARequired, AFieldNo);\r\n  if AReadOnly then\r\n    Result.Attributes := Result.Attributes + [faReadOnly];\r\nend;\r\n\r\nfunction TFieldDefs.Add(const AName: string; ADataType: TFieldType; ASize: Word; ARequired: Boolean; AFieldNo: Integer): TFieldDef;\r\nbegin\r\n  Result:=FieldDefClass.Create(Self,AName,ADataType,ASize,ARequired,AFieldNo);\r\nend;\r\n\r\nprocedure TFieldDefs.Assign(FieldDefs: TFieldDefs);\r\n\r\nvar I : longint;\r\n\r\nbegin\r\n  Clear;\r\n  For i:=0 to FieldDefs.Count-1 do\r\n    With FieldDefs[i] do\r\n      Add(Name,DataType,Size,Required);\r\nend;\r\n\r\nfunction TFieldDefs.Find(const AName: string): TFieldDef;\r\nbegin\r\n  Result := (Inherited Find(AName)) as TFieldDef;\r\n  if Result=nil then DatabaseErrorFmt(SFieldNotFound,[AName],FDataset);\r\nend;\r\n\r\n{\r\nprocedure TFieldDefs.Clear;\r\n\r\nvar I : longint;\r\n\r\nbegin\r\n  For I:=FItems.Count-1 downto 0 do\r\n    TFieldDef(Fitems[i]).Free;\r\n  FItems.Clear;\r\nend;\r\n}\r\n\r\nprocedure TFieldDefs.Update;\r\n\r\nbegin\r\n  if not Updated then\r\n    begin\r\n    If Assigned(Dataset) then\r\n      DataSet.InitFieldDefs;\r\n    Updated := True;\r\n    end;\r\nend;\r\n\r\nfunction TFieldDefs.MakeNameUnique(const AName: String): string;\r\nvar DblFieldCount : integer;\r\nbegin\r\n  DblFieldCount := 0;\r\n  Result := AName;\r\n  while assigned(inherited Find(Result)) do\r\n    begin\r\n    inc(DblFieldCount);\r\n    Result := AName + '_' + IntToStr(DblFieldCount);\r\n    end;\r\nend;\r\n\r\nfunction TFieldDefs.AddFieldDef: TFieldDef;\r\n\r\nbegin\r\n  Result:=FieldDefClass.Create(Self,'',ftUnknown,0,False,Count+1);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    TField\r\n  ---------------------------------------------------------------------}\r\n\r\nConst\r\n//  SBCD = 'BCD';\r\n  SBoolean = 'Boolean';\r\n  SDateTime = 'TDateTime';\r\n  SFloat = 'Float';\r\n  SInteger = 'Integer';\r\n  SLargeInt = 'NativeInt';\r\n  SJSValue = 'JSValue';\r\n  SString = 'String';\r\n  SBytes = 'Bytes';\r\n\r\nconstructor TField.Create(AOwner: TComponent);\r\n\r\n//Var\r\n//  I : Integer;\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  FVisible:=True;\r\n  SetLength(FValidChars,255);\r\n//  For I:=0 to 255 do\r\n//    FValidChars[i]:=Char(i);\r\n\r\n  FProviderFlags := [pfInUpdate,pfInWhere];\r\nend;\r\n\r\ndestructor TField.Destroy;\r\n\r\nbegin\r\n  IF Assigned(FDataSet) then\r\n    begin\r\n    FDataSet.Active:=False;\r\n    if Assigned(FFields) then\r\n      FFields.Remove(Self);\r\n    end;\r\n  FLookupList.Free;\r\n  Inherited Destroy;\r\nend;\r\n\r\nProcedure TField.RaiseAccessError(const TypeName: string);\r\n\r\nVar\r\n  E : EDatabaseError;\r\n\r\nbegin\r\n  E:=AccessError(TypeName);\r\n  Raise E;\r\nend;\r\n\r\nfunction TField.AccessError(const TypeName: string): EDatabaseError;\r\n\r\nbegin\r\n  Result:=EDatabaseError.CreateFmt(SinvalidTypeConversion,[TypeName,FFieldName]);\r\nend;\r\n\r\nprocedure TField.Assign(Source: TPersistent);\r\n\r\nbegin\r\n  if Source = nil then Clear\r\n  else if Source is TField then begin\r\n    Value := TField(Source).Value;\r\n  end else\r\n    inherited Assign(Source);\r\nend;\r\n\r\nprocedure TField.AssignValue(const AValue: JSValue);\r\n\r\n  procedure Error;\r\n  begin\r\n    DatabaseErrorFmt(SFieldValueError, [DisplayName]);\r\n  end;\r\n\r\nbegin\r\n  Case GetValueType(AValue) of\r\n    jvtNull : Clear;\r\n    jvtBoolean : AsBoolean:=Boolean(AValue);\r\n    jvtInteger : AsLargeInt:=NativeInt(AValue);\r\n    jvtFloat : AsFloat:=Double(AValue);\r\n    jvtString : AsString:=String(AValue);\r\n    jvtArray : SetAsBytes(TBytes(AValue));\r\n  else\r\n    Error;\r\n  end;\r\nend;\r\n\r\nprocedure TField.Bind(Binding: Boolean);\r\n\r\nbegin\r\n  if Binding and (FieldKind=fkLookup) then\r\n    begin\r\n    if ((FLookupDataSet = nil) or (FLookupKeyFields = '') or\r\n       (FLookupResultField = '') or (FKeyFields = '')) then\r\n      DatabaseErrorFmt(SLookupInfoError, [DisplayName]);\r\n    FFields.CheckFieldNames(FKeyFields);\r\n    FLookupDataSet.Open;\r\n    FLookupDataSet.Fields.CheckFieldNames(FLookupKeyFields);\r\n    FLookupDataSet.FieldByName(FLookupResultField);\r\n    if FLookupCache then\r\n      RefreshLookupList;\r\n    end;\r\nend;\r\n\r\nprocedure TField.Change;\r\n\r\nbegin\r\n  If Assigned(FOnChange) Then\r\n    FOnChange(Self);\r\nend;\r\n\r\nprocedure TField.CheckInactive;\r\n\r\nbegin\r\n  If Assigned(FDataSet) then\r\n    FDataset.CheckInactive;\r\nend;\r\n\r\nprocedure TField.Clear;\r\n\r\nbegin\r\n  SetData(Nil);\r\nend;\r\n\r\nprocedure TField.DataChanged;\r\n\r\nbegin\r\n  FDataset.DataEvent(deFieldChange,self);\r\nend;\r\n\r\nprocedure TField.FocusControl;\r\nvar\r\n  Field1: TField;\r\nbegin\r\n  Field1 := Self;\r\n  FDataSet.DataEvent(deFocusControl,Field1);\r\nend;\r\n\r\nfunction TField.GetAsBoolean: Boolean;\r\nbegin\r\n  raiseAccessError(SBoolean);\r\n  Result:=false;\r\nend;\r\n\r\nfunction TField.GetAsBytes: TBytes;\r\n\r\nbegin\r\n  raiseAccessError(SBytes);\r\n  Result:=nil;\r\nend;\r\n\r\n\r\nfunction TField.GetAsDateTime: TDateTime;\r\n\r\nbegin\r\n  raiseAccessError(SdateTime);\r\n  Result:=0.0;\r\nend;\r\n\r\nfunction TField.GetAsFloat: Double;\r\n\r\nbegin\r\n  raiseAccessError(SDateTime);\r\n  Result:=0.0;\r\nend;\r\n\r\nfunction TField.GetAsLargeInt: NativeInt;\r\nbegin\r\n  RaiseAccessError(SLargeInt);\r\n  Result:=0;\r\nend;\r\n\r\nfunction TField.GetAsLongint: Longint;\r\n\r\nbegin\r\n  Result:=GetAsInteger;\r\nend;\r\n\r\nfunction TField.GetAsInteger: Longint;\r\n\r\nbegin\r\n  RaiseAccessError(SInteger);\r\n  Result:=0;\r\nend;\r\n\r\nfunction TField.GetAsJSValue: JSValue;\r\n\r\nbegin\r\n  Result:=GetData\r\nend;\r\n\r\n\r\nfunction TField.GetAsString: string;\r\nbegin\r\n  Result := GetClassDesc\r\nend;\r\n\r\nfunction TField.GetOldValue: JSValue;\r\n\r\nvar SaveState : TDatasetState;\r\n\r\nbegin\r\n  SaveState := FDataset.State;\r\n  try\r\n    FDataset.SetTempState(dsOldValue);\r\n    Result := GetAsJSValue;\r\n  finally\r\n    FDataset.RestoreState(SaveState);\r\n  end;\r\nend;\r\n\r\nfunction TField.GetNewValue: JSValue;\r\n\r\nvar SaveState : TDatasetState;\r\n\r\nbegin\r\n  SaveState := FDataset.State;\r\n  try\r\n    FDataset.SetTempState(dsNewValue);\r\n    Result := GetAsJSValue;\r\n  finally\r\n    FDataset.RestoreState(SaveState);\r\n  end;\r\nend;\r\n\r\nprocedure TField.SetNewValue(const AValue: JSValue);\r\n\r\nvar SaveState : TDatasetState;\r\n\r\nbegin\r\n  SaveState := FDataset.State;\r\n  try\r\n    FDataset.SetTempState(dsNewValue);\r\n    SetAsJSValue(AValue);\r\n  finally\r\n    FDataset.RestoreState(SaveState);\r\n  end;\r\nend;\r\n\r\nfunction TField.GetCurValue: JSValue;\r\n\r\nvar SaveState : TDatasetState;\r\n\r\nbegin\r\n  SaveState := FDataset.State;\r\n  try\r\n    FDataset.SetTempState(dsCurValue);\r\n    Result := GetAsJSValue;\r\n  finally\r\n    FDataset.RestoreState(SaveState);\r\n  end;\r\nend;\r\n\r\nfunction TField.GetCanModify: Boolean;\r\n\r\nbegin\r\n  Result:=Not ReadOnly;\r\n  If Result then\r\n    begin\r\n    Result := FieldKind in [fkData, fkInternalCalc];\r\n    if Result then\r\n      begin\r\n      Result:=Assigned(DataSet) and Dataset.Active;\r\n      If Result then\r\n        Result:= DataSet.CanModify;\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction TField.GetClassDesc: String;\r\nvar ClassN : string;\r\nbegin\r\n  ClassN := copy(ClassName,2,pos('Field',ClassName)-2);\r\n  if isNull then\r\n    result := '(' + LowerCase(ClassN) + ')'\r\n   else\r\n    result := '(' + UpperCase(ClassN) + ')';\r\nend;\r\n\r\n\r\nfunction TField.GetData : JSValue;\r\n\r\nbegin\r\n  IF FDataset=Nil then\r\n    DatabaseErrorFmt(SNoDataset,[FieldName]);\r\n  If FValidating then\r\n    result:=FValueBuffer\r\n  else\r\n    Result:=FDataset.GetFieldData(Self);\r\nend;\r\n\r\nfunction TField.GetDataSize: Integer;\r\n\r\nbegin\r\n  Result:=0;\r\nend;\r\n\r\nfunction TField.GetDefaultWidth: Longint;\r\n\r\nbegin\r\n  Result:=10;\r\nend;\r\n\r\nfunction TField.GetDisplayName  : String;\r\n\r\nbegin\r\n  If FDisplayLabel<>'' then\r\n    result:=FDisplayLabel\r\n  else\r\n    Result:=FFieldName;\r\nend;\r\n\r\nfunction TField.IsDisplayLabelStored: Boolean;\r\n\r\nbegin\r\n  Result:=(DisplayLabel<>FieldName);\r\nend;\r\n\r\nfunction TField.IsDisplayWidthStored: Boolean;\r\n\r\nbegin\r\n  Result:=(FDisplayWidth<>0);\r\nend;\r\n\r\nfunction TField.GetLookupList: TLookupList;\r\nbegin\r\n  if not Assigned(FLookupList) then\r\n    FLookupList := TLookupList.Create;\r\n  Result := FLookupList;\r\nend;\r\n\r\nprocedure TField.CalcLookupValue;\r\nbegin\r\n// MVC: TODO\r\n//  if FLookupCache then\r\n//    Value := LookupList.ValueOfKey(FDataSet.FieldValues[FKeyFields])\r\n//  else if\r\n  if Assigned(FLookupDataSet) and FDataSet.Active then\r\n    Value := FLookupDataSet.Lookup(FLookupKeyfields, FDataSet.FieldValues[FKeyFields], FLookupresultField)\r\n  else\r\n    Value:=Null;\r\nend;\r\n\r\nfunction TField.GetIndex: longint;\r\n\r\nbegin\r\n  If Assigned(FDataset) then\r\n    Result:=FDataset.FFieldList.IndexOf(Self)\r\n  else\r\n    Result:=-1;\r\nend;\r\n\r\nfunction TField.GetLookup: Boolean;\r\nbegin\r\n  Result := FieldKind = fkLookup;\r\nend;\r\n\r\nprocedure TField.SetAlignment(const AValue: TAlignMent);\r\nbegin\r\n  if FAlignment <> AValue then\r\n    begin\r\n    FAlignment := AValue;\r\n    PropertyChanged(false);\r\n    end;\r\nend;\r\n\r\nprocedure TField.SetIndex(const AValue: Longint);\r\nbegin\r\n  if FFields <> nil then FFields.SetFieldIndex(Self, AValue)\r\nend;\r\n\r\nfunction TField.GetIsNull: Boolean;\r\n\r\nbegin\r\n  Result:=js.IsNull(GetData);\r\nend;\r\n\r\nfunction TField.GetParentComponent: TComponent;\r\n\r\nbegin\r\n  Result := DataSet;\r\nend;\r\n\r\nprocedure TField.GetText(var AText: string; ADisplayText: Boolean);\r\n\r\nbegin\r\n  AText:=GetAsString;\r\nend;\r\n\r\nfunction TField.HasParent: Boolean;\r\n\r\nbegin\r\n  HasParent:=True;\r\nend;\r\n\r\nfunction TField.IsValidChar(InputChar: Char): Boolean;\r\n\r\nbegin\r\n  // FValidChars must be set in Create.\r\n  Result:=CharInset(InputChar,FValidChars);\r\nend;\r\n\r\nprocedure TField.RefreshLookupList;\r\nvar\r\n  tmpActive: Boolean;\r\nbegin\r\n  if not Assigned(FLookupDataSet) or (Length(FLookupKeyfields) = 0)\r\n  or (Length(FLookupresultField) = 0) or (Length(FKeyFields) = 0) then\r\n    Exit;\r\n    \r\n  tmpActive := FLookupDataSet.Active;\r\n  try\r\n    FLookupDataSet.Active := True;\r\n    FFields.CheckFieldNames(FKeyFields);\r\n    FLookupDataSet.Fields.CheckFieldNames(FLookupKeyFields);\r\n    FLookupDataset.FieldByName(FLookupResultField); // I presume that if it doesn't exist it throws exception, and that a field with null value is still valid\r\n    LookupList.Clear; // have to be F-less because we might be creating it here with getter!\r\n\r\n    FLookupDataSet.DisableControls;\r\n    try\r\n      FLookupDataSet.First;\r\n      while not FLookupDataSet.Eof do\r\n      begin\r\n//        FLookupList.Add(FLookupDataSet.FieldValues[FLookupKeyfields], FLookupDataSet.FieldValues[FLookupResultField]);\r\n        FLookupDataSet.Next;\r\n      end;\r\n    finally\r\n      FLookupDataSet.EnableControls;\r\n    end;\r\n  finally\r\n    FLookupDataSet.Active := tmpActive;\r\n  end;\r\nend;\r\n\r\nprocedure TField.Notification(AComponent: TComponent; Operation: TOperation);\r\n\r\nbegin\r\n  Inherited Notification(AComponent,Operation);\r\n  if (Operation = opRemove) and (AComponent = FLookupDataSet) then\r\n    FLookupDataSet := nil;\r\nend;\r\n\r\nprocedure TField.PropertyChanged(LayoutAffected: Boolean);\r\n\r\nbegin\r\n  If (FDataset<>Nil) and (FDataset.Active) then\r\n    If LayoutAffected then\r\n      FDataset.DataEvent(deLayoutChange,0)\r\n    else\r\n      FDataset.DataEvent(deDatasetchange,0);\r\nend;\r\n\r\n\r\nprocedure TField.SetAsBytes(const AValue: TBytes);\r\nbegin\r\n  RaiseAccessError(SBytes);\r\nend;\r\n\r\nprocedure TField.SetAsBoolean(AValue: Boolean);\r\n\r\nbegin\r\n  RaiseAccessError(SBoolean);\r\nend;\r\n\r\nprocedure TField.SetAsDateTime(AValue: TDateTime);\r\n\r\nbegin\r\n  RaiseAccessError(SDateTime);\r\nend;\r\n\r\nprocedure TField.SetAsFloat(AValue: Double);\r\n\r\nbegin\r\n  RaiseAccessError(SFloat);\r\nend;\r\n\r\nprocedure TField.SetAsJSValue(const AValue: JSValue);\r\n\r\nbegin\r\n  if js.IsNull(AValue) then\r\n    Clear\r\n  else\r\n    try\r\n      SetVarValue(AValue);\r\n    except\r\n      on EVariantError do\r\n        DatabaseErrorFmt(SFieldValueError, [DisplayName]);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TField.SetAsLongint(AValue: Longint);\r\nbegin\r\n  SetAsInteger(AValue);\r\nend;\r\n\r\nprocedure TField.SetAsInteger(AValue: Longint);\r\nbegin\r\n  RaiseAccessError(SInteger);\r\nend;\r\n\r\nprocedure TField.SetAsLargeInt(AValue: NativeInt);\r\nbegin\r\n  RaiseAccessError(SLargeInt);\r\nend;\r\n\r\nprocedure TField.SetAsString(const AValue: string);\r\nbegin\r\n  RaiseAccessError(SString);\r\nend;\r\n\r\nprocedure TField.SetData(Buffer: JSValue);\r\n\r\nbegin\r\n  If Not Assigned(FDataset) then\r\n    DatabaseErrorFmt(SNoDataset,[FieldName]);\r\n  FDataSet.SetFieldData(Self,Buffer);\r\nend;\r\n\r\nprocedure TField.SetDataset(AValue: TDataset);\r\n\r\nbegin\r\n{$ifdef dsdebug}\r\n  Writeln ('Setting dataset');\r\n{$endif}\r\n  If AValue=FDataset then exit;\r\n  If Assigned(FDataset) Then\r\n    begin\r\n    FDataset.CheckInactive;\r\n    FDataset.FFieldList.Remove(Self);\r\n    end;\r\n  If Assigned(AValue) then\r\n    begin\r\n    AValue.CheckInactive;\r\n    AValue.FFieldList.Add(Self);\r\n    end;\r\n  FDataset:=AValue;\r\nend;\r\n\r\nprocedure TField.SetDataType(AValue: TFieldType);\r\nbegin\r\n  FDataType := AValue;\r\nend;\r\n\r\nprocedure TField.SetFieldType(AValue: TFieldType);\r\nbegin\r\n  { empty }\r\nend;\r\n\r\nprocedure TField.SetParentComponent(Value: TComponent);\r\nbegin\r\n//  if not (csLoading in ComponentState) then\r\n    DataSet := Value as TDataSet\r\nend;\r\n\r\nprocedure TField.SetSize(AValue: Integer);\r\nbegin\r\n  CheckInactive;\r\n  CheckTypeSize(AValue);\r\n  FSize:=AValue;\r\nend;\r\n\r\nprocedure TField.SetText(const AValue: string);\r\nbegin\r\n  SetAsString(AValue);\r\nend;\r\n\r\nprocedure TField.SetVarValue(const AValue: JSValue);\r\nbegin\r\n  RaiseAccessError(SJSValue);\r\nend;\r\n\r\nprocedure TField.Validate(Buffer: Pointer);\r\nbegin\r\n  If assigned(OnValidate) Then\r\n    begin\r\n    FValueBuffer:=Buffer;\r\n    FValidating:=True;\r\n    Try\r\n      OnValidate(Self);\r\n    finally\r\n      FValidating:=False;\r\n    end;\r\n    end;\r\nend;\r\n\r\nclass function TField.IsBlob: Boolean;\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\nclass procedure TField.CheckTypeSize(AValue: Longint);\r\n\r\nbegin\r\n  If (AValue<>0) and Not IsBlob Then\r\n    DatabaseErrorFmt(SInvalidFieldSize,[AValue]);\r\nend;\r\n\r\n// TField private methods\r\n\r\nprocedure TField.SetEditText(const AValue: string);\r\nbegin\r\n  if Assigned(OnSetText) then\r\n    OnSetText(Self, AValue)\r\n  else\r\n    SetText(AValue);\r\nend;\r\n\r\nfunction TField.GetEditText: String;\r\nbegin\r\n  SetLength(Result, 0);\r\n  if Assigned(OnGetText) then\r\n    OnGetText(Self, Result, False)\r\n  else\r\n    GetText(Result, False);\r\nend;\r\n\r\nfunction TField.GetDisplayText: String;\r\nbegin\r\n  SetLength(Result, 0);\r\n  if Assigned(OnGetText) then\r\n    OnGetText(Self, Result, True)\r\n  else\r\n    GetText(Result, True);\r\nend;\r\n\r\nprocedure TField.SetDisplayLabel(const AValue: string);\r\nbegin\r\n  if FDisplayLabel<>AValue then\r\n    begin\r\n    FDisplayLabel:=AValue;\r\n    PropertyChanged(true);\r\n    end;\r\nend;\r\n\r\nprocedure TField.SetDisplayWidth(const AValue: Longint);\r\nbegin\r\n  if FDisplayWidth<>AValue then\r\n    begin\r\n    FDisplayWidth:=AValue;\r\n    PropertyChanged(True);\r\n    end;\r\nend;\r\n\r\nfunction TField.GetDisplayWidth: integer;\r\nbegin\r\n  if FDisplayWidth=0 then\r\n    result:=GetDefaultWidth\r\n  else\r\n    result:=FDisplayWidth;\r\nend;\r\n\r\nprocedure TField.SetLookup(const AValue: Boolean);\r\nconst\r\n  ValueToLookupMap: array[Boolean] of TFieldKind = (fkData, fkLookup);\r\nbegin\r\n  FieldKind := ValueToLookupMap[AValue];\r\nend;\r\n\r\nprocedure TField.SetReadOnly(const AValue: Boolean);\r\nbegin\r\n  if (FReadOnly<>AValue) then\r\n    begin\r\n    FReadOnly:=AValue;\r\n    PropertyChanged(True);\r\n    end;\r\nend;\r\n\r\nprocedure TField.SetVisible(const AValue: Boolean);\r\nbegin\r\n  if FVisible<>AValue then\r\n    begin\r\n    FVisible:=AValue;\r\n    PropertyChanged(True);\r\n    end;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    TStringField\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nconstructor TStringField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  SetDataType(ftString);\r\n  FFixedChar := False;\r\n  FTransliterate := False;\r\n  FSize := 20;\r\nend;\r\n\r\nprocedure TStringField.SetFieldType(AValue: TFieldType);\r\nbegin\r\n  if AValue in [ftString, ftFixedChar] then\r\n    SetDataType(AValue);\r\nend;\r\n\r\nclass procedure TStringField.CheckTypeSize(AValue: Longint);\r\n\r\nbegin\r\n// A size of 0 is allowed, since for example Firebird allows\r\n// a query like: 'select '' as fieldname from table' which\r\n// results in a string with size 0.\r\n  If (AValue<0) Then\r\n    DatabaseErrorFmt(SInvalidFieldSize,[AValue])\r\nend;\r\n\r\nfunction TStringField.GetAsBoolean: Boolean;\r\n\r\nvar S : String;\r\n\r\nbegin\r\n  S:=GetAsString;\r\n  result := (Length(S)>0) and (Upcase(S[1]) in ['T',YesNoChars[True]]);\r\nend;\r\n\r\nfunction TStringField.GetAsDateTime: TDateTime;\r\n\r\nbegin\r\n  Result:=StrToDateTime(GetAsString);\r\nend;\r\n\r\nfunction TStringField.GetAsFloat: Double;\r\n\r\nbegin\r\n  Result:=StrToFloat(GetAsString);\r\nend;\r\n\r\nfunction TStringField.GetAsInteger: Longint;\r\n\r\nbegin\r\n  Result:=StrToInt(GetAsString);\r\nend;\r\n\r\nfunction TStringField.GetAsLargeInt: NativeInt;\r\n\r\nbegin\r\n  Result:=StrToInt64(GetAsString);\r\nend;\r\n\r\nfunction TStringField.GetAsString: String;\r\n\r\nVar\r\n  V : JSValue;\r\n\r\nbegin\r\n  V:=GetData;\r\n  if isString(V) then\r\n    Result := String(V)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n\r\nfunction TStringField.GetAsJSValue: JSValue;\r\n\r\nbegin\r\n  Result:=GetData\r\nend;\r\n\r\n\r\nfunction TStringField.GetDefaultWidth: Longint;\r\n\r\nbegin\r\n  result:=Size;\r\nend;\r\n\r\nprocedure TStringField.GetText(var AText: string; ADisplayText: Boolean);\r\n\r\nbegin\r\n    AText:=GetAsString;\r\nend;\r\n\r\n\r\nprocedure TStringField.SetAsBoolean(AValue: Boolean);\r\n\r\nbegin\r\n  If AValue Then\r\n    SetAsString('T')\r\n  else\r\n    SetAsString('F');\r\nend;\r\n\r\nprocedure TStringField.SetAsDateTime(AValue: TDateTime);\r\n\r\nbegin\r\n  SetAsString(DateTimeToStr(AValue));\r\nend;\r\n\r\nprocedure TStringField.SetAsFloat(AValue: Double);\r\n\r\nbegin\r\n  SetAsString(FloatToStr(AValue));\r\nend;\r\n\r\nprocedure TStringField.SetAsInteger(AValue: Longint);\r\n\r\nbegin\r\n  SetAsString(IntToStr(AValue));\r\nend;\r\n\r\nprocedure TStringField.SetAsLargeInt(AValue: NativeInt);\r\n\r\nbegin\r\n  SetAsString(IntToStr(AValue));\r\nend;\r\n\r\n\r\nprocedure TStringField.SetAsString(const AValue: String);\r\nbegin\r\n  SetData(AValue);\r\nend;\r\n\r\n\r\nprocedure TStringField.SetVarValue(const AValue: JSValue);\r\nbegin\r\n  if isString(AVAlue) then\r\n    SetAsString(String(AValue))\r\n  else\r\n    RaiseAccessError(SFieldValueError);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    TNumericField\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nconstructor TNumericField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  AlignMent:=taRightJustify;\r\nend;\r\n\r\nclass procedure TNumericField.CheckTypeSize(AValue: Longint);\r\nbegin\r\n  // This procedure is only added because some TDataset descendents have the\r\n  // but that they set the Size property as if it is the DataSize property.\r\n  // To avoid problems with those descendents, allow values <= 16.\r\n  If (AValue>16) Then\r\n    DatabaseErrorFmt(SInvalidFieldSize,[AValue]);\r\nend;\r\n\r\nprocedure TNumericField.RangeError(AValue, Min, Max: Double);\r\n\r\nbegin\r\n  DatabaseErrorFmt(SRangeError,[AValue,Min,Max,FieldName]);\r\nend;\r\n\r\nprocedure TNumericField.SetDisplayFormat(const AValue: string);\r\n\r\nbegin\r\n If FDisplayFormat<>AValue then\r\n   begin\r\n   FDisplayFormat:=AValue;\r\n   PropertyChanged(True);\r\n   end;\r\nend;\r\n\r\nprocedure TNumericField.SetEditFormat(const AValue: string);\r\n\r\nbegin\r\n  If FEditFormat<>AValue then\r\n    begin\r\n    FEditFormat:=AValue;\r\n    PropertyChanged(True);\r\n    end;\r\nend;\r\n\r\nfunction TNumericField.GetAsBoolean: Boolean;\r\nbegin\r\n  Result:=GetAsInteger<>0;\r\nend;\r\n\r\nprocedure TNumericField.SetAsBoolean(AValue: Boolean);\r\nbegin\r\n  SetAsInteger(ord(AValue));\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    TIntegerField\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nconstructor TIntegerField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  SetDataType(ftInteger);\r\n  FMinRange:=Low(LongInt);\r\n  FMaxRange:=High(LongInt);\r\n//  MVC : Todo\r\n//  FValidchars:=['+','-','0'..'9'];\r\nend;\r\n\r\nfunction TIntegerField.GetAsFloat: Double;\r\n\r\nbegin\r\n  Result:=GetAsInteger;\r\nend;\r\n\r\nfunction TIntegerField.GetAsLargeInt: NativeInt;\r\nbegin\r\n  Result:=GetAsInteger;\r\nend;\r\n\r\nfunction TIntegerField.GetAsInteger: Longint;\r\n\r\nbegin\r\n  If Not GetValue(Result) then\r\n    Result:=0;\r\nend;\r\n\r\nfunction TIntegerField.GetAsJSValue: JSValue;\r\n\r\nvar L : Longint;\r\n\r\nbegin\r\n  If GetValue(L) then\r\n    Result:=L\r\n  else\r\n    Result:=Null;\r\nend;\r\n\r\nfunction TIntegerField.GetAsString: string;\r\n\r\nvar L : Longint;\r\n\r\nbegin\r\n  If GetValue(L) then\r\n    Result:=IntTostr(L)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n\r\nprocedure TIntegerField.GetText(var AText: string; ADisplayText: Boolean);\r\n\r\nvar l : longint;\r\n    fmt : string;\r\n\r\nbegin\r\n  Atext:='';\r\n  If Not GetValue(l) then exit;\r\n  If ADisplayText or (FEditFormat='') then\r\n    fmt:=FDisplayFormat\r\n  else\r\n    fmt:=FEditFormat;\r\n  If length(fmt)<>0 then\r\n    AText:=FormatFloat(fmt,L)\r\n  else\r\n    Str(L,AText);\r\nend;\r\n\r\nfunction TIntegerField.GetValue(var AValue: Longint): Boolean;\r\n\r\nvar\r\n  V : JSValue;\r\n\r\nbegin\r\n  V:=GetData;\r\n  Result:=isInteger(V);\r\n  if Result then\r\n    AValue:=Longint(V);\r\nend;\r\n\r\nprocedure TIntegerField.SetAsLargeInt(AValue: NativeInt);\r\nbegin\r\n  if (AValue>=FMinRange) and (AValue<=FMaxRange) then\r\n    SetAsInteger(AValue)\r\n  else\r\n    RangeError(AValue,FMinRange,FMaxRange);\r\nend;\r\n\r\nprocedure TIntegerField.SetAsFloat(AValue: Double);\r\n\r\nbegin\r\n  SetAsInteger(Round(AValue));\r\nend;\r\n\r\nprocedure TIntegerField.SetAsInteger(AValue: Longint);\r\nbegin\r\n  If CheckRange(AValue) then\r\n    SetData(AValue)\r\n  else\r\n    if (FMinValue<>0) or (FMaxValue<>0) then\r\n      RangeError(AValue,FMinValue,FMaxValue)\r\n    else\r\n      RangeError(AValue,FMinRange,FMaxRange);\r\nend;\r\n\r\nprocedure TIntegerField.SetVarValue(const AValue: JSValue);\r\nbegin\r\n  if IsInteger(aValue) then\r\n    SetAsInteger(Integer(AValue))\r\n  else\r\n    RaiseAccessError(SInteger);\r\nend;\r\n\r\nprocedure TIntegerField.SetAsString(const AValue: string);\r\n\r\nvar L,Code : longint;\r\n\r\nbegin\r\n  If length(AValue)=0 then\r\n    Clear\r\n  else\r\n    begin\r\n    Val(AValue,L,Code);\r\n    If Code=0 then\r\n      SetAsInteger(L)\r\n    else\r\n      DatabaseErrorFmt(SNotAnInteger,[AValue]);\r\n    end;\r\nend;\r\n\r\nFunction TIntegerField.CheckRange(AValue : longint) : Boolean;\r\n\r\nbegin\r\n  if (FMinValue<>0) or (FMaxValue<>0) then\r\n    Result := (AValue>=FMinValue) and (AValue<=FMaxValue)\r\n  else\r\n    Result := (AValue>=FMinRange) and (AValue<=FMaxRange);\r\nend;\r\n\r\nProcedure TIntegerField.SetMaxValue (AValue : longint);\r\n\r\nbegin\r\n  If (AValue>=FMinRange) and (AValue<=FMaxRange) then\r\n    FMaxValue:=AValue\r\n  else\r\n    RangeError(AValue,FMinRange,FMaxRange);\r\nend;\r\n\r\nProcedure TIntegerField.SetMinValue (AValue : longint);\r\n\r\nbegin\r\n  If (AValue>=FMinRange) and (AValue<=FMaxRange) then\r\n    FMinValue:=AValue\r\n  else\r\n    RangeError(AValue,FMinRange,FMaxRange);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    TLargeintField\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nconstructor TLargeintField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  SetDataType(ftLargeint);\r\n  FMinRange:=Low(NativeInt);\r\n  FMaxRange:=High(NativeInt);\r\n// MVC : Todo\r\n//  FValidchars:=['+','-','0'..'9'];\r\nend;\r\n\r\nfunction TLargeintField.GetAsFloat: Double;\r\n\r\nbegin\r\n  Result:=GetAsLargeInt;\r\nend;\r\n\r\nfunction TLargeintField.GetAsLargeInt: NativeInt;\r\n\r\nbegin\r\n  If Not GetValue(Result) then\r\n    Result:=0;\r\nend;\r\n\r\nfunction TLargeIntField.GetAsJSValue: JSValue;\r\n\r\nvar L : NativeInt;\r\n\r\nbegin\r\n  If GetValue(L) then\r\n    Result:=L\r\n  else\r\n    Result:=Null;\r\nend;\r\n\r\nfunction TLargeintField.GetAsInteger: Longint;\r\n\r\nbegin\r\n  Result:=GetAsLargeInt;\r\nend;\r\n\r\nfunction TLargeintField.GetAsString: string;\r\n\r\nvar L : NativeInt;\r\n\r\nbegin\r\n  If GetValue(L) then\r\n    Result:=IntTostr(L)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nprocedure TLargeintField.GetText(var AText: string; ADisplayText: Boolean);\r\n\r\nvar l : NativeInt;\r\n    fmt : string;\r\n\r\nbegin\r\n  Atext:='';\r\n  If Not GetValue(l) then exit;\r\n  If ADisplayText or (FEditFormat='') then\r\n    fmt:=FDisplayFormat\r\n  else\r\n    fmt:=FEditFormat;\r\n  If length(fmt)<>0 then\r\n    AText:=FormatFloat(fmt,L)\r\n  else\r\n    Str(L,AText);\r\nend;\r\n\r\nfunction TLargeintField.GetValue(var AValue: NativeInt): Boolean;\r\n\r\nvar\r\n  P : JSValue;\r\n\r\nbegin\r\n  P:=GetData;\r\n  Result:=isInteger(P);\r\n  if Result then\r\n    AValue:=NativeInt(P);\r\nend;\r\n\r\nprocedure TLargeintField.SetAsFloat(AValue: Double);\r\n\r\nbegin\r\n  SetAsLargeInt(Round(AValue));\r\nend;\r\n\r\nprocedure TLargeintField.SetAsLargeInt(AValue: NativeInt);\r\n\r\nbegin\r\n  If CheckRange(AValue) then\r\n    SetData(AValue)\r\n  else\r\n    RangeError(AValue,FMinValue,FMaxValue);\r\nend;\r\n\r\nprocedure TLargeintField.SetAsInteger(AValue: Longint);\r\n\r\nbegin\r\n  SetAsLargeInt(AValue);\r\nend;\r\n\r\nprocedure TLargeintField.SetAsString(const AValue: string);\r\n\r\nvar L     : NativeInt;\r\n    code  : Longint;\r\n\r\nbegin\r\n  If length(AValue)=0 then\r\n    Clear\r\n  else\r\n    begin\r\n    Val(AValue,L,Code);\r\n    If Code=0 then\r\n      SetAsLargeInt(L)\r\n    else\r\n      DatabaseErrorFmt(SNotAnInteger,[AValue]);\r\n    end;\r\nend;\r\n\r\nprocedure TLargeintField.SetVarValue(const AValue: JSValue);\r\nbegin\r\n  if IsInteger(Avalue) then\r\n    SetAsLargeInt(NativeInt(AValue))\r\n  else\r\n    RaiseAccessError(SLargeInt);\r\nend;\r\n\r\nFunction TLargeintField.CheckRange(AValue : NativeInt) : Boolean;\r\n\r\nbegin\r\n  if (FMinValue<>0) or (FMaxValue<>0) then\r\n    Result := (AValue>=FMinValue) and (AValue<=FMaxValue)\r\n  else\r\n    Result := (AValue>=FMinRange) and (AValue<=FMaxRange);\r\nend;\r\n\r\nProcedure TLargeintField.SetMaxValue (AValue : NativeInt);\r\n\r\nbegin\r\n  If (AValue>=FMinRange) and (AValue<=FMaxRange) then\r\n    FMaxValue:=AValue\r\n  else\r\n    RangeError(AValue,FMinRange,FMaxRange);\r\nend;\r\n\r\nProcedure TLargeintField.SetMinValue (AValue : NativeInt);\r\n\r\nbegin\r\n  If (AValue>=FMinRange) and (AValue<=FMaxRange) then\r\n    FMinValue:=AValue\r\n  else\r\n    RangeError(AValue,FMinRange,FMaxRange);\r\nend;\r\n\r\n\r\n{ TAutoIncField }\r\n\r\nconstructor TAutoIncField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOWner);\r\n  SetDataType(ftAutoInc);\r\nend;\r\n\r\nProcedure TAutoIncField.SetAsInteger(AValue: Longint);\r\n\r\nbegin\r\n  // Some databases allows insertion of explicit values into identity columns\r\n  // (some of them also allows (some not) updating identity columns)\r\n  // So allow it at client side and leave check for server side\r\n  //if not(FDataSet.State in [dsFilter,dsSetKey,dsInsert]) then\r\n  //  DataBaseError(SCantSetAutoIncFields);\r\n  inherited;\r\nend;\r\n\r\n{ TFloatField }\r\n\r\nprocedure TFloatField.SetCurrency(const AValue: Boolean);\r\nbegin\r\n  if FCurrency=AValue then exit;\r\n  FCurrency:=AValue;\r\nend;\r\n\r\nprocedure TFloatField.SetPrecision(const AValue: Longint);\r\nbegin\r\n  if (AValue = -1) or (AValue > 1) then\r\n    FPrecision := AValue\r\n  else\r\n    FPrecision := 2;\r\nend;\r\n\r\nfunction TFloatField.GetAsFloat: Double;\r\n\r\nVar\r\n  P : JSValue;\r\n\r\nbegin\r\n  P:=GetData;\r\n  If IsNumber(P) then\r\n    Result:=Double(P)\r\n  else\r\n    Result:=0.0;\r\nend;\r\n\r\nfunction TFloatField.GetAsJSValue: JSValue;\r\n\r\nvar\r\n  P : JSValue;\r\n\r\nbegin\r\n  P:=GetData;\r\n  if IsNumber(P) then\r\n    Result:=P\r\n  else\r\n    Result:=Null;\r\nend;\r\n\r\nfunction TFloatField.GetAsLargeInt: NativeInt;\r\nbegin\r\n  Result:=Round(GetAsFloat);\r\nend;\r\n\r\nfunction TFloatField.GetAsInteger: Longint;\r\n\r\nbegin\r\n  Result:=Round(GetAsFloat);\r\nend;\r\n\r\nfunction TFloatField.GetAsString: string;\r\n\r\nvar\r\n  P : JSValue;\r\n\r\nbegin\r\n  P:=GetData;\r\n  if IsNumber(P) then\r\n    Result:=FloatToStr(Double(P))\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nprocedure TFloatField.GetText(var AText: string; ADisplayText: Boolean);\r\n\r\nVar\r\n  fmt : string;\r\n  E : Double;\r\n  Digits : integer;\r\n  ff: TFloatFormat;\r\n  P : JSValue;\r\n\r\nbegin\r\n  AText:='';\r\n  P:=GetData;\r\n  if Not IsNumber(P) then\r\n    exit;\r\n  E:=Double(P);\r\n  If ADisplayText or (Length(FEditFormat) = 0) Then\r\n    Fmt:=FDisplayFormat\r\n  else\r\n    Fmt:=FEditFormat;\r\n    \r\n  Digits := 0;\r\n  if not FCurrency then\r\n    ff := ffGeneral\r\n  else\r\n    begin\r\n    Digits := 2;\r\n    ff := ffFixed;\r\n    end;\r\n\r\n\r\n  If fmt<>'' then\r\n    AText:=FormatFloat(fmt,E)\r\n  else\r\n    AText:=FloatToStrF(E,ff,FPrecision,Digits);\r\nend;\r\n\r\nprocedure TFloatField.SetAsFloat(AValue: Double);\r\n\r\nbegin\r\n  If CheckRange(AValue) then\r\n    SetData(AValue)\r\n  else\r\n    RangeError(AValue,FMinValue,FMaxValue);\r\nend;\r\n\r\nprocedure TFloatField.SetAsLargeInt(AValue: NativeInt);\r\nbegin\r\n  SetAsFloat(AValue);\r\nend;\r\n\r\nprocedure TFloatField.SetAsInteger(AValue: Longint);\r\n\r\nbegin\r\n  SetAsFloat(AValue);\r\nend;\r\n\r\nprocedure TFloatField.SetAsString(const AValue: string);\r\n\r\nvar f : Double;\r\n\r\nbegin\r\n  If (AValue='') then\r\n    Clear\r\n  else  \r\n    begin\r\n    If not TryStrToFloat(AValue,F) then\r\n      DatabaseErrorFmt(SNotAFloat, [AValue]);\r\n    SetAsFloat(f);\r\n    end;\r\nend;\r\n\r\nprocedure TFloatField.SetVarValue(const AValue: JSValue);\r\nbegin\r\n  if IsNumber(aValue) then\r\n    SetAsFloat(Double(AValue))\r\n  else\r\n    RaiseAccessError('Float');\r\nend;\r\n\r\nconstructor TFloatField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  SetDataType(ftFloat);\r\n  FPrecision:=15;\r\n// MVC\r\n//  FValidChars := [DecimalSeparator, '+', '-', '0'..'9', 'E', 'e'];\r\nend;\r\n\r\nFunction TFloatField.CheckRange(AValue : Double) : Boolean;\r\n\r\nbegin\r\n  If (FMinValue<>0) or (FMaxValue<>0) then\r\n    Result:=(AValue>=FMinValue) and (AValue<=FMaxValue)\r\n  else\r\n    Result:=True;\r\nend;\r\n\r\n{ TBooleanField }\r\n\r\nfunction TBooleanField.GetAsBoolean: Boolean;\r\n\r\nvar\r\n  P : JSValue;\r\n\r\nbegin\r\n  P:=GetData;\r\n  if isBoolean(P) then\r\n    Result:=Boolean(P)\r\n  else\r\n    Result:=False;\r\nend;\r\n\r\nfunction TBooleanField.GetAsJSValue: JSValue;\r\n\r\nvar\r\n  P : JSValue;\r\n\r\nbegin\r\n  P:=GetData;\r\n  if isBoolean(P) then\r\n    Result:=Boolean(P)\r\n  else\r\n    Result:=Null;\r\nend;\r\n\r\nfunction TBooleanField.GetAsString: string;\r\n\r\nvar\r\n  P : JSValue;\r\n\r\nbegin\r\n  P:=GetData;\r\n  if isBoolean(P) then\r\n    Result:=FDisplays[False,Boolean(P)]\r\n  else\r\n    result:='';\r\nend;\r\n\r\nfunction TBooleanField.GetDefaultWidth: Longint;\r\n\r\nbegin\r\n  Result:=Length(FDisplays[false,false]);\r\n  If Result<Length(FDisplays[false,True]) then\r\n    Result:=Length(FDisplays[false,True]);\r\nend;\r\n\r\nfunction TBooleanField.GetAsInteger: Longint;\r\nbegin\r\n  Result := ord(GetAsBoolean);\r\nend;\r\n\r\nprocedure TBooleanField.SetAsInteger(AValue: Longint);\r\nbegin\r\n  SetAsBoolean(AValue<>0);\r\nend;\r\n\r\nprocedure TBooleanField.SetAsBoolean(AValue: Boolean);\r\n\r\nbegin\r\n  SetData(AValue);\r\nend;\r\n\r\nprocedure TBooleanField.SetAsString(const AValue: string);\r\n\r\nvar Temp : string;\r\n\r\nbegin\r\n  Temp:=UpperCase(AValue);\r\n  if Temp='' then\r\n    Clear\r\n  else if pos(Temp, FDisplays[True,True])=1 then\r\n    SetAsBoolean(True)\r\n  else if pos(Temp, FDisplays[True,False])=1 then\r\n    SetAsBoolean(False)\r\n  else\r\n    DatabaseErrorFmt(SNotABoolean,[AValue]);\r\nend;\r\n\r\nprocedure TBooleanField.SetVarValue(const AValue: JSValue);\r\nbegin\r\n  if isBoolean(aValue) then\r\n    SetAsBoolean(Boolean(AValue))\r\n  else if isNumber(aValue) then\r\n    SetAsBoolean(Double(AValue)<>0)\r\nend;\r\n\r\nconstructor TBooleanField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  SetDataType(ftBoolean);\r\n  DisplayValues:='True;False';\r\nend;\r\n\r\nProcedure TBooleanField.SetDisplayValues(const AValue : String);\r\n\r\nvar I : longint;\r\n\r\nbegin\r\n  If FDisplayValues<>AValue then\r\n    begin\r\n    I:=Pos(';',AValue);\r\n    If (I<2) or (I=Length(AValue)) then\r\n      DatabaseErrorFmt(SInvalidDisplayValues,[AValue]);\r\n    FdisplayValues:=AValue;\r\n    // Store display values and their uppercase equivalents;\r\n    FDisplays[False,True]:=Copy(AValue,1,I-1);\r\n    FDisplays[True,True]:=UpperCase(FDisplays[False,True]);\r\n    FDisplays[False,False]:=Copy(AValue,I+1,Length(AValue)-i);\r\n    FDisplays[True,False]:=UpperCase(FDisplays[False,False]);\r\n    PropertyChanged(True);\r\n    end;\r\nend;\r\n\r\n{ TDateTimeField }\r\n\r\nprocedure TDateTimeField.SetDisplayFormat(const AValue: string);\r\nbegin\r\n  if FDisplayFormat<>AValue then begin\r\n    FDisplayFormat:=AValue;\r\n    PropertyChanged(True);\r\n  end;\r\nend;\r\n\r\nfunction TDateTimeField.ConvertToDateTime(aValue: JSValue; aRaiseError: Boolean): TDateTime;\r\nbegin\r\n  if JS.isNull(aValue) then\r\n    Result:=0\r\n  else if Assigned(Dataset) then\r\n    Result:=Dataset.ConvertToDateTime(Self,aValue,aRaiseError)\r\n  else\r\n    Result:=TDataset.DefaultConvertToDateTime(Self,aValue,aRaiseError);\r\nend;\r\n\r\nfunction TDateTimeField.DateTimeToNativeDateTime(aValue: TDateTime): JSValue;\r\nbegin\r\n  if Assigned(Dataset) then\r\n    Result:=Dataset.ConvertDateTimeToNative(Self,aValue)\r\n  else\r\n    Result:=TDataset.DefaultConvertDateTimeToNative(Self,aValue);\r\nend;\r\n\r\nfunction TDateTimeField.GetAsDateTime: TDateTime;\r\n\r\nbegin\r\n  Result:=ConvertToDateTime(GetData,False);\r\nend;\r\n\r\nprocedure TDateTimeField.SetVarValue(const AValue: JSValue);\r\n\r\nbegin\r\n  SetAsDateTime(ConvertToDateTime(aValue,True));\r\nend;\r\n\r\nfunction TDateTimeField.GetAsJSValue: JSValue;\r\n\r\nbegin\r\n  Result:=GetData;\r\n  if Not isString(Result) then\r\n    Result:=Null;\r\nend;\r\n\r\nfunction TDateTimeField.GetDataSize: Integer;\r\nbegin\r\n  Result:=inherited GetDataSize;\r\nend;\r\n\r\nfunction TDateTimeField.GetAsFloat: Double;\r\n\r\nbegin\r\n  Result:=GetAsdateTime;\r\nend;\r\n\r\n\r\nfunction TDateTimeField.GetAsString: string;\r\n\r\nbegin\r\n  GetText(Result,False);\r\nend;\r\n\r\n\r\nProcedure TDateTimeField.GetText(var AText: string; ADisplayText: Boolean);\r\n\r\nvar\r\n  R : TDateTime;\r\n  F : String;\r\n\r\nbegin\r\n  R:=ConvertToDateTime(GetData,false);\r\n  If (R=0) then\r\n    AText:=''\r\n  else\r\n    begin\r\n    If (ADisplayText) and (Length(FDisplayFormat)<>0) then\r\n      F:=FDisplayFormat\r\n    else\r\n      Case DataType of\r\n       ftTime : F:=LongTimeFormat;\r\n       ftDate : F:=ShortDateFormat;\r\n      else\r\n       F:='c'\r\n      end;\r\n    AText:=FormatDateTime(F,R);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TDateTimeField.SetAsDateTime(AValue: TDateTime);\r\n\r\nbegin\r\n  SetData(DateTimeToNativeDateTime(aValue));\r\nend;\r\n\r\n\r\nprocedure TDateTimeField.SetAsFloat(AValue: Double);\r\n\r\nbegin\r\n  SetAsDateTime(AValue);\r\nend;\r\n\r\n\r\nprocedure TDateTimeField.SetAsString(const AValue: string);\r\n\r\nvar R : TDateTime;\r\n\r\nbegin\r\n  if AValue<>'' then\r\n    begin\r\n    R:=StrToDateTime(AValue);\r\n    SetData(DateTimeToNativeDateTime(R));\r\n    end\r\n  else\r\n    SetData(Null);\r\nend;\r\n\r\n\r\nconstructor TDateTimeField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  SetDataType(ftDateTime);\r\nend;\r\n\r\n\r\n{ TDateField }\r\n\r\nconstructor TDateField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  SetDataType(ftDate);\r\nend;\r\n\r\n\r\n{ TTimeField }\r\n\r\nconstructor TTimeField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  SetDataType(ftTime);\r\nend;\r\n\r\nprocedure TTimeField.SetAsString(const AValue: string);\r\n\r\nvar\r\n  R : TDateTime;\r\n\r\nbegin\r\n  if AValue<>'' then\r\n    begin\r\n    R:=StrToTime(AValue);\r\n    SetData(DateTimeToNativeDateTime(R));\r\n    end\r\n  else\r\n    SetData(Null);\r\nend;\r\n\r\n\r\n\r\n{ TBinaryField }\r\n\r\nclass procedure TBinaryField.CheckTypeSize(AValue: Longint);\r\n\r\nbegin\r\n  // Just check for really invalid stuff; actual size is\r\n  // dependent on the record...\r\n  If AValue<1 then\r\n    DatabaseErrorFmt(SInvalidFieldSize,[AValue]);\r\nend;\r\n\r\nfunction TBinaryField.BlobToBytes(aValue: JSValue): TBytes;\r\n\r\nbegin\r\n  if Assigned(Dataset) then\r\n    Result:=DataSet.BlobDataToBytes(aValue)\r\n  else\r\n    Result:=TDataSet.DefaultBlobDataToBytes(aValue)\r\nend;\r\n\r\nfunction TBinaryField.BytesToBlob(aValue: TBytes): JSValue;\r\n\r\nbegin\r\n  if Assigned(Dataset) then\r\n    Result:=DataSet.BytesToBlobData(aValue)\r\n  else\r\n    Result:=TDataSet.DefaultBytesToBlobData(aValue)\r\nend;\r\n\r\nfunction TBinaryField.GetAsString: string;\r\n\r\nvar\r\n  V : JSValue;\r\n  S : TBytes;\r\n  I : Integer;\r\n\r\nbegin\r\n  Result := '';\r\n  V:=GetData;\r\n  if V<>Null then\r\n    if (DataType=ftMemo) then\r\n      Result:=String(V)\r\n    else\r\n      begin\r\n      S:=BlobToBytes(V);\r\n      For I:=0 to Length(S)-1 do\r\n         Result:=TJSString(Result).Concat(TJSString.fromCharCode(S[I]));\r\n      end;\r\nend;\r\n\r\n\r\nfunction TBinaryField.GetAsJSValue: JSValue;\r\n\r\nbegin\r\n  Result:=GetData;\r\nend;\r\n\r\n\r\nfunction TBinaryField.GetValue(var AValue: TBytes): Boolean;\r\nvar\r\n  V : JSValue;\r\nbegin\r\n  V:=GetData;\r\n  Result:=(V<>Null);\r\n  if Result then\r\n    AValue:=BlobToBytes(V)\r\n  else\r\n    SetLength(AValue,0);\r\nend;\r\n\r\n\r\n\r\nprocedure TBinaryField.SetAsString(const AValue: string);\r\n\r\nvar\r\n  B : TBytes;\r\n  i : Integer;\r\n\r\nbegin\r\n  if DataType=ftMemo then\r\n    SetData(aValue)\r\n  else\r\n    begin\r\n    SetLength(B, Length(aValue));\r\n    For I:=1 to Length(aValue) do\r\n      B[i-1]:=Ord(aValue[i]);\r\n    SetAsBytes(B);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TBinaryField.SetVarValue(const AValue: JSValue);\r\n\r\nvar\r\n  B: TBytes;\r\n  I,Len: integer;\r\n\r\nbegin\r\n  if IsArray(AValue) then\r\n    begin\r\n    Len:=Length(TJSValueDynArray(AValue));\r\n    SetLength(B, Len);\r\n    For I:=1 to Len-1 do\r\n      B[i]:=TBytes(AValue)[i];\r\n    SetAsBytes(B);\r\n    end\r\n  else if IsString(AValue) then\r\n    SetAsString(String(AValue))\r\n  else\r\n    RaiseAccessError('Blob');\r\nend;\r\n\r\nfunction TBinaryField.GetAsBytes: TBytes;\r\n\r\nVar\r\n  V : JSValue;\r\n\r\nbegin\r\n  V:=GetData;\r\n  if Assigned(V) then\r\n    Result:=BlobToBytes(V)\r\n  else\r\n    SetLength(Result,0);\r\nend;\r\n\r\nprocedure TBinaryField.SetAsBytes(const aValue: TBytes);\r\nbegin\r\n  SetData(BytesToBlob(aValue))\r\nend;\r\n\r\n\r\nconstructor TBinaryField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\nend;\r\n\r\n\r\n\r\n{ TBlobField }\r\n\r\nconstructor TBlobField.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  SetDataType(ftBlob);\r\nend;\r\n\r\nprocedure TBlobField.Clear;\r\nbegin\r\n  SetData(Null);\r\nend;\r\n\r\n(*\r\nfunction TBlobField.GetBlobType: TBlobType;\r\nbegin\r\n  Result:=ftBlob;\r\nend;\r\n\r\nprocedure TBlobField.SetBlobType(AValue: TBlobType);\r\nbegin\r\n  SetFieldType(TFieldType(AValue));\r\nend;\r\n*)\r\n\r\n\r\n\r\nclass procedure TBlobField.CheckTypeSize(AValue: Longint);\r\nbegin\r\n  If AValue<0 then\r\n    DatabaseErrorFmt(SInvalidFieldSize,[AValue]);\r\nend;\r\n\r\nfunction TBlobField.GetBlobSize: Longint;\r\n\r\nvar\r\n  B : TBytes;\r\n\r\nbegin\r\n  B:=GetAsBytes;\r\n  Result:=Length(B);\r\nend;\r\n\r\n\r\nfunction TBlobField.GetIsNull: Boolean;\r\n\r\nbegin\r\n  if Not Modified then\r\n    Result:= inherited GetIsNull\r\n  else\r\n    Result:=GetBlobSize=0;\r\nend;\r\n\r\nprocedure TBlobField.GetText(var AText: string; ADisplayText: Boolean);\r\nbegin\r\n  AText := inherited GetAsString;\r\nend;\r\n\r\nclass function TBlobField.IsBlob: Boolean;\r\n\r\nbegin\r\n  Result:=True;\r\nend;\r\n\r\nprocedure TBlobField.SetFieldType(AValue: TFieldType);\r\nbegin\r\n  if AValue in ftBlobTypes then\r\n    SetDataType(AValue);\r\nend;\r\n\r\n{ TMemoField }\r\n\r\nconstructor TMemoField.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  SetDataType(ftMemo);\r\nend;\r\n\r\n\r\n\r\n{ TVariantField }\r\n\r\nconstructor TVariantField.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  SetDataType(ftVariant);\r\nend;\r\n\r\nclass procedure TVariantField.CheckTypeSize(aValue: Integer);\r\nbegin\r\n  { empty }\r\nend;\r\n\r\nfunction TVariantField.GetAsBoolean: Boolean;\r\nbegin\r\n  Result :=GetAsJSValue=True;\r\nend;\r\n\r\nfunction TVariantField.GetAsDateTime: TDateTime;\r\n\r\nVar\r\n  V : JSValue;\r\n\r\nbegin\r\n  V:=GetData;\r\n  if Assigned(Dataset) then\r\n    Result:=Dataset.ConvertToDateTime(Self,V,True)\r\n  else\r\n    Result:=TDataset.DefaultConvertToDateTime(Self,V,True)\r\nend;\r\n\r\nfunction TVariantField.GetAsFloat: Double;\r\n\r\nVar\r\n  V : JSValue;\r\n\r\nbegin\r\n  V:=GetData;\r\n  if isNumber(V) then\r\n    Result:=Double(V)\r\n  else if isString(V) then\r\n    Result:=parsefloat(String(V))\r\n  else\r\n    RaiseAccessError('Variant');\r\nend;\r\n\r\nfunction TVariantField.GetAsInteger: Longint;\r\nVar\r\n  V : JSValue;\r\n\r\nbegin\r\n  V:=GetData;\r\n  if isInteger(V) then\r\n    Result:=Integer(V)\r\n  else if isString(V) then\r\n    Result:=parseInt(String(V))\r\n  else\r\n    RaiseAccessError('Variant');\r\nend;\r\n\r\nfunction TVariantField.GetAsString: string;\r\nVar\r\n  V : JSValue;\r\n\r\nbegin\r\n  V:=GetData;\r\n  if isInteger(V) then\r\n    Result:=IntToStr(Integer(V))\r\n  else if isNumber(V) then\r\n      Result:=FloatToStr(Double(V))\r\n  else if isString(V) then\r\n    Result:=String(V)\r\n  else\r\n    RaiseAccessError('Variant');\r\nend;\r\n\r\n\r\nfunction TVariantField.GetAsJSValue: JSValue;\r\nbegin\r\n  Result:=GetData;\r\nend;\r\n\r\nprocedure TVariantField.SetAsBoolean(aValue: Boolean);\r\nbegin\r\n  SetVarValue(aValue);\r\nend;\r\n\r\nprocedure TVariantField.SetAsDateTime(aValue: TDateTime);\r\nbegin\r\n  SetVarValue(aValue);\r\nend;\r\n\r\nprocedure TVariantField.SetAsFloat(aValue: Double);\r\nbegin\r\n  SetVarValue(aValue);\r\nend;\r\n\r\nprocedure TVariantField.SetAsInteger(AValue: Longint);\r\nbegin\r\n  SetVarValue(aValue);\r\nend;\r\n\r\nprocedure TVariantField.SetAsString(const aValue: string);\r\nbegin\r\n  SetVarValue(aValue);\r\nend;\r\n\r\nprocedure TVariantField.SetVarValue(const aValue: JSValue);\r\nbegin\r\n  SetData(aValue);\r\nend;\r\n\r\n{ TFieldsEnumerator }\r\n\r\nfunction TFieldsEnumerator.GetCurrent: TField;\r\nbegin\r\n  Result := FFields[FPosition];\r\nend;\r\n\r\nconstructor TFieldsEnumerator.Create(AFields: TFields);\r\nbegin\r\n  inherited Create;\r\n  FFields := AFields;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TFieldsEnumerator.MoveNext: Boolean;\r\nbegin\r\n  inc(FPosition);\r\n  Result := FPosition < FFields.Count;\r\nend;\r\n\r\n{ TFields }\r\n\r\nconstructor TFields.Create(ADataset: TDataset);\r\n\r\nbegin\r\n  FDataSet:=ADataset;\r\n  FFieldList:=TFpList.Create;\r\n  FValidFieldKinds:=[fkData..fkInternalcalc];\r\nend;\r\n\r\ndestructor TFields.Destroy;\r\n\r\nbegin\r\n  if Assigned(FFieldList) then\r\n    Clear;\r\n  FreeAndNil(FFieldList);\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TFields.ClearFieldDefs;\r\n\r\nVar\r\n  i : Integer;\r\n\r\nbegin\r\n  For I:=0 to Count-1 do\r\n    Fields[i].FFieldDef:=Nil;\r\nend;\r\n\r\nprocedure TFields.Changed;\r\n\r\nbegin\r\n  // Removed FDataSet.Active check, needed for Persistent fields (see bug ID 30954)\r\n  if (FDataSet <> nil) and not (csDestroying in FDataSet.ComponentState) then\r\n    FDataSet.DataEvent(deFieldListChange, 0);\r\n  If Assigned(FOnChange) then\r\n    FOnChange(Self);\r\nend;\r\n\r\nprocedure TFields.CheckfieldKind(Fieldkind: TFieldKind; Field: TField);\r\n\r\nbegin\r\n  If Not (FieldKind in ValidFieldKinds) Then\r\n    DatabaseErrorFmt(SInvalidFieldKind,[Field.FieldName]);\r\nend;\r\n\r\nfunction TFields.GetCount: Longint;\r\n\r\nbegin\r\n  Result:=FFieldList.Count;\r\nend;\r\n\r\n\r\nfunction TFields.GetField(Index: Integer): TField;\r\n\r\nbegin\r\n  Result:=Tfield(FFieldList[Index]);\r\nend;\r\n\r\nprocedure TFields.SetField(Index: Integer; Value: TField);\r\nbegin\r\n  Fields[Index].Assign(Value);\r\nend;\r\n\r\nprocedure TFields.SetFieldIndex(Field: TField; Value: Integer);\r\nvar Old : Longint;\r\nbegin\r\n  Old := FFieldList.indexOf(Field);\r\n  If Old=-1 then\r\n    Exit;\r\n  // Check value\r\n  If Value<0 Then Value:=0;\r\n  If Value>=Count then Value:=Count-1;\r\n  If Value<>Old then\r\n    begin\r\n    FFieldList.Delete(Old);\r\n    FFieldList.Insert(Value,Field);\r\n    Field.PropertyChanged(True);\r\n    Changed;\r\n    end;\r\nend;\r\n\r\nprocedure TFields.Add(Field: TField);\r\n\r\nbegin\r\n  CheckFieldName(Field.FieldName);\r\n  FFieldList.Add(Field);\r\n  Field.FFields:=Self;\r\n  Changed;\r\nend;\r\n\r\nprocedure TFields.CheckFieldName(const Value: String);\r\n\r\nbegin\r\n  If FindField(Value)<>Nil then\r\n    DataBaseErrorFmt(SDuplicateFieldName,[Value],FDataset);\r\nend;\r\n\r\nprocedure TFields.CheckFieldNames(const Value: String);\r\n\r\nvar\r\n  N: String;\r\n  StrPos: Integer;\r\n\r\nbegin\r\n  if Value = '' then\r\n    Exit;\r\n  StrPos := 1;\r\n  repeat\r\n    N := ExtractFieldName(Value, StrPos);\r\n    // Will raise an error if no such field...\r\n    FieldByName(N);\r\n  until StrPos > Length(Value);\r\nend;\r\n\r\nprocedure TFields.Clear;\r\nvar\r\n  AField: TField;\r\nbegin\r\n  while FFieldList.Count > 0 do \r\n    begin\r\n    AField := TField(FFieldList.Last);\r\n    AField.FDataSet := Nil;\r\n    AField.Free;\r\n    FFieldList.Delete(FFieldList.Count - 1);\r\n    end;\r\n  Changed;\r\nend;\r\n\r\nfunction TFields.FindField(const Value: String): TField;\r\nvar S : String;\r\n    I : longint;\r\nbegin\r\n  S:=UpperCase(Value);\r\n  For I:=0 To FFieldList.Count-1 do\r\n  begin\r\n    Result:=TField(FFieldList[I]);\r\n    if S=UpperCase(Result.FieldName) then\r\n    begin\r\n      {$ifdef dsdebug}\r\n      Writeln ('Found field ',Value);\r\n      {$endif}\r\n      Exit;\r\n    end;\r\n  end;\r\n  Result:=Nil;\r\nend;\r\n\r\nfunction TFields.FieldByName(const Value: String): TField;\r\n\r\nbegin\r\n  Result:=FindField(Value);\r\n  If result=Nil then\r\n    DatabaseErrorFmt(SFieldNotFound,[Value],FDataset);\r\nend;\r\n\r\nfunction TFields.FieldByNumber(FieldNo: Integer): TField;\r\nvar i : Longint;\r\nbegin\r\n  For I:=0 to FFieldList.Count-1 do\r\n  begin\r\n    Result:=TField(FFieldList[I]);\r\n    if FieldNo=Result.FieldNo then\r\n      Exit;\r\n  end;\r\n  Result:=Nil;\r\nend;\r\n\r\nfunction TFields.GetEnumerator: TFieldsEnumerator;\r\n\r\nbegin\r\n  Result:=TFieldsEnumerator.Create(Self);\r\nend;\r\n\r\nprocedure TFields.GetFieldNames(Values: TStrings);\r\nvar i : longint;\r\nbegin\r\n  Values.Clear;\r\n  For I:=0 to FFieldList.Count-1 do\r\n    Values.Add(Tfield(FFieldList[I]).FieldName);\r\nend;\r\n\r\nfunction TFields.IndexOf(Field: TField): Longint;\r\n\r\nbegin\r\n  Result:=FFieldList.IndexOf(Field);\r\nend;\r\n\r\nprocedure TFields.Remove(Value : TField);\r\n\r\nbegin\r\n  FFieldList.Remove(Value);\r\n  Value.FFields := nil;\r\n  Changed;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    TDatalink\r\n  ---------------------------------------------------------------------}\r\n\r\nConstructor TDataLink.Create;\r\n\r\nbegin\r\n  Inherited Create;\r\n  FBufferCount:=1;\r\n  FFirstRecord := 0;\r\n  FDataSource := nil;\r\n  FDatasourceFixed:=False;\r\nend;\r\n\r\n\r\nDestructor TDataLink.Destroy;\r\n\r\nbegin\r\n  Factive:=False;\r\n  FEditing:=False;\r\n  FDataSourceFixed:=False;\r\n  DataSource:=Nil;\r\n  Inherited Destroy;\r\nend;\r\n\r\n\r\nProcedure TDataLink.ActiveChanged;\r\n\r\nbegin\r\n  FFirstRecord := 0;\r\nend;\r\n\r\nProcedure TDataLink.CheckActiveAndEditing;\r\n\r\nVar\r\n  B : Boolean;\r\n\r\nbegin\r\n  B:=Assigned(DataSource) and Not (DataSource.State in [dsInactive,dsOpening]);\r\n  If B<>FActive then\r\n    begin\r\n    FActive:=B;\r\n    ActiveChanged;\r\n    end;\r\n  B:=Assigned(DataSource) and (DataSource.State in dsEditModes) and Not FReadOnly;\r\n  If B<>FEditing Then\r\n    begin\r\n    FEditing:=B;\r\n    EditingChanged;\r\n    end;\r\nend;\r\n\r\n\r\nProcedure TDataLink.CheckBrowseMode;\r\n\r\nbegin\r\nend;\r\n\r\n\r\nFunction TDataLink.CalcFirstRecord(Index : Integer) : Integer;\r\nbegin\r\n  if DataSource.DataSet.FActiveRecord > FFirstRecord + Index + FBufferCount - 1 then\r\n    Result := DataSource.DataSet.FActiveRecord - (FFirstRecord + Index + FBufferCount - 1)\r\n  else if DataSource.DataSet.FActiveRecord < FFirstRecord + Index then\r\n    Result := DataSource.DataSet.FActiveRecord - (FFirstRecord + Index)\r\n  else Result := 0;\r\n  \r\n  Inc(FFirstRecord, Index + Result);\r\nend;\r\n\r\n\r\nProcedure TDataLink.CalcRange;\r\nvar\r\n    aMax, aMin: integer;\r\nbegin\r\n  aMin:= DataSet.FActiveRecord - FBufferCount + 1;\r\n  If aMin < 0 Then aMin:= 0;\r\n  aMax:= Dataset.FBufferCount - FBufferCount;\r\n  If aMax < 0 then aMax:= 0;\r\n\r\n  If aMax>DataSet.FActiveRecord Then aMax:=DataSet.FActiveRecord;\r\n  If FFirstRecord < aMin Then FFirstRecord:= aMin;\r\n  If FFirstrecord > aMax Then FFirstRecord:= aMax;\r\n\r\n  If (FfirstRecord<>0) And\r\n     (DataSet.FActiveRecord - FFirstRecord < FBufferCount -1) Then\r\n    Dec(FFirstRecord, 1);\r\n\r\nend;\r\n\r\n\r\nProcedure TDataLink.DataEvent(Event: TDataEvent; Info: JSValue);\r\n\r\n\r\nbegin\r\n  Case Event of\r\n    deFieldChange, deRecordChange:\r\n      If Not FUpdatingRecord then\r\n        RecordChanged(TField(Info));\r\n    deDataSetChange: begin\r\n      SetActive(DataSource.DataSet.Active);\r\n      CalcRange;\r\n      CalcFirstRecord(Integer(Info));\r\n      DatasetChanged;\r\n    end;\r\n    deDataSetScroll: DatasetScrolled(CalcFirstRecord(Integer(Info)));\r\n    deLayoutChange: begin\r\n      CalcFirstRecord(Integer(Info));\r\n      LayoutChanged;\r\n    end;\r\n    deUpdateRecord: UpdateRecord;\r\n    deUpdateState: CheckActiveAndEditing;\r\n    deCheckBrowseMode: CheckBrowseMode;\r\n    deFocusControl:\r\n      FocusControl(Info);\r\n  end;\r\nend;\r\n\r\n\r\nProcedure TDataLink.DataSetChanged;\r\n\r\nbegin\r\n  RecordChanged(Nil);\r\nend;\r\n\r\n\r\nProcedure TDataLink.DataSetScrolled(Distance: Integer);\r\n\r\nbegin\r\n  DataSetChanged;\r\nend;\r\n\r\n\r\nProcedure TDataLink.EditingChanged;\r\n\r\nbegin\r\nend;\r\n\r\n\r\nProcedure TDataLink.FocusControl(Field: JSValue);\r\n\r\nbegin\r\nend;\r\n\r\n\r\nFunction TDataLink.GetActiveRecord: Integer;\r\n\r\nbegin\r\n  Result:=Dataset.FActiveRecord - FFirstRecord;\r\nend;\r\n\r\nFunction TDatalink.GetDataSet : TDataset;\r\n\r\nbegin\r\n  If Assigned(Datasource) then\r\n    Result:=DataSource.DataSet\r\n  else\r\n    Result:=Nil;  \r\nend;\r\n\r\n\r\nFunction TDataLink.GetBOF: Boolean;\r\n\r\nbegin\r\n  Result:=DataSet.BOF\r\nend;\r\n\r\n\r\nFunction TDataLink.GetBufferCount: Integer;\r\n\r\nbegin\r\n  Result:=FBufferCount;\r\nend;\r\n\r\n\r\nFunction TDataLink.GetEOF: Boolean;\r\n\r\nbegin\r\n  Result:=DataSet.EOF\r\nend;\r\n\r\n\r\nFunction TDataLink.GetRecordCount: Integer;\r\n\r\nbegin\r\n  Result:=Dataset.FRecordCount;\r\n  If Result>BufferCount then\r\n    Result:=BufferCount;\r\nend;\r\n\r\n\r\nProcedure TDataLink.LayoutChanged;\r\n\r\nbegin\r\n  DataSetChanged;\r\nend;\r\n\r\n\r\nFunction TDataLink.MoveBy(Distance: Integer): Integer;\r\n\r\nbegin\r\n  Result:=DataSet.MoveBy(Distance);\r\nend;\r\n\r\n\r\nProcedure TDataLink.RecordChanged(Field: TField);\r\n\r\nbegin\r\nend;\r\n\r\n\r\nProcedure TDataLink.SetActiveRecord(Value: Integer);\r\n\r\nbegin\r\n{$ifdef dsdebug}\r\n  Writeln('Datalink. Setting active record to ',Value,' with firstrecord ',ffirstrecord);\r\n{$endif}\r\n  Dataset.FActiveRecord:=Value + FFirstRecord;\r\nend;\r\n\r\n\r\nProcedure TDataLink.SetBufferCount(Value: Integer);\r\n\r\nbegin\r\n  If FBufferCount<>Value then\r\n    begin\r\n      FBufferCount:=Value;\r\n      if Active then begin\r\n        DataSet.RecalcBufListSize;\r\n        CalcRange;\r\n      end;\r\n    end;\r\nend;\r\n\r\nprocedure TDataLink.SetActive(AActive: Boolean);\r\nbegin\r\n  if Active <> AActive then\r\n  begin\r\n    FActive := AActive;\r\n    // !!!: Set internal state\r\n    ActiveChanged;\r\n  end;\r\nend;\r\n\r\nProcedure TDataLink.SetDataSource(Value : TDatasource);\r\n\r\nbegin\r\n  if FDataSource = Value then\r\n    Exit;\r\n  if not FDataSourceFixed then\r\n    begin\r\n    if Assigned(DataSource) then\r\n      Begin\r\n      DataSource.UnregisterDatalink(Self);\r\n      FDataSource := nil;\r\n      CheckActiveAndEditing;\r\n      End;\r\n    FDataSource := Value;\r\n    if Assigned(DataSource) then\r\n      begin\r\n      DataSource.RegisterDatalink(Self);\r\n      CheckActiveAndEditing;\r\n      End;\r\n    end;\r\nend;\r\n\r\nProcedure TDatalink.SetReadOnly(Value : Boolean);\r\n\r\nbegin\r\n  If FReadOnly<>Value then\r\n    begin\r\n    FReadOnly:=Value;\r\n    CheckActiveAndEditing;\r\n    end;\r\nend;\r\n\r\nProcedure TDataLink.UpdateData;\r\n\r\nbegin\r\nend;\r\n\r\n\r\n\r\nFunction TDataLink.Edit: Boolean;\r\n\r\nbegin\r\n  If Not FReadOnly then\r\n    DataSource.Edit;\r\n  // Triggered event will set FEditing\r\n  Result:=FEditing;\r\nend;\r\n\r\n\r\nProcedure TDataLink.UpdateRecord;\r\n\r\nbegin\r\n  FUpdatingRecord:=True;\r\n  Try\r\n    UpdateData;\r\n  finally\r\n    FUpdatingRecord:=False;\r\n  end;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    TDetailDataLink\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction TDetailDataLink.GetDetailDataSet: TDataSet;\r\n\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    TMasterDataLink\r\n  ---------------------------------------------------------------------}\r\n\r\nconstructor TMasterDataLink.Create(ADataSet: TDataSet);\r\n\r\nbegin\r\n  inherited Create;\r\n  FDetailDataSet:=ADataSet;\r\n  FFields:=TList.Create;\r\nend;\r\n\r\n\r\ndestructor TMasterDataLink.Destroy;\r\n\r\nbegin\r\n  FFields.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n\r\nProcedure TMasterDataLink.ActiveChanged;\r\n\r\nbegin\r\n  FFields.Clear;\r\n  if Active then\r\n    try\r\n      DataSet.GetFieldList(FFields, FFieldNames);\r\n    except\r\n      FFields.Clear;\r\n      raise;\r\n    end;\r\n  if FDetailDataSet.Active and not (csDestroying in FDetailDataSet.ComponentState) then\r\n    if Active and (FFields.Count > 0) then\r\n      DoMasterChange\r\n    else\r\n      DoMasterDisable;  \r\nend;\r\n\r\n\r\nProcedure TMasterDataLink.CheckBrowseMode;\r\n\r\nbegin\r\n  if FDetailDataSet.Active then FDetailDataSet.CheckBrowseMode;\r\nend;\r\n\r\n\r\nFunction TMasterDataLink.GetDetailDataSet: TDataSet;\r\n\r\nbegin\r\n  Result := FDetailDataSet;\r\nend;\r\n\r\n\r\nProcedure TMasterDataLink.LayoutChanged;\r\n\r\nbegin\r\n  ActiveChanged;\r\nend;\r\n\r\n\r\nProcedure TMasterDataLink.RecordChanged(Field: TField);\r\n\r\nbegin\r\n  if (DataSource.State <> dsSetKey) and FDetailDataSet.Active and\r\n     (FFields.Count > 0) and ((Field = nil) or\r\n     (FFields.IndexOf(Field) >= 0)) then\r\n    DoMasterChange;  \r\nend;\r\n\r\nprocedure TMasterDatalink.SetFieldNames(const Value: string);\r\n\r\nbegin\r\n  if FFieldNames <> Value then\r\n    begin\r\n    FFieldNames := Value;\r\n    ActiveChanged;\r\n    end;\r\nend;\r\n\r\nProcedure TMasterDataLink.DoMasterDisable; \r\n\r\nbegin\r\n  if Assigned(FOnMasterDisable) then \r\n    FOnMasterDisable(Self);\r\nend;\r\n\r\nProcedure TMasterDataLink.DoMasterChange; \r\n\r\nbegin\r\n  If Assigned(FOnMasterChange) then\r\n    FOnMasterChange(Self);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    TMasterParamsDataLink\r\n  ---------------------------------------------------------------------}\r\n\r\nconstructor TMasterParamsDataLink.Create(ADataSet: TDataSet);\r\n\r\nVar\r\n  P : TParams;\r\n\r\nbegin\r\n  inherited Create(ADataset);\r\n  If (ADataset<>Nil) then\r\n    begin\r\n    P:=TParams(GetObjectProp(ADataset,'Params',TParams));\r\n    if (P<>Nil) then\r\n      Params:=P;\r\n    end;  \r\nend;\r\n\r\n\r\nProcedure TMasterParamsDataLink.SetParams(AValue : TParams);\r\n\r\nbegin\r\n  FParams:=AValue;\r\n  If (AValue<>Nil) then\r\n    RefreshParamNames;\r\nend;\r\n\r\nProcedure TMasterParamsDataLink.RefreshParamNames; \r\n\r\nVar\r\n  FN : String;\r\n  DS : TDataset;\r\n  F  : TField;\r\n  I : Integer;\r\n  P : TParam;\r\n\r\n\r\nbegin\r\n  FN:='';\r\n  DS:=Dataset;\r\n  If Assigned(FParams) then\r\n    begin\r\n    F:=Nil;\r\n    For I:=0 to FParams.Count-1 do\r\n      begin\r\n      P:=FParams[i];\r\n      if not P.Bound then\r\n        begin\r\n        If Assigned(DS) then\r\n          F:=DS.FindField(P.Name);\r\n        If (Not Assigned(DS)) or (not DS.Active) or (F<>Nil) then\r\n          begin\r\n          If (FN<>'') then\r\n            FN:=FN+';';\r\n          FN:=FN+P.Name;\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n  FieldNames:=FN;  \r\nend;\r\n\r\nProcedure TMasterParamsDataLink.CopyParamsFromMaster(CopyBound : Boolean);\r\n\r\nbegin\r\n  if Assigned(FParams) then\r\n    FParams.CopyParamValuesFromDataset(Dataset,CopyBound);\r\nend;\r\n\r\nProcedure TMasterParamsDataLink.DoMasterDisable; \r\n\r\nbegin\r\n  Inherited;\r\n  // If master dataset is closing, leave detail dataset intact (Delphi compatible behavior)\r\n  // If master dataset is reopened, relationship will be reestablished\r\nend;\r\n\r\nProcedure TMasterParamsDataLink.DoMasterChange; \r\n\r\nbegin\r\n  Inherited;\r\n  if Assigned(Params) and Assigned(DetailDataset) and DetailDataset.Active then\r\n    begin\r\n    DetailDataSet.CheckBrowseMode;\r\n    DetailDataset.Close;\r\n    DetailDataset.Open;\r\n    end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    TDatasource\r\n  ---------------------------------------------------------------------}\r\n\r\nConstructor TDataSource.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  Inherited Create(AOwner);\r\n  FDatalinks := TList.Create;\r\n  FEnabled := True;\r\n  FAutoEdit := True;\r\nend;\r\n\r\n\r\nDestructor TDataSource.Destroy;\r\n\r\nbegin\r\n  FOnStateCHange:=Nil;\r\n  Dataset:=Nil;\r\n  With FDataLinks do\r\n    While Count>0 do\r\n      TDatalink(Items[Count - 1]).DataSource:=Nil;\r\n  FDatalinks.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n\r\nProcedure TDatasource.Edit;\r\n\r\nbegin\r\n  If (State=dsBrowse) and AutoEdit Then\r\n    Dataset.Edit;\r\nend;\r\n\r\n\r\nFunction TDataSource.IsLinkedTo(ADataSet: TDataSet): Boolean;\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\n\r\nprocedure TDatasource.DistributeEvent(Event: TDataEvent; Info: JSValue);\r\n\r\n\r\nVar\r\n  i : Longint;\r\n\r\nbegin\r\n  With FDatalinks do\r\n    begin\r\n    For I:=0 to Count-1 do\r\n      With TDatalink(Items[i]) do\r\n        If Not VisualControl Then\r\n          DataEvent(Event,Info);\r\n    For I:=0 to Count-1 do\r\n      With TDatalink(Items[i]) do\r\n        If VisualControl Then\r\n          DataEvent(Event,Info);\r\n    end;\r\nend;\r\n\r\nprocedure TDatasource.RegisterDataLink(DataLink: TDataLink);\r\n\r\nbegin\r\n  FDatalinks.Add(DataLink);\r\n  if Assigned(DataSet) then\r\n    DataSet.RecalcBufListSize;\r\nend;\r\n\r\n\r\nprocedure TDatasource.SetDataSet(ADataSet: TDataSet);\r\nbegin\r\n  If FDataset<>Nil Then\r\n    Begin\r\n    FDataset.UnRegisterDataSource(Self);\r\n    FDataSet:=nil;\r\n    ProcessEvent(deUpdateState,0);\r\n    End;\r\n  If ADataset<>Nil Then\r\n    begin\r\n    ADataset.RegisterDatasource(Self);\r\n    FDataSet:=ADataset;\r\n    ProcessEvent(deUpdateState,0);\r\n    End;\r\nend;\r\n\r\n\r\nprocedure TDatasource.SetEnabled(Value: Boolean);\r\n\r\nbegin\r\n  FEnabled:=Value;\r\nend;\r\n\r\n\r\nProcedure TDatasource.DoDataChange (Info : Pointer);\r\n\r\nbegin\r\n  If Assigned(OnDataChange) and Assigned(Info) Then\r\n    OnDataChange(Self,TField(Info));\r\nend;\r\n\r\nProcedure TDatasource.DoStateChange;\r\n\r\nbegin\r\n  If Assigned(OnStateChange) Then\r\n    OnStateChange(Self);\r\nend;\r\n\r\n\r\nProcedure TDatasource.DoUpdateData;\r\n\r\nbegin\r\n  If Assigned(OnUpdateData) Then\r\n    OnUpdateData(Self);\r\nend;\r\n\r\n\r\nprocedure TDatasource.UnregisterDataLink(DataLink: TDataLink);\r\n\r\nbegin\r\n  FDatalinks.Remove(Datalink);\r\n  If Dataset<>Nil then\r\n    DataSet.RecalcBufListSize;\r\n  //Dataset.SetBufListSize(DataLink.BufferCount);\r\nend;\r\n\r\n\r\nprocedure TDataSource.ProcessEvent(Event : TDataEvent; Info : JSValue);\r\n\r\nConst\r\n    OnDataChangeEvents = [deRecordChange, deDataSetChange, deDataSetScroll,\r\n                          deLayoutChange,deUpdateState];\r\n\r\nVar\r\n  NeedDataChange : Boolean;\r\n  FLastState : TdataSetState;\r\n\r\nbegin\r\n  // Special UpdateState handling.\r\n  If Event=deUpdateState then\r\n    begin\r\n    NeedDataChange:=(FState=dsInactive);\r\n    FLastState:=FState;\r\n    If Assigned(Dataset) then\r\n      FState:=Dataset.State\r\n    else\r\n      FState:=dsInactive;\r\n    // Don't do events if nothing changed.\r\n    If FState=FLastState then\r\n      exit;\r\n    end\r\n  else\r\n    NeedDataChange:=True;\r\n  DistributeEvent(Event,Info);\r\n  // Extra handlers\r\n  If Not (csDestroying in ComponentState) then\r\n    begin\r\n    If (Event=deUpdateState) then\r\n      DoStateChange;\r\n    If (Event in OnDataChangeEvents) and\r\n       NeedDataChange Then\r\n      DoDataChange(Nil);\r\n    If (Event = deFieldChange) Then\r\n      DoDataCHange(Pointer(Info));\r\n    If (Event=deUpdateRecord) then\r\n      DoUpdateData;\r\n    end;\r\n end;\r\n\r\n\r\nprocedure SkipQuotesString(S : String; var p : integer; QuoteChar : char; EscapeSlash, EscapeRepeat : Boolean);\r\n\r\nvar notRepeatEscaped : boolean;\r\nbegin\r\n  Inc(p);\r\n  repeat\r\n    notRepeatEscaped := True;\r\n    while not CharInSet(S[p],[#0, QuoteChar]) do\r\n      begin\r\n      if EscapeSlash and (S[p]='\\') and (P<Length(S)) then\r\n        Inc(p,2) // make sure we handle \\' and \\\\ correct\r\n      else\r\n        Inc(p);\r\n      end;\r\n    if S[p]=QuoteChar then\r\n      begin\r\n      Inc(p); // skip final '\r\n      if (S[p]=QuoteChar) and EscapeRepeat then // Handle escaping by ''\r\n        begin\r\n        notRepeatEscaped := False;\r\n        inc(p);\r\n        end\r\n      end;\r\n  until notRepeatEscaped;\r\nend;\r\n\r\n\r\n{ TParams }\r\n\r\nfunction TParams.Add: TParam;\r\nbegin\r\n  Result := TParam(inherited Add)\r\nend;\r\n\r\nFunction TParams.GetItem(Index: Integer): TParam;\r\nbegin\r\n  Result:=(Inherited GetItem(Index)) as TParam;\r\nend;\r\n\r\nFunction TParams.GetParamValue(const ParamName: string): JSValue;\r\nbegin\r\n  Result:=ParamByName(ParamName).Value;\r\nend;\r\n\r\nProcedure TParams.SetItem(Index: Integer; Value: TParam);\r\nbegin\r\n  Inherited SetItem(Index,Value);\r\nend;\r\n\r\nProcedure TParams.SetParamValue(const ParamName: string; const Value: JSValue);\r\nbegin\r\n  ParamByName(ParamName).Value:=Value;\r\nend;\r\n\r\nProcedure TParams.AssignTo(Dest: TPersistent);\r\nbegin\r\n if (Dest is TParams) then\r\n   TParams(Dest).Assign(Self)\r\n else\r\n   inherited AssignTo(Dest);\r\nend;\r\n\r\nFunction TParams.GetDataSet: TDataSet;\r\nbegin\r\n  If (FOwner is TDataset) Then\r\n    Result:=TDataset(FOwner)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nFunction TParams.GetOwner: TPersistent;\r\nbegin\r\n  Result:=FOwner;\r\nend;\r\n\r\nClass Function TParams.ParamClass: TParamClass;\r\nbegin\r\n  Result:=TParam;\r\nend;\r\n\r\nConstructor TParams.Create(AOwner: TPersistent; AItemClass: TCollectionItemClass\r\n  );\r\nbegin\r\n  Inherited Create(AItemClass);\r\n  FOwner:=AOwner;\r\nend;\r\n\r\n\r\nConstructor TParams.Create(AOwner: TPersistent);\r\nbegin\r\n  Create(AOwner,ParamClass);\r\nend;\r\n\r\nConstructor TParams.Create;\r\nbegin\r\n  Create(Nil);\r\nend;\r\n\r\nProcedure TParams.AddParam(Value: TParam);\r\nbegin\r\n  Value.Collection:=Self;\r\nend;\r\n\r\nProcedure TParams.AssignValues(Value: TParams);\r\n\r\nVar\r\n  I : Integer;\r\n  P,PS : TParam;\r\n\r\nbegin\r\n  For I:=0 to Value.Count-1 do\r\n    begin\r\n    PS:=Value[i];\r\n    P:=FindParam(PS.Name);\r\n    If Assigned(P) then\r\n      P.Assign(PS);\r\n    end;\r\nend;\r\n\r\nFunction TParams.CreateParam(FldType: TFieldType; const ParamName: string;\r\n  ParamType: TParamType): TParam;\r\n\r\nbegin\r\n  Result:=Add as TParam;\r\n  Result.Name:=ParamName;\r\n  Result.DataType:=FldType;\r\n  Result.ParamType:=ParamType;\r\nend;\r\n\r\nFunction TParams.FindParam(const Value: string): TParam;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  I:=Count-1;\r\n  While (Result=Nil) and (I>=0) do\r\n    If (CompareText(Value,Items[i].Name)=0) then\r\n      Result:=Items[i]\r\n    else\r\n      Dec(i);\r\nend;\r\n\r\nProcedure TParams.GetParamList(List: TList; const ParamNames: string);\r\n\r\nVar\r\n  P: TParam;\r\n  N: String;\r\n  StrPos: Integer;\r\n\r\nbegin\r\n  if (ParamNames = '') or (List = nil) then\r\n    Exit;\r\n  StrPos := 1;\r\n  repeat\r\n    N := ExtractFieldName(ParamNames, StrPos);\r\n    P := ParamByName(N);\r\n    List.Add(P);\r\n  until StrPos > Length(ParamNames);\r\nend;\r\n\r\nFunction TParams.IsEqual(Value: TParams): Boolean;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Result:=(Value.Count=Count);\r\n  I:=Count-1;\r\n  While Result and (I>=0) do\r\n    begin\r\n    Result:=Items[I].IsEqual(Value[i]);\r\n    Dec(I);\r\n    end;\r\nend;\r\n\r\nFunction TParams.ParamByName(const Value: string): TParam;\r\nbegin\r\n  Result:=FindParam(Value);\r\n  If (Result=Nil) then\r\n    DatabaseErrorFmt(SParameterNotFound,[Value],Dataset);\r\nend;\r\n\r\nFunction TParams.ParseSQL(SQL: String; DoCreate: Boolean): String;\r\n\r\nvar pb : TParamBinding;\r\n    rs : string;\r\n\r\nbegin\r\n  Result := ParseSQL(SQL,DoCreate,True,True,psInterbase, pb, rs);\r\nend;\r\n\r\nFunction TParams.ParseSQL(SQL: String; DoCreate, EscapeSlash,\r\n  EscapeRepeat: Boolean; ParameterStyle: TParamStyle): String;\r\n\r\nvar pb : TParamBinding;\r\n    rs : string;\r\n\r\nbegin\r\n  Result := ParseSQL(SQL,DoCreate,EscapeSlash,EscapeRepeat,ParameterStyle,pb, rs);\r\nend;\r\n\r\nFunction TParams.ParseSQL(SQL: String; DoCreate, EscapeSlash,\r\n  EscapeRepeat: Boolean; ParameterStyle: TParamStyle; out\r\n  ParamBinding: TParambinding): String;\r\n\r\nvar rs : string;\r\n\r\nbegin\r\n  Result := ParseSQL(SQL,DoCreate,EscapeSlash, EscapeRepeat, ParameterStyle,ParamBinding, rs);\r\nend;\r\n\r\nfunction SkipComments(S : String; Var p: Integer; EscapeSlash, EscapeRepeat : Boolean) : Boolean;\r\n\r\nbegin\r\n  Result := False;\r\n  case S[P] of\r\n  '''', '\"', '`':\r\n    begin\r\n    Result := True;\r\n    // single quote, double quote or backtick delimited string\r\n    SkipQuotesString(S,p, S[p], EscapeSlash, EscapeRepeat);\r\n    end;\r\n  '-': // possible start of -- comment\r\n    begin\r\n    Inc(p);\r\n    if S[p]='-' then // -- comment\r\n      begin\r\n      Result := True;\r\n      repeat // skip until at end of line\r\n        Inc(p);\r\n      until CharInset(S[p],[#10, #13, #0]);\r\n      while CharInSet(S[p],[#10, #13]) do\r\n        Inc(p); // newline is part of comment\r\n      end;\r\n    end;\r\n  '/': // possible start of /* */ comment\r\n    begin\r\n    Inc(p);\r\n    if S[p]='*' then // /* */ comment\r\n      begin\r\n      Result := True;\r\n      Inc(p);\r\n      while p<=Length(S) do\r\n        begin\r\n        if S[p]='*' then // possible end of comment\r\n          begin\r\n          Inc(p);\r\n          if S[p]='/' then Break; // end of comment\r\n          end\r\n        else\r\n          Inc(p);\r\n        end;\r\n      if (P<=Length(s)) and (S[p]='/') then\r\n        Inc(p); // skip final /\r\n      end;\r\n    end;\r\n  end; {case}\r\nend;\r\n\r\nFunction TParams.ParseSQL(SQL: String; DoCreate, EscapeSlash,\r\n  EscapeRepeat: Boolean; ParameterStyle: TParamStyle; out\r\n  ParamBinding: TParambinding; out ReplaceString: string): String;\r\n\r\ntype\r\n  // used for ParamPart\r\n  TStringPart = record\r\n    Start,Stop:integer;\r\n  end;\r\n\r\nconst\r\n  ParamAllocStepSize = 8;\r\n  PAramDelimiters : Array of char = (';',',',' ','(',')',#13,#10,#9,#0,'=','+','-','*','\\','/','[',']','|');\r\n\r\nvar\r\n  IgnorePart:boolean;\r\n  p,ParamNameStart,BufStart:Integer;\r\n  ParamName:string;\r\n  QuestionMarkParamCount,ParameterIndex,NewLength:integer;\r\n  ParamCount:integer; // actual number of parameters encountered so far;\r\n                      // always <= Length(ParamPart) = Length(Parambinding)\r\n                      // Parambinding will have length ParamCount in the end\r\n  ParamPart:array of TStringPart; // describe which parts of buf are parameters\r\n  NewQueryLength:integer;\r\n  NewQuery:string;\r\n  NewQueryIndex,BufIndex,CopyLen,i:integer;    // Parambinding will have length ParamCount in the end\r\n  tmpParam:TParam;\r\n\r\nbegin\r\n  if DoCreate then Clear;\r\n  // Parse the SQL and build ParamBinding\r\n  ParamCount:=0;\r\n  NewQueryLength:=Length(SQL);\r\n  SetLength(ParamPart,ParamAllocStepSize);\r\n  SetLength(ParamBinding,ParamAllocStepSize);\r\n  QuestionMarkParamCount:=0; // number of ? params found in query so far\r\n\r\n  ReplaceString := '$';\r\n  if ParameterStyle = psSimulated then\r\n    while pos(ReplaceString,SQL) > 0 do ReplaceString := ReplaceString+'$';\r\n\r\n  p:=1;\r\n  BufStart:=p; // used to calculate ParamPart.Start values\r\n  repeat\r\n    while SkipComments(SQL,p,EscapeSlash,EscapeRepeat) do ;\r\n    case SQL[p] of\r\n    ':','?': // parameter\r\n      begin\r\n      IgnorePart := False;\r\n      if SQL[p]=':' then\r\n        begin // find parameter name\r\n        Inc(p);\r\n        if charInSet(SQL[p],[':','=',' ']) then  // ignore ::, since some databases uses this as a cast (wb 4813)\r\n          begin\r\n          IgnorePart := True;\r\n          Inc(p);\r\n          end\r\n        else\r\n          begin\r\n          if (SQL[p]='\"') then // Check if the parameter-name is between quotes\r\n             begin\r\n             ParamNameStart:=p;\r\n             SkipQuotesString(SQL,p,'\"',EscapeSlash,EscapeRepeat);\r\n             // Do not include the quotes in ParamName, but they must be included\r\n             // when the parameter is replaced by some place-holder.\r\n             ParamName:=Copy(SQL,ParamNameStart+1,p-ParamNameStart-2);\r\n             end\r\n          else\r\n             begin\r\n             ParamNameStart:=p;\r\n             while not CharInSet(SQL[p], ParamDelimiters) do\r\n               Inc(p);\r\n             ParamName:=Copy(SQL,ParamNameStart,p-ParamNameStart);\r\n             end;\r\n          end;\r\n        end\r\n      else\r\n        begin\r\n        Inc(p);\r\n        ParamNameStart:=p;\r\n        ParamName:='';\r\n        end;\r\n      if not IgnorePart then\r\n        begin\r\n        Inc(ParamCount);\r\n        if ParamCount>Length(ParamPart) then\r\n          begin\r\n          NewLength:=Length(ParamPart)+ParamAllocStepSize;\r\n          SetLength(ParamPart,NewLength);\r\n          SetLength(ParamBinding,NewLength);\r\n          end;\r\n        if DoCreate then\r\n          begin\r\n          // Check if this is the first occurance of the parameter\r\n          tmpParam := FindParam(ParamName);\r\n          // If so, create the parameter and assign the Parameterindex\r\n          if not assigned(tmpParam) then\r\n            ParameterIndex := CreateParam(ftUnknown, ParamName, ptInput).Index\r\n          else  // else only assign the ParameterIndex\r\n            ParameterIndex := tmpParam.Index;\r\n          end\r\n        // else find ParameterIndex\r\n        else\r\n          begin\r\n          if ParamName<>'' then\r\n            ParameterIndex:=ParamByName(ParamName).Index\r\n          else\r\n            begin\r\n            ParameterIndex:=QuestionMarkParamCount;\r\n            Inc(QuestionMarkParamCount);\r\n            end;\r\n          end;\r\n        if ParameterStyle in [psPostgreSQL,psSimulated] then\r\n          begin\r\n          i:=ParameterIndex+1;\r\n          repeat\r\n            inc(NewQueryLength);\r\n            i:=i div 10;\r\n          until i=0;\r\n          end;\r\n        // store ParameterIndex in FParamIndex, ParamPart data\r\n        ParamBinding[ParamCount-1]:=ParameterIndex;\r\n        ParamPart[ParamCount-1].Start:=ParamNameStart-BufStart;\r\n        ParamPart[ParamCount-1].Stop:=p-BufStart+1;\r\n        // update NewQueryLength\r\n        Dec(NewQueryLength,p-ParamNameStart);\r\n        end;\r\n      end;\r\n    #0:\r\n      Break; // end of SQL\r\n    else\r\n      Inc(p);\r\n    end;\r\n  until false;\r\n  SetLength(ParamPart,ParamCount);\r\n  SetLength(ParamBinding,ParamCount);\r\n  if ParamCount<=0 then\r\n    NewQuery:=SQL\r\n  else\r\n    begin\r\n    // replace :ParamName by ? for interbase and by $x for postgresql/psSimulated\r\n    // (using ParamPart array and NewQueryLength)\r\n    if (ParameterStyle = psSimulated) and (length(ReplaceString) > 1) then\r\n      inc(NewQueryLength,(paramcount)*(length(ReplaceString)-1));\r\n\r\n    SetLength(NewQuery,NewQueryLength);\r\n    NewQueryIndex:=1;\r\n    BufIndex:=1;\r\n    for i:=0 to High(ParamPart) do\r\n      begin\r\n      CopyLen:=ParamPart[i].Start-BufIndex;\r\n      NewQuery:=NewQuery+Copy(SQL,BufIndex,CopyLen);\r\n      Inc(NewQueryIndex,CopyLen);\r\n      case ParameterStyle of\r\n        psInterbase : begin\r\n                        NewQuery:=NewQuery+'?';\r\n                        Inc(NewQueryIndex);\r\n                      end;\r\n        psPostgreSQL,\r\n        psSimulated : begin\r\n                      ParamName := IntToStr(ParamBinding[i]+1);\r\n                      NewQuery:=StringOfChar('$',Length(ReplaceString));\r\n                      NewQuery:=NewQuery+ParamName;\r\n                      end;\r\n      end;\r\n      BufIndex:=ParamPart[i].Stop;\r\n    end;\r\n    CopyLen:=Length(SQL)+1-BufIndex;\r\n    if (CopyLen>0) then\r\n      NewQuery:=NewQuery+Copy(SQL,BufIndex,CopyLen);\r\n    end;\r\n  Result:=NewQuery;\r\nend;\r\n\r\n\r\nProcedure TParams.RemoveParam(Value: TParam);\r\nbegin\r\n   Value.Collection:=Nil;\r\nend;\r\n\r\n{ TParam }\r\n\r\nFunction TParam.GetDataSet: TDataSet;\r\nbegin\r\n  If Assigned(Collection) and (Collection is TParams) then\r\n    Result:=TParams(Collection).GetDataset\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nFunction TParam.IsParamStored: Boolean;\r\nbegin\r\n  Result:=Bound;\r\nend;\r\n\r\nProcedure TParam.AssignParam(Param: TParam);\r\nbegin\r\n  if Not Assigned(Param) then\r\n    begin\r\n    Clear;\r\n    FDataType:=ftunknown;\r\n    FParamType:=ptUnknown;\r\n    Name:='';\r\n    Size:=0;\r\n    Precision:=0;\r\n    NumericScale:=0;\r\n    end\r\n  else\r\n    begin\r\n    FDataType:=Param.DataType;\r\n    if Param.IsNull then\r\n      Clear\r\n    else\r\n      FValue:=Param.FValue;\r\n    FBound:=Param.Bound;\r\n    Name:=Param.Name;\r\n    if (ParamType=ptUnknown) then\r\n      ParamType:=Param.ParamType;\r\n    Size:=Param.Size;\r\n    Precision:=Param.Precision;\r\n    NumericScale:=Param.NumericScale;\r\n    end;\r\nend;\r\n\r\nProcedure TParam.AssignTo(Dest: TPersistent);\r\nbegin\r\n  if (Dest is TField) then\r\n    AssignToField(TField(Dest))\r\n  else\r\n    inherited AssignTo(Dest);\r\nend;\r\n\r\nFunction TParam.GetAsBoolean: Boolean;\r\nbegin\r\n  If IsNull then\r\n    Result:=False\r\n  else\r\n    Result:=FValue=true;\r\nend;\r\n\r\nFunction TParam.GetAsBytes: TBytes;\r\nbegin\r\n  if IsNull then\r\n    Result:=nil\r\n  else if isArray(FValue) then\r\n    Result:=TBytes(FValue)\r\nend;\r\n\r\nFunction TParam.GetAsDateTime: TDateTime;\r\nbegin\r\n  If IsNull then\r\n    Result:=0.0\r\n  else\r\n    Result:=TDateTime(FValue);\r\nend;\r\n\r\nFunction TParam.GetAsFloat: Double;\r\nbegin\r\n  If IsNull then\r\n    Result:=0.0\r\n  else\r\n    Result:=Double(FValue);\r\nend;\r\n\r\nFunction TParam.GetAsInteger: Longint;\r\nbegin\r\n  If IsNull or not IsInteger(FValue) then\r\n    Result:=0\r\n  else\r\n    Result:=Integer(FValue);\r\nend;\r\n\r\nFunction TParam.GetAsLargeInt: NativeInt;\r\nbegin\r\n  If IsNull or not IsInteger(FValue) then\r\n    Result:=0\r\n  else\r\n    Result:=NativeInt(FValue);\r\nend;\r\n\r\n\r\nFunction TParam.GetAsMemo: string;\r\nbegin\r\n  If IsNull or not IsString(FValue) then\r\n    Result:=''\r\n  else\r\n    Result:=String(FValue);\r\nend;\r\n\r\nFunction TParam.GetAsString: string;\r\n\r\nbegin\r\n  If IsNull or not IsString(FValue) then\r\n    Result:=''\r\n  else\r\n    Result:=String(FValue);\r\nend;\r\n\r\nFunction TParam.GetAsJSValue: JSValue;\r\nbegin\r\n  if IsNull then\r\n    Result:=Null\r\n  else\r\n    Result:=FValue;\r\nend;\r\nFunction TParam.GetDisplayName: string;\r\nbegin\r\n  if (FName<>'') then\r\n    Result:=FName\r\n  else\r\n    Result:=inherited GetDisplayName\r\nend;\r\n\r\nFunction TParam.GetIsNull: Boolean;\r\nbegin\r\n  Result:= JS.IsNull(FValue);\r\nend;\r\n\r\nFunction TParam.IsEqual(AValue: TParam): Boolean;\r\nbegin\r\n  Result:=(Name=AValue.Name)\r\n          and (IsNull=AValue.IsNull)\r\n          and (Bound=AValue.Bound)\r\n          and (DataType=AValue.DataType)\r\n          and (ParamType=AValue.ParamType)\r\n          and (GetValueType(FValue)=GetValueType(AValue.FValue))\r\n          and (FValue=AValue.FValue);\r\nend;\r\n\r\nProcedure TParam.SetAsBlob(const AValue: TBlobData);\r\nbegin\r\n  FDataType:=ftBlob;\r\n  Value:=AValue;\r\nend;\r\n\r\nProcedure TParam.SetAsBoolean(AValue: Boolean);\r\nbegin\r\n  FDataType:=ftBoolean;\r\n  Value:=AValue;\r\nend;\r\n\r\nprocedure TParam.SetAsBytes(const AValue: TBytes);\r\nbegin\r\n\r\nend;\r\n\r\nProcedure TParam.SetAsDate(const AValue: TDateTime);\r\nbegin\r\n  FDataType:=ftDate;\r\n  Value:=AValue;\r\nend;\r\n\r\nProcedure TParam.SetAsDateTime(const AValue: TDateTime);\r\nbegin\r\n  FDataType:=ftDateTime;\r\n  Value:=AValue;\r\nend;\r\n\r\nProcedure TParam.SetAsFloat(const AValue: Double);\r\nbegin\r\n  FDataType:=ftFloat;\r\n  Value:=AValue;\r\nend;\r\n\r\nProcedure TParam.SetAsInteger(AValue: Longint);\r\nbegin\r\n  FDataType:=ftInteger;\r\n  Value:=AValue;\r\nend;\r\n\r\nProcedure TParam.SetAsLargeInt(AValue: NativeInt);\r\nbegin\r\n  FDataType:=ftLargeint;\r\n  Value:=AValue;\r\nend;\r\n\r\nProcedure TParam.SetAsMemo(const AValue: string);\r\nbegin\r\n  FDataType:=ftMemo;\r\n  Value:=AValue;\r\nend;\r\n\r\nProcedure TParam.SetAsString(const AValue: string);\r\nbegin\r\n  if FDataType <> ftFixedChar then\r\n    FDataType := ftString;\r\n  Value:=AValue;\r\nend;\r\n\r\n\r\nProcedure TParam.SetAsTime(const AValue: TDateTime);\r\nbegin\r\n  FDataType:=ftTime;\r\n  Value:=AValue;\r\nend;\r\n\r\nProcedure TParam.SetAsJSValue(const AValue: JSValue);\r\n\r\nbegin\r\n  FValue:=AValue;\r\n  FBound:=not JS.IsNull(AValue);\r\n  if FBound then\r\n    case GetValueType(aValue) of\r\n      jvtBoolean : FDataType:=ftBoolean;\r\n      jvtInteger : FDataType:=ftInteger;\r\n      jvtFloat : FDataType:=ftFloat;\r\n      jvtObject,jvtArray : FDataType:=ftBlob;\r\n    end;\r\nend;\r\n\r\nProcedure TParam.SetDataType(AValue: TFieldType);\r\n\r\n\r\nbegin\r\n  FDataType:=AValue;\r\n\r\nend;\r\n\r\nProcedure TParam.SetText(const AValue: string);\r\nbegin\r\n  Value:=AValue;\r\nend;\r\n\r\nconstructor TParam.Create(ACollection: TCollection);\r\nbegin\r\n  inherited Create(ACollection);\r\n  ParamType:=ptUnknown;\r\n  DataType:=ftUnknown;\r\n  FValue:=Null;\r\nend;\r\n\r\nconstructor TParam.Create(AParams: TParams; AParamType: TParamType);\r\nbegin\r\n  Create(AParams);\r\n  ParamType:=AParamType;\r\nend;\r\n\r\nProcedure TParam.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TParam) then\r\n    AssignParam(TParam(Source))\r\n  else if (Source is TField) then\r\n    AssignField(TField(Source))\r\n  else if (source is TStrings) then\r\n    AsMemo:=TStrings(Source).Text\r\n  else\r\n    inherited Assign(Source);\r\nend;\r\n\r\nProcedure TParam.AssignField(Field: TField);\r\nbegin\r\n  if Assigned(Field) then\r\n    begin\r\n    // Need TField.Value\r\n    AssignFieldValue(Field,Field.Value);\r\n    Name:=Field.FieldName;\r\n    end\r\n  else\r\n    begin\r\n    Clear;\r\n    Name:='';\r\n    end\r\nend;\r\n\r\nProcedure TParam.AssignToField(Field : TField);\r\n\r\nbegin\r\n  if Assigned(Field) then\r\n    case FDataType of\r\n      ftUnknown  : DatabaseErrorFmt(SUnknownParamFieldType,[Name],DataSet);\r\n      // Need TField.AsSmallInt\r\n      // Need TField.AsWord\r\n      ftInteger,\r\n      ftAutoInc  : Field.AsInteger:=AsInteger;\r\n      ftFloat    : Field.AsFloat:=AsFloat;\r\n      ftBoolean  : Field.AsBoolean:=AsBoolean;\r\n      ftBlob,\r\n      ftString,\r\n      ftMemo,\r\n      ftFixedChar: Field.AsString:=AsString;\r\n      ftTime,\r\n      ftDate,\r\n      ftDateTime : Field.AsDateTime:=AsDateTime;\r\n    end;\r\nend;\r\n\r\nProcedure TParam.AssignFromField(Field : TField);\r\n\r\nbegin\r\n  if Assigned(Field) then\r\n    begin\r\n    FDataType:=Field.DataType;\r\n    case Field.DataType of\r\n      ftUnknown  : DatabaseErrorFmt(SUnknownParamFieldType,[Name],DataSet);\r\n      ftInteger,\r\n      ftAutoInc  : AsInteger:=Field.AsInteger;\r\n      ftFloat    : AsFloat:=Field.AsFloat;\r\n      ftBoolean  : AsBoolean:=Field.AsBoolean;\r\n      ftBlob,\r\n      ftString,\r\n      ftMemo,\r\n      ftFixedChar: AsString:=Field.AsString;\r\n      ftTime,\r\n      ftDate,\r\n      ftDateTime : AsDateTime:=Field.AsDateTime;\r\n    end;\r\n    end;\r\nend;\r\n\r\nProcedure TParam.AssignFieldValue(Field: TField; const AValue: JSValue);\r\n\r\nbegin\r\n  If Assigned(Field) then\r\n    begin\r\n\r\n    if (Field.DataType = ftString) and TStringField(Field).FixedChar then\r\n      FDataType := ftFixedChar\r\n    else if (Field.DataType = ftMemo) and (Field.Size > 255) then\r\n      FDataType := ftString\r\n    else\r\n      FDataType := Field.DataType;\r\n    if JS.IsNull(AValue) then\r\n      Clear\r\n    else\r\n      Value:=AValue;\r\n\r\n    Size:=Field.DataSize;\r\n    FBound:=True;\r\n\r\n    end;\r\nend;\r\n\r\nProcedure TParam.Clear;\r\nbegin\r\n  FValue:=Null;\r\nend;\r\n\r\n\r\nProcedure TParams.CopyParamValuesFromDataset(ADataSet: TDataSet;\r\n  CopyBound: Boolean);\r\n\r\nVar\r\n  I : Integer;\r\n  P : TParam;\r\n  F : TField;\r\n\r\nbegin\r\n  If assigned(ADataSet) then\r\n    For I:=0 to Count-1 do\r\n     begin\r\n     P:=Items[i];\r\n     if CopyBound or (not P.Bound) then\r\n       begin\r\n       // Master dataset must be active and unbound parameters must have fields\r\n       // with same names in master dataset (Delphi compatible behavior)\r\n       F:=ADataSet.FieldByName(P.Name);\r\n       P.AssignField(F);\r\n       If Not CopyBound then\r\n         P.Bound:=False;\r\n       end;\r\n    end;\r\nend;\r\n\r\ninitialization\r\n\r\nend.\r\n","{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 2008 Michael Van Canneyt.\r\n\r\n    Expression parser, supports variables, functions and\r\n    float/integer/string/boolean/datetime operations.\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n{$mode objfpc}\r\n{$h+}\r\nunit fpexprpars;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, contnrs;\r\n\r\nType\r\n  // tokens\r\n  TTokenType = (ttPlus, ttMinus, ttLessThan, ttLargerThan, ttEqual, ttDiv,\r\n                ttMod, ttMul, ttLeft, ttRight, ttLessThanEqual,\r\n                ttLargerThanEqual, ttunequal, ttNumber, ttString, ttIdentifier,\r\n                ttComma, ttAnd, ttOr, ttXor, ttTrue, ttFalse, ttNot, ttif,\r\n                ttCase, ttPower, ttEOF); // keep ttEOF last\r\n\r\n  TExprFloat = Double;\r\n\r\nConst\r\n  ttDelimiters = [ttPlus, ttMinus, ttLessThan, ttLargerThan, ttEqual, ttDiv,\r\n                  ttMul, ttLeft, ttRight, ttLessThanEqual, ttLargerThanEqual,\r\n                  ttunequal, ttPower];\r\n  ttComparisons = [ttLargerThan,ttLessthan,\r\n                   ttLargerThanEqual,ttLessthanEqual,\r\n                   ttEqual,ttUnequal];\r\n\r\nType\r\n\r\n  TFPExpressionParser = Class;\r\n  TExprBuiltInManager = Class;\r\n  TFPExprFunction = Class;\r\n  TFPExprFunctionClass = Class of TFPExprFunction;\r\n\r\n  TNumberKind = (nkDecimal, nkHex, nkOctal, nkBinary);\r\n\r\n  { TFPExpressionScanner }\r\n\r\n  TFPExpressionScanner = Class(TObject)\r\n    FSource : String;\r\n    LSource,\r\n    FPos : Integer;\r\n    FChar : Char;\r\n    FToken : String;\r\n    FTokenType : TTokenType;\r\n  private\r\n    function GetCurrentChar: Char;\r\n    procedure ScanError(Msg: String);\r\n  protected\r\n    procedure SetSource(const AValue: String); virtual;\r\n    function DoIdentifier: TTokenType;\r\n    function DoNumber(AKind: TNumberKind): TTokenType;\r\n    function DoDelimiter: TTokenType;\r\n    function DoString: TTokenType;\r\n    Function NextPos : Char; // inline;\r\n    procedure SkipWhiteSpace; // inline;\r\n    function IsWordDelim(C : Char) : Boolean; // inline;\r\n    function IsDelim(C : Char) : Boolean; // inline;\r\n    function IsDigit(C : Char; AKind: TNumberKind) : Boolean; // inline;\r\n    function IsAlpha(C : Char) : Boolean; // inline;\r\n  public\r\n    Constructor Create;\r\n    Function GetToken : TTokenType;\r\n    Property Token : String Read FToken;\r\n    Property TokenType : TTokenType Read FTokenType;\r\n    Property Source : String Read FSource Write SetSource;\r\n    Property Pos : Integer Read FPos;\r\n    Property CurrentChar : Char Read GetCurrentChar;\r\n  end;\r\n\r\n  EExprScanner = Class(Exception);\r\n\r\n  TResultType = (rtBoolean,rtInteger,rtFloat,rtDateTime,rtString,rtCurrency);\r\n  TResultTypes = set of TResultType;\r\n\r\n  TFPExpressionResult = record\r\n    ResultType : TResultType;\r\n    resValue : JSValue;\r\n  end;\r\n  PFPExpressionResult = ^TFPExpressionResult;\r\n  TExprParameterArray = Array of TFPExpressionResult;\r\n\r\n  { TFPExprNode }\r\n\r\n  TFPExprNode = Class(TObject)\r\n  Protected\r\n    Procedure CheckNodeType(Anode : TFPExprNode; Allowed : TResultTypes);\r\n    // A procedure with var saves an implicit try/finally in each node\r\n    // A marked difference in execution speed.\r\n    Function GetNodeValue : TFPExpressionResult; virtual; abstract;\r\n  Public\r\n    Procedure Check; virtual; abstract;\r\n    Procedure InitAggregate; virtual;\r\n    Procedure UpdateAggregate; virtual;\r\n    Class Function IsAggregate : Boolean; virtual;\r\n    Function HasAggregate : Boolean; virtual;\r\n    Function NodeType : TResultType; virtual; abstract;\r\n    Function NodeValue : TFPExpressionResult;\r\n    Function AsString : string; virtual; abstract;\r\n  end;\r\n  TExprArgumentArray = Array of TFPExprNode;\r\n\r\n  { TFPBinaryOperation }\r\n\r\n  TFPBinaryOperation = Class(TFPExprNode)\r\n  private\r\n    FLeft: TFPExprNode;\r\n    FRight: TFPExprNode;\r\n  Protected\r\n    Procedure CheckSameNodeTypes;\r\n  Public\r\n    Constructor Create(ALeft,ARight : TFPExprNode);\r\n    Destructor Destroy; override;\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n    Function HasAggregate : Boolean; override;\r\n    Procedure Check; override;\r\n    Property left : TFPExprNode Read FLeft;\r\n    Property Right : TFPExprNode Read FRight;\r\n  end;\r\n  TFPBinaryOperationClass = Class of TFPBinaryOperation;\r\n\r\n\r\n  { TFPBooleanOperation }\r\n\r\n  TFPBooleanOperation = Class(TFPBinaryOperation)\r\n  Public\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType; override;\r\n  end;\r\n  { TFPBinaryAndOperation }\r\n\r\n  TFPBinaryAndOperation = Class(TFPBooleanOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TFPBinaryOrOperation }\r\n\r\n  TFPBinaryOrOperation = Class(TFPBooleanOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TFPBinaryXOrOperation }\r\n\r\n  TFPBinaryXOrOperation = Class(TFPBooleanOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TFPBooleanResultOperation }\r\n\r\n  TFPBooleanResultOperation = Class(TFPBinaryOperation)\r\n  Public\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType; override;\r\n  end;\r\n  TFPBooleanResultOperationClass = Class of TFPBooleanResultOperation;\r\n\r\n\r\n  { TFPEqualOperation }\r\n\r\n  TFPEqualOperation = Class(TFPBooleanResultOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TFPUnequalOperation }\r\n\r\n  TFPUnequalOperation = Class(TFPEqualOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TFPOrderingOperation }\r\n\r\n  TFPOrderingOperation = Class(TFPBooleanResultOperation)\r\n  Public\r\n    Procedure Check; override;\r\n  end;\r\n\r\n  { TFPLessThanOperation }\r\n\r\n  TFPLessThanOperation = Class(TFPOrderingOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TFPGreaterThanOperation }\r\n\r\n  TFPGreaterThanOperation = Class(TFPOrderingOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TFPLessThanEqualOperation }\r\n\r\n  TFPLessThanEqualOperation = Class(TFPGreaterThanOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n\r\n  { TFPGreaterThanEqualOperation }\r\n\r\n  TFPGreaterThanEqualOperation = Class(TFPLessThanOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TIfOperation }\r\n\r\n  TIfOperation = Class(TFPBinaryOperation)\r\n  private\r\n    FCondition: TFPExprNode;\r\n  protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Procedure Check; override;\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n    Function HasAggregate : Boolean; override;\r\n    Function NodeType : TResultType; override;\r\n    Constructor Create(ACondition,ALeft,ARight : TFPExprNode);\r\n    Destructor destroy; override;\r\n    Function AsString : string ; override;\r\n    Property Condition : TFPExprNode Read FCondition;\r\n  end;\r\n\r\n  { TCaseOperation }\r\n\r\n  TCaseOperation = Class(TFPExprNode)\r\n  private\r\n    FArgs : TExprArgumentArray;\r\n    FCondition: TFPExprNode;\r\n  protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Procedure Check; override;\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n    function HasAggregate: Boolean; override;\r\n    Function NodeType : TResultType; override;\r\n    Constructor Create(Args : TExprArgumentArray);\r\n    Destructor destroy; override;\r\n    Function AsString : string ; override;\r\n    Property Condition : TFPExprNode Read FCondition;\r\n  end;\r\n\r\n  { TMathOperation }\r\n\r\n  TMathOperation = Class(TFPBinaryOperation)\r\n  Public\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType; override;\r\n  end;\r\n\r\n  { TFPAddOperation }\r\n\r\n  TFPAddOperation = Class(TMathOperation)\r\n  Protected\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  Public\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TFPSubtractOperation }\r\n\r\n  TFPSubtractOperation = Class(TMathOperation)\r\n  Public\r\n    Procedure Check; override;\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n    Function AsString : string ; override;\r\n  end;\r\n\r\n  { TFPMultiplyOperation }\r\n\r\n  TFPMultiplyOperation = Class(TMathOperation)\r\n  Public\r\n    Procedure check; override;\r\n    Function AsString : string ; override;\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  end;\r\n\r\n  { TFPDivideOperation }\r\n\r\n  TFPDivideOperation = Class(TMathOperation)\r\n  Public\r\n    Procedure Check; override;\r\n    Function AsString : string ; override;\r\n    Function NodeType : TResultType; override;\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  end;\r\n\r\n  { TFPModuloOperation }\r\n\r\n  TFPModuloOperation = Class(TMathOperation)\r\n  Public\r\n    Procedure Check; override;\r\n    Function AsString : string ; override;\r\n    Function NodeType : TResultType; override;\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  end;\r\n\r\n\r\n  { TFPPowerOperation }\r\n  TFPPowerOperation = class(TMathOperation)\r\n  public\r\n    Procedure Check; override;\r\n    Function AsString : string ; override;\r\n    Function NodeType : TResultType; override;\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n  end;\r\n\r\n\r\n  { TFPUnaryOperator }\r\n\r\n  TFPUnaryOperator = Class(TFPExprNode)\r\n  private\r\n    FOperand: TFPExprNode;\r\n  Public\r\n    Constructor Create(AOperand : TFPExprNode);\r\n    Destructor Destroy; override;\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n    Function HasAggregate : Boolean; override;\r\n    Procedure Check; override;\r\n    Property Operand : TFPExprNode Read FOperand;\r\n  end;\r\n\r\n  { TFPConvertNode }\r\n\r\n  TFPConvertNode = Class(TFPUnaryOperator)\r\n    Function AsString : String; override;\r\n  end;\r\n\r\n  { TFPNotNode }\r\n\r\n  TFPNotNode = Class(TFPUnaryOperator)\r\n  Public\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n    Function AsString : String; override;\r\n  end;\r\n\r\n  TIntConvertNode = Class(TFPConvertNode)\r\n  Public\r\n    Procedure Check; override;\r\n  end;\r\n\r\n  { TIntToFloatNode }\r\n\r\n  TIntToFloatNode = Class(TIntConvertNode)\r\n  Public\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n  end;\r\n\r\n  { TIntToCurrencyNode }\r\n\r\n  TIntToCurrencyNode = Class(TIntConvertNode)\r\n  Public\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n  end;\r\n\r\n  { TIntToDateTimeNode }\r\n\r\n  TIntToDateTimeNode = Class(TIntConvertNode)\r\n  Public\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n  end;\r\n\r\n  { TFloatToDateTimeNode }\r\n\r\n  TFloatToDateTimeNode = Class(TFPConvertNode)\r\n  Public\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n  end;\r\n\r\n  { TFloatToCurrencyNode }\r\n\r\n  TFloatToCurrencyNode = Class(TFPConvertNode)\r\n  Public\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n  end;\r\n\r\n  { TCurrencyToDateTimeNode }\r\n\r\n  TCurrencyToDateTimeNode = Class(TFPConvertNode)\r\n  Public\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n  end;\r\n\r\n  { TCurrencyToFloatNode }\r\n\r\n  TCurrencyToFloatNode = Class(TFPConvertNode)\r\n  Public\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n  end;\r\n\r\n\r\n  { TFPNegateOperation }\r\n\r\n  TFPNegateOperation = Class(TFPUnaryOperator)\r\n  Public\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n    Function AsString : String; override;\r\n  end;\r\n\r\n  { TFPConstExpression }\r\n\r\n  TFPConstExpression = Class(TFPExprnode)\r\n  private\r\n    FValue : TFPExpressionResult;\r\n  public\r\n    Constructor CreateString(AValue : String);\r\n    Constructor CreateInteger(AValue : NativeInt);\r\n    Constructor CreateDateTime(AValue : TDateTime);\r\n    Constructor CreateFloat(AValue : TExprFloat);\r\n    Constructor CreateBoolean(AValue : Boolean);\r\n    constructor CreateCurrency(AValue: Currency);\r\n    Procedure Check; override;\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n    Function AsString : string ; override;\r\n   // For inspection\r\n    Property ConstValue : TFPExpressionResult read FValue;\r\n  end;\r\n\r\n\r\n  TIdentifierType = (itVariable,itFunctionHandler,itFunctionNode);\r\n  TFPExprFunctionEvent = reference to Function (Const Args : TExprParameterArray) : TFPExpressionResult ;\r\n  TFPExprVariableEvent = Reference to Function (Const AName : String) : TFPExpressionResult;\r\n\r\n  { TFPExprIdentifierDef }\r\n\r\n  TFPExprIdentifierDef = Class(TCollectionItem)\r\n  private\r\n    FNodeType: TFPExprFunctionClass;\r\n    FOnGetVarValue: TFPExprVariableEvent;\r\n    FStringValue : String;\r\n    FValue : TFPExpressionResult;\r\n    FArgumentTypes: String;\r\n    FIDType: TIdentifierType;\r\n    FName: string;\r\n    FOnGetValue: TFPExprFunctionEvent;\r\n    function GetAsBoolean: Boolean;\r\n    function GetAsDateTime: TDateTime;\r\n    function GetAsFloat: TExprFloat;\r\n    function GetAsCurrency : Currency;\r\n    function GetAsInteger: NativeInt;\r\n    function GetAsString: String;\r\n    function GetResultType: TResultType;\r\n    function GetValue: String;\r\n    procedure SetArgumentTypes(const AValue: String);\r\n    procedure SetAsBoolean(const AValue: Boolean);\r\n    procedure SetAsDateTime(const AValue: TDateTime);\r\n    procedure SetAsFloat(const AValue: TExprFloat);\r\n    procedure SetAsCurrency(const AValue: Currency);\r\n    procedure SetAsInteger(const AValue: NativeInt);\r\n    procedure SetAsString(const AValue: String);\r\n    procedure SetName(const AValue: string);\r\n    procedure SetResultType(const AValue: TResultType);\r\n    procedure SetValue(const AValue: String);\r\n  Protected\r\n    Procedure CheckResultType(Const AType : TResultType);\r\n    Procedure CheckVariable;\r\n    Procedure FetchValue;\r\n  Public\r\n    Function ArgumentCount : Integer;\r\n    Procedure Assign(Source : TPersistent); override;\r\n    Function EventBasedVariable : Boolean; Inline;\r\n    Property AsFloat : TExprFloat Read GetAsFloat Write SetAsFloat;\r\n    Property AsCurrency : Currency Read GetAsCurrency Write SetAsCurrency;\r\n    Property AsInteger : NativeInt Read GetAsInteger Write SetAsInteger;\r\n    Property AsString : String Read GetAsString Write SetAsString;\r\n    Property AsBoolean : Boolean Read GetAsBoolean Write SetAsBoolean;\r\n    Property AsDateTime : TDateTime Read GetAsDateTime Write SetAsDateTime;\r\n  Published\r\n    Property IdentifierType : TIdentifierType Read FIDType Write FIDType;\r\n    Property Name : string Read FName Write SetName;\r\n    Property Value : String Read GetValue Write SetValue;\r\n    Property ParameterTypes : String Read FArgumentTypes Write SetArgumentTypes;\r\n    Property ResultType : TResultType Read GetResultType Write SetResultType;\r\n    Property OnGetFunctionValue : TFPExprFunctionEvent Read FOnGetValue Write FOnGetValue;\r\n    Property OnGetVariableValue : TFPExprVariableEvent Read FOnGetVarValue Write FOnGetVarValue;\r\n    Property NodeType : TFPExprFunctionClass Read FNodeType Write FNodeType;\r\n  end;\r\n\r\n\r\n  TBuiltInCategory = (bcStrings,bcDateTime,bcMath,bcBoolean,bcConversion,bcData,bcVaria,bcUser,bcAggregate);\r\n  TBuiltInCategories = Set of TBuiltInCategory;\r\n\r\n  { TFPBuiltInExprIdentifierDef }\r\n\r\n  TFPBuiltInExprIdentifierDef = Class(TFPExprIdentifierDef)\r\n  private\r\n    FCategory: TBuiltInCategory;\r\n  Public\r\n    Procedure Assign(Source : TPersistent); override;\r\n  Published\r\n    Property Category : TBuiltInCategory Read FCategory Write FCategory;\r\n  end;\r\n\r\n  { TFPExprIdentifierDefs }\r\n\r\n  TFPExprIdentifierDefs = Class(TCollection)\r\n  private\r\n    FParser: TFPExpressionParser;\r\n    function GetI(AIndex : Integer): TFPExprIdentifierDef;\r\n    procedure SetI(AIndex : Integer; const AValue: TFPExprIdentifierDef);\r\n  Protected\r\n    procedure Update(Item: TCollectionItem); override;\r\n    Property Parser: TFPExpressionParser Read FParser;\r\n  Public\r\n    Function IndexOfIdentifier(Const AName : string) : Integer;\r\n    Function FindIdentifier(Const AName : string) : TFPExprIdentifierDef;\r\n    Function IdentifierByName(Const AName : string) : TFPExprIdentifierDef;\r\n    Function AddVariable(Const AName : string; AResultType : TResultType; ACallback : TFPExprVariableEvent) : TFPExprIdentifierDef;\r\n    Function AddVariable(Const AName : string; AResultType : TResultType; AValue : String) : TFPExprIdentifierDef;\r\n    Function AddBooleanVariable(Const AName : string; AValue : Boolean) : TFPExprIdentifierDef;\r\n    Function AddIntegerVariable(Const AName : string; AValue : Integer) : TFPExprIdentifierDef;\r\n    Function AddFloatVariable(Const AName : string; AValue : TExprFloat) : TFPExprIdentifierDef;\r\n    Function AddCurrencyVariable(Const AName : string; AValue : Currency) : TFPExprIdentifierDef;\r\n    Function AddStringVariable(Const AName : string; AValue : String) : TFPExprIdentifierDef;\r\n    Function AddDateTimeVariable(Const AName : string; AValue : TDateTime) : TFPExprIdentifierDef;\r\n    Function AddFunction(Const AName : string; Const AResultType : Char; Const AParamTypes : String; ACallBack : TFPExprFunctionEvent) : TFPExprIdentifierDef;\r\n    Function AddFunction(Const AName : string; Const AResultType : Char; Const AParamTypes : String; ANodeClass : TFPExprFunctionClass) : TFPExprIdentifierDef;\r\n    property Identifiers[AIndex : Integer] : TFPExprIdentifierDef Read GetI Write SetI; Default;\r\n  end;\r\n\r\n  { TFPExprIdentifierNode }\r\n\r\n  TFPExprIdentifierNode = Class(TFPExprNode)\r\n  Private\r\n    FID : TFPExprIdentifierDef;\r\n    PResult : PFPExpressionResult;\r\n    FResultType : TResultType;\r\n  public\r\n    Constructor CreateIdentifier(AID : TFPExprIdentifierDef);\r\n    Function NodeType : TResultType;  override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n    Property Identifier : TFPExprIdentifierDef Read FID;\r\n  end;\r\n\r\n  { TFPExprVariable }\r\n\r\n  TFPExprVariable = Class(TFPExprIdentifierNode)\r\n    Procedure Check; override;\r\n    function AsString: string; override;\r\n  end;\r\n\r\n  { TFPExprFunction }\r\n\r\n  TFPExprFunction = Class(TFPExprIdentifierNode)\r\n  private\r\n    FArgumentNodes : TExprArgumentArray;\r\n    FargumentParams : TExprParameterArray;\r\n  Protected\r\n    Procedure CalcParams;\r\n    function ConvertArgument(aIndex: Integer; aNode: TFPExprNode; aType: TResultType): TFPExprNode; virtual;\r\n  Public\r\n    Procedure Check; override;\r\n    Constructor CreateFunction(AID : TFPExprIdentifierDef; Const Args : TExprArgumentArray); virtual;\r\n    Destructor Destroy; override;\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n    Function HasAggregate : Boolean; override;\r\n    Property ArgumentNodes : TExprArgumentArray Read FArgumentNodes;\r\n    Property ArgumentParams : TExprParameterArray Read FArgumentParams;\r\n    Function AsString : String; override;\r\n  end;\r\n\r\n  { TAggregateExpr }\r\n\r\n  TAggregateExpr = Class(TFPExprFunction)\r\n  Protected\r\n    FResult : TFPExpressionResult;\r\n  public\r\n    Class Function IsAggregate : Boolean; override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n  end;\r\n\r\n  { TAggregateMin }\r\n\r\n  TAggregateMin = Class(TAggregateExpr)\r\n  Public\r\n    FFirst: Boolean;\r\n  Public\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n  end;\r\n\r\n  { TAggregateMax }\r\n\r\n  TAggregateMax = Class(TAggregateExpr)\r\n  Public\r\n    FFirst: Boolean;\r\n  Public\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n  end;\r\n\r\n  { TAggregateSum }\r\n\r\n  TAggregateSum = Class(TAggregateExpr)\r\n  Public\r\n    function ConvertArgument(aIndex: Integer; aNode: TFPExprNode; aType: TResultType): TFPExprNode; override;\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n  end;\r\n\r\n  { TAggregateAvg }\r\n\r\n  TAggregateAvg = Class(TAggregateSum)\r\n  Protected\r\n    FCount : Integer;\r\n  Public\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n    Function GetNodeValue : TFPExpressionResult;  override;\r\n  end;\r\n\r\n  { TAggregateCount }\r\n\r\n  TAggregateCount = Class(TAggregateExpr)\r\n  Public\r\n    Procedure InitAggregate; override;\r\n    Procedure UpdateAggregate; override;\r\n  end;\r\n\r\n  { TFPFunctionEventHandler }\r\n\r\n  TFPFunctionEventHandler = Class(TFPExprFunction)\r\n  Private\r\n    FCallBack : TFPExprFunctionEvent;\r\n  Public\r\n    Constructor CreateFunction(AID : TFPExprIdentifierDef; Const Args : TExprArgumentArray); override;\r\n    Function GetNodeValue : TFPExpressionResult; override;\r\n    Property CallBack : TFPExprFunctionEvent Read FCallBack;\r\n  end;\r\n\r\n  { TFPExpressionParser }\r\n\r\n  TFPExpressionParser = class(TComponent)\r\n  private\r\n    FBuiltIns: TBuiltInCategories;\r\n    FExpression: String;\r\n    FScanner : TFPExpressionScanner;\r\n    FExprNode : TFPExprNode;\r\n    FIdentifiers : TFPExprIdentifierDefs;\r\n    FHashList : TFPObjectHashTable;\r\n    FDirty : Boolean;\r\n    procedure CheckEOF;\r\n    function GetAsBoolean: Boolean;\r\n    function GetAsDateTime: TDateTime;\r\n    function GetAsFloat: TExprFloat;\r\n    function GetAsCurrency: Currency;\r\n    function GetAsInteger: NativeInt;\r\n    function GetAsString: String;\r\n    function MatchNodes(Todo, Match: TFPExprNode): TFPExprNode;\r\n    procedure CheckNodes(var Left, Right: TFPExprNode);\r\n    procedure SetBuiltIns(const AValue: TBuiltInCategories);\r\n    procedure SetIdentifiers(const AValue: TFPExprIdentifierDefs);\r\n  Protected\r\n    procedure ParserError(Msg: String);\r\n    procedure SetExpression(const AValue: String); virtual;\r\n    Procedure CheckResultType(Const Res :TFPExpressionResult; AType : TResultType); inline;\r\n    Procedure CheckResultTypes(Const Res :TFPExpressionResult; ATypes : TResultTypes); inline;\r\n    Class function ConvertNode(Todo: TFPExprNode; ToType: TResultType): TFPExprNode;\r\n    class Function BuiltinsManager : TExprBuiltInManager;\r\n    Function Level1 : TFPExprNode;\r\n    Function Level2 : TFPExprNode;\r\n    Function Level3 : TFPExprNode;\r\n    Function Level4 : TFPExprNode;\r\n    Function Level5 : TFPExprNode;\r\n    Function Level6 : TFPExprNode;\r\n    Function Level7 : TFPExprNode;\r\n    Function Primitive : TFPExprNode;\r\n    function GetToken: TTokenType;\r\n    Function TokenType : TTokenType;\r\n    Function CurrentToken : String;\r\n    Procedure CreateHashList;\r\n    Property Scanner : TFPExpressionScanner Read FScanner;\r\n    Property ExprNode : TFPExprNode Read FExprNode;\r\n    Property Dirty : Boolean Read FDirty;\r\n  public\r\n    Constructor Create(AOwner :TComponent); override;\r\n    Destructor Destroy; override;\r\n    Function IdentifierByName(const AName : string) : TFPExprIdentifierDef; virtual;\r\n    Procedure Clear;\r\n    Class function Evaluate(aExpression : String): TFPExpressionResult; overload;\r\n    Procedure EvaluateExpression(Out Result : TFPExpressionResult);\r\n    function ExtractNode(var N: TFPExprNode): Boolean;\r\n    Function Evaluate : TFPExpressionResult;overload;\r\n    Function ResultType : TResultType;\r\n    Function HasAggregate : Boolean;\r\n    Procedure InitAggregate;\r\n    Procedure UpdateAggregate;\r\n    Property AsFloat : TExprFloat Read GetAsFloat;\r\n    Property AsCurrency : Currency Read GetAsCurrency;\r\n    Property AsInteger : NativeInt Read GetAsInteger;\r\n    Property AsString : String Read GetAsString;\r\n    Property AsBoolean : Boolean Read GetAsBoolean;\r\n    Property AsDateTime : TDateTime Read GetAsDateTime;\r\n  Published\r\n    // The Expression to parse\r\n    property Expression : String read FExpression write SetExpression;\r\n    Property Identifiers : TFPExprIdentifierDefs Read FIdentifiers Write SetIdentifiers;\r\n    Property BuiltIns : TBuiltInCategories Read FBuiltIns Write SetBuiltIns;\r\n  end;\r\n  TFPExpressionParserClass = Class of TFPExpressionParser;\r\n  { TExprBuiltInManager }\r\n\r\n  TExprBuiltInManager = Class(TComponent)\r\n  Private\r\n    FDefs : TFPExprIdentifierDefs;\r\n    function GetCount: Integer;\r\n    function GetI(AIndex : Integer): TFPBuiltInExprIdentifierDef;\r\n  protected\r\n    Property Defs : TFPExprIdentifierDefs Read FDefs;\r\n  Public\r\n    Constructor Create(AOwner : TComponent); override;\r\n    Destructor Destroy; override;\r\n    Function IndexOfIdentifier(Const AName : string) : Integer;\r\n    Function FindIdentifier(Const AName : string) : TFPBuiltinExprIdentifierDef;\r\n    Function IdentifierByName(Const AName : string) : TFPBuiltinExprIdentifierDef;\r\n    Function AddVariable(Const ACategory : TBuiltInCategory; Const AName : string; AResultType : TResultType; AValue : String) : TFPBuiltInExprIdentifierDef;\r\n    Function AddBooleanVariable(Const ACategory : TBuiltInCategory; Const AName : string; AValue : Boolean) : TFPBuiltInExprIdentifierDef;\r\n    Function AddIntegerVariable(Const ACategory : TBuiltInCategory; Const AName : string; AValue : Integer) : TFPBuiltInExprIdentifierDef;\r\n    Function AddFloatVariable(Const ACategory : TBuiltInCategory; Const AName : string; AValue : TExprFloat) : TFPBuiltInExprIdentifierDef;\r\n    Function AddCurrencyVariable(Const ACategory : TBuiltInCategory; Const AName : string; AValue : Currency) : TFPBuiltInExprIdentifierDef;\r\n    Function AddStringVariable(Const ACategory : TBuiltInCategory; Const AName : string; AValue : String) : TFPBuiltInExprIdentifierDef;\r\n    Function AddDateTimeVariable(Const ACategory : TBuiltInCategory; Const AName : string; AValue : TDateTime) : TFPBuiltInExprIdentifierDef;\r\n    Function AddFunction(Const ACategory : TBuiltInCategory; Const AName : string; Const AResultType : Char; Const AParamTypes : String; ACallBack : TFPExprFunctionEvent) : TFPBuiltInExprIdentifierDef;\r\n    Function AddFunction(Const ACategory : TBuiltInCategory; Const AName : string; Const AResultType : Char; Const AParamTypes : String; ANodeClass : TFPExprFunctionClass) : TFPBuiltInExprIdentifierDef;\r\n    Property IdentifierCount : Integer Read GetCount;\r\n    Property Identifiers[AIndex : Integer] :TFPBuiltInExprIdentifierDef Read GetI;\r\n  end;\r\n\r\n  EExprParser = Class(Exception);\r\n\r\nConst\r\n  AllBuiltIns = [bcStrings,bcDateTime,bcMath,bcBoolean,bcConversion,bcData,bcVaria,bcUser,bcAggregate];\r\n\r\nFunction TokenName (AToken : TTokenType) : String;\r\nFunction ResultTypeName (AResult : TResultType) : String;\r\nFunction CharToResultType(C : Char) : TResultType;\r\nFunction BuiltinIdentifiers : TExprBuiltInManager;\r\nProcedure RegisterStdBuiltins(AManager : TExprBuiltInManager; Categories : TBuiltInCategories = AllBuiltIns);\r\nfunction ArgToFloat(Arg: TFPExpressionResult): TExprFloat;\r\n\r\n\r\n\r\nimplementation\r\n\r\nuses typinfo;\r\n\r\n{ TFPExpressionParser }\r\n\r\nconst\r\n  cNull=#0;\r\n  cSingleQuote = '''';\r\n  cHexIdentifier = '$';\r\n  cOctalIdentifier = '&';\r\n  cBinaryIdentifier = '%';\r\n\r\n  Digits        = ['0'..'9','.'];\r\n  HexDigits     = ['0'..'9', 'A'..'F', 'a'..'f'];\r\n  OctalDigits   = ['0'..'7'];\r\n  BinaryDigits  = ['0', '1'];\r\n  WhiteSpace    = [' ',#13,#10,#9];\r\n  Operators     = ['+','-','<','>','=','/','*','^'];\r\n  Delimiters    = Operators+[',','(',')'];\r\n  Symbols       = ['%']+Delimiters;\r\n  WordDelimiters = WhiteSpace + Symbols;\r\n\r\nvar\r\n  FileFormatSettings: TFormatSettings;\r\n\r\nResourcestring\r\n  SBadQuotes        = 'Unterminated string';\r\n  SUnknownDelimiter = 'Unknown delimiter character: \"%s\"';\r\n  SErrUnknownCharacter = 'Unknown character at pos %d: \"%s\"';\r\n  SErrUnexpectedEndOfExpression = 'Unexpected end of expression';\r\n  SErrUnknownComparison = 'Internal error: Unknown comparison';\r\n  SErrUnknownBooleanOp = 'Internal error: Unknown boolean operation';\r\n  SErrBracketExpected = 'Expected ) bracket at position %d, but got %s';\r\n  SerrUnknownTokenAtPos = 'Unknown token at pos %d : %s';\r\n  SErrLeftBracketExpected = 'Expected ( bracket at position %d, but got %s';\r\n  SErrInvalidFloat = '%s is not a valid floating-point value';\r\n  SErrUnknownIdentifier = 'Unknown identifier: %s';\r\n  SErrInExpression = 'Cannot evaluate: error in expression';\r\n  SErrInExpressionEmpty = 'Cannot evaluate: empty expression';\r\n  SErrCommaExpected =  'Expected comma (,) at position %d, but got %s';\r\n  SErrInvalidNumberChar = 'Unexpected character in number : %s';\r\n  SErrInvalidNumber = 'Invalid numerical value : %s';\r\n  SErrUnterminatedIdentifier = 'Unterminated quoted identifier: %s';\r\n  SErrNoOperand = 'No operand for unary operation %s';\r\n  SErrNoleftOperand = 'No left operand for binary operation %s';\r\n  SErrNoRightOperand = 'No right operand for binary operation %s';\r\n  SErrNoNegation = 'Cannot negate expression of type %s : %s';\r\n  SErrNoNOTOperation = 'Cannot perform \"not\" on expression of type %s: %s';\r\n  SErrTypesDoNotMatch = 'Type mismatch: %s<>%s for expressions \"%s\" and \"%s\".';\r\n  SErrNoNodeToCheck = 'Internal error: No node to check !';\r\n  SInvalidNodeType = 'Node type (%s) not in allowed types (%s) for expression: %s';\r\n  SErrUnterminatedExpression = 'Badly terminated expression. Found token at position %d : %s';\r\n  SErrDuplicateIdentifier = 'An identifier with name \"%s\" already exists.';\r\n  SErrInvalidResultCharacter = '\"%s\" is not a valid return type indicator';\r\n  ErrInvalidArgumentCount = 'Invalid argument count for function %s';\r\n  SErrInvalidArgumentType = 'Invalid type for argument %d: Expected %s, got %s';\r\n  SErrInvalidResultType = 'Invalid result type: %s';\r\n  SErrNotVariable = 'Identifier %s is not a variable';\r\n  SErrIFNeedsBoolean = 'First argument to IF must be of type boolean: %s';\r\n  SErrCaseNeeds3 = 'Case statement needs to have at least 4 arguments';\r\n  SErrCaseEvenCount = 'Case statement needs to have an even number of arguments';\r\n  SErrCaseLabelNotAConst = 'Case label %d \"%s\" is not a constant expression';\r\n  SErrCaseLabelType = 'Case label %d \"%s\" needs type %s, but has type %s';\r\n  SErrCaseValueType = 'Case value %d \"%s\" needs type %s, but has type %s';\r\n\r\n{ ---------------------------------------------------------------------\r\n  Auxiliary functions\r\n  ---------------------------------------------------------------------}\r\n\r\nProcedure RaiseParserError(Msg : String);\r\nbegin\r\n  Raise EExprParser.Create(Msg);\r\nend;\r\n\r\nProcedure RaiseParserError(Fmt : String; Args : Array of JSValue);\r\nbegin\r\n  Raise EExprParser.CreateFmt(Fmt,Args);\r\nend;\r\n\r\nfunction TokenName(AToken: TTokenType): String;\r\n\r\nbegin\r\n  Result:=GetEnumName(TypeInfo(TTokenType),Ord(AToken));\r\nend;\r\n\r\nfunction ResultTypeName(AResult: TResultType): String;\r\n\r\nbegin\r\n  Result:=GetEnumName(TypeInfo(TResultType),Ord(AResult));\r\nend;\r\n\r\nfunction CharToResultType(C: Char): TResultType;\r\nbegin\r\n  Case Upcase(C) of\r\n    'S' : Result:=rtString;\r\n    'D' : Result:=rtDateTime;\r\n    'B' : Result:=rtBoolean;\r\n    'I' : Result:=rtInteger;\r\n    'F' : Result:=rtFloat;\r\n    'C' : Result:=rtCurrency;\r\n  else\r\n    RaiseParserError(SErrInvalidResultCharacter,[C]);\r\n  end;\r\nend;\r\n\r\nVar\r\n  BuiltIns : TExprBuiltInManager;\r\n\r\nfunction BuiltinIdentifiers: TExprBuiltInManager;\r\n\r\nbegin\r\n  If (BuiltIns=Nil) then\r\n    BuiltIns:=TExprBuiltInManager.Create(Nil);\r\n  Result:=BuiltIns;\r\nend;\r\n\r\n\r\n{ TFloatToCurrencyNode }\r\n\r\nprocedure TFloatToCurrencyNode.Check;\r\nbegin\r\n  CheckNodeType(Operand,[rtFloat]);\r\nend;\r\n\r\nfunction TFloatToCurrencyNode.NodeType: TResultType;\r\nbegin\r\n  Result:=rtCurrency;\r\nend;\r\n\r\nFunction TFloatToCurrencyNode.GetNodeValue: TFPExpressionResult;\r\nbegin\r\n  Result:=Operand.GetNodeValue;\r\n  Result.ResultType:=rtCurrency;\r\n  Result.resValue:=Result.resValue;\r\nend;\r\n\r\n{ TIntToCurrencyNode }\r\n\r\nfunction TIntToCurrencyNode.NodeType: TResultType;\r\nbegin\r\n  Result:=rtCurrency;\r\nend;\r\n\r\nFunction TIntToCurrencyNode.GetNodeValue: TFPExpressionResult;\r\nbegin\r\n  Result:=Operand.GetNodeValue;\r\n  Result.resValue:=Result.resValue;\r\n  Result.ResultType:=rtCurrency;\r\nend;\r\n\r\n{ TFPModuloOperation }\r\n\r\nprocedure TFPModuloOperation.Check;\r\nbegin\r\n  CheckNodeType(Left,[rtInteger]);\r\n  CheckNodeType(Right,[rtInteger]);\r\n  inherited Check;\r\nend;\r\n\r\nfunction TFPModuloOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' mod '+Right.asString;\r\nend;\r\n\r\nfunction TFPModuloOperation.NodeType: TResultType;\r\nbegin\r\n  Result:=rtInteger;\r\nend;\r\n\r\nfunction TFPModuloOperation.GetNodeValue: TFPExpressionResult;\r\n\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  Result.resValue:=NativeInt(Result.resValue) mod NativeInt(RRes.resValue);\r\n  Result.ResultType:=rtInteger;\r\nend;\r\n\r\n{ TAggregateMax }\r\n\r\nprocedure TAggregateMax.InitAggregate;\r\nbegin\r\n  inherited InitAggregate;\r\n  FFirst:=True;\r\n  FResult.ResultType:=FArgumentNodes[0].NodeType;\r\n  Case FResult.ResultType of\r\n    rtFloat : FResult.resValue:=0.0;\r\n    rtCurrency : FResult.resValue:=0.0;\r\n    rtInteger : FResult.resValue:=0;\r\n  end;\r\nend;\r\n\r\nprocedure TAggregateMax.UpdateAggregate;\r\n\r\nVar\r\n  OK : Boolean;\r\n  N : TFPExpressionResult;\r\n\r\nbegin\r\n  N:=FArgumentNodes[0].GetNodeValue;\r\n  if FFirst then\r\n    begin\r\n    FResult.ResultType:=N.ResultType;\r\n    FFirst:=False;\r\n    OK:=True;\r\n    end\r\n  else\r\n    Case N.ResultType of\r\n      rtFloat: OK:=TExprFloat(N.resValue)>TExprFloat(FResult.resValue);\r\n      rtCurrency: OK:=Currency(N.resValue)>Currency(FResult.resValue);\r\n      rtinteger: OK:=NativeInt(N.resValue)>NativeInt(FResult.resValue);\r\n    end;\r\n  if OK then\r\n    Case N.ResultType of\r\n      rtFloat: FResult.resValue:=N.resValue;\r\n      rtinteger: FResult.resValue:=N.resValue;\r\n      rtCurrency: FResult.resValue:=N.resValue;\r\n    end;\r\nend;\r\n\r\n{ TAggregateMin }\r\n\r\nprocedure TAggregateMin.InitAggregate;\r\nbegin\r\n  inherited InitAggregate;\r\n  FFirst:=True;\r\n  FResult.ResultType:=FArgumentNodes[0].NodeType;\r\n  Case FResult.ResultType of\r\n    rtFloat : FResult.resValue:=0.0;\r\n    rtCurrency : FResult.resValue:=0.0;\r\n    rtInteger : FResult.resValue:=0;\r\n  end;\r\nend;\r\n\r\nprocedure TAggregateMin.UpdateAggregate;\r\n\r\nVar\r\n  OK : Boolean;\r\n  N : TFPExpressionResult;\r\n\r\nbegin\r\n  N:=FArgumentNodes[0].GetNodeValue;\r\n  if FFirst then\r\n    begin\r\n    FFirst:=False;\r\n    OK:=True;\r\n    end\r\n  else\r\n    Case N.ResultType of\r\n      rtFloat: OK:=TExprFloat(N.resValue)<TExprFloat(FResult.resValue);\r\n      rtCurrency: OK:=Currency(N.resValue)<Currency(FResult.resValue);\r\n      rtinteger: OK:=NativeInt(N.resValue)<NativeInt(FResult.resValue);\r\n    end;\r\n  if OK then\r\n    Case FResult.ResultType of\r\n      rtFloat: FResult.resValue:=N.resValue;\r\n      rtCurrency: FResult.resValue:=N.resValue;\r\n      rtinteger: FResult.resValue:=N.resValue;\r\n    end;\r\n  inherited UpdateAggregate;\r\nend;\r\n\r\n{ TAggregateAvg }\r\n\r\nprocedure TAggregateAvg.InitAggregate;\r\nbegin\r\n  inherited InitAggregate;\r\nend;\r\n\r\nprocedure TAggregateAvg.UpdateAggregate;\r\nbegin\r\n  inherited UpdateAggregate;\r\n  Inc(FCount);\r\nend;\r\n\r\nFunction TAggregateAvg.GetNodeValue: TFPExpressionResult;\r\nbegin\r\n  Result:=inherited GetNodeValue;\r\n  Result.ResultType:=FResult.ResultType;\r\n  if FCount=0 then\r\n    Case FResult.ResultType of\r\n      rtInteger:\r\n        begin\r\n        Result.ResultType:=rtFloat;\r\n        Result.resValue:=0.0;\r\n        end;\r\n      rtFloat:\r\n        Result.resValue:=0.0;\r\n      rtCurrency:\r\n        Result.resValue:=0.0;\r\n    end\r\n  else\r\n    Case FResult.ResultType of\r\n      rtInteger:\r\n        begin\r\n        Result.ResultType:=rtFloat;\r\n        Result.resValue:=NativeInt(FResult.resValue)/FCount;\r\n        end;\r\n      rtFloat:\r\n        Result.resValue:=TExprFloat(FResult.resValue)/FCount;\r\n      rtCurrency:\r\n        Result.resValue:=Currency(FResult.resValue)/FCount;\r\n    end;\r\nend;\r\n\r\n{ TAggregateCount }\r\n\r\nprocedure TAggregateCount.InitAggregate;\r\nbegin\r\n  FResult.ResultType:=rtInteger;\r\n  FResult.resValue:=0;\r\nend;\r\n\r\nprocedure TAggregateCount.UpdateAggregate;\r\nbegin\r\n  FResult.resValue:=NativeInt(FResult.resValue)+1;\r\nend;\r\n\r\n{ TAggregateExpr }\r\n\r\nclass function TAggregateExpr.IsAggregate: Boolean;\r\nbegin\r\n  Result:=True;\r\nend;\r\n\r\nFunction TAggregateExpr.GetNodeValue: TFPExpressionResult;\r\nbegin\r\n  Result:=FResult;\r\nend;\r\n\r\n{ TAggregateSum }\r\n\r\nfunction TAggregateSum.ConvertArgument(aIndex: Integer; aNode: TFPExprNode; aType: TResultType): TFPExprNode;\r\nbegin\r\n  if not (aNode.NodeType in [rtFloat,rtInteger,rtCurrency]) then\r\n    RaiseParserError(SErrInvalidArgumentType,[aIndex,ResultTypeName(aType),ResultTypeName(aNode.NodeType)]);\r\n  Result:=aNode;\r\nend;\r\n\r\nprocedure TAggregateSum.InitAggregate;\r\n\r\nbegin\r\n  FResult.ResultType:=FArgumentNodes[0].NodeType;\r\n  Case FResult.ResultType of\r\n    rtFloat: FResult.resValue:=0.0;\r\n    rtCurrency : FResult.resValue:=0.0;\r\n    rtinteger: FResult.resValue:=0;\r\n  end;\r\nend;\r\n\r\nprocedure TAggregateSum.UpdateAggregate;\r\n\r\nVar\r\n  R : TFPExpressionResult;\r\n\r\nbegin\r\n  R:=FArgumentNodes[0].GetNodeValue;\r\n  Case FResult.ResultType of\r\n    rtFloat: FResult.resValue:=TExprFloat(FResult.resValue)+TExprFloat(R.resValue);\r\n    rtCurrency: FResult.resValue:=Currency(FResult.resValue)+Currency(R.resValue);\r\n    rtinteger: FResult.resValue:=NativeInt(FResult.resValue)+NativeInt(R.resValue);\r\n  end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TFPExpressionScanner\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TFPExpressionScanner.IsAlpha(C: Char): Boolean;\r\nbegin\r\n  Result := C in ['A'..'Z', 'a'..'z'];\r\nend;\r\n\r\nconstructor TFPExpressionScanner.Create;\r\nbegin\r\n  Source:='';\r\nend;\r\n\r\n\r\nprocedure TFPExpressionScanner.SetSource(const AValue: String);\r\nbegin\r\n  FSource:=AValue;\r\n  LSource:=Length(FSource);\r\n  FTokenType:=ttEOF;\r\n  If LSource=0 then\r\n    begin\r\n    FPos:=0;\r\n    FChar:=cNull;\r\n    end\r\n  else\r\n    begin\r\n    FPos:=1;\r\n    FChar:=FSource[1];\r\n    end;\r\n  FToken:='';\r\nend;\r\n\r\nfunction TFPExpressionScanner.NextPos: Char;\r\nbegin\r\n  Inc(FPos);\r\n  if FPos>Length(FSource) then\r\n    FChar:=cNull\r\n  else\r\n    FChar:=FSource[FPos];\r\n  Result:=FChar;\r\nend;\r\n\r\n\r\nfunction TFPExpressionScanner.IsWordDelim(C: Char): Boolean;\r\nbegin\r\n  Result:=C in WordDelimiters;\r\nend;\r\n\r\nfunction TFPExpressionScanner.IsDelim(C: Char): Boolean;\r\nbegin\r\n  Result:=C in Delimiters;\r\nend;\r\n\r\nfunction TFPExpressionScanner.IsDigit(C: Char; AKind: TNumberKind): Boolean;\r\nbegin\r\n  case AKind of\r\n    nkDecimal: Result := C in Digits;\r\n    nkHex    : Result := C in HexDigits;\r\n    nkOctal  : Result := C in OctalDigits;\r\n    nkBinary : Result := C in BinaryDigits;\r\n  end;\r\nend;\r\n\r\nProcedure TFPExpressionScanner.SkipWhiteSpace;\r\n\r\nbegin\r\n  While (FChar in WhiteSpace) and (FPos<=LSource) do\r\n    NextPos;\r\nend;\r\n\r\nFunction TFPExpressionScanner.DoDelimiter : TTokenType;\r\n\r\nVar\r\n  B : Boolean;\r\n  C,D : Char;\r\n\r\nbegin\r\n  C:=FChar;\r\n  FToken:=C;\r\n  B:=C in ['<','>'];\r\n  D:=C;\r\n  C:=NextPos;\r\n\r\n  if B and (C in ['=','>']) then\r\n    begin\r\n    FToken:=FToken+C;\r\n    NextPos;\r\n    If (D='>') then\r\n      Result:=ttLargerThanEqual\r\n    else if (C='>') then\r\n      Result:=ttUnequal\r\n    else\r\n      Result:=ttLessThanEqual;\r\n    end\r\n  else\r\n    Case D of\r\n      '+' : Result := ttPlus;\r\n      '-' : Result := ttMinus;\r\n      '<' : Result := ttLessThan;\r\n      '>' : Result := ttLargerThan;\r\n      '=' : Result := ttEqual;\r\n      '/' : Result := ttDiv;\r\n      '*' : Result := ttMul;\r\n      '(' : Result := ttLeft;\r\n      ')' : Result := ttRight;\r\n      ',' : Result := ttComma;\r\n      '^' : Result := ttPower;\r\n    else\r\n      ScanError(Format(SUnknownDelimiter,[D]));\r\n    end;\r\n\r\nend;\r\n\r\nProcedure TFPExpressionScanner.ScanError(Msg : String);\r\n\r\nbegin\r\n  Raise EExprScanner.Create(Msg)\r\nend;\r\n\r\nFunction TFPExpressionScanner.DoString : TTokenType;\r\n\r\n  Function TerminatingChar(C : Char) : boolean;\r\n\r\n  begin\r\n    Result:=(C=cNull) or\r\n            ((C=cSingleQuote) and\r\n              Not ((FPos<LSource) and (FSource[FPos+1]=cSingleQuote)));\r\n  end;\r\n\r\n\r\nVar\r\n  C : Char;\r\n\r\nbegin\r\n  FToken := '';\r\n  C:=NextPos;\r\n  while not TerminatingChar(C) do\r\n    begin\r\n    FToken:=FToken+C;\r\n    If C=cSingleQuote then\r\n      NextPos;\r\n    C:=NextPos;\r\n    end;\r\n  if (C=cNull) then\r\n    ScanError(SBadQuotes);\r\n  Result := ttString;\r\n  FTokenType:=Result;\r\n  NextPos;\r\nend;\r\n\r\nfunction TFPExpressionScanner.GetCurrentChar: Char;\r\nbegin\r\n  Result:=FChar;\r\nend;\r\n\r\n{$ifndef pas2js}\r\nprocedure Val(const S: string; out V: TExprFloat; out Code: Integer); overload;\r\nvar\r\n  L64: NativeInt;\r\nbegin\r\n  if (S <> '') and (S[1] in ['&', '$', '%']) then\r\n  begin\r\n    System.Val(S, L64, Code);\r\n    if Code = 0 then\r\n      V := L64\r\n  end\r\n  else\r\n    System.Val(S, V, Code);\r\nend;\r\n{$endif}\r\n\r\nFunction TFPExpressionScanner.DoNumber(AKind: TNumberKind) : TTokenType;\r\n\r\nVar\r\n  C : Char;\r\n  X : TExprFloat;\r\n  I : Integer;\r\n  prevC: Char;\r\n\r\n  function ValidDigit(C: Char; AKind: TNumberKind): Boolean;\r\n  begin\r\n    Result := IsDigit(C, AKind);\r\n    if (not Result) then\r\n      case AKind of\r\n        nkDecimal:\r\n          Result := ((FToken <> '') and (UpCase(C)='E')) or\r\n                    ((FToken <> '') and (C in ['+','-']) and (prevC='E'));\r\n        nkHex:\r\n          Result := (C = cHexIdentifier) and (prevC = #0);\r\n        nkOctal:\r\n          Result := (C = cOctalIdentifier) and (prevC = #0);\r\n        nkBinary:\r\n          Result := (C = cBinaryIdentifier) and (prevC = #0);\r\n      end;\r\n  end;\r\n\r\nbegin\r\n  C:=CurrentChar;\r\n  prevC := #0;\r\n  while (C <> cNull) do\r\n  begin\r\n    if IsWordDelim(C) then\r\n      case AKind of\r\n        nkDecimal:\r\n          if not (prevC in ['E','-','+']) then break;\r\n        nkHex, nkOctal:\r\n          break;\r\n        nkBinary:\r\n          if (prevC <> #0) then break;   // allow '%' as first char\r\n      end;\r\n    if not ValidDigit(C, AKind) then\r\n      ScanError(Format(SErrInvalidNumberChar,[C]));\r\n    FToken := FToken+C;\r\n    prevC := Upcase(C);\r\n    C:=NextPos;\r\n    end;\r\n  Val(FToken,X,I);\r\n  If (I<>0) then\r\n    ScanError(Format(SErrInvalidNumber,[FToken]));\r\n  Result:=ttNumber;\r\nend;\r\n\r\nFunction TFPExpressionScanner.DoIdentifier : TTokenType;\r\n\r\nVar\r\n  C : Char;\r\n  S : String;\r\nbegin\r\n  C:=CurrentChar;\r\n  while (not IsWordDelim(C)) and (C<>cNull) do\r\n    begin\r\n    if (C<>'\"') then\r\n      FToken:=FToken+C\r\n    else\r\n      begin\r\n      C:=NextPos;\r\n      While Not (C in [cNull,'\"']) do\r\n        begin\r\n        FToken:=FToken+C;\r\n        C:=NextPos;\r\n        end;\r\n      if (C<>'\"') then\r\n        ScanError(Format(SErrUnterminatedIdentifier,[FToken]));\r\n      end;\r\n    C:=NextPos;\r\n    end;\r\n  S:=LowerCase(Token);\r\n  If (S='or') then\r\n    Result:=ttOr\r\n  else if (S='xor') then\r\n    Result:=ttXOr\r\n  else if (S='and') then\r\n    Result:=ttAnd\r\n  else if (S='true') then\r\n    Result:=ttTrue\r\n  else if (S='false') then\r\n    Result:=ttFalse\r\n  else if (S='not') then\r\n    Result:=ttnot\r\n  else if (S='if') then\r\n    Result:=ttif\r\n  else if (S='case') then\r\n    Result:=ttcase\r\n  else if (S='mod') then\r\n    Result:=ttMod\r\n  else\r\n    Result:=ttIdentifier;\r\nend;\r\n\r\nFunction TFPExpressionScanner.GetToken : TTokenType;\r\n\r\nVar\r\n  C : Char;\r\n\r\nbegin\r\n  FToken := '';\r\n  SkipWhiteSpace;\r\n  C:=FChar;\r\n  if c=cNull then\r\n    Result:=ttEOF\r\n  else if IsDelim(C) then\r\n    Result:=DoDelimiter\r\n  else if (C=cSingleQuote) then\r\n    Result:=DoString\r\n  else if (C=cHexIdentifier) then\r\n    Result := DoNumber(nkHex)\r\n  else if (C=cOctalIdentifier) then\r\n    Result := DoNumber(nkOctal)\r\n  else if (C=cBinaryIdentifier) then\r\n    Result := DoNumber(nkBinary)\r\n  else if IsDigit(C, nkDecimal) then\r\n    Result:=DoNumber(nkDecimal)\r\n  else if IsAlpha(C) or (C='\"') then\r\n    Result:=DoIdentifier\r\n  else\r\n    ScanError(Format(SErrUnknownCharacter,[FPos,C]))  ;\r\n  FTokenType:=Result;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TFPExpressionParser\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TFPExpressionParser.TokenType: TTokenType;\r\n\r\nbegin\r\n  Result:=FScanner.TokenType;\r\nend;\r\n\r\nfunction TFPExpressionParser.CurrentToken: String;\r\nbegin\r\n  Result:=FScanner.Token;\r\nend;\r\n\r\nprocedure TFPExpressionParser.CreateHashList;\r\n\r\nVar\r\n  ID : TFPExpridentifierDef;\r\n  BID : TFPBuiltinExpridentifierDef;\r\n  I  : Integer;\r\n  M : TExprBuiltinManager;\r\n\r\nbegin\r\n  FHashList.Clear;\r\n  // Builtins\r\n  M:=BuiltinsManager;\r\n  If (FBuiltins<>[]) and Assigned(M) then\r\n    For I:=0 to M.IdentifierCount-1 do\r\n      begin\r\n      BID:=M.Identifiers[I];\r\n      If BID.Category in FBuiltins then\r\n        FHashList.Add(LowerCase(BID.Name),BID);\r\n      end;\r\n  // User\r\n  For I:=0 to FIdentifiers.Count-1 do\r\n    begin\r\n    ID:=FIdentifiers[i];\r\n    FHashList.Add(LowerCase(ID.Name),ID);\r\n    end;\r\n  FDirty:=False;\r\nend;\r\n\r\nfunction TFPExpressionParser.IdentifierByName(const AName: string): TFPExprIdentifierDef;\r\nbegin\r\n  If FDirty then\r\n    CreateHashList;\r\n  Result:=TFPExprIdentifierDef(FHashList[LowerCase(AName)]);\r\nend;\r\n\r\nprocedure TFPExpressionParser.Clear;\r\nbegin\r\n  FExpression:='';\r\n  FHashList.Clear;\r\n  FExprNode.Free;\r\nend;\r\n\r\nclass function TFPExpressionParser.Evaluate(aExpression: String): TFPExpressionResult;\r\n\r\nVar\r\n  F : TFPExpressionParser;\r\n\r\nbegin\r\n  F:=TFPExpressionParser.Create(Nil);\r\n  try\r\n    F.Expression:=aExpression;\r\n    Result:=F.Evaluate;\r\n  finally\r\n    F.Free;\r\n  end;\r\nend;\r\n\r\nconstructor TFPExpressionParser.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  FIdentifiers:=TFPExprIdentifierDefs.Create(TFPExprIdentifierDef);\r\n  FIdentifiers.FParser:=Self;\r\n  FScanner:=TFPExpressionScanner.Create;\r\n  FHashList:=TFPObjectHashTable.Create(False);\r\nend;\r\n\r\ndestructor TFPExpressionParser.Destroy;\r\nbegin\r\n  FreeAndNil(FHashList);\r\n  FreeAndNil(FExprNode);\r\n  FreeAndNil(FIdentifiers);\r\n  FreeAndNil(FScanner);\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TFPExpressionParser.GetToken: TTokenType;\r\n\r\nbegin\r\n  Result:=FScanner.GetToken;\r\nend;\r\n\r\nprocedure TFPExpressionParser.CheckEOF;\r\n\r\nbegin\r\n  If (TokenType=ttEOF) then\r\n    ParserError(SErrUnexpectedEndOfExpression);\r\nend;\r\n\r\nprocedure TFPExpressionParser.SetIdentifiers(const AValue: TFPExprIdentifierDefs\r\n  );\r\nbegin\r\n  FIdentifiers.Assign(AValue)\r\nend;\r\n\r\nfunction TFPExpressionParser.Evaluate: TFPExpressionResult;\r\nbegin\r\n  If (FExpression='') then\r\n    ParserError(SErrInExpressionEmpty);\r\n  if not Assigned(FExprNode) then\r\n    ParserError(SErrInExpression);\r\n  Result:=FExprNode.GetNodeValue;\r\nend;\r\n\r\n\r\nprocedure TFPExpressionParser.EvaluateExpression(Out Result: TFPExpressionResult);\r\nbegin\r\n  Result:=Evaluate;\r\nend;\r\n\r\nfunction TFPExpressionParser.ExtractNode(Var N : TFPExprNode) : Boolean;\r\nbegin\r\n  Result:=Assigned(FExprNode);\r\n  if Result then\r\n    begin\r\n    N:=FExprNode;\r\n    FExprNode:=Nil;\r\n    FExpression:='';\r\n    end;\r\nend;\r\n\r\nprocedure TFPExpressionParser.ParserError(Msg: String);\r\nbegin\r\n  Raise EExprParser.Create(Msg);\r\nend;\r\n\r\nClass function TFPExpressionParser.ConvertNode(Todo : TFPExprNode; ToType : TResultType): TFPExprNode;\r\nbegin\r\n  Result:=ToDo;\r\n  Case ToDo.NodeType of\r\n    rtInteger :\r\n      Case ToType of\r\n        rtFloat    : Result:=TIntToFloatNode.Create(Result);\r\n        rtCurrency : Result:=TIntToCurrencyNode.Create(Result);\r\n        rtDateTime : Result:=TIntToDateTimeNode.Create(Result);\r\n      end;\r\n    rtFloat :\r\n      Case ToType of\r\n        rtCurrency : Result:=TFloatToCurrencyNode.Create(Result);\r\n        rtDateTime : Result:=TFloatToDateTimeNode.Create(Result);\r\n      end;\r\n    rtCurrency :\r\n      Case ToType of\r\n        rtFloat    : Result:=TCurrencyToFloatNode.Create(Result);\r\n        rtDateTime : Result:=TCurrencyToDateTimeNode.Create(Result);\r\n      end;\r\n  end;\r\nend;\r\n\r\nfunction TFPExpressionParser.GetAsBoolean: Boolean;\r\n\r\nvar\r\n  Res: TFPExpressionResult;\r\n\r\nbegin\r\n  EvaluateExpression(Res);\r\n  CheckResultType(Res,rtBoolean);\r\n  Result:=Boolean(Res.resValue);\r\nend;\r\n\r\nfunction TFPExpressionParser.GetAsDateTime: TDateTime;\r\nvar\r\n  Res: TFPExpressionResult;\r\n\r\nbegin\r\n  EvaluateExpression(Res);\r\n  CheckResultType(Res,rtDateTime);\r\n  Result:=TDateTime(Res.resValue);\r\nend;\r\n\r\nfunction TFPExpressionParser.GetAsFloat: TExprFloat;\r\n\r\nvar\r\n  Res: TFPExpressionResult;\r\n\r\nbegin\r\n  EvaluateExpression(Res);\r\n  CheckResultTypes(Res,[rtFloat,rtCurrency,rtInteger]);\r\n  case Res.ResultType of\r\n    rtInteger : Result:=NativeInt(Res.resValue);\r\n    rtFloat : Result:=TExprFloat(Res.resValue);\r\n    rtCurrency : Result:=Currency(res.resValue);\r\n  end;\r\nend;\r\n\r\nfunction TFPExpressionParser.GetAsCurrency: Currency;\r\nvar\r\n  Res: TFPExpressionResult;\r\n\r\nbegin\r\n  EvaluateExpression(Res);\r\n  CheckResultTypes(Res,[rtFloat,rtCurrency,rtInteger]);\r\n  case Res.ResultType of\r\n    rtInteger : Result:=NativeInt(Res.resValue);\r\n    rtFloat : Result:=TExprFloat(Res.resValue);\r\n    rtCurrency : Result:=Currency(res.resValue);\r\n  end;\r\nend;\r\n\r\nfunction TFPExpressionParser.GetAsInteger: NativeInt;\r\n\r\nvar\r\n  Res: TFPExpressionResult;\r\n\r\nbegin\r\n  EvaluateExpression(Res);\r\n  CheckResultType(Res,rtInteger);\r\n  Result:=NativeInt(Res.resValue);\r\nend;\r\n\r\nfunction TFPExpressionParser.GetAsString: String;\r\n\r\nvar\r\n  Res: TFPExpressionResult;\r\n\r\nbegin\r\n  EvaluateExpression(Res);\r\n  CheckResultType(Res,rtString);\r\n  Result:=String(Res.resValue);\r\nend;\r\n\r\n{\r\n  Checks types of todo and match. If ToDO can be converted to it matches\r\n  the type of match, then a node is inserted.\r\n  For binary operations, this function is called for both operands.\r\n}\r\n\r\nfunction TFPExpressionParser.MatchNodes(Todo,Match : TFPExprNode): TFPExprNode;\r\n\r\nVar\r\n  FromType,ToType : TResultType;\r\n\r\nbegin\r\n  Result:=Todo;\r\n  FromType:=Todo.NodeType;\r\n  ToType:=Match.NodeType;\r\n  If (FromType<>ToType) then\r\n    Case FromType of\r\n    rtInteger:\r\n      if (ToType in [rtFloat,rtCurrency,rtDateTime]) then\r\n        Result:=ConvertNode(Todo,toType);\r\n    rtFloat:\r\n      if (ToType in [rtCurrency,rtDateTime]) then\r\n        Result:=ConvertNode(Todo,toType);\r\n    rtCurrency:\r\n      if (ToType in [rtFloat,rtDateTime]) then\r\n        Result:=ConvertNode(Todo,toType);\r\n    end;\r\nend;\r\n\r\n{\r\n  if the result types differ, they are converted to a common type if possible.\r\n}\r\n\r\nprocedure TFPExpressionParser.CheckNodes(var Left, Right: TFPExprNode);\r\n\r\nbegin\r\n  Left:=MatchNodes(Left,Right);\r\n  Right:=MatchNodes(Right,Left);\r\nend;\r\n\r\nprocedure TFPExpressionParser.SetBuiltIns(const AValue: TBuiltInCategories);\r\nbegin\r\n  if FBuiltIns=AValue then exit;\r\n  FBuiltIns:=AValue;\r\n  FDirty:=True;\r\nend;\r\n\r\nfunction TFPExpressionParser.Level1: TFPExprNode;\r\n\r\nvar\r\n  tt: TTokenType;\r\n  Right : TFPExprNode;\r\n\r\nbegin\r\n{$ifdef debugexpr}Writeln('Level 1 ',TokenName(TokenType),': ',CurrentToken);{$endif debugexpr}\r\n  if TokenType = ttNot then\r\n    begin\r\n    GetToken;\r\n    CheckEOF;\r\n    Right:=Level2;\r\n    Result:=TFPNotNode.Create(Right);\r\n    end\r\n  else\r\n    Result:=Level2;\r\n  Try\r\n    while (TokenType in [ttAnd,ttOr,ttXor]) do\r\n      begin\r\n      tt:=TokenType;\r\n      GetToken;\r\n      CheckEOF;\r\n      Right:=Level2;\r\n      Case tt of\r\n        ttOr  : Result:=TFPBinaryOrOperation.Create(Result,Right);\r\n        ttAnd : Result:=TFPBinaryAndOperation.Create(Result,Right);\r\n        ttXor : Result:=TFPBinaryXorOperation.Create(Result,Right);\r\n      Else\r\n        ParserError(SErrUnknownBooleanOp)\r\n      end;\r\n      end;\r\n  Except\r\n    Result.Free;\r\n    Raise;\r\n  end;\r\nend;\r\n\r\nfunction TFPExpressionParser.Level2: TFPExprNode;\r\n\r\nvar\r\n  Right : TFPExprNode;\r\n  tt : TTokenType;\r\n  C : TFPBinaryOperationClass;\r\n\r\nbegin\r\n{$ifdef debugexpr}  Writeln('Level 2 ',TokenName(TokenType),': ',CurrentToken);{$endif debugexpr}\r\n  Result:=Level3;\r\n  try\r\n    if (TokenType in ttComparisons) then\r\n      begin\r\n      tt:=TokenType;\r\n      GetToken;\r\n      CheckEOF;\r\n      Right:=Level3;\r\n      CheckNodes(Result,Right);\r\n      Case tt of\r\n        ttLessthan         : C:=TFPLessThanOperation;\r\n        ttLessthanEqual    : C:=TFPLessThanEqualOperation;\r\n        ttLargerThan       : C:=TFPGreaterThanOperation;\r\n        ttLargerThanEqual  : C:=TFPGreaterThanEqualOperation;\r\n        ttEqual            : C:=TFPEqualOperation;\r\n        ttUnequal          : C:=TFPUnequalOperation;\r\n      Else\r\n        ParserError(SErrUnknownComparison)\r\n      end;\r\n      Result:=C.Create(Result,Right);\r\n      end;\r\n  Except\r\n    Result.Free;\r\n    Raise;\r\n  end;\r\nend;\r\n\r\nfunction TFPExpressionParser.Level3: TFPExprNode;\r\n\r\nvar\r\n  tt : TTokenType;\r\n  right : TFPExprNode;\r\n\r\nbegin\r\n{$ifdef debugexpr}  Writeln('Level 3 ',TokenName(TokenType),': ',CurrentToken);{$endif debugexpr}\r\n  Result:=Level4;\r\n  try\r\n    while TokenType in [ttPlus,ttMinus] do\r\n      begin\r\n      tt:=TokenType;\r\n      GetToken;\r\n      CheckEOF;\r\n      Right:=Level4;\r\n      CheckNodes(Result,Right);\r\n      Case tt of\r\n        ttPlus  : Result:=TFPAddOperation.Create(Result,Right);\r\n        ttMinus : Result:=TFPSubtractOperation.Create(Result,Right);\r\n      end;\r\n      end;\r\n  Except\r\n    Result.Free;\r\n    Raise;\r\n  end;\r\nend;\r\n\r\n\r\n\r\n\r\nfunction TFPExpressionParser.Level4: TFPExprNode;\r\n\r\nvar\r\n  tt : TTokenType;\r\n  right : TFPExprNode;\r\n\r\nbegin\r\n{$ifdef debugexpr}  Writeln('Level 4 ',TokenName(TokenType),': ',CurrentToken);{$endif debugexpr}\r\n  Result:=Level5;\r\n  try\r\n    while (TokenType in [ttMul,ttDiv,ttMod]) do\r\n      begin\r\n      tt:=TokenType;\r\n      GetToken;\r\n      Right:=Level5;\r\n      CheckNodes(Result,Right);\r\n      Case tt of\r\n        ttMul : Result:=TFPMultiplyOperation.Create(Result,Right);\r\n        ttDiv : Result:=TFPDivideOperation.Create(Result,Right);\r\n        ttMod : Result:=TFPModuloOperation.Create(Result,Right);\r\n      end;\r\n      end;\r\n  Except\r\n    Result.Free;\r\n    Raise;\r\n  end;\r\nend;\r\n\r\nfunction TFPExpressionParser.Level5: TFPExprNode;\r\n\r\nVar\r\n  B : Boolean;\r\n\r\nbegin\r\n{$ifdef debugexpr}  Writeln('Level 5 ',TokenName(TokenType),': ',CurrentToken);{$endif debugexpr}\r\n  B:=False;\r\n  if (TokenType in [ttPlus,ttMinus]) then\r\n    begin\r\n    B:=TokenType=ttMinus;\r\n    GetToken;\r\n    end;\r\n  Result:=Level6;\r\n  If B then\r\n    Result:=TFPNegateOperation.Create(Result);\r\nend;\r\n\r\nfunction TFPExpressionParser.Level6: TFPExprNode;\r\nvar\r\n  right: TFPExprNode;\r\nbegin\r\n{$ifdef debugexpr} Writeln('Level 6 ',TokenName(TokenType),': ',CurrentToken);{$endif debugexpr}\r\n  Result := Level7;\r\n  try\r\n    while (TokenType = ttPower) do\r\n    begin\r\n      GetToken;\r\n      right := Level5;           // Accept '(', unary '+', '-' as next tokens\r\n      CheckNodes(Result, right);\r\n      Result := TFPPowerOperation.Create(Result, right);\r\n    end;\r\n  except\r\n    Result.Free;\r\n    Raise;\r\n  end;\r\nend;\r\n\r\nfunction TFPExpressionParser.Level7: TFPExprNode;\r\nbegin\r\n{$ifdef debugexpr}  Writeln('Level 7 ',TokenName(TokenType),': ',CurrentToken);{$endif debugexpr}\r\n  if (TokenType=ttLeft) then\r\n    begin\r\n    GetToken;\r\n    Result:=Level1;\r\n    try\r\n      if (TokenType<>ttRight) then\r\n        ParserError(Format(SErrBracketExpected,[SCanner.Pos,CurrentToken]));\r\n      GetToken;\r\n    Except\r\n      Result.Free;\r\n      Raise;\r\n    end;\r\n    end\r\n  else\r\n    Result:=Primitive;\r\nend;\r\n\r\nfunction TFPExpressionParser.Primitive: TFPExprNode;\r\n\r\nVar\r\n  I : NativeInt;\r\n  C : Integer;\r\n  X : TExprFloat;\r\n  ACount : Integer;\r\n  IFF : Boolean;\r\n  IFC : Boolean;\r\n  ID : TFPExprIdentifierDef;\r\n  Args : TExprArgumentArray;\r\n  AI : Integer;\r\n\r\nbegin\r\n{$ifdef debugexpr}  Writeln('Primitive : ',TokenName(TokenType),': ',CurrentToken);{$endif debugexpr}\r\n  SetLength(Args,0);\r\n  if (TokenType=ttNumber) then\r\n    begin\r\n    if TryStrToInt64(CurrentToken,I) then\r\n      Result:=TFPConstExpression.CreateInteger(I)\r\n    else\r\n      begin\r\n      Val(CurrentToken,X,C);\r\n      If (C=0) then\r\n        Result:=TFPConstExpression.CreateFloat(X)\r\n      else\r\n        ParserError(Format(SErrInvalidFloat,[CurrentToken]));\r\n      end;\r\n    end\r\n  else if (TokenType=ttString) then\r\n    Result:=TFPConstExpression.CreateString(CurrentToken)\r\n  else if (TokenType in [ttTrue,ttFalse]) then\r\n    Result:=TFPConstExpression.CreateBoolean(TokenType=ttTrue)\r\n  else if Not (TokenType in [ttIdentifier,ttIf,ttcase]) then\r\n    ParserError(Format(SerrUnknownTokenAtPos,[Scanner.Pos,CurrentToken]))\r\n  else\r\n    begin\r\n    IFF:=TokenType=ttIf;\r\n    IFC:=TokenType=ttCase;\r\n    if Not (IFF or IFC) then\r\n      begin\r\n      ID:=self.IdentifierByName(CurrentToken);\r\n      If (ID=Nil) then\r\n        ParserError(Format(SErrUnknownIdentifier,[CurrentToken]))\r\n      end;\r\n    // Determine number of arguments\r\n    if Iff then\r\n      ACount:=3\r\n    else if IfC then\r\n      ACount:=-4\r\n    else if (ID.IdentifierType in [itFunctionHandler,itFunctionNode]) then\r\n      ACount:=ID.ArgumentCount\r\n    else\r\n      ACount:=0;\r\n    // Parse arguments.\r\n    // Negative is for variable number of arguments, where Abs(value) is the minimum number of arguments\r\n    If (ACount<>0) then\r\n      begin\r\n      GetToken;\r\n      If (TokenType<>ttLeft) then\r\n         ParserError(Format(SErrLeftBracketExpected,[Scanner.Pos,CurrentToken]));\r\n      SetLength(Args,Abs(ACount));\r\n      AI:=0;\r\n      Try\r\n        Repeat\r\n          GetToken;\r\n          // Check if we must enlarge the argument array\r\n          If (ACount<0) and (AI=Length(Args)) then\r\n            begin\r\n            SetLength(Args,AI+1);\r\n            Args[AI]:=Nil;\r\n            end;\r\n          Args[AI]:=Level1;\r\n          Inc(AI);\r\n          If (TokenType<>ttComma) then\r\n            If (AI<Abs(ACount)) then\r\n              ParserError(Format(SErrCommaExpected,[Scanner.Pos,CurrentToken]))\r\n        Until (AI=ACount) or ((ACount<0) and (TokenType=ttRight));\r\n        If TokenType<>ttRight then\r\n          ParserError(Format(SErrBracketExpected,[Scanner.Pos,CurrentToken]));\r\n      except\r\n        On E : Exception do\r\n          begin\r\n          Dec(AI);\r\n          While (AI>=0) do\r\n            begin\r\n            FreeAndNil(Args[Ai]);\r\n            Dec(AI);\r\n            end;\r\n          Raise;\r\n          end;\r\n      end;\r\n      end;\r\n    If Iff then\r\n      Result:=TIfOperation.Create(Args[0],Args[1],Args[2])\r\n    else If IfC then\r\n      Result:=TCaseOperation.Create(Args)\r\n    else\r\n      Case ID.IdentifierType of\r\n        itVariable         : Result:= TFPExprVariable.CreateIdentifier(ID);\r\n        itFunctionHandler  : Result:= TFPFunctionEventHandler.CreateFunction(ID,Args);\r\n        itFunctionNode     : Result:= ID.NodeType.CreateFunction(ID,Args);\r\n      end;\r\n    end;\r\n  GetToken;\r\nend;\r\n\r\n\r\nprocedure TFPExpressionParser.SetExpression(const AValue: String);\r\nbegin\r\n  if FExpression=AValue then exit;\r\n  FExpression:=AValue;\r\n  FScanner.Source:=AValue;\r\n  If Assigned(FExprNode) then\r\n    FreeAndNil(FExprNode);\r\n  If (FExpression<>'') then\r\n    begin\r\n    GetToken;\r\n    FExprNode:=Level1;\r\n    If (TokenType<>ttEOF) then\r\n      ParserError(Format(SErrUnterminatedExpression,[Scanner.Pos,CurrentToken]));\r\n    FExprNode.Check;\r\n    end\r\n  else\r\n    FExprNode:=Nil;\r\nend;\r\n\r\nprocedure TFPExpressionParser.CheckResultType(const Res: TFPExpressionResult;\r\n  AType: TResultType); inline;\r\nbegin\r\n  If (Res.ResultType<>AType) then\r\n    RaiseParserError(SErrInvalidResultType,[ResultTypeName(Res.ResultType)]);\r\nend;\r\n\r\nprocedure TFPExpressionParser.CheckResultTypes(const Res: TFPExpressionResult; ATypes: TResultTypes);\r\nbegin\r\n  If Not (Res.ResultType in ATypes) then\r\n    RaiseParserError(SErrInvalidResultType,[ResultTypeName(Res.ResultType)]);\r\nend;\r\n\r\nclass function TFPExpressionParser.BuiltinsManager: TExprBuiltInManager;\r\nbegin\r\n  Result:=BuiltinIdentifiers;\r\nend;\r\n\r\n\r\n\r\nfunction TFPExpressionParser.ResultType: TResultType;\r\nbegin\r\n  if not Assigned(FExprNode) then\r\n    ParserError(SErrInExpression);\r\n  Result:=FExprNode.NodeType;\r\nend;\r\n\r\nfunction TFPExpressionParser.HasAggregate: Boolean;\r\nbegin\r\n  Result:=Assigned(FExprNode) and FExprNode.HasAggregate;\r\nend;\r\n\r\nprocedure TFPExpressionParser.InitAggregate;\r\nbegin\r\n  If Assigned(FExprNode) then\r\n    FExprNode.InitAggregate;\r\nend;\r\n\r\nprocedure TFPExpressionParser.UpdateAggregate;\r\nbegin\r\n  If Assigned(FExprNode) then\r\n    FExprNode.UpdateAggregate;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TFPExprIdentifierDefs\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TFPExprIdentifierDefs.GetI(AIndex : Integer): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=TFPExprIdentifierDef(Items[AIndex]);\r\nend;\r\n\r\nprocedure TFPExprIdentifierDefs.SetI(AIndex : Integer;\r\n  const AValue: TFPExprIdentifierDef);\r\nbegin\r\n  Items[AIndex]:=AValue;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDefs.Update(Item: TCollectionItem);\r\nbegin\r\n  Inherited Update(Item);\r\n  If Assigned(FParser) then\r\n    FParser.FDirty:=True;\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.IndexOfIdentifier(const AName: string\r\n  ): Integer;\r\nbegin\r\n  Result:=Count-1;\r\n  While (Result>=0) And (CompareText(GetI(Result).Name,AName)<>0) do\r\n    Dec(Result);\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.FindIdentifier(const AName: string\r\n  ): TFPExprIdentifierDef;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  I:=IndexOfIdentifier(AName);\r\n  If (I=-1) then\r\n    Result:=Nil\r\n  else\r\n    Result:=GetI(I);\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.IdentifierByName(const AName: string\r\n  ): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=FindIdentifier(AName);\r\n  if (Result=Nil) then\r\n    RaiseParserError(SErrUnknownIdentifier,[AName]);\r\nend;\r\n\r\n\r\nfunction TFPExprIdentifierDefs.AddVariable(const AName: string;\r\n  AResultType: TResultType; ACallback: TFPExprVariableEvent\r\n  ): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.IdentifierType:=itVariable;\r\n  Result.Name:=AName;\r\n  Result.ResultType:=AResultType;\r\n  Result.OnGetVariableValue:=ACallBack\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.AddVariable(const AName: string;\r\n  AResultType: TResultType; AValue: String): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.IdentifierType:=itVariable;\r\n  Result.Name:=AName;\r\n  Result.ResultType:=AResultType;\r\n  Result.Value:=AValue;\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.AddBooleanVariable(const AName: string;\r\n  AValue: Boolean): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.IdentifierType:=itVariable;\r\n  Result.Name:=AName;\r\n  Result.ResultType:=rtBoolean;\r\n  Result.FValue.resValue:=AValue;\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.AddIntegerVariable(const AName: string;\r\n  AValue: Integer): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.IdentifierType:=itVariable;\r\n  Result.Name:=AName;\r\n  Result.ResultType:=rtInteger;\r\n  Result.FValue.resValue:=AValue;\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.AddFloatVariable(const AName: string;\r\n  AValue: TExprFloat): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.IdentifierType:=itVariable;\r\n  Result.Name:=AName;\r\n  Result.ResultType:=rtFloat;\r\n  Result.FValue.resValue:=AValue;\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.AddCurrencyVariable(const AName: string; AValue: Currency): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.IdentifierType:=itVariable;\r\n  Result.Name:=AName;\r\n  Result.ResultType:=rtCurrency;\r\n  Result.FValue.resValue:=AValue;\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.AddStringVariable(const AName: string;\r\n  AValue: String): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.IdentifierType:=itVariable;\r\n  Result.Name:=AName;\r\n  Result.ResultType:=rtString;\r\n  Result.FValue.resValue:=AValue;\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.AddDateTimeVariable(const AName: string;\r\n  AValue: TDateTime): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.IdentifierType:=itVariable;\r\n  Result.Name:=AName;\r\n  Result.ResultType:=rtDateTime;\r\n  Result.FValue.resValue:=AValue;\r\nend;\r\n\r\n\r\nfunction TFPExprIdentifierDefs.AddFunction(const AName: string;\r\n  const AResultType: Char; const AParamTypes: String;\r\n  ACallBack: TFPExprFunctionEvent): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.Name:=Aname;\r\n  Result.IdentifierType:=itFunctionHandler;\r\n  Result.ParameterTypes:=AParamTypes;\r\n  Result.ResultType:=CharToResultType(AResultType);\r\n  Result.FOnGetValue:=ACallBack;\r\nend;\r\n\r\nfunction TFPExprIdentifierDefs.AddFunction(const AName: string;\r\n  const AResultType: Char; const AParamTypes: String;\r\n  ANodeClass: TFPExprFunctionClass): TFPExprIdentifierDef;\r\nbegin\r\n  Result:=Add as TFPExprIdentifierDef;\r\n  Result.Name:=Aname;\r\n  Result.IdentifierType:=itFunctionNode;\r\n  Result.ParameterTypes:=AParamTypes;\r\n  Result.ResultType:=CharToResultType(AResultType);\r\n  Result.FNodeType:=ANodeClass;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TFPExprIdentifierDef\r\n  ---------------------------------------------------------------------}\r\n\r\nprocedure TFPExprIdentifierDef.SetName(const AValue: string);\r\nbegin\r\n  if FName=AValue then exit;\r\n  If (AValue<>'') then\r\n    If Assigned(Collection) and (TFPExprIdentifierDefs(Collection).IndexOfIdentifier(AValue)<>-1) then\r\n      RaiseParserError(SErrDuplicateIdentifier,[AValue]);\r\n  FName:=AValue;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.SetResultType(const AValue: TResultType);\r\n\r\nbegin\r\n  If AValue<>FValue.ResultType then\r\n    begin\r\n    FValue.ResultType:=AValue;\r\n    SetValue(FStringValue);\r\n    end;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.SetValue(const AValue: String);\r\nbegin\r\n  FStringValue:=AValue;\r\n  If (AValue<>'') then\r\n    Case FValue.ResultType of\r\n      rtBoolean  : FValue.resValue:=FStringValue='True';\r\n      rtInteger  : FValue.resValue:=StrToInt(AValue);\r\n      rtFloat    : FValue.resValue:=StrToFloat(AValue);\r\n      rtCurrency : FValue.resValue:=StrToCurr(AValue);\r\n      rtDateTime : FValue.resValue:=StrToDateTime(AValue);\r\n      rtString   : FValue.resValue:=AValue;\r\n    end\r\n  else\r\n    Case FValue.ResultType of\r\n      rtBoolean  : FValue.resValue:=False;\r\n      rtInteger  : FValue.resValue:=0;\r\n      rtFloat    : FValue.resValue:=0.0;\r\n      rtCurrency : FValue.resValue:=0.0;\r\n      rtDateTime : FValue.resValue:=0;\r\n      rtString   : FValue.resValue:='';\r\n    end\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.CheckResultType(const AType: TResultType);\r\nbegin\r\n  If FValue.ResultType<>AType then\r\n    RaiseParserError(SErrInvalidResultType,[ResultTypeName(AType)])\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.CheckVariable;\r\nbegin\r\n  If Identifiertype<>itvariable then\r\n    RaiseParserError(SErrNotVariable,[Name]);\r\n  if EventBasedVariable then\r\n    FetchValue;\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.ArgumentCount: Integer;\r\nbegin\r\n  Result:=Length(FArgumentTypes);\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.Assign(Source: TPersistent);\r\n\r\nVar\r\n  EID : TFPExprIdentifierDef;\r\n\r\nbegin\r\n  if (Source is TFPExprIdentifierDef) then\r\n    begin\r\n    EID:=Source as TFPExprIdentifierDef;\r\n    FStringValue:=EID.FStringValue;\r\n    FValue:=EID.FValue;\r\n    FArgumentTypes:=EID.FArgumentTypes;\r\n    FIDType:=EID.FIDType;\r\n    FName:=EID.FName;\r\n    FOnGetValue:=EID.FOnGetValue;\r\n    FOnGetVarValue:=EID.FOnGetVarValue;\r\n    end\r\n  else\r\n    inherited Assign(Source);\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.SetArgumentTypes(const AValue: String);\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  if FArgumentTypes=AValue then exit;\r\n  For I:=1 to Length(AValue) do\r\n    CharToResultType(AValue[i]);\r\n  FArgumentTypes:=AValue;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.SetAsBoolean(const AValue: Boolean);\r\nbegin\r\n  CheckVariable;\r\n  CheckResultType(rtBoolean);\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.SetAsDateTime(const AValue: TDateTime);\r\nbegin\r\n  CheckVariable;\r\n  CheckResultType(rtDateTime);\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.SetAsFloat(const AValue: TExprFloat);\r\nbegin\r\n  CheckVariable;\r\n  CheckResultType(rtFloat);\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.SetAsCurrency(const AValue: Currency);\r\nbegin\r\n  CheckVariable;\r\n  CheckResultType(rtCurrency);\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.SetAsInteger(const AValue: NativeInt);\r\nbegin\r\n  CheckVariable;\r\n  CheckResultType(rtInteger);\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.SetAsString(const AValue: String);\r\nbegin\r\n  CheckVariable;\r\n  CheckResultType(rtString);\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.GetValue: String;\r\nbegin\r\n  Case FValue.ResultType of\r\n    rtBoolean  : If FValue.resValue then\r\n                   Result:='True'\r\n                 else\r\n                   Result:='False';\r\n    rtInteger  : Result:=IntToStr(NativeInt(FValue.resValue));\r\n    rtFloat    : Result:=FloatToStr(TExprFloat(FValue.resValue));\r\n    rtCurrency : Result:=CurrToStr(Currency(FValue.resValue));\r\n    rtDateTime : Result:=FormatDateTime('cccc',TExprFloat(FValue.resValue));\r\n    rtString   : Result:=String(FValue.resValue);\r\n  end;\r\nend;\r\n\r\nprocedure TFPExprIdentifierDef.FetchValue;\r\n\r\nVar\r\n  RT,RT2 : TResultType;\r\n  I : Integer;\r\n\r\nbegin\r\n  RT:=ResultType;\r\n  if Assigned(FOnGetVarValue) then\r\n    FValue:=FOnGetVarValue(FName);\r\n  RT2:=FValue.ResultType;\r\n  if RT2<>RT then\r\n    begin\r\n    // Automatically convert integer to float.\r\n    if (rt2=rtInteger) and (rt=rtFloat) then\r\n      begin\r\n      FValue.ResultType:=RT;\r\n      I:=NativeInt(FValue.resValue);\r\n      FValue.resValue:=I;\r\n      end\r\n    else\r\n      begin\r\n      // Restore\r\n      FValue.ResultType:=RT;\r\n      Raise EExprParser.CreateFmt('Value handler for variable %s returned wrong type, expected \"%s\", got \"%s\"',[\r\n        FName,\r\n        GetEnumName(TypeInfo(TResultType),Ord(rt)),\r\n        GetEnumName(TypeInfo(TResultType),Ord(rt2))\r\n        ]);\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.EventBasedVariable: Boolean;\r\nbegin\r\n  Result:=Assigned(FOnGetVarValue);\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.GetResultType: TResultType;\r\nbegin\r\n  Result:=FValue.ResultType;\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.GetAsFloat: TExprFloat;\r\nbegin\r\n  CheckResultType(rtFloat);\r\n  CheckVariable;\r\n  Result:=TExprFloat(FValue.resValue);\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.GetAsCurrency: Currency;\r\nbegin\r\n  CheckResultType(rtCurrency);\r\n  CheckVariable;\r\n  Result:=Currency(FValue.resValue);\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.GetAsBoolean: Boolean;\r\nbegin\r\n  CheckResultType(rtBoolean);\r\n  CheckVariable;\r\n  Result:=Boolean(FValue.resValue);\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.GetAsDateTime: TDateTime;\r\nbegin\r\n  CheckResultType(rtDateTime);\r\n  CheckVariable;\r\n  Result:=TDateTime(FValue.resValue);\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.GetAsInteger: NativeInt;\r\nbegin\r\n  CheckResultType(rtInteger);\r\n  CheckVariable;\r\n  Result:=NativeInt(FValue.resValue);\r\nend;\r\n\r\nfunction TFPExprIdentifierDef.GetAsString: String;\r\nbegin\r\n  CheckResultType(rtString);\r\n  CheckVariable;\r\n  Result:=String(FValue.resValue);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TExprBuiltInManager\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TExprBuiltInManager.GetCount: Integer;\r\nbegin\r\n  Result:=FDefs.Count;\r\nend;\r\n\r\nfunction TExprBuiltInManager.GetI(AIndex : Integer\r\n  ): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs[Aindex])\r\nend;\r\n\r\nconstructor TExprBuiltInManager.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  FDefs:=TFPExprIdentifierDefs.Create(TFPBuiltInExprIdentifierDef)\r\nend;\r\n\r\ndestructor TExprBuiltInManager.Destroy;\r\nbegin\r\n  FreeAndNil(FDefs);\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TExprBuiltInManager.IndexOfIdentifier(const AName: string\r\n  ): Integer;\r\nbegin\r\n  Result:=FDefs.IndexOfIdentifier(AName);\r\nend;\r\n\r\nfunction TExprBuiltInManager.FindIdentifier(const AName: string\r\n  ): TFPBuiltinExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltinExprIdentifierDef(FDefs.FindIdentifier(AName));\r\nend;\r\n\r\nfunction TExprBuiltInManager.IdentifierByName(const AName: string\r\n  ): TFPBuiltinExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltinExprIdentifierDef(FDefs.IdentifierByName(AName));\r\nend;\r\n\r\nfunction TExprBuiltInManager.AddVariable(const ACategory: TBuiltInCategory;\r\n  const AName: string; AResultType: TResultType; AValue: String\r\n  ): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs.Addvariable(AName,AResultType,AValue));\r\n  Result.Category:=ACategory;\r\nend;\r\n\r\nfunction TExprBuiltInManager.AddBooleanVariable(\r\n  const ACategory: TBuiltInCategory; const AName: string; AValue: Boolean\r\n  ): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs.AddBooleanvariable(AName,AValue));\r\n  Result.Category:=ACategory;\r\nend;\r\n\r\nfunction TExprBuiltInManager.AddIntegerVariable(\r\n  const ACategory: TBuiltInCategory; const AName: string; AValue: Integer\r\n  ): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs.AddIntegerVariable(AName,AValue));\r\n  Result.Category:=ACategory;\r\nend;\r\n\r\nfunction TExprBuiltInManager.AddFloatVariable(\r\n  const ACategory: TBuiltInCategory; const AName: string;\r\n  AValue: TExprFloat): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs.AddFloatVariable(AName,AValue));\r\n  Result.Category:=ACategory;\r\nend;\r\n\r\nfunction TExprBuiltInManager.AddCurrencyVariable(const ACategory: TBuiltInCategory; const AName: string; AValue: Currency\r\n  ): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs.AddCurrencyVariable(AName,AValue));\r\n  Result.Category:=ACategory;\r\nend;\r\n\r\nfunction TExprBuiltInManager.AddStringVariable(\r\n  const ACategory: TBuiltInCategory; const AName: string; AValue: String\r\n  ): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs.AddStringVariable(AName,AValue));\r\n  Result.Category:=ACategory;\r\nend;\r\n\r\nfunction TExprBuiltInManager.AddDateTimeVariable(\r\n  const ACategory: TBuiltInCategory; const AName: string; AValue: TDateTime\r\n  ): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs.AddDateTimeVariable(AName,AValue));\r\n  Result.Category:=ACategory;\r\nend;\r\n\r\n\r\nfunction TExprBuiltInManager.AddFunction(const ACategory: TBuiltInCategory;\r\n  const AName: string; const AResultType: Char; const AParamTypes: String;\r\n  ACallBack: TFPExprFunctionEvent): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs.AddFunction(AName,AResultType,AParamTypes,ACallBack));\r\n  Result.Category:=ACategory;\r\nend;\r\n\r\nfunction TExprBuiltInManager.AddFunction(const ACategory: TBuiltInCategory;\r\n  const AName: string; const AResultType: Char; const AParamTypes: String;\r\n  ANodeClass: TFPExprFunctionClass): TFPBuiltInExprIdentifierDef;\r\nbegin\r\n  Result:=TFPBuiltInExprIdentifierDef(FDefs.AddFunction(AName,AResultType,AParamTypes,ANodeClass));\r\n  Result. Category:=ACategory;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n  Various Nodes\r\n  ---------------------------------------------------------------------}\r\n\r\n{ TFPBinaryOperation }\r\n\r\nprocedure TFPBinaryOperation.CheckSameNodeTypes;\r\n\r\nVar\r\n  LT,RT : TResultType;\r\n\r\n\r\nbegin\r\n  LT:=Left.NodeType;\r\n  RT:=Right.NodeType;\r\n  if (RT<>LT) then\r\n    RaiseParserError(SErrTypesDoNotMatch,[ResultTypeName(LT),ResultTypeName(RT),Left.AsString,Right.AsString])\r\nend;\r\n\r\nconstructor TFPBinaryOperation.Create(ALeft, ARight: TFPExprNode);\r\nbegin\r\n  FLeft:=ALeft;\r\n  FRight:=ARight;\r\nend;\r\n\r\ndestructor TFPBinaryOperation.Destroy;\r\nbegin\r\n  FreeAndNil(FLeft);\r\n  FreeAndNil(FRight);\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TFPBinaryOperation.InitAggregate;\r\nbegin\r\n  inherited InitAggregate;\r\n  if Assigned(Left) then\r\n    Left.InitAggregate;\r\n  if Assigned(Right) then\r\n    Right.InitAggregate;\r\nend;\r\n\r\nprocedure TFPBinaryOperation.UpdateAggregate;\r\nbegin\r\n  inherited UpdateAggregate;\r\n  if Assigned(Left) then\r\n    Left.UpdateAggregate;\r\n  if Assigned(Right) then\r\n    Right.UpdateAggregate;\r\nend;\r\n\r\nfunction TFPBinaryOperation.HasAggregate: Boolean;\r\nbegin\r\n  Result:=inherited HasAggregate;\r\n  if Assigned(Left) then\r\n    Result:=Result or Left.HasAggregate;\r\n  if Assigned(Right) then\r\n    Result:=Result or Right.HasAggregate;\r\nend;\r\n\r\nprocedure TFPBinaryOperation.Check;\r\nbegin\r\n  If Not Assigned(Left) then\r\n    RaiseParserError(SErrNoLeftOperand,[classname]);\r\n  If Not Assigned(Right) then\r\n    RaiseParserError(SErrNoRightOperand,[classname]);\r\nend;\r\n\r\n{ TFPUnaryOperator }\r\n\r\nconstructor TFPUnaryOperator.Create(AOperand: TFPExprNode);\r\nbegin\r\n  FOperand:=AOperand;\r\nend;\r\n\r\ndestructor TFPUnaryOperator.Destroy;\r\nbegin\r\n  FreeAndNil(FOperand);\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TFPUnaryOperator.InitAggregate;\r\nbegin\r\n  inherited InitAggregate;\r\n  if Assigned(FOperand) then\r\n    FOperand.InitAggregate;\r\n\r\nend;\r\n\r\nprocedure TFPUnaryOperator.UpdateAggregate;\r\nbegin\r\n  inherited UpdateAggregate;\r\n  if Assigned(FOperand) then\r\n    FOperand.UpdateAggregate;\r\nend;\r\n\r\nfunction TFPUnaryOperator.HasAggregate: Boolean;\r\nbegin\r\n  Result:=inherited HasAggregate;\r\n  if Assigned(FOperand) then\r\n    Result:=Result or FOperand.HasAggregate;\r\nend;\r\n\r\nprocedure TFPUnaryOperator.Check;\r\nbegin\r\n  If Not Assigned(Operand) then\r\n    RaiseParserError(SErrNoOperand,[Self.className]);\r\nend;\r\n\r\n{ TFPConstExpression }\r\n\r\nconstructor TFPConstExpression.CreateString(AValue: String);\r\nbegin\r\n  FValue.ResultType:=rtString;\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nconstructor TFPConstExpression.CreateInteger(AValue: NativeInt);\r\nbegin\r\n  FValue.ResultType:=rtInteger;\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nconstructor TFPConstExpression.CreateDateTime(AValue: TDateTime);\r\nbegin\r\n  FValue.ResultType:=rtDateTime;\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nconstructor TFPConstExpression.CreateFloat(AValue: TExprFloat);\r\nbegin\r\n  Inherited create;\r\n  FValue.ResultType:=rtFloat;\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nconstructor TFPConstExpression.CreateCurrency(AValue: Currency);\r\nbegin\r\n  Inherited create;\r\n  FValue.ResultType:=rtCurrency;\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nconstructor TFPConstExpression.CreateBoolean(AValue: Boolean);\r\nbegin\r\n  FValue.ResultType:=rtBoolean;\r\n  FValue.resValue:=AValue;\r\nend;\r\n\r\nprocedure TFPConstExpression.Check;\r\nbegin\r\n  // Nothing to check;\r\nend;\r\n\r\nfunction TFPConstExpression.NodeType: TResultType;\r\nbegin\r\n  Result:=FValue.ResultType;\r\nend;\r\n\r\nFunction TFPConstExpression.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  Result:=FValue;\r\nend;\r\n\r\nfunction TFPConstExpression.AsString: string ;\r\n\r\nbegin\r\n  Case NodeType of\r\n    rtString  : Result:=''''+String(FValue.resValue)+'''';\r\n    rtInteger : Result:=IntToStr(NativeInt(FValue.resValue));\r\n    rtDateTime : Result:=''''+FormatDateTime('cccc',TDateTime(FValue.resValue))+'''';\r\n    rtBoolean : If Boolean(FValue.resValue) then Result:='True' else Result:='False';\r\n    rtFloat : Str(TExprFloat(FValue.resValue),Result);\r\n    rtCurrency : Str(Currency(FValue.resValue),Result);\r\n  end;\r\nend;\r\n\r\n\r\n{ TFPNegateOperation }\r\n\r\nprocedure TFPNegateOperation.Check;\r\nbegin\r\n  Inherited;\r\n  If Not (Operand.NodeType in [rtInteger,rtFloat,rtCurrency]) then\r\n    RaiseParserError(SErrNoNegation,[ResultTypeName(Operand.NodeType),Operand.AsString])\r\nend;\r\n\r\nfunction TFPNegateOperation.NodeType: TResultType;\r\nbegin\r\n  Result:=Operand.NodeType;\r\nend;\r\n\r\nFunction TFPNegateOperation.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  Result:=Operand.GetNodeValue;\r\n  Case Result.ResultType of\r\n    rtInteger : Result.resValue:=-NativeInt(Result.resValue);\r\n    rtFloat : Result.resValue:=-TExprFloat(Result.resValue);\r\n    rtCurrency : Result.resValue:=-Currency(Result.resValue);\r\n  end;\r\nend;\r\n\r\nfunction TFPNegateOperation.AsString: String;\r\nbegin\r\n  Result:='-'+TrimLeft(Operand.AsString);\r\nend;\r\n\r\n{ TFPBinaryAndOperation }\r\n\r\nprocedure TFPBooleanOperation.Check;\r\nbegin\r\n  inherited Check;\r\n  CheckNodeType(Left,[rtInteger,rtBoolean]);\r\n  CheckNodeType(Right,[rtInteger,rtBoolean]);\r\n  CheckSameNodeTypes;\r\nend;\r\n\r\nfunction TFPBooleanOperation.NodeType: TResultType;\r\nbegin\r\n  Result:=Left.NodeType;\r\nend;\r\n\r\nFunction TFPBinaryAndOperation.GetNodeValue : TFPExpressionResult;\r\n\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  Case Result.ResultType of\r\n    rtBoolean : Result.resValue:=Boolean(Result.resValue) and Boolean(RRes.resValue);\r\n    rtInteger : Result.resValue:=NativeInt(Result.resValue) and NativeInt(RRes.resValue);\r\n  end;\r\nend;\r\n\r\nfunction TFPBinaryAndOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' and '+Right.AsString;\r\nend;\r\n\r\n{ TFPExprNode }\r\n\r\nprocedure TFPExprNode.CheckNodeType(Anode: TFPExprNode; Allowed: TResultTypes);\r\n\r\nVar\r\n  S : String;\r\n  A : TResultType;\r\n\r\nbegin\r\n  If (Anode=Nil) then\r\n    RaiseParserError(SErrNoNodeToCheck);\r\n  If Not (ANode.NodeType in Allowed) then\r\n    begin\r\n    S:='';\r\n    For A:=Low(TResultType) to High(TResultType) do\r\n      If A in Allowed then\r\n        begin\r\n        If S<>'' then\r\n          S:=S+',';\r\n        S:=S+ResultTypeName(A);\r\n        end;\r\n    RaiseParserError(SInvalidNodeType,[ResultTypeName(ANode.NodeType),S,ANode.AsString]);\r\n    end;\r\nend;\r\n\r\nprocedure TFPExprNode.InitAggregate;\r\nbegin\r\n  // Do nothing\r\nend;\r\n\r\nprocedure TFPExprNode.UpdateAggregate;\r\nbegin\r\n  // Do nothing\r\nend;\r\n\r\nfunction TFPExprNode.HasAggregate: Boolean;\r\nbegin\r\n  Result:=IsAggregate;\r\nend;\r\n\r\nclass function TFPExprNode.IsAggregate: Boolean;\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\nfunction TFPExprNode.NodeValue: TFPExpressionResult;\r\nbegin\r\n  Result:=GetNodeValue;\r\nend;\r\n\r\n{ TFPBinaryOrOperation }\r\n\r\nfunction TFPBinaryOrOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' or '+Right.AsString;\r\nend;\r\n\r\nFunction TFPBinaryOrOperation.GetNodeValue : TFPExpressionResult;\r\n\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  Case Result.ResultType of\r\n    rtBoolean : Result.resValue:=Boolean(Result.resValue) or Boolean(RRes.resValue);\r\n    rtInteger : Result.resValue:=NativeInt(Result.resValue) or NativeInt(RRes.resValue);\r\n  end;\r\nend;\r\n\r\n{ TFPBinaryXOrOperation }\r\n\r\nfunction TFPBinaryXOrOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' xor '+Right.AsString;\r\nend;\r\n\r\nFunction TFPBinaryXOrOperation.GetNodeValue : TFPExpressionResult;\r\n\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  Case Result.ResultType of\r\n    rtBoolean : Result.resValue:=Boolean(Result.resValue) xor Boolean(RRes.resValue);\r\n    rtInteger : Result.resValue:=NativeInt(Result.resValue) xor NativeInt(RRes.resValue);\r\n  end;\r\nend;\r\n\r\n{ TFPNotNode }\r\n\r\nprocedure TFPNotNode.Check;\r\nbegin\r\n  If Not (Operand.NodeType in [rtInteger,rtBoolean]) then\r\n    RaiseParserError(SErrNoNotOperation,[ResultTypeName(Operand.NodeType),Operand.AsString])\r\nend;\r\n\r\nfunction TFPNotNode.NodeType: TResultType;\r\nbegin\r\n  Result:=Operand.NodeType;\r\nend;\r\n\r\nFunction TFPNotNode.GetNodeValue: TFPExpressionResult;\r\nbegin\r\n  Result:=Operand.GetNodeValue;\r\n  Case result.ResultType of\r\n    rtInteger : Result.resValue:=Not Result.resValue;\r\n    rtBoolean : Result.resValue:=Not Result.resValue;\r\n  end\r\nend;\r\n\r\nfunction TFPNotNode.AsString: String;\r\nbegin\r\n  Result:='not '+Operand.AsString;\r\nend;\r\n\r\n{ TIfOperation }\r\n\r\nconstructor TIfOperation.Create(ACondition, ALeft, ARight: TFPExprNode);\r\nbegin\r\n  Inherited Create(ALeft,ARight);\r\n  FCondition:=ACondition;\r\nend;\r\n\r\ndestructor TIfOperation.destroy;\r\nbegin\r\n  FreeAndNil(FCondition);\r\n  inherited destroy;\r\nend;\r\n\r\nFunction TIfOperation.GetNodeValue: TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=FCondition.GetNodeValue;\r\n  If Boolean(Result.resValue) then\r\n    Result:=Left.GetNodeValue\r\n  else\r\n    Result:=Right.GetNodeValue;\r\nend;\r\n\r\nprocedure TIfOperation.Check;\r\nbegin\r\n  inherited Check;\r\n  if (Condition.NodeType<>rtBoolean) then\r\n    RaiseParserError(SErrIFNeedsBoolean,[Condition.AsString]);\r\n  CheckSameNodeTypes;\r\nend;\r\n\r\nprocedure TIfOperation.InitAggregate;\r\nbegin\r\n  inherited InitAggregate;\r\n  If Assigned(FCondition) then\r\n    fCondition.InitAggregate;\r\nend;\r\n\r\nprocedure TIfOperation.UpdateAggregate;\r\nbegin\r\n  inherited UpdateAggregate;\r\n  If Assigned(FCondition) then\r\n    FCondition.UpdateAggregate;\r\nend;\r\n\r\nfunction TIfOperation.HasAggregate: Boolean;\r\nbegin\r\n  Result:=inherited HasAggregate;\r\n  if Assigned(Condition) then\r\n    Result:=Result or Condition.HasAggregate;\r\nend;\r\n\r\nfunction TIfOperation.NodeType: TResultType;\r\nbegin\r\n  Result:=Left.NodeType;\r\nend;\r\n\r\nfunction TIfOperation.AsString: string;\r\nbegin\r\n  Result:=Format('if(%s , %s , %s)',[Condition.AsString,Left.AsString,Right.AsString]);\r\nend;\r\n\r\n{ TCaseOperation }\r\n\r\nFunction TCaseOperation.GetNodeValue: TFPExpressionResult;\r\n\r\nVar\r\n  I,L : Integer;\r\n  B : Boolean;\r\n  RT,RV : TFPExpressionResult;\r\n\r\nbegin\r\n  RT:=FArgs[0].GetNodeValue;\r\n  L:=Length(FArgs);\r\n  I:=2;\r\n  B:=False;\r\n  While (Not B) and (I<L) do\r\n    begin\r\n    Result:=FArgs[i].GetNodeValue;\r\n    Case RT.ResultType of\r\n      rtBoolean  : B:=RT.resValue=RV.resValue;\r\n      rtInteger  : B:=RT.resValue=RV.resValue;\r\n      rtFloat    : B:=RT.resValue=RV.resValue;\r\n      rtCurrency : B:=RT.resValue=RV.resValue;\r\n      rtDateTime : B:=RT.resValue=RV.resValue;\r\n      rtString   : B:=RT.resValue=RV.resValue;\r\n    end;\r\n    If Not B then\r\n      Inc(I,2);\r\n    end;\r\n  // Set result type.\r\n  Result.ResultType:=FArgs[1].NodeType;\r\n  If B then\r\n    Result:=FArgs[I+1].GetNodeValue\r\n  else if ((L mod 2)=0) then\r\n    Result:=FArgs[1].GetNodeValue;\r\nend;\r\n\r\nprocedure TCaseOperation.Check;\r\n\r\nVar\r\n  T,V : TResultType;\r\n  I : Integer;\r\n  N : TFPExprNode;\r\n\r\nbegin\r\n  If (Length(FArgs)<3) then\r\n    RaiseParserError(SErrCaseNeeds3);\r\n  If ((Length(FArgs) mod 2)=1) then\r\n    RaiseParserError(SErrCaseEvenCount);\r\n  T:=FArgs[0].NodeType;\r\n  V:=FArgs[1].NodeType;\r\n  For I:=2 to Length(Fargs)-1 do\r\n    begin\r\n    N:=FArgs[I];\r\n    // Even argument types (labels) must equal tag.\r\n    If ((I mod 2)=0) then\r\n      begin\r\n      If Not (N is TFPConstExpression) then\r\n        RaiseParserError(SErrCaseLabelNotAConst,[I div 2,N.AsString]);\r\n      If (N.NodeType<>T) then\r\n        RaiseParserError(SErrCaseLabelType,[I div 2,N.AsString,ResultTypeName(T),ResultTypeName(N.NodeType)]);\r\n      end\r\n    else // Odd argument types (values) must match first.\r\n      begin\r\n      If (N.NodeType<>V) then\r\n        RaiseParserError(SErrCaseValueType,[(I-1)div 2,N.AsString,ResultTypeName(V),ResultTypeName(N.NodeType)]);\r\n      end\r\n    end;\r\nend;\r\n\r\nprocedure TCaseOperation.InitAggregate;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  inherited InitAggregate;\r\n  if Assigned(FCondition) then\r\n    FCondition.InitAggregate;\r\n  For I:=0 to Length(Fargs)-1 do\r\n    FArgs[i].InitAggregate;\r\nend;\r\n\r\nprocedure TCaseOperation.UpdateAggregate;\r\nVar\r\n  I : Integer;\r\nbegin\r\n  inherited UpdateAggregate;\r\n  if Assigned(FCondition) then\r\n    FCondition.UpdateAggregate;\r\n  For I:=0 to Length(Fargs)-1 do\r\n    FArgs[i].InitAggregate;\r\nend;\r\n\r\nFunction  TCaseOperation.HasAggregate : Boolean;\r\n\r\nVar\r\n  I,L : Integer;\r\nbegin\r\n  Result:=inherited HasAggregate;\r\n  L:=Length(Fargs);\r\n  I:=0;\r\n  While (Not Result) and (I<L) do\r\n    begin\r\n    Result:=Result or FArgs[i].HasAggregate;\r\n    Inc(I)\r\n    end;\r\nend;\r\n\r\nfunction TCaseOperation.NodeType: TResultType;\r\nbegin\r\n  Result:=FArgs[1].NodeType;\r\nend;\r\n\r\nconstructor TCaseOperation.Create(Args: TExprArgumentArray);\r\nbegin\r\n  Fargs:=Args;\r\nend;\r\n\r\ndestructor TCaseOperation.destroy;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  For I:=0 to Length(FArgs)-1 do\r\n    FreeAndNil(Fargs[I]);\r\n  inherited destroy;\r\nend;\r\n\r\nfunction TCaseOperation.AsString: string;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  Result:='';\r\n  For I:=0 to Length(FArgs)-1 do\r\n    begin\r\n    If (Result<>'') then\r\n      Result:=Result+', ';\r\n    Result:=Result+FArgs[i].AsString;\r\n    end;\r\n  Result:='Case('+Result+')';\r\nend;\r\n\r\n{ TFPBooleanResultOperation }\r\n\r\nprocedure TFPBooleanResultOperation.Check;\r\nbegin\r\n  inherited Check;\r\n  CheckSameNodeTypes;\r\nend;\r\n\r\nfunction TFPBooleanResultOperation.NodeType: TResultType;\r\nbegin\r\n  Result:=rtBoolean;\r\nend;\r\n\r\n{ TFPEqualOperation }\r\n\r\nfunction TFPEqualOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' = '+Right.AsString;\r\nend;\r\n\r\nFunction TFPEqualOperation.GetNodeValue : TFPExpressionResult;\r\n\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  Result.resValue:=Result.resValue=RRes.resValue;\r\n  Result.ResultType:=rtBoolean;\r\nend;\r\n\r\n{ TFPUnequalOperation }\r\n\r\nfunction TFPUnequalOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' <> '+Right.AsString;\r\nend;\r\n\r\nFunction TFPUnequalOperation.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  Result:=Inherited GetNodeValue;\r\n  Result.resValue:=Not Result.resValue;\r\nend;\r\n\r\n\r\n{ TFPLessThanOperation }\r\n\r\nfunction TFPLessThanOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' < '+Right.AsString;\r\nend;\r\n\r\nFunction TFPLessThanOperation.GetNodeValue : TFPExpressionResult;\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  Case Result.ResultType of\r\n    rtInteger  : Result.resValue:=NativeInt(Result.resValue)<NativeInt(RRes.resValue);\r\n    rtFloat    : Result.resValue:=TExprFloat(Result.resValue)<TExprFloat(RRes.resValue);\r\n    rtCurrency : Result.resValue:=Currency(Result.resValue)<Currency(RRes.resValue);\r\n    rtDateTime : Result.resValue:=TDateTime(Result.resValue)<TDateTime(RRes.resValue);\r\n    rtString   : Result.resValue:=String(Result.resValue)<String(RRes.resValue);\r\n  end;\r\n  Result.ResultType:=rtBoolean;\r\nend;\r\n\r\n{ TFPGreaterThanOperation }\r\n\r\nfunction TFPGreaterThanOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' > '+Right.AsString;\r\nend;\r\n\r\nFunction TFPGreaterThanOperation.GetNodeValue : TFPExpressionResult;\r\n\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  Case Result.ResultType of\r\n    rtInteger : case Right.NodeType of\r\n                  rtInteger : Result.resValue:=NativeInt(Result.resValue)>NativeInt(RRes.resValue);\r\n                  rtFloat : Result.resValue:=NativeInt(Result.resValue)>TExprFloat(RRes.resValue);\r\n                  rtCurrency : Result.resValue:=NativeINt(Result.resValue)>Currency(RRes.resValue);\r\n                end;\r\n    rtFloat   : case Right.NodeType of\r\n                  rtInteger : Result.resValue:=TExprFloat(Result.resValue)>NativeInt(RRes.resValue);\r\n                  rtFloat : Result.resValue:=TExprFloat(Result.resValue)>TExprFloat(RRes.resValue);\r\n                  rtCurrency : Result.resValue:=TExprFloat(Result.resValue)>Currency(RRes.resValue);\r\n                end;\r\n    rtCurrency   : case Right.NodeType of\r\n                  rtInteger : Result.resValue:=Currency(Result.resValue)>NativeInt(RRes.resValue);\r\n                  rtFloat : Result.resValue:=Currency(Result.resValue)>TExprFloat(RRes.resValue);\r\n                  rtCurrency : Result.resValue:=Currency(Result.resValue)>Currency(RRes.resValue);\r\n                end;\r\n    rtDateTime : Result.resValue:=TDateTime(Result.resValue)>TDateTime(RRes.resValue);\r\n    rtString   : Result.resValue:=String(Result.resValue)>String(RRes.resValue);\r\n  end;\r\n  Result.ResultType:=rtBoolean;\r\nend;\r\n\r\n{ TFPGreaterThanEqualOperation }\r\n\r\nfunction TFPGreaterThanEqualOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' >= '+Right.AsString;\r\nend;\r\n\r\nFunction TFPGreaterThanEqualOperation.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  Result:=Inherited GetNodeValue;\r\n  Result.resValue:=Not Result.resValue;\r\nend;\r\n\r\n{ TFPLessThanEqualOperation }\r\n\r\nfunction TFPLessThanEqualOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' <= '+Right.AsString;\r\nend;\r\n\r\nFunction TFPLessThanEqualOperation.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  Result:=Inherited GetNodeValue;\r\n  Result.resValue:=Not Result.resValue;\r\nend;\r\n\r\n{ TFPOrderingOperation }\r\n\r\nprocedure TFPOrderingOperation.Check;\r\n\r\nConst\r\n  AllowedTypes =[rtInteger,rtfloat,rtCurrency,rtDateTime,rtString];\r\n\r\nbegin\r\n  CheckNodeType(Left,AllowedTypes);\r\n  CheckNodeType(Right,AllowedTypes);\r\n  inherited Check;\r\nend;\r\n\r\n{ TMathOperation }\r\n\r\nprocedure TMathOperation.Check;\r\n\r\nConst\r\n  AllowedTypes =[rtInteger,rtfloat,rtCurrency,rtDateTime,rtString];\r\n\r\nbegin\r\n  inherited Check;\r\n  CheckNodeType(Left,AllowedTypes);\r\n  CheckNodeType(Right,AllowedTypes);\r\n  CheckSameNodeTypes;\r\nend;\r\n\r\nfunction TMathOperation.NodeType: TResultType;\r\nbegin\r\n  Result:=Left.NodeType;\r\nend;\r\n\r\n{ TFPAddOperation }\r\n\r\nfunction TFPAddOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' + '+Right.asString;\r\nend;\r\n\r\nFunction TFPAddOperation.GetNodeValue : TFPExpressionResult;\r\n\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  case Result.ResultType of\r\n    rtInteger  : Result.resValue:=NativeInt(Result.resValue)+NativeInt(RRes.resValue);\r\n    rtString   : Result.resValue:=String(Result.resValue)+String(RRes.resValue);\r\n    rtDateTime : Result.resValue:=TDateTime(Result.resValue)+TDateTime(RRes.resValue);\r\n    rtFloat    : Result.resValue:=TExprFloat(Result.resValue)+TExprFloat(RRes.resValue);\r\n    rtCurrency : Result.resValue:=Currency(Result.resValue)+Currency(RRes.resValue);\r\n  end;\r\n  Result.ResultType:=NodeType;\r\nend;\r\n\r\n{ TFPSubtractOperation }\r\n\r\nprocedure TFPSubtractOperation.check;\r\n\r\nConst\r\n  AllowedTypes =[rtInteger,rtfloat,rtCurrency,rtDateTime];\r\n\r\nbegin\r\n  CheckNodeType(Left,AllowedTypes);\r\n  CheckNodeType(Right,AllowedTypes);\r\n  inherited check;\r\nend;\r\n\r\nfunction TFPSubtractOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' - '+Right.asString;\r\nend;\r\n\r\nFunction TFPSubtractOperation.GetNodeValue : TFPExpressionResult;\r\n\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  case Result.ResultType of\r\n    rtInteger  : Result.resValue:=NativeInt(Result.resValue)-NativeInt(RRes.resValue);\r\n    rtDateTime : Result.resValue:=TDateTime(Result.resValue)-TDateTime(RRes.resValue);\r\n    rtFloat    : Result.resValue:=TExprFloat(Result.resValue)-TExprFloat(RRes.resValue);\r\n    rtCurrency : Result.resValue:=Currency(Result.resValue)-Currency(RRes.resValue);\r\n  end;\r\nend;\r\n\r\n{ TFPMultiplyOperation }\r\n\r\nprocedure TFPMultiplyOperation.check;\r\n\r\nConst\r\n  AllowedTypes =[rtInteger,rtCurrency,rtfloat];\r\n\r\nbegin\r\n  CheckNodeType(Left,AllowedTypes);\r\n  CheckNodeType(Right,AllowedTypes);\r\n  Inherited;\r\nend;\r\n\r\nfunction TFPMultiplyOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' * '+Right.asString;\r\nend;\r\n\r\nFunction TFPMultiplyOperation.GetNodeValue : TFPExpressionResult;\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  case Result.ResultType of\r\n    rtInteger  : Result.resValue:=NativeInt(Result.resValue)*NativeInt(RRes.resValue);\r\n    rtFloat    : Result.resValue:=TExprFloat(Result.resValue)*TExprFloat(RRes.resValue);\r\n    rtCurrency : Result.resValue:=Currency(Result.resValue)*Currency(RRes.resValue);\r\n  end;\r\nend;\r\n\r\n{ TFPDivideOperation }\r\n\r\nprocedure TFPDivideOperation.check;\r\nConst\r\n  AllowedTypes =[rtInteger,rtCurrency,rtfloat];\r\n\r\nbegin\r\n  CheckNodeType(Left,AllowedTypes);\r\n  CheckNodeType(Right,AllowedTypes);\r\n  inherited check;\r\nend;\r\n\r\nfunction TFPDivideOperation.AsString: string;\r\nbegin\r\n  Result:=Left.AsString+' / '+Right.asString;\r\nend;\r\n\r\nfunction TFPDivideOperation.NodeType: TResultType;\r\n\r\nbegin\r\n  if (Left.NodeType=rtCurrency) and (Right.NodeType=rtCurrency) then\r\n    Result:=rtCurrency\r\n  else\r\n    Result:=rtFloat;\r\nend;\r\n\r\nFunction TFPDivideOperation.GetNodeValue : TFPExpressionResult;\r\n\r\nVar\r\n  RRes : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  case Result.ResultType of\r\n    rtInteger  : Result.resValue:=NativeInt(Result.resValue)/NativeInt(RRes.resValue);\r\n    rtFloat    : Result.resValue:=TExprFloat(Result.resValue)/TExprFloat(RRes.resValue);\r\n    rtCurrency :\r\n        if NodeType=rtCurrency then\r\n          Result.resValue:=Currency(Result.resValue)/Currency(RRes.resValue)\r\n        else\r\n          Result.resValue:=TExprFloat(Result.resValue)/TExprFloat(RRes.resValue);\r\n  end;\r\n  Result.ResultType:=NodeType;\r\nend;\r\n\r\n{ TFPPowerOperation }\r\n\r\nprocedure TFPPowerOperation.Check;\r\nconst\r\n  AllowedTypes = [rtInteger, rtCurrency, rtFloat];\r\nbegin\r\n  CheckNodeType(Left, AllowedTypes);\r\n  CheckNodeType(Right, AllowedTypes);\r\nend;\r\n\r\nfunction TFPPowerOperation.AsString: String;\r\nbegin\r\n  Result := Left.AsString + '^' + Right.AsString;\r\nend;\r\n\r\nfunction TFPPowerOperation.NodeType: TResultType;\r\nbegin\r\n  Result := rtFloat;\r\nend;\r\n\r\nfunction power(base,exponent: TExprFloat): TExprFloat;\r\n// Adapted from unit \"math\"\r\nvar\r\n  ex: Integer;\r\nbegin\r\n  if Exponent = 0.0 then\r\n    result := 1.0\r\n  else if (base = 0.0) and (exponent > 0.0) then\r\n    result := 0.0\r\n  else if (base < 0.0) and (frac(exponent) = 0.0) then\r\n  begin\r\n    ex := round(exponent);\r\n    result := exp( exponent * ln(-base));\r\n    if odd(ex) then result := -result;\r\n  end\r\n  else\r\n    result := exp( exponent * ln(base) );\r\nend;\r\n\r\nFunction TFPPowerOperation.GetNodeValue: TFPExpressionResult;\r\nvar\r\n  RRes: TFPExpressionResult;\r\nbegin\r\n  Result:=Left.GetNodeValue;\r\n  RRes:=Right.GetNodeValue;\r\n  Result.resValue := power(ArgToFloat(Result), ArgToFloat(RRes));\r\n  Result.ResultType := rtFloat;\r\nend;\r\n\r\n{ TFPConvertNode }\r\n\r\nfunction TFPConvertNode.AsString: String;\r\nbegin\r\n  Result:=Operand.AsString;\r\nend;\r\n\r\n{ TIntToFloatNode }\r\n\r\nprocedure TIntConvertNode.Check;\r\nbegin\r\n  inherited Check;\r\n  CheckNodeType(Operand,[rtInteger])\r\nend;\r\n\r\nfunction TIntToFloatNode.NodeType: TResultType;\r\nbegin\r\n  Result:=rtFloat;\r\nend;\r\n\r\nFunction TIntToFloatNode.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  Result:=Operand.GetNodeValue;\r\n  Result.resValue:=Result.resValue;\r\n  Result.ResultType:=rtFloat;\r\nend;\r\n\r\n\r\n{ TIntToDateTimeNode }\r\n\r\nfunction TIntToDateTimeNode.NodeType: TResultType;\r\nbegin\r\n  Result:=rtDatetime;\r\nend;\r\n\r\nFunction TIntToDateTimeNode.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  Result:=Operand.GetNodeValue;\r\n  Result.ResultType:=rtDateTime;\r\nend;\r\n\r\n{ TFloatToDateTimeNode }\r\n\r\nprocedure TFloatToDateTimeNode.Check;\r\nbegin\r\n  inherited Check;\r\n  CheckNodeType(Operand,[rtFloat]);\r\nend;\r\n\r\nfunction TFloatToDateTimeNode.NodeType: TResultType;\r\nbegin\r\n  Result:=rtDateTime;\r\nend;\r\n\r\nFunction TFloatToDateTimeNode.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  Result:=Operand.GetNodeValue;\r\n  Result.ResultType:=rtDateTime;\r\nend;\r\n\r\n{ TCurrencyToDateTimeNode }\r\n\r\nprocedure TCurrencyToDateTimeNode.Check;\r\n\r\nbegin\r\n  inherited Check;\r\n  CheckNodeType(Operand,[rtCurrency]);\r\nend;\r\n\r\nfunction TCurrencyToDateTimeNode.NodeType: TResultType;\r\nbegin\r\n  Result:=rtDateTime;\r\nend;\r\n\r\nFunction TCurrencyToDateTimeNode.GetNodeValue : TFPExpressionResult;\r\n\r\nVar\r\n  R : TFPExpressionResult;\r\nbegin\r\n  R:=Operand.GetNodeValue;\r\n  Result.resValue:=Currency(R.resValue);\r\n  Result.ResultType:=rtDateTime;\r\nend;\r\n\r\n{ TCurrencyToFloatNode }\r\n\r\nprocedure TCurrencyToFloatNode.Check;\r\nbegin\r\n  inherited Check;\r\n  CheckNodeType(Operand,[rtCurrency]);\r\nend;\r\n\r\nfunction TCurrencyToFloatNode.NodeType: TResultType;\r\nbegin\r\n  Result:=rtFloat;\r\nend;\r\n\r\nFunction TCurrencyToFloatNode.GetNodeValue : TFPExpressionResult;\r\n\r\nbegin\r\n  Result:=Operand.GetNodeValue;\r\n  Result.resValue:=Currency(Result.resValue);\r\n  Result.ResultType:=rtFloat;\r\nend;\r\n\r\n{ TFPExprIdentifierNode }\r\n\r\nconstructor TFPExprIdentifierNode.CreateIdentifier(AID: TFPExprIdentifierDef);\r\nbegin\r\n  Inherited Create;\r\n  FID:=AID;\r\n  PResult:=@FID.FValue;\r\n  FResultType:=FID.ResultType;\r\nend;\r\n\r\nfunction TFPExprIdentifierNode.NodeType: TResultType;\r\nbegin\r\n  Result:=FResultType;\r\nend;\r\n\r\nFunction TFPExprIdentifierNode.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  if Identifier.EventBasedVariable then\r\n    begin\r\n    Identifier.FetchValue;\r\n    PResult:=@FID.FValue;\r\n    end;\r\n  Result:=PResult^;\r\n  Result.ResultType:=FResultType;\r\nend;\r\n\r\n{ TFPExprVariable }\r\n\r\nprocedure TFPExprVariable.Check;\r\nbegin\r\n  // Do nothing;\r\nend;\r\n\r\nfunction TFPExprVariable.AsString: string;\r\nbegin\r\n  Result:=FID.Name;\r\nend;\r\n\r\n{ TFPExprFunction }\r\n\r\nprocedure TFPExprFunction.CalcParams;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  For I:=0 to Length(FArgumentParams)-1 do\r\n    begin\r\n    FArgumentParams[i]:=FArgumentNodes[i].GetNodeValue;\r\n    end;\r\nend;\r\n\r\nFunction TFPExprFunction.ConvertArgument(aIndex : Integer; aNode : TFPExprNode; aType : TResultType) : TFPExprNode;\r\n\r\nVar\r\n  N : TFPExprNode;\r\n\r\nbegin\r\n  // Automatically convert integers to floats for float/currency parameters\r\n  N:=TFPExpressionParser.ConvertNode(aNode,aType);\r\n  if (aNode=N) then\r\n    // No conversion was performed, raise error\r\n    RaiseParserError(SErrInvalidArgumentType,[aIndex,ResultTypeName(aType),ResultTypeName(aNode.NodeType)]);\r\n  Result:=N;\r\nend;\r\n\r\nfunction TFPExprFunction.HasAggregate: Boolean;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := true;\r\n  if IsAggregate then\r\n    exit;\r\n  For I:=0 to Length(FArgumentNodes)-1 do\r\n    if FArgumentNodes[I].HasAggregate then\r\n      exit;\r\n  Result := false;\r\nend;\r\n\r\nprocedure TFPExprFunction.Check;\r\n\r\nVar\r\n  I : Integer;\r\n  rtp,rta : TResultType;\r\n\r\nbegin\r\n  If Length(FArgumentNodes)<>FID.ArgumentCount then\r\n    RaiseParserError(ErrInvalidArgumentCount,[FID.Name]);\r\n  For I:=0 to Length(FArgumentNodes)-1 do\r\n    begin\r\n    rtp:=CharToResultType(FID.ParameterTypes[i+1]);\r\n    rta:=FArgumentNodes[i].NodeType;\r\n    If (rtp<>rta) then\r\n      FArgumentNodes[i]:=ConvertArgument(I+1,FArgumentNodes[i],rtp);\r\n    end;\r\nend;\r\n\r\nconstructor TFPExprFunction.CreateFunction(AID: TFPExprIdentifierDef; const Args: TExprArgumentArray);\r\n\r\nbegin\r\n  Inherited CreateIdentifier(AID);\r\n  FArgumentNodes:=Args;\r\n  SetLength(FArgumentParams,Length(Args));\r\nend;\r\n\r\ndestructor TFPExprFunction.Destroy;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  For I:=0 to Length(FArgumentNodes)-1 do\r\n    FreeAndNil(FArgumentNodes[I]);\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TFPExprFunction.InitAggregate;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  For I:=0 to Length(FArgumentNodes)-1 do\r\n    FArgumentNodes[i].InitAggregate;\r\nend;\r\n\r\nprocedure TFPExprFunction.UpdateAggregate;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  For I:=0 to Length(FArgumentNodes)-1 do\r\n    FArgumentNodes[i].UpdateAggregate;\r\nend;\r\n\r\nfunction TFPExprFunction.AsString: String;\r\n\r\nVar\r\n  S : String;\r\n  I : Integer;\r\n\r\nbegin\r\n  S:='';\r\n  For I:=0 to length(FArgumentNodes)-1 do\r\n    begin\r\n    If (S<>'') then\r\n      S:=S+',';\r\n    S:=S+FArgumentNodes[I].AsString;\r\n    end;\r\n  If (S<>'') then\r\n    S:='('+S+')';\r\n  Result:=FID.Name+S;\r\nend;\r\n\r\n{ TFPFunctionEventHandler }\r\n\r\nconstructor TFPFunctionEventHandler.CreateFunction(AID: TFPExprIdentifierDef;\r\n  Const Args : TExprArgumentArray);\r\nbegin\r\n  Inherited;\r\n  FCallBack:=AID.OnGetFunctionValue;\r\nend;\r\n\r\nFunction TFPFunctionEventHandler.GetNodeValue : TFPExpressionResult;\r\nbegin\r\n  If Length(FArgumentParams)>0 then\r\n    CalcParams;\r\n  Result:=FCallBack(FArgumentParams);\r\n  Result.ResultType:=NodeType;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Standard Builtins support\r\n  ---------------------------------------------------------------------}\r\n\r\n{ Template for builtin.\r\n\r\nProcedure MyCallback (Var Result : TFPExpressionResult; Const Args : TExprParameterArray);\r\nbegin\r\nend;\r\n\r\n}\r\n\r\nfunction ArgToFloat(Arg: TFPExpressionResult): TExprFloat;\r\n// Utility function for the built-in math functions. Accepts also integers\r\n// in place of the floating point arguments. To be called in builtins or\r\n// user-defined callbacks having float results.\r\nbegin\r\n  if Arg.ResultType = rtInteger then\r\n    result := NativeInt(Arg.resValue)\r\n  else if Arg.ResultType = rtCurrency then\r\n    result := Currency(Arg.resValue)\r\n  else\r\n    result := TExprFloat(Arg.resValue);\r\nend;\r\n\r\n// Math builtins\r\n\r\nFunction BuiltInCos(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=Cos(ArgToFloat(Args[0]));\r\nend;\r\n\r\nFunction BuiltInSin(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=Sin(ArgToFloat(Args[0]));\r\nend;\r\n\r\n(*\r\nFunction BuiltInArcTan(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n//  Result.resValue:=Arctan(ArgToFloat(Args[0]));\r\nend;\r\n*)\r\n\r\nFunction BuiltInAbs(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=Abs(ArgToFloat(Args[0]));\r\nend;\r\n\r\nFunction BuiltInSqr(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=Sqr(ArgToFloat(Args[0]));\r\nend;\r\n\r\nFunction BuiltInSqrt(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=Sqrt(ArgToFloat(Args[0]));\r\nend;\r\n\r\nFunction BuiltInExp(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=Exp(ArgToFloat(Args[0]));\r\nend;\r\n\r\nFunction BuiltInLn(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=Ln(ArgToFloat(Args[0]));\r\nend;\r\n\r\nVar\r\n  L10 : TExprFloat;\r\n\r\nFunction BuiltInLog(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=Ln(ArgToFloat(Args[0]))/L10;\r\nend;\r\n\r\nFunction BuiltInRound(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  Result.resValue:=Round(ArgToFloat(Args[0]));\r\nend;\r\n\r\nFunction BuiltInTrunc(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  Result.resValue:=Trunc(ArgToFloat(Args[0]));\r\nend;\r\n\r\nFunction BuiltInInt(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  Result.resValue:=Int(ArgToFloat(Args[0]));\r\nend;\r\n\r\nFunction BuiltInFrac(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=frac(ArgToFloat(Args[0]));\r\nend;\r\n\r\n// String builtins\r\n\r\nFunction BuiltInLength(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  Result.resValue:=Length(String(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInCopy(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=Copy(String(Args[0].resValue),NativeInt(Args[1].resValue),NativeInt(Args[2].resValue));\r\nend;\r\n\r\nFunction BuiltInDelete(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nVar\r\n  S : String;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  S:=String(Args[0].resValue);\r\n  Delete(S,NativeInt(Args[1].resValue),NativeInt(Args[2].resValue));\r\n  Result.resValue:=S;\r\nend;\r\n\r\nFunction BuiltInPos(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  result.ResultType:=rtInteger;\r\n  Result.resValue:=Pos(String(Args[0].resValue),String(Args[1].resValue));\r\nend;\r\n\r\nFunction BuiltInUppercase(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=Uppercase(String(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInLowercase(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=Lowercase(String(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStringReplace(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nVar\r\n  F : TReplaceFlags;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  F:=[];\r\n  If Boolean(Args[3].resValue) then\r\n    Include(F,rfReplaceAll);\r\n  If Boolean(Args[4].resValue) then\r\n    Include(F,rfIgnoreCase);\r\n  Result.resValue:=StringReplace(String(Args[0].resValue),String(Args[1].resValue),String(Args[2].resValue),f);\r\nend;\r\n\r\nFunction BuiltInCompareText(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  Result.resValue:=CompareText(String(Args[0].resValue),String(Args[1].resValue));\r\nend;\r\n\r\n// Date/Time builtins\r\n\r\nFunction BuiltInDate(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=Date;\r\nend;\r\n\r\nFunction BuiltInTime(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=Time;\r\nend;\r\n\r\nFunction BuiltInNow(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=Now;\r\nend;\r\n\r\nFunction BuiltInDayofWeek(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  Result.resValue:=DayOfWeek(TDateTime(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInExtractYear(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  DecodeDate(TDateTime(Args[0].resValue),Y,M,D);\r\n  Result.resValue:=Y;\r\nend;\r\n\r\nFunction BuiltInExtractMonth(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  DecodeDate(TDateTime(Args[0].resValue),Y,M,D);\r\n  Result.resValue:=M;\r\nend;\r\n\r\nFunction BuiltInExtractDay(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  DecodeDate(TDateTime(Args[0].resValue),Y,M,D);\r\n  Result.resValue:=D;\r\nend;\r\n\r\nFunction BuiltInExtractHour(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  DecodeTime(TDateTime(Args[0].resValue),H,M,S,MS);\r\n  Result.resValue:=H;\r\nend;\r\n\r\nFunction BuiltInExtractMin(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  DecodeTime(TDateTime(Args[0].resValue),H,M,S,MS);\r\n  Result.resValue:=M;\r\nend;\r\n\r\nFunction BuiltInExtractSec(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  DecodeTime(TdateTime(Args[0].resValue),H,M,S,MS);\r\n  Result.resValue:=S;\r\nend;\r\n\r\nFunction BuiltInExtractMSec(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  DecodeTime(TDateTime(Args[0].resValue),H,M,S,MS);\r\n  Result.resValue:=MS;\r\nend;\r\n\r\nFunction BuiltInEncodedate(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=Encodedate(NativeInt(Args[0].resValue),NativeInt(Args[1].resValue),NativeInt(Args[2].resValue));\r\nend;\r\n\r\nFunction BuiltInEncodeTime(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=EncodeTime(NativeInt(Args[0].resValue),NativeInt(Args[1].resValue),NativeInt(Args[2].resValue),NativeInt(Args[3].resValue));\r\nend;\r\n\r\nFunction BuiltInEncodeDateTime(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=EncodeDate(NativeInt(Args[0].resValue),NativeInt(Args[1].resValue),NativeInt(Args[2].resValue))\r\n                     +EncodeTime(NativeInt(Args[3].resValue),NativeInt(Args[4].resValue),NativeInt(Args[5].resValue),NativeInt(Args[6].resValue));\r\nend;\r\n\r\nFunction BuiltInShortDayName(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=FormatSettings.ShortDayNames[NativeInt(Args[0].resValue)];\r\nend;\r\n\r\nFunction BuiltInShortMonthName(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=FormatSettings.ShortMonthNames[NativeInt(Args[0].resValue)];\r\nend;\r\nFunction BuiltInLongDayName(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.resValue:=FormatSettings.LongDayNames[NativeInt(Args[0].resValue)];\r\nend;\r\n\r\nFunction BuiltInLongMonthName(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=FormatSettings.LongMonthNames[NativeInt(Args[0].resValue)];\r\nend;\r\n\r\nFunction BuiltInFormatDateTime(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=FormatDateTime(String(Args[0].resValue),TDateTime(Args[1].resValue));\r\nend;\r\n\r\n\r\n// Conversion\r\nFunction BuiltInIntToStr(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=IntToStr(NativeInt(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToInt(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  Result.resValue:=StrToInt(String(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToIntDef(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtInteger;\r\n  Result.resValue:=StrToIntDef(String(Args[0].resValue),NativeInt(Args[1].resValue));\r\nend;\r\n\r\nFunction BuiltInFloatToStr(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=FloatToStr(TExprFloat(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToFloat(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=StrToFloat(String(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToFloatDef(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  Result.resValue:=StrToFloatDef(String(Args[0].resValue),TExprFloat(Args[1].resValue));\r\nend;\r\n\r\nFunction BuiltInDateToStr(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=DateToStr(TDateTime(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInTimeToStr(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=TimeToStr(TDateTime(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToDate(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=StrToDate(String(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToDateDef(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=StrToDateDef(String(Args[0].resValue),TDateTime(Args[1].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToTime(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=StrToTime(String(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToTimeDef(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=StrToTimeDef(String(Args[0].resValue),TDateTime(Args[1].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToDateTime(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=StrToDateTime(String(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToDateTimeDef(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  Result.resValue:=StrToDateTimeDef(String(Args[0].resValue),TDateTime(Args[1].resValue));\r\nend;\r\n\r\nFunction BuiltInFormatFloat(Const Args : TExprParameterArray) : TFPExpressionResult;\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  result.resValue := FormatFloat(String(Args[0].resValue), TExprFloat(Args[1].resValue));\r\nend;\r\n\r\nFunction BuiltInBoolToStr(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  Result.resValue:=BoolToStr(Boolean(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToBool(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtBoolean;\r\n  Result.resValue:=StrToBool(String(Args[0].resValue));\r\nend;\r\n\r\nFunction BuiltInStrToBoolDef(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.resValue:=StrToBoolDef(String(Args[0].resValue),Boolean(Args[1].resValue));\r\n  Result.ResultType:=rtBoolean;\r\nend;\r\n\r\n// Boolean\r\nFunction BuiltInShl(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtinteger;\r\n  Result.resValue:=NativeInt(Args[0].resValue) shl NativeInt(Args[1].resValue);\r\nend;\r\n\r\nFunction BuiltInShr(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtinteger;\r\n  Result.resValue:=NativeInt(Args[0].resValue) shr NativeInt(Args[1].resValue);\r\nend;\r\n\r\nFunction BuiltinIFS(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtString;\r\n  If Boolean(Args[0].resValue) then\r\n    Result.resValue:=Args[1].resValue\r\n  else\r\n    Result.resValue:=Args[2].resValue\r\nend;\r\n\r\nFunction BuiltinIFI(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtinteger;\r\n  If Boolean(Args[0].resValue) then\r\n    Result.resValue:=Args[1].resValue\r\n  else\r\n    Result.resValue:=Args[2].resValue\r\nend;\r\n\r\nFunction BuiltinIFF(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtFloat;\r\n  If Boolean(Args[0].resValue) then\r\n    Result.resValue:=Args[1].resValue\r\n  else\r\n    Result.resValue:=Args[2].resValue\r\nend;\r\n\r\nFunction BuiltinIFD(Const Args : TExprParameterArray) : TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtDateTime;\r\n  If Boolean(Args[0].resValue) then\r\n    Result.resValue:=Args[1].resValue\r\n  else\r\n    Result.resValue:=Args[2].resValue\r\nend;\r\n\r\nprocedure RegisterStdBuiltins(AManager: TExprBuiltInManager;  Categories: TBuiltInCategories = AllBuiltIns);\r\n\r\nbegin\r\n  With AManager do\r\n    begin\r\n    if bcMath in Categories then\r\n      begin\r\n      AddFloatVariable(bcMath,'pi',Pi);\r\n      // Math functions\r\n      AddFunction(bcMath,'cos','F','F',@BuiltinCos);\r\n      AddFunction(bcMath,'sin','F','F',@BuiltinSin);\r\n//      AddFunction(bcMath,'arctan','F','F',@BuiltinArctan);\r\n      AddFunction(bcMath,'abs','F','F',@BuiltinAbs);\r\n      AddFunction(bcMath,'sqr','F','F',@BuiltinSqr);\r\n      AddFunction(bcMath,'sqrt','F','F',@BuiltinSqrt);\r\n      AddFunction(bcMath,'exp','F','F',@BuiltinExp);\r\n      AddFunction(bcMath,'ln','F','F',@BuiltinLn);\r\n      AddFunction(bcMath,'log','F','F',@BuiltinLog);\r\n      AddFunction(bcMath,'frac','F','F',@BuiltinFrac);\r\n      AddFunction(bcMath,'int','F','F',@BuiltinInt);\r\n      AddFunction(bcMath,'round','I','F',@BuiltinRound);\r\n      AddFunction(bcMath,'trunc','I','F',@BuiltinTrunc);\r\n      end;\r\n    if bcStrings in Categories then\r\n      begin\r\n      // String\r\n      AddFunction(bcStrings,'length','I','S',@BuiltinLength);\r\n      AddFunction(bcStrings,'copy','S','SII',@BuiltinCopy);\r\n      AddFunction(bcStrings,'delete','S','SII',@BuiltinDelete);\r\n      AddFunction(bcStrings,'pos','I','SS',@BuiltinPos);\r\n      AddFunction(bcStrings,'lowercase','S','S',@BuiltinLowercase);\r\n      AddFunction(bcStrings,'uppercase','S','S',@BuiltinUppercase);\r\n      AddFunction(bcStrings,'stringreplace','S','SSSBB',@BuiltinStringReplace);\r\n      AddFunction(bcStrings,'comparetext','I','SS',@BuiltinCompareText);\r\n      end;\r\n    if bcDateTime in Categories then\r\n      begin\r\n      // Date/Time\r\n      AddFunction(bcDateTime,'date','D','',@BuiltinDate);\r\n      AddFunction(bcDateTime,'time','D','',@BuiltinTime);\r\n      AddFunction(bcDateTime,'now','D','',@BuiltinNow);\r\n      AddFunction(bcDateTime,'dayofweek','I','D',@BuiltinDayofweek);\r\n      AddFunction(bcDateTime,'extractyear','I','D',@BuiltinExtractYear);\r\n      AddFunction(bcDateTime,'extractmonth','I','D',@BuiltinExtractMonth);\r\n      AddFunction(bcDateTime,'extractday','I','D',@BuiltinExtractDay);\r\n      AddFunction(bcDateTime,'extracthour','I','D',@BuiltinExtractHour);\r\n      AddFunction(bcDateTime,'extractmin','I','D',@BuiltinExtractMin);\r\n      AddFunction(bcDateTime,'extractsec','I','D',@BuiltinExtractSec);\r\n      AddFunction(bcDateTime,'extractmsec','I','D',@BuiltinExtractMSec);\r\n      AddFunction(bcDateTime,'encodedate','D','III',@BuiltinEncodedate);\r\n      AddFunction(bcDateTime,'encodetime','D','IIII',@BuiltinEncodeTime);\r\n      AddFunction(bcDateTime,'encodedatetime','D','IIIIIII',@BuiltinEncodeDateTime);\r\n      AddFunction(bcDateTime,'shortdayname','S','I',@BuiltinShortDayName);\r\n      AddFunction(bcDateTime,'shortmonthname','S','I',@BuiltinShortMonthName);\r\n      AddFunction(bcDateTime,'longdayname','S','I',@BuiltinLongDayName);\r\n      AddFunction(bcDateTime,'longmonthname','S','I',@BuiltinLongMonthName);\r\n      end;\r\n    if bcBoolean in Categories then\r\n      begin\r\n      // Boolean\r\n      AddFunction(bcBoolean,'shl','I','II',@BuiltinShl);\r\n      AddFunction(bcBoolean,'shr','I','II',@BuiltinShr);\r\n      AddFunction(bcBoolean,'IFS','S','BSS',@BuiltinIFS);\r\n      AddFunction(bcBoolean,'IFF','F','BFF',@BuiltinIFF);\r\n      AddFunction(bcBoolean,'IFD','D','BDD',@BuiltinIFD);\r\n      AddFunction(bcBoolean,'IFI','I','BII',@BuiltinIFI);\r\n      end;\r\n    if (bcConversion in Categories) then\r\n      begin\r\n      // Conversion\r\n      AddFunction(bcConversion,'inttostr','S','I',@BuiltInIntToStr);\r\n      AddFunction(bcConversion,'strtoint','I','S',@BuiltInStrToInt);\r\n      AddFunction(bcConversion,'strtointdef','I','SI',@BuiltInStrToIntDef);\r\n      AddFunction(bcConversion,'floattostr','S','F',@BuiltInFloatToStr);\r\n      AddFunction(bcConversion,'strtofloat','F','S',@BuiltInStrToFloat);\r\n      AddFunction(bcConversion,'strtofloatdef','F','SF',@BuiltInStrToFloatDef);\r\n      AddFunction(bcConversion,'booltostr','S','B',@BuiltInBoolToStr);\r\n      AddFunction(bcConversion,'strtobool','B','S',@BuiltInStrToBool);\r\n      AddFunction(bcConversion,'strtobooldef','B','SB',@BuiltInStrToBoolDef);\r\n      AddFunction(bcConversion,'datetostr','S','D',@BuiltInDateToStr);\r\n      AddFunction(bcConversion,'timetostr','S','D',@BuiltInTimeToStr);\r\n      AddFunction(bcConversion,'strtodate','D','S',@BuiltInStrToDate);\r\n      AddFunction(bcConversion,'strtodatedef','D','SD',@BuiltInStrToDateDef);\r\n      AddFunction(bcConversion,'strtotime','D','S',@BuiltInStrToTime);\r\n      AddFunction(bcConversion,'strtotimedef','D','SD',@BuiltInStrToTimeDef);\r\n      AddFunction(bcConversion,'strtodatetime','D','S',@BuiltInStrToDateTime);\r\n      AddFunction(bcConversion,'strtodatetimedef','D','SD',@BuiltInStrToDateTimeDef);\r\n      AddFunction(bcConversion,'formatfloat','S','SF',@BuiltInFormatFloat);\r\n      AddFunction(bcConversion,'formatdatetime','S','SD',@BuiltinFormatDateTime);\r\n      end;\r\n    if bcAggregate in Categories then\r\n      begin\r\n      AddFunction(bcAggregate,'count','I','',TAggregateCount);\r\n      AddFunction(bcAggregate,'sum','F','F',TAggregateSum);\r\n      AddFunction(bcAggregate,'avg','F','F',TAggregateAvg);\r\n      AddFunction(bcAggregate,'min','F','F',TAggregateMin);\r\n      AddFunction(bcAggregate,'max','F','F',TAggregateMax);\r\n      end;\r\n    end;\r\nend;\r\n\r\n{ TFPBuiltInExprIdentifierDef }\r\n\r\nprocedure TFPBuiltInExprIdentifierDef.Assign(Source: TPersistent);\r\nbegin\r\n  inherited Assign(Source);\r\n  If Source is TFPBuiltInExprIdentifierDef then\r\n    FCategory:=(Source as TFPBuiltInExprIdentifierDef).Category;\r\nend;\r\n\r\nprocedure InitFileFormatSettings;\r\nbegin\r\n  FileFormatSettings := FormatSettings;\r\n  FileFormatSettings.DecimalSeparator := '.';\r\n  FileFormatSettings.DateSeparator := '-';\r\n  FileFormatSettings.TimeSeparator := ':';\r\n  FileFormatsettings.ShortDateFormat := 'yyyy-mm-dd';\r\n  FileFormatSettings.LongTimeFormat := 'hh:nn:ss';\r\nend;\r\n\r\ninitialization\r\n  L10:=Ln(10);\r\n  RegisterStdBuiltins(BuiltinIdentifiers);\r\n  InitFileFormatSettings;\r\n\r\nend.\r\n","{\r\n    This file is part of the Free Pascal run time library.\r\n    Copyright (c) 2019 by Michael Van Canneyt, member of the\r\n    Free Pascal development team\r\n\r\n    Simple JSON dataset component.\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n{$mode objfpc}\r\n\r\nunit JSONDataset;\r\n\r\ninterface\r\n\r\nuses\r\n  Types, JS, DB, Classes, SysUtils, typinfo, fpexprpars;\r\n\r\ntype\r\n  TBaseJSONDataset = Class;\r\n  TJSONIndexDef = class;\r\n\r\n  // How are rows encoded in the JSON ?\r\n  TJSONRowType = (rtJSONObject, // Each row is an object.\r\n                  rtJSONArray   // Each row is an array.\r\n                  );\r\n\r\n  { TJSONFieldMapper }\r\n  // This class is responsible for mapping the field objects of the records.\r\n  TJSONFieldMapper = Class(TObject)\r\n  Public\r\n    // Remove a field from the\r\n    Procedure RemoveField(Const FieldName : String; FieldIndex : Integer; Row : JSValue); virtual; abstract;\r\n    // Return row TJSONData instance with data for field 'FieldName' or 'FieldIndex'.\r\n    Function GetJSONDataForField(Const FieldName : String; FieldIndex : Integer; Row : JSValue) : JSValue; virtual; abstract;\r\n    // Same, but now based on TField.\r\n    Function GetJSONDataForField(F : TField; Row : JSValue) : JSValue; virtual;\r\n    // Set data for field 'FieldName' or 'FieldIndex' to supplied TJSONData instance in row\r\n    procedure SetJSONDataForField(Const FieldName : String; FieldIndex : Integer; Row,Data : JSValue); virtual; abstract;\r\n    // Set data for field TField to supplied TJSONData instance\r\n    procedure SetJSONDataForField(F : TField; Row,Data : JSValue); virtual;\r\n    // Create a new row.\r\n    Function CreateRow : JSValue; virtual; abstract;\r\n  end;\r\n\r\n  // JSON has no date/time type, so we use a string field.\r\n  // ExtJS provides the date/time  format in it's field config: 'dateFormat'\r\n  // The below field classes store this in the NNNFormat field.\r\n  { TJSONDateField }\r\n\r\n  TJSONDateField = Class(TDateField)\r\n  private\r\n    FDateFormat: String;\r\n  Published\r\n    Property DateFormat : String Read FDateFormat Write FDateFormat;\r\n  end;\r\n\r\n  { TJSONTimeField }\r\n\r\n  TJSONTimeField = Class(TTimeField)\r\n  private\r\n    FTimeFormat: String;\r\n  Published\r\n    Property TimeFormat : String Read FTimeFormat Write FTimeFormat;\r\n  end;\r\n\r\n  { TJSONDateTimeField }\r\n\r\n  TJSONDateTimeField = Class(TDateTimeField)\r\n  private\r\n    FDateTimeFormat: String;\r\n  Published\r\n    Property DateTimeFormat : String Read FDateTimeFormat Write FDateTimeFormat;\r\n  end;\r\n\r\n  { TFieldComparer }\r\n\r\n  TFieldComparer = Class\r\n  Private\r\n    FDesc: Boolean;\r\n    FValue : JSValue;\r\n    FField : TField;\r\n    FOptions : TLocateOptions;\r\n    FDataset : TBaseJSONDataset;\r\n  Public\r\n    Constructor Create(aDataset : TBaseJSONDataset; aField : TField; aValue : JSValue; aOptions : TLocateOptions);\r\n    Function GetFieldValue(RowIndex : integer) : JSValue;\r\n    Function CompareRows (RowIndex1,RowIndex2 : Integer) : Integer; virtual;\r\n    // First value is always dataset value.\r\n    Function Compare (RowIndex : Integer; aValue : JSValue) : Integer; virtual; abstract;\r\n    Function Compare (RowIndex : Integer) : Integer; virtual;\r\n    Property Value : JSValue read FValue Write FValue;\r\n    Property Options : TLocateOptions Read FOptions Write FOptions;\r\n    Property Dataset : TBaseJSONDataset Read FDataset;\r\n    Property Field : TField Read FField;\r\n    Property Desc : Boolean Read FDesc Write FDesc;\r\n  end;\r\n  TFieldComparerClass = Class of TFieldComparer;\r\n\r\n  { TStringFieldComparer }\r\n\r\n  TStringFieldComparer = Class (TFieldComparer)\r\n    Function Compare (RowIndex : Integer; aValue : JSValue) : Integer; override;\r\n  end;\r\n\r\n  { TNativeIntFieldComparer }\r\n\r\n  TNativeIntFieldComparer = Class (TFieldComparer)\r\n    Function Compare (RowIndex : Integer; aValue : JSValue) : Integer; override;\r\n  end;\r\n\r\n  { TBooleanFieldComparer }\r\n\r\n  TBooleanFieldComparer = Class (TFieldComparer)\r\n    Function Compare (RowIndex : Integer; aValue : JSValue) : Integer; override;\r\n  end;\r\n\r\n  { TDateTimeFieldComparer }\r\n\r\n  TDateTimeFieldComparer = Class (TFieldComparer)\r\n    Function Compare (RowIndex : Integer; aValue : JSValue) : Integer; override;\r\n  end;\r\n\r\n  { TFloatFieldComparer }\r\n\r\n  TFloatFieldComparer = Class (TFieldComparer)\r\n    Function Compare (RowIndex : Integer; aValue : JSValue) : Integer; override;\r\n  end;\r\n\r\n  { TRecordComparer }\r\n\r\n  TRecordComparer = class\r\n  private\r\n    FDataset: TBaseJSONDataset;\r\n    FIndexBased: Boolean;\r\n    FItems : Array of TFieldComparer;\r\n    FOptions: TLocateOptions;\r\n    FValues: TJSValueDynArray;\r\n    function GetFieldComparer(Index : Integer): TFieldComparer;\r\n  Protected\r\n    procedure ConstructItems(aFields: String); virtual;\r\n    function DataTypeToComparerClass(aFieldType: TFieldType): TFieldComparerClass;\r\n    Function Compare(aRowindex : integer) : Integer;\r\n    Function CompareRows(aRowindex1,aRowIndex2 : integer) : Integer;\r\n    procedure updateFromIndex(aIndex : TJSONIndexDef); virtual;\r\n  Public\r\n    Constructor Create(aDataset : TBaseJSONDataset; aFields : String; aValues : JSValue; aOptions : TLocateOptions);\r\n    Constructor Create(aDataset : TBaseJSONDataset; aIndex : TJSONIndexDef);\r\n    Destructor Destroy; override;\r\n    Property Dataset : TBaseJSONDataset Read FDataset;\r\n    property Items [Index : Integer] : TFieldComparer Read GetFieldComparer;\r\n    Property Options : TLocateOptions Read FOptions Write FOptions;\r\n    Property Values : TJSValueDynArray Read FValues;\r\n    Property IndexBased : Boolean Read FIndexBased;\r\n  end;\r\n  TRecordComparerClass = Class of TRecordComparer;\r\n\r\n  { TBaseJSONDataSet }\r\n\r\n  { TJSONIndex }\r\n\r\n  TJSONIndex = Class\r\n    FList : TJSArray; // Indexes of elements in FRows.\r\n    FRows : TJSArray;\r\n    FDataset : TBaseJSONDataset;\r\n  private\r\n    function GetRecordIndex(aListIndex : Integer): NativeInt;\r\n  protected\r\n    Function GetCount: Integer; virtual;\r\n    Procedure CreateIndex; Virtual; abstract;\r\n    Procedure ClearIndex;\r\n    Property List : TJSArray Read FList;\r\n    Property Rows : TJSArray Read FRows;\r\n    Property Dataset : TBaseJSONDataset Read FDataset;\r\n  Public\r\n    Constructor Create(aDataset: TBaseJSONDataset; aRows : TJSArray); reintroduce;\r\n    // Append remainder of FRows to FList.\r\n    Procedure AppendToIndex; virtual; abstract;\r\n    // Delete aListIndex from list, not from row. Return Recordindex of deleted record.\r\n    Function Delete(aListIndex : Integer) : Integer; virtual;\r\n    // Append aRecordIndex to list. Return ListIndex of appended record.\r\n    Function Append(aRecordIndex : Integer) : Integer; virtual; abstract;\r\n    // Insert record into list. By default, this does an append. Return ListIndex of inserted record\r\n    Function Insert(aCurrentIndex{%H-}, aRecordIndex : Integer) : Integer; virtual;\r\n    // Record at index aCurrentIndex has changed. Update index and return new listindex.\r\n    Function Update(aRecordIndex : Integer) : Integer; virtual; abstract;\r\n    // Find list index for Record at index aCurrentIndex. Return -1 if not found.\r\n    Function FindRecord(aRecordIndex : Integer) : Integer; virtual; abstract;\r\n    // index of record in FRows based on aListIndex in List.\r\n    Property RecordIndex[aListIndex : Integer] : NativeInt Read GetRecordIndex;\r\n    // Number of records in index. This can differ from FRows, e.g. when filtering.\r\n    Property Count : Integer Read GetCount;\r\n  end;\r\n\r\n  { TDefaultJSONIndex }\r\n\r\n  TDefaultJSONIndex = Class(TJSONIndex)\r\n  public\r\n    Procedure CreateIndex; override;\r\n    Procedure AppendToIndex; override;\r\n    Function Append(aRecordIndex : Integer) : Integer; override;\r\n    Function Insert(aCurrentIndex, aRecordIndex : Integer) : Integer; override;\r\n    Function FindRecord(aRecordIndex : Integer) : Integer; override;\r\n    Function Update(aRecordIndex : Integer) : Integer; override;\r\n  end;\r\n\r\n  { TSortedJSONIndex }\r\n\r\n  TSortedJSONIndex = Class(TJSONIndex)\r\n  Private\r\n    FComparer : TRecordComparer;\r\n    FUnique: Boolean;\r\n    function FindPos(aRecordIndex: Integer): Integer;\r\n    function MergeSort(aList: TJSArray): TJSArray;\r\n  Protected\r\n    Property Comparer : TRecordComparer Read FComparer Write FComparer;\r\n  public\r\n    Destructor Destroy; override;\r\n    procedure CreateComparer(aIndex: TJSONIndexDef);\r\n    Procedure CreateIndex; override;\r\n    Procedure AppendToIndex; override;\r\n    Function Append(aRecordIndex : Integer) : Integer; override;\r\n    Function FindRecord(aRecordIndex : Integer) : Integer; override;\r\n    Function Update(aRecordIndex : Integer) : Integer; override;\r\n    Property Unique : Boolean Read FUnique Write FUnique;\r\n  end;\r\n\r\n  { TJSONIndexDef }\r\n\r\n  TJSONIndexDef = class(TIndexDef)\r\n  Private\r\n    FIndex : TSortedJSONIndex;\r\n  Protected\r\n    Procedure ClearIndex;\r\n    Property Index : TSortedJSONIndex Read FIndex Write FIndex;\r\n  Public\r\n    Procedure BuildIndex(aDataset : TBaseJSONDataset);\r\n  end;\r\n\r\n  { TJSONIndexDefs }\r\n\r\n  TJSONIndexDefs = Class(TIndexDefs)\r\n  private\r\n    function GetD(aIndex : Integer): TJSONIndexDef;\r\n    procedure SetD(aIndex : Integer; AValue: TJSONIndexDef);\r\n  Public\r\n    Function AddJSONIndexDef: TJSONIndexDef;\r\n    Property Defs[aIndex : Integer] : TJSONIndexDef Read GetD Write SetD; default;\r\n  end;\r\n\r\n  // basic JSON dataset. Does nothing ExtJS specific.\r\n  TBaseJSONDataSet = class (TDataSet)\r\n  private\r\n    FActiveIndex: String;\r\n    FIndexes: TJSONIndexDefs;\r\n    FMUS: Boolean;\r\n    FOwnsData : Boolean;\r\n    FDefaultIndex : TJSONIndex; // Default index, built from array\r\n    FCurrentIndex : TJSONIndex; // Currently active index.\r\n    FCurrent: Integer; // Record Index in the current IndexList\r\n    // Possible metadata to configure fields from.\r\n    FMetaData : TJSObject;\r\n    // This will contain the rows.\r\n    FRows : TJSArray;\r\n    // Deleted rows\r\n    FDeletedRows : TJSArray;\r\n    FFieldMapper : TJSONFieldMapper;\r\n    // When editing, this object is edited.\r\n    FEditIdx : Integer;\r\n    FEditRow : JSValue;\r\n    // When filtering, this is the current row;\r\n    FFilterRow : JSValue;\r\n    FUseDateTimeFormatFields: Boolean;\r\n    FRowType: TJSONRowType;\r\n    FFilterExpression : TFPExpressionParser;\r\n    function GetFilterField(const AName: String): TFPExpressionResult;\r\n    procedure RemoveCalcFields(Buf: JSValue);\r\n    procedure SetActiveIndex(AValue: String);\r\n    procedure SetIndexes(AValue: TJSONIndexDefs);\r\n    procedure SetMetaData(AValue: TJSObject);\r\n    procedure SetRows(AValue: TJSArray);\r\n    procedure SetRowType(AValue: TJSONRowType);\r\n  protected\r\n    procedure ActivateIndex(Build : Boolean);\r\n    // Determine filter value type based on field type\r\n    function FieldTypeToExpressionType(aDataType: TFieldType): TResultType; virtual;\r\n    // Callback for IsNull filter function.\r\n    function GetFilterIsNull(const Args: TExprParameterArray): TFPExpressionResult; virtual;\r\n    // Expression parser class. Override this to create a customized version.\r\n    function FilterExpressionClass: TFPExpressionParserClass; virtual;\r\n    // Create filter expression.\r\n    function CreateFilterExpression: TFPExpressionParser; virtual;\r\n    // Function called to check if current buffer should be accepted.\r\n    function DoFilterRecord: Boolean; virtual;\r\n    // Override this to return customized version.\r\n    function CreateIndexDefs: TJSONIndexDefs; virtual;\r\n    // override this to return a customized version if you are so inclined\r\n    function RecordComparerClass: TRecordComparerClass; virtual;\r\n    // Return index of Row in FRows matching keyfields/values. If not found, -1 is returned.\r\n    function LocateRecordIndex(const KeyFields: string; const KeyValues: JSValue; Options: TLocateOptions): Integer; virtual;\r\n    // dataset virtual methods\r\n    function AllocRecordBuffer: TDataRecord; override;\r\n    procedure FreeRecordBuffer(var Buffer: TDataRecord); override;\r\n    procedure InternalInitRecord(var Buffer: TDataRecord); override;\r\n    function GetRecord(Var Buffer: TDataRecord; GetMode: TGetMode; DoCheck{%H-}: Boolean): TGetResult; override;\r\n    function GetRecordSize: Word; override;\r\n    procedure AddToRows(AValue: TJSArray);\r\n    procedure InternalClose; override;\r\n    procedure InternalDelete; override;\r\n    procedure InternalFirst; override;\r\n    procedure InternalLast; override;\r\n    procedure InternalOpen; override;\r\n    procedure InternalPost; override;\r\n    procedure InternalInsert; override;\r\n    procedure InternalEdit; override;\r\n    procedure InternalCancel; override;\r\n    procedure InternalInitFieldDefs; override;\r\n    procedure InternalSetToRecord(Buffer: TDataRecord); override;\r\n    procedure SetFilterText(const Value: string); override;\r\n    procedure SetFiltered(Value: Boolean); override;\r\n    function  GetFieldClass(FieldType: TFieldType): TFieldClass; override;\r\n    function IsCursorOpen: Boolean; override;\r\n    // Bookmark operations\r\n    procedure GetBookmarkData(Buffer: TDataRecord; var Data: TBookmark); override;\r\n    function GetBookmarkFlag(Buffer: TDataRecord): TBookmarkFlag; override;\r\n    procedure InternalGotoBookmark(ABookmark: TBookmark); override;\r\n    procedure SetBookmarkFlag(Var Buffer: TDataRecord; Value: TBookmarkFlag); override;\r\n    procedure SetBookmarkData(Var Buffer: TDataRecord; Data: TBookmark); override;\r\n    function GetRecordCount: Integer; override;\r\n    procedure SetRecNo(Value: Integer); override;\r\n    function GetRecNo: Integer; override;\r\n  Protected\r\n    // New methods.\r\n    // Build all sorted indexes. Default index is not built.\r\n    Procedure BuildIndexes;\r\n    // Called when dataset is closed. If OwnsData is true, metadata and rows are freed.\r\n    Procedure FreeData; virtual;\r\n    // Fill default list.\r\n    procedure AppendToIndexes; virtual;\r\n    Procedure CreateIndexes; virtual;\r\n    // Convert MetaData object to FieldDefs.\r\n    Procedure MetaDataToFieldDefs; virtual; abstract;\r\n    // Initialize Date/Time info in all date/time fields. Called during InternalOpen\r\n    procedure InitDateTimeFields; virtual;\r\n    // Convert JSON date S to DateTime for Field F\r\n    function ConvertDateTimeField(S: String; F: TField): TDateTime; virtual;\r\n    // Format JSON date to from DT for Field F\r\n    function FormatDateTimeField(DT : TDateTime; F: TField): String; virtual;\r\n    // Create fieldmapper. A descendent MUST implement this.\r\n    Function CreateFieldMapper : TJSONFieldMapper; virtual;\r\n    // If True, then the dataset will free MetaData and FRows when it is closed.\r\n    Property OwnsData : Boolean Read FownsData Write FOwnsData;\r\n    // set to true if unknown field types should be handled as string fields.\r\n    Property MapUnknownToStringType : Boolean Read FMUS Write FMUS;\r\n    // Metadata\r\n    Property MetaData : TJSObject Read FMetaData Write SetMetaData;\r\n    // Rows\r\n    Property Rows : TJSArray Read FRows Write SetRows;\r\n    // RowType\r\n    Property RowType : TJSONRowType Read FRowType Write SetRowType;\r\n    // Fieldmapper\r\n    Property FieldMapper : TJSONFieldMapper Read FFieldMapper;\r\n    // FieldClass\r\n    Property UseDateTimeFormatFields : Boolean Read FUseDateTimeFormatFields Write FUseDateTimeFormatFields;\r\n    // Indexes\r\n    Property Indexes : TJSONIndexDefs Read FIndexes Write SetIndexes;\r\n    // Active index name. Set to empty for default index.\r\n    Property ActiveIndex : String Read FActiveIndex Write SetActiveIndex;\r\n  public\r\n    constructor Create (AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function ConvertDateTimeToNative(aField : TField; aValue : TDateTime) : JSValue; override;\r\n    function Locate(const KeyFields: string; const KeyValues: JSValue; Options: TLocateOptions): boolean; override;\r\n    function Lookup(const KeyFields: string; const KeyValues: JSValue; const ResultFields: string): JSValue; override;\r\n    function GetFieldData(Field: TField; Buffer: TDatarecord): JSValue;  override;\r\n    procedure SetFieldData(Field: TField; var Buffer{%H-}: TDatarecord; AValue : JSValue);  override;\r\n    function BookmarkValid(ABookmark: TBookmark): Boolean; override;\r\n    function CompareBookmarks(Bookmark1, Bookmark2: TBookmark): Longint; override;\r\n  end;\r\n\r\n  TJSONDataset = Class(TBaseJSONDataset)\r\n  published\r\n    Property FieldDefs;\r\n    Property RowType;\r\n    Property UseDateTimeFormatFields;\r\n    Property Indexes;\r\n    Property ActiveIndex;\r\n    property Active;\r\n    property BeforeOpen;\r\n    property AfterOpen;\r\n    property BeforeClose;\r\n    property AfterClose;\r\n    property BeforeInsert;\r\n    property AfterInsert;\r\n    property BeforeEdit;\r\n    property AfterEdit;\r\n    property BeforePost;\r\n    property AfterPost;\r\n    property BeforeCancel;\r\n    property AfterCancel;\r\n    property BeforeDelete;\r\n    property AfterDelete;\r\n    property BeforeScroll;\r\n    property AfterScroll;\r\n    property OnCalcFields;\r\n    property OnDeleteError;\r\n    property OnEditError;\r\n    property OnFilterRecord;\r\n    property OnNewRecord;\r\n    property OnPostError;\r\n  end;\r\n\r\n  { TJSONObjectFieldMapper }\r\n  // Fieldmapper to be used when the data is in an object\r\n  TJSONObjectFieldMapper = Class(TJSONFieldMapper)\r\n  Public\r\n    Procedure RemoveField(Const FieldName : String; FieldIndex : Integer; Row : JSValue); override;\r\n    procedure SetJSONDataForField(Const FieldName : String; FieldIndex{%H-} : Integer; Row,Data : JSValue); override;\r\n    Function GetJSONDataForField(Const FieldName : String; FieldIndex{%H-} : Integer; Row : JSValue) : JSValue; override;\r\n    Function CreateRow : JSValue; override;\r\n  end;\r\n\r\n  { TJSONArrayFieldMapper }\r\n  // Fieldmapper to be used when the data is in an array\r\n  TJSONArrayFieldMapper = Class(TJSONFieldMapper)\r\n  Public\r\n    Procedure RemoveField(Const FieldName : String; FieldIndex : Integer; Row : JSValue); override;\r\n    procedure SetJSONDataForField(Const FieldName{%H-} : String; FieldIndex : Integer; Row,Data : JSValue); override;\r\n    Function GetJSONDataForField(Const FieldName{%H-} : String; FieldIndex : Integer; Row : JSValue) : JSValue; override;\r\n    Function CreateRow : JSValue; override;\r\n  end;\r\n\r\n  EJSONDataset = Class(EDatabaseError);\r\n  \r\nimplementation\r\n\r\nuses DateUtils;\r\n\r\n{ TJSONIndexDef }\r\n\r\nprocedure TJSONIndexDef.ClearIndex;\r\nbegin\r\n  FreeAndNil(FIndex);\r\nend;\r\n\r\nprocedure TJSONIndexDef.BuildIndex(aDataset : TBaseJSONDataset);\r\n\r\nbegin\r\n  if Findex=Nil then\r\n    FIndex:=TSortedJSONIndex.Create(aDataset,aDataset.Rows)\r\n  else\r\n    FIndex.ClearIndex;\r\n  FIndex.CreateComparer(Self);\r\n  FIndex.CreateIndex;\r\nend;\r\n\r\n{ TJSONIndexDefs }\r\n\r\nfunction TJSONIndexDefs.GetD(aIndex : Integer): TJSONIndexDef;\r\nbegin\r\n  Result:=Items[aIndex] as TJSONIndexDef;\r\nend;\r\n\r\nprocedure TJSONIndexDefs.SetD(aIndex : Integer; AValue: TJSONIndexDef);\r\nbegin\r\n  Items[aIndex]:=aValue;\r\nend;\r\n\r\nfunction TJSONIndexDefs.AddJSONIndexDef: TJSONIndexDef;\r\nbegin\r\n  Result:=Add as TJSONIndexDef;\r\nend;\r\n\r\n{ TSortedJSONIndex }\r\n\r\nFunction TSortedJSONIndex.MergeSort(aList : TJSArray) : TJSArray;\r\n\r\nVar\r\n  temp : TJSArray;\r\n  l,p,q,e,tail : integer;\r\n  insize, nmerges, psize, qsize : Integer;\r\n\r\nbegin\r\n  if aList=Nil then\r\n    Exit(Nil);\r\n  L:=aList.length;\r\n  Result:=TJSArray.new(l);\r\n  if L=0 then exit;\r\n  insize:=1;\r\n  Repeat\r\n    p:=0;\r\n    Tail:=0;\r\n    nmerges := 0;  // count number of merges we do in this pass\r\n    while (p<L) do\r\n      begin\r\n      Inc(nmerges);  { there exists a merge to be done }\r\n      { step `insize' places along from p }\r\n      pSize:=L-P;\r\n      if Insize<pSize then\r\n        pSize:=InSize;\r\n      Q:=P+pSize;\r\n      qsize:=insize;\r\n       //* now we have two lists; merge them */\r\n      while (psize>0) or ((qsize > 0) and (Q<L)) do\r\n        begin // /* decide whether next element of merge comes from p or q */\r\n        if (psize=0) then\r\n          begin  // * p is empty; e must come from q. */\r\n          e := q; Inc(q); Dec(qsize);\r\n          end\r\n        else if ((qsize = 0) or (q>=L)) then\r\n          begin // * q is empty; e must come from p. */\r\n          e := p; Inc(p); Dec(psize);\r\n          end\r\n        else if (FComparer.CompareRows(Integer(aList[p]),Integer(aList[q])) <= 0) then\r\n          begin // * First element of p is lower (or same); * e must come from p. */\r\n          e:=p; inc(p); Dec(psize);\r\n          end\r\n        else\r\n          begin // * First element of q is lower; e must come from q. */\r\n          e := q; Inc(q); Dec(qsize);\r\n          end;\r\n        Result[Tail]:=aList[e];\r\n        Inc(tail);\r\n        end;\r\n      p:=q;\r\n      end;\r\n    // * If we have done only one merge, we're finished. */\r\n    if (nmerges <= 1) then  //* allow for nmerges==0, the empty list case */\r\n      exit;\r\n    // * Otherwise repeat, merging lists twice the size */\r\n    InSize:=Insize * 2;\r\n    // Swap lists for next round.\r\n    Temp:=Result;\r\n    Result:=aList;\r\n    aList:=Temp;\r\n  until false;\r\nend;\r\n\r\ndestructor TSortedJSONIndex.Destroy;\r\nbegin\r\n  FreeAndNil(FComparer);\r\n  Inherited;\r\nend;\r\n\r\nprocedure TSortedJSONIndex.CreateComparer(aIndex: TJSONIndexDef);\r\nbegin\r\n  FreeAndNil(FComparer);\r\n  FComparer:=TRecordComparer.Create(Dataset,aindex);\r\nend;\r\n\r\nprocedure TSortedJSONIndex.CreateIndex;\r\n\r\nVar\r\n  Lst : TJSArray;\r\n  Len : Integer;\r\nbegin\r\n  // CreateIndex is called during constructor. We cannot build index then, so we exit\r\n  if FComparer=Nil then\r\n    exit;\r\n  Len:=FRows.Length-1;\r\n  // Temp list, mergsort destroys list\r\n  Lst:=TJSArray.New(Len+1);\r\n  While Len>=0 do\r\n    begin\r\n    Lst[Len]:=Len;\r\n    Dec(Len);\r\n    end;\r\n  FList:=MergeSort(Lst);\r\nend;\r\n\r\nprocedure TSortedJSONIndex.AppendToIndex;\r\nbegin\r\n  // In theory, we could sort the rest of the list, and then merge the 2 sublists.\r\n  CreateIndex;\r\nend;\r\n\r\nfunction TSortedJSONIndex.FindPos(aRecordIndex: Integer): Integer;\r\n\r\nVar\r\n  L,R,I, CompareRes : Integer;\r\n\r\nbegin\r\n  if not Assigned(FComparer) then\r\n    exit;\r\n  L := 0;\r\n  R := Count - 1;\r\n  while (L<=R) do\r\n    begin\r\n    I := L + (R - L) div 2;\r\n    CompareRes := FComparer.CompareRows(aRecordIndex, Integer(Flist[I]));\r\n    if (CompareRes>0) then\r\n      L := I+1\r\n    else\r\n      begin\r\n      R := I-1;\r\n      if (CompareRes=0) then\r\n        begin\r\n        if Unique then\r\n          L := I; // forces end of while loop\r\n        end;\r\n      end;\r\n    end;\r\n  Result:=L;\r\nend;\r\n\r\nfunction TSortedJSONIndex.Append(aRecordIndex: Integer): Integer;\r\n\r\n\r\nbegin\r\n  Result:=FindPos(aRecordIndex);\r\n  // insert in list\r\n  FList.Splice(Result,0,aRecordIndex);\r\nend;\r\n\r\n\r\nfunction TSortedJSONIndex.FindRecord(aRecordIndex: Integer): Integer;\r\nbegin\r\n  Result:=FList.indexOf(aRecordIndex);\r\nend;\r\n\r\nfunction TSortedJSONIndex.Update(aRecordIndex: Integer): Integer;\r\n\r\nVar\r\n  aCurrentIndex : Integer;\r\n\r\nbegin\r\n  // Old pos\r\n  aCurrentIndex:=FindRecord(aRecordIndex);\r\n  // New pos\r\n  Result:=FindPos(aRecordIndex);\r\n  if Result<>aCurrentIndex then\r\n    FList.Splice(Result,0,FList.Splice(aCurrentIndex,1)[0])\r\nend;\r\n\r\n{ TFloatFieldComparer }\r\n\r\nfunction TFloatFieldComparer.Compare(RowIndex: Integer; aValue: JSValue): Integer;\r\nvar\r\n  D1,D2 : Double;\r\n\r\nbegin\r\n  D1:=Double(GetFieldValue(Rowindex));\r\n  D2:=Double(aValue);\r\n  Result:=Round(D1-D2);\r\nend;\r\n\r\n{ TDateTimeFieldComparer }\r\n\r\nfunction TDateTimeFieldComparer.Compare(RowIndex: Integer; aValue: JSValue): Integer;\r\n\r\nvar\r\n  D1,D2 : TDateTime;\r\n\r\nbegin\r\n  D1:=Dataset.ConvertDateTimeField(String(GetFieldValue(Rowindex)),Self.Field);\r\n  D2:=Dataset.ConvertDateTimeField(String(aValue),Self.Field);\r\n  Result:=Round(D1-D2);\r\nend;\r\n\r\n{ TBooleanFieldComparer }\r\n\r\nfunction TBooleanFieldComparer.Compare(RowIndex: Integer; aValue: JSValue): Integer;\r\n\r\nvar\r\n  B1,B2 : Boolean;\r\n\r\nbegin\r\n  B1:=Boolean(GetFieldValue(Rowindex));\r\n  B2:=Boolean(aValue);\r\n  Result:=Ord(B1)-Ord(B2);\r\nend;\r\n\r\n{ TNativeIntFieldComparer }\r\n\r\nfunction TNativeIntFieldComparer.Compare(RowIndex: Integer; aValue: JSValue): Integer;\r\n\r\nvar\r\n  I1,I2 : NativeInt;\r\n\r\nbegin\r\n  I1:=NativeInt(GetFieldValue(Rowindex));\r\n  I2:=NativeInt(aValue);\r\n  Result:=I1-I2;\r\nend;\r\n\r\n{ TStringFieldComparer }\r\n\r\nfunction TStringFieldComparer.Compare(RowIndex: Integer; aValue: JSValue): Integer;\r\n\r\nvar\r\n  S1,S2 : String;\r\n\r\nbegin\r\n  S1:=String(GetFieldValue(Rowindex));\r\n  S2:=String(aValue);\r\n  if loPartialKey in Options then\r\n    S1:=Copy(S1,1,Length(S2));\r\n  if loCaseInsensitive in options then\r\n    Result := CompareText(S1,S2)\r\n  else\r\n    Result := CompareStr(S1,S2);\r\nend;\r\n\r\n{ TFieldComparer }\r\n\r\nconstructor TFieldComparer.Create(aDataset: TBaseJSONDataset; aField: TField; aValue: JSValue; aOptions: TLocateOptions);\r\n\r\nbegin\r\n  FField:=AField;\r\n  FValue:=aValue;\r\n  FOptions:=aOptions;\r\n  FDataset:=aDataset;\r\nend;\r\n\r\nfunction TFieldComparer.GetFieldValue(RowIndex: integer): JSValue;\r\nbegin\r\n  Result:=FDataset.FieldMapper.GetJSONDataForField(FField,FDataset.FRows[Rowindex]);\r\nend;\r\n\r\nfunction TFieldComparer.CompareRows(RowIndex1, RowIndex2: Integer): Integer;\r\nbegin\r\n  Result:=Compare(RowIndex1,GetFieldValue(RowIndex2));\r\nend;\r\n\r\nfunction TFieldComparer.Compare(RowIndex: Integer): Integer;\r\nbegin\r\n  Result:=Compare(RowIndex,FValue);\r\nend;\r\n\r\n{ TRecordComparer }\r\n\r\nfunction TRecordComparer.GetFieldComparer(Index: Integer): TFieldComparer;\r\nbegin\r\n  if (Index<0) or (Index>=Length(Fitems)) then\r\n    Raise EListError.CreateFmt('Index out of bounds: %d not in [%d,%d]',[Index,0,Length(Fitems)-1]);\r\n  Result:=Items[Index];\r\nend;\r\n\r\nprocedure TRecordComparer.ConstructItems(aFields : String);\r\n\r\nVar\r\n  L : TFPlist;\r\n  FCC : TFieldComparerClass;\r\n  F : TField;\r\n  I : Integer;\r\n\r\n\r\nbegin\r\n  L:=TFPList.Create;\r\n  try\r\n    Dataset.GetFieldList(L,aFields);\r\n    if Not Indexbased and (L.Count<>Length(FValues)) then\r\n       Raise EDatabaseError.CreateFmt('Array of values has different length (%d) from array of fields (%d)',[Length(FValues), L.Count]);\r\n    SetLength(FItems,L.Count);\r\n    For I:=0 to L.Count-1 do\r\n      begin\r\n      F:=TField(L[i]);\r\n      FCC:=DataTypeToComparerClass(F.DataType);\r\n      If FCC=Nil then\r\n        Raise EDatabaseError.CreateFmt('Cannot locate on field %s of type %s)',[F.FieldName,GetEnumName(TypeInfo(TFieldType),Ord(F.DataType))]);\r\n      if IndexBased then\r\n        Fitems[i]:=FCC.Create(FDataset,F,Null,FOptions)\r\n      else\r\n        Fitems[i]:=FCC.Create(FDataset,F,FValues[i],FOptions);\r\n      end;\r\n  finally\r\n    L.Free;\r\n  end;\r\nend;\r\n\r\nfunction TRecordComparer.DataTypeToComparerClass(aFieldType: TFieldType): TFieldComparerClass;\r\n\r\nbegin\r\n  Case aFieldType of\r\n    ftMemo, ftFixedChar,ftString :\r\n      Result:=TStringFieldComparer;\r\n    ftAutoInc, ftInteger, ftLargeInt:\r\n      Result:=TNativeIntFieldComparer;\r\n    ftBoolean:\r\n      Result:=TBooleanFieldComparer;\r\n    ftFloat:\r\n      Result:=TFloatFieldComparer;\r\n    ftDate, ftTime, ftDateTime:\r\n      Result:=TDateTimeFieldComparer;\r\n  else\r\n   result:=Nil;\r\n  end;\r\nend;\r\n\r\nfunction TRecordComparer.Compare(aRowindex: integer): Integer;\r\n\r\nVar\r\n  I,L : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  I:=0;\r\n  L:=Length(FItems);\r\n  While (Result=0) and (I<L) do\r\n    begin\r\n    Result:=Fitems[i].Compare(aRowindex);\r\n    Inc(I);\r\n    end;\r\nend;\r\n\r\nfunction TRecordComparer.CompareRows(aRowindex1, aRowIndex2: integer): Integer;\r\n\r\nVar\r\n  I,L : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  I:=0;\r\n  L:=Length(FItems);\r\n  While (Result=0) and (I<L) do\r\n    begin\r\n    Result:=Fitems[i].CompareRows(aRowindex1,aRowIndex2);\r\n    if (Result<>0) and Fitems[i].Desc then\r\n      Result:=-Result;\r\n    Inc(I);\r\n    end;\r\nend;\r\n\r\nprocedure TRecordComparer.updateFromIndex(aIndex: TJSONIndexDef);\r\n\r\nVar\r\n  L : TFPList;\r\n  I : Integer;\r\n\r\nbegin\r\n  L:=TFPList.Create;\r\n  try\r\n    if (aIndex.CaseInsFields<>'') then\r\n      begin\r\n      Dataset.GetFieldList(L,aIndex.CaseInsFields);\r\n      for I:=0 to Length(FItems)-1 do\r\n        if L.IndexOf(FItems[i].Field)<>-1 then\r\n          Fitems[i].Options:=Fitems[i].Options+[loCaseInsensitive];\r\n      end;\r\n    L.Clear;\r\n    Dataset.GetFieldList(L,aIndex.DescFields);\r\n    for I:=0 to Length(FItems)-1 do\r\n      Fitems[i].Desc:=(ixDescending in aIndex.Options) or (L.IndexOf(FItems[i].Field)<>-1);\r\n  finally\r\n    L.Free;\r\n  end;\r\nend;\r\n\r\nconstructor TRecordComparer.Create(aDataset: TBaseJSONDataset; aFields: String; aValues: JSValue; aOptions: TLocateOptions);\r\nbegin\r\n  FDataset:=aDataset;\r\n  if isArray(aValues) then\r\n    FValues:=TJSValueDynArray(aValues)\r\n  else\r\n    begin\r\n    SetLength(FValues,1);\r\n    FValues[0]:=Avalues;\r\n    end;\r\n  Foptions:=aOptions;\r\n  ConstructItems(aFields);\r\nend;\r\n\r\nconstructor TRecordComparer.Create(aDataset: TBaseJSONDataset; aIndex: TJSONIndexDef);\r\nbegin\r\n  FDataset:=aDataset;\r\n  FIndexBased:=True;\r\n  if ixCaseInsensitive in aIndex.Options then\r\n    FOptions:=[loCaseInsensitive];\r\n  ConstructItems(aIndex.Fields);\r\n  UpdateFromIndex(aIndex);\r\nend;\r\n\r\ndestructor TRecordComparer.Destroy;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  For I:=0 to Length(FItems)-1 do\r\n    FItems[i].Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n{ TDefaultJSONIndex }\r\n\r\nprocedure TDefaultJSONIndex.CreateIndex;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  For I:=0 to FRows.length-1 do\r\n    FList[i]:=I;\r\nend;\r\n\r\nprocedure TDefaultJSONIndex.AppendToIndex;\r\n\r\nVar\r\n  I,L : Integer;\r\n\r\nbegin\r\n  L:=FList.Length;\r\n  FList.Length:=FRows.Length;\r\n  For I:=L to FRows.Length-1 do\r\n    FList[i]:=I;\r\nend;\r\n\r\nfunction TDefaultJSONIndex.Append(aRecordIndex: Integer): Integer;\r\nbegin\r\n  Result:=FList.Push(aRecordIndex)-1;\r\nend;\r\n\r\nfunction TDefaultJSONIndex.Insert(aCurrentIndex, aRecordIndex: Integer\r\n  ): Integer;\r\nbegin\r\n  FList.splice(aCurrentIndex, 0, aRecordIndex);\r\n  Result:=aCurrentIndex;\r\nend;\r\n\r\nfunction TDefaultJSONIndex.FindRecord(aRecordIndex: Integer): Integer;\r\nbegin\r\n  Result:=FList.indexOf(aRecordIndex);\r\nend;\r\n\r\nfunction TDefaultJSONIndex.Update(aRecordIndex: Integer\r\n  ): Integer;\r\nbegin\r\n  Result:=aRecordIndex;\r\nend;\r\n\r\n{ TJSONIndex }\r\n\r\nconstructor TJSONIndex.Create(aDataset: TBaseJSONDataset; aRows: TJSArray);\r\nbegin\r\n  FRows:=aRows;\r\n  FList:=TJSArray.New(FRows.length);\r\n  FDataset:=aDataset;\r\n  CreateIndex;\r\nend;\r\n\r\nfunction TJSONIndex.Delete(aListIndex: Integer): Integer;\r\n\r\nVar\r\n  a : TJSArray;\r\n\r\nbegin\r\n  A:=FList.Splice(aListIndex,1);\r\n  If a.Length>0 then\r\n    Result:=Integer(A[0])\r\n  else\r\n    Result:=-1;\r\nend;\r\n\r\nfunction TJSONIndex.Insert(aCurrentIndex, aRecordIndex: Integer): Integer;\r\nbegin\r\n  Result:=Append(aRecordIndex);\r\nend;\r\n\r\nfunction TJSONIndex.GetCount: Integer;\r\nbegin\r\n  Result:=FList.Length;\r\nend;\r\n\r\nprocedure TJSONIndex.ClearIndex;\r\nbegin\r\n  FList.Length:=0;\r\nend;\r\n\r\nfunction TJSONIndex.GetRecordIndex(aListIndex : Integer): NativeInt;\r\nbegin\r\n  if isUndefined(FList[aListIndex]) then\r\n    Result:=-1\r\n  else\r\n    Result:=NativeInt(FList[aListIndex]);\r\nend;\r\n\r\n\r\n\r\n{ TJSONFieldMapper }\r\n\r\nfunction TJSONFieldMapper.GetJSONDataForField(F: TField; Row: JSValue  ): JSValue;\r\nbegin\r\n  // This supposes that Index is correct, i.e. the field positions have not been changed.\r\n  Result:=GetJSONDataForField(F.FieldName,F.Index,Row);\r\nend;\r\n\r\nprocedure TJSONFieldMapper.SetJSONDataForField(F: TField; Row,Data: JSValue);\r\nbegin\r\n  SetJSONDataForField(F.FieldName,F.Index,Row,Data);\r\nend;\r\n\r\n\r\n{ TJSONArrayFieldMapper }\r\n\r\nprocedure TJSONArrayFieldMapper.RemoveField(const FieldName: String; FieldIndex: Integer; Row: JSValue);\r\nbegin\r\n  TJSArray(Row).Splice(FieldIndex,1);\r\nend;\r\n\r\nprocedure TJSONArrayFieldMapper.SetJSONDataForField(const FieldName: String;\r\n  FieldIndex: Integer; Row, Data: JSValue);\r\nbegin\r\n  TJSValueDynArray(Row)[FieldIndex]:=Data;\r\nend;\r\n\r\nfunction TJSONArrayFieldMapper.GetJSONDataForField(const FieldName: String; FieldIndex: Integer; Row: JSValue): JSValue;\r\nbegin\r\n  Result:=TJSValueDynArray(Row)[FieldIndex];\r\nend;\r\n\r\nfunction TJSONArrayFieldMapper.CreateRow: JSValue;\r\n\r\nbegin\r\n  Result:=TJSArray.New;\r\nend;\r\n\r\n{ TJSONObjectFieldMapper }\r\n\r\nprocedure TJSONObjectFieldMapper.RemoveField(const FieldName: String; FieldIndex: Integer; Row: JSValue);\r\nbegin\r\n  jsDelete(Row,FieldName);\r\nend;\r\n\r\nprocedure TJSONObjectFieldMapper.SetJSONDataForField(const FieldName: String;\r\n  FieldIndex: Integer; Row, Data: JSValue);\r\nbegin\r\n  TJSObject(Row).Properties[FieldName]:=Data;\r\nend;\r\n\r\nfunction TJSONObjectFieldMapper.GetJSONDataForField(const FieldName: String;\r\n  FieldIndex: Integer; Row: JSValue): JSValue;\r\nbegin\r\n  Result:=TJSObject(Row).Properties[FieldName];\r\nend;\r\n\r\nfunction TJSONObjectFieldMapper.CreateRow: JSValue;\r\nbegin\r\n  Result:=TJSObject.New;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetMetaData(AValue: TJSObject);\r\nbegin\r\n  CheckInActive;\r\n  FMetaData:=AValue;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetIndexes(AValue: TJSONIndexDefs);\r\nbegin\r\n  if FIndexes=AValue then Exit;\r\n  FIndexes.Assign(aValue);\r\n  if Active then\r\n    BuildIndexes;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetActiveIndex(AValue: String);\r\n\r\n\r\nbegin\r\n  if FActiveIndex=AValue then Exit;\r\n  FActiveIndex:=AValue;\r\n  if (csLoading in ComponentState) then\r\n    exit;\r\n  ActivateIndex(Active);\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.ActivateIndex(Build : Boolean);\r\n\r\nVar\r\n  Idx : TJSONIndexDef;\r\n\r\nbegin\r\n  if (FActiveIndex<>'') then\r\n    Idx:=FIndexes.Find(FActiveIndex) as TJSONIndexDef\r\n  else\r\n    Idx:=nil;\r\n  if Idx=Nil then\r\n    FCurrentIndex:=FDefaultIndex\r\n  else\r\n    begin\r\n    if (Idx.Index=Nil) and Build then\r\n      Idx.BuildIndex(Self);\r\n    FCurrentIndex:=Idx.Index;\r\n    end;\r\n  if Active then\r\n    Resync([rmCenter]);\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.AddToRows(AValue: TJSArray);\r\n\r\nbegin\r\n  if FRows=Nil then\r\n    FRows:=AValue\r\n  else\r\n    begin\r\n    FRows:=FRows.Concat(AValue);\r\n    AppendToIndexes;\r\n    end;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetRows(AValue: TJSArray);\r\nbegin\r\n  if AValue=FRows then exit;\r\n  CheckInActive;\r\n  FRows:=Nil;\r\n  AddToRows(AValue);\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetRowType(AValue: TJSONRowType);\r\nbegin\r\n  if FRowType=AValue then Exit;\r\n  CheckInactive;\r\n  FRowType:=AValue;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.ConvertDateTimeToNative(aField : TField; aValue: TDateTime): JSValue;\r\nbegin\r\n  if jsISNan(aValue) then\r\n    Result:=Null\r\n  else\r\n    Result:=FormatDateTimeField(aValue,aField)\r\nend;\r\n\r\n\r\nfunction TBaseJSONDataSet.AllocRecordBuffer: TDataRecord;\r\nbegin\r\n  Result.data:=TJSObject.New;\r\n  Result.bookmark:=null;\r\n  Result.state:=rsNew;\r\nend;\r\n\r\n// the next two are particularly ugly.\r\nprocedure TBaseJSONDataSet.InternalInitRecord(var Buffer: TDataRecord);\r\nbegin\r\n//  Writeln('TBaseJSONDataSet.InternalInitRecord');\r\n  Buffer.Data:=FFieldMapper.CreateRow;\r\n  Buffer.bookmark:=null;\r\n  Buffer.state:=rsNew;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.FreeRecordBuffer (var Buffer: TDataRecord);\r\nbegin\r\n  Buffer.Data:=Null;\r\n  Buffer.bookmark:=null;\r\n  Buffer.state:=rsNew;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.GetBookmarkData(Buffer: TDataRecord; var Data: TBookmark);\r\nbegin\r\n   Data.Data:=Buffer.bookmark;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.GetBookmarkFlag(Buffer: TDataRecord): TBookmarkFlag;\r\nbegin\r\n  Result :=Buffer.BookmarkFlag;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.GetRecNo: Integer;\r\n\r\nVar\r\n  bkmIdx : Integer;\r\n\r\nbegin\r\n  bkmIdx:=Integer(ActiveBuffer.bookmark);\r\n  Result:=FCurrentIndex.FindRecord(bkmIdx)+1;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalInitFieldDefs;\r\nbegin\r\n  If Assigned(FMetaData) then\r\n    MetaDataToFieldDefs;\r\n  if (FieldDefs.Count=0) then\r\n    Raise EJSONDataset.Create('No fields found');\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.FreeData;\r\nvar\r\n  I : integer;\r\n\r\nbegin\r\n  if FOwnsData then\r\n    begin\r\n    FRows:=Nil;\r\n    FMetaData:=Nil;\r\n    end;\r\n  For I:=0 to FIndexes.Count-1 do\r\n    FIndexes[i].ClearIndex;\r\n  FCurrentIndex:=Nil;\r\n  FreeAndNil(FDefaultindex);\r\n  FreeAndNil(FFieldMapper);\r\n  FCurrentIndex:=Nil;\r\n  FDeletedRows:=Nil;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.AppendToIndexes;\r\n\r\nbegin\r\n  FDefaultIndex.AppendToIndex;\r\n  if Assigned(FCurrentIndex) and (FCurrentIndex<>FDefaultIndex) then\r\n    FCurrentIndex.AppendToIndex;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.CreateIndexes;\r\n\r\nbegin\r\n  FDefaultIndex:=TDefaultJSONIndex.Create(Self,FRows);\r\n  AppendToIndexes;\r\n  if FCurrentIndex=Nil then\r\n    FCurrentIndex:=FDefaultIndex;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.FilterExpressionClass : TFPExpressionParserClass;\r\n\r\nbegin\r\n  Result:=TFPExpressionParser;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.GetFilterIsNull(const Args: TExprParameterArray): TFPExpressionResult;\r\n\r\nbegin\r\n  Result.ResultType:=rtBoolean;\r\n  Result.ResValue:=FieldByName(String(Args[0].resValue)).IsNull;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.FieldTypeToExpressionType(aDataType : TFieldType) : TResultType;\r\n\r\nbegin\r\n  Case aDataType of\r\n    ftMemo,\r\n    ftFixedChar,\r\n    ftString : Result:=rtString;\r\n    ftInteger,\r\n    ftAutoInc,\r\n    ftLargeInt : Result:=rtInteger;\r\n    ftBoolean : Result:=rtBoolean;\r\n    ftFloat : Result:=rtFloat;\r\n    ftDate,\r\n    ftTime,\r\n    ftDateTime : Result:=rtDateTime;\r\n  else\r\n    DatabaseErrorFmt('Fields of type %s are not supported in filter expressions.',[Fieldtypenames[aDataType]],Self);\r\n  end;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.GetFilterField(const AName: String): TFPExpressionResult;\r\n\r\nVar\r\n  F : TField;\r\n  C : Currency;\r\n\r\nbegin\r\n  F:=FieldByName(aName);\r\n  Result.resultType:=FieldTypeToExpressionType(F.DataType);\r\n  case Result.resultType of\r\n    rtBoolean : Result.resValue:=F.AsBoolean;\r\n    rtInteger : Result.resValue:=F.AsLargeInt;\r\n    rtFloat : Result.resValue:=F.AsFloat;\r\n    rtDateTime : Result.resValue:=F.AsDateTime;\r\n    rtString : Result.resValue:=F.AsString;\r\n    rtCurrency :\r\n      begin\r\n      C:=Currency(F.AsFloat);\r\n      Result.resValue:=C;\r\n      end;\r\n  end;\r\n//  Writeln('Filtering field ',aName,'value: ',result.resValue);\r\nend;\r\n\r\n\r\nfunction TBaseJSONDataSet.CreateFilterExpression : TFPExpressionParser;\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Result:=FilterExpressionClass.Create(Self);\r\n  for I:=0 to Fields.Count-1 do\r\n    Result.Identifiers.AddVariable(Fields[i].FieldName,FieldTypeToExpressionType(Fields[i].DataType),@GetFilterField);\r\n  Result.Identifiers.AddFunction('IsNull','B','S',@GetFilterIsNull);\r\n  Result.Expression:=Filter;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.DoFilterRecord : Boolean;\r\n\r\nVar\r\n  DS : TDatasetState;\r\n\r\nbegin\r\n  // Writeln('Filtering');\r\n  Result:=True;\r\n  DS:=SetTempState(dsFilter);\r\n  try\r\n    if Assigned(OnFilterRecord) then\r\n      begin\r\n      OnFilterRecord(Self,Result);\r\n      if Not Result then\r\n        Exit;\r\n      end;\r\n    if not Filtered or (Filter='') then\r\n      Exit;\r\n    if (FFilterExpression=Nil) then\r\n      FFilterExpression:=CreateFilterExpression;\r\n    Result:=FFilterExpression.AsBoolean;\r\n  finally\r\n    RestoreState(DS);\r\n  end;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.GetRecord(var Buffer: TDataRecord; GetMode: TGetMode; DoCheck: Boolean): TGetResult;\r\n\r\nVar\r\n  BkmIdx : Integer;\r\n  recordAccepted : Boolean;\r\nbegin\r\n  Result := grOK; // default\r\n  Repeat\r\n    recordAccepted:=True;\r\n    case GetMode of\r\n      gmNext: // move on\r\n        if fCurrent < fCurrentIndex.Count - 1 then\r\n          Inc (fCurrent)\r\n        else\r\n          Result := grEOF; // end of file\r\n      gmPrior: // move back\r\n        if fCurrent > 0 then\r\n          Dec (fCurrent)\r\n        else\r\n          Result := grBOF; // begin of file\r\n      gmCurrent: // check if empty\r\n        if (FCurrent<0) or (fCurrent >= fCurrentIndex.Count) then\r\n          Result := grEOF;\r\n    end;\r\n    if Result = grOK then // read the data\r\n      begin\r\n      BkmIdx:=FCurrentIndex.RecordIndex[FCurrent];\r\n      Buffer.Data:=FRows[bkmIdx];\r\n      Buffer.BookmarkFlag := bfCurrent;\r\n      Buffer.Bookmark:=BkmIdx;\r\n      CalculateFields(Buffer);\r\n      if Filtered then\r\n        begin\r\n        FFilterRow:=Buffer.Data;\r\n        recordAccepted:=DoFilterRecord;\r\n        if Not RecordAccepted and (GetMode=gmCurrent) then\r\n          begin\r\n          // Transform to EOF.\r\n          RecordAccepted:=True;\r\n          Result:=grEOF;\r\n          end;\r\n        end;\r\n      end;\r\n  until recordAccepted;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.GetRecordCount: Integer;\r\nbegin\r\n  if Assigned(FCurrentIndex) then\r\n    Result:=FCurrentIndex.Count\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.GetRecordSize: Word;\r\nbegin\r\n  Result := 0; // actual data without house-keeping\r\nend;\r\n\r\n\r\nprocedure TBaseJSONDataSet.InternalClose;\r\nbegin\r\n  // disconnect and destroy field objects\r\n  BindFields (False);\r\n  if DefaultFields then\r\n    DestroyFields;\r\n  FreeData;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalDelete;\r\n\r\nVar\r\n  Idx : Integer;\r\n\r\nbegin\r\n  Idx:=FCurrentIndex.Delete(FCurrent);\r\n  if (Idx<>-1) then\r\n    begin\r\n    // Add code here to Delete from other indexes as well.\r\n    // ...\r\n    // Add to array of deleted records.\r\n    if Not Assigned(FDeletedRows) then\r\n      FDeletedRows:=TJSArray.New(FRows[idx])\r\n    else\r\n      FDeletedRows.Push(FRows[Idx]);\r\n    FRows[Idx]:=Undefined;\r\n    end;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalFirst;\r\nbegin\r\n  FCurrent := -1;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalGotoBookmark(ABookmark: TBookmark);\r\nbegin\r\n  if isNumber(ABookmark.Data) then\r\n    FCurrent:=FCurrentIndex.FindRecord(Integer(ABookmark.Data));\r\n//  Writeln('Fcurrent', FCurrent,' from ',ABookmark.Data);\r\nend;\r\n\r\n\r\nprocedure TBaseJSONDataSet.InternalInsert;\r\n\r\nVar\r\n  I : Integer;\r\n  D : TFieldDef;\r\n\r\nbegin\r\n//  Writeln('TBaseJSONDataSet.InternalInsert');\r\n  FEditRow:=ActiveBuffer.Data;\r\n  For I:=0 to FieldDefs.Count-1 do\r\n    begin\r\n    D:=FieldDefs[i];\r\n    FFieldMapper.SetJSONDataForField(D.Name,D.Index,FEditRow,Null);\r\n    end;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.RemoveCalcFields(Buf : JSValue);\r\n\r\nVar\r\n  i : integer;\r\n\r\nbegin\r\n  For I:=0 to Fields.Count-1 do\r\n    if Fields[i].FieldKind in [fkCalculated,fkInternalCalc] then\r\n      FieldMapper.RemoveField(FIelds[i].FieldName,FIelds[i].Index,Buf);\r\n\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalEdit;\r\n\r\nbegin\r\n//  Writeln('TBaseJSONDataSet.InternalEdit:  ');\r\n  FEditIdx:=FCurrentIndex.RecordIndex[FCurrent];\r\n  if not isUndefined(Rows[FEditIdx]) then\r\n    begin\r\n    FEditRow:=TJSJSON.parse(TJSJSON.stringify(Rows[FEditIdx]));\r\n    RemoveCalcFields(FEditRow);\r\n    end\r\n  else\r\n    FEditRow:=TJSObject.new;\r\n//  Writeln('TBaseJSONDataSet.InternalEdit: ',FEditRow);\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalCancel;\r\nbegin\r\n  FEditIdx:=-1;\r\n  FEditRow:=Nil;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalLast;\r\nbegin\r\n  // The first thing that will happen is a GetPrior Record.\r\n  FCurrent:=FCurrentIndex.Count;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InitDateTimeFields;\r\n\r\nbegin\r\n  // Do nothing\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalOpen;\r\nbegin\r\n  FreeAndNil(FFieldMapper);\r\n  FFieldMapper:=CreateFieldMapper;\r\n  IF (FRows=Nil) then // opening from fielddefs ?\r\n    begin\r\n    FRows:=TJSArray.New;\r\n    OwnsData:=True;\r\n    end;\r\n  CreateIndexes;\r\n  InternalInitFieldDefs;\r\n  if DefaultFields then\r\n    CreateFields;\r\n  BindFields (True);\r\n  InitDateTimeFields;\r\n  if FActiveIndex<>'' then\r\n    ActivateIndex(True);\r\n  FCurrent := -1;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalPost;\r\n\r\nVar\r\n  I,NewIdx,NewCurrent,Idx : integer;\r\n  B : TBookmark;\r\n\r\nbegin\r\n  NewCurrent:=-1;\r\n  GetBookMarkData(ActiveBuffer,B);\r\n  if (State=dsInsert) then\r\n    begin // Insert or Append\r\n    Idx:=FRows.push(FEditRow)-1;\r\n    if GetBookMarkFlag(ActiveBuffer)=bfEOF then\r\n      begin // Append\r\n      FDefaultIndex.Append(Idx);\r\n      for I:=0 to FIndexes.Count-1 do\r\n\t    if Assigned(FIndexes[i].Findex) then\r\n          begin\r\n          NewIdx:=FIndexes[i].Findex.Append(Idx);\r\n          if FIndexes[i].Findex=FCurrentIndex then\r\n            NewCurrent:=NewIdx;\r\n          end;\r\n      end\r\n    else  // insert\r\n      begin\r\n      FCurrent:=FDefaultIndex.Insert(FCurrent,Idx);\r\n      for I:=0 to FIndexes.Count-1 do\r\n\t    if Assigned(FIndexes[i].Findex) then\r\n          begin\r\n          NewIdx:=FIndexes[i].Findex.Append(Idx);\r\n          if FIndexes[i].Findex=FCurrentIndex then\r\n            NewCurrent:=NewIdx;\r\n          end;\r\n      end;\r\n    end\r\n  else\r\n    begin // Edit\r\n    if (FEditIdx=-1) then\r\n      DatabaseErrorFmt('Failed to retrieve record index for record %d',[FCurrent]);\r\n    // Update source record\r\n    Idx:=FEditIdx;\r\n    FRows[Idx]:=FEditRow;\r\n    FDefaultIndex.Update(Idx);\r\n    // Must replace this by updating all indexes.\r\n    // Note that this will change current index.\r\n    for I:=0 to FIndexes.Count-1 do\r\n      begin\r\n      // Determine old index.\r\n      NewIdx:=FCurrentIndex.Update(Idx);\r\n      if Assigned(FIndexes[i].Findex) then\r\n        if FIndexes[i].Findex=FCurrentIndex then\r\n          NewCurrent:=NewIdx;\r\n      end;\r\n    end;\r\n  // We have an active index, set current to that index.\r\n  if NewCurrent<>-1 then\r\n    FCurrent:=NewCurrent;\r\n  FEditIdx:=-1;\r\n  FEditRow:=Nil;\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.InternalSetToRecord(Buffer: TDataRecord);\r\nbegin\r\n  FCurrent:=FCurrentIndex.FindRecord(Integer(Buffer.Bookmark));\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetFilterText(const Value: string);\r\nbegin\r\n  inherited SetFilterText(Value);\r\n  FreeAndNil(FFilterExpression);\r\n  if Active then\r\n    Resync([rmCenter]);\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetFiltered(Value: Boolean);\r\nbegin\r\n  inherited SetFiltered(Value);\r\n  FreeAndNil(FFilterExpression);\r\n  if Active then\r\n    Resync([rmCenter]);\r\nend;\r\n\r\nfunction TBaseJSONDataSet.GetFieldClass(FieldType: TFieldType): TFieldClass;\r\nbegin\r\n  If UseDateTimeFormatFields and (FieldType in [ftDate,ftDateTime,ftTime]) then\r\n    case FieldType of\r\n      ftDate : Result:=TJSONDateField;\r\n      ftDateTime : Result:=TJSONDateTimeField;\r\n      ftTime : Result:=TJSONTimeField;\r\n    end\r\n  else\r\n    Result:=inherited GetFieldClass(FieldType);\r\nend;\r\n\r\nfunction TBaseJSONDataSet.IsCursorOpen: Boolean;\r\nbegin\r\n  Result := Assigned(FDefaultIndex);\r\nend;\r\n\r\nfunction TBaseJSONDataSet.BookmarkValid(ABookmark: TBookmark): Boolean;\r\nbegin\r\n  Result:=isNumber(ABookmark.Data);\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetBookmarkData(var Buffer: TDataRecord;  Data: TBookmark);\r\nbegin\r\n  Buffer.Bookmark:=Data.Data;\r\n//  Writeln('Set Bookmark from: ',Data.Data);\r\nend;\r\n\r\nfunction TBaseJSONDataSet.ConvertDateTimeField(S : String; F : TField) : TDateTime;\r\n\r\nVar\r\n  Ptrn : string;\r\n\r\nbegin\r\n  Result:=0;\r\n  Ptrn:='';\r\n  Case F.DataType of\r\n    ftDate : if F is TJSONDateField then\r\n               Ptrn:=(F as TJSONDateField).DateFormat;\r\n    ftTime : if F is TJSONTimeField then\r\n               Ptrn:=(F as TJSONTimeField).TimeFormat;\r\n    ftDateTime : if F is TJSONDateTimeField then\r\n               Ptrn:=(F as TJSONDateTimeField).DateTimeFormat;\r\n  end;\r\n  If (Ptrn='') then\r\n    Result := DefaultConvertToDateTime(F,S,True)\r\n  else\r\n    Result:=ScanDateTime(ptrn,S,1);\r\nend;\r\n\r\nfunction TBaseJSONDataSet.FormatDateTimeField(DT: TDateTime; F: TField\r\n  ): String;\r\n\r\nVar\r\n  Ptrn : string;\r\nbegin\r\n  Result:='';\r\n  Ptrn:='';\r\n  Case F.DataType of\r\n    ftDate : if F is TJSONDateField then\r\n                Ptrn:=TJSONDateField(F).DateFormat;\r\n    ftTime : if F is TJSONTimeField then\r\n                Ptrn:=TJSONTimeField(F).TimeFormat;\r\n    ftDateTime : if F is TJSONDateTimeField then\r\n                Ptrn:=TJSONDateTimeField(F).DateTimeFormat;\r\n  end;\r\n  If (Ptrn='') then\r\n    Result := DateTimeToRFC3339(DT)\r\n  else\r\n    Result:=FormatDateTime(ptrn,DT);\r\nend;\r\n\r\nfunction TBaseJSONDataSet.CreateFieldMapper: TJSONFieldMapper;\r\nbegin\r\n  if FRowType=rtJSONArray then\r\n    Result:=TJSONArrayFieldMapper.Create\r\n  else\r\n    Result:=TJSONObjectFieldMapper.Create;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.GetFieldData(Field: TField; Buffer: TDatarecord): JSValue;\r\n\r\nvar\r\n  R : JSValue;\r\n\r\nbegin\r\n  if State in [dsCalcFields,dsInternalCalc] then\r\n    R:=CalcBuffer.data\r\n  else if (State=dsFilter) then\r\n    R:=FFilterRow\r\n  else if (FEditIdx=Buffer.Bookmark) then\r\n    begin\r\n    if State=dsOldValue then\r\n      R:=Buffer.data\r\n    else\r\n      R:=FEditRow\r\n    end\r\n  else\r\n    begin\r\n    if State=dsOldValue then\r\n      Exit(Null)\r\n    else\r\n      R:=Buffer.data;\r\n    end;\r\n  Result:=FFieldMapper.GetJSONDataForField(Field,R);\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetFieldData(Field: TField; var Buffer: TDatarecord; AValue : JSValue);\r\n\r\nvar\r\n  R : JSValue;\r\n\r\nbegin\r\n  if State in [dsCalcFields,dsInternalCalc] then\r\n    R:=CalcBuffer.Data\r\n  else\r\n    R:=FEditRow;\r\n  FFieldMapper.SetJSONDataForField(Field,R,AValue);\r\n  \r\n  if not(State in [dsCalcFields, dsInternalCalc, dsFilter, dsNewValue]) then\r\n    DataEvent(deFieldChange, Field);\r\n\r\n  SetModified(True);\r\n//  FFieldMapper.SetJSONDataForField(Field,Buffer.Data,AValue);\r\nend;\r\n\r\nprocedure TBaseJSONDataSet.SetBookmarkFlag(var Buffer: TDataRecord; Value: TBookmarkFlag);\r\n\r\nbegin\r\n  Buffer.BookmarkFlag := Value;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.CompareBookmarks(Bookmark1, Bookmark2: TBookmark): Longint;\r\n\r\nbegin\r\n  if isNumber(Bookmark1.Data) and isNumber(Bookmark2.Data) then\r\n    Result := Integer(Bookmark2.Data) - Integer(Bookmark1.Data)\r\n  else\r\n  begin\r\n    if isNumber(Bookmark1.Data) then\r\n      Result := -1\r\n    else\r\n    if isNumber(Bookmark2.Data) then\r\n      Result := 1\r\n    else\r\n      Result := 0;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TBaseJSONDataSet.SetRecNo(Value: Integer);\r\nbegin\r\n  if (Value < 1) or (Value > FCurrentIndex.Count) then\r\n    raise EJSONDataset.CreateFmt('%s: SetRecNo: index %d out of range',[Name,Value]);\r\n  FCurrent := Value - 1;\r\n  Resync([]); \r\n  DoAfterScroll;\r\nend;\r\n\r\nconstructor TBaseJSONDataSet.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FownsData:=True;\r\n  UseDateTimeFormatFields:=False;\r\n  FEditIdx:=-1;\r\n  FIndexes:=CreateIndexDefs;\r\nend;\r\n\r\ndestructor TBaseJSONDataSet.Destroy;\r\nbegin\r\n  Close;\r\n  FreeAndNil(FFilterExpression);\r\n  FreeAndNil(FIndexes);\r\n  FEditIdx:=-1;\r\n  inherited;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.CreateIndexDefs: TJSONIndexDefs;\r\n\r\nbegin\r\n  Result:=TJSONIndexDefs.Create(Self,Self,TJSONIndexDef);\r\nend;\r\n\r\n\r\nprocedure TBaseJSONDataSet.BuildIndexes;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  For I:=0 to FIndexes.Count-1 do\r\n    FIndexes[i].BuildIndex(Self);\r\nend;\r\n\r\nfunction TBaseJSONDataSet.RecordComparerClass : TRecordComparerClass;\r\n\r\nbegin\r\n  Result:=TRecordComparer;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.LocateRecordIndex(const KeyFields: string; const KeyValues: JSValue; Options: TLocateOptions): Integer;\r\n\r\nVar\r\n  Comp : TRecordComparer;\r\n  RI,I : Integer;\r\n\r\nbegin\r\n  Result:=-1;\r\n  Comp:=RecordComparerClass.Create(Self,KeyFields,KeyValues,Options);\r\n  try\r\n    if loFromCurrent in Options then\r\n      I:=FCurrent\r\n    else\r\n      I:=0;\r\n    RI:=FCurrentIndex.GetRecordIndex(I);\r\n    While (Result=-1) and (RI<>-1) do\r\n      begin\r\n      if Comp.Compare(RI)=0 then\r\n        Result:=RI;\r\n      inc(I);\r\n      RI:=FCurrentIndex.GetRecordIndex(I);\r\n      end;\r\n  finally\r\n    Comp.Free;\r\n  end;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.Locate(const KeyFields: string; const KeyValues: JSValue; Options: TLocateOptions): boolean;\r\n\r\nVar\r\n  I : Integer;\r\n  BM : TBookMark;\r\n\r\nbegin\r\n  Result:=Inherited;\r\n  I:=LocateRecordIndex(KeyFields,KeyValues,Options);\r\n  Result:=I<>-1;\r\n  if Result then\r\n    begin\r\n    // Construct bookmark.\r\n    // Bookmark is always the index in the FRows array.\r\n    BM.Data:=I;\r\n    BM.Flag:=bfCurrent;\r\n    GotoBookMark(BM);\r\n    end;\r\nend;\r\n\r\nfunction TBaseJSONDataSet.Lookup(const KeyFields: string; const KeyValues: JSValue; const ResultFields: string): JSValue;\r\n\r\nVar\r\n  RI,I : Integer;\r\n  l : TFPList;\r\n  Vals : TJSValueDynArray;\r\n\r\nbegin\r\n  Result:=Null;\r\n  l:=TFPList.Create;\r\n  try\r\n    GetFieldList(L,ResultFields);\r\n    Result:=inherited Lookup(KeyFields, KeyValues, ResultFields);\r\n    RI:=LocateRecordIndex(KeyFields,KeyValues,[]);\r\n    Result:=RI<>-1;\r\n    if Result then\r\n      begin\r\n      SetLength(Vals,L.Count);\r\n      For I:=0 to L.Count-1 do\r\n        Vals[i]:=FFieldMapper.GetJSONDataForField(TField(L[I]),FRows[RI]);\r\n      if L.Count=1 then\r\n        Result:=Vals[i]\r\n      else\r\n        Result:=Vals;\r\n      end;\r\n  finally\r\n    L.Free;\r\n  end;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2019                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.DB;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, DB, jsondataset;\r\n\r\ntype\r\n  TWebDataSource = class(TDataSource);\r\n\r\nimplementation\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.CDS;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, DB, jsondataset, Web, js, WEBLib.Controls;\r\n\r\ntype\r\n  TCustomClientDataSet = class;\r\n\r\n  TClientDataSource = class(TDataSource)\r\n  end;\r\n\r\n  TConnectErrorEvent = procedure(Sender: TObject; ErrorCode: integer) of object;\r\n\r\n  TURLType = (utGet,utPost,utPut,utDelete);\r\n\r\n  TClientConnectionGetURLEvent = procedure(Sender: TObject; Dataset : TDataset; urlType : TURLType; Var URL : String) of object;\r\n\r\n  TGetUpdatePayloadEvent = procedure(Sender : TObject; Dataset : TDataset; urlType : TURLType; Data : JSValue; out aPayLoad : String) of object;\r\n\r\n  TGetDataPayloadEvent = procedure(Sender : TObject; Dataset : TDataset; urlType : TURLType; var aPayLoad : JSValue) of object;\r\n\r\n  TProcessMetaDataEvent =  procedure(Sender : TObject; Dataset : TDataset; FieldDefs : TFieldDefs; aMetaData : TJSObject) of object;\r\n\r\n  TDataReceivedEvent = procedure(Sender: TObject; ARequest: TJSXMLHttpRequest; var AResponse: string) of object;\r\n\r\n  TClientConnection = class(TComponent)\r\n  private\r\n    FDataProxy: TDataProxy;\r\n    FActive: boolean;\r\n    FURI: string;\r\n    FDS: TCustomClientDataSet;\r\n    FDataNode: string;\r\n    FAutoOpen: boolean;\r\n    FUpdateCount: integer;\r\n    FOnConnectError: TConnectErrorEvent;\r\n    FBeforeConnect: TNotifyEvent;\r\n    FAfterConnect: TNotifyEvent;\r\n    FHeaders: TStringList;\r\n    FPassword: string;\r\n    FUser: string;\r\n    FOnGetURL: TClientConnectionGetURLEvent;\r\n    FPageParam: string;\r\n    FOnGetUpdatePayLoad: TGetUpdatePayloadEvent;\r\n    FAppendKeyToURL: boolean;\r\n    FOnGetDataPayLoad: TGetDataPayloadEvent;\r\n    FMetaDataNode: string;\r\n    FOnProcessMetaData: TProcessMetadataEvent;\r\n    FOnDataReceived: TDataReceivedEvent;\r\n    procedure SetHeaders(const Value: TStringList);\r\n    function GetPageURL(aRequest: TDataRequest): String;\r\n    function GetRecordUpdateURL(aRequest: TRecordUpdateDescriptor): String;\r\n    function GetDataProxy: TDataProxy;\r\n    procedure SetDataNode(const Value: string);\r\n    procedure SetURI(const Value: string);\r\n  protected\r\n    procedure SetActive(const Value: boolean);\r\n    procedure ProcessMetadata(Dataset : TDataset; FieldDefs : TFieldDefs; aMetaData : TJSObject); virtual;\r\n    function GetReadBaseURL(aRequest: TDataRequest): String; virtual;\r\n    function GetUpdateBaseURL(aRequest: TRecordUpdateDescriptor): String; virtual;\r\n    procedure RegisterDataSet(const value: TCustomClientDataSet);\r\n    procedure DoConnect; virtual;\r\n    procedure DoDisconnect; virtual;\r\n    procedure DoBeforeConnect; virtual;\r\n    procedure DoAfterConnect; virtual;\r\n    procedure DoError(ErrorCode: integer);\r\n    procedure DoDataReceived(ARequest: TJSXMLHttpRequest; var AResponse: string);\r\n    procedure SetupRequest(aXHR: TJSXMLHttpRequest); virtual;\r\n    function GetDataNode : String; virtual;\r\n    function GetMetaDataNode : String; virtual;\r\n    function DoGetDataProxy : TDataProxy; virtual;\r\n    function GetUpdatePayLoad(aURLType : TURLType; aDataset : TDataset; AData : JSValue) : String; virtual;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure BeginUpdate; override;\r\n    procedure EndUpdate; override;\r\n    procedure AfterLoadDFMValues; override;\r\n    property DataProxy : TDataProxy Read GetDataProxy;\r\n    class function StatusToURLType(aStatus : TUpdateStatus) : TURLType;\r\n  published\r\n    property Active: boolean read FActive write SetActive;\r\n    property AppendKeyToURL : boolean read FAppendKeyToURL write FAppendKeyToURL default true;\r\n    property AutoOpenDataSet: boolean read FAutoOpen write FAutoOpen;\r\n    property DataNode: string read FDataNode write SetDataNode;\r\n    property MetaDataNode: string read FMetaDataNode write FMetaDataNode;\r\n    property PageParam : string read FPageParam write FPageParam;\r\n\r\n    property Headers: TStringList read FHeaders write SetHeaders;\r\n    property Password: string read FPassword write FPassword;\r\n    property User: string read FUser write FUser;\r\n\r\n    property URI: string read FURI write SetURI;\r\n    property AfterConnect: TNotifyEvent read FAfterConnect write FAfterConnect;\r\n    property BeforeConnect: TNotifyEvent read FBeforeConnect write FBeforeConnect;\r\n   \tproperty OnConnectError: TConnectErrorEvent read FOnConnectError write FOnConnectError;\r\n    property OnDataReceived: TDataReceivedEvent read FOnDataReceived write FOnDataReceived;\r\n    property OnGetURL : TClientConnectionGetURLEvent Read FOnGetURL Write FOnGetURL;\r\n    Property OnGetUpdatePayLoad : TGetUpdatePayloadEvent Read FOnGetUpdatePayLoad Write FOnGetUpdatePayLoad;\r\n    Property OnGetDataPayload : TGetDataPayloadEvent Read FOnGetDataPayLoad Write FOnGetDataPayLoad;\r\n    Property OnProcessMetaData : TProcessMetadataEvent Read FOnProcessMetaData Write FOnProcessMetaData;\r\n  end;\r\n\r\n  TWebClientConnection = class(TClientConnection);\r\n\r\n  TWebClientDataProxy = class(TDataProxy)\r\n  private\r\n    FConnection: TClientConnection;\r\n  protected\r\n    procedure CheckBatchComplete(aBatch : TRecordUpdateBatch); virtual;\r\n  public\r\n    function GetUpdateDescriptorClass : TRecordUpdateDescriptorClass; override;\r\n    function ProcessUpdateBatch(aBatch : TRecordUpdateBatch): Boolean; override;\r\n    function DoGetData(aRequest: TDataRequest): Boolean; override;\r\n    function GetDataRequest(aOptions: TLoadOptions; aAfterRequest: TDataRequestEvent; aAfterLoad: TDatasetLoadEvent) : TDataRequest; override;\r\n    constructor Create(AOwner: TComponent);  override;\r\n    property Connection : TClientConnection Read FConnection;\r\n  end;\r\n\r\n\r\n  TUpdateRecordEvent = procedure(Sender: TObject; ADescriptor: TRecordUpdateDescriptor) of object;\r\n\r\n  TCustomClientDataSet = class(TBaseJSONDataSet)\r\n  private\r\n    FConnection: TClientConnection;\r\n    FOnUpdateRecord: TUpdateRecordEvent;\r\n    FUpdateCount: integer;\r\n    FIDField: string;\r\n    FuseServerMetadata: Boolean;\r\n    FParams: TParams;\r\n    procedure SetParams(const Value: TParams);\r\n  protected\r\n    function GetStringFieldLength(F: TJSObject; AName: string; AIndex: Integer): integer; virtual;\r\n    function StringToFieldType(S: String): TFieldType; virtual;\r\n    Function DoResolveRecordUpdate(anUpdate: TRecordUpdateDescriptor): Boolean; override;\r\n    Function DataPacketReceived(aRequest : TDataRequest) : Boolean; override;\r\n    procedure DoUpdateRecord(ADescriptor: TRecordUpdateDescriptor); virtual;\r\n    procedure MetaDataToFieldDefs; override;\r\n    procedure SetConnection(const Value: TClientConnection);\r\n    function CreateFieldMapper : TJSONFieldMapper; override;\r\n    procedure InitFieldDefs; override;\r\n    procedure FieldDefsFromRows(aRows: TJSArray);\r\n    procedure DoAfterOpen; override;\r\n    function DoGetDataProxy: TDataProxy; override;\r\n    property Connection: TClientConnection read FConnection write SetConnection;\r\n    property OnUpdateRecord: TUpdateRecordEvent read FOnUpdateRecord write FOnUpdateRecord;\r\n    property Params: TParams Read FParams Write SetParams;\r\n    property IDField: string read FIDField write FIDField;\r\n    property UseServerMetadata: Boolean Read FuseServerMetadata Write FuseServerMetadata;\r\n  public\r\n    constructor Create(aOwner : TComponent);override;\r\n    destructor Destroy; override;\r\n    procedure BeginUpdate; override;\r\n    procedure EndUpdate; override;\r\n    procedure AfterLoadDFMValues; override;\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); override;\r\n    property Rows;\r\n    property DataProxy;\r\n    procedure Refresh; reintroduce;\r\n    property Indexes;\r\n    property FieldDefs;\r\n    property ActiveIndex;\r\n    property Active;\r\n  published\r\n  end;\r\n\r\n  TClientDataSet = class(TCustomClientDataSet)\r\n  public\r\n    property IDField: string read FIDField write FIDField;\r\n  published\r\n    property Active;\r\n    property Connection;\r\n    property Params;\r\n\r\n    property BeforeOpen;\r\n    property AfterOpen;\r\n    property BeforeClose;\r\n    property AfterClose;\r\n    property BeforeInsert;\r\n    property AfterInsert;\r\n    property BeforeEdit;\r\n    property AfterEdit;\r\n    property BeforePost;\r\n    property AfterPost;\r\n    property BeforeCancel;\r\n    property AfterCancel;\r\n    property BeforeDelete;\r\n    property AfterDelete;\r\n    property BeforeScroll;\r\n    property AfterScroll;\r\n    property OnCalcFields;\r\n    property OnDeleteError;\r\n    property OnEditError;\r\n    property OnFilterRecord;\r\n    property OnNewRecord;\r\n    property OnPostError;\r\n    property OnUpdateRecord;\r\n  end;\r\n\r\n\r\n  TWebClientDataSet = class(TClientDataSet);\r\n\r\nimplementation\r\n\r\nuses\r\n  SysUtils, Types, WEBLib.Dialogs;\r\n\r\ntype\r\n  { TWebClientDataRequest }\r\n\r\n  TWebClientDataRequest = Class(TDataRequest)\r\n  private\r\n    FXHR: TJSXMLHttpRequest;\r\n    FConnection: TClientConnection;\r\n  protected\r\n    function onError(Event: TEventListenerEvent): boolean; virtual;\r\n    function onAbort(Event: TEventListenerEvent): boolean; virtual;\r\n    function onLoad(Event: TEventListenerEvent): boolean; virtual;\r\n    function TransformResult: JSValue; virtual;\r\n    property Connection : TClientConnection read FConnection;\r\n  end;\r\n\r\n  { TWebClientUpdateRequest }\r\n\r\n  TWebClientUpdateRequest = Class(TRecordUpdateDescriptor)\r\n  private\r\n    FXHR: TJSXMLHttpRequest;\r\n    FBatch: TRecordUpdateBatch;\r\n    FConnection: TClientConnection;\r\n  protected\r\n    function TransformResult: JSValue; virtual;\r\n    function onError(Event: TEventListenerEvent): boolean; virtual;\r\n    function onAbort(Event: TEventListenerEvent): boolean; virtual;\r\n    function onLoad(Event: TEventListenerEvent): boolean; virtual;\r\n    property Connection : TClientConnection read FConnection;\r\n  end;\r\n\r\n{ TClientDataSet }\r\n\r\nprocedure TCustomClientDataSet.AfterLoadDFMValues;\r\nbegin\r\n  inherited;\r\n  InitFieldDefs;\r\nend;\r\n\r\nprocedure TCustomClientDataSet.BeginUpdate;\r\nbegin\r\n  inherited;\r\n  inc(FUpdateCount);\r\nend;\r\n\r\n\r\nconstructor TCustomClientDataSet.Create(aOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FParams := TParams.Create(TParam);\r\nend;\r\n\r\nfunction TCustomClientDataSet.CreateFieldMapper : TJSONFieldMapper;\r\nbegin\r\n  Result := TJSONObjectFieldMapper.Create;\r\nend;\r\n\r\nfunction TCustomClientDataSet.DoResolveRecordUpdate(anUpdate: TRecordUpdateDescriptor): Boolean;\r\nvar\r\n  D : JSValue;\r\n  O : TJSObject;\r\n  A : TJSArray;\r\n  I,RecordIndex : Integer;\r\n  Root,FN : String;\r\n\r\nbegin\r\n  Result := True;\r\n\r\n  if anUpdate.Status = usDeleted then\r\n    Exit;\r\n\r\n  D := anUpdate.ServerData;\r\n\r\n  If isNull(D) then\r\n    Exit;\r\n\r\n  if not isNumber(AnUpdate.Bookmark.Data) then\r\n    Exit(False);\r\n\r\n  RecordIndex := Integer(AnUpdate.Bookmark.Data);\r\n\r\n  If isString(D) then\r\n    O := TJSOBject(TJSJSON.Parse(String(D)))\r\n  else if isObject(D) then\r\n    O := TJSOBject(D)\r\n  else\r\n    Exit(False);\r\n\r\n  Root := Connection.DataNode; // Maybe allow this to be set in the data packet ?\r\n  if Not isArray(O[Root]) then\r\n    Exit(False);\r\n  A := TJSArray(O[Root]);\r\n  if A.Length = 1 then\r\n  begin\r\n    O := TJSObject(A[0]);\r\n    for I := 0 to Fields.Count - 1 do\r\n    begin\r\n      FN := Fields[i].FieldName;\r\n      if O.hasOwnProperty(FN) then\r\n        FieldMapper.SetJSONDataForField(Fields[i],Rows[RecordIndex],O[FN]);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomClientDataSet.DataPacketReceived(aRequest: TDataRequest): Boolean;\r\nvar\r\n  O,MD: TJSObject;\r\n  V: JSValue;\r\n  A: TJSArray;\r\n  lmetadata,Root: string;\r\n\r\nbegin\r\n  Result := False;\r\n  if isNull(aRequest.Data) then\r\n    Exit;\r\n\r\n  O := nil;\r\n  A := nil;\r\n\r\n  // Check the raw result\r\n  if isString(aRequest.Data) then\r\n  begin\r\n    V := TJSJSON.Parse(String(aRequest.Data));\r\n    if isArray(V) then\r\n    begin\r\n      A := TJSArray(V);\r\n    end\r\n    else\r\n      if isObject(V) then\r\n         O := TJSOBject(V);\r\n  end\r\n  else\r\n    if isArray(aRequest.Data) then\r\n    begin\r\n      A := TJSArray(aRequest.Data);\r\n    end\r\n    else if isObject(aRequest.Data) then\r\n      O := TJSOBject(aRequest.Data)\r\n    else\r\n      DatabaseError('Cannot handle data packet');\r\n\r\n  // At this point, either O or A is set.\r\n  // If we have an object, examine it and extract the data\r\n  if Assigned(O) then\r\n  begin\r\n    // Some defaults\r\n    root := Connection.GetDataNode;\r\n    lmetadata := Connection.GetMetaDataNode;\r\n\r\n    if (IDField='') then\r\n      idField := 'id';\r\n\r\n    // Check metadata\r\n    if useServerMetadata and O.hasOwnProperty(lMetaData) and isObject(o[lMetaData]) then\r\n    begin\r\n      MD := TJSObject(o[lMetaData]);\r\n      if not Active then // Load fields from metadata\r\n        metaData := MD;\r\n      // We must always check this one...\r\n      if MD.hasOwnProperty('root') and isString(MD['root']) then\r\n        Root := string(metaData['root']);\r\n      if MD.hasOwnProperty('idField') and isString(MD['idField']) then\r\n        IDField := string(MD['idField']);\r\n    end;\r\n\r\n    if (Root <> '') and O.hasOwnProperty(Root) and isArray(o[Root]) then\r\n      A := TJSArray(o[Root]);\r\n  end;\r\n\r\n  if Assigned(A) and (A.Length > 0) and (FieldDefs.Count = 0) then\r\n  begin\r\n    FieldDefsFromRows(A);\r\n  end;\r\n\r\n  // If we have an array, add to data\r\n  Result := (A <> nil) and (A.Length > 0);\r\n\r\n  if Result then\r\n    AddToRows(A);\r\nend;\r\n\r\ndestructor TCustomClientDataSet.Destroy;\r\nbegin\r\n  FreeAndNil(FParams);\r\n  inherited;\r\nend;\r\n\r\nfunction TCustomClientDataSet.DoGetDataProxy: TDataProxy;\r\nbegin\r\n  if Assigned(Connection) then\r\n    Result := Connection.DataProxy\r\n  else\r\n    Result := nil;\r\nend;\r\n\r\nprocedure TCustomClientDataSet.DoUpdateRecord(ADescriptor: TRecordUpdateDescriptor);\r\nbegin\r\n  if Assigned(OnUpdateRecord) then\r\n    OnUpdateRecord(Self, ADescriptor);\r\nend;\r\n\r\nprocedure TCustomClientDataSet.EndUpdate;\r\nbegin\r\n  inherited;\r\n  if FUpdateCount > 0 then\r\n    dec(FUpdateCount);\r\nend;\r\n\r\nprocedure TCustomClientDataSet.FieldDefsFromRows(aRows : TJSArray);\r\nvar\r\n  J: TJSObject;\r\n  JV: JSValue;\r\n  strArr: TStringDynArray;\r\n  i: integer;\r\n\r\nbegin\r\n  if (FieldDefs.Count = 0) and Assigned(aRows) and (aRows.Length > 0) then\r\n  begin\r\n    J := TJSObject(aRows.Elements[0]);\r\n    strArr := TJSObject.getOwnPropertyNames(J);\r\n\r\n    for i := 0 to Length(strArr) - 1 do\r\n    begin\r\n      JV := J.Properties[strArr[i]];\r\n\r\n      if isString(JV) then\r\n        FieldDefs.Add(strArr[i],ftString,255);\r\n\r\n      if isNumber(JV) then\r\n        FieldDefs.Add(strArr[i],ftFloat);\r\n\r\n      if isBoolean(JV) then\r\n        FieldDefs.Add(strArr[i],ftBoolean);\r\n\r\n      if isDate(JV) then\r\n        FieldDefs.Add(strArr[i],ftDate);\r\n\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomClientDataSet.InitFieldDefs;\r\nvar\r\n  i: integer;\r\nbegin\r\n  FieldDefs.Clear;\r\n\r\n  for i := 0 to ComponentCount - 1 do\r\n  begin\r\n    if Components[i] is TStringField then\r\n      FieldDefs.Add((Components[i] as TStringField).FieldName, ftString, (Components[i] as TStringField).Size);\r\n\r\n    if Components[i] is TBooleanField then\r\n      FieldDefs.Add((Components[i] as TBooleanField).FieldName, ftBoolean, 0);\r\n\r\n    if Components[i] is TIntegerField then\r\n      FieldDefs.Add((Components[i] as TIntegerField).FieldName, ftInteger, 0);\r\n\r\n    if Components[i] is TFloatField then\r\n      FieldDefs.Add((Components[i] as TFloatField).FieldName, ftFloat, 0);\r\n\r\n    if Components[i] is TDateField then\r\n      FieldDefs.Add((Components[i] as TDateField).FieldName, ftDate, 0)\r\n    else if Components[i] is TTimeField then\r\n      FieldDefs.Add((Components[i] as TTimeField).FieldName, ftDate, 0)\r\n    else if Components[i] is TDateTimeField then\r\n      FieldDefs.Add((Components[i] as TDateTimeField).FieldName, ftDateTime, 0);\r\n\r\n    if Components[i] is TMemoField then\r\n      FieldDefs.Add((Components[i] as TMemoField).FieldName, ftMemo, 0);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomClientDataSet.DoAfterOpen;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Connection) and Connection.AutoOpenDataSet then\r\n    Connection.DoAfterConnect;\r\nend;\r\n\r\nprocedure TCustomClientDataSet.Refresh;\r\nbegin\r\n  if Assigned(Connection) then\r\n    Connection.DoConnect;\r\nend;\r\n\r\nprocedure TCustomClientDataSet.SetConnection(const Value: TClientConnection);\r\nbegin\r\n  FConnection := Value;\r\n  if Assigned(Value) then\r\n    Value.RegisterDataSet(Self);\r\nend;\r\n\r\nprocedure TCustomClientDataSet.SetParams(const Value: TParams);\r\nbegin\r\n  FParams.Assign(Value);\r\nend;\r\n\r\nfunction TCustomClientDataSet.StringToFieldType(S: String): TFieldType;\r\nbegin\r\n  if (s = 'int') then\r\n    Result := ftInteger\r\n  else if (s = 'bigint') then\r\n    Result := ftLargeInt\r\n  else if (s = 'float') then\r\n    Result := ftFloat\r\n  else if (s = 'bool') then\r\n    Result := ftBoolean\r\n  else if (s = 'date') then\r\n    Result := ftDate\r\n  else if (s = 'datetime') then\r\n    Result := ftDateTime\r\n  else if (s = 'time') then\r\n    Result := ftTime\r\n  else if (s = 'blob') then\r\n    Result := ftBlob\r\n  else if (s = 'string') then\r\n    Result := ftString\r\n  else\r\n    Result := ftString\r\nend;\r\n\r\nprocedure TCustomClientDataSet.MetaDataToFieldDefs;\r\nvar\r\n  A: TJSArray;\r\n  F: TJSObject;\r\n  I,FS: Integer;\r\n  N: string;\r\n  ft: TFieldType;\r\n  D: JSValue;\r\n\r\nbegin\r\n  FieldDefs.Clear;\r\n\r\n  // Allow user to do it.\r\n  Connection.ProcessMetaData(Self,FieldDefs,MetaData);\r\n\r\n  if FieldDefs.Count > 0 then\r\n    Exit;\r\n\r\n  D := Metadata.Properties['fields'];\r\n\r\n  if not IsArray(D) then\r\n    raise EJSONDataset.Create('Invalid metadata object');\r\n\r\n  A := TJSArray(D);\r\n  for I := 0 to A.Length - 1 do\r\n  begin\r\n    if not isObject(A[i]) then\r\n      raise EJSONDataset.CreateFmt('Field definition %d in metadata is not an object',[i]);\r\n\r\n    F := TJSObject(A[i]);\r\n    D := F.Properties['name'];\r\n    if not isString(D) then\r\n      raise EJSONDataset.CreateFmt('Field definition %d in has no or invalid name property',[i]);\r\n\r\n    N := String(D);\r\n    D := F.Properties['type'];\r\n\r\n    if IsNull(D) or isUndefined(D) then\r\n      ft := ftstring\r\n    else\r\n      if not isString(D) then\r\n      begin\r\n        raise EJSONDataset.CreateFmt('Field definition %d in has invalid type property',[i])\r\n      end\r\n      else\r\n      begin\r\n        ft := StringToFieldType(String(D));\r\n      end;\r\n\r\n    if (ft = ftString) then\r\n      fs := GetStringFieldLength(F,N,I)\r\n    else\r\n      fs := 0;\r\n    FieldDefs.Add(N,ft,fs);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomClientDataSet.GetChildren(Proc: TGetChildProc;\r\n  Root: TComponent);\r\nvar\r\n  i:integer;\r\nbegin\r\n  for i := 0 to Fields.Count - 1 do\r\n    Proc(Fields[i]);\r\nend;\r\n\r\nfunction TCustomClientDataSet.GetStringFieldLength(F: TJSObject; AName: String; AIndex: Integer): integer;\r\nvar\r\n  I,L: Integer;\r\n  D: JSValue;\r\n\r\nbegin\r\n  Result := 0;\r\n  D := F.Properties['maxLen'];\r\n  if not jsIsNan(toNumber(D)) then\r\n  begin\r\n    Result := Trunc(toNumber(D));\r\n    if (Result <= 0) then\r\n      DatabaseErrorFmt('Invalid maximum length specifier for field %s',[AName],Self)\r\n  end\r\n  else\r\n  begin\r\n    for I := 0 to Rows.Length - 1 do\r\n    begin\r\n      D := FieldMapper.GetJSONDataForField(Aname,AIndex,Rows[i]);\r\n      if isString(D) then\r\n      begin\r\n        l := Length(String(D));\r\n        if L > Result then\r\n          Result := L;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if (Result = 0) then\r\n    Result := 20;\r\nend;\r\n\r\n\r\n{ TClientConnection }\r\n\r\nprocedure TClientConnection.SetActive(const Value: boolean);\r\nbegin\r\n  if (FActive <> Value) then\r\n  begin\r\n    FActive := Value;\r\n\r\n    if FUpdateCount > 0 then\r\n      Exit;\r\n\r\n    if Value then\r\n    begin\r\n      if (FURI <> '') then\r\n        DoConnect;\r\n    end\r\n    else\r\n      DoDisconnect;\r\n  end;\r\n\r\n\r\n\r\nend;\r\n\r\nprocedure TClientConnection.SetDataNode(const Value: string);\r\nbegin\r\n  if (FDataNode <> Value) and (FUpdateCount = 0) then\r\n    Active := false;\r\n\r\n  FDataNode := Value;\r\nend;\r\n\r\nprocedure TClientConnection.DoConnect;\r\nbegin\r\n  if Assigned(FDS) then\r\n  begin\r\n    DoBeforeConnect;\r\n    if FAutoOpen then\r\n      FDS.Active := false;\r\n\r\n    FDS.Load([], nil);\r\n  end;\r\nend;\r\n\r\nprocedure TClientConnection.DoDataReceived(ARequest: TJSXMLHttpRequest;\r\n  var AResponse: string);\r\nbegin\r\n  if Assigned(OnDataReceived) then\r\n    OnDataReceived(Self, ARequest, AResponse);\r\nend;\r\n\r\nprocedure TClientConnection.DoDisconnect;\r\nbegin\r\n  if Assigned(FDS) then\r\n  begin\r\n     if FAutoOpen then\r\n     begin\r\n       FDS.Active := false;\r\n       FDS.FieldDefs.Clear;\r\n     end;\r\n  end;\r\nend;\r\n\r\nprocedure TClientConnection.SetHeaders(const Value: TStringList);\r\nbegin\r\n  FHeaders.Assign(Value);\r\nend;\r\n\r\nprocedure TClientConnection.RegisterDataSet(const Value: TCustomClientDataSet);\r\nbegin\r\n  FDS := Value;\r\nend;\r\n\r\nprocedure TClientConnection.AfterLoadDFMValues;\r\nbegin\r\n  inherited;\r\n\r\n  if FActive and (URI <> '') then\r\n    DoConnect;\r\nend;\r\n\r\nprocedure TClientConnection.BeginUpdate;\r\nbegin\r\n  inherited;\r\n  inc(FUpdateCount);\r\nend;\r\n\r\nconstructor TClientConnection.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FActive := false;\r\n  FDS := nil;\r\n  FAutoOpen := true;\r\n  FHeaders := TStringList.Create;\r\n  AppendKeyToURL := True;\r\nend;\r\n\r\ndestructor TClientConnection.Destroy;\r\nbegin\r\n  FHeaders.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TClientConnection.DoAfterConnect;\r\nbegin\r\n  if Assigned(AfterConnect) then\r\n    AfterConnect(Self);\r\nend;\r\n\r\nprocedure TClientConnection.DoBeforeConnect;\r\nbegin\r\n  if Assigned(BeforeConnect) then\r\n    BeforeConnect(Self);\r\nend;\r\n\r\nprocedure TClientConnection.DoError(ErrorCode: integer);\r\nbegin\r\n  raise Exception.Create('Error connecting to URI ' + FURI);\r\n  if Assigned(OnConnectError) then\r\n    OnConnectError(Self, ErrorCode);\r\nend;\r\n\r\nprocedure TClientConnection.EndUpdate;\r\nbegin\r\n  inherited;\r\n  if (FUpdateCount > 0) then\r\n    dec(FUpdateCount);\r\nend;\r\n\r\n{ TWebClientUpdateRequest }\r\n\r\nfunction TWebClientUpdateRequest.onAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(Connection) then\r\n    Connection.DoError(FXHR.Status);\r\n\r\n  ResolveFailed(FXHR.StatusText);\r\n  Result := False;\r\nend;\r\n\r\nfunction TWebClientUpdateRequest.onError(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(Connection) then\r\n    Connection.DoError(FXHR.Status);\r\n  ResolveFailed(FXHR.StatusText);\r\n  Result := False;\r\nend;\r\n\r\nfunction TWebClientUpdateRequest.onLoad(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if (FXHR.Status div 100) = 2 then\r\n  begin\r\n    Resolve(TransFormResult);\r\n    Result := True;\r\n  end\r\n  else\r\n    ResolveFailed(FXHR.StatusText);\r\n\r\n  (Proxy as TWebClientDataProxy).CheckBatchComplete(FBatch);\r\nend;\r\n\r\nfunction TWebClientUpdateRequest.TransformResult: JSValue;\r\nbegin\r\n  Result := FXHR.response;\r\n  if Assigned(Connection) and Assigned(Connection.OnGetDataPayload) then\r\n    FConnection.OnGetDataPayload(FConnection,Dataset,TClientConnection.StatusToURLtype(Self.Status),Result);\r\nend;\r\n\r\n{ TWebClientDataRequest }\r\n\r\nfunction TWebClientDataRequest.TransformResult: JSValue;\r\nvar\r\n  s: string;\r\nbegin\r\n  Result := FXHR.response;\r\n\r\n  if Assigned(Connection) and Assigned(Connection.OnDataReceived) then\r\n  begin\r\n    asm\r\n      s = this.FXHR.responseText;\r\n    end;\r\n    FConnection.DoDataReceived(FXHR, s);\r\n  end;\r\n\r\n  if Assigned(Connection) and Assigned(Connection.OnGetDataPayload) then\r\n  begin\r\n    FConnection.OnGetDataPayload(FConnection,Dataset, utGet, Result);\r\n  end;\r\nend;\r\n\r\nfunction TWebClientDataRequest.onAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  Success := rrFail;\r\n\r\n  if Assigned(Connection) then\r\n    Connection.DoError(FXHR.Status);\r\n\r\n  DoAfterRequest;\r\n  Result := True;\r\nend;\r\n\r\nfunction TWebClientDataRequest.onError(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  Success := rrFail;\r\n\r\n  if Assigned(Connection) then\r\n    Connection.DoError(FXHR.Status);\r\n\r\n  DoAfterRequest;\r\n  Result := True;\r\nend;\r\n\r\nfunction TWebClientDataRequest.onLoad(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if (FXHR.Status = 200) then\r\n  begin\r\n    Data := TransformResult;\r\n    Success := rrOK;\r\n  end\r\n  else\r\n  begin\r\n    Data := nil;\r\n    if (loAtEOF in LoadOptions) and (FXHR.Status = 404) then\r\n      Success := rrEOF\r\n    else\r\n    begin\r\n      Success := rrFail;\r\n      ErrorMsg := FXHR.StatusText;\r\n    end;\r\n  end;\r\n\r\n  DoAfterRequest;\r\n  Result := True;\r\nend;\r\n\r\n{ TRESTConnection }\r\n\r\nfunction TClientConnection.GetDataNode: String;\r\nbegin\r\n  Result := fDataNode;\r\n  if Result = '' then\r\n    Result := 'data';\r\nend;\r\n\r\nfunction TClientConnection.GetDataProxy: TDataProxy;\r\nbegin\r\n  if (FDataProxy=Nil) then\r\n    FDataProxy := DoGetDataProxy;\r\n  Result := FDataProxy;\r\nend;\r\n\r\n\r\nfunction TClientConnection.GetMetaDataNode: String;\r\nbegin\r\n  Result := fMetaDataNode;\r\n  if Result = '' then\r\n    Result := 'metaData';\r\nend;\r\n\r\nprocedure TClientConnection.SetupRequest(aXHR: TJSXMLHttpRequest);\r\nvar\r\n  I : Integer;\r\n  headname, headvalue : string;\r\n\r\nbegin\r\n  // always set this, security measure, enforcing use of CORS\r\n  if User <> '' then\r\n    aXHR.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n\r\n  for i := 0 to FHeaders.Count - 1 do\r\n  begin\r\n    FHeaders.GetNameValue(i, headname, headvalue);\r\n    aXHR.setRequestHeader(headname, headvalue);\r\n  end;\r\n\r\n  // We set the Authorization header here, not in XHR.open.\r\n  // This way we can switch to other forms of authentication (OAuth2).\r\n  if (User<>'') then\r\n    aXHR.setRequestHeader('Authorization', 'Basic '+window.btoa(User+':'+Password));\r\nend;\r\n\r\nprocedure TClientConnection.SetURI(const Value: string);\r\nbegin\r\n  if (FURI <> Value) and (FUpdateCount = 0) then\r\n    Active := false;\r\n\r\n  FURI := Value;\r\nend;\r\n\r\nclass function TClientConnection.StatusToURLType(aStatus : TUpdateStatus): TURLType;\r\nbegin\r\n  case aStatus of\r\n    usModified : Result := utPut;\r\n    usDeleted : Result := utDelete;\r\n    usInserted : Result := utPost;\r\n  else\r\n    Result := utGet;\r\n  end;\r\nend;\r\n\r\nfunction TClientConnection.GetReadBaseURL(aRequest: TDataRequest): String;\r\nbegin\r\n  Result := URI;\r\n  if Assigned(FOnGetURL) then\r\n    FOnGetURL(Self, aRequest.Dataset,utGet,Result);\r\nend;\r\n\r\nfunction TClientConnection.GetPageURL(aRequest: TDataRequest): String;\r\nvar\r\n  URL : String;\r\n\r\nbegin\r\n  URL := GetReadBaseURL(aRequest);\r\n  if (PageParam <> '') then\r\n  begin\r\n    if Pos('?',URL)<>0 then\r\n      URL := URL + '&'\r\n    else\r\n      URL := URL + '?';\r\n    URL := URL + PageParam + '=' + IntToStr(ARequest.RequestID-1);\r\n  end;\r\n  Result := URL;\r\nend;\r\n\r\nfunction TClientConnection.GetUpdateBaseURL(aRequest: TRecordUpdateDescriptor): String;\r\nbegin\r\n  Result := URI;\r\n  if Assigned(FOnGetURL) then\r\n    FOnGetURL(Self,aRequest.Dataset,StatusToURLType(aRequest.Status),Result);\r\nend;\r\n\r\nfunction TClientConnection.GetUpdatePayLoad(aURLType: TURLType; aDataset: TDataset; AData: JSValue): String;\r\nbegin\r\n  if Assigned(FOnGetUpdatePayLoad) then\r\n    FOnGetUpdatePayLoad(Self,aDataset,aUrlType,aData,Result)\r\n  else\r\n  begin\r\n    if aURLType in [utPost,utPut] then\r\n      Result := TJSJSON.Stringify(aData)\r\n    else\r\n      Result := '';\r\n  end;\r\nend;\r\n\r\nprocedure TClientConnection.ProcessMetadata(Dataset: TDataset; FieldDefs: TFieldDefs; aMetaData: TJSObject);\r\nbegin\r\n  if Assigned(OnProcessMetaData) then\r\n    OnProcessMetaData(Self,Dataset,FieldDefs,aMetaData);\r\nend;\r\n\r\nfunction TClientConnection.GetRecordUpdateURL(aRequest: TRecordUpdateDescriptor): String;\r\nvar\r\n  I: integer;\r\n  Base,KeyField,KeyValue,Qry: string;\r\n\r\nbegin\r\n  KeyField := '';\r\n  Result := '';\r\n  Base := GetUpdateBaseURL(aRequest);\r\n\r\n  if not (AppendKeyToURL and (aRequest.Status in [usModified,usDeleted])) then\r\n    Exit(Base);\r\n\r\n  I := Pos('?',Base);\r\n  if I > 0 then\r\n  begin\r\n    Qry := Copy(Base,I,Length(Base)-I+1);\r\n    Base := Copy(Base,1,I-1);\r\n  end;\r\n\r\n  // For update & delete we need to append the key field value.\r\n  // Key field is IDField. If that is empty, we look for a field with providerFlags that contains pfKey\r\n  KeyField := (aRequest.Dataset as TClientDataset).IDField;\r\n  I := aRequest.Dataset.Fields.Count - 1;\r\n\r\n  while (KeyField = '') and (I >= 0) do\r\n  begin\r\n    if pfInKey in aRequest.Dataset.Fields[i].ProviderFlags then\r\n      KeyField:=aRequest.Dataset.Fields[i].FieldName;\r\n    Dec(I);\r\n  end;\r\n\r\n  if (KeyField = '') then\r\n    DatabaseError('No key field',aRequest.Dataset);\r\n\r\n  KeyValue := TJSJSON.stringify(TJSObject(aRequest.Data)[KeyField]);\r\n  if (Base<>'') and (Base[Length(Base)]<>'/') then\r\n    Base := Base + '/';\r\n\r\n  Result := Base + KeyValue + Qry;\r\nend;\r\n\r\nfunction TClientConnection.DoGetDataProxy: TDataProxy;\r\nbegin\r\n  Result := TWebClientDataProxy.Create(Self);\r\nend;\r\n\r\n{ TRESTDataProxy }\r\n\r\nprocedure TWebClientDataProxy.CheckBatchComplete(aBatch: TRecordUpdateBatch);\r\nvar\r\n  BatchOK : Boolean;\r\n  I : Integer;\r\n\r\nbegin\r\n  BatchOK := True;\r\n  I := aBatch.List.Count - 1;\r\n  while BatchOK and (I >= 0) do\r\n  begin\r\n    BatchOK := aBatch.List[I].ResolveStatus in [rsResolved, rsResolveFailed];\r\n    Dec(I);\r\n  end;\r\n\r\n  if BatchOK and Assigned(aBatch.OnResolve) then\r\n    aBatch.OnResolve(Self, aBatch);\r\nend;\r\n\r\nfunction TWebClientDataProxy.GetUpdateDescriptorClass: TRecordUpdateDescriptorClass;\r\nbegin\r\n  Result := TWebClientUpdateRequest;\r\nend;\r\n\r\nfunction TWebClientDataProxy.ProcessUpdateBatch(aBatch: TRecordUpdateBatch): Boolean;\r\n\r\nVar\r\n  R : TWebClientUpdateRequest;\r\n  i : Integer;\r\n  Method,URl : String;\r\n  S : String;\r\n\r\nbegin\r\n  Result:=False;\r\n  For I:=0 to aBatch.List.Count-1 do\r\n    begin\r\n    R:=aBatch.List[i] as TWebClientUpdateRequest;\r\n    R.FConnection:=Self.FConnection;\r\n    R.FBatch:=aBatch;\r\n    R.FXHR:=TJSXMLHttpRequest.New;\r\n    R.FXHR.AddEventListener('load',@R.onLoad);\r\n    R.FXHR.AddEventListener('abort',@R.onAbort);\r\n    R.FXHR.AddEventListener('error',@R.onError);\r\n    URL:=FConnection.GetRecordUpdateURL(R);\r\n    Case R.Status of\r\n      usInserted :\r\n        Method:='POST';\r\n      usModified:\r\n        Method:='PUT';\r\n      usDeleted:\r\n        Method:='DELETE';\r\n    end;\r\n    R.FXHR.open(Method,URL);\r\n    Connection.SetupRequest(R.FXHR);\r\n    R.FXHR.setRequestHeader('content-type','application/json');\r\n    S:=Connection.GetUpdatePayload(TClientConnection.StatusToURLType(R.Status),R.Dataset,R.Data);\r\n    if R.Status in [usInserted,usModified] then\r\n      R.FXHR.Send(S)\r\n    else\r\n      R.FXHR.Send(S);\r\n    end;\r\n  Result:=True;\r\nend;\r\n\r\nfunction TWebClientDataProxy.DoGetData(aRequest: TDataRequest): Boolean;\r\nvar\r\n  R: TWebClientDataRequest;\r\n  URL: String;\r\n\r\nbegin\r\n  Result := False;\r\n  R := aRequest as TWebClientDataRequest;\r\n  R.FXHR := TJSXMLHttpRequest.New;\r\n  URL := Connection.GetPageURL(aRequest);\r\n\r\n  if (URL = '') then\r\n  begin\r\n    if loAtEOF in R.LoadOptions then\r\n      R.Success := rrEOF\r\n    else\r\n    begin\r\n      R.Success := rrFail;\r\n      R.ErrorMsg := 'No URL to get data';\r\n      R.DoAfterRequest; // This will free request !\r\n      end;\r\n    end\r\n  else\r\n    begin\r\n      if (loAtEOF in R.LoadOptions) and (Connection.PageParam='') then\r\n        R.Success := rrEOF\r\n    else\r\n    begin\r\n      // We're setting the credentials header ourselves.\r\n      // Firefox does not like it when you set it in open() and manually add the header.\r\n      // In general, the API should be switched to fetch()\r\n      R.FXHR.open('GET', URL, true);\r\n      Connection.SetupRequest(R.FXHR);\r\n//      window.onError:=function(e : TJSErrorEvent) : boolean begin console.log(e) end;\r\n      R.FXHR.AddEventListener('load',@R.onLoad);\r\n      R.FXHR.AddEventListener('abort',@R.onAbort);\r\n      R.FXHR.AddEventListener('error',@R.onError);\r\n      // https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors/CORSNotSupportingCredentials\r\n//      R.FXHR.withCredentials:=true;\r\n      R.FXHR.send;\r\n    end;\r\n    Result := True;\r\n  end;\r\nend;\r\n\r\nfunction TWebClientDataProxy.GetDataRequest(aOptions: TLoadOptions; aAfterRequest: TDataRequestEvent; aAfterLoad: TDatasetLoadEvent): TDataRequest;\r\nbegin\r\n  Result := TWebClientDataRequest.Create(Self,aOptions, aAfterRequest,aAfterLoad);\r\n  TWebClientDataRequest(Result).FConnection:=Self.FConnection;\r\nend;\r\n\r\nconstructor TWebClientDataProxy.Create(AOwner: TComponent);\r\nbegin\r\n  Inherited;\r\n\r\n  If AOwner is TClientConnection then\r\n    FConnection := TClientConnection(aOwner);\r\nend;\r\n\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            Copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Grids;\r\n\r\ninterface\r\n\r\n{$HINTS OFF}\r\n\r\nuses\r\n  Classes, JS, WEBLib.Controls, WEBLib.Graphics, Web, DB;\r\n\r\ntype\r\n{\r\n  TJSTable = class external name 'Table' (TJSNode)\r\n  private\r\n    FRows : TJSElement; external name 'rows';\r\n\r\n  public\r\n\r\n  end;\r\n}\r\n  TInitMethod = (imRandom, imLinear);\r\n\r\n  TGridRect = record\r\n    Left, Top, Right, Bottom: Longint;\r\n  end;\r\n\r\n  TGridCoord = record\r\n    X: Longint;\r\n    Y: Longint;\r\n  end;\r\n\r\n  TGridOption = (goFixedVertLine, goFixedHorzLine, goVertLine, goHorzLine,\r\n    goRangeSelect, goDrawFocusSelected, goRowSizing, goColSizing, goRowMoving,\r\n    goColMoving, goEditing, goTabs, goRowSelect, goAlwaysShowEditor,\r\n    goThumbTracking, goFixedColClick, goFixedRowClick, goFixedHotTrack);\r\n\r\n  TFillMethod = (fmRandom);\r\n\r\n  TGridOptions = set of TGridOption;\r\n\r\n  TGridGetCellDataEvent = procedure(Sender: TObject; ACol,ARow: integer; AField: TField; var AValue: string) of object;\r\n\r\n  TGridGetCellClassEvent = procedure(Sender: TObject; ACol,ARow: integer; AField: TField; AValue: string; var AClassName: string) of object;\r\n\r\n  TGridGetCellChildrenEvent = procedure(Sender: TObject; ACol,ARow: integer; AField: TField; AValue: string; AElement: TJSHTMLElement) of object;\r\n\r\n  TGridRequestEvent = procedure(Sender: TObject; ARequest: TJSXMLHttpRequest) of object;\r\n\r\n  TGetEditEvent = procedure (Sender: TObject; ACol, ARow: Longint; var Value: string) of object;\r\n  TSetEditEvent = procedure (Sender: TObject; ACol, ARow: Longint; const Value: string) of object;\r\n\r\n  TCustomGrid = class(TCustomControl)\r\n  private\r\n    FRowCount: integer;\r\n    FColCount: integer;\r\n  protected\r\n    procedure SetColCount(const Value: integer); virtual;\r\n    procedure SetRowCount(const Value: integer); virtual;\r\n    procedure GridChanged; virtual;\r\n    procedure RowCountChanged(delta: integer); virtual;\r\n    procedure ColCountChanged(delta: integer); virtual;\r\n    property RowCount: integer read FRowCount write SetRowCount;\r\n    property ColCount: integer read FColCount write SetColCount;\r\n  public\r\n    property Visible;\r\n  end;\r\n\r\n  // for VCL design-time compatibility\r\n  TGridDrawingStyle = (gdsClassic, gdsThemed, gdsGradient);\r\n\r\n  TCellEvent = procedure(Sender: TObject; ACol, ARow: integer) of object;\r\n  TCellCheckEvent = procedure(Sender: TObject; ACol, ARow: integer; Checked: boolean) of object;\r\n\r\n  TSelectCellEvent = procedure(Sender: TObject; ACol, ARow: integer; var CanSelect: boolean) of object;\r\n\r\n  TCustomStringGrid = class(TCustomGrid)\r\n  private\r\n    FReq: TJSXMLHttpRequest;\r\n    FDataNode: string;\r\n    FOrigVal: string;\r\n    FGrid: TJSElement;\r\n    FFixedColor: TColor;\r\n    FFixedColRow: TJSElement;\r\n    FFixedRow: TJSElement;\r\n    FFixedCol: TJSElement;\r\n    FNormalCells: TJSElement;\r\n    FDefaultRowHeight: integer;\r\n    FDefaultColWidth: integer;\r\n    FColWidths: TList;\r\n    FRowHeights: TList;\r\n    FSelectedCell: TJSElement;\r\n    FEdit: TJSHTMLElement;\r\n    FFixedCols: integer;\r\n    FFixedRows: integer;\r\n    FEditMode: boolean;\r\n    FOnSelectCell: TSelectCellEvent;\r\n    FOnTopLeftChanged: TNotifyEvent;\r\n    FOptions: TGridOptions;\r\n    FDelimiter: char;\r\n    FLoadFixed: boolean;\r\n    FSelection: TGridRect;\r\n    FStartCell: TGridCoord;\r\n    FOnHttpRequestError: TNotifyEvent;\r\n    FOnHttpRequestSuccess: TNotifyEvent;\r\n    FOnGetCellClass: TGridGetCellClassEvent;\r\n    FOnGetCellData: TGridGetCellDataEvent;\r\n    FOnGetCellChildren: TGridGetCellChildrenEvent;\r\n    FScrollBars: TScrollStyle;\r\n    FSelMouseDown: boolean;\r\n    FStyleElements: TStyleElements;\r\n    FDefaultDrawing: boolean;\r\n    FDragCursor: TCursor;\r\n    FDragKind: TDragKind;\r\n    FDragMode: TDragMode;\r\n    FGradientStartColor: TColor;\r\n    FGradientEndColor: TColor;\r\n    FEditCol: integer;\r\n    FEditRow: integer;\r\n    FCtl3D: boolean;\r\n    FParentCtl3D: boolean;\r\n    FOnGetEditText: TGetEditEvent;\r\n    FOnSetEditText: TSetEditEvent;\r\n    FOnHttpRequest: TGridRequestEvent;\r\n    FOnCheckClick: TCellCheckEvent;\r\n    FOnFixedCellClick: TCellEvent;\r\n    FOnValidateEdit: TGetEditEvent;\r\n    FHandleEditBlurPtr: pointer;\r\n    FHandleEditKeypressPtr: pointer;\r\n    FDrawingStyle: TGridDrawingStyle;\r\n    function GetCells(ACol, ARow: integer): string;\r\n    procedure SetCells(ACol, ARow: integer; const Value: string);\r\n    procedure SetFixedCols(const Value: integer);\r\n    procedure SetFixedRows(const Value: integer);\r\n    function GetColWidths(ACol: integer): integer;\r\n    function GetRowHeights(ARow: integer): integer;\r\n    procedure SetColWidths(ACol: integer; const Value: integer);\r\n    procedure SetRowHeights(ARow: integer; const Value: integer);\r\n    procedure SetDefaultColWidth(const Value: integer);\r\n    procedure SetDefaultRowHeight(const Value: integer);\r\n    function GetCol: integer;\r\n    function GetRow: integer;\r\n    procedure SetCol(const Value: integer);\r\n    procedure SetRow(const Value: integer);\r\n    function GetCellElements(ACol, ARow: integer): TJSHTMLElement;\r\n    function GetSelection: TGridRect;\r\n    procedure SetSelection(const Value: TGridRect);\r\n    function GetLeftCol: integer;\r\n    function GetTopRow: integer;\r\n    procedure SetLeftCol(const Value: integer);\r\n    procedure SetTopRow(const Value: integer);\r\n    procedure SetFixedColor(const Value: TColor);\r\n  protected\r\n    procedure MouseMove(Shift: TShiftState; X,Y: Integer); override;\r\n\r\n    function HandleClick(Event: TJSEvent): Boolean; virtual;\r\n    function HandleFixedClick(Event: TJSEvent): Boolean; virtual;\r\n    function HandleMouseDown(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleKeyDown(Event: TJSKeyboardEvent): boolean; virtual;\r\n    function HandleTableFocus(Event: TJSEvent): Boolean; virtual;\r\n    function HandleScroll(Event: TJSEvent): Boolean; virtual;\r\n    function HandleEditBlur(Event: TJSEvent): Boolean; virtual;\r\n    function HandleEditKeyPress(Event: TJSKeyboardEvent): boolean; virtual;\r\n    function HandleCheckBoxClick(Event: TJSEvent): Boolean; virtual;\r\n    function HandleDoMouseUp(Event: TJSMouseEvent): Boolean; override;\r\n    function HandleDoMouseMove(Event: TJSMouseEvent): Boolean; override;\r\n    function DoHttpLoadJson(Event: TEventListenerEvent): boolean; virtual;\r\n    function DoHttpLoadCsv(Event: TEventListenerEvent): boolean; virtual;\r\n    function DoHttpAbort(Event: TEventListenerEvent): boolean; virtual;\r\n    procedure DoHttpRequest(ARequest: TJSXMLHttpRequest); virtual;\r\n    procedure DoCheckClick(ACol, ARow: Longint; Checked: boolean); virtual;\r\n    function GetEditText(ACol, ARow: Longint): string; virtual;\r\n    procedure SetEditText(ACol, ARow: Longint; const AValue: string); virtual;\r\n    procedure GetCellData(ACol,ARow: integer; AField: TField; var AValue: string); virtual;\r\n    procedure GetCellClassName(ACol,ARow: integer; AField: TField; AValue: string; var AClassName: string); virtual;\r\n    procedure GetCellChildren(ACol,ARow: integer; AField: TField; AValue: string; AElement: TJSHTMLElement); virtual;\r\n    procedure BindCellChildren(ACol,ARow: integer; AElement: TJSHTMLElement); virtual;\r\n    procedure DoBoundsChange; override;\r\n    function GetGridCSS: string; virtual;\r\n    procedure RenderGrid;\r\n    procedure RenderGridSize;\r\n    procedure RenderGridScript;\r\n    procedure UpdateGridSize;\r\n    procedure BindEvents; override;\r\n    procedure Resize; override;\r\n    procedure GridChanged; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure UpdateElementVisual; override;\r\n    function FixedColWidth: integer;\r\n    function FixedRowHeight: integer;\r\n    function NormalColWidth: integer;\r\n    function NormalRowHeight: integer;\r\n    function FocusedCell: TJSElement;\r\n    function CanSelect(ACol, ARow: integer): boolean; virtual;\r\n    procedure SelectCell(ACol, ARow: integer); virtual;\r\n    procedure UpdateCell(ACol, ARow: integer; var AValue: string); virtual;\r\n    procedure ValidateCell(ACol, ARow: integer; var AValue: string); virtual;\r\n    procedure TopLeftChanged; virtual;\r\n    procedure RowCountChanged(delta: integer); override;\r\n    procedure ColCountChanged(delta: integer); override;\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure StartEdit(ch: string); virtual;\r\n    function StopEdit: string; virtual;\r\n    procedure ChangeRow; virtual;\r\n    property ColCount;\r\n    property RowCount;\r\n    property OnHttpRequestError: TNotifyEvent read FOnHttpRequestError write FOnHttpRequestError;\r\n    property OnHttpRequestSuccess: TNotifyEvent read FOnHttpRequestSuccess write FOnHttpRequestSuccess;\r\n    property OnHttpRequest: TGridRequestEvent read FOnHttpRequest write FOnHttpRequest;\r\n    procedure EnableColResize;\r\n  public\r\n    constructor Create(AOwner: TComponent); override; overload;\r\n    destructor Destroy; override;\r\n    procedure CreateInitialize; override;\r\n    procedure SetFocus; override;\r\n    procedure ShowEdit; virtual;\r\n    procedure HideEdit; virtual;\r\n    procedure Clear;\r\n    procedure InitSample(AInitMethod: TInitMethod);\r\n    property Ctl3D: boolean read FCtl3D write FCtl3D;\r\n    property ParentCtl3D: boolean read FParentCtl3D write FParentCtl3D;\r\n    property Col: integer read GetCol write SetCol;\r\n    property Row: integer read GetRow write SetRow;\r\n    property Selection: TGridRect read GetSelection write SetSelection;\r\n    property EditMode: boolean read FEditMode;\r\n    procedure MouseToCell(X,Y: integer; var C, R: integer);\r\n    procedure LoadFromJSON(const AURL: string; ADataNode: string = ''); overload;\r\n    procedure LoadFromJSON(AJSON: TJSObject; ADataNode: string = ''); overload;\r\n    procedure LoadFromCSV(const AURL: string; Delimiter: char = ';'; LoadFixed: boolean = false);\r\n    property CellElements[ACol,ARow: integer]: TJSHTMLElement read GetCellElements;\r\n    property Cells[ACol,ARow: integer]: string read GetCells write SetCells;\r\n    property ColWidths[ACol: integer]: integer read GetColWidths write SetColWidths;\r\n    property RowHeights[ARow: integer]: integer read GetRowHeights write SetRowHeights;\r\n    property FixedColRow: TJSElement read FFixedColRow;\r\n    property FixedCol: TJSElement read FFixedCol;\r\n    property FixedRow: TJSElement read FFixedRow;\r\n    property TopRow: integer read GetTopRow write SetTopRow;\r\n    property LeftCol: integer read GetLeftCol write SetLeftCol;\r\n    // for design-time VCL class compatibility\r\n    property DefaultDrawing: boolean read FDefaultDrawing write FDefaultDrawing;\r\n    property DragCursor: TCursor read FDragCursor write FDragCursor;\r\n    property DragKind: TDragKind read FDragKind write FDragKind;\r\n    property DragMode: TDragMode read FDragMode write FDragMode;\r\n    property DrawingStyle: TGridDrawingStyle read FDrawingStyle write FDrawingStyle;\r\n    property GradientEndColor: TColor read FGradientEndColor write FGradientEndColor;\r\n    property GradientStartColor: TColor read FGradientStartColor write FGradientStartColor;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property DefaultColWidth: integer read FDefaultColWidth write SetDefaultColWidth default 64;\r\n    property DefaultRowHeight: integer read FDefaultRowHeight write SetDefaultRowHeight default 24;\r\n    property ElementID;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property FixedRows: integer read FFixedRows write SetFixedRows default 1;\r\n    property FixedCols: integer read FFixedCols write SetFixedCols default 1;\r\n    property FixedColor: TColor read FFixedColor write SetFixedColor default clBtnFace;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Margins;\r\n    property Options: TGridOptions read FOptions write FOptions;\r\n    property ParentFont;\r\n    property Scrollbars: TScrollStyle read FScrollBars write FScrollBars default ssBoth;\r\n    property StyleElements: TStyleElements read FStyleElements write FStyleElements;\r\n    property TabOrder;\r\n\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnGetCellData: TGridGetCellDataEvent read FOnGetCellData write FOnGetCellData;\r\n    property OnGetCellChildren: TGridGetCellChildrenEvent read FOnGetCellChildren write FOnGetCellChildren;\r\n    property OnGetCellClass: TGridGetCellClassEvent read FOnGetCellClass write FOnGetCellClass;\r\n    property OnCheckClick: TCellCheckEvent read FOnCheckClick write FOnCheckClick;\r\n    property OnFixedCellClick: TCellEvent read FOnFixedCellClick write FOnFixedCellClick;\r\n    property OnGetEditText: TGetEditEvent read FOnGetEditText write FOnGetEditText;\r\n    property OnSetEditText: TSetEditEvent read FOnSetEditText write FOnSetEditText;\r\n    property OnSelectCell: TSelectCellEvent read FOnSelectCell write FOnSelectCell;\r\n    property OnTopLeftChanged: TNotifyEvent read FOnTopLeftChanged write FOnTopLeftChanged;\r\n    property OnValidateEdit: TGetEditEvent read FOnValidateEdit write FOnValidateEdit;\r\n  end;\r\n\r\n  TStringGrid = class(TCustomStringGrid)\r\n  published\r\n    property ColCount;\r\n    property RowCount;\r\n    property OnHttpRequestError;\r\n    property OnHttpRequestSuccess;\r\n  end;\r\n\r\n  TWebStringGrid = class(TStringGrid);\r\n\r\n  TCustomTableControl = class;\r\n\r\n  TTableControlOptions = class(TPersistent)\r\n  private\r\n    FOwner: TCustomTableControl;\r\n    FScrollVertical: boolean;\r\n    FResizeColumns: boolean;\r\n    procedure SetResizeColumns(const Value: boolean);\r\n  public\r\n    constructor Create(AOwner: TCustomTableControl);\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property ScrollVertical: boolean read FScrollVertical write FScrollVertical default false;\r\n    property ResizeColumns: boolean read FResizeColumns write SetResizeColumns default false;\r\n  end;\r\n\r\n  TCustomTableControl = class(TCustomGrid)\r\n  private\r\n    FReq: TJSXMLHttpRequest;\r\n    FDataNode: string;\r\n    FTable: TJSElement;\r\n    FBody: TJSElement;\r\n    FRowHeader: boolean;\r\n    FColHeader: boolean;\r\n    FDelimiter: char;\r\n    FLoadFixed: boolean;\r\n    FElementHeaderClassName: TElementClassName;\r\n    FElementTableClassName: TElementClassName;\r\n    FOnHttpRequestError: TNotifyEvent;\r\n    FOnHttpRequestSuccess: TNotifyEvent;\r\n    FOnDblClickCell: TCellEvent;\r\n    FOnClickCell: TCellEvent;\r\n    FOptions: TTableControlOptions;\r\n    FOnGetCellClass: TGridGetCellClassEvent;\r\n    FOnGetCellData: TGridGetCellDataEvent;\r\n    FOnGetCellChildren: TGridGetCellChildrenEvent;\r\n    FOnHttpRequest: TGridRequestEvent;\r\n    FOnCheckClick: TCellCheckEvent;\r\n    function GetCells(col, row: integer): string;\r\n    procedure SetCells(col, row: integer; const Value: string);\r\n    function GetRowClassName(row: integer): TElementClassName;\r\n    procedure SetRowClassName(row: integer; const Value: TElementClassName);\r\n    function GetCellElement(col, row: integer): TJSHTMLElement;\r\n    procedure SetOptions(const Value: TTableControlOptions);\r\n    procedure SetElementHeaderClassName(const Value: TElementClassName);\r\n    procedure SetElementTableClassName(const Value: TElementClassName);\r\n  protected\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; override;\r\n    function HandleDoDblClick(Event: TJSMouseEvent): Boolean; override;\r\n    function HandleCheckBoxClick(Event: TJSEvent): Boolean; virtual;\r\n    function HandleDoMouseUp(Event: TJSMouseEvent): Boolean; override;\r\n    function HandleDoMouseMove(Event: TJSMouseEvent): Boolean; override;\r\n    procedure DoCheckClick(ACol, ARow: Longint; Checked: boolean); virtual;\r\n    function DoHttpLoadJson(Event: TEventListenerEvent): boolean; virtual;\r\n    function DoHttpLoadCsv(Event: TEventListenerEvent): boolean; virtual;\r\n    function DoHttpAbort(Event: TEventListenerEvent): boolean; virtual;\r\n    procedure DoHttpRequest(ARequest: TJSXMLHttpRequest); virtual;\r\n    procedure GetCellData(ACol,ARow: integer; AField: TField; var AValue: string); virtual;\r\n    procedure GetCellClassName(ACol,ARow: integer; AField: TField; AValue: string; var AClassName: string); virtual;\r\n    procedure GetCellChildren(ACol,ARow: integer; AField: TField; AValue: string; AElement: TJSHTMLElement); virtual;\r\n    procedure BindCellChildren(ACol,ARow: integer; AElement: TJSHTMLElement); virtual;\r\n    procedure RenderGrid;\r\n    procedure RenderGridScript;\r\n    procedure BindEvents; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure SetRowCount(const Value: integer); override;\r\n    procedure RowCountChanged(delta: integer); override;\r\n    procedure ColCountChanged(delta: integer); override;\r\n    property OnHttpRequestError: TNotifyEvent read FOnHttpRequestError write FOnHttpRequestError;\r\n    property OnHttpRequestSuccess: TNotifyEvent read FOnHttpRequestSuccess write FOnHttpRequestSuccess;\r\n    property OnHttpRequest: TGridRequestEvent read FOnHttpRequest write FOnHttpRequest;\r\n    property RowCount;\r\n    property ColCount;\r\n    procedure EnableColResize;\r\n  public\r\n    constructor Create(AOwner: TComponent); override; overload;\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure InitSample(AInitMethod: TInitMethod);\r\n    procedure LoadFromJSON(const AURL: string; ADataNode: string = '');\r\n    procedure LoadFromCSV(const AURL: string; Delimiter: char = ';'; LoadFixed: boolean = false);\r\n    procedure AddCheckBox(ACol, ARow: integer; Checked: boolean);\r\n    procedure Clear;\r\n    property Cells[col,row: integer]: string read GetCells write SetCells;\r\n    property CellElements[col,row: integer]: TJSHTMLElement read GetCellElement;\r\n    property RowClassName[row: integer]: TElementClassName read GetRowClassName write SetRowClassName;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderColor;\r\n    property BorderStyle;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property ElementHeaderClassName: TElementClassName read FElementHeaderClassName write SetElementHeaderClassName;\r\n    property ElementTableClassName: TElementClassName read FElementTableClassName write SetElementTableClassName;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Margins;\r\n    property RowHeader: boolean read FRowHeader write FRowHeader default true;\r\n    property ColHeader: boolean read FColHeader write FColHeader default true;\r\n    property Options: TTableControlOptions read FOptions write SetOptions;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnCheckClick: TCellCheckEvent read FOnCheckClick write FOnCheckClick;\r\n    property OnClick;\r\n    property OnClickCell: TCellEvent read FOnClickCell write FOnClickCell;\r\n    property OnDblClickCell: TCellEvent read FOnDblClickCell write FOnDblClickCell;\r\n    property OnDblClick;\r\n    property OnGetCellData: TGridGetCellDataEvent read FOnGetCellData write FOnGetCellData;\r\n    property OnGetCellChildren: TGridGetCellChildrenEvent read FOnGetCellChildren write FOnGetCellChildren;\r\n    property OnGetCellClass: TGridGetCellClassEvent read FOnGetCellClass write FOnGetCellClass;\r\n  end;\r\n\r\n  TTableControl = class(TCustomTableControl)\r\n  published\r\n    property RowCount;\r\n    property ColCount;\r\n    property OnHttpRequestError;\r\n    property OnHttpRequestSuccess;\r\n  end;\r\n\r\n  TWebTableControl = class(TTableControl);\r\n\r\n  TResponsiveGridItem = class(TCollectionItem)\r\n  private\r\n    FHTML: string;\r\n    FElementHandle: TJSHTMLElement;\r\n    FTag: integer;\r\n    FItemObject: TObject;\r\n    procedure SetHTML(const Value: string);\r\n  public\r\n    destructor Destroy; override;\r\n    property ElementHandle: TJSHTMLElement read FElementHandle;\r\n    property ItemObject: TObject read FItemObject write FItemObject;\r\n  published\r\n    property HTML: string read FHTML write SetHTML;\r\n    property Tag: integer read FTag write FTag default 0;\r\n  end;\r\n\r\n  TResponsiveGridItemEvent = procedure(Sender: TObject; Index: integer) of object;\r\n\r\n  TResponsiveGridItemFieldValueEvent = procedure(Sender: TObject; Index: integer; AFieldName: string; var AValue: string) of object;\r\n\r\n  TResponsiveGridItems = class(TOwnedCollection)\r\n  private\r\n    FOnItemDelete: TResponsiveGridItemEvent;\r\n    FOnItemUpdate: TResponsiveGridItemEvent;\r\n    FOnItemInsert: TResponsiveGridItemEvent;\r\n    FOnItemAdd: TResponsiveGridItemEvent;\r\n    FOnItemClear: TNotifyEvent;\r\n    function GetItem(Index: integer): TResponsiveGridItem;\r\n    procedure SetItem(Index: integer; const Value: TResponsiveGridItem);\r\n  protected\r\n    procedure DoItemClear; virtual;\r\n    procedure DoItemAdd(Index: integer); virtual;\r\n    procedure DoItemDelete(Index: integer); virtual;\r\n    procedure DoItemInsert(Index: integer); virtual;\r\n    procedure DoItemUpdate(Index: integer); virtual;\r\n    property OnItemAdd: TResponsiveGridItemEvent read FOnItemAdd write FOnItemAdd;\r\n    property OnItemUpdate: TResponsiveGridItemEvent read FOnItemUpdate write FOnItemUpdate;\r\n    property OnItemDelete: TResponsiveGridItemEvent read FOnItemDelete write FOnItemDelete;\r\n    property OnItemInsert: TResponsiveGridItemEvent read FOnItemInsert write FOnItemInsert;\r\n    property OnItemClear: TNotifyEvent read FOnItemClear write FOnItemClear;\r\n    procedure Update(Item: TCollectionItem); override;\r\n  public\r\n    constructor Create(AOwner: TComponent);\r\n    procedure Clear;\r\n    procedure Delete(Index: integer);\r\n    function Add: TResponsiveGridItem;\r\n    function Insert(Index: integer): TResponsiveGridItem;\r\n    property Items[Index: integer]: TResponsiveGridItem read GetItem write SetItem; default;\r\n  end;\r\n\r\n  TResponsiveGridOptions = class(TPersistent)\r\n  private\r\n    FItemWidthMin: integer;\r\n    FItemHeight: integer;\r\n    FItemGap: integer;\r\n    FScrollVertical: boolean;\r\n    FItemClassName: string;\r\n    FItemColor: TColor;\r\n    FItemBorderColor: TColor;\r\n    FItemHoverColor: TColor;\r\n    FItemHoverBorderColor: TColor;\r\n    FOnChange: TNotifyEvent;\r\n    FItemPadding: integer;\r\n    FItemTemplate: string;\r\n    FItemSelectedBorderColor: TColor;\r\n    FItemSelectedTextColor: TColor;\r\n    FItemSelectedColor: TColor;\r\n    procedure SetItemBorderColor(const Value: TColor);\r\n    procedure SetItemColor(const Value: TColor);\r\n    procedure SetItemGap(const Value: integer);\r\n    procedure SetItemHeight(const Value: integer);\r\n    procedure SetItemHoverBorderColor(const Value: TColor);\r\n    procedure SetItemHoverColor(const Value: TColor);\r\n    procedure SetItemWidthMin(const Value: integer);\r\n    procedure SetScrollVertical(const Value: boolean);\r\n    procedure SetItemPadding(const Value: integer);\r\n    procedure SetItemTemplate(const Value: string);\r\n    procedure SetItemSelectedBorderColor(const Value: TColor);\r\n    procedure SetItemSelectedColor(const Value: TColor);\r\n    procedure SetItemSelectedTextColor(const Value: TColor);\r\n  protected\r\n    procedure Changed;\r\n  public\r\n    constructor Create;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property ItemClassName: string read FItemClassName write FItemClassName;\r\n    property ItemColor: TColor read FItemColor write SetItemColor default clNone;\r\n    property ItemBorderColor: TColor read FItemBorderColor write SetItemBorderColor default clNone;\r\n    property ItemGap: integer read FItemGap write SetItemGap default 10;\r\n    property ItemHeight: integer read FItemHeight write SetItemHeight default 100;\r\n    property ItemHoverColor: TColor read FItemHoverColor write SetItemHoverColor default clNone;\r\n    property ItemHoverBorderColor: TColor read FItemHoverBorderColor write SetItemHoverBorderColor default clNone;\r\n    property ItemSelectedColor: TColor read FItemSelectedColor write SetItemSelectedColor default clNone;\r\n    property ItemSelectedBorderColor: TColor read FItemSelectedBorderColor write SetItemSelectedBorderColor default clNone;\r\n    property ItemSelectedTextColor: TColor read FItemSelectedTextColor write SetItemSelectedTextColor default clNone;\r\n    property ItemPadding: integer read FItemPadding write SetItemPadding default 0;\r\n    property ItemTemplate: string read FItemTemplate write SetItemTemplate;\r\n    property ItemWidthMin: integer read FItemWidthMin write SetItemWidthMin default 100;\r\n    property ScrollVertical: boolean read FScrollVertical write SetScrollVertical default True;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TResponsiveGrid = class(TCustomControl)\r\n  private\r\n    FDesignTime: boolean;\r\n    FReq: TJSXMLHttpRequest;\r\n    FDataNode: string;\r\n    FOptions: TResponsiveGridOptions;\r\n    FItems: TResponsiveGridItems;\r\n    FOnItemDblClick: TResponsiveGridItemEvent;\r\n    FOnItemClick: TResponsiveGridItemEvent;\r\n    FOnHttpRequestError: TNotifyEvent;\r\n    FOnHttpRequestSuccess: TNotifyEvent;\r\n    FOnItemCreated: TResponsiveGridItemEvent;\r\n    FOnItemGetFieldValue: TResponsiveGridItemFieldValueEvent;\r\n    FItemIndex: integer;\r\n    FDelimiter: char;\r\n    FOnHttpRequest: TGridRequestEvent;\r\n    FListElement: TJSHTMLElement;\r\n    procedure SetOptions(const Value: TResponsiveGridOptions);\r\n    procedure SetItems(const Value: TResponsiveGridItems);\r\n    procedure SetItemIndex(const Value: integer);\r\n  protected\r\n    function DoHttpLoadJson(Event: TEventListenerEvent): boolean; virtual;\r\n    function DoHttpLoadCsv(Event: TEventListenerEvent): boolean; virtual;\r\n    function DoHttpAbort(Event: TEventListenerEvent): boolean; virtual;\r\n    procedure DoHttpRequest(ARequest: TJSXMLHttpRequest); virtual;\r\n    procedure DoItemCreated(Index: integer); virtual;\r\n    procedure DoItemGetFieldValue(Index: integer; AFieldName: string; var AValue: string); virtual;\r\n\r\n    procedure HandleDoItemClick(Index: integer); virtual;\r\n    procedure HandleDoItemDblClick(Index: integer); virtual;\r\n    function TargetIsParent(tgt,el: TJSElement): boolean; virtual;\r\n    function HandleDoMouseEnter(Event: TJSMouseEvent): Boolean; override;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; override;\r\n    function HandleDoDblClick(Event: TJSMouseEvent): Boolean; override;\r\n    procedure HandleItemAdd(Sender:  TObject; Index: integer);\r\n    procedure HandleItemUpdate(Sender:  TObject; Index: integer);\r\n    procedure HandleItemDelete(Sender:  TObject; Index: integer);\r\n    procedure HandleItemInsert(Sender:  TObject; Index: integer);\r\n    procedure HandleItemClear(Sender: TObject);\r\n    procedure OptionsChanged(Sender: TObject); virtual;\r\n    procedure FontChanged; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure CreateControl; override;\r\n    procedure BindElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure RenderGrid;\r\n    procedure Loaded; override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override; overload;\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure LoadFromJSON(const AURL: string; ADataNode: string = '');\r\n    procedure LoadFromCSV(const AURL: string; Delimiter: char = ';');\r\n    function ListElementHandle: TJSElement;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ElementID;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n\r\n    property ItemIndex: integer read FItemIndex write SetItemIndex default 0;\r\n    property Items: TResponsiveGridItems read FItems write SetItems;\r\n    property Margins;\r\n    property Options: TResponsiveGridOptions read FOptions write SetOptions;\r\n    property ParentFont;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnItemCreated: TResponsiveGridItemEvent read FOnItemCreated write FOnItemCreated;\r\n    property OnItemGetFieldValue: TResponsiveGridItemFieldValueEvent read FOnItemGetFieldValue write FOnItemGetFieldValue;\r\n    property OnItemClick: TResponsiveGridItemEvent read FOnItemClick write FOnItemClick;\r\n    property OnItemDblClick: TResponsiveGridItemEvent read FOnItemDblClick write FOnItemDblClick;\r\n    property OnHttpRequestError: TNotifyEvent read FOnHttpRequestError write FOnHttpRequestError;\r\n    property OnHttpRequestSuccess: TNotifyEvent read FOnHttpRequestSuccess write FOnHttpRequestSuccess;\r\n    property OnHttpRequest: TGridRequestEvent read FOnHttpRequest write FOnHttpRequest;\r\n  end;\r\n\r\n  TWebResponsiveGrid = class(TResponsiveGrid);\r\n\r\nfunction GridRect(Left,Top,Right,Bottom: integer): TGridRect;\r\n\r\nimplementation\r\n\r\nuses\r\n  SysUtils, Math;\r\n\r\nfunction GridRect(Left,Top,Right,Bottom: integer): TGridRect;\r\nbegin\r\n  Result.Left := Left;\r\n  Result.Top := Top;\r\n  Result.Right := Right;\r\n  Result.Bottom := Bottom;\r\nend;\r\n\r\n{ TCustomStringGrid }\r\n\r\nprocedure TCustomStringGrid.BindCellChildren(ACol, ARow: integer; AElement: TJSHTMLElement);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  el := TJSHTMLElement(AElement.firstChild);\r\n\r\n  if Assigned(el) and (el.tagName = 'INPUT') then\r\n  begin\r\n    if (lowercase(el.getAttribute('TYPE'))= 'checkbox') then\r\n    begin\r\n      el.addEventListener('click', @HandleCheckBoxClick);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.BindEvents;\r\nbegin\r\n  inherited;\r\n  RenderGridScript;\r\nend;\r\n\r\nfunction TCustomStringGrid.CanSelect(ACol, ARow: integer): boolean;\r\nbegin\r\n  Result := true;\r\n  if Assigned(OnSelectCell) then\r\n    OnSelectCell(Self, ACol, ARow, Result);\r\nend;\r\n\r\nprocedure TCustomStringGrid.ChangeRow;\r\nbegin\r\n  //\r\nend;\r\n\r\nprocedure TCustomStringGrid.Clear;\r\nvar\r\n  c,r: integer;\r\nbegin\r\n  for c := 0 to ColCount - 1 do\r\n    for r := 0 to Rowcount - 1 do\r\n      Cells[c,r] := '';\r\nend;\r\n\r\nprocedure TCustomStringGrid.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleEditBlurPtr := nil;\r\n  FHandleEditKeypressPtr := nil;\r\nend;\r\n\r\nprocedure TCustomStringGrid.ColCountChanged(delta: integer);\r\nvar\r\n  c: integer;\r\nbegin\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if delta > 0 then\r\n  begin\r\n    asm\r\n      var i = 0;\r\n      var j = 0;\r\n      var k = 0;\r\n      var tr = undefined;\r\n      var td = undefined;\r\n      var sizediv,div = undefined;\r\n\r\n      var l = this.FNormalCells.rows.length;\r\n\r\n      for(j = 0; j < l; j++)\r\n      {\r\n        tr = this.FNormalCells.rows[j];\r\n\r\n        k = tr.cells.length;\r\n\r\n         for(i = 0; i < delta; i++)\r\n         {\r\n           tr.insertCell(k);\r\n         }\r\n      }\r\n\r\n      for(j = 0; j < this.FFixedRows; j++)\r\n      {\r\n\r\n        k = this.FFixedRow.rows[j].cells.length;\r\n\r\n        for(i = 0; i < delta; i++)\r\n        {\r\n          td = this.FFixedRow.rows[j].insertCell(k);\r\n          div = document.createElement(\"DIV\");\r\n          div.style = 'position:relative;height:100%;width:100%';\r\n          td.appendChild(div);\r\n          sizediv = document.createElement(\"DIV\");\r\n          sizediv.style = 'position:absolute;height:100%;width:5px;margin-right:-5px;left:100%;top:0px;cursor:w-resize;z-index:999;';\r\n          div.appendChild(sizediv);\r\n        }\r\n      }\r\n    end;\r\n\r\n    for c := 1 to delta do\r\n    begin\r\n      ColWidths[ColCount - c] := DefaultColWidth;\r\n    end;\r\n  end;\r\n\r\n  if delta < 0 then\r\n  begin\r\n\r\n    asm\r\n      var i = 0;\r\n      var j = 0;\r\n      var k = 0;\r\n      var tr = undefined;\r\n\r\n      var l = this.FNormalCells.rows.length;\r\n\r\n      for(j = 0; j < l; j++)\r\n      {\r\n        tr = this.FNormalCells.rows[j];\r\n\r\n        k = tr.cells.length;\r\n\r\n         for(i = 0; i < -delta; i++)\r\n         {\r\n           tr.deleteCell(k - i - 1);\r\n         }\r\n      }\r\n\r\n      k = this.FFixedRow.rows[0].cells.length;\r\n\r\n      for(i = 0; i < -delta; i++)\r\n      {\r\n        this.FFixedRow.rows[0].deleteCell(k- i - 1);\r\n      }\r\n    end;\r\n\r\n    if ColCount > 0 then\r\n      ColWidths[ColCount - 1] := ColWidths[ColCount - 1];\r\n  end;\r\nend;\r\n\r\nconstructor TCustomStringGrid.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nfunction TCustomStringGrid.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n  FGrid := nil;\r\nend;\r\n\r\nprocedure TCustomStringGrid.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FColWidths := TList.Create;\r\n  FRowHeights := TList.Create;\r\n\r\n  FStartCell.X := -1;\r\n  FStartCell.Y := -1;\r\n  FFixedColor := clBtnFace;\r\n  FRowCount := 5;\r\n  FColCount := 5;\r\n  FFixedCols := 1;\r\n  FFixedRows := 1;\r\n  FDefaultColWidth := 64;\r\n  FDefaultRowHeight := 22;\r\n  ElementFont := efProperty;\r\n  ElementPosition := epAbsolute;\r\n  ScrollBars := ssBoth;\r\n  Options := [goHorzLine, goVertLine];\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\nend;\r\n\r\ndestructor TCustomStringGrid.Destroy;\r\nbegin\r\n  FColWidths.Free;\r\n  FRowHeights.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TCustomStringGrid.DoHttpLoadCsv(Event: TEventListenerEvent): boolean;\r\nvar\r\n  sl: TStringList;\r\n  arow: TStringList;\r\n  i,j: integer;\r\n  sr,sc: integer;\r\n  cd, cn: string;\r\n  ce: TJSHTMLElement;\r\n  req: TJSXMLHttpRequest;\r\nbegin\r\n  req := TJSXMLHttpRequest(Event.target);\r\n\r\n  if (req.status >= 200) and (req.status <= 208) then\r\n  begin\r\n    sl := TStringList.Create;\r\n\r\n    sl.Text := req.responseText;\r\n\r\n    RowCount := sl.Count + FixedRows;\r\n\r\n    arow := TStringList.Create;\r\n\r\n    sc := FixedCols;\r\n    sr := FixedRows;\r\n\r\n    if FLoadFixed then\r\n    begin\r\n      sr := 0;\r\n      sc := 0;\r\n    end;\r\n\r\n    try\r\n      for i := 0 to sl.Count - 1 do\r\n        begin\r\n          arow.StrictDelimiter := true;\r\n          arow.Delimiter := FDelimiter;\r\n          arow.DelimitedText := sl.Strings[i];\r\n\r\n          if arow.Count > ColCount - FixedCols then\r\n            ColCount := arow.Count + FixedCols;\r\n\r\n          for j := 0 to arow.Count - 1 do\r\n          begin\r\n            cd := arow.Strings[j];\r\n            GetCellData(j + sc, i + sr, nil, cd);\r\n            Cells[j + sc, i + sr] := cd;\r\n\r\n            ce := CellElements[j + sc, i + sr];\r\n\r\n            GetCellChildren(j + sc, i + sr, nil, cd, ce);\r\n\r\n            cn := '';\r\n            GetCellClassName(j + sc, i + sr, nil, cd, cn);\r\n            if cn <> '' then\r\n              ce.setAttribute('class',cn);\r\n          end;\r\n        end;\r\n    finally\r\n      arow.Free;\r\n      sl.Free;\r\n    end;\r\n\r\n    if Assigned(OnHttpRequestSuccess) then\r\n      OnHttpRequestSuccess(Self);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomStringGrid.LoadFromJSON(AJSON: TJSObject; ADataNode: string = '');\r\nvar\r\n  JO: JSValue;\r\n  JA: TJSArray;\r\n  r,c: integer;\r\n  arow: string;\r\n  sl: TStringList;\r\n  ce: TJSHTMLElement;\r\n  cd, cn: string;\r\n\r\nbegin\r\n  if ADataNode <> '' then\r\n    JA := TJSArray(AJSON.Properties[ADataNode])\r\n  else\r\n    JA := TJSArray(AJSON);\r\n\r\n  if Assigned(JA) then\r\n  begin\r\n    sl := TStringList.Create;\r\n\r\n    RowCount := JA.length +  FixedRows;\r\n\r\n    for r := 0 to JA.length - 1 do\r\n    begin\r\n      JO := JA.Elements[r];\r\n\r\n      c := 0;\r\n      arow := '';\r\n\r\n      asm\r\n        var x = undefined;\r\n        for (x in JO) {\r\n          arow += \"|\" + JO[x];\r\n          c++;\r\n        }\r\n      end;\r\n\r\n      Delete(arow, 1, 1);\r\n      sl.StrictDelimiter := true;\r\n      sl.Delimiter := '|';\r\n      sl.DelimitedText := arow;\r\n      if ColCount < sl.Count  then\r\n        ColCount := sl.Count + FixedCols;\r\n\r\n      for c := 0 to sl.Count - 1 do\r\n      begin\r\n        cd := sl.Strings[c];\r\n        GetCellData(FixedCols + c, FixedRows + r, nil, cd);\r\n        Cells[FixedCols + c, FixedRows + r] := cd;\r\n        cn := '';\r\n\r\n        ce := CellElements[FixedCols + c, FixedRows + r];\r\n\r\n        GetCellChildren(FixedCols + c, FixedRows + r, nil, cd, ce);\r\n\r\n        GetCellClassName(FixedCols + c, FixedRows + r, nil, cd, cn);\r\n        if cn <> '' then\r\n          ce.setAttribute('class',cn);\r\n      end;\r\n    end;\r\n\r\n    sl.Free;\r\n  end;\r\n\r\n  UpdateGridSize;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TCustomStringGrid.DoHttpLoadJson(Event: TEventListenerEvent): boolean;\r\nvar\r\n  J: TJSObject;\r\n  req: TJSXMLHttpRequest;\r\nbegin\r\n  req := TJSXMLHttpRequest(Event.target);\r\n\r\n  if (req.status >= 200) and (req.status <= 208) then\r\n  begin\r\n    J := TJSJSON.parseObject(req.responseText);\r\n\r\n    LoadFromJSON(J, FDataNode);\r\n\r\n    if Assigned(OnHttpRequestSuccess) then\r\n      OnHttpRequestSuccess(Self);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\n\r\nprocedure TCustomStringGrid.DoHttpRequest(ARequest: TJSXMLHttpRequest);\r\nbegin\r\n  if Assigned(OnHttpRequest) then\r\n    OnHttpRequest(Self, ARequest);\r\nend;\r\n\r\nprocedure TCustomStringGrid.EnableColResize;\r\nvar\r\n  TableName: string;\r\n  ResizeEnabled: Boolean;\r\nbegin\r\n  if not (csDesigning in ComponentState) then\r\n  begin\r\n    TableName := GetID + 'ResizeRow';\r\n\r\n    ResizeEnabled := (goColSizing in Options);\r\n    asm\r\n      TMSStringGridresizableGrid(TableName, ResizeEnabled);\r\n    end;\r\n\r\n    TableName := GetID + 'ResizeFixedRow';\r\n    ResizeEnabled := (goColSizing in Options);\r\n    asm\r\n      TMSStringGridresizableGrid(TableName, ResizeEnabled);\r\n    end;\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TCustomStringGrid.DoBoundsChange;\r\nvar\r\n  fw,fh,nwvis,nhvis: integer;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n\r\n    UpdateGridSize;\r\n\r\n    fw := FixedColWidth;\r\n    fh := FixedRowHeight;\r\n\r\n    nwvis := Width - fw;\r\n    nhvis := Height - fh;\r\n\r\n    if Assigned(FNormalCells) then\r\n    begin\r\n      TJSHTMLElement(FNormalCells.parentElement.parentElement).style.setProperty('width',inttostr(nwvis)+'px');\r\n      TJSHTMLElement(FNormalCells.parentElement.parentElement).style.setProperty('height',inttostr(nhvis)+'px');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.DoCheckClick(ACol, ARow: Longint; Checked: boolean);\r\nbegin\r\n  if Assigned(OnCheckClick) then\r\n    OnCheckClick(Self, ACol, ARow, Checked);\r\nend;\r\n\r\nfunction TCustomStringGrid.DoHttpAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnHttpRequestError) then\r\n    OnHttpRequestError(Self);\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomStringGrid.FixedColWidth: integer;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := 0;\r\n\r\n  for i := 0 to FixedCols - 1 do\r\n    Result := Result + ColWidths[i];\r\nend;\r\n\r\nfunction TCustomStringGrid.FixedRowHeight: integer;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := 0;\r\n\r\n  for i := 0 to FixedRows - 1 do\r\n    Result := Result + RowHeights[i];\r\nend;\r\n\r\nfunction TCustomStringGrid.FocusedCell: TJSElement;\r\nbegin\r\n  Result := FSelectedCell;\r\nend;\r\n\r\nprocedure TCustomStringGrid.GetCellChildren(ACol, ARow: integer; AField: TField;\r\n  AValue: string; AElement: TJSHTMLElement);\r\nbegin\r\n  if Assigned(OnGetCellChildren) then\r\n    OnGetCellChildren(Self, ACol, ARow, AField, AValue, AElement);\r\nend;\r\n\r\nprocedure TCustomStringGrid.GetCellClassName(ACol, ARow: integer;\r\n  AField: TField; AValue: string; var AClassName: string);\r\nbegin\r\n  if Assigned(OnGetCellClass) then\r\n    OnGetCellClass(Self, ACol, ARow, AField, AValue, AClassName);\r\nend;\r\n\r\nprocedure TCustomStringGrid.GetCellData(ACol, ARow: integer; AField: TField;\r\n  var AValue: string);\r\nbegin\r\n  if Assigned(OnGetCellData) then\r\n    OnGetCellData(Self, ACol, ARow, AField, AValue);\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TCustomStringGrid.GetCellElements(ACol, ARow: integer): TJSHTMLElement;\r\nvar\r\n  rc,rr: integer;\r\n  res: TJSHTMLElement;\r\nbegin\r\n  if (ACol < FixedCols) and (ARow >= FixedRows) then\r\n  begin\r\n    rr := ARow - FixedRows;\r\n    rc := ACol;\r\n\r\n    asm\r\n      res = this.FFixedCol.rows[rr].cells[rc];\r\n    end;\r\n  end;\r\n\r\n  if (ARow < FixedRows) and (ACol >= FixedCols) then\r\n  begin\r\n    rc := ACol - FixedCols;\r\n    rr := ARow;\r\n\r\n    asm\r\n      res = this.FFixedRow.rows[rr].cells[rc];\r\n    end;\r\n  end;\r\n\r\n  if (ACol < FixedCols) and (ARow < FixedRows) then\r\n  begin\r\n    asm\r\n      res = this.FFixedColRow.rows[rr].cells[rc];\r\n    end;\r\n  end;\r\n\r\n  if (ACol >= FixedCols) and (ARow >= FixedRows) then\r\n  begin\r\n    rc := ACol - FixedCols;\r\n    rr := ARow - FixedRows;\r\n    asm\r\n      res = this.FNormalCells.rows[rr].cells[rc];\r\n    end;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction TCustomStringGrid.GetCells(ACol, ARow: integer): string;\r\nvar\r\n  td: TJSHTMLElement;\r\nbegin\r\n  td := CellElements[ACol,ARow];\r\n  Result := td.innerHTML;\r\nend;\r\n\r\nfunction TCustomStringGrid.GetCol: integer;\r\nvar\r\n  res: integer;\r\nbegin\r\n  res := -1;\r\n  if  Assigned(FSelectedCell) then\r\n  begin\r\n    asm\r\n      res = this.FSelectedCell.cellIndex;\r\n    end;\r\n    res := res + FixedCols;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TCustomStringGrid.GetColWidths(ACol: integer): integer;\r\nbegin\r\n  if ACol < FColWidths.Count then\r\n    Result := integer(FColWidths.Items[ACol])\r\n  else\r\n    Result := DefaultColWidth;\r\nend;\r\n\r\nfunction TCustomStringGrid.GetEditText(ACol, ARow: Longint): string;\r\nbegin\r\n  Result := Cells[ACol,ARow];\r\n\r\n  if Assigned(OnGetEditText) then\r\n    OnGetEditText(Self, ACol, ARow, Result);\r\nend;\r\n\r\nfunction TCustomStringGrid.GetGridCSS: string;\r\nbegin\r\n  Result := '';\r\n\r\n  if not (goVertLine in Options) then\r\n    Result := 'border-left: 0px; border-right: 0px;';\r\n\r\n  if not (goHorzLine in Options) then\r\n    Result := Result + 'border-top: 0px; border-bottom: 0px;';\r\n\r\n  if ElementFont = efProperty then\r\n    Result := Result + CSSFont(Font);\r\n\r\n  Result := 'table.tstringgrid td { overflow: hidden; text-overflow: ellipsis; white-space:nowrap; border: solid 1px #cccccc; padding: 0px;' + Result + '} '+\r\n                   'table.tstringgrid td.selected { background-color: #5B8FFF; color: #FFFFFF; } '+\r\n                   'table.tstringgrid tr.selected { background-color: #5B8FFF; color: #FFFFFF; } ';\r\nend;\r\n\r\nfunction TCustomStringGrid.GetLeftCol: integer;\r\nvar\r\n  i,w,l: integer;\r\nbegin\r\n  Result := FixedCols;\r\n\r\n\r\n  if Assigned(FNormalCells) then\r\n  begin\r\n    l := FNormalCells.parentElement.parentElement.scrollLeft;\r\n    w := 0;\r\n    for i := FixedCols to ColCount - 1 do\r\n    begin\r\n     if l <= w then\r\n     begin\r\n       Result := i;\r\n       break;\r\n     end;\r\n      w := w + ColWidths[i]+1;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandleEditBlurPtr := @HandleEditBlur;\r\n  FHandleEditKeypressPtr := @HandleEditKeypress;\r\nend;\r\n\r\nfunction TCustomStringGrid.GetRow: integer;\r\nvar\r\n  res: integer;\r\nbegin\r\n  res := -1;\r\n  if Assigned(FSelectedCell) then\r\n  begin\r\n    asm\r\n      res = this.FSelectedCell.parentElement.rowIndex;\r\n    end;\r\n    res := res + FixedRows;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TCustomStringGrid.GetRowHeights(ARow: integer): integer;\r\nbegin\r\n  if ARow < FRowHeights.Count then\r\n    Result := integer(FRowHeights.Items[ARow])\r\n  else\r\n    Result := DefaultRowHeight;\r\nend;\r\n\r\nfunction TCustomStringGrid.GetSelection: TGridRect;\r\nbegin\r\n  Result := FSelection;\r\nend;\r\n\r\nfunction TCustomStringGrid.GetTopRow: integer;\r\nvar\r\n  pixVal: integer;\r\nbegin\r\n  Result := FixedRows;\r\n\r\n  if Assigned(FNormalCells) and (pixVal >= 0) then\r\n  begin\r\n    pixVal := FNormalCells.parentElement.parentElement.scrollTop;\r\n\r\n    Result := FixedRows + pixVal div DefaultRowHeight;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.GridChanged;\r\nbegin\r\n  inherited;\r\n  UpdateGridSize;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TCustomStringGrid.HandleCheckBoxClick(Event: TJSEvent): Boolean;\r\nvar\r\n  rindex, cindex: integer;\r\n  chk: boolean;\r\nbegin\r\n  rindex := -1;\r\n  cindex := -1;\r\n\r\n  asm\r\n    var el = Event.target;\r\n    chk = el.checked;\r\n    var d = el.parentElement;\r\n    if (d.tagName.toLowerCase() == 'td')\r\n    {\r\n      cindex = d.cellIndex;\r\n      var tr = d.parentElement;\r\n      rindex = tr.rowIndex;\r\n    }\r\n  end;\r\n\r\n  if (rindex <> -1) and (cindex <> -1) then\r\n  begin\r\n    DoCheckClick(cindex + FixedCols, rindex + FixedRows, chk);\r\n  end;\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleFixedClick(Event: TJSEvent): Boolean;\r\nvar\r\n  rindex,cindex: integer;\r\n  rselect: boolean;\r\n  tbl: TJSHTMLElement;\r\n  ACol,ARow: integer;\r\n\r\nbegin\r\n  Result := true;\r\n\r\n  rselect := (goRowSelect in Options);\r\n  rindex := -1;\r\n  cindex := -1;\r\n\r\n  asm\r\n    if (Event.target.tagName.toLowerCase() == 'td')\r\n    {\r\n      cindex = Event.target.cellIndex;\r\n      var tr = Event.target.parentElement;\r\n      rindex = tr.rowIndex;\r\n      tbl = tr.parentElement;\r\n      tbl = tbl.parentElement;\r\n    }\r\n  end;\r\n\r\n  if (cindex = -1) or (rindex = -1) then\r\n    Exit;\r\n\r\n  ACol := cindex;\r\n  ARow := rindex;\r\n\r\n  if tbl = FFixedCol then\r\n  begin\r\n    ARow := rindex + FixedRows;\r\n  end;\r\n\r\n  if tbl = FFixedRow then\r\n  begin\r\n    ACol := cindex + FixedCols;\r\n  end;\r\n\r\n  if Assigned(OnFixedCellClick) then\r\n    OnFixedCellClick(Self, ACol, ARow);\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleClick(Event: TJSEvent): Boolean;\r\nvar\r\n  rindex,cindex: integer;\r\n  rselect: boolean;\r\n\r\nbegin\r\n  Result := true;\r\n\r\n  rselect := (goRowSelect in Options);\r\n  rindex := -1;\r\n  cindex := -1;\r\n\r\n  asm\r\n    if (Event.target.tagName.toLowerCase() == 'td')\r\n    {\r\n      cindex = Event.target.cellIndex;\r\n      var tr = Event.target.parentElement;\r\n      rindex = tr.rowIndex;\r\n    }\r\n  end;\r\n\r\n  if (cindex = -1) or (rindex = -1) then\r\n    Exit;\r\n\r\n  if not CanSelect(cindex, rindex) then\r\n  begin\r\n    Exit;\r\n  end;\r\n\r\n  SelectCell(cindex + FixedCols, rindex+ FixedRows);\r\n\r\n  if Assigned(FSelectedCell) then\r\n  begin\r\n    if FSelMouseDown then\r\n    begin\r\n      if (goEditing in Options) then\r\n        ShowEdit;\r\n    end\r\n    else\r\n    asm\r\n      if (rselect) {\r\n        var colindex = this.FSelectedCell.cellIndex;\r\n        var tr = this.FSelectedCell.parentElement;\r\n        tr.classList.remove(\"selected\");\r\n      }\r\n      else {\r\n      this.FSelectedCell.classList.remove(\"selected\");\r\n      }\r\n    end;\r\n  end;\r\n\r\n  asm\r\n    if (Event.target.tagName.toLowerCase() == 'td')\r\n    {\r\n      var colindex = Event.target.cellIndex;\r\n      var tr = Event.target.parentElement;\r\n      var rowindex = tr.rowIndex;\r\n      this.FSelectedCell = Event.target;\r\n\r\n      if (rselect) {\r\n        tr.classList.add(\"selected\");\r\n      }\r\n      else {\r\n      Event.target.classList.add(\"selected\");\r\n      }\r\n    }\r\n  end;\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleDoMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  CtrlName: string;\r\n  IsAutoWidth: Boolean;\r\nbegin\r\n  inherited;\r\n\r\n  CtrlName := GetID;\r\n  IsAutoWidth := (WidthStyle in [ssAuto]);\r\n  asm\r\n    TMSStringGridID = CtrlName;\r\n    TMSStringGridautoWidth = IsAutoWidth;\r\n    GridNormalCells = this.FNormalCells;\r\n    GridFixedCells = this.FFixedRow;\r\n    GridFixedColCells = this.FFixedCol;\r\n    GridFixedColRows = this.FFixedColRow;\r\n    GridColWidths = this.FColWidths;\r\n    GridFixedCols = this.FFixedCols;\r\n    TMSStringGridresizeColumn(Event);\r\n  end;\r\n\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleDoMouseUp(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  inherited;\r\n\r\n  asm\r\n    TMSStringGridresetResize();\r\n  end;\r\n\r\n  Result := True;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nfunction TCustomStringGrid.HandleEditBlur(Event: TJSEvent): Boolean;\r\nbegin\r\n  if FEditMode then\r\n  begin\r\n    HideEdit;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleEditKeyPress(Event: TJSKeyboardEvent): boolean;\r\nbegin\r\n  Event.cancelBubble := true;\r\n  Event.stopPropagation;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleKeyDown(Event: TJSKeyboardEvent): boolean;\r\nvar\r\n  k: Word;\r\n  newcol,newrow: integer;\r\nbegin\r\n  Result := true;\r\n\r\n  Event.cancelBubble := true;\r\n\r\n  Event.StopPropagation;\r\n\r\n  k := GetKeyCode(Event.Key);\r\n\r\n  newrow := Row;\r\n  newcol := Col;\r\n\r\n  if (newrow = -1) and (newcol = -1) and (ColCount > FixedCols) and (RowCount > FixedRows) then\r\n  begin\r\n    newcol := FixedCols;\r\n    newrow := FixedRows;\r\n    Col := FixedCols;\r\n    Row := FixedRows;\r\n    TJSHTMLElement(FNormalCells).focus;\r\n  end;\r\n\r\n  //ss := GetKeyboardEventShiftState(Event);\r\n\r\n  // Up, Down, PageUp, PageDn\r\n  if (k in [38, 40, 33, 34]) then\r\n  begin\r\n    Event.preventDefault;\r\n    HideEdit;\r\n    ChangeRow;\r\n  end;\r\n\r\n  // Home, End, Left, Right should only work when not in edit mode\r\n  if not EditMode and (k in [35, 36, 37, 39]) then\r\n  begin\r\n    Event.preventDefault;\r\n    HideEdit;\r\n  end;\r\n\r\n  // ESC\r\n  if (k = 27) then\r\n  begin\r\n    if Assigned(FEdit) and EditMode then\r\n      (FEdit as TJSHTMLInputElement).value := FOrigVal;\r\n    HideEdit;\r\n  end;\r\n\r\n  if not EditMode and Event.shiftKey and (goRangeSelect in Options) then\r\n  begin\r\n    // End\r\n    if (k = 35) then\r\n    begin\r\n      Row := RowCount - 1;\r\n      Selection := GridRect(Col, newrow, Col, Row);\r\n    end;\r\n\r\n    // Home\r\n    if (k = 36) then\r\n    begin\r\n      Row := FixedRows;\r\n      Selection := GridRect(Col, newrow, Col, Row);\r\n    end;\r\n\r\n    // arrow Up\r\n    if (k = 38) and (Row > FixedRows) then\r\n    begin\r\n      if Row = min(Selection.Top, Selection.Bottom) then\r\n        newrow := max(Selection.Top, Selection.Bottom)\r\n      else\r\n        newrow := min(Selection.Top, Selection.Bottom);\r\n\r\n      Row := Row - 1;\r\n      Selection := GridRect(Selection.Left, newrow, Selection.Right, Row);\r\n    end;\r\n\r\n    // arrow Down\r\n    if (k = 40) and (Row < RowCount - 1) then\r\n    begin\r\n      if Row = max(Selection.Top, Selection.Bottom) then\r\n        newrow := min(Selection.Top, Selection.Bottom)\r\n      else\r\n        newrow := max(Selection.Top, Selection.Bottom);\r\n\r\n      Row := Row + 1;\r\n      Selection := GridRect(Selection.Left, newrow, Selection.Right, Row);\r\n    end;\r\n\r\n    // arrow Left\r\n    if (k = 37) and (Col > FixedCols) then\r\n    begin\r\n      if Col = min(Selection.Left, Selection.Right) then\r\n        newcol := max(Selection.Left, Selection.Right)\r\n      else\r\n        newcol := min(Selection.Left, Selection.Right);\r\n\r\n      Col := Col - 1;\r\n      Selection := GridRect(newcol, Selection.Top, Col, Selection.Bottom);\r\n    end;\r\n\r\n    // arrow Right\r\n    if (k = 39) and (Col < ColCount - 1) then\r\n    begin\r\n      if Col = max(Selection.Left, Selection.Right) then\r\n        newcol := min(Selection.Left, Selection.Right)\r\n      else\r\n        newcol := max(Selection.Left, Selection.Right);\r\n\r\n      Col := Col + 1;\r\n\r\n      Selection := GridRect(newcol, Selection.Top, Col, Selection.Bottom);\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    // End\r\n    if (k = 35) then\r\n    begin\r\n      newrow := RowCount - 1;\r\n    end;\r\n\r\n    // Home\r\n    if (k = 36) then\r\n    begin\r\n      newrow := FixedRows;\r\n    end;\r\n\r\n    // PgUp\r\n    if (k = 34) then\r\n    begin\r\n      if (Row + 4 <= RowCount - 1) then\r\n      begin\r\n        newrow := Row + 4;\r\n      end\r\n      else\r\n      begin\r\n        newrow := RowCount - 1;\r\n      end;\r\n    end;\r\n\r\n    // PgDn\r\n    if (k = 33) then\r\n    begin\r\n      if Row - 4 > FixedRows then\r\n      begin\r\n        newrow := Row - 4\r\n      end\r\n      else\r\n      begin\r\n        newrow := FixedRows;\r\n      end;\r\n    end;\r\n\r\n    // arrow Up\r\n    if not EditMode and (k = 38) and (Row > FixedRows) then\r\n    begin\r\n      newrow := Row - 1;\r\n    end;\r\n\r\n    // arrow Down\r\n    if not EditMode and (k = 40) and (Row < RowCount - 1) then\r\n    begin\r\n      newrow := Row + 1;\r\n    end;\r\n\r\n    // arrow Left\r\n    if not EditMode and (k = 37) and (Col > FixedCols) then\r\n    begin\r\n      newcol := Col - 1;\r\n    end;\r\n\r\n    // arrow Right\r\n    if not EditMode and (k = 39) and (Col < ColCount - 1) then\r\n    begin\r\n      newcol := Col + 1;\r\n    end;\r\n\r\n    if not EditMode and CanSelect(newcol,newrow) then\r\n    begin\r\n      Col := newcol;\r\n      Row := newrow;\r\n\r\n      SelectCell(newcol,newrow);\r\n    end;\r\n\r\n    if (k = 113) and not EditMode and (goEditing in Options) then\r\n      ShowEdit;\r\n\r\n    if (k >= 48) and (k <= 122) and not EditMode then\r\n      StartEdit(Event.Key);\r\n\r\n    if (k = 13) and (goEditing in Options) then\r\n    begin\r\n      if EditMode then\r\n      begin\r\n        HideEdit;\r\n      end\r\n      else\r\n        ShowEdit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleMouseDown(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  rindex, cindex: integer;\r\n  l, t: Single;\r\n  ss: TShiftState;\r\n  mb: TMouseButton;\r\nbegin\r\n  rindex := -1;\r\n  cindex := -1;\r\n\r\n  asm\r\n    if (Event.target.tagName.toLowerCase() == 'td')\r\n    {\r\n      cindex = Event.target.cellIndex;\r\n      var tr = Event.target.parentElement;\r\n      rindex = tr.rowIndex;\r\n    }\r\n  end;\r\n\r\n  FSelMouseDown := Event.target = FSelectedCell;\r\n\r\n  if Assigned(FSelectedCell) and not FSelMouseDown and (cindex <> -1) and (rindex <> -1) then\r\n  begin\r\n    HideEdit;\r\n  end;\r\n\r\n  if not CanSelect(cindex, rindex) then\r\n    Exit;\r\n\r\n  if (cindex >= 0) and (rindex >= 0) then\r\n  begin\r\n    if (goRowSelect in Options) then\r\n      Selection := GridRect(FixedCols, rindex + FixedRows, ColCount - 1, rindex + FixedRows)\r\n    else\r\n      Selection := GridRect(cindex + FixedCols, rindex + FixedRows, cindex + FixedCols, rindex + FixedRows);\r\n\r\n    if (goRangeSelect in Options) then\r\n    begin\r\n      FStartCell.X := cindex + FixedCols;\r\n      FStartCell.Y := rindex + FixedRows;\r\n    end\r\n    else\r\n    begin\r\n      FStartCell.X := -1;\r\n      FStartCell.Y := -1;\r\n    end;\r\n  end;\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n  mb := GetMouseEventButton(Event);\r\n\r\n  MouseDown(mb, ss, Trunc(l), Trunc(t));\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleScroll(Event: TJSEvent): Boolean;\r\nbegin\r\n  if FixedCols > 0 then\r\n    FFixedCol.parentElement.scrollTop := FNormalCells.parentElement.parentElement.scrollTop;\r\n\r\n  if FixedRows > 0 then\r\n    FFixedRow.parentElement.parentElement.scrollLeft := FNormalCells.parentElement.parentElement.scrollLeft;\r\n\r\n  TopLeftChanged;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleTableFocus(Event: TJSEvent): Boolean;\r\nbegin\r\n  if (Col = -1) and (Row = -1) and (FixedCols < ColCount) and (FixedRows < RowCount) and CanSelect(FixedCols, FixedRows) then\r\n  begin\r\n    SelectCell(FixedCols, FixedRows);\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomStringGrid.HideEdit;\r\nvar\r\n  val: string;\r\nbegin\r\n  if EditMode then\r\n  begin\r\n    FEditMode := false;\r\n\r\n    val := (FEdit as TJSHTMLInputElement).value;\r\n\r\n    ValidateCell(FEditCol, FEditRow, val);\r\n\r\n    FSelectedCell.removeChild(FEdit);\r\n    FSelectedCell.innerHTML := val;\r\n\r\n    UpdateCell(FEditCol, FEditRow, val);\r\n\r\n    SetEditText(FEditCol, FEditRow, val);\r\n\r\n    TJSHTMLElement(FNormalCells).focus();\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.InitSample(AInitMethod: TInitMethod);\r\nvar\r\n  i,j: integer;\r\nbegin\r\n  for i := 0 to RowCount - 1 do\r\n  begin\r\n    for j := 0 to ColCount - 1 do\r\n    begin\r\n     case AInitMethod of\r\n     imRandom:\r\n       Cells[j,i] := IntToStr(Random(100));\r\n     imLinear:\r\n       Cells[j,i] := IntToStr(j)+':'+IntToStr(i);\r\n     end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.MouseToCell(X,Y: integer; var C, R: integer);\r\nvar\r\n  DocX,DocY: single;\r\n  el: TJSHTMLElement;\r\n  cindex,rindex: integer;\r\nbegin\r\n  C := -1;\r\n  R := -1;\r\n\r\n  ClientToXY(X,Y,DocX,DocY);\r\n\r\n  el := TJSHTMLElement(document.elementFromPoint(Round(DocX),Round(DocY)));\r\n\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      if (el.tagName.toLowerCase() == 'td')\r\n      {\r\n        cindex = el.cellIndex;\r\n        var tr = el.parentElement;\r\n        rindex = tr.rowIndex;\r\n\r\n        if (tr.parentElement.parentElement == this.FNormalCells)\r\n        {\r\n          rindex = rindex + this.FFixedRows;\r\n          cindex = cindex + this.FFixedCols;\r\n        }\r\n        if (tr.parentElement.parentElement == this.FFixedCol)\r\n        {\r\n          rindex = rindex + this.FFixedRows;\r\n        }\r\n        if (tr.parentElement.parentElement == this.FFixedRow)\r\n        {\r\n          cindex = cindex + this.FFixedCols;\r\n        }\r\n      }\r\n    end;\r\n\r\n    R := rindex;\r\n    C := cindex;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomStringGrid.LoadFromCSV(const AURL: string; Delimiter: char = ';'; LoadFixed: boolean = false);\r\nbegin\r\n  FDelimiter := Delimiter;\r\n  FLoadFixed := LoadFixed;\r\n\r\n  FReq := TJSXMLHttpRequest.new;\r\n  FReq.addEventListener('load',@DoHttpLoadCsv);\r\n  FReq.addEventListener('abort',@DoHttpAbort);\r\n  DoHttpRequest(FReq);\r\n  FReq.open('GET', AURL);\r\n  FReq.send;\r\nend;\r\n\r\nprocedure TCustomStringGrid.LoadFromJSON(const AURL: string; ADataNode: string = '');\r\nbegin\r\n  FDataNode := ADataNode;\r\n  FReq := TJSXMLHttpRequest.new;\r\n  FReq.addEventListener('load',@DoHttpLoadJson);\r\n  FReq.addEventListener('abort',@DoHttpAbort);\r\n  DoHttpRequest(FReq);\r\n  FReq.open('GET', AURL);\r\n  FReq.send;\r\nend;\r\n\r\nprocedure TCustomStringGrid.MouseMove(Shift: TShiftState; X, Y: Integer);\r\nbegin\r\n  inherited;\r\n  if (FStartCell.X <> -1) and (FStartCell.Y <> -1) then\r\n  begin\r\n    if (Y > Height - 10) then\r\n    begin\r\n      TopRow := TopRow + 1;\r\n      Selection := GridRect(Selection.Left, min(Selection.Top, Selection.Bottom), Selection.Right, max(Selection.Top, Selection.Bottom) + 1);\r\n    end;\r\n\r\n    if (FixedRows > 0) and (Y < RowHeights[0]) and (TopRow > FixedRows) then\r\n    begin\r\n      TopRow := TopRow - 1;\r\n      Selection := GridRect(Selection.Left, min(Selection.Top, Selection.Bottom) - 1, Selection.Right, max(Selection.Top, Selection.Bottom));\r\n    end;\r\n\r\n    if (X > Width - 10) then\r\n    begin\r\n      LeftCol := LeftCol + 1;\r\n      Selection := GridRect(min(Selection.Left, Selection.Right), Selection.Top, max(Selection.Left, Selection.Right) + 1, Selection.Bottom);\r\n    end;\r\n\r\n    if (FixedCols > 0) and (X < ColWidths[0]) and (LeftCol > FixedCols) then\r\n    begin\r\n      LeftCol := LeftCol - 1;\r\n      Selection := GridRect(min(Selection.Left, Selection.Right) - 1, Selection.Top, max(Selection.Left, Selection.Right), Selection.Bottom);\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nfunction TCustomStringGrid.NormalColWidth: integer;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := 1;\r\n\r\n  for i := FixedCols to ColCount - 1 do\r\n    Result := Result + ColWidths[i] + 1;\r\nend;\r\n\r\nfunction TCustomStringGrid.NormalRowHeight: integer;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := 0;\r\n\r\n  for i := FixedRows to RowCount - 1 do\r\n    Result := Result + RowHeights[i];\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure TCustomStringGrid.RenderGrid;\r\nvar\r\n  res: TJSHTMLElement;\r\n  i,j,k,fw,fh,nw,nh,nwvis,nhvis,nwvisnoscroll,nhvisnoscroll: integer;\r\n  tr, td, span, cellspan: TJSElement;\r\n  fixcol: string;\r\n  dynstyle: string;\r\n  vscroll,hscroll: boolean;\r\n  LAutoSizeW: boolean;\r\n  ControlName: string;\r\nbegin\r\n  while FColWidths.Count <= ColCount do\r\n    FColWidths.Add(DefaultColWidth);\r\n\r\n  if not Assigned(FGrid) then\r\n  begin\r\n    if IsLinked then\r\n      res := TJSHTMLElement(ElementHandle.firstChild)\r\n    else\r\n      res := TJSHTMLElement(document.createElement('TABLE'));\r\n\r\n    res.setAttribute('id', GetID);\r\n    res.setAttribute('class','tstringgrid');\r\n    res.style.setProperty('border-collapse','collapse');\r\n    res.style.setProperty('border-spacing','0px');\r\n    res.style.setProperty('border','0px');\r\n    FGrid := res;\r\n\r\n    SetHTMLElementFont(res, Font, not ((ElementClassName = '') and (ElementFont = efProperty)) );\r\n\r\n    AddInstanceStyle(GetGridCSS);\r\n  end\r\n  else\r\n    Exit;\r\n\r\n  LAutoSizeW := WidthStyle = ssAuto;\r\n  ControlName := GetID;\r\n\r\n  asm\r\n    var td = undefined;\r\n    var tr = undefined;\r\n    var span = undefined;\r\n    var cellspan = undefined;\r\n    this.FFixedColRow = document.createElement('TABLE');\r\n    this.FFixedColRow.setAttribute('id', ControlName + 'ResizeFixedRowTable');\r\n    this.FFixedColRow.style.setProperty('border-collapse','collapse');\r\n    this.FFixedColRow.style.setProperty('border-spacing','0px');\r\n\r\n    this.FFixedCol = document.createElement('TABLE');\r\n    this.FFixedCol.setAttribute('id', ControlName + 'ResizeFixedColTable');\r\n    this.FFixedCol.style.setProperty('border-collapse','collapse');\r\n    this.FFixedCol.style.setProperty('border-spacing','0px');\r\n\r\n    this.FFixedRow = document.createElement('TABLE');\r\n    this.FFixedRow.setAttribute('id', ControlName + 'ResizeRowTable');\r\n    this.FFixedRow.style.setProperty('border-collapse','collapse');\r\n    this.FFixedRow.style.setProperty('border-spacing','0px');\r\n    this.FFixedRow.style.setProperty('border','0px');\r\n\r\n    this.FNormalCells = document.createElement('TABLE');\r\n    this.FNormalCells.setAttribute('id', ControlName + 'ResizeRowTable');\r\n    this.FNormalCells.style.setProperty('border-collapse','collapse');\r\n    this.FNormalCells.style.setProperty('border-spacing','0px');\r\n  end;\r\n\r\n  // make normal grid cells focusable\r\n  FNormalCells.setAttribute('tabindex',IntToStr(TabOrder));\r\n  TJSHTMLElement(FNormalCells).style.setProperty('outline','none');\r\n  FNormalCells.addEventListener('click',@HandleClick);\r\n  FNormalCells.addEventListener('mousedown',@HandleMouseDown);\r\n  FNormalCells.addEventListener('mousemove',@HandleMouseMove);\r\n  FNormalCells.addEventListener('mouseup',@HandleMouseUp);\r\n\r\n  FFixedCol.addEventListener('click',@HandleFixedClick);\r\n  FFixedRow.addEventListener('click',@HandleFixedClick);\r\n  FFixedColRow.addEventListener('click',@HandleFixedClick);\r\n\r\n  ElementHandle.appendChild(res);\r\n\r\n  fw := FixedColWidth;\r\n  fh := FixedRowHeight;\r\n\r\n  nw := NormalColWidth;\r\n  nh := NormalRowHeight;\r\n\r\n  nwvis := Width - FixedColWidth;\r\n  nhvis := Height - FixedRowHeight;\r\n\r\n  if BorderStyle = bsSingle then\r\n  begin\r\n    nwvis := nwvis - 2;\r\n    nhvis := nhvis - 2;\r\n  end;\r\n\r\n  nwvisnoscroll := nwvis - GetScrollBarWidth;\r\n  nhvisnoscroll := nhvis - GetScrollBarHeight;\r\n\r\n  fixcol := ColorToHTML(FFixedColor);\r\n\r\n  // insert the main four grid cells\r\n  asm\r\n    tr = res.insertRow(0);\r\n    td = tr.insertCell(0);\r\n    td.style.border = \"0px\";\r\n    td = tr.insertCell(1);\r\n    td.style.border = \"0px\";\r\n    tr = res.insertRow(1);\r\n    td = tr.insertCell(0);\r\n    td.style.border = \"0px\";\r\n    td = tr.insertCell(1);\r\n    td.style.border = \"0px\";\r\n  end;\r\n\r\n  // fill fixedrow cells\r\n  if FixedRows > 0 then\r\n  begin\r\n    k := 0;\r\n\r\n    // fixedcol/fixedrow\r\n    if FixedCols > 0 then\r\n    begin\r\n      k := 1;\r\n      asm\r\n        td = res.rows[0].cells[0];\r\n        span = document.createElement('DIV');\r\n//        span.style.width = fw + \"px\";\r\n        span.style.height = fh + \"px\";\r\n        span.style.overflow = \"hidden\";\r\n        span.style.backgroundColor = fixcol;\r\n        td.appendChild(span);\r\n        span.appendChild(this.FFixedColRow);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      asm\r\n        td = res.rows[0].cells[0];\r\n        td.style.border = \"0px\";\r\n        td = res.rows[1].cells[0];\r\n        td.style.border = \"0px\";\r\n      end;\r\n\r\n    end;\r\n\r\n    //\r\n    asm\r\n      td = res.rows[0].cells[1];\r\n      td.style.backgroundColor = fixcol;\r\n\r\n      span = document.createElement('DIV');\r\n      span.style.height = fh + \"px\";\r\n      if (!LAutoSizeW) {\r\n        span.style.width = nwvis + \"px\";\r\n      }\r\n\r\n      span.style.overflow = \"hidden\";\r\n      span.style.backgroundColor = fixcol;\r\n\r\n      td.appendChild(span);\r\n\r\n      cellspan = document.createElement('DIV');\r\n      cellspan.style.height = fh + \"px\";\r\n      if (!LAutoSizeW) {\r\n        cellspan.style.width = nw + \"px\";\r\n      }\r\n\r\n      span.appendChild(cellspan);\r\n      cellspan.appendChild(this.FFixedRow);\r\n    end;\r\n\r\n    if (FixedCols > 0) then\r\n    begin\r\n      for i := 0 to FixedRows - 1 do\r\n      begin\r\n        asm\r\n          tr = this.FFixedColRow.insertRow(i);\r\n        end;\r\n\r\n        for j := 0 to FixedCols - 1 do\r\n        begin\r\n          asm\r\n            td = tr.insertCell(j);\r\n          end;\r\n\r\n          //TJSHTMLElement(td).innerHTML := inttostr(j)+':'+inttostr(i);\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    // fill top cell\r\n    for i := 0 to FixedRows - 1 do\r\n    begin\r\n      asm\r\n        tr = this.FFixedRow.insertRow(i);\r\n      end;\r\n\r\n      for j := FixedCols to ColCount - 1 do\r\n      begin\r\n        k := j - FixedCols;\r\n        asm\r\n          td = tr.insertCell(k);\r\n        end;\r\n\r\n        //TJSHTMLElement(td).innerHTML := inttostr(j)+':'+inttostr(i);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  k := 0;\r\n\r\n  // fill left cell\r\n  if FixedCols > 0 then\r\n  begin\r\n    k := 1;\r\n    asm\r\n      //tr = res.insertRow(res.rows.length);\r\n      //td = tr.insertCell(0);\r\n\r\n      td = res.rows[1].cells[0];\r\n\r\n      td.style.backgroundColor = fixcol;\r\n\r\n      span = document.createElement('DIV');\r\n      if (!LAutoSizeW) {\r\n      //span.style.width = fw + \"px\";\r\n      }\r\n      span.style.height = nhvisnoscroll + \"px\";\r\n      span.style.overflow = \"hidden\";\r\n      span.style.backgroundColor = fixcol;\r\n\r\n      td.setAttribute('valign','top');\r\n      td.appendChild(span);\r\n      span.appendChild(this.FFixedCol);\r\n    end;\r\n\r\n    for i := FixedRows to RowCount - 1 do\r\n    begin\r\n      j := i - FixedRows;\r\n      asm\r\n        tr = this.FFixedCol.insertRow(j);\r\n      end;\r\n\r\n      for j := 0 to FixedCols - 1 do\r\n      begin\r\n        asm\r\n          td = tr.insertCell(j);\r\n        end;\r\n\r\n        //TJSHTMLElement(td).innerHTML := inttostr(j)+':'+inttostr(i);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if FixedCols = 0 then\r\n  begin\r\n    asm\r\n      //tr = res.insertRow(res.rows.length);\r\n      //td = tr.insertCell(0);\r\n      td = res.rows[1].cells[1];\r\n    end\r\n  end\r\n  else\r\n  begin\r\n    asm\r\n      //tr = res.rows[1];\r\n      //td = tr.insertCell(1);\r\n      td = res.rows[1].cells[1];\r\n    end;\r\n  end;\r\n\r\n  vscroll := (ssVertical = ScrollBars) or (ssBoth = ScrollBars);\r\n  hscroll := (ssHorizontal = ScrollBars) or (ssBoth = ScrollBars);\r\n\r\n  asm\r\n    span = document.createElement('DIV');\r\n    span.style.backgroundColor = \"#FFFFFF\";\r\n    if (vscroll) {\r\n      span.style.overflowY = \"auto\";\r\n    }\r\n    else\r\n    {\r\n      span.style.overflowY = \"hidden\";\r\n    }\r\n\r\n    if (hscroll) {\r\n      span.style.overflowX = \"auto\";\r\n    }\r\n    else {\r\n      span.style.overflowX = \"hidden\";\r\n    }\r\n    if (!LAutoSizeW) {\r\n      span.style.width = nwvis + \"px\";\r\n    }\r\n    span.style.height = nhvis + \"px\";\r\n    td.appendChild(span);\r\n\r\n    cellspan = document.createElement('DIV');\r\n      if (!LAutoSizeW) {\r\n        cellspan.style.width = nw + \"px\"; }\r\n    cellspan.style.height = nh + \"px\";\r\n    span.parentElement.style.verticalAlign = \"top\";\r\n    span.appendChild(cellspan);\r\n    cellspan.appendChild(this.FNormalCells);\r\n  end;\r\n\r\n  span.addEventListener('scroll',@HandleScroll);\r\n\r\n  for i := FixedRows to RowCount - 1 do\r\n  begin\r\n    k := i - FixedRows;\r\n    asm\r\n      tr = this.FNormalCells.insertRow(k);\r\n    end;\r\n\r\n    for j := FixedCols to ColCount - 1 do\r\n    begin\r\n      k := j - FixedCols;\r\n\r\n      asm\r\n        td = tr.insertCell(k);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  FNormalCells.parentElement.parentElement.addEventListener('keydown',@HandleKeydown);\r\n  FNormalCells.addEventListener('focus',@HandleTableFocus);\r\n\r\n  EnableColResize;\r\nend;\r\n\r\nprocedure TCustomStringGrid.RenderGridScript;\r\nbegin\r\n  AddControlScriptSource(\r\n  'var TMSStringGridpageX,TMSStringGridcurCol,TMSStringGridnxtCol,TMSStringGridcurColWidth,TMSStringGridnxtColWidth,TMSStringGridautoWidth,GridNormalCells,GridFixedCells,GridFixedColCells,GridFixedColRows,GridColWidths,GridFixedCols,TMSStringGridCurID;'+\r\n  'var TMSStringGridTable,TMSStringGridcurTableWidth,TMSStringGridID,TMSStringGridFullWidth;'+\r\n  'TMSStringGridautoWidth = false;'+\r\n  'TMSStringGridCurID = \"\";'+\r\n  'ResizeMainGrid = true;'+\r\n\r\n  'function TMSStringGridupdateColSize(Cells, Col) {'+\r\n  '    if (Cells){'+\r\n  '     for (i = 0; i < Cells.rows.length; i++){'+\r\n  '       td = Cells.rows[i].cells[Col.cellIndex];'+\r\n  '       td.style.position = \"relative\";'+\r\n  '       td.style.width = Col.style.width;'+\r\n  '       td.style.maxWidth = Col.style.width;'+\r\n  '      }'+\r\n  '    }'+\r\n  '}'+\r\n\r\n  'function TMSStringGridresizeColumn(e) {'+\r\n  '   if ((TMSStringGridcurCol) && (TMSStringGridCurID.indexOf(TMSStringGridID) == 0)) {'+\r\n\r\n  '    var diffX = e.pageX - TMSStringGridpageX;'+\r\n\r\n  '    newColWidth = (TMSStringGridcurColWidth + diffX);'+\r\n  '    if (newColWidth < 10)'+\r\n  '      newColWidth = 10;'+\r\n\r\n  '    if (TMSStringGridCurID.indexOf(\"ResizeRow\") > 0) {'+\r\n  //resize normal columns\r\n  '\t    TMSStringGridcurCol.style.width = newColWidth + \"px\";'+\r\n  '\t    TMSStringGridcurCol.style.maxWidth = TMSStringGridcurCol.style.width;'+\r\n  '     GridColWidths.Put(TMSStringGridcurCol.cellIndex + GridFixedCols, parseInt(TMSStringGridcurCol.style.width));'+\r\n  '     TMSStringGridupdateColSize(GridFixedCells, TMSStringGridcurCol);'+\r\n  '     TMSStringGridupdateColSize(GridNormalCells, TMSStringGridcurCol);'+\r\n\r\n  '     TMSStringGridcurTable.style.width = (TMSStringGridcurTableWidth + diffX) + \"px\";'+\r\n  '     GridNormalCells.style.width = (TMSStringGridcurTableWidth + diffX) + \"px\";'+\r\n  '    } else {'+\r\n  //resize fixed columns\r\n  '     TMSStringGridfullWidth = document.getElementById(TMSStringGridID).offsetWidth;'+\r\n  '     newCellsWidth = (TMSStringGridfullWidth - (TMSStringGridcurTableWidth + diffX));'+\r\n\r\n  '     if ((newCellsWidth > 10) && (newColWidth > 10)) {'+\r\n  '\t     TMSStringGridcurCol.style.width = newColWidth + \"px\";'+\r\n  '\t     TMSStringGridcurCol.style.maxWidth = TMSStringGridcurCol.style.width;'+\r\n  '      TMSStringGridupdateColSize(GridFixedColRows, TMSStringGridcurCol);'+\r\n  '      TMSStringGridupdateColSize(GridFixedColCells, TMSStringGridcurCol);'+\r\n\r\n  '      TMSStringGridcurTable.style.width = (TMSStringGridcurTableWidth + diffX) + \"px\";'+\r\n  '      GridFixedColCells.style.width = (TMSStringGridcurTableWidth + diffX) + \"px\";'+\r\n\r\n  '      if ((!TMSStringGridautoWidth) && (newColWidth > 10)){' +\r\n  '       GridFixedCells.parentElement.style.width = newCellsWidth + \"px\";'+\r\n  '       GridFixedCells.parentElement.parentElement.style.width = newCellsWidth + \"px\";'+\r\n\r\n  '       GridNormalCells.parentElement.style.width = newCellsWidth + \"px\";'+\r\n  '       GridNormalCells.parentElement.parentElement.style.width = newCellsWidth + \"px\";'+\r\n  '      }'+\r\n  '     }'+\r\n  '    }'+\r\n  '   }'+\r\n  ' }'+\r\n\r\n  'function TMSStringGridresetResize() {'+\r\n  '   TMSStringGridID = \"\";'+\r\n  '   TMSStringGridFullWidth = undefined;'+\r\n  '   TMSStringGridCurID = \"\";'+\r\n  '   TMSStringGridcurCol = undefined;'+\r\n  '   TMSStringGridnxtCol = undefined;'+\r\n  '   TMSStringGridpageX = undefined;'+\r\n  '   TMSStringGridnxtColWidth = undefined;'+\r\n  '   TMSStringGridcurColWidth = undefined;'+\r\n  '   TMSStringGridautoWidth = false;'+\r\n  '   GridFixedCells = undefined;'+\r\n  '   GridFixedColCells = undefined;'+\r\n  '   GridFixedColRows = undefined;'+\r\n  '   GridNormalCells = undefined;'+\r\n  '   GridColWidths = undefined;'+\r\n  '   GridFixedCols = undefined;'+\r\n  ' }'+\r\n\r\n  'function TMSStringGridresizableGrid(tablename, enabled) {'+\r\n  ' var table = document.getElementById(tablename + \"Table\");'+\r\n  ' if (!table) return;' +\r\n  ' var row = table.getElementsByTagName(\"tr\")[0],'+\r\n  ' cols = row ? row.children : undefined;'+\r\n  ' if (!cols) return;'+\r\n\r\n  ' for (var i=0;i<cols.length;i++){'+\r\n  '  var coldiv = document.getElementById(tablename + \"Div\" + i);'+\r\n\r\n  '  if (coldiv)'+\r\n  '    coldiv.remove();'+\r\n\r\n  '  if (enabled) {'+\r\n  '    var div = createDiv();'+\r\n  '    cols[i].appendChild(div);'+\r\n  '    cols[i].style.position = \"relative\";'+\r\n  '    div.id = tablename + \"Div\" + i;'+\r\n  '    setListeners(div);'+\r\n  '  }'+\r\n  ' }'+\r\n\r\n  ' function setListeners(div){'+\r\n\r\n  '  div.addEventListener(\"mousedown\", function (e) {'+\r\n  '   TMSStringGridCurID = e.target.id;'+\r\n  '   TMSStringGridcurCol = e.target.parentElement;'+\r\n  '   TMSStringGridnxtCol = TMSStringGridcurCol.nextElementSibling;'+\r\n  '   TMSStringGridpageX = e.pageX;'+\r\n\r\n  '   TMSStringGridcurTable = TMSStringGridcurCol.parentElement.parentElement.parentElement;'+\r\n  '   TMSStringGridcurTableWidth = TMSStringGridcurTable.offsetWidth;'+\r\n\r\n  '   TMSStringGridcurColWidth = TMSStringGridcurCol.offsetWidth;'+\r\n  '   if (TMSStringGridnxtCol)'+\r\n  '    TMSStringGridnxtColWidth = TMSStringGridnxtCol.offsetWidth;'+\r\n  '  });'+\r\n\r\n  '  div.addEventListener(\"mouseover\", function (e) {'+\r\n  '   e.target.style.borderRight = \"2px solid #0000ff\";'+\r\n  '  });'+\r\n\r\n  '  div.addEventListener(\"mouseout\", function (e) {'+\r\n  '   e.target.style.borderRight = \"\";'+\r\n  '  });'+\r\n\r\n  '  document.addEventListener(\"mousemove\", function (e) {'+\r\n  '   TMSStringGridresizeColumn(e);'+\r\n  '  });'+\r\n\r\n  '  document.addEventListener(\"mouseup\", function (e) {'+\r\n  '   TMSStringGridresetResize();'+\r\n  '  });'+\r\n  ' }'+\r\n\r\n  ' function createDiv(){'+\r\n  '  var div = document.createElement(\"div\");'+\r\n  '  div.style.top = 0;'+\r\n  '  div.style.right = 0;'+\r\n  '  div.style.width = \"10px\";'+\r\n  '  div.style.position = \"absolute\";'+\r\n  '  div.style.cursor = \"col-resize\";'+\r\n  '  div.style.userSelect = \"none\";'+\r\n  '  div.style.height = \"100%\";'+\r\n//  '  div.style.border = \"1px solid red\";'+\r\n  '  div.innerHTML = \"&nbsp;\";'+\r\n  '  return div;'+\r\n  ' }'+\r\n\r\n  '};');\r\nend;\r\n\r\nprocedure TCustomStringGrid.RenderGridSize;\r\nvar\r\n  fw,fh,nw,nh,nwvis,nhvis,nwvisnoscroll,nhvisnoscroll: integer;\r\n\r\nbegin\r\n  if not Assigned(FGrid) then\r\n    Exit;\r\n\r\n  fw := FixedColWidth;\r\n  fh := FixedRowHeight;\r\n\r\n  nw := NormalColWidth;\r\n  nh := NormalRowHeight;\r\n\r\n  nwvis := Width - FixedColWidth;\r\n  nhvis := Height - FixedRowHeight;\r\n\r\n  if BorderStyle = bsSingle then\r\n  begin\r\n    nwvis := nwvis - 2;\r\n    nhvis := nhvis - 2;\r\n  end;\r\n\r\n  nwvisnoscroll := nwvis - GetScrollBarWidth;\r\n  nhvisnoscroll := nhvis - GetScrollBarHeight;\r\n\r\n  if (FixedRows > 0) and (WidthStyle = ssAbsolute) then\r\n  begin\r\n    asm\r\n      var td = this.FGrid.rows[0].cells[1];\r\n      if (td!=null) {\r\n      var span = td.firstChild;\r\n      span.style.width = nwvisnoscroll + \"px\";\r\n      span.style.overflow = \"hidden\";\r\n      }\r\n    end;\r\n  end;\r\n\r\n  if (FixedCols > 0) and (HeightStyle = ssAbsolute) then\r\n  begin\r\n    asm\r\n      var td = this.FGrid.rows[1].cells[0];\r\n      if (td!=null) {\r\n      var span = td.firstChild;\r\n      span.style.height = nhvisnoscroll + \"px\";\r\n      span.style.overflow = \"hidden\";\r\n      }\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.Resize;\r\nbegin\r\n  inherited;\r\n  RenderGridSize;\r\nend;\r\n\r\nprocedure TCustomStringGrid.RowCountChanged(delta: integer);\r\nvar\r\n  r: integer;\r\n  fr,fc: integer;\r\nbegin\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  fr := FixedRows;\r\n  fc := FixedCols;\r\n\r\n  if delta > 0 then\r\n  begin\r\n    asm\r\n      var i = 0;\r\n      var j = 0;\r\n      var tr = undefined;\r\n      var td = undefined;\r\n      var l = this.FNormalCells.rows.length;\r\n\r\n      for(i = 0;i < delta; i++)\r\n      {\r\n         tr = this.FNormalCells.insertRow(l);\r\n         for(j = this.FFixedCols; j < this.FColCount; j++)\r\n         {\r\n            td = tr.insertCell(0);\r\n         }\r\n\r\n         if (fc > 0) {\r\n           tr = this.FFixedCol.insertRow(l);\r\n           for(j = 0; j < this.FFixedCols; j++)\r\n           {\r\n             tr.insertCell(0);\r\n           }\r\n         }\r\n      }\r\n    end;\r\n\r\n    BeginUpdate;\r\n\r\n    for r := 1 to delta do\r\n    begin\r\n      RowHeights[RowCount - r] := DefaultRowHeight;\r\n    end;\r\n\r\n    EndUpdate;\r\n  end;\r\n\r\n  if delta < 0 then\r\n  begin\r\n    asm\r\n      var i = 0;\r\n      var l = this.FNormalCells.rows.length;\r\n\r\n      for(i = 0;i < -delta; i++)\r\n      {\r\n        this.FNormalCells.deleteRow(l - i - 1);\r\n\r\n        if (fc > 0) {\r\n          this.FFixedCol.deleteRow(l - i - 1);\r\n        }\r\n      }\r\n    end;\r\n\r\n    if RowCount > 0 then\r\n      RowHeights[RowCount - 1] := RowHeights[RowCount - 1];\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SelectCell(ACol, ARow: integer);\r\nvar\r\n  rc,rr: integer;\r\nbegin\r\n  Selection := GridRect(ACol, ARow, ACol, ARow);\r\n\r\n  rc := ACol - FixedCols;\r\n  rr := ARow - FixedRows;\r\n\r\n  asm\r\n    this.FSelectedCell = this.FNormalCells.rows[rr].cells[rc];\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetCells(ACol, ARow: integer; const Value: string);\r\nvar\r\n  rc,rr: integer;\r\nbegin\r\n  if (ACol < FixedCols) and (ARow >= FixedRows) then\r\n  begin\r\n    rr := ARow - FixedRows;\r\n    rc := ACol;\r\n\r\n    asm\r\n      var td = this.FFixedCol.rows[rr].cells[rc];\r\n      td.innerHTML = Value;\r\n    end;\r\n  end;\r\n\r\n  if (ARow < FixedRows) and (ACol >= FixedCols) then\r\n  begin\r\n    rc := ACol - FixedCols;\r\n    rr := ARow;\r\n\r\n    asm\r\n      var td = this.FFixedRow.rows[rr].cells[rc];\r\n      td.innerHTML = Value;\r\n    end;\r\n  end;\r\n\r\n  if (ACol < FixedCols) and (ARow < FixedRows) then\r\n  begin\r\n    rc := ACol;\r\n    rr := ARow;\r\n\r\n    asm\r\n      var td = this.FFixedColRow.rows[rr].cells[rc];\r\n      td.innerHTML = Value;\r\n    end;\r\n  end;\r\n\r\n  if (ACol >= FixedCols) and (ARow >= FixedRows) then\r\n  begin\r\n    rc := ACol - FixedCols;\r\n    rr := ARow - FixedRows;\r\n    asm\r\n      var td = this.FNormalCells.rows[rr].cells[rc];\r\n      td.innerHTML = Value;\r\n    end;\r\n  end;\r\n\r\n  if ARow = 0 then\r\n    EnableColResize;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetCol(const Value: integer);\r\nvar\r\n  r,c: integer;\r\nbegin\r\n  if (Value < ColCount) and (Value >= FixedCols) then\r\n  begin\r\n     if Assigned(FSelectedCell) then\r\n     begin\r\n       asm\r\n         this.FSelectedCell.classList.remove(\"selected\");\r\n       end;\r\n     end;\r\n\r\n     c := Value - FixedCols;\r\n     r := Row - FixedRows;\r\n     if r < 0 then\r\n       r := 0;\r\n\r\n     asm\r\n       var tr = this.FNormalCells.rows[r];\r\n       var td = tr.cells[c];\r\n       td.classList.add(\"selected\");\r\n       this.FSelectedCell = td;\r\n\r\n       var pardiv = this.FNormalCells.parentElement.parentElement;\r\n\r\n       if (td.offsetLeft < pardiv.scrollLeft) {\r\n         pardiv.scrollLeft = td.offsetLeft;\r\n       }\r\n\r\n       if (td.offsetLeft + td.offsetWidth - pardiv.scrollLeft > pardiv.offsetWidth) {\r\n         pardiv.scrollLeft = pardiv.scrollLeft + td.offsetWidth;\r\n       }\r\n     end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetColWidths(ACol: integer; const Value: integer);\r\nvar\r\n  fcw: integer;\r\n  nw, nwvis, nwvisnoscroll: integer;\r\n  LAutoSizeW: boolean;\r\nbegin\r\n  while FColWidths.Count <= ACol do\r\n    FColWidths.Add(DefaultColWidth);\r\n\r\n  FColWidths[ACol] := Value;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if not Assigned(FGrid) then\r\n    Exit;\r\n\r\n  LAutoSizeW := WidthStyle = ssAuto;\r\n  nw := NormalColWidth;\r\n  nwvis := Width - FixedColWidth;\r\n  nwvisnoscroll := nwvis - GetScrollBarWidth;\r\n\r\n  if ACol < FixedCols then\r\n  begin\r\n    fcw := FixedColWidth;\r\n    asm\r\n      var tr = this.FGrid.rows[0];\r\n      if (tr != undefined) {\r\n      var td = tr.cells[0];\r\n      if (td != undefined) {\r\n        td.style.width = fcw + \"px\";\r\n        if (td.firstChild != undefined) {\r\n        td.firstChild.style.width = fcw + \"px\"; }\r\n        }\r\n      }\r\n\r\n      tr = this.FGrid.rows[1];\r\n      if (tr != undefined) {\r\n      td = tr.cells[0];\r\n      if (td != undefined) {\r\n        td.style.width = fcw + \"px\";\r\n        if (td.firstChild != undefined) {\r\n        td.firstChild.style.width = fcw + \"px\"; }\r\n        }\r\n\r\n      tr = this.FFixedColRow.rows[0];\r\n      if (tr != undefined) {\r\n\r\n      td = tr.cells[0];\r\n      if (td != undefined) {\r\n        td.style.width = fcw + \"px\";\r\n        }\r\n        }\r\n      }\r\n      tr = this.FFixedCol.rows[0];\r\n      if (tr != undefined) {\r\n\r\n      td = tr.cells[0];\r\n      if (td != undefined) {\r\n        td.style.width = fcw + \"px\";\r\n        }\r\n      }\r\n    end;\r\n  end;\r\n\r\n  if ACol >= FixedCols then\r\n  begin\r\n    ACol := ACol - FixedCols;\r\n\r\n    asm\r\n      var tr = this.FFixedRow.rows[0];\r\n      if (tr != undefined) {\r\n        var td = tr.cells[ACol];\r\n        td.style.width = Value + \"px\";\r\n        td.style.maxwidth = Value + \"px\";\r\n\r\n        if (this.FNormalCells.rows.length > 0)\r\n        {\r\n        var td = this.FNormalCells.rows[0].cells[ACol];\r\n        td.style.width = Value + \"px\";\r\n        td.style.maxwidth = Value + \"px\";\r\n        }\r\n      }\r\n    end;\r\n  end;\r\n\r\n  asm\r\n    var tr = this.FGrid.rows[0];\r\n    if (tr != undefined) {\r\n      var td = tr.cells[1];\r\n      if ((td.firstChild != undefined) && (!LAutoSizeW)) {\r\n      td.firstChild.style.width = nwvisnoscroll + \"px\";\r\n      td.firstChild.firstChild.style.width = nw + \"px\";\r\n      }\r\n    }\r\n    tr = this.FGrid.rows[1];\r\n    if (tr != undefined) {\r\n      td = tr.cells[1];\r\n      if ((td.firstChild != undefined) && (!LAutoSizeW)) {\r\n      td.firstChild.style.width = nwvis + \"px\";\r\n      td.firstChild.firstChild.style.width = nw + \"px\";\r\n      }\r\n    }\r\n  end;\r\n\r\n  UpdateGridSize;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\nprocedure TCustomStringGrid.SetDefaultColWidth(const Value: integer);\r\nvar\r\n  i: integer;\r\nbegin\r\n  FDefaultColWidth := Value;\r\n\r\n  for i := 0 to ColCount - 1 do\r\n    ColWidths[i] := Value;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetDefaultRowHeight(const Value: integer);\r\nvar\r\n  i: integer;\r\nbegin\r\n  FDefaultRowHeight := Value;\r\n  for i := 0 to RowCount - 1 do\r\n    RowHeights[i] := Value;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetEditText(ACol, ARow: Longint;\r\n  const AValue: string);\r\nbegin\r\n  if Assigned(OnSetEditText) then\r\n    OnSetEditText(Self, ACol, ARow, AValue);\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetFixedColor(const Value: TColor);\r\nbegin\r\n  if (FFixedColor <> Value) then\r\n  begin\r\n    FFixedColor := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetFixedCols(const Value: integer);\r\nbegin\r\n  if (FFixedCols <> Value) then\r\n  begin\r\n    FFixedCols := Value;\r\n\r\n    if not IsUpdating then\r\n    begin\r\n      FGrid.removeChild(FGrid.firstChild);\r\n      FGrid := nil;\r\n      RenderGrid;\r\n      UpdateGridSize;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetFixedRows(const Value: integer);\r\nbegin\r\n  if (FFixedRows <> Value) then\r\n  begin\r\n    FFixedRows := Value;\r\n\r\n    if not IsUpdating then\r\n    begin\r\n      FGrid.removeChild(FGrid.firstChild);\r\n      FGrid := nil;\r\n      RenderGrid;\r\n      UpdateGridSize;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetFocus;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetLeftCol(const Value: integer);\r\nvar\r\n  i,w: integer;\r\nbegin\r\n  w := 0;\r\n  for i := FixedCols to Value - 1 do\r\n    w := w + ColWidths[i]+1;\r\n\r\n  if Assigned(FNormalCells) then\r\n  begin\r\n    FNormalCells.parentElement.parentElement.scrollLeft := w;\r\n    if FixedCols > 0 then\r\n      FFixedCol.parentElement.parentElement.scrollLeft := w;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TCustomStringGrid.SetRow(const Value: integer);\r\nvar\r\n  r,c,sh: integer;\r\n  rselect: boolean;\r\n\r\nbegin\r\n  if (Value < RowCount) and (Value >= FixedRows) then\r\n  begin\r\n     rselect := (goRowSelect in Options);\r\n\r\n     if Assigned(FSelectedCell) and rselect then\r\n     begin\r\n       asm\r\n         var colindex = this.FSelectedCell.cellIndex;\r\n         var tr = this.FSelectedCell.parentElement;\r\n         tr.classList.remove(\"selected\");\r\n       end;\r\n     end;\r\n\r\n     if Assigned(FSelectedCell) then\r\n     begin\r\n       asm\r\n         this.FSelectedCell.classList.remove(\"selected\");\r\n       end;\r\n     end;\r\n\r\n     c := Col - FixedCols;\r\n     if c < 0 then\r\n       c := 0;\r\n\r\n     r := Value - FixedRows;\r\n\r\n     sh := GetScrollBarHeight;\r\n\r\n     asm\r\n       var tr = this.FNormalCells.rows[r];\r\n       var td = tr.cells[c];\r\n\r\n       if (rselect){\r\n         if (this.FSelectedCell != undefined) {\r\n         this.FSelectedCell.classList.remove(\"selected\"); }\r\n         tr.classList.add(\"selected\");\r\n         this.FSelectedCell = td;\r\n       }\r\n       else\r\n       {\r\n         this.FSelectedCell = td;\r\n         this.FSelectedCell.classList.add(\"selected\");\r\n       }\r\n\r\n       var pardiv = this.FNormalCells.parentElement.parentElement;\r\n\r\n       if (td.offsetTop < pardiv.scrollTop) {\r\n         pardiv.scrollTop = td.offsetTop;\r\n       }\r\n\r\n       while (td.offsetTop + td.offsetHeight - pardiv.scrollTop > pardiv.offsetHeight - sh)  {\r\n         pardiv.scrollTop = pardiv.scrollTop + td.offsetHeight;\r\n       }\r\n     end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetRowHeights(ARow: integer; const Value: integer);\r\nvar\r\n  frh: integer;\r\n  fh, nh, nhvis, nhvisnoscroll: integer;\r\nbegin\r\n  while FRowHeights.Count <= ARow do\r\n    FRowHeights.Add(DefaultRowHeight);\r\n\r\n  FRowHeights[ARow] := Value;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if not Assigned(FGrid) then\r\n    Exit;\r\n\r\n  fh := FixedRowHeight;\r\n\r\n  nh := NormalRowHeight;\r\n\r\n  nhvis := Height - FixedRowHeight;\r\n\r\n  nhvisnoscroll := nhvis - GetScrollBarHeight;\r\n\r\n  if ARow < FixedRows then\r\n  begin\r\n    frh := FixedRowHeight;\r\n    asm\r\n      var tr = this.FGrid.rows[0];\r\n      if (tr != undefined) {\r\n        tr.style.height = frh + \"px\";\r\n        var td = tr.cells[0];\r\n        if (td != undefined) {\r\n          var fc = td.firstChild;\r\n          if (fc != undefined) {\r\n            fc.style.height = frh + \"px\";\r\n          }\r\n          td = tr.cells[1];\r\n          fc = td.firstChild;\r\n          if (fc != undefined) {\r\n            fc.style.height = frh + \"px\";\r\n          }\r\n          }\r\n        }\r\n\r\n      tr = this.FFixedColRow.rows[0];\r\n      if (tr != undefined) {\r\n         tr = tr.cells[0];\r\n         if (tr != undefined) {\r\n         tr.style.height = Value + \"px\";\r\n         tr = this.FFixedRow.rows[ARow].cells[0];\r\n         if (tr != undefined) {\r\n         tr.style.height = Value + \"px\"; }\r\n         }\r\n      }\r\n    end;\r\n  end;\r\n\r\n\r\n  if ARow >= FixedRows then\r\n  begin\r\n    ARow := ARow - FixedRows;\r\n\r\n    asm\r\n      var tr = this.FFixedCol.rows[ARow];\r\n      if (tr != undefined) {\r\n\r\n      tr.style.height = Value + \"px\";\r\n      var tr = this.FNormalCells.rows[ARow];\r\n      if (tr != undefined) {\r\n      tr.style.height = Value + \"px\"; }\r\n      }\r\n    end;\r\n  end;\r\n\r\n  asm\r\n    var td = this.FGrid.rows[1].cells[0];\r\n    if (td.firstChild) {\r\n\r\n    td.firstChild.style.height = nhvisnoscroll + \"px\";\r\n    td.firstChild.firstChild.style.height = nh + \"px\";\r\n    }\r\n\r\n    td = this.FGrid.rows[1].cells[1];\r\n    if (td.firstChild) {\r\n    td.firstChild.style.height = nhvis + \"px\";\r\n    td.firstChild.firstChild.style.height = nh + \"px\";\r\n    }\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetSelection(const Value: TGridRect);\r\nvar\r\n  c,r,rc,rr: integer;\r\n  sel: boolean;\r\n  left,right,top,bottom: integer;\r\n\r\nbegin\r\n  FSelection := Value;\r\n\r\n  left := Value.Left;\r\n  right := Value.Right;\r\n\r\n  if Value.Left > Value.Right then\r\n  begin\r\n    left := Value.Right;\r\n    right := Value.Left;\r\n  end;\r\n\r\n  top := Value.Top;\r\n  bottom := Value.Bottom;\r\n\r\n  if Value.Top > Value.Bottom then\r\n  begin\r\n    top := Value.Bottom;\r\n    bottom := Value.Top;\r\n  end;\r\n\r\n  for r := FixedRows to RowCount - 1 do\r\n  begin\r\n    if goRowSelect in Options then\r\n    begin\r\n      rr := r - FixedRows;\r\n      sel := (r >= top) and (r <= bottom);\r\n\r\n      if sel then\r\n      begin\r\n        asm\r\n          var tr = this.FNormalCells.rows[rr];\r\n          tr.classList.add(\"selected\");\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        asm\r\n          var tr = this.FNormalCells.rows[rr];\r\n          tr.classList.remove(\"selected\");\r\n        end;\r\n      end;\r\n    end\r\n    else\r\n    for c := FixedCols to ColCount - 1 do\r\n    begin\r\n\r\n      rc := c - FixedCols;\r\n      rr := r - FixedRows;\r\n\r\n      sel := (c >= left) and (c <= right) and (r >= top) and (r <= bottom);\r\n\r\n      if sel then\r\n      begin\r\n        asm\r\n          var td = this.FNormalCells.rows[rr].cells[rc];\r\n          td.classList.add(\"selected\");\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        asm\r\n          var td = this.FNormalCells.rows[rr].cells[rc];\r\n          td.classList.remove(\"selected\");\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.SetTopRow(const Value: integer);\r\nvar\r\n  pixVal: integer;\r\nbegin\r\n  pixVal := (Value - FixedRows) * DefaultRowHeight;\r\n  if Assigned(FNormalCells) and (pixVal >= 0) then\r\n  begin\r\n    FNormalCells.parentElement.parentElement.scrollTop := pixVal;\r\n    if FixedCols > 0 then\r\n      FFixedCol.parentElement.parentElement.scrollTop := pixVal;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.ShowEdit;\r\nbegin\r\n  StartEdit('');\r\nend;\r\n\r\nprocedure TCustomStringGrid.StartEdit(ch: string);\r\nvar\r\n  created: boolean;\r\n  eh: TJSHTMLElement;\r\n  s: string;\r\nbegin\r\n  eh := ElementHandle;\r\n\r\n  FEditRow := Row;\r\n  FEditCol := Col;\r\n\r\n  FEditMode := true;\r\n\r\n  s := GetEditText(Col,Row);\r\n\r\n  asm\r\n    created = false;\r\n\r\n    if (this.FEdit == undefined) {\r\n      this.FEdit = document.createElement('INPUT');\r\n      this.FEdit.style.setProperty('box-sizing','border-box');\r\n      this.FEdit.style.setProperty('-webkit-box-sizing','border-box');\r\n      this.FEdit.style.setProperty('-moz-box-sizing','border-box');\r\n      created = true;\r\n    }\r\n\r\n    this.FOrigVal = s; //this.FSelectedCell.innerHTML;\r\n\r\n    if (ch == '') {\r\n      this.FEdit.value = s; //this.FSelectedCell.innerHTML;\r\n      }\r\n    else {\r\n      this.FEdit.value = ch;\r\n    }\r\n    this.FEdit.style.width = \"100%\";\r\n    this.FEdit.style.height = \"100%\";\r\n    this.FEdit.style.fontFamily = eh.style.fontFamily;\r\n    this.FEdit.style.fontSize = eh.style.fontSize;\r\n\r\n    this.FEdit.setSelectionRange(0, this.FEdit.value.length)\r\n\r\n    this.FSelectedCell.innerHTML = \"\";\r\n    this.FSelectedCell.appendChild(this.FEdit);\r\n    this.FEdit.focus();\r\n  end;\r\n\r\n  if created then\r\n  begin\r\n    FEdit.addEventListener('blur', FHandleEditBlurPtr);\r\n    FEdit.addEventListener('keypress', FHandleEditKeypressPtr);\r\n\r\n\r\n  end;\r\n\r\n\r\nend;\r\n\r\nfunction TCustomStringGrid.StopEdit: string;\r\nvar\r\n  val: string;\r\nbegin\r\n  Result := '';\r\n  if FEditMode then\r\n  begin\r\n    FEditMode := false;\r\n\r\n    val := (FEdit as TJSHTMLInputElement).value;\r\n\r\n    ValidateCell(FEditCol, FEditRow, val);\r\n\r\n    FSelectedCell.removeChild(FEdit);\r\n    FSelectedCell.innerHTML := val;\r\n    Result := val;\r\n\r\n    UpdateCell(FEditCol, FEditRow, val);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.TopLeftChanged;\r\nbegin\r\n  if Assigned(OnTopLeftChanged) then\r\n    OnTopLeftChanged(Self);\r\nend;\r\n\r\nprocedure TCustomStringGrid.UpdateCell(ACol, ARow: integer; var AValue: string);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TCustomStringGrid.UpdateElement;\r\nvar\r\n  clr: string;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('background-color', ColorToHTML(Color));\r\n    ElementHandle.style.setProperty('overflow', 'hidden');\r\n\r\n    if (BorderStyle = bsSingle) and not (BorderColor = clNone) and (ElementClassName = '') and not IsLinked then\r\n    begin\r\n      ElementHandle.style.setProperty('border', '1px solid '+ ColorToHTML(BorderColor));\r\n      BorderWidth := 2;\r\n    end\r\n    else\r\n    begin\r\n      ElementHandle.style.setProperty('border', '');\r\n      BorderWidth := 0;\r\n    end;\r\n\r\n    RenderGrid;\r\n\r\n    clr := ColorToHTML(Color);\r\n\r\n    // background color stringgrid (DIV & TBODY)\r\n    asm\r\n      this.FNormalCells.tBodies[0].style.setProperty('background-color', clr);\r\n      this.FNormalCells.parentElement.parentElement.style.setProperty('background-color', clr);\r\n    end;\r\n\r\n    AddInstanceStyle(GetGridCSS);\r\n    UpdateGridSize;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomStringGrid.UpdateElementVisual;\r\nvar\r\n  fixcol: string;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) and Assigned(FGrid) then\r\n  begin\r\n    fixcol := ColorToHTML(FFixedColor);\r\n\r\n    if (FixedCols > 0) and (FixedRows > 0) then\r\n    begin\r\n      asm\r\n        this.FFixedColRow.parentElement.style.setProperty('background-color',fixcol);\r\n      end;\r\n    end;\r\n\r\n    if (FixedCols > 0) then\r\n    begin\r\n      asm\r\n      this.FFixedCol.parentElement.style.setProperty('background-color',fixcol);\r\n      end;\r\n    end;\r\n\r\n    if (FixedRows > 0) then\r\n    begin\r\n      asm\r\n        this.FFixedRow.parentElement.style.setProperty('background-color',fixcol);\r\n        this.FFixedRow.parentElement.parentElement.style.setProperty('background-color',fixcol);\r\n      end;\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomStringGrid.UpdateGridSize;\r\nvar\r\n  i,j,k,l,cw,rh: integer;\r\n\r\nbegin\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if (RowCount = 0) or (ColCount = 0) then\r\n    Exit;\r\n\r\n  for i := 0 to FixedCols - 1 do\r\n  begin\r\n    cw := ColWidths[i];\r\n\r\n    if (FixedRows > 0) and (FixedCols > 0) then\r\n    begin\r\n      asm\r\n        for (j = 0; j < this.FFixedColRow.rows.length; j ++){\r\n         var tr = this.FFixedColRow.rows[j];\r\n         var td = tr.cells[i];\r\n         td.style.width = cw + \"px\";\r\n         td.style.maxWidth = cw + \"px\";\r\n        }\r\n      end;\r\n    end;\r\n\r\n    if (FixedCols > 0) then\r\n    begin\r\n      asm\r\n        for (j = 0; j < this.FFixedCol.rows.length; j ++){\r\n         var tr = this.FFixedCol.rows[j];\r\n         var td = tr.cells[i];\r\n         td.style.width = cw + \"px\";\r\n         td.style.maxWidth = cw + \"px\";\r\n        }\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  for i := 0 to FixedRows - 1 do\r\n  begin\r\n    rh := RowHeights[i];\r\n\r\n    if FixedCols > 0  then\r\n    begin\r\n      asm\r\n        var tr = this.FFixedColRow.rows[i];\r\n        tr.style.height = rh + \"px\";\r\n      end;\r\n    end;\r\n\r\n    asm\r\n      var tr = this.FFixedRow.rows[i];\r\n      tr.style.height = rh + \"px\";\r\n    end;\r\n  end;\r\n\r\n  for i := FixedCols to ColCount - 1 do\r\n  begin\r\n    cw := ColWidths[i];\r\n\r\n    k := i - FixedCols;\r\n\r\n    if (FixedRows > 0) then\r\n    begin\r\n      asm\r\n        //if (this.FFixedRow.rows.length > 0) {\r\n        for (i = 0; i < this.FFixedRow.rows.length; i++) {\r\n          var tr = this.FFixedRow.rows[i];\r\n          var td = tr.cells[k];\r\n          td.style.width = cw + \"px\";\r\n          td.style.maxWidth = cw + \"px\";\r\n        }\r\n      end;\r\n    end;\r\n\r\n    asm\r\n      if (this.FNormalCells.rows.length > 0) {\r\n        var tr = this.FNormalCells.rows[0];\r\n        var td = tr.cells[k];\r\n        td.style.width = cw + \"px\";\r\n        td.style.maxWidth = cw + \"px\";\r\n      }\r\n    end;\r\n  end;\r\n\r\n  for i := FixedRows to RowCount - 1 do\r\n  begin\r\n    k := i - FixedRows;\r\n    rh := RowHeights[i];\r\n\r\n    for j := FixedCols to ColCount - 1 do\r\n    begin\r\n      l := j - FixedCols;\r\n      cw := ColWidths[j];\r\n\r\n      if FixedCols > 0 then\r\n      begin\r\n        asm\r\n          var tr = this.FFixedCol.rows[k];\r\n          tr.style.height = rh + \"px\";\r\n        end;\r\n      end;\r\n\r\n      asm\r\n        var tr = this.FNormalCells.rows[k];\r\n        tr.style.height = rh + \"px\";\r\n\r\n        td = tr.cells[l];\r\n        td.style.maxWidth = cw + \"px\";\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\nprocedure TCustomStringGrid.ValidateCell(ACol, ARow: integer;\r\n  var AValue: string);\r\nbegin\r\n  if Assigned(OnValidateEdit) then\r\n    OnValidateEdit(Self, ACol, ARow, AValue);\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\n\r\nfunction TCustomStringGrid.HandleMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  rindex, cindex: integer;\r\n  l, t: Single;\r\n  ss: TShiftState;\r\nbegin\r\n  rindex := -1;\r\n  cindex := -1;\r\n\r\n  asm\r\n    if (Event.target.tagName.toLowerCase() == 'td')\r\n    {\r\n      cindex = Event.target.cellIndex;\r\n      var tr = Event.target.parentElement;\r\n      rindex = tr.rowIndex;\r\n    }\r\n  end;\r\n\r\n\r\n  if (cindex >= 0) and (rindex >= 0) and (FStartCell.X >= 0) and (FStartCell.Y >= 0) then\r\n    Selection := GridRect(FStartCell.X, FStartCell.Y, cindex + FixedCols, rindex + FixedRows);\r\n\r\n  Result := true;\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n\r\n  MouseMove(ss, Trunc(l), Trunc(t));\r\nend;\r\n\r\nfunction TCustomStringGrid.HandleMouseUp(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  ss: TShiftState;\r\n  mb: TMouseButton;\r\nbegin\r\n  asm\r\n    TMSStringGridresetResize();\r\n  end;\r\n\r\n  FStartCell.X := -1;\r\n  FStartCell.Y := -1;\r\n  Result := false;\r\n\r\n  Event.stopPropagation;\r\n  Event.cancelBubble := true;\r\n\r\n  XYToClient(Event.clientX, Event.clientY, l, t);\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n  mb := GetMouseEventButton(Event);\r\n\r\n  MouseUp(mb, ss, Trunc(l), Trunc(t));\r\n\r\nend;\r\n\r\n{ TCustomGrid }\r\n\r\nprocedure TCustomGrid.ColCountChanged(delta: integer);\r\nbegin\r\nend;\r\n\r\nprocedure TCustomGrid.GridChanged;\r\nbegin\r\n  //\r\nend;\r\n\r\nprocedure TCustomGrid.RowCountChanged(delta: integer);\r\nbegin\r\nend;\r\n\r\nprocedure TCustomGrid.SetColCount(const Value: integer);\r\nvar\r\n  delta: integer;\r\nbegin\r\n  if (FColCount <> Value) and (Value >= 0) then\r\n  begin\r\n    delta := Value - FColCount;\r\n    FColCount := Value;\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      ColCountChanged(delta);\r\n      GridChanged;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomGrid.SetRowCount(const Value: integer);\r\nvar\r\n  delta: integer;\r\nbegin\r\n  if (FRowCount <> Value) and (Value >= 0) then\r\n  begin\r\n    delta := Value - FRowCount;\r\n    FRowCount := Value;\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      RowCountChanged(delta);\r\n      GridChanged;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TCustomTableControl }\r\n\r\n{$HINTS OFF}\r\nprocedure TCustomTableControl.AddCheckBox(ACol, ARow: integer;\r\n  Checked: boolean);\r\nvar\r\n  s: string;\r\n  el: TJSHTMLElement;\r\nbegin\r\n  s := '<INPUT TYPE=\"CHECKBOX\"';\r\n  if checked then\r\n    s := s + ' CHECKED';\r\n  s := s + '>';\r\n  Cells[ACol,ARow] := s;\r\n\r\n  el := CellElements[ACol, ARow];\r\n  BindCellChildren(ACol, ARow, el);\r\nend;\r\n\r\nprocedure TCustomTableControl.BindCellChildren(ACol, ARow: integer;\r\n  AElement: TJSHTMLElement);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  el := TJSHTMLElement(AElement.firstChild);\r\n\r\n  if Assigned(el) and (el.tagName = 'INPUT') then\r\n  begin\r\n    if (lowercase(el.getAttribute('TYPE'))= 'checkbox') then\r\n    begin\r\n      el.addEventListener('click', @HandleCheckBoxClick);\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomTableControl.BindEvents;\r\nbegin\r\n  inherited;\r\n  RenderGridScript;\r\nend;\r\n\r\nprocedure TCustomTableControl.Clear;\r\nvar\r\n  i,j: integer;\r\nbegin\r\n  for i := 0 to RowCount - 1 do\r\n    for j := 0 to ColCount - 1 do\r\n      begin\r\n        Cells[j,i] := '';\r\n      end;\r\nend;\r\n\r\nprocedure TCustomTableControl.ColCountChanged(delta: integer);\r\nvar\r\n  c: integer;\r\nbegin\r\n  if IsUpdating or not Assigned(FTable) then\r\n    Exit;\r\n\r\n  if delta > 0 then\r\n  begin\r\n    asm\r\n      var i = 0;\r\n      var j = 0;\r\n      var k = 0;\r\n      var tr = undefined;\r\n\r\n      var l = this.FTable.rows.length;\r\n\r\n      for(j = 0; j < l; j++)\r\n      {\r\n        tr = this.FTable.rows[j];\r\n\r\n        k = tr.cells.length;\r\n\r\n         for(i = 0; i < delta; i++)\r\n         {\r\n           if ((j == 0) && (this.FRowHeader))\r\n           {\r\n             var th = document.createElement('th');\r\n             th.setAttribute('scope','col');\r\n             tr.appendChild(th);\r\n           }\r\n           else\r\n             tr.insertCell(k);\r\n         }\r\n      }\r\n    end;\r\n  end;\r\n\r\n  if delta < 0 then\r\n  begin\r\n\r\n    asm\r\n      var i = 0;\r\n      var j = 0;\r\n      var k = 0;\r\n      var tr = undefined;\r\n\r\n      var l = this.FTable.rows.length;\r\n\r\n      for(j = 0; j < l; j++)\r\n      {\r\n        tr = this.FTable.rows[j];\r\n\r\n        k = tr.cells.length;\r\n\r\n         for(i = 0; i < -delta; i++)\r\n         {\r\n           tr.deleteCell(k - i - 1);\r\n         }\r\n      }\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nconstructor TCustomTableControl.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  TabStop := false;\r\nend;\r\n\r\nfunction TCustomTableControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\n  FTable := nil;\r\nend;\r\n\r\nprocedure TCustomTableControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FOptions := TTableControlOptions.Create(Self);\r\n//  Color := clWindow;\r\n // TabStop := false;\r\n  FColCount := 5;\r\n  FRowCount := 10;\r\n  FRowHeader := true;\r\n  FColHeader := true;\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\nend;\r\n\r\ndestructor TCustomTableControl.Destroy;\r\nbegin\r\n  FOptions.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomTableControl.DoCheckClick(ACol, ARow: Longint;\r\n  Checked: boolean);\r\nbegin\r\n  if Assigned(OnCheckClick) then\r\n    OnCheckClick(Self, ACol, ARow, Checked);\r\nend;\r\n\r\nfunction TCustomTableControl.DoHttpAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnHttpRequestError) then\r\n    OnHttpRequestError(Self);\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomTableControl.DoHttpLoadCsv(Event: TEventListenerEvent): boolean;\r\nvar\r\n  sl: TStringList;\r\n  arow: TStringList;\r\n  i,j: integer;\r\n  firstrow: integer;\r\n  cd, cn: string;\r\n  ce: TJSHTMLElement;\r\n  req: TJSXMLHttpRequest;\r\nbegin\r\n  req := TJSXMLHttpRequest(Event.target);\r\n\r\n  if (req.status >= 200) and (req.status <= 208) then\r\n  begin\r\n    sl := TStringList.Create;\r\n\r\n    sl.Text := req.responseText;\r\n\r\n    if RowHeader and not FLoadFixed then\r\n      firstrow := 1\r\n    else\r\n      firstrow := 0;\r\n\r\n    RowCount := sl.Count + firstrow;\r\n\r\n    arow := TStringList.Create;\r\n\r\n    try\r\n      for i := 0 to sl.Count - 1 do\r\n        begin\r\n          arow.StrictDelimiter := true;\r\n          arow.Delimiter := FDelimiter;\r\n          arow.DelimitedText := sl.Strings[i];\r\n\r\n          if arow.Count > ColCount then\r\n            ColCount := arow.Count;\r\n\r\n          for j := 0 to arow.Count - 1 do\r\n          begin\r\n            cd := arow.Strings[j];\r\n            GetCellData(j, i + firstrow, nil, cd);\r\n\r\n            Cells[j, i + firstrow] := cd;\r\n\r\n            ce := CellElements[j, i + firstrow];\r\n\r\n            GetCellChildren(j, i + firstrow, nil, cd, ce);\r\n\r\n            cn := '';\r\n            GetCellClassName(j, i + firstrow, nil, cd, cn);\r\n            if cn <> '' then\r\n              ce.setAttribute('class',cn);\r\n          end;\r\n        end;\r\n    finally\r\n      arow.Free;\r\n      sl.Free;\r\n    end;\r\n\r\n    if Assigned(OnHttpRequestSuccess) then\r\n      OnHttpRequestSuccess(Self);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TCustomTableControl.DoHttpLoadJson(Event: TEventListenerEvent): boolean;\r\nvar\r\n  J: TJSObject;\r\n  JO: JSValue;\r\n  JA: TJSArray;\r\n  r,c,firstrow: integer;\r\n  arow: string;\r\n  sl: TStringList;\r\n  cd,cn: string;\r\n  ce: TJSHTMLElement;\r\n  req: TJSXMLHttpRequest;\r\n\r\nbegin\r\n  req := TJSXMLHttpRequest(Event.target);\r\n\r\n  if (req.status >= 200) and (req.status <= 208) then\r\n  begin\r\n    J := TJSJSON.parseObject(req.responseText);\r\n\r\n    if FDataNode <> '' then\r\n      JA := TJSArray(J.Properties[FDataNode])\r\n    else\r\n      JA := TJSArray(J);\r\n\r\n\r\n    if Assigned(JA) then\r\n    begin\r\n      sl := TStringList.Create;\r\n\r\n      if RowHeader then\r\n        firstrow := 1\r\n      else\r\n        firstrow := 0;\r\n\r\n      RowCount := JA.length +  firstrow;\r\n\r\n      for r := 0 to JA.length - 1 do\r\n      begin\r\n        JO := JA.Elements[r];\r\n\r\n        c := 0;\r\n        arow := '';\r\n\r\n        asm\r\n          var x = undefined;\r\n          for (x in JO) {\r\n            arow += \"|\" + JO[x];\r\n            c++;\r\n          }\r\n        end;\r\n\r\n        Delete(arow, 1, 1);\r\n        sl.StrictDelimiter := true;\r\n        sl.Delimiter := '|';\r\n        sl.DelimitedText := arow;\r\n        if ColCount < sl.Count  then\r\n          ColCount := sl.Count;\r\n\r\n\r\n        for c := 0 to sl.Count - 1 do\r\n        begin\r\n          cd := sl.Strings[c];\r\n          GetCellData(c, r + firstrow, nil, cd);\r\n          Cells[c, r + firstrow] := cd;\r\n\r\n          ce := CellElements[c, r + firstrow];\r\n\r\n          GetCellChildren(c, r + firstrow, nil, cd, ce);\r\n\r\n          cn := '';\r\n          GetCellClassName(c, r + firstrow, nil, cd, cn);\r\n          if cn <> '' then\r\n            ce.setAttribute('class',cn);\r\n        end;\r\n      end;\r\n\r\n      sl.Free;\r\n    end;\r\n\r\n    if Assigned(OnHttpRequestSuccess) then\r\n      OnHttpRequestSuccess(Self);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\nprocedure TCustomTableControl.DoHttpRequest(ARequest: TJSXMLHttpRequest);\r\nbegin\r\n  if Assigned(OnHttpRequest) then\r\n    OnHttpRequest(Self, ARequest);\r\nend;\r\n\r\nprocedure TCustomTableControl.EnableColResize;\r\nvar\r\n  TableName: string;\r\n  ResizeEnabled: Boolean;\r\nbegin\r\n  TableName := Name;\r\n  ResizeEnabled := Options.ResizeColumns;\r\n\r\n  if not (csDesigning in ComponentState) then\r\n  begin\r\n    asm\r\n      resizableGrid(TableName, ResizeEnabled);\r\n    end;\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TCustomTableControl.GetCellChildren(ACol, ARow: integer;\r\n  AField: TField; AValue: string; AElement: TJSHTMLElement);\r\nbegin\r\n  if Assigned(OnGetCellChildren) then\r\n    OnGetCellChildren(Self, ACol, ARow, AField, AValue, AElement);\r\nend;\r\n\r\nprocedure TCustomTableControl.GetCellClassName(ACol, ARow: integer;\r\n  AField: TField; AValue: string; var AClassName: string);\r\nbegin\r\n  if Assigned(OnGetCellClass) then\r\n    OnGetCellClass(Self, ACol, ARow, AField, AValue, AClassName);\r\nend;\r\n\r\nprocedure TCustomTableControl.GetCellData(ACol, ARow: integer; AField: TField;\r\n  var AValue: string);\r\nbegin\r\n  if Assigned(OnGetCellData) then\r\n    OnGetCellData(Self, ACol, ARow, AField, AValue);\r\nend;\r\n\r\nfunction TCustomTableControl.GetCellElement(col, row: integer): TJSHTMLElement;\r\nvar\r\n  res: TJSHTMLElement;\r\nbegin\r\n  res := nil;\r\n\r\n  if (col >= 0) and (row >= 0) and (col < ColCount) and (row < RowCount) then\r\n  begin\r\n    asm\r\n      res = this.FTable.rows[row].cells[col];\r\n    end;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TCustomTableControl.GetCells(col, row: integer): string;\r\nvar\r\n  res: string;\r\n\r\nbegin\r\n  Result := '';\r\n\r\n  if (col >= 0) and (row >= 0) and (col < ColCount) and (row < RowCount) then\r\n  begin\r\n    asm\r\n      var td = this.FTable.rows[row].cells[col];\r\n      res = td.innerHTML;\r\n    end;\r\n\r\n    Result := res;\r\n  end;\r\nend;\r\n\r\nfunction TCustomTableControl.GetRowClassName(row: integer): TElementClassName;\r\nvar\r\n  res: string;\r\nbegin\r\n  res := '';\r\n\r\n  if (row >= 0) and (row < RowCount) then\r\n  begin\r\n    asm\r\n      var tr = this.FTable.rows[row];\r\n      res = tr.getAttribute('class');\r\n    end;\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction TCustomTableControl.HandleCheckBoxClick(Event: TJSEvent): Boolean;\r\nvar\r\n  rindex, cindex: integer;\r\n  chk: boolean;\r\nbegin\r\n  Result := true;\r\n  rindex := -1;\r\n  cindex := -1;\r\n\r\n  asm\r\n    var el = Event.target;\r\n    chk = el.checked;\r\n    var d = el.parentElement;\r\n    if (d.tagName.toLowerCase() == 'td')\r\n    {\r\n      cindex = d.cellIndex;\r\n      var tr = d.parentElement;\r\n      rindex = tr.rowIndex;\r\n    }\r\n  end;\r\n\r\n  if (rindex <> -1) and (cindex <> -1) then\r\n  begin\r\n    DoCheckClick(cindex, rindex, chk);\r\n  end;\r\nend;\r\n\r\nfunction TCustomTableControl.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  c,r: integer;\r\n  el: TJSElement;\r\nbegin\r\n  el := Event.target;\r\n\r\n  if (el.tagName = 'TD') or (el.tagName = 'TH') then\r\n  begin\r\n     asm\r\n       c = el.cellIndex;\r\n       var tr = el.parentElement;\r\n       r = tr.rowIndex;\r\n     end;\r\n\r\n     if Assigned(OnClickCell) then\r\n       OnClickCell(Self, c, r);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomTableControl.HandleDoDblClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  c,r: integer;\r\n  el: TJSElement;\r\nbegin\r\n  el := Event.target;\r\n\r\n  if (el.tagName = 'TD') or (el.tagName = 'TH') then\r\n  begin\r\n     asm\r\n       c = el.cellIndex;\r\n       var tr = el.parentElement;\r\n       r = tr.rowIndex;\r\n     end;\r\n\r\n     if Assigned(OnDblClickCell) then\r\n       OnDblClickCell(Self, c, r);\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TCustomTableControl.HandleDoMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  IsAutoWidth: Boolean;\r\nbegin\r\n  inherited;\r\n\r\n  IsAutoWidth := (WidthStyle in [ssAuto]);\r\n  asm\r\n    autoWidth = IsAutoWidth;\r\n    resizeColumn(Event);\r\n  end;\r\n\r\n  Result := True;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction TCustomTableControl.HandleDoMouseUp(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  inherited;\r\n\r\n  asm\r\n    resetResize();\r\n  end;\r\n\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomTableControl.InitSample(AInitMethod: TInitMethod);\r\nvar\r\n  i,j: integer;\r\nbegin\r\n  for i := 0 to RowCount - 1 do\r\n  begin\r\n    for j := 0 to ColCount - 1 do\r\n    begin\r\n     case AInitMethod of\r\n     imRandom:\r\n       Cells[j,i] := IntToStr(Random(100));\r\n     imLinear:\r\n       Cells[j,i] := IntToStr(j)+':'+IntToStr(i);\r\n     end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomTableControl.LoadFromCSV(const AURL: string; Delimiter: char = ';'; LoadFixed: boolean = false);\r\nbegin\r\n  FDelimiter := Delimiter;\r\n  FLoadFixed := LoadFixed;\r\n\r\n  FReq := TJSXMLHttpRequest.new;\r\n  FReq.addEventListener('load',@DoHttpLoadCsv);\r\n  FReq.addEventListener('abort',@DoHttpAbort);\r\n  DoHttpRequest(FReq);\r\n  FReq.open('GET', AURL);\r\n  FReq.send;\r\nend;\r\n\r\nprocedure TCustomTableControl.LoadFromJSON(const AURL: string; ADataNode: string);\r\nbegin\r\n  FDataNode := ADataNode;\r\n  FReq := TJSXMLHttpRequest.new;\r\n  FReq.addEventListener('load',@DoHttpLoadJson);\r\n  FReq.addEventListener('abort',@DoHttpAbort);\r\n  DoHttpRequest(FReq);\r\n  FReq.open('GET', AURL);\r\n  FReq.send;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TCustomTableControl.RenderGrid;\r\nvar\r\n  i: integer;\r\n  table,tbody: TJSHTMLElement;\r\n  frows, fcols: integer;\r\n  rh,ch: boolean;\r\n  headclass,tds,dtb: string;\r\n\r\nbegin\r\n  if not Assigned(FTable) then\r\n  begin\r\n    FTable := document.createElement('TABLE');\r\n    ElementHandle.appendChild(FTable);\r\n\r\n    SetHTMLElementFont(TJSHTMLElement(FTable), Font, not ((ElementClassName = '') and (ElementFont = efProperty)) );\r\n\r\n    table := TJSHTMLElement(FTable);\r\n    table.setAttribute('id', Name + 'Table');\r\n\r\n    if RowHeader then\r\n      frows := RowCount - 1\r\n    else\r\n      frows := RowCount;\r\n\r\n    fcols := ColCount;\r\n    rh := RowHeader;\r\n    ch := ColHeader;\r\n\r\n    if (csDesigning in ComponentState) then\r\n      dtb := '1px dashed gray';\r\n\r\n    if ElementTableClassName = '' then\r\n    begin\r\n      table.style.setProperty('border-collapse','collapse');\r\n      table.setAttribute('border','0');\r\n      table.setAttribute('cellpadding','0');\r\n      table.setAttribute('cellspacing','0');\r\n      table.setAttribute('width','100%');\r\n      table.setAttribute('table-layout','fixed');\r\n      table.setAttribute('height','100%');\r\n      tds := '1px solid black';\r\n    end\r\n    else\r\n    begin\r\n      tds := '';\r\n      table.setAttribute('class',ElementTableClassName);\r\n    end;\r\n\r\n    headclass := ElementHeaderClassName;\r\n\r\n    asm\r\n      while (table.firstChild) {\r\n        table.removeChild(table.firstChild);\r\n      }\r\n\r\n      var i = 0;\r\n      var j = 0;\r\n      if (rh)\r\n      {\r\n        var theader = table.createTHead();\r\n\r\n        if (headclass != \"\")\r\n        {\r\n          theader.setAttribute(\"class\", headclass);\r\n        }\r\n\r\n        var tr = theader.insertRow(0);\r\n\r\n        for(i=0; i < fcols; i++)\r\n        {\r\n          var th = document.createElement('th');\r\n          th.setAttribute('scope','col');\r\n          tr.appendChild(th);\r\n        }\r\n      }\r\n\r\n      tbody = table.appendChild(document.createElement('tbody'));\r\n\r\n      for(i=0; i < frows; i++)\r\n      {\r\n        var tr = tbody.insertRow(0);\r\n\r\n        for(j=0; j < fcols; j++)\r\n        {\r\n          if ((j == 0) && (ch))\r\n          {\r\n            var th = document.createElement('th');\r\n            th.setAttribute('scope','row');\r\n            tr.appendChild(th);\r\n          }\r\n          else\r\n          {\r\n            tr.insertCell(j);\r\n            var td = tr.cells[j];\r\n            td.innerHTML = \"&nbsp\";\r\n\r\n            if (tds != \"\") {\r\n              //td.style.borderBottom = tds;\r\n            }\r\n            if (dtb != \"\")\r\n            {\r\n              td.style.borderRight = dtb;\r\n              if (j == 1)\r\n                td.innerHTML = frows - i;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    end;\r\n\r\n    FBody := tbody;\r\n  end;\r\n  EnableColResize;\r\nend;\r\n\r\nprocedure TCustomTableControl.RenderGridScript;\r\nbegin\r\n  AddControlScriptSource(\r\n  'var pageX,curCol,nxtCol,curColWidth,nxtColWidth,autoWidth,curTable,curTableWidth;'+\r\n  'autoWidth = false;'+\r\n\r\n  'function resizeColumn(e) {'+\r\n  '   if (curCol) {'+\r\n  '    var diffX = e.pageX - pageX;'+\r\n  '\t\tif ((nxtCol) && (!autoWidth)){'+\r\n  '\t\t nxtCol.style.width = (nxtColWidth - diffX)+\"px\";'+\r\n  '   } else {'+\r\n//  '    curTable.style.width = (curTableWidth + diffX) + \"px\";'+\r\n  '   }'+\r\n  '   newColWidth = (curColWidth + diffX);'+\r\n  '   if (newColWidth < 10)'+\r\n  '    newColWidth = 10;'+\r\n  '\t  curCol.style.width = newColWidth + \"px\";'+\r\n  '   }'+\r\n  ' }'+\r\n\r\n  'function resetResize() {'+\r\n  '   curCol = undefined;'+\r\n  '   nxtCol = undefined;'+\r\n  '   pageX = undefined;'+\r\n  '   nxtColWidth = undefined;'+\r\n  '   curColWidth = undefined;'+\r\n  '   curTable = undefined;'+\r\n  '   curTableWidth = undefined;'+\r\n  ' }'+\r\n\r\n  'function resizableGrid(tablename, enabled) {'+\r\n  ' var table = document.getElementById(tablename + \"Table\");'+\r\n  ' if (!table) return;' +\r\n  ' var row = table.getElementsByTagName(\"tr\")[0],'+\r\n  ' cols = row ? row.children : undefined;'+\r\n  ' if (!cols) return;'+\r\n\r\n  ' for (var i=0;i<cols.length;i++){'+\r\n  '  var coldiv = document.getElementById(tablename + \"Div\" + i);'+\r\n\r\n  '  if (coldiv)'+\r\n  '    coldiv.remove();'+\r\n\r\n  '  if (enabled) {'+\r\n  '    var div = createDiv();'+\r\n  '    cols[i].appendChild(div);'+\r\n  '    cols[i].style.position = \"relative\";'+\r\n  '    div.id = tablename + \"Div\" + i;'+\r\n  '    setListeners(div);'+\r\n  '  }'+\r\n  ' }'+\r\n\r\n  ' function setListeners(div){'+\r\n\r\n  '  div.addEventListener(\"mousedown\", function (e) {'+\r\n  '   curCol = e.target.parentElement;'+\r\n  '   nxtCol = curCol.nextElementSibling;'+\r\n  '   pageX = e.pageX;'+\r\n\r\n  '   curColWidth = curCol.offsetWidth;'+\r\n  '   curTable = curCol.parentElement.parentElement.parentElement;'+\r\n  '   curTableWidth = curTable.offsetWidth;'+\r\n  '   if (nxtCol)'+\r\n  '    nxtColWidth = nxtCol.offsetWidth;'+\r\n  '  });'+\r\n\r\n  '  div.addEventListener(\"mouseover\", function (e) {'+\r\n  '   e.target.style.borderRight = \"2px solid #0000ff\";'+\r\n  '  });'+\r\n\r\n  '  div.addEventListener(\"mouseout\", function (e) {'+\r\n  '   e.target.style.borderRight = \"\";'+\r\n  '  });'+\r\n\r\n  '  document.addEventListener(\"mousemove\", function (e) {'+\r\n  '   resizeColumn(e);'+\r\n  '  });'+\r\n\r\n  '  document.addEventListener(\"mouseup\", function (e) {'+\r\n  '   resetResize(e);'+\r\n  '  });'+\r\n  ' }'+\r\n\r\n  ' function createDiv(){'+\r\n  '  var div = document.createElement(\"div\");'+\r\n  '  div.style.top = 0;'+\r\n  '  div.style.right = 0;'+\r\n  '  div.style.width = \"10px\";'+\r\n  '  div.style.position = \"absolute\";'+\r\n  '  div.style.cursor = \"col-resize\";'+\r\n  '  div.style.userSelect = \"none\";'+\r\n  '  div.style.height = \"100%\";'+\r\n  '  div.innerHTML = \"&nbsp;\";'+\r\n//  '  div.style.border = \"1px solid red\";'+\r\n  '  return div;'+\r\n  ' }'+\r\n\r\n  '};');\r\nend;\r\n\r\nprocedure TCustomTableControl.RowCountChanged(delta: integer);\r\nvar\r\n  r: integer;\r\n  tbody: TJSElement;\r\nbegin\r\n  if IsUpdating or not Assigned(FTable) then\r\n    Exit;\r\n\r\n  tbody := FBody;\r\n\r\n  if (delta > 0) then\r\n  begin\r\n\r\n    asm\r\n      var i = 0;\r\n      var j = 0;\r\n      var tr = undefined;\r\n      var l = tbody.rows.length;\r\n\r\n      for(i = 0;i < delta; i++)\r\n      {\r\n         tr = tbody.insertRow(l);\r\n         for(j = 0; j < this.FColCount; j++)\r\n         {\r\n\r\n          if ((j == 0) && (this.FColHeader))\r\n          {\r\n            var th = document.createElement('th');\r\n            th.setAttribute('scope','row');\r\n            tr.appendChild(th);\r\n          }\r\n          else\r\n            tr.insertCell(j);\r\n         }\r\n      }\r\n    end;\r\n  end;\r\n\r\n  if delta < 0 then\r\n  begin\r\n    asm\r\n      var i = 0;\r\n      var l = this.FBody.rows.length;\r\n      for(i = 0;i < -delta; i++) {\r\n        this.FBody.deleteRow(l - i - 1);\r\n      }\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\n\r\nprocedure TCustomTableControl.SetCells(col, row: integer; const Value: string);\r\nbegin\r\n  if (col >= 0) and (row >= 0) and (col < ColCount) and (row < RowCount) then\r\n  begin\r\n    asm\r\n      var td = this.FTable.rows[row].cells[col];\r\n      td.innerHTML = Value;\r\n    end;\r\n\r\n    if (row = 0) then\r\n      EnableColResize;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomTableControl.SetElementHeaderClassName(\r\n  const Value: TElementClassName);\r\nvar\r\n  head: TJSHTMLElement;\r\nbegin\r\n  if (FElementHeaderClassName <> Value) then\r\n  begin\r\n    FElementHeaderClassName := Value;\r\n    if Assigned(FTable) then\r\n    begin\r\n      head := TJSHTMLElement(FTable.firstChild);\r\n      if Assigned(head) and (head.tagName = 'THEAD') then\r\n        head.setAttribute('class',ElementHeaderClassName);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomTableControl.SetElementTableClassName(\r\n  const Value: TElementClassName);\r\nbegin\r\n  if (FElementTableClassName <> Value) then\r\n  begin\r\n    FElementTableClassName := Value;\r\n    if Assigned(FTable) then\r\n      FTable.setAttribute('class',ElementTableClassName);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomTableControl.SetOptions(const Value: TTableControlOptions);\r\nbegin\r\n  FOptions.Assign(Value);\r\nend;\r\n\r\nprocedure TCustomTableControl.SetRowClassName(row: integer; const Value: TElementClassName);\r\nbegin\r\n  if (row >= 0) and (row < RowCount) then\r\n  begin\r\n    asm\r\n      var tr = this.FTable.rows[row];\r\n      tr.setAttribute('class',Value);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomTableControl.SetRowCount(const Value: integer);\r\nvar\r\n  delta: integer;\r\nbegin\r\n  if (FRowCount <> Value) and (Value >= 0) then\r\n  begin\r\n    delta := Value - FRowCount;\r\n\r\n    if (FRowcount = 0) and RowHeader then\r\n      delta := Value - 1;\r\n\r\n    FRowCount := Value;\r\n    RowCountChanged(delta);\r\n    GridChanged;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomTableControl.UpdateElement;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if Options.ScrollVertical then\r\n      ElementHandle.style.setProperty('overflow-y','scroll')\r\n    else\r\n      ElementHandle.style.setProperty('height','');\r\n\r\n    if (csDesigning in ComponentState) then\r\n    begin\r\n      ElementHandle.style.setProperty('width', IntToStr(Width) + 'px');\r\n      ElementHandle.style.setProperty('height', IntToStr(Height) + 'px');\r\n    end;\r\n\r\n    // allow selection in labels\r\n    ElementHandle.style.setProperty('user-select', '');\r\n\r\n    // allow default caret on text\r\n    if Cursor = crDefault then\r\n      ElementHandle.style.setProperty('cursor', '');\r\n\r\n    if (BorderStyle = bsSingle) and (BorderColor <> clNone) and (ElementClassName = '') and (ElementTableClassName = '') and not IsLinked then\r\n      ElementHandle.style.setProperty('border', '1px ' + ColorToHTML(BorderColor)+' solid')\r\n    else\r\n      ElementHandle.style.setProperty('border', '');\r\n\r\n    if (Color <> clNone) and (Color <> clWindow) then\r\n      ElementHandle.style.setProperty('background-color', ColorToHTML(Color))\r\n    else\r\n      ElementHandle.style.setProperty('background-color', '');\r\n\r\n    RenderGrid;\r\n  end;\r\nend;\r\n\r\n\r\n{ TResponsiveGridItem }\r\n\r\ndestructor TResponsiveGridItem.Destroy;\r\nbegin\r\n  (Collection as TResponsiveGridItems).DoItemDelete(Index);\r\n  inherited;\r\nend;\r\n\r\nprocedure TResponsiveGridItem.SetHTML(const Value: string);\r\nbegin\r\n  FHTML := Value;\r\n  Changed(false);\r\nend;\r\n\r\n{ TResponsiveGridItems }\r\n\r\nfunction TResponsiveGridItems.Add: TResponsiveGridItem;\r\nbegin\r\n  Result := TResponsiveGridItem(inherited Add);\r\n  DoItemAdd(Result.Index);\r\nend;\r\n\r\nprocedure TResponsiveGridItems.Clear;\r\nbegin\r\n  inherited Clear;\r\n  DoItemClear;\r\nend;\r\n\r\nconstructor TResponsiveGridItems.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TResponsiveGridItem);\r\nend;\r\n\r\nprocedure TResponsiveGridItems.Delete(Index: integer);\r\nbegin\r\n  inherited Delete(Index);\r\nend;\r\n\r\nprocedure TResponsiveGridItems.DoItemAdd(Index: integer);\r\nbegin\r\n  if Assigned(OnItemAdd) then\r\n    OnItemAdd(Self, Index);\r\nend;\r\n\r\nprocedure TResponsiveGridItems.DoItemClear;\r\nbegin\r\n  if Assigned(OnItemClear) then\r\n    OnItemClear(Self);\r\nend;\r\n\r\nprocedure TResponsiveGridItems.DoItemDelete(Index: integer);\r\nbegin\r\n  if Assigned(OnItemDelete) then\r\n    OnItemDelete(Self, Index);\r\nend;\r\n\r\nprocedure TResponsiveGridItems.DoItemInsert(Index: integer);\r\nbegin\r\n  if Assigned(OnItemInsert) then\r\n    OnItemInsert(Self, Index);\r\nend;\r\n\r\nprocedure TResponsiveGridItems.DoItemUpdate(Index: integer);\r\nbegin\r\n  if Assigned(OnItemUpdate) then\r\n    OnItemUpdate(Self, Index);\r\nend;\r\n\r\nfunction TResponsiveGridItems.GetItem(Index: integer): TResponsiveGridItem;\r\nbegin\r\n  Result := TResponsiveGridItem(inherited Items[Index]);\r\nend;\r\n\r\nfunction TResponsiveGridItems.Insert(Index: integer): TResponsiveGridItem;\r\nbegin\r\n  Result := TResponsiveGridItem(inherited Insert(Index));\r\n  DoItemInsert(Result.Index);\r\nend;\r\n\r\nprocedure TResponsiveGridItems.SetItem(Index: integer;\r\n  const Value: TResponsiveGridItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nprocedure TResponsiveGridItems.Update(Item: TCollectionItem);\r\nbegin\r\n  inherited;\r\n  if Assigned(Item) then\r\n    DoItemUpdate(Item.Index);\r\nend;\r\n\r\n{ TResponsiveGrid }\r\n\r\nprocedure TResponsiveGrid.BindElement;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nconstructor TResponsiveGrid.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nfunction TResponsiveGrid.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure TResponsiveGrid.CreateInitialize;\r\nbegin\r\n  inherited;\r\n\r\n  FDesignTime := (csDesigning in ComponentState) and not\r\n    ((csReading in Owner.ComponentState) or (csLoading in Owner.ComponentState));\r\n\r\n  FListElement := nil;\r\n\r\n  FOptions := TResponsiveGridOptions.Create;\r\n  FOptions.OnChange := OptionsChanged;\r\n  FItems := TResponsiveGridItems.Create(Self);\r\n  FItems.PropName := 'Items';\r\n\r\n  if FDesignTime then\r\n  begin\r\n    Items.Clear;\r\n    Items.Add;\r\n    Items.Add;\r\n    Items.Add;\r\n  end;\r\n\r\n  FItems.OnItemAdd := HandleItemAdd;\r\n  FItems.OnItemUpdate := HandleItemUpdate;\r\n  FItems.OnItemDelete := HandleItemDelete;\r\n  FItems.OnItemInsert := HandleItemInsert;\r\n  FItems.OnItemClear := HandleItemClear;\r\n\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TResponsiveGrid.CreateControl;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\ndestructor TResponsiveGrid.Destroy;\r\nbegin\r\n  FOptions.Free;\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TResponsiveGrid.DoHttpAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnHttpRequestError) then\r\n    OnHttpRequestError(Self);\r\n  Result := true;\r\nend;\r\n\r\nfunction TResponsiveGrid.DoHttpLoadCsv(Event: TEventListenerEvent): boolean;\r\nvar\r\n  sl,arow,columns: TStringList;\r\n  i,c: integer;\r\n  itm: TResponsiveGridItem;\r\n  ident,html, htmlvalue: string;\r\n  req: TJSXMLHttpRequest;\r\n\r\nbegin\r\n  req := TJSXMLHttpRequest(Event.target);\r\n\r\n  if (req.status >= 200) and (req.status <= 208) then\r\n  begin\r\n    sl := TStringList.Create;\r\n    sl.Text := req.responseText;\r\n\r\n    arow := TStringList.Create;\r\n    arow.StrictDelimiter := true;\r\n    arow.Delimiter := FDelimiter;\r\n\r\n    if sl.Count > 0 then\r\n    begin\r\n      columns := TStringList.Create;\r\n      columns.StrictDelimiter := true;\r\n      columns.Delimiter := FDelimiter;\r\n      columns.DelimitedText := sl.Strings[0];\r\n\r\n      for i := 0 to sl.Count - 1 do\r\n      begin\r\n        arow.DelimitedText := sl.Strings[i];\r\n\r\n        if Options.ItemTemplate = '' then\r\n        begin\r\n          Items.Add.HTML := arow.CommaText;\r\n        end\r\n        else\r\n        begin\r\n          itm := Items.Add;\r\n\r\n          html := Options.ItemTemplate;\r\n          for c := 0 to arow.Count - 1 do\r\n          begin\r\n            ident := '(%' + columns.Strings[c] + '%)';\r\n            if Pos(ident, html) > 0 then\r\n            begin\r\n              htmlvalue := '';\r\n              if c < arow.Count then\r\n                htmlvalue := arow.Strings[c];\r\n\r\n              DoItemGetFieldValue(itm.Index, columns.Strings[c], htmlvalue);\r\n              html := StringReplace(html, ident, htmlvalue, [rfReplaceAll]);\r\n            end;\r\n          end;\r\n\r\n          itm.HTML := html;\r\n\r\n          DoItemCreated(itm.Index);\r\n        end;\r\n      end;\r\n\r\n      columns.Free;\r\n\r\n    end;\r\n\r\n    arow.Free;\r\n    sl.Free;\r\n\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TResponsiveGrid.DoHttpLoadJson(Event: TEventListenerEvent): boolean;\r\nvar\r\n  J: TJSObject;\r\n  JO: JSValue;\r\n  JA: TJSArray;\r\n  r,c: integer;\r\n  arow,ident,html, htmlvalue: string;\r\n  sl: TStringList;\r\n  itm: TResponsiveGridItem;\r\n  req: TJSXMLHttpRequest;\r\n\r\nbegin\r\n  req := TJSXMLHttpRequest(Event.target);\r\n\r\n  if (req.status >= 200) and (req.status <= 208) then\r\n  begin\r\n    Items.Clear;\r\n\r\n    J := TJSJSON.parseObject(req.responseText);\r\n\r\n    if FDataNode <> '' then\r\n      JA := TJSArray(J.Properties[FDataNode])\r\n    else\r\n      JA := TJSArray(J);\r\n\r\n\r\n    if Assigned(JA) then\r\n    begin\r\n      sl := TStringList.Create;\r\n\r\n      //RowCount := JA.length +  FixedRows;\r\n\r\n      for r := 0 to JA.length - 1 do\r\n      begin\r\n        // array element\r\n        JO := JA.Elements[r];\r\n\r\n        c := 0;\r\n        arow := '';\r\n\r\n        asm\r\n          var x = undefined;\r\n          for (x in JO) {\r\n            arow += \"|\" + x + \"=\" + JO[x];\r\n            c++;\r\n          }\r\n        end;\r\n\r\n        Delete(arow, 1, 1);\r\n        sl.StrictDelimiter := true;\r\n        sl.Delimiter := '|';\r\n        sl.DelimitedText := arow;\r\n\r\n        if Options.ItemTemplate = '' then\r\n        begin\r\n          Items.Add.HTML := sl.CommaText;\r\n        end\r\n        else\r\n        begin\r\n          itm := Items.Add;\r\n\r\n          html := Options.ItemTemplate;\r\n          for c := 0 to sl.Count - 1 do\r\n          begin\r\n            ident := '(%' + sl.Names[c] + '%)';\r\n            if Pos(ident, html) > 0 then\r\n            begin\r\n              htmlvalue := sl.Values[sl.Names[c]];\r\n              DoItemGetFieldValue(itm.Index, sl.Names[c], htmlvalue);\r\n              html := StringReplace(html, ident, htmlvalue, [rfReplaceAll]);\r\n            end;\r\n          end;\r\n\r\n          itm.HTML := html;\r\n\r\n          DoItemCreated(itm.Index);\r\n        end;\r\n      end;\r\n\r\n      sl.Free;\r\n    end;\r\n\r\n    if Assigned(OnHttpRequestSuccess) then\r\n      OnHttpRequestSuccess(Self);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TResponsiveGrid.DoHttpRequest(ARequest: TJSXMLHttpRequest);\r\nbegin\r\n  if Assigned(OnHttpRequest) then\r\n    OnHttpRequest(Self, ARequest);\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\nprocedure TResponsiveGrid.DoItemCreated(Index: integer);\r\nbegin\r\n  if Assigned(OnItemCreated) then\r\n    OnItemCreated(Self, Index);\r\nend;\r\n\r\nprocedure TResponsiveGrid.DoItemGetFieldValue(Index: integer;\r\n  AFieldName: string; var AValue: string);\r\nbegin\r\n  if Assigned(OnItemGetFieldValue) then\r\n    OnItemGetFieldValue(Self, Index, AFieldName, AValue);\r\nend;\r\n\r\nprocedure TResponsiveGrid.FontChanged;\r\nbegin\r\n  inherited;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TResponsiveGrid.TargetIsParent(tgt,el: TJSElement): boolean;\r\nvar\r\n  pe: TJSElement;\r\nbegin\r\n  Result := false;\r\n  pe := tgt;\r\n  repeat\r\n    if el = pe then\r\n    begin\r\n      Result := true;\r\n      break;\r\n    end;\r\n    pe := pe.parentElement;\r\n\r\n  until not Assigned(pe);\r\nend;\r\n\r\nfunction TResponsiveGrid.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  i: integer;\r\n  el: TJSHTMLElement;\r\n\r\nbegin\r\n  Result := inherited HandleDoClick(Event);\r\n\r\n  for i := 0 to Items.Count - 1 do\r\n  begin\r\n    el := TJSHTMLElement(ListElementHandle.children.Items[i]);\r\n    if Assigned(el) then\r\n    begin\r\n      // search HTML DIV element in list that is clicked\r\n      if TargetIsParent(Event.target, el) then\r\n      begin\r\n        FItemIndex := i;\r\n        el.classList.add(Name+'_Selected');\r\n        HandleDoItemClick(i);\r\n      end\r\n      else\r\n        el.classList.remove(Name+'_Selected');\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TResponsiveGrid.HandleDoDblClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  i: integer;\r\n  el: TJSHTMLElement;\r\nbegin\r\n  Result := inherited HandleDoClick(Event);\r\n\r\n  for i := 0 to Items.Count - 1 do\r\n  begin\r\n    el := TJSHTMLElement(ListElementHandle.children.Items[i]);\r\n\r\n    if TargetIsParent(Event.target, el) then\r\n    begin\r\n      HandleDoItemDblClick(i);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGrid.HandleDoItemClick(Index: integer);\r\nbegin\r\n  if Assigned(OnItemClick) then\r\n    OnItemClick(Self, Index);\r\nend;\r\n\r\nprocedure TResponsiveGrid.HandleDoItemDblClick(Index: integer);\r\nbegin\r\n  if Assigned(OnItemDblClick) then\r\n    OnItemDblClick(Self, Index);\r\nend;\r\n\r\nfunction TResponsiveGrid.HandleDoMouseEnter(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  Result := inherited HandleDoMouseEnter(Event);\r\nend;\r\n\r\nprocedure TResponsiveGrid.HandleItemAdd(Sender: TObject; Index: integer);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  Items.Items[Index].FHTML := Options.ItemTemplate;\r\n\r\n  el := TJSHTMLElement(document.createElement('DIV'));\r\n  Items.Items[Index].FElementHandle := el;\r\n\r\n  ListElementHandle.appendChild(el);\r\n  el.innerHTML := Items.Items[Index].HTML;\r\n  if Options.ItemClassName <> '' then\r\n    el.setAttribute('class',Options.ItemClassName);\r\nend;\r\n\r\nprocedure TResponsiveGrid.HandleItemClear(Sender: TObject);\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := ListElementHandle.childElementCount - 1 downto 0 do\r\n  begin\r\n    ListElementHandle.removeChild(ListElementHandle.children.items[0]);\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGrid.HandleItemDelete(Sender: TObject; Index: integer);\r\nbegin\r\n  if Assigned(ListElementHandle) then\r\n  begin\r\n    ListElementHandle.removeChild(ListElementHandle.children.Items[Index]);\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGrid.HandleItemInsert(Sender: TObject; Index: integer);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  Items.Items[Index].FHTML := Options.ItemTemplate;\r\n\r\n  el := TJSHTMLElement(document.createElement('DIV'));\r\n  Items.Items[Index].FElementHandle := el;\r\n\r\n  if Items.Count <= 1 then\r\n    ListElementHandle.appendChild(el)\r\n  else\r\n    ListElementHandle.insertBefore(el, ListElementHandle.children.Items[Index]);\r\n\r\n  el.innerHTML := Items.Items[Index].HTML;\r\n  if Options.ItemClassName <> '' then\r\n    el.setAttribute('class',Options.ItemClassName);\r\nend;\r\n\r\nprocedure TResponsiveGrid.HandleItemUpdate(Sender: TObject; Index: integer);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  if Assigned(ListElementHandle) then\r\n  begin\r\n    el := TJSHTMLElement(ListElementHandle.children.Items[Index]);\r\n    if not Assigned(el) then\r\n    begin\r\n      HandleItemInsert(Self, Index);\r\n    end\r\n    else\r\n      el.innerHTML := Items.Items[Index].HTML;\r\n  end;\r\nend;\r\n\r\nfunction TResponsiveGrid.ListElementHandle: TJSElement;\r\nbegin\r\n  if not Assigned(FListElement) then\r\n  begin\r\n    FListElement := TJSHTMLElement(document.createElement('DIV'));\r\n    FListElement['width'] := '100%';\r\n    ElementHandle.appendChild(FListElement);\r\n    Result := FListElement;\r\n  end\r\n  else\r\n    Result := FListElement;\r\nend;\r\n\r\nprocedure TResponsiveGrid.Loaded;\r\nbegin\r\n  inherited;\r\n  RenderGrid;\r\nend;\r\n\r\nprocedure TResponsiveGrid.LoadFromCSV(const AURL: string; Delimiter: char = ';');\r\nbegin\r\n  FDelimiter := Delimiter;\r\n\r\n  FReq := TJSXMLHttpRequest.new;\r\n  FReq.addEventListener('load',@DoHttpLoadCsv);\r\n  FReq.addEventListener('abort',@DoHttpAbort);\r\n  DoHttpRequest(FReq);\r\n  FReq.open('GET', AURL);\r\n  FReq.send;\r\nend;\r\n\r\nprocedure TResponsiveGrid.LoadFromJSON(const AURL: string; ADataNode: string);\r\nbegin\r\n  FDataNode := ADataNode;\r\n  FReq := TJSXMLHttpRequest.new;\r\n  FReq.addEventListener('load',@DoHttpLoadJson);\r\n  FReq.addEventListener('abort',@DoHttpAbort);\r\n  DoHttpRequest(FReq);\r\n  FReq.open('GET', AURL);\r\n  FReq.send;\r\nend;\r\n\r\nprocedure TResponsiveGrid.OptionsChanged(Sender: TObject);\r\nbegin\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TResponsiveGrid.RenderGrid;\r\nvar\r\n  i: integer;\r\n  el: TJSHTMLElement;\r\nbegin\r\n  if (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  if not Assigned(ListElementHandle) then\r\n    Exit;\r\n\r\n  // clear previous items\r\n  while ListElementHandle.childElementCount > 0 do\r\n  begin\r\n    ListElementHandle.removeChild(ListElementHandle.firstChild);\r\n  end;\r\n\r\n  // refresh items\r\n  for i := 0 to Items.Count - 1 do\r\n  begin\r\n    el := TJSHTMLElement(document.createElement('DIV'));\r\n    ListElementHandle.appendChild(el);\r\n    el.innerHTML := Items.Items[i].HTML;\r\n    if Options.ItemClassName <> '' then\r\n      el.setAttribute('class',Options.ItemClassName);\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGrid.SetItemIndex(const Value: integer);\r\nvar\r\n  el: TJSHTMLElement;\r\n  i: integer;\r\n\r\nbegin\r\n  FItemIndex := Value;\r\n\r\n  if (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  for i := 0 to Items.Count - 1 do\r\n  begin\r\n    el := TJSHTMLElement(ListElementHandle.children.Items[i]);\r\n    if (i = FItemIndex) then\r\n    begin\r\n      el.setAttribute('class',Options.ItemClassName + ' ' + Name+'_Selected');\r\n    end\r\n    else\r\n      el.setAttribute('class',Options.ItemClassName);\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGrid.SetItems(const Value: TResponsiveGridItems);\r\nbegin\r\n  FItems.Assign(Value);\r\nend;\r\n\r\nprocedure TResponsiveGrid.SetOptions(const Value: TResponsiveGridOptions);\r\nbegin\r\n  FOptions.Assign(Value);\r\nend;\r\n\r\nprocedure TResponsiveGrid.UpdateElement;\r\nvar\r\n  s, fs: string;\r\n  ITMWIDTHMIN: string;\r\n  ITMGAP: string;\r\n  ITMHEIGHT: string;\r\n  itemstyle, itemstylehover, itemstyleselected: string;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ITMWIDTHMIN := IntToStr(Options.ItemWidthMin);\r\n    ITMHEIGHT := IntToStr(Options.ItemHeight);\r\n    ITMGAP := IntToStr(Options.ItemGap);\r\n\r\n    ListElementHandle.setAttribute('class', Self.Name);\r\n\r\n    fs := '';\r\n\r\n    if (ElementClassName = '') and (ElementFont = efProperty) then\r\n      fs := CSSFont(Self.Font);\r\n\r\n    itemstyle := '';\r\n    itemstylehover := '';\r\n    itemstyleselected := '';\r\n\r\n    if Options.ItemColor <> clNone then\r\n      itemstyle := 'background-color:'+ColorToHTML(Options.ItemColor)+';';\r\n\r\n    if (csDesigning in ComponentState) and (Options.ItemBorderColor = clNone) then\r\n        itemstyle := itemstyle + 'border: 1px dotted silver;'\r\n    else if (Options.ItemBorderColor <> clNone) then\r\n      itemstyle := itemstyle + 'border: 1px solid ' + ColorToHTML(Options.ItemBorderColor)+';';\r\n\r\n    if Options.ItemPadding <> 0 then\r\n      itemstyle := itemstyle +  'padding:' + IntToStr(Options.ItemPadding)+';';\r\n\r\n    if Options.ItemHoverColor <> clNone then\r\n      itemstylehover := 'background-color:' + ColorToHTML(Options.ItemHoverColor)+';';\r\n\r\n    if Options.ItemHoverBorderColor <> clNone then\r\n      itemstylehover := itemstylehover + 'border: 1px solid '+ColorToHTML(Options.ItemHoverBorderColor);\r\n\r\n    if Options.ItemSelectedColor <> clNone then\r\n      itemstyleselected := 'background-color:' + ColorToHTML(Options.ItemSelectedColor)+';';\r\n\r\n    if Options.ItemSelectedBorderColor <> clNone then\r\n      itemstyleselected := itemstyleselected + 'border: 1px solid '+ColorToHTML(Options.ItemSelectedBorderColor)+';';\r\n\r\n    if Options.ItemSelectedTextColor <> clNone then\r\n      itemstyleselected := itemstyleselected + 'color:'+ColorToHTML(Options.ItemSelectedTextColor)+';';\r\n\r\n    if Options.ScrollVertical then\r\n      ElementHandle.style.setProperty('overflow-y','auto')\r\n    else\r\n      ElementHandle.style.setProperty('overflow-y','hidden');\r\n\r\n    s := '.'+Name+' {'+\r\n       'display: grid; grid-template-columns: repeat(auto-fill, minmax('+ ITMWIDTHMIN +'px, 1fr));'+\r\n       ' grid-gap: '+ ITMGAP + 'px;'+\r\n       '}' + #13\r\n       + '.'+Name+' > div { ' + itemstyle +'height: '+ ITMHEIGHT + 'px; ' + fs +' }'+#13\r\n       + '.'+Name+' > div:hover {' + itemstylehover + ' '+ fs + ' }'+#13\r\n       + '.'+Name+'_Selected {' + itemstyleselected + 'height: '+ ITMHEIGHT + 'px;' + fs + '}'+#13;\r\n\r\n    AddInstanceStyle(s);\r\n  end;\r\n\r\n  RenderGrid;\r\nend;\r\n\r\n{ TResponsiveGridOptions }\r\n\r\nprocedure TResponsiveGridOptions.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TResponsiveGridOptions) then\r\n  begin\r\n    FItemWidthMin := (Source as TResponsiveGridOptions).ItemWidthMin;\r\n    FItemHeight := (Source as TResponsiveGridOptions).ItemHeight;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.Changed;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nconstructor TResponsiveGridOptions.Create;\r\nbegin\r\n  inherited;\r\n  FItemWidthMin := 100;\r\n  FItemHeight := 100;\r\n  FItemGap := 10;\r\n  FScrollVertical := true;\r\n  FItemColor := clNone;\r\n  FItemBorderColor := clNone;\r\n  FItemHoverColor := clNone;\r\n  FItemHoverBorderColor := clNone;\r\n  FItemSelectedColor := clNone;\r\n  FItemSelectedBorderColor := clNone;\r\n  FItemSelectedTextColor := clNone;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemBorderColor(const Value: TColor);\r\nbegin\r\n  if (FItemBorderColor <> Value) then\r\n  begin\r\n    FItemBorderColor := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemColor(const Value: TColor);\r\nbegin\r\n  if (FItemColor <> Value) then\r\n  begin\r\n    FItemColor := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemGap(const Value: integer);\r\nbegin\r\n  if (FItemGap <> Value) then\r\n  begin\r\n    FItemGap := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemHeight(const Value: integer);\r\nbegin\r\n  if (FItemHeight <> Value) then\r\n  begin\r\n    FItemHeight := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemHoverBorderColor(const Value: TColor);\r\nbegin\r\n  if (FItemHoverBorderColor <> Value) then\r\n  begin\r\n    FItemHoverBorderColor := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemHoverColor(const Value: TColor);\r\nbegin\r\n  if (FItemHoverColor <> Value) then\r\n  begin\r\n    FItemHoverColor := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemPadding(const Value: integer);\r\nbegin\r\n  if (FItemPadding <> Value) then\r\n  begin\r\n    FItemPadding := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemSelectedBorderColor(\r\n  const Value: TColor);\r\nbegin\r\n  if FItemSelectedBorderColor <> Value then\r\n  begin\r\n    FItemSelectedBorderColor := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemSelectedColor(const Value: TColor);\r\nbegin\r\n  if (FItemSelectedColor <> Value) then\r\n  begin\r\n    FItemSelectedColor := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemSelectedTextColor(const Value: TColor);\r\nbegin\r\n  if (FItemSelectedTextColor <> Value) then\r\n  begin\r\n    FItemSelectedTextColor := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemTemplate(const Value: string);\r\nbegin\r\n  if (FItemTemplate <> Value) then\r\n  begin\r\n    FItemTemplate := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetItemWidthMin(const Value: integer);\r\nbegin\r\n  if (FItemWidthMin <> Value) then\r\n  begin\r\n    FItemWidthMin := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridOptions.SetScrollVertical(const Value: boolean);\r\nbegin\r\n  if (FScrollVertical <> Value) then\r\n  begin\r\n    FScrollVertical := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\n{ TTableControlOptions }\r\n\r\nprocedure TTableControlOptions.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TTableControlOptions) then\r\n  begin\r\n    FScrollVertical := (Source as TTableControlOptions).ScrollVertical;\r\n    FResizeColumns := (Source as TTableControlOptions).ResizeColumns;\r\n  end;\r\n\r\nend;\r\n\r\nconstructor TTableControlOptions.Create(AOwner: TCustomTableControl);\r\nbegin\r\n  inherited;\r\n  FOwner := AOwner;\r\nend;\r\n\r\nprocedure TTableControlOptions.SetResizeColumns(const Value: boolean);\r\nbegin\r\n  FResizeColumns := Value;\r\n  FOwner.EnableColResize;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.StdCtrls;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Controls, SysUtils, Web, WEBLib.Graphics, Types, WEBlib.WebTools, WEBLib.Forms;\r\n\r\ntype\r\n  Single = Double;\r\n  TEditCharCase = (wecLowerCase, wecNormal, wecMixedCase, wecUpperCase);\r\n  TCheckBoxState = (cbChecked, cbGrayed, cbUnchecked);\r\n  TDateTimeKind = (dtkDate, dtkTime);\r\n  TEllipsisPosition = (epEndEllipsis, epNone);\r\n  TTextLayout = (tlTop, tlCenter, tlBottom);\r\n  TSysLinkType = (sltID, sltURL);\r\n\r\n  TAutoCompletion = (acOff,acHonorificPrefix, aGivenName, acAdditionalName, acFamilyName, acHonorificSuffix,\r\n    acNickName, acEmail, acUserName, acNewPassword, acCurrentPassword, acOrganizationTitle, acOrganization,\r\n    acStreetAddress, acAddressLine1, acAddressLine2, acAddressLine3, acAddressLevel1, acAddressLevel2,\r\n    acAddressLevel3, acAddressLevel4, acCountry, acCountryName, acPostalCode, acCCName, acCCGivenName,\r\n    acCCAdditionalName, acCCFamilyName, acCCNumber, acExpiry, acExpiryMonth, acExpiryYear, ccCSC,\r\n    acType, acTransactionCurrency, acTransactionAmount, acLanguage, acBirthday, acBirthdayDay,\r\n    acBirthDayMonth, acBirthDayYear, acSex, acTelephone, acTelephoneCountryCode, acTelephoneNational,\r\n    acTelephoneAreaCode, acTelephoneLocal, acTelephoneExtension, acIMPP, acURL, acPhoto);\r\n\r\n  TEditType = (weString, weFloat, weHex, weNumeric, weSignedFloat, weSignedNumeric, weSearch);\r\n\r\n  THTMLType = (tLABELTAG, tSPAN, tDIV, tH1,tH2, tH3, tH4, tH5, tH6, tP);\r\n\r\n  TLinkClickEvent = procedure(Sender: TObject; Link: string; LinkType: TSysLinkType) of object;\r\n\r\n  TCustomLabel = class(TCustomControl)\r\n  private\r\n    FContent: TJSElement;\r\n    FAutoSize: boolean;\r\n    FEllipsisPosition: TEllipsisPosition;\r\n    FWordWrap: Boolean;\r\n    FAlignment: TAlignment;\r\n    FLayout: TTextLayout;\r\n    FTransparent: boolean;\r\n    FHTMLType: THTMLType;\r\n    FFocusControl: TWinControl;\r\n    FShowAccelChar: boolean;\r\n    FColor: TColor;\r\n    FElementLabelClassName: TElementClassName;\r\n    procedure SetLayout(const Value: TTextLayout);\r\n    procedure SetAlignment(const Value: TAlignment);\r\n    function GetContentHandle: TJSHTMLElement;\r\n    procedure SetTransparent(const Value: boolean);\r\n    procedure SetHTMLType(const Value: THTMLType);\r\n    procedure SetColorEx(const Value: TColor);\r\n    procedure SetElementLabelClassName(const Value: TElementClassName);\r\n  protected\r\n    function GetOuterWidth: integer; override;\r\n    function GetOuterHeight: integer; override;\r\n    function CreateElement: TJSElement; override;\r\n    function CreateLabelElement: TJSElement; virtual;\r\n    function GetDisplayText: string; virtual;\r\n    function CanShowFocus: boolean; override;\r\n    procedure BindElement; override;\r\n    procedure Loaded; override;\r\n    procedure UpdateAutoSize; virtual;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure SetAutoSize(AValue: boolean);\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure SetEllipsisPosition(AValue: TEllipsisPosition);\r\n    property ContentHandle: TJSHTMLElement read GetContentHandle;\r\n    property Alignment: TAlignment read FAlignment write SetAlignment default taLeftJustify;\r\n    property AutoSize: boolean read FAutoSize write SetAutoSize default true;\r\n    property ElementLabelClassName: TElementClassName read FElementLabelClassName write SetElementLabelClassName;\r\n    property EllipsisPosition: TEllipsisPosition read FEllipsisPosition write SetEllipsisPosition default epNone;\r\n    property FocusControl: TWinControl read FFocusControl write FFocusControl;\r\n    property Layout: TTextLayout read FLayout write SetLayout default tlTop;\r\n    property ShowAccelChar: boolean read FShowAccelChar write FShowAccelChar default true;\r\n    property Transparent: boolean read FTransparent write SetTransparent default true;\r\n    property WordWrap: Boolean read FWordWrap write FWordWrap default false;\r\n    property HTMLType: THTMLType read FHTMLType write SetHTMLType default tLABELTAG;\r\n    property Color: TColor read FColor write SetColorEx default clWhite;\r\n    function GetWidth: Integer; override;\r\n    function GetHeight: Integer; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TLabel = class(TCustomLabel)\r\n  published\r\n    property Align;\r\n    property Alignment;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property Color;\r\n    property EllipsisPosition;\r\n    property Enabled;\r\n    property ElementClassName;\r\n    property ElementLabelClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property FocusControl;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property HTMLType;\r\n    property Layout;\r\n    property Left;\r\n    property Margins;\r\n    property ParentFont;\r\n    property ShowAccelChar;\r\n    property ShowHint;\r\n    property TextDirection;\r\n    property Top;\r\n    property Transparent;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property WordWrap;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnTouchStart;\r\n    property OnTouchEnd;\r\n    property OnTouchMove;\r\n    property OnTouchCancel;\r\n  end;\r\n\r\n  TWebLabel = class(TLabel);\r\n\r\n  TCustomInput = class(TCustomControl)\r\n  private\r\n  protected\r\n    function GetInputType: string; virtual;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElementVisual; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TCustomEdit = class(TCustomInput)\r\n  private\r\n    FCharCase: TEditCharCase;\r\n    FMaxLength: integer;\r\n    FReadOnly: Boolean;\r\n    FText: string;\r\n    FTextHint: string;\r\n    FSelStart: Integer;\r\n    FAlignment: TAlignment;\r\n    FHideSelection: Boolean;\r\n    FPasswordChar: Char;\r\n    FOnChange: TNotifyEvent;\r\n    FAutoSize: Boolean;\r\n    FAutoSelect: Boolean;\r\n    FSelLength: Integer;\r\n    FNumeric: Boolean;\r\n    FAutoCompletion: TAutoCompletion;\r\n    FEditType: TEditType;\r\n    FRequired: Boolean;\r\n    FAutoFocus: boolean;\r\n    FPattern: string;\r\n    FHandlePastePtr: pointer;\r\n    FHandleCutPtr: pointer;\r\n    procedure SetAlignment(const Value: TAlignment);\r\n    procedure SetHideSelection(const Value: Boolean);\r\n    procedure SetAutoSelect(const Value: Boolean);\r\n    procedure SetAutoSize(const Value: Boolean);\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    procedure SetSelLength(const Value: Integer);\r\n    procedure SetSelStart(const Value: Integer);\r\n    procedure SetPasswordChar(const Value: Char);\r\n    procedure SetNumeric(const Value: Boolean);\r\n    procedure SetAutoCompletion(const Value: TAutoCompletion);\r\n    procedure SetAutoFocus(const Value: boolean);\r\n    procedure SetRequired(const Value: Boolean);\r\n    procedure SetPattern(const Value: string);\r\n    function GetSelLength: Integer;\r\n    function GetSelStart: Integer;\r\n    procedure SetEditType(const Value: TEditType);\r\n  protected\r\n    function DoHandlePaste(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleCut(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    function IsCustomEditor: Boolean; virtual;\r\n    procedure KeyPress(var Key: Char); override;\r\n    function GetInputType: string; override;\r\n    procedure PersistinHTML; override;\r\n    function GetText: string;\r\n    function GetDisplayText: string; virtual;\r\n    function IsReadOnly: boolean; virtual;\r\n    function Validate(AValue: string): boolean; virtual;\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure SetCharCase(AValue: TEditCharCase); virtual;\r\n    procedure SetMaxLength(AValue: integer);\r\n    procedure SetReadOnly(AValue: boolean);\r\n    procedure SetText(AValue: string);\r\n    procedure SetTextHint(AValue: string);\r\n    function CanPaste(AValue: string): boolean; virtual;\r\n    function CanCut: boolean; virtual;\r\n    property Font;\r\n    property AutoCompletion: TAutoCompletion read FAutoCompletion write SetAutoCompletion;\r\n    property AutoFocus: boolean read FAutoFocus write SetAutoFocus;\r\n    property Color;\r\n    property BorderStyle;\r\n    property HideSelection: Boolean read FHideSelection write SetHideSelection;\r\n    property CharCase: TEditCharCase read FCharCase write SetCharCase;\r\n    property MaxLength: integer read FMaxLength write SetMaxLength;\r\n    property Numeric: Boolean read FNumeric write SetNumeric;\r\n    property PasswordChar: Char read FPasswordChar write SetPasswordChar default #0;\r\n    property Pattern: string read FPattern write SetPattern;\r\n    property ReadOnly: Boolean read FReadOnly write SetReadOnly;\r\n    property Required: Boolean read FRequired write SetRequired;\r\n    property Text: string read GetText write SetText;\r\n    property TextHint: string read FTextHint write SetTextHint;\r\n    property AutoSize: Boolean read FAutoSize write SetAutoSize;\r\n    property AutoSelect: Boolean read FAutoSelect write SetAutoSelect;\r\n    property Alignment: TAlignment read FAlignment write SetAlignment;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property SelStart: Integer read GetSelStart write SetSelStart;\r\n    property SelLength: Integer read GetSelLength write SetSelLength;\r\n    procedure Clear;\r\n    procedure ClearSelection;\r\n    procedure Change; virtual;\r\n    procedure SelectAll;\r\n    property EditType: TEditType read FEditType write SetEditType;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n  end;\r\n\r\n  TEdit = class(TCustomEdit)\r\n  published\r\n    property Alignment;\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoCompletion;\r\n    property AutoFocus;\r\n    property AutoSize;\r\n    property AutoSelect;\r\n    property BorderStyle;\r\n    property CharCase;\r\n    property ChildOrder;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property HideSelection;\r\n    property Left;\r\n    property ParentFont;\r\n    property PasswordChar;\r\n    property Pattern;\r\n    property Margins;\r\n    property MaxLength;\r\n    property ReadOnly;\r\n    property Required;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property TextDirection;\r\n    property TextHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebEdit = class(TEdit);\r\n\r\n  TSpinEdit = class(TCustomInput)\r\n  private\r\n    FIncrement: integer;\r\n    FMaxValue: integer;\r\n    FMinValue: integer;\r\n    FValue: integer;\r\n    FAutoSize: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    FReadOnly: boolean;\r\n    function GetText: string;\r\n    procedure SetText(const Value: string);\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    procedure SetReadOnly(const Value: boolean);\r\n  protected\r\n    procedure KeyPress(var Key: Char); override;\r\n    procedure PersistinHTML; override;\r\n    function GetInputType: string; override;\r\n    procedure UpdateElementData; override;\r\n    function GetValue: integer;\r\n    procedure SetIncrement(AValue: integer);\r\n    procedure SetMaxValue(AValue: integer);\r\n    procedure SetMinValue(AValue: integer);\r\n    procedure SetValue(AValue: integer);\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    function IsReadOnly: boolean; virtual;\r\n    function GetDisplayText: string; virtual;\r\n    procedure BindEvents; override;\r\n    procedure Change; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n    property Text: string read GetText write SetText;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize: Boolean read FAutoSize write FAutoSize;\r\n    property BorderStyle;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Increment: integer read FIncrement write SetIncrement;\r\n    property Left;\r\n    property Margins;\r\n    property MaxValue: integer read FMaxValue write SetMaxValue default 100;\r\n    property MinValue: integer read FMinValue write SetMinValue default 0;\r\n    property ParentFont;\r\n    property ReadOnly: boolean read FReadOnly write SetReadOnly;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabStop;\r\n    property TabOrder;\r\n    property TextDirection;\r\n    property Value: integer read GetValue write SetValue;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebSpinEdit = class(TSpinEdit);\r\n\r\n  TDateTimePicker = class(TCustomInput)\r\n  private\r\n    FDate: TDateTime;\r\n    FKind: TDateTimeKind;\r\n    FTime: TDateTime;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetDate(AValue: TDateTime);\r\n    function GetDate: TDateTime;\r\n    procedure SetTime(AValue: TDateTime);\r\n    function GetTime: TDateTime;\r\n    procedure SetKind(AValue: TDateTimeKind);\r\n    procedure SetText(const Value: String);\r\n    function GetText: String;\r\n  protected\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    function CreateElement: TJSElement; override;\r\n    function GetInputType: string; override;\r\n    procedure Change; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property Color;\r\n    property Date: TDateTime read GetDate write SetDate;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Kind: TDateTimeKind read FKind write SetKind;\r\n    property Left;\r\n    property Margins;\r\n    property ParentFont;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabStop;\r\n    property TabOrder;\r\n    property Text: String read GetText write SetText;\r\n    property TextDirection;\r\n    property Time: TDateTime read GetTime write SetTime;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebDateTimePicker = class(TDateTimePicker);\r\n\r\n  TButton = class(TCustomControl)\r\n  private\r\n    FModalResult: TModalResult;\r\n    FDefault: Boolean;\r\n    FCancel: Boolean;\r\n    FButtonType: string;\r\n    procedure SetButtonType(const Value: string);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ModalResult: TModalResult read FModalResult write FModalResult;\r\n    property Default: Boolean read FDefault write FDefault;\r\n    property Cancel: Boolean read FCancel write FCancel;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property ButtonType: string read FButtonType write SetButtonType;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property Margins;\r\n    property Role;\r\n    property ParentFont;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property TextDirection;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebButton = class(TButton);\r\n\r\n  TCheckBox = class(TCustomControl)\r\n  private\r\n    FChecked: boolean;\r\n    FState: TCheckBoxState;\r\n    FElementButtonClassName: TElementClassName;\r\n    FElementLabelClassName: TElementClassName;\r\n  protected\r\n    procedure Loaded; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementSize; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure PersistinHTML; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetChecked(AValue: boolean);\r\n    function GetChecked: boolean;\r\n    procedure SetState(AValue: TCheckBoxState);\r\n    function GetState: TCheckBoxState;\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure SetEnabled(Value: boolean); override;\r\n    function HandleLabelClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure Click; override;\r\n    function GetCheckElement: TJSHTMLElement;\r\n    procedure KeyPress(var ch: char); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property Checked: boolean read GetChecked write SetChecked default False;\r\n    property ChildOrder;\r\n    property Color default clNone;\r\n    property ElementClassName;\r\n    property ElementButtonClassName: TElementClassName read FElementButtonClassName write FElementButtonClassName;\r\n    property ElementLabelClassName: TElementClassName read FElementLabelClassName write FElementLabelClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property Margins;\r\n    property ParentFont;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property State: TCheckBoxState read GetState write SetState;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebCheckBox = class(TCheckBox);\r\n\r\n  TRadioButton = class(TCustomControl)\r\n  private\r\n    FChecked: boolean;\r\n    FGroupName: string;\r\n    FElementButtonClassName: TElementClassName;\r\n    FElementLabelClassName: TElementClassName;\r\n  protected\r\n    procedure PersistInHTML; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetChecked(AValue: boolean);\r\n    function GetChecked: boolean;\r\n    procedure SetEnabled(Value: boolean); override;\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure SetGroupName(AValue: string);\r\n    function HandleLabelClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleRadioClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure UpdateElementSize; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    function GetRadioElement: TJSHTMLElement;\r\n    procedure Keypress(var ch: Char); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property Checked: boolean read GetChecked write SetChecked default false;\r\n    property ChildOrder;\r\n    property Color default clNone;\r\n    property ElementClassName;\r\n    property ElementButtonClassName: TElementClassName read FElementButtonClassName write FElementButtonClassName;\r\n    property ElementLabelClassName: TElementClassName read FElementLabelClassName write FElementLabelClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property GroupName: string read FGroupName write SetGroupName;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property ParentFont;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebRadioButton = class(TRadioButton);\r\n\r\n  TListBox = class(TCustomControl)\r\n  private\r\n    FItems: TStrings;\r\n    FItemIndex: integer;\r\n    FMultiSelect: boolean;\r\n    FSelected: TList;\r\n    FItemHeight: Integer;\r\n    FSorted: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetItemHeight(const Value: Integer);\r\n    procedure SetSorted(const Value: Boolean);\r\n    function GetCount: Integer;\r\n    function GetElementSelectHandle: TJSHTMLSelectElement;\r\n    function GetSelCount: integer;\r\n  protected\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure DoItemsChange(Sender: TObject);\r\n    procedure DoUpdateList; virtual;\r\n    procedure PersistinHTML; override;\r\n    function GetItemIndex: integer;\r\n    function CreateElement: TJSElement; override;\r\n    function GetSelected(AIndex: integer): boolean;\r\n    procedure SetSelected(AIndex: Integer; AValue: boolean);\r\n    procedure SetItems(AItems: TStrings);\r\n    procedure SetItemIndex(AIndex: integer);\r\n    procedure SetMultiSelect(AValue: boolean);\r\n    procedure Loaded; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure BindEvents; override;\r\n    procedure Change; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure EndUpdate; override;\r\n    procedure ClearSelection;\r\n    procedure SelectAll;\r\n    property Sorted: Boolean read FSorted write SetSorted;\r\n    property Count: Integer read GetCount;\r\n    property SelCount: integer read GetSelCount;\r\n    property ElementSelectHandle: TJSHTMLSelectElement read GetElementSelectHandle;\r\n    procedure AddItem(Item: string; AObject: TObject);\r\n    property Selected[i: Integer]: boolean read GetSelected write SetSelected;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property ChildOrder;\r\n    property Color;\r\n    property Font;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property ItemHeight: Integer read FItemHeight write SetItemHeight;\r\n    property ItemIndex: integer read GetItemIndex write SetItemIndex default -1;\r\n    property Items: TStrings read FItems write SetItems;\r\n    property Left;\r\n    property MultiSelect: boolean read FMultiSelect write SetMultiSelect;\r\n    property ParentColor;\r\n    property ParentFont;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property TextDirection;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnMouseWheel;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebListBox = class(TListBox);\r\n\r\n  TComboBoxStyle = (csDropDown, csSimple, csDropDownList, csOwnerDrawFixed,\r\n    csOwnerDrawVariable);\r\n\r\n  TCustomComboBox = class(TCustomControl)\r\n  private\r\n    FItems: TStrings;\r\n    FItemIndex: integer;\r\n    FStyle: TComboBoxStyle;\r\n    FDroppedDown: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    function GetText: string;\r\n    procedure SetText(const Value: string);\r\n    procedure SetStyle(const Value: TComboBoxStyle);\r\n    procedure SetDroppedDown(const Value: Boolean);\r\n    function GetElementSelectHandle: TJSHTMLSelectElement;\r\n  protected\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean; virtual;\r\n    procedure DoItemsChange(Sender: TObject);\r\n    procedure DoUpdateList; virtual;\r\n    function GetItemIndex: integer;\r\n    function CreateElement: TJSElement; override;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure SetItems(AItems: TStrings);\r\n    procedure SetItemIndex(AIndex: integer);\r\n    procedure Loaded; override;\r\n    procedure Change; virtual;\r\n    procedure PersistinHTML; override;\r\n    property Items: TStrings read FItems write SetItems;\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property ItemIndex: integer read GetItemIndex write SetItemIndex default -1;\r\n    property Left;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text: string read GetText write SetText;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnMouseWheel;\r\n    property OnEnter;\r\n    property OnExit;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Clear;\r\n    procedure AddItem(Item: string; AObject: TObject);\r\n    property ElementSelectHandle: TJSHTMLSelectElement read GetElementSelectHandle;\r\n    property Style: TComboBoxStyle read FStyle write SetStyle;\r\n    property DroppedDown: Boolean read FDroppedDown write SetDroppedDown;\r\n  end;\r\n\r\n  TComboBox = class(TCustomComboBox)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ChildOrder;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Items;\r\n    property Left;\r\n    property ParentFont;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property TextDirection;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebComboBox = class(TComboBox);\r\n\r\n  TFontPicker = class(TCustomComboBox)\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property Items;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Left;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebFontPicker = class(TFontPicker);\r\n\r\n  TFontSizePickerMode = (fmPointSize, fmRelativeSize);\r\n\r\n  TFontSizePicker = class(TCustomComboBox)\r\n  private\r\n    FPickerMode: TFontSizePickerMode;\r\n    procedure SetPickerMode(const AValue: TFontSizePickerMode);\r\n  protected\r\n    procedure Init; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property Items;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Left;\r\n    property PickerMode: TFontSizePickerMode read FPickerMode write SetPickerMode;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebFontSizePicker = class(TFontSizePicker);\r\n\r\n\r\n  TCaretPosition = TPoint;\r\n\r\n  TCustomMemo = class(TCustomControl)\r\n  private\r\n    FWordWrap: Boolean;\r\n    FBlockChange: Boolean;\r\n    FLines: TStrings;\r\n    FSelStart: Integer;\r\n    FSelLength: Integer;\r\n    FCaretPosition: TCaretPosition;\r\n    FAutoSize: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    FReadOnly: boolean;\r\n    FTextHint: string;\r\n    FHandlePastePtr: pointer;\r\n    FHandleCutPtr: pointer;\r\n    FWantTabs: boolean;\r\n    function GetText: String;\r\n    procedure SetText(const Value: String);\r\n    procedure SetSelLength(const Value: Integer);\r\n    procedure SetSelStart(const Value: Integer);\r\n    procedure SetAutoSize(const Value: Boolean);\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    procedure SetReadOnly(const Value: boolean);\r\n    function GetSelLength: Integer;\r\n    function GetSelStart: Integer;\r\n    procedure SetTextHint(const Value: string);\r\n  protected\r\n    function HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean; override;\r\n    function CreateElement: TJSElement; override;\r\n    function DoHandlePaste(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleCut(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleInput(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean; virtual;\r\n    function IsReadOnly: boolean; virtual;\r\n    procedure PersistinHTML; override;\r\n    function GetDisplayText: string; virtual;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure SetLines(ALines: TStrings);\r\n    procedure ClearMethodPointers; override;\r\n    procedure GetMethodPointers; override;\r\n    procedure DoLinesChange(Sender: TObject);\r\n    function CanPaste(AValue: string): boolean; virtual;\r\n    function CanCut: boolean; virtual;\r\n    property Font;\r\n    property Color;\r\n    property BorderStyle;\r\n    property AutoSize: Boolean read FAutoSize write SetAutoSize;\r\n    property Lines: TStrings read FLines write SetLines;\r\n    property ReadOnly: boolean read FReadOnly write SetReadOnly;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    procedure Change; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Clear;\r\n    property Text: String read GetText write SetText;\r\n    property CaretPosition: TCaretPosition read FCaretPosition write FCaretPosition;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n    property SelStart: Integer read GetSelStart write SetSelStart;\r\n    property SelLength: Integer read GetSelLength write SetSelLength;\r\n    property TextHint: string read FTextHint write SetTextHint;\r\n    property WantTabs: boolean read FWantTabs write FWantTabs default false;\r\n    property WordWrap: Boolean read FWordWrap write FWordWrap default true;\r\n  end;\r\n\r\n  TMemo = class(TCustomMemo)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property BorderStyle;\r\n    property ChildOrder;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property Lines;\r\n    property Margins;\r\n    property ParentColor;\r\n    property ParentFont;\r\n    property ReadOnly;\r\n    property Role;\r\n    property SelStart;\r\n    property SelLength;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property TextDirection;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnMouseWheel;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebMemo = class(TMemo);\r\n\r\n  TControlGroup = class(TCustomControl)\r\n  private\r\n    FControls: TList;\r\n    FOldCount: integer;\r\n    FColumns: integer;\r\n    FItems: TStrings;\r\n    FOnChange: TNotifyEvent;\r\n    FElementButtonClassName: TElementClassName;\r\n    FElementLabelClassName: TElementClassName;\r\n    FElementGroupClassName: TElementClassName;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure DoHandleClick(AControl: TCustomControl); virtual;\r\n    procedure DoItemsChange(Sender: TObject);\r\n    procedure DoControlClick(Sender: TObject);\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure SetColumns(AValue: integer);\r\n    procedure SetItems(AItems: TStrings);\r\n    procedure DoUpdateList; virtual;\r\n    procedure Change; virtual;\r\n    procedure Loaded; override;\r\n    function CreateGroupControl(ALeft, ATop, AIndex: integer; ACaption: string; AState, AEnabled: boolean): TCustomControl; virtual;\r\n    function GetGroupControlState(AIndex: integer): boolean; virtual;\r\n    function GetGroupControl(AIndex: integer): TCustomControl;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure EndUpdate; override;\r\n    procedure SetHeight(AValue: Integer); override;\r\n    procedure SetWidth(AValue: Integer); override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property Columns: integer read FColumns write SetColumns;\r\n    property ElementClassName;\r\n    property ElementButtonClassName: TElementClassName read FElementButtonClassName write FElementButtonClassName;\r\n    property ElementGroupClassName: TElementClassName read FElementGroupClassName write FElementGroupClassName;\r\n    property ElementLabelClassName: TElementClassName read FElementLabelClassName write FElementLabelClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Items: TStrings read FItems write SetItems;\r\n    property Margins;\r\n    property ParentFont;\r\n    property Role;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TRadioGroup = class(TControlGroup)\r\n  private\r\n    FItemIndex: integer;\r\n    FOldItemIndex: integer;\r\n  protected\r\n    procedure DoHandleClick(AControl: TCustomControl); override;\r\n    function GetItemIndex: integer;\r\n    procedure SetItemIndex(AIndex: integer);\r\n    function CreateGroupControl(ALeft, ATop, AIndex: integer; ACaption: string; AState, AEnabled: boolean): TCustomControl; override;\r\n    function GetGroupControlState(AIndex: integer): boolean; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure SetFocus; override;\r\n  published\r\n    property ItemIndex: integer read GetItemIndex write SetItemIndex;\r\n  end;\r\n\r\n  TWebRadioGroup = class(TRadioGroup);\r\n\r\n  TCheckClickEvent = procedure(Sender: TObject; AIndex: integer) of object;\r\n\r\n  TCheckGroup = class(TControlGroup)\r\n  private\r\n    FOnCheckClick: TCheckClickEvent;\r\n    function GetChecked(AIndex: integer): boolean;\r\n    procedure SetChecked(AIndex: integer; const Value: boolean);\r\n  protected\r\n    procedure DoHandleClick(AControl: TCustomControl); override;\r\n    function CreateGroupControl(ALeft, ATop, AIndex: integer; ACaption: string; AState, AEnabled: boolean): TCustomControl; override;\r\n    function GetGroupControlState(AIndex: integer): boolean; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property Checked[AIndex: integer]: boolean read GetChecked write SetChecked;\r\n    procedure SetFocus; override;\r\n  published\r\n    property OnCheckClick: TCheckClickEvent read FOnCheckClick write FOnCheckClick;\r\n  end;\r\n\r\n  TWebCheckGroup = class(TCheckGroup);\r\n\r\n  TColorPicker = class(TCustomInput)\r\n  private\r\n    FColor: TColor;\r\n    FOnSelect: TNotifyEvent;\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n  protected\r\n    procedure UpdateElementVisual; override;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    function GetInputType: string; override;\r\n    function GetColor: TColor;\r\n    procedure SetColor(AValue: TColor); reintroduce;\r\n    procedure BindEvents; override;\r\n    procedure Select; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n  published\r\n    property ChildOrder;\r\n    property Color: TColor read GetColor write SetColor;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Height;\r\n    property HeightPercent;\r\n    property Left;\r\n    property Margins;\r\n    property Role;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property OnClick;\r\n    property OnSelect: TNotifyEvent read FOnSelect write FOnSelect;\r\n  end;\r\n\r\n  TWebColorPicker = class(TColorPicker);\r\n\r\n  TScrollBarContent = class(TCustomControl)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  end;\r\n\r\n  TScrollBarKind = (sbHorizontal, sbVertical);\r\n  TScrollBarInc = Integer;\r\n\r\n  TScrollBar = class(TCustomControl)\r\n  private\r\n    FScrolling: Boolean;\r\n    FContent: TScrollBarContent;\r\n    FKind: TScrollBarKind;\r\n    FPosition: Integer;\r\n    FSmallChange: TScrollBarInc;\r\n    FMax: Integer;\r\n    FMin: Integer;\r\n    FLargeChange: TScrollBarInc;\r\n    FPageSize: Integer;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetKind(const Value: TScrollBarKind);\r\n    procedure SetPosition(const Value: Integer);\r\n    procedure SetMax(const Value: Integer);\r\n    procedure SetMin(const Value: Integer);\r\n    procedure SetPageSize(const Value: Integer);\r\n    function GetPosition: Integer;\r\n    function GetPageSize: Integer;\r\n  protected\r\n    function GetValue(XYPos: Double): Double;\r\n    function CreateElement: TJSElement; override;\r\n    function DoScroll(Event: TJSUIEvent): Boolean; virtual;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure UpdateContent; virtual;\r\n    procedure Loaded; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure SetBounds(X, Y, AWidth, AHeight: Integer); override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Height;\r\n    property Kind: TScrollBarKind read FKind write SetKind;\r\n    property Position: Integer read GetPosition write SetPosition;\r\n    property Left;\r\n    property SmallChange: TScrollBarInc read FSmallChange write FSmallChange;\r\n    property LargeChange: TScrollBarInc read FLargeChange write FLargeChange;\r\n    property Max: Integer read FMax write SetMax;\r\n    property Min: Integer read FMin write SetMin;\r\n    property PageSize: Integer read GetPageSize write SetPageSize;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TWebScrollBar = class(TScrollBar);\r\n\r\nfunction GetAutoCompletionName(aAutoCompletion: TAutoCompletion): string;\r\n\r\nimplementation\r\n\r\nfunction GetAutoCompletionName(aAutoCompletion: TAutoCompletion): string;\r\nbegin\r\n  case aAutoCompletion of\r\n    acOff: Result := '';\r\n    acHonorificPrefix: Result := 'honorific-prefix';\r\n    aGivenName: Result := 'given-name';\r\n    acAdditionalName: Result := 'additional-name';\r\n    acFamilyName: Result := 'family-name';\r\n    acHonorificSuffix: Result := 'honorific-suffix';\r\n    acNickName: Result := 'nickname';\r\n    acEmail: Result := 'email';\r\n    acUserName: Result := 'username';\r\n    acNewPassword: Result := 'new-password';\r\n    acCurrentPassword: Result := 'current-password';\r\n    acOrganizationTitle: Result := 'organization-title';\r\n    acOrganization: Result := 'organization';\r\n    acStreetAddress: Result := 'street-address';\r\n    acAddressLine1: Result := 'address-line1';\r\n    acAddressLine2: Result := 'address-line2';\r\n    acAddressLine3: Result := 'address-line3';\r\n    acAddressLevel1: Result := 'address-level1';\r\n    acAddressLevel2: Result := 'address-level2';\r\n    acAddressLevel3: Result := 'address-level3';\r\n    acAddressLevel4: Result := 'address-level4';\r\n    acCountry: Result := 'country';\r\n    acCountryName: Result := 'country-name';\r\n    acPostalCode: Result := 'postal-code';\r\n    acCCName: Result := 'cc-name';\r\n    acCCGivenName: Result := 'cc-given-name';\r\n    acCCAdditionalName: Result := 'cc-additional-name';\r\n    acCCFamilyName: Result := 'cc-family-name';\r\n    acCCNumber: Result := 'cc-number';\r\n    acExpiry: Result := 'cc-exp';\r\n    acExpiryMonth: Result := 'cc-exp-month';\r\n    acExpiryYear: Result := 'cc-exp-year';\r\n    ccCSC: Result := 'cc-csc';\r\n    acType: Result := 'cc-type';\r\n    acTransactionCurrency: Result := 'transaction-currency';\r\n    acTransactionAmount: Result := 'transaction-amount';\r\n    acLanguage: Result := 'language';\r\n    acBirthday: Result := 'bday';\r\n    acBirthdayDay: Result := 'bday-day';\r\n    acBirthDayMonth: Result := 'bday-month';\r\n    acBirthDayYear: Result := 'bday-year';\r\n    acSex: Result := 'sex';\r\n    acTelephone: Result := 'tel';\r\n    acTelephoneCountryCode: Result := 'tel-country-code';\r\n    acTelephoneNational: Result := 'tel-national';\r\n    acTelephoneAreaCode: Result := 'tel-area-code';\r\n    acTelephoneLocal: Result := 'tel-local';\r\n    acTelephoneExtension: Result := 'tel-extension';\r\n    acIMPP: Result := 'impp';\r\n    acURL: Result := 'url';\r\n    acPhoto: Result := 'photo';\r\n  end;\r\nend;\r\n\r\n{ TCustomLabel }\r\n\r\nprocedure TCustomLabel.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAutoSize := true;\r\n  FLayout := tlTop;\r\n  FEllipsisPosition := epNone;\r\n  FColor := clWhite;\r\n  FTransparent := True;\r\n  FAlignment := taLeftJustify;\r\n  TabStop := false;\r\n  FShowAccelChar := true;\r\nend;\r\n\r\nfunction TCustomLabel.CanShowFocus: boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nfunction TCustomLabel.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\n\r\n  FContent := CreateLabelElement;\r\n  Result.appendChild(FContent);\r\nend;\r\n\r\nfunction TCustomLabel.CreateLabelElement: TJSElement;\r\nbegin\r\n  Result := nil;\r\n\r\n  case HTMLType of\r\n  tSPAN: Result := document.createElement('SPAN');\r\n  tDIV: Result := document.createElement('DIV');\r\n  tH1: Result := document.createElement('H1');\r\n  tH2: Result := document.createElement('H2');\r\n  tH3: Result := document.createElement('H3');\r\n  tH4: Result := document.createElement('H4');\r\n  tH5: Result := document.createElement('H5');\r\n  tH6: Result := document.createElement('H6');\r\n  tLABELTAG: Result := document.createElement('LABEL');\r\n  tP: Result := document.createElement('P');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.BindElement;\r\nbegin\r\n  FContent := Container.firstElementChild;\r\nend;\r\n\r\nfunction TCustomLabel.GetContentHandle: TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(FContent);\r\nend;\r\n\r\nfunction TCustomLabel.GetDisplayText: string;\r\nbegin\r\n  Result := Caption;\r\nend;\r\n\r\nfunction TCustomLabel.GetHeight: Integer;\r\nbegin\r\n  if AutoSize and Assigned(ElementHandle) and Assigned(Parent) and not (csDesigning in ComponentState) then\r\n  begin\r\n    Result := Round(TJSHTMLElement(ElementHandle).offsetHeight);\r\n    if Result = 0 then\r\n       Result := inherited GetHeight;\r\n  end\r\n  else\r\n    Result := inherited GetHeight;\r\nend;\r\n\r\nfunction TCustomLabel.GetOuterHeight: integer;\r\nbegin\r\n  Result := Height;\r\n//  if AutoSize then  // take 1px inner border in account\r\n//    Result := Result + 4;\r\nend;\r\n\r\nfunction TCustomLabel.GetOuterWidth: integer;\r\nbegin\r\n  Result := Width;\r\n//  if AutoSize then  // take 1px inner border in account\r\n//    Result := Result + 4;\r\nend;\r\n\r\nfunction TCustomLabel.GetWidth: Integer;\r\nbegin\r\n  if AutoSize and Assigned(ElementHandle) and Assigned(Parent) and not (csDesigning in ComponentState) then\r\n  begin\r\n    Result := Round(TJSHTMLElement(ElementHandle).offsetWidth);\r\n\r\n    if Result = 0 then\r\n      Result := inherited GetWidth;\r\n  end\r\n  else\r\n    Result := inherited GetWidth;\r\nend;\r\n\r\nprocedure TCustomLabel.Loaded;\r\nbegin\r\n  inherited;\r\n  if ShowAccelChar and Assigned(FocusControl) then\r\n    UpdateElementData;\r\nend;\r\n\r\nprocedure TCustomLabel.SetAutoSize(AValue: boolean);\r\nbegin\r\n  if (FAutoSize <> AValue) then\r\n  begin\r\n    FAutoSize := AValue;\r\n    UpdateAutoSize;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetCaption(const AValue: string);\r\nbegin\r\n  if Caption <> AValue then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    UpdateAutoSize;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetColorEx(const Value: TColor);\r\nbegin\r\n  FColor := Value;\r\n\r\n  if (csDesigning in ComponentState) and (Color <> clWhite) then\r\n    Transparent := false;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomLabel.SetElementLabelClassName(const Value: TElementClassName);\r\nbegin\r\n  if (FElementLabelClassName <> Value) then\r\n  begin\r\n    FElementLabelClassName := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetEllipsisPosition(AValue: TEllipsisPosition);\r\nbegin\r\n  if FEllipsisPosition <> AValue then\r\n  begin\r\n    FEllipsisPosition := AValue;\r\n    if FEllipsisPosition <> epNone then\r\n      FAutoSize := False;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetHTMLType(const Value: THTMLType);\r\nbegin\r\n  if (FHTMLType <> Value) then\r\n  begin\r\n    FHTMLType := Value;\r\n\r\n    if FHTMLType in [tH1..tH6] then\r\n      ElementFont := efCSS;\r\n\r\n    if Assigned(ElementHandle) and Assigned(FContent) then\r\n    begin\r\n      ElementHandle.removeChild(FContent);\r\n\r\n      FContent := CreateLabelElement;\r\n\r\n      ElementHandle.appendChild(FContent);\r\n\r\n      UpdateElement;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetLayout(const Value: TTextLayout);\r\nbegin\r\n  if FLayout <> Value then\r\n  begin\r\n    FLayout := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetTransparent(const Value: boolean);\r\nbegin\r\n  if (FTransparent <> Value) then\r\n  begin\r\n    FTransparent := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetAlignment(const Value: TAlignment);\r\nbegin\r\n  if FAlignment <> Value then\r\n  begin\r\n    FAlignment := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.UpdateAutoSize;\r\nbegin\r\n  if FAutoSize then\r\n  begin\r\n    if Assigned(ElementHandle) and (Align = alNone) then\r\n    begin\r\n      Width := -1;\r\n      Height := -1;\r\n    end;\r\n    FEllipsisPosition := epNone;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.UpdateElementData;\r\nvar\r\n  lTxt: string;\r\n  acc: string;\r\nbegin\r\n  inherited;\r\n\r\n  acc := '';\r\n\r\n  if ShowAccelChar then\r\n    lTxt := ProcessAccelerator(GetDisplayText,acc)\r\n  else\r\n    lTxt := GetDisplayText;\r\n\r\n  if IsLinked and (lTxt = '') then\r\n    Exit;\r\n\r\n  if Assigned(ContentHandle) then\r\n    ContentHandle.innerHTML := lTxt\r\n  else\r\n    ElementHandle.innerHTML := lTxt;\r\n\r\n//    https://www.htmlgoodies.com/tutorials/html_401/article.php/3479621\r\n  if (acc <> '') and Assigned(FocusControl) then\r\n  begin\r\n    ContentHandle['accesskey'] := acc;\r\n    ContentHandle['for'] := FocusControl.GetID;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomLabel.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if Visible and not AutoSize then\r\n      ElementHandle.style.setProperty('display', 'table');\r\n\r\n    ElementHandle['zindex'] := '1';\r\n\r\n    if AutoSize and (Align = alNone) and not (csDesigning in ComponentState) then\r\n      ElementHandle.style.setProperty('overflow', '')\r\n    else\r\n      ElementHandle.style.setProperty('overflow', 'hidden');\r\n  end;\r\n\r\n  if Assigned(ContentHandle) then\r\n  begin\r\n    case Layout of\r\n      tlTop: ContentHandle.style.setProperty('vertical-align', 'top');\r\n      tlCenter: ContentHandle.style.setProperty('vertical-align', 'middle');\r\n      tlBottom: ContentHandle.style.setProperty('vertical-align', 'bottom');\r\n    end;\r\n\r\n    case Alignment of\r\n    taCenter: ContentHandle.style.setProperty('text-align', 'center');\r\n    taRightJustify: ContentHandle.style.setProperty('text-align', 'right');\r\n    end;\r\n\r\n    SetHTMLElementColor(ElementHandle, Color, Transparent and ((Color = clWhite) or (Color = clNone)));\r\n    SetHTMLElementColor(ContentHandle, Color, Transparent and ((Color = clWhite) or (Color = clNone)));\r\n\r\n    ContentHandle.style.setProperty('display', 'table-cell');\r\n\r\n    if ElementClassName = '' then\r\n    begin\r\n      if Enabled and (ElementFont = efProperty) and not IsLinked then\r\n        ContentHandle.style.setProperty('color', ColorToHtml(Font.Color));\r\n\r\n      SetElementPointer(ContentHandle, Cursor);\r\n      SetHTMLElementFont(ContentHandle, Font, not ((ElementFont = efProperty) and not IsLinked) );\r\n    end;\r\n\r\n    if ElementLabelClassName <> '' then\r\n      ContentHandle['class'] := ElementLabelClassName\r\n    else\r\n      ContentHandle.removeAttribute('class');\r\n\r\n    if (ElementPosition = epAbsolute) or (WidthStyle = ssAbsolute) then\r\n    begin\r\n      if FEllipsisPosition = epNone then\r\n        ContentHandle.style.setProperty('text-overflow', 'clip')\r\n      else\r\n        ContentHandle.style.setProperty('text-overflow', 'ellipsis');\r\n    end\r\n    else\r\n      ContentHandle.style.removeProperty('text-overflow');\r\n\r\n    if WordWrap then\r\n      ContentHandle.style.setProperty('white-space', 'normal')\r\n    else\r\n      ContentHandle.style.setProperty('white-space', 'nowrap');\r\n\r\n    // allow selection in labels\r\n    ElementHandle.style.setProperty('user-select', '');\r\n\r\n    // allow default caret on text\r\n    if Cursor = crDefault then\r\n      ElementHandle.style.setProperty('cursor', '');\r\n\r\n    if AutoSize and (Align = alNone) and not (csDesigning in ComponentState) then\r\n    begin\r\n      ElementHandle.style.removeProperty('width');\r\n      ElementHandle.style.removeProperty('height');\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\n{ TCustomInput }\r\n\r\nfunction TCustomInput.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('INPUT');\r\n  Result['type'] := GetInputType;\r\nend;\r\n\r\nprocedure TCustomInput.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) and not IsLinked then\r\n  begin\r\n    TJSHTMLInputElement(Container).style.setProperty('-moz-box-sizing', 'border-box');\r\n    TJSHTMLInputElement(Container).style.setProperty('-webkit-box-sizing', 'border-box');\r\n    TJSHTMLInputElement(Container).style.setProperty('box-sizing', 'border-box');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomInput.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  ShowFocus := true;\r\nend;\r\n\r\nfunction TCustomInput.GetInputType: string;\r\nbegin\r\n   Result := 'EDIT';\r\nend;\r\n\r\n{ TCustomEdit }\r\n\r\nprocedure TCustomEdit.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.oninput := DoHandleChange;\r\n    ElementInputHandle.addEventListener('paste', FHandlePastePtr);\r\n    ElementInputHandle.addEventListener('cut', FHandleCutPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.Change;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n    FText := ElementInputHandle.value;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TCustomEdit.Clear;\r\nbegin\r\n  Text := '';\r\nend;\r\n\r\nprocedure TCustomEdit.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandlePastePtr := nil;\r\n  FHandleCutPtr := nil;\r\nend;\r\n\r\nprocedure TCustomEdit.ClearSelection;\r\nvar\r\n  s: string;\r\nbegin\r\n  s := Text;\r\n  Text := Copy(s, 1, SelStart) + Copy(s, SelStart + SelLength, Length(s));\r\nend;\r\n\r\nprocedure TCustomEdit.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FEditType := weString;\r\n  FText := '';\r\n  FCharCase := wecNormal;\r\n  FMaxLength := 0;\r\n  FReadOnly := false;\r\n  FTextHint := '';\r\n  FPasswordChar := #0;\r\n  Height := 25;\r\nend;\r\n\r\nfunction TCustomEdit.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomEdit.DoHandleCut(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  if not CanCut then\r\n  begin\r\n    asm\r\n      Event.preventDefault();\r\n      Event.stopPropagation();\r\n    end;\r\n  end;\r\n\r\n  Result := False;\r\nend;\r\n\r\nfunction TCustomEdit.DoHandlePaste(Event: TEventListenerEvent): Boolean;\r\nvar\r\n  s: string;\r\n\r\nbegin\r\n  asm\r\n    var clipboardData = Event.clipboardData || window.clipboardData;\r\n    s = clipboardData.getData('Text');\r\n  end;\r\n\r\n  if not CanPaste(s) or not Validate(s) then\r\n  begin\r\n    asm\r\n      Event.preventDefault();\r\n      Event.stopPropagation();\r\n    end;\r\n  end;\r\n\r\n  Result := False;\r\nend;\r\n\r\nfunction TCustomEdit.CanCut: boolean;\r\nbegin\r\n  Result := True\r\nend;\r\n\r\nfunction TCustomEdit.CanPaste(AValue: string): boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomEdit.SetReadOnly(AValue: Boolean);\r\nbegin\r\n  FReadOnly := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetRequired(const Value: Boolean);\r\nbegin\r\n  FRequired := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetSelLength(const Value: Integer);\r\nbegin\r\n  FSelLength := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetSelStart(const Value: Integer);\r\nbegin\r\n  FSelStart := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetPasswordChar(const Value: Char);\r\nbegin\r\n  FPasswordChar := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetPattern(const Value: string);\r\nbegin\r\n  if FPattern <> Value then\r\n  begin\r\n    FPattern := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetNumeric(const Value: Boolean);\r\nbegin\r\n  FNumeric := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetText(AValue: string);\r\nbegin\r\n  FText := AValue;\r\n\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.value := GetDisplayText;\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n  end;\r\nend;\r\n\r\nfunction TCustomEdit.GetText: string;\r\nbegin\r\n  Result := FText;\r\n  if Assigned(ElementInputHandle) then\r\n    Result := ElementInputHandle.value;\r\n\r\n  if CharCase = wecUpperCase  then\r\n    Result := Uppercase(Result);\r\n\r\n  if CharCase = wecLowerCase  then\r\n    Result := Lowercase(Result);\r\nend;\r\n\r\nfunction TCustomEdit.IsCustomEditor: Boolean;\r\nbegin\r\n  Result := False;\r\nend;\r\n\r\nfunction TCustomEdit.IsReadOnly: boolean;\r\nbegin\r\n  Result := ReadOnly;\r\nend;\r\n\r\nprocedure TCustomEdit.KeyPress(var Key: Char);\r\nvar\r\n  isValid: boolean;\r\n\r\nbegin\r\n  inherited KeyPress(Key);\r\n\r\n  isValid := true;\r\n\r\n  case EditType of\r\n  weNumeric: isValid := (Key in ['0'..'9']);\r\n  weSignedNumeric: isValid := (Key in ['0'..'9','+','-']);\r\n  weFloat: isValid := (Key in ['0'..'9',',','.']);\r\n  weSignedFloat: isValid := (Key in ['0'..'9',',','.','+','-']);\r\n  weHex: isValid := (Key in ['0'..'9','A'..'F']);\r\n  end;\r\n\r\n  if not isValid then\r\n    Key := #0;\r\nend;\r\n\r\nprocedure TCustomEdit.SetTextHint(AValue: string);\r\nbegin\r\n  FTextHint := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TCustomEdit.UpdateElementData;\r\nvar\r\n  e: TJSHTMLElement;\r\n  ss, sl: Integer;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    if not IsLinked then\r\n    begin\r\n      case CharCase of\r\n        wecUpperCase: ElementInputHandle.style.setProperty('text-transform', 'uppercase');\r\n        wecLowerCase: ElementInputHandle.style.setProperty('text-transform', 'lowercase');\r\n        wecMixedCase: ElementInputHandle.style.setProperty('text-transform', 'capitalize');\r\n        wecNormal: ElementInputHandle.style.setProperty('text-transform', 'initial');\r\n      end;\r\n    end;\r\n\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n\r\n    if TextHint <> '' then\r\n      ElementInputHandle.placeholder := TextHint;\r\n\r\n    if not isLinked then\r\n    begin\r\n      ElementInputHandle['type'] := GetInputType;\r\n      ElementInputHandle['role'] := 'textbox';\r\n\r\n      if AutoCompletion <> acOff then\r\n      begin\r\n        TJSHTMLElement(ElementInputHandle).setAttribute('autocomplete','on');\r\n        TJSHTMLElement(ElementInputHandle).setAttribute('name', GetAutoCompletionName(AutoCompletion));\r\n      end\r\n      else\r\n      begin\r\n        TJSHTMLElement(ElementInputHandle).removeAttribute('autocomplete');\r\n        TJSHTMLElement(ElementInputHandle).removeAttribute('name');\r\n      end;\r\n\r\n      case Alignment of\r\n      taLeftJustify: TJSHTMLElement(ElementInputHandle).style.removeProperty('text-align');\r\n      taCenter: TJSHTMLElement(ElementInputHandle).style.setProperty('text-align', 'center');\r\n      taRightJustify: TJSHTMLElement(ElementInputHandle).style.setProperty('text-align', 'right');\r\n      end;\r\n    end;\r\n\r\n    if AutoFocus then\r\n      ElementInputHandle.setAttribute('autofocus','')\r\n    else\r\n      ElementInputHandle.removeAttribute('autofocus');\r\n\r\n    if Required then\r\n      ElementInputHandle.setAttribute('required','')\r\n    else\r\n      ElementInputHandle.removeAttribute('required');\r\n\r\n    if FPattern <> '' then\r\n      ElementInputHandle.setAttribute('pattern',FPattern)\r\n    else\r\n      ElementInputHandle.removeAttribute('pattern');\r\n\r\n    if MaxLength <= 0 then\r\n      ElementInputHandle.removeAttribute('maxLength')\r\n    else\r\n      ElementInputHandle.maxLength := MaxLength;\r\n\r\n    ElementInputHandle.value := GetDisplayText;\r\n\r\n    if not Numeric and not isLinked and not IsCustomEditor then\r\n    begin\r\n      ss := FSelStart;\r\n      sl := FSelStart + FSelLength;\r\n      e := ElementInputHandle;\r\n      asm\r\n        setTimeout(function() {\r\n          e.setSelectionRange(ss, sl);\r\n        }, 1);\r\n      end;\r\n    end;\r\n\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction TCustomEdit.Validate(AValue: string): boolean;\r\nvar\r\n  i: integer;\r\n  Key: char;\r\n  isvalid: boolean;\r\nbegin\r\n  Result := true;\r\n\r\n  for i := 1 to Length(AValue) do\r\n  begin\r\n    Key := AValue[i];\r\n    isValid := true;\r\n\r\n    case EditType of\r\n    weNumeric: isValid := (Key in ['0'..'9']);\r\n    weSignedNumeric: isValid := (Key in ['0'..'9','+','-']);\r\n    weFloat: isValid := (Key in ['0'..'9',',','.']);\r\n    weSignedFloat: isValid := (Key in ['0'..'9',',','.','+','-']);\r\n    weHex: isValid := (Key in ['0'..'9','A'..'F']);\r\n    end;\r\n\r\n    if not IsValid then\r\n    begin\r\n      Result := false;\r\n      break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SelectAll;\r\nbegin\r\n  if Assigned(ElementInputHandle) then\r\n    ElementInputHandle.select;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAlignment(const Value: TAlignment);\r\nbegin\r\n  FAlignment := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoCompletion(const Value: TAutoCompletion);\r\nbegin\r\n  if (FAutoCompletion <> Value) then\r\n  begin\r\n    FAutoCompletion := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoFocus(const Value: boolean);\r\nbegin\r\n  if (FAutoFocus <> Value) then\r\n  begin\r\n    FAutoFocus := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoSelect(const Value: Boolean);\r\nbegin\r\n  if FAutoSelect <> Value then\r\n  begin\r\n    FAutoSelect := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoSize(const Value: Boolean);\r\nbegin\r\n  if FAutoSize <> Value then\r\n  begin\r\n    FAutoSize := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetCharCase(AValue: TEditCharCase);\r\nbegin\r\n  if (FCharcase <> AValue) then\r\n  begin\r\n    FCharcase := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetEditType(const Value: TEditType);\r\nbegin\r\n  if (FEditType <> Value) then\r\n  begin\r\n    FEditType := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetHideSelection(const Value: Boolean);\r\nbegin\r\n  if (FHideSelection <> Value) then\r\n  begin\r\n    FHideSelection := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SetMaxLength(AValue: integer);\r\nbegin\r\n  if (FMaxLength <> AValue) then\r\n  begin\r\n    FMaxLength := AValue;\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nfunction TCustomEdit.GetDisplayText: string;\r\nbegin\r\n  Result := FText;\r\nend;\r\n\r\nfunction TCustomEdit.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nfunction TCustomEdit.GetInputType: string;\r\nbegin\r\n  if (PasswordChar <> #0) then\r\n    Result := 'PASSWORD'\r\n  else if Numeric then\r\n    Result := 'NUMBER'\r\n  else\r\n    if (EditType in [weFloat, weNumeric]) then\r\n      Result := 'TEL'\r\n    else\r\n      if EditType = weSearch then\r\n        Result := 'SEARCH'\r\n      else\r\n        Result := 'TEXT';\r\nend;\r\n\r\nprocedure TCustomEdit.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandlePastePtr := @DoHandlePaste;\r\n  FHandleCutPtr := @DoHandleCut;\r\nend;\r\n\r\nfunction TCustomEdit.GetSelLength: Integer;\r\nbegin\r\n  Result := ElementInputHandle.selectionEnd - ElementInputHandle.selectionStart;\r\nend;\r\n\r\nfunction TCustomEdit.GetSelStart: Integer;\r\nbegin\r\n  Result := ElementInputHandle.selectionStart;\r\nend;\r\n\r\nprocedure TCustomEdit.PersistinHTML;\r\nbegin\r\n  ElementInputHandle.setAttribute('value', Text);\r\nend;\r\n\r\n{ TSpinEdit }\r\n\r\nprocedure TSpinEdit.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FIncrement := 1;\r\n  FMaxValue := 100;\r\n  FMinValue := 0;\r\n  ShowFocus := true;\r\n  Height := 25;\r\n\r\n  // make the spin buttons always visible\r\n  AddControlStyle('input[type=\"number\"]::-webkit-inner-spin-button { opacity: 1 !important; }');\r\nend;\r\n\r\nprocedure TSpinEdit.BindEvents; \r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.oninput := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nfunction TSpinEdit.GetDisplayText: string;\r\nbegin\r\n  Result := IntToStr(FValue);\r\nend;\r\n\r\nfunction TSpinEdit.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nfunction TSpinEdit.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TSpinEdit.Change;\r\nbegin\r\n  FValue := GetValue;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TSpinEdit.GetInputType: string;\r\nbegin\r\n  Result := 'NUMBER';\r\nend;\r\n\r\nfunction TSpinEdit.GetText: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nfunction TSpinEdit.GetValue: integer;\r\nvar\r\n  s: string;\r\nbegin\r\n  Result := FValue;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  s := TJSHTMLInputElement(Container).value;\r\n  if (s <> '') then\r\n    Result := StrToInt(s);\r\nend;\r\n\r\nfunction TSpinEdit.IsReadOnly: boolean;\r\nbegin\r\n  Result := FReadOnly;\r\nend;\r\n\r\nprocedure TSpinEdit.KeyPress(var Key: Char);\r\nbegin\r\n  if not (Key in ['0'..'9']) then\r\n  begin\r\n    Key := #0;\r\n    PreventDefault;\r\n    StopPropagation;\r\n  end;\r\n  inherited;\r\nend;\r\n\r\nprocedure TSpinEdit.SetIncrement(AValue: integer);\r\nbegin\r\n  FIncrement := AValue;\r\n  if Assigned(Container) then\r\n    Container['step'] := IntToStr(AValue);\r\nend;\r\n\r\nprocedure TSpinEdit.SetMaxValue(AValue: integer);\r\nbegin\r\n  FMaxValue := AValue;\r\n  if Assigned(Container) then\r\n    Container['max'] := IntToStr(AValue);\r\nend;\r\n\r\nprocedure TSpinEdit.SetMinValue(AValue: integer);\r\nbegin\r\n  FMinValue := AValue;\r\n  if Assigned(Container) then\r\n    Container['min'] := IntToStr(AValue);\r\nend;\r\n\r\nprocedure TSpinEdit.SetReadOnly(const Value: boolean);\r\nbegin\r\n  if (FReadOnly <> Value) then\r\n  begin\r\n    FReadOnly := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TSpinEdit.SetText(const Value: string);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TSpinEdit.PersistinHTML;\r\nbegin\r\n  ElementInputHandle.setAttribute('value',IntToStr(Value));\r\nend;\r\n\r\nprocedure TSpinEdit.SetValue(AValue: integer);\r\nbegin\r\n  FValue := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TSpinEdit.UpdateElementData;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n  begin\r\n    Container['inputmode'] := 'numeric';\r\n    Container['pattern'] := '[0-9]*';\r\n    TJSHTMLInputElement(Container).value := GetDisplayText;\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n  end;\r\nend;\r\n\r\n{ TDateTimePicker }\r\n\r\nfunction TDateTimePicker.GetInputType: string; \r\nbegin\r\n   if FKind = dtkDate then\r\n    Result := 'DATE'\r\n  else\r\n    Result := 'TIME';\r\nend;\r\n\r\nprocedure TDateTimePicker.SetDate(AValue: TDateTime);\r\nbegin\r\n  if FDate <> AValue then\r\n  begin\r\n    FDate := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n  begin\r\n    TJSHTMLInputElement(Container).oninput := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.Change;\r\nbegin\r\n  FTime := GetTime;\r\n  FDate := GetDate;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TDateTimePicker.CreateElement: TJSElement;\r\nbegin\r\n  Result := inherited CreateElement;\r\nend;\r\n\r\nprocedure TDateTimePicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Date := now;\r\n  ShowFocus := true;\r\n  Width := 170;\r\n  Height := 25;\r\nend;\r\n\r\nfunction TDateTimePicker.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := true;\r\nend;\r\n\r\nfunction TDateTimePicker.GetDate: TDateTime;\r\nvar\r\n  str: string;\r\n  ye,mo,da: string;\r\n  yei,moi,dai: word;\r\n  e: integer;\r\nbegin\r\n  Result := FTime;\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  str := TJSHTMLInputElement(Container).value;\r\n\r\n  if Kind = dtkDate then\r\n  begin\r\n    ye := copy(str,1,4);\r\n    mo := copy(str,6,2);\r\n    da := copy(str,9,2);\r\n\r\n    val(ye, yei, e);\r\n    val(mo, moi, e);\r\n    val(da, dai, e);\r\n\r\n    if (yei <> 0) and (moi <> 0) and (dai <> 0) then\r\n      Result := EncodeDate(yei, moi, dai)\r\n    else\r\n      Result := 0;\r\n  end\r\n  else\r\n    Result := 0;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetText(const Value: String);\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n // TJSHTMLInputElement(Container).value := Value;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetTime(AValue: TDateTime);\r\nbegin\r\n  if FTime <> AValue then\r\n  begin\r\n    FTime := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    Container['step'] := '1';\r\n    case Kind of\r\n      dtkTime: TJSHTMLInputElement(Container).value := FormatDateTime(LongTimeFormat, FTime);\r\n      dtkDate: TJSHTMLInputElement(Container).value := FormatDateTime('yyyy-MM-dd', FDate);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TDateTimePicker.GetText: String;\r\nbegin\r\n  Result := '';\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  Result := TJSHTMLInputElement(Container).value;\r\nend;\r\n\r\nfunction TDateTimePicker.GetTime: TDateTime;\r\nvar\r\n  str: string;\r\n  d: TDateTime;\r\nbegin\r\n  Result := FTime;\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  str := TJSHTMLInputElement(Container).value;\r\n  if TryStrToTime(str, d) then\r\n    Result := d;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetKind(AValue: TDateTimeKind);\r\nbegin\r\n  FKind := AValue;\r\n  if Assigned(Container) then\r\n  begin\r\n    if AValue = dtkDate then\r\n      Container['type'] := 'DATE'\r\n    else\r\n      Container['type'] := 'TIME';\r\n  end;\r\nend;\r\n\r\n{ TButton }\r\n\r\nprocedure TButton.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  if (csDesigning in ComponentState) then\r\n    Caption := Name;\r\n  Color := clNone;\r\nend;\r\n\r\nfunction TButton.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('BUTTON');\r\n  Result['type'] := 'BUTTON';\r\nend;\r\n\r\nprocedure TButton.SetCaption(const AValue: string);\r\nbegin\r\n  if Caption <> AValue then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nprocedure TButton.SetButtonType(const Value: string);\r\nbegin\r\n  FButtonType := Value;\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure TButton.UpdateElementData;\r\nvar\r\n  acc: string;\r\nbegin\r\n  inherited;\r\n\r\n  if IsLinked and (Caption = '') then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.innerHTML := ProcessAccelerator(Caption,acc);\r\n\r\n    if acc <> '' then\r\n      ElementHandle['accesskey'] := acc;\r\n\r\n    ElementHandle['role'] := 'button';\r\n    ElementHandle['aria-label'] := Caption;\r\n\r\n    if FButtonType <> '' then\r\n      ElementHandle['type'] := FButtonType\r\n    else\r\n      ElementHandle['type'] := 'BUTTON';\r\n  end;\r\nend;\r\n\r\nprocedure TButton.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.removeProperty('outline');\r\n    ElementHandle.style.removeProperty('user-select');\r\n  end;\r\nend;\r\n\r\n{ TCheckBox }\r\n\r\nprocedure TCheckBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Color := clNone;\r\n  FChecked := False;\r\n  if (csDesigning in ComponentState) then\r\n     Caption := Name;\r\n\r\n  ShowFocus := true;\r\nend;\r\n\r\nprocedure TCheckBox.Click;\r\nbegin\r\n  inherited;\r\n  FChecked := GetChecked;\r\n  SetFocus;\r\nend;\r\n\r\nfunction TCheckBox.CreateElement: TJSElement;\r\nvar\r\n  btn, lbl: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n  btn := document.createElement('INPUT');\r\n  lbl := document.createElement('SPAN');\r\n\r\n  btn['TYPE'] := 'CHECKBOX';\r\n  btn['id'] := GetID;\r\n  btn['role'] := 'checkbox';\r\n  lbl['id'] := GetID + 'lbl';\r\n  lbl['value'] := GetID;\r\n\r\n  Result.appendChild(btn);\r\n  Result.appendChild(lbl);\r\nend;\r\n\r\nfunction TCheckBox.HandleLabelClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  chk: TJSHTMLInputElement;\r\nbegin\r\n  if Assigned(Container) then\r\n  begin\r\n    chk := TJSHTMLInputElement(GetCheckElement);\r\n    chk.checked := not chk.checked;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCheckBox.KeyPress(var ch: char);\r\nvar\r\n  chk: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n  if ch = #32 then\r\n  begin\r\n    if Assigned(Container) then\r\n    begin\r\n      chk := TJSHTMLInputElement(GetCheckElement);\r\n      chk.checked := not chk.checked;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.Loaded;\r\nvar\r\n  lbl: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    if not IsLinked then\r\n    begin\r\n      lbl := TJSHTMLInputElement(Container.children[1]);\r\n      lbl.OnClick := @HandleLabelClick;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.UpdateElementData;\r\nvar\r\n  chk: TJSHTMLInputElement;\r\n  btn: TJSElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    chk := TJSHTMLInputElement(GetCheckElement);\r\n    chk.disabled := not Enabled;\r\n    chk.checked := FChecked;\r\n    chk.indeterminate := (State = cbGrayed);\r\n\r\n    if not IsLinked then\r\n    begin\r\n      if (Caption <> '') then\r\n        Container.lastElementChild.innerHTML := Caption;\r\n\r\n      ElementHandle.setAttribute('tabindex','-1');\r\n\r\n      btn := TJSElement(ElementHandle.firstChild);\r\n      btn.setAttribute('tabindex','-1');\r\n    end;\r\n\r\n    if TabStop then\r\n      Container.setAttribute('tabindex',inttostr(TabOrder));\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.UpdateElementSize;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) and not IsLinked then\r\n  begin\r\n    TJSHTMLElement(Container.firstElementChild).style.setProperty('height','100%');\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.UpdateElementVisual;\r\nvar\r\n  btn,lbl: TJSElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    btn := TJSElement(ElementHandle.firstChild);\r\n\r\n    if Assigned(btn) then\r\n    begin\r\n      if FElementButtonClassName <> '' then\r\n        btn.setAttribute('class',FElementButtonClassName)\r\n      else\r\n        btn.removeAttribute('class');\r\n    end;\r\n\r\n    lbl := TJSElement(ElementHandle.lastElementChild);\r\n\r\n    if Assigned(lbl) then\r\n    begin\r\n      if FElementLabelClassName <> '' then\r\n        lbl.setAttribute('class',FElementLabelClassName)\r\n      else\r\n        lbl.removeAttribute('class');\r\n    end;\r\n\r\n    if not IsLinked then\r\n    begin\r\n      ElementHandle.style.setProperty('user-select','none');\r\n\r\n      if ElementPosition = epAbsolute then\r\n      begin\r\n        if ElementButtonClassName = '' then\r\n        begin\r\n          TJSHTMLElement(btn).style.setProperty('float','left');\r\n          TJSHTMLElement(btn).style.setProperty('height','100%');\r\n          TJSHTMLElement(btn).style.setProperty('vertical-align','middle');\r\n        end;\r\n\r\n        if ElementLabelClassName = '' then\r\n        begin\r\n          lbl := TJSElement(Container.lastElementChild);\r\n          TJSHTMLElement(lbl).style.setProperty('vertical-align','middle');\r\n          TJSHTMLElement(lbl).style.setProperty('min-height','100%');\r\n          TJSHTMLElement(lbl).style.setProperty('height','100%');\r\n          TJSHTMLElement(lbl).style.setProperty('position','absolute');\r\n          TJSHTMLElement(lbl).style.setProperty('overflow','hidden');\r\n          TJSHTMLElement(lbl).style.setProperty('display','inline-flex');\r\n          TJSHTMLElement(lbl).style.setProperty('align-items','center');\r\n        end;\r\n      end;\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.SetCaption(const AValue: string);\r\nbegin\r\n  if Caption <> AValue then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    if Assigned(Container) and not IsLinked then\r\n      Container.lastElementChild.innerHTML := AValue;\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.SetEnabled(Value: boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(GetCheckElement).disabled := not Value;\r\nend;\r\n\r\nprocedure TCheckBox.SetChecked(AValue: boolean);\r\nbegin\r\n  FChecked := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TCheckBox.GetChecked: boolean;\r\nbegin\r\n  if Assigned(Container) then\r\n    FChecked := TJSHTMLInputElement(GetCheckElement).checked;\r\n\r\n  Result := FChecked;\r\nend;\r\n\r\nfunction TCheckBox.GetCheckElement: TJSHTMLElement;\r\nbegin\r\n  if IsLinked then\r\n    Result := TJSHTMLElement(ElementHandle)\r\n  else\r\n    Result := TJSHTMLElement(Container.firstElementChild);\r\nend;\r\n\r\nprocedure TCheckBox.SetState(AValue: TCheckBoxState);\r\nbegin\r\n  FState := AValue;\r\n  FChecked := FState = cbChecked;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TCheckBox.GetState: TCheckBoxState;\r\nbegin\r\n  Result := FState;\r\nend;\r\n\r\nprocedure TCheckBox.PersistinHTML;\r\nvar\r\n  cb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  cb := TJSHTMLInputElement(GetCheckElement);\r\n\r\n  if (cb.checked) then\r\n    cb.setAttribute('checked','checked')\r\n  else\r\n    cb.removeAttribute('checked');\r\nend;\r\n\r\n\r\n{ TRadioButton }\r\n\r\nprocedure TRadioButton.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Color := clNone;\r\n  if (csDesigning in ComponentState) then\r\n    Caption := Name;\r\n\r\n  FGroupName := '';\r\n  ShowFocus := true;\r\nend;\r\n\r\nfunction TRadioButton.CreateElement: TJSElement;\r\nvar\r\n  btn, lbl: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n  btn := document.createElement('INPUT');\r\n  lbl := document.createElement('SPAN');\r\n  Result.addEventListener('click', @HandleLabelClick);\r\n\r\n  btn['TYPE'] := 'RADIO';\r\n  btn['id'] := GetID + 'rd';\r\n  btn['name'] := GroupName;\r\n  btn['role'] := 'radio';\r\n  btn['tabindex'] := '-1';\r\n  btn.AddEventListener('click',@HandleRadioClick);\r\n\r\n  lbl['id'] := GetID + 'lbl';\r\n  lbl['value'] := GetID;\r\n\r\n  Result.appendChild(btn);\r\n  Result.appendChild(lbl);\r\nend;\r\n\r\nfunction TRadioButton.HandleLabelClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  if Assigned(Container) then\r\n  begin\r\n    rb := TJSHTMLInputElement(GetRadioElement);\r\n    rb.checked := true;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nfunction TRadioButton.HandleRadioClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  SetFocus;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TRadioButton.Keypress(var ch: Char);\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n  if ch = #32 then\r\n  begin\r\n    rb := TJSHTMLInputElement(GetRadioElement);\r\n    rb.checked := true;\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.SetCaption(const AValue: string);\r\nbegin\r\n  if (Caption <> AValue) then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    if Assigned(Container) and not IsLinked then\r\n      Container.lastElementChild.innerHTML := AValue;\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.SetEnabled(Value: boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(GetRadioElement).disabled := not Value;\r\nend;\r\n\r\nprocedure TRadioButton.SetGroupName(AValue: string);\r\nbegin\r\n  FGroupName := AValue;\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure TRadioButton.UpdateElementData;\r\nvar\r\n  btn: TJSElement;\r\n\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n  begin\r\n    Container.firstElementChild['name'] := FGroupName;\r\n\r\n    btn := TJSElement(ElementHandle.firstChild);\r\n\r\n    TJSHTMLInputElement(btn).disabled := not Enabled;\r\n\r\n    if not IsLinked then\r\n    begin\r\n      if (Caption <> '') then\r\n        Container.lastElementChild.innerHTML := Caption;\r\n\r\n      ElementHandle.setAttribute('tabindex','-1');\r\n\r\n      if TabStop and Assigned(btn) then\r\n        btn.setAttribute('tabindex','-1');\r\n    end;\r\n\r\n    if TabStop then\r\n      Container.setAttribute('tabindex',inttostr(TabOrder));\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.UpdateElementSize;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) and not IsLinked then\r\n  begin\r\n    TJSHTMLElement(Container.firstElementChild).style.setProperty('height','100%');\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.UpdateElementVisual;\r\nvar\r\n  btn,lbl: TJSElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    btn := TJSElement(ElementHandle.firstChild);\r\n\r\n    if Assigned(btn) then\r\n    begin\r\n      if FElementButtonClassName <> '' then\r\n        btn.setAttribute('class',FElementButtonClassName)\r\n      else\r\n        btn.removeAttribute('class');\r\n    end;\r\n\r\n    lbl := TJSElement(ElementHandle.lastElementChild);\r\n\r\n    if Assigned(lbl) then\r\n    begin\r\n      if FElementLabelClassName <> '' then\r\n        lbl.setAttribute('class',FElementLabelClassName)\r\n      else\r\n        lbl.removeAttribute('class');\r\n    end;\r\n\r\n    if not IsLinked then\r\n    begin\r\n      ElementHandle.style.setProperty('user-select','none');\r\n\r\n      if ElementPosition = epAbsolute then\r\n      begin\r\n        if ElementButtonClassName = '' then\r\n        begin\r\n          TJSHTMLElement(btn).style.setProperty('float','left');\r\n          TJSHTMLElement(btn).style.setProperty('height','100%');\r\n          TJSHTMLElement(btn).style.setProperty('vertical-align','middle');\r\n        end;\r\n\r\n        if ElementLabelClassName = '' then\r\n        begin\r\n          lbl := TJSElement(Container.lastElementChild);\r\n          TJSHTMLElement(lbl).style.setProperty('vertical-align','middle');\r\n          TJSHTMLElement(lbl).style.setProperty('min-height','100%');\r\n          TJSHTMLElement(lbl).style.setProperty('height','100%');\r\n          TJSHTMLElement(lbl).style.setProperty('position','absolute');\r\n          TJSHTMLElement(lbl).style.setProperty('overflow','hidden');\r\n          TJSHTMLElement(lbl).style.setProperty('display','inline-flex');\r\n          TJSHTMLElement(lbl).style.setProperty('align-items','center');\r\n        end;\r\n      end;\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.SetChecked(AValue: boolean);\r\nbegin\r\n  FChecked := AValue;\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(GetRadioElement).checked := AValue;\r\nend;\r\n\r\nfunction TRadioButton.GetChecked: boolean;\r\nbegin\r\n  Result := FChecked;\r\n  if Assigned(Container) then\r\n    Result := TJSHTMLInputElement(GetRadioElement).checked;\r\nend;\r\n\r\nfunction TRadioButton.GetRadioElement: TJSHTMLElement;\r\nbegin\r\n  if IsLinked then\r\n    Result := TJSHTMLElement(ElementHandle)\r\n  else\r\n    Result := TJSHTMLElement(Container.firstElementChild);\r\nend;\r\n\r\nprocedure TRadioButton.PersistInHTML;\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  rb := TJSHTMLInputElement(GetRadioElement);\r\n  if (rb.checked) then\r\n    rb.setAttribute('checked','checked')\r\n  else\r\n    rb.removeAttribute('checked');\r\nend;\r\n\r\n{ TListBox }\r\n\r\nprocedure TListBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItems := TStringList.Create;\r\n  TStringList(FItems).OnChange := DoItemsChange;\r\n  FMultiSelect := false;\r\n  FSelected := TList.Create;\r\n  FItemIndex := -1;\r\n  ShowFocus := true;\r\n  Width := 160;\r\n  Height := 180;\r\nend;\r\n\r\nfunction TListBox.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SELECT');\r\n  Result['Size'] := '2';\r\nend;\r\n\r\ndestructor TListBox.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  FSelected.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TListBox.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TListBox.AddItem(Item: string; AObject: TObject);\r\nbegin\r\n  FItems.AddObject(Item, AObject);\r\nend;\r\n\r\nprocedure TListBox.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.onchange := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TListBox.ClearSelection;\r\nvar\r\n  i: integer;\r\nbegin\r\n  ItemIndex := -1;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;  \r\n\r\n  for i := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected := false;\r\nend;\r\n\r\nprocedure TListBox.SelectAll;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;  \r\n\r\n  for i := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n  begin\r\n    Selected[i] := true;\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected := true;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.SetItems(AItems: TStrings);\r\nbegin\r\n  FItems.Assign(AItems);\r\nend;\r\n\r\nfunction TListBox.GetCount: Integer;\r\nbegin\r\n  Result := FItems.Count;\r\nend;\r\n\r\nfunction TListBox.GetElementSelectHandle: TJSHTMLSelectElement;\r\nbegin\r\n  Result := TJSHTMLSelectElement(Container);\r\nend;\r\n\r\nfunction TListBox.GetItemIndex: integer;\r\nbegin\r\n  Result := FItemIndex;\r\n  if Assigned(Container) then\r\n    Result := TJSHTMLSelectElement(Container).selectedIndex;\r\nend;\r\n\r\nprocedure TListBox.PersistinHTML; \r\nvar\r\n  i: integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  for i := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n  begin\r\n    if TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected then\r\n      TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).setAttribute('selected','selected')\r\n    else\r\n      TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).removeAttribute('selected');\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.SetItemHeight(const Value: Integer);\r\nbegin\r\n  FItemHeight := Value;\r\nend;\r\n\r\nprocedure TListBox.SetItemIndex(AIndex: integer);\r\nbegin\r\n  if FItemIndex <> AIndex then\r\n  begin\r\n    FItemIndex := AIndex;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.SetMultiSelect(AValue: boolean);\r\nbegin\r\n  FMultiSelect := AValue;\r\n  if Assigned(Container) then\r\n    TJSHTMLSelectElement(Container).multiple := AValue;\r\nend;\r\n\r\nfunction TListBox.GetSelCount: integer;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := 0;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    for i := 0 to FItems.Count - 1 do\r\n    begin\r\n      if TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected then\r\n        inc(Result);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TListBox.GetSelected(AIndex: integer): boolean;\r\nbegin\r\n  if (AIndex < FSelected.Count) then\r\n    Result := boolean(FSelected.Items[AIndex])\r\n  else\r\n    Result := False;\r\n\r\n  if Assigned(Container) and (AIndex < TJSHTMLSelectElement(Container).options.length) then\r\n    Result := TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[Aindex]).selected;\r\nend;\r\n\r\n\r\nprocedure TListBox.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TListBox.SetSelected(AIndex: integer; AValue: boolean);\r\nbegin  \r\n  while (AIndex >= FSelected.Count) do\r\n    FSelected.Add(false);\r\n\r\n  FSelected.Items[AIndex] := AValue;\r\n\r\n  if Assigned(Container) then\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[Aindex]).selected := AValue;\r\nend;\r\n\r\nprocedure TListBox.SetSorted(const Value: Boolean);\r\nbegin\r\n  FSorted := Value;\r\n  TStringList(Items).Sort;\r\nend;\r\n\r\nprocedure TListBox.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementSelectHandle) then\r\n  begin\r\n    ElementSelectHandle.style.setProperty('overflow', 'auto');\r\n    ElementSelectHandle.selectedIndex := FItemIndex;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementSelectHandle) then\r\n  begin\r\n    ElementSelectHandle.style.setProperty('overflow', 'auto');\r\n    ElementSelectHandle['role'] := 'listbox';\r\n    ElementSelectHandle['aria-busy'] := 'true';\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.DoItemsChange(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TListBox.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  opt: TJSHTMLOptionElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  for i := TJSHTMLSelectElement(Container).options.length - 1 downto 0 do\r\n    TJSHTMLSelectElement(Container).remove(i);\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    opt := TJSHTMLOptionElement.New(FItems[i]);\r\n    opt['role'] := 'listitem';\r\n    TJSHTMLSelectElement(Container).add(opt);\r\n    Selected[i] := false;\r\n  end;\r\n\r\n  UpdateElementData;\r\nend;\r\n\r\nprocedure TListBox.EndUpdate;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\n{ TCustomComboBox }\r\n\r\nprocedure TCustomComboBox.AddItem(Item: string; AObject: TObject);\r\nbegin\r\n  FItems.AddObject(Item, AObject);\r\nend;\r\n\r\nprocedure TCustomComboBox.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.onchange := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.Clear;\r\nbegin\r\n  Items.Clear;\r\nend;\r\n\r\nprocedure TCustomComboBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItems := TStringList.Create;\r\n  TStringList(FItems).OnChange := DoItemsChange;\r\n  FItemIndex := -1;\r\n  ShowFocus := true;\r\n  Height := 25;\r\nend;\r\n\r\nfunction TCustomComboBox.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SELECT');\r\nend;\r\n\r\ndestructor TCustomComboBox.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomComboBox.SetItems(AItems: TStrings);\r\nbegin\r\n  FItems.Assign(AItems);\r\nend;\r\n\r\nprocedure TCustomComboBox.SetStyle(const Value: TComboBoxStyle);\r\nbegin\r\n  FStyle := Value;\r\nend;\r\n\r\nprocedure TCustomComboBox.SetText(const Value: string);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    if Value = Items[I] then\r\n      ItemIndex := I;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementSelectHandle) then\r\n  begin\r\n    ElementSelectHandle.selectedIndex := FItemIndex;\r\n    ElementSelectHandle['role'] := 'combobox';\r\n  end;\r\nend;\r\n\r\nfunction TCustomComboBox.GetElementSelectHandle: TJSHTMLSelectElement;\r\nbegin\r\n  Result := TJSHTMLSelectElement(Container);\r\nend;\r\n\r\nfunction TCustomComboBox.GetItemIndex: integer;\r\nbegin\r\n  Result := FItemIndex;\r\n  if Assigned(Container) then\r\n    Result := TJSHTMLSelectElement(Container).selectedIndex;\r\nend;\r\n\r\nfunction TCustomComboBox.GetText: string;\r\nbegin\r\n  if ItemIndex >= 0 then\r\n    Result := Items[ItemIndex]\r\n  else\r\n    Result := '';\r\nend;\r\n\r\nprocedure TCustomComboBox.Change;\r\nbegin\r\n  FItemIndex := GetItemIndex;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TCustomComboBox.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomComboBox.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TCustomComboBox.PersistinHTML;\r\nvar\r\n  sel: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  sel := TJSHTMLElement(ElementHandle.children[ItemIndex]);\r\n  if Assigned(sel) then\r\n    sel.setAttribute('selected','selected');\r\nend;\r\n\r\nprocedure TCustomComboBox.SetDroppedDown(const Value: Boolean);\r\nbegin\r\n  FDroppedDown := Value;\r\nend;\r\n\r\nprocedure TCustomComboBox.SetItemIndex(AIndex: integer);\r\nbegin\r\n  if FItemIndex <> AIndex then\r\n  begin\r\n    FItemIndex := AIndex;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.DoItemsChange(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TCustomComboBox.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  s: string;\r\n  opt: TJSElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  for i := TJSHTMLSelectElement(Container).options.length - 1 downto 0 do\r\n    TJSHTMLSelectElement(Container).remove(i);\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    s := FItems[i];\r\n    opt := document.createElement('OPTION');\r\n    opt['value'] := s;\r\n    opt.innerHTML := s;\r\n    Container.appendChild(opt);\r\n  end;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\n\r\n{ TFontPicker }\r\n\r\nprocedure TFontPicker.CreateInitialize;\r\nvar\r\n  tst: boolean;\r\n  \r\n  procedure Add(s: string);\r\n  begin\r\n    asm\r\n      tst = d.detect(s);\r\n    end;\r\n    if tst then\r\n      Self.Items.Add(s);\r\n  end;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  asm\r\n    var Detector = function() {\r\n    // a font will be compared against all the three default fonts.\r\n    // and if it doesn't match all 3 then that font is not available.\r\n    var baseFonts = ['monospace', 'sans-serif', 'serif'];\r\n\r\n    //we use m or w because these two characters take up the maximum width.\r\n    // And we use a LLi so that the same matching fonts can get separated\r\n    var testString = \"mmmmmmmmmmlli\";\r\n\r\n    //we test using 72px font size, we may use any size. I guess larger the better.\r\n    var testSize = '72px';\r\n\r\n    var h = document.getElementsByTagName(\"body\")[0];\r\n\r\n    // create a SPAN in the document to get the width of the text we use to test\r\n    var s = document.createElement(\"span\");\r\n    s.style.fontSize = testSize;\r\n    s.innerHTML = testString;\r\n    var defaultWidth = {};\r\n    var defaultHeight = {};\r\n    for (var index in baseFonts) {\r\n        //get the default width for the three base fonts\r\n        s.style.fontFamily = baseFonts[index];\r\n        h.appendChild(s);\r\n        defaultWidth[baseFonts[index]] = s.offsetWidth; //width for the default font\r\n        defaultHeight[baseFonts[index]] = s.offsetHeight; //height for the defualt font\r\n        h.removeChild(s);\r\n    }\r\n\r\n    function detect(font) {\r\n        var detected = false;\r\n        for (var index in baseFonts) {\r\n            s.style.fontFamily = font + ',' + baseFonts[index]; // name of the font along with the base font for fallback.\r\n            h.appendChild(s);\r\n            var matched = (s.offsetWidth != defaultWidth[baseFonts[index]] || s.offsetHeight != defaultHeight[baseFonts[index]]);\r\n            h.removeChild(s);\r\n            detected = detected || matched;\r\n        }\r\n        return detected;\r\n    }\r\n\r\n    this.detect = detect;\r\n    };\r\n\r\n    var d = new Detector();\r\n    //tst = d.detect(\"Arial\");\r\n  end;\r\n\r\n  Add('Arial');\r\n  Add('Arial Black');\r\n  Add('Arial Narrow');\r\n  Add('Courier');\r\n  Add('Courier New');\r\n  Add('Georgia');\r\n  Add('Lucida Console');\r\n  Add('Modena');\r\n  Add('Monotype Corsiva');\r\n  Add('Papyrus');\r\n  Add('Tahoma');\r\n  Add('Times');\r\n  Add('Times New Roman');\r\n  Add('Trebuchet MS');\r\n  Add('Verdana');\r\n  Add('Verona');\r\nend;\r\n\r\n{ TFontSizePicker }\r\n\r\nprocedure TFontSizePicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  PickerMode := fmPointSize;\r\nend;\r\n\r\nprocedure TFontSizePicker.Init;\r\nbegin\r\n  Items.Clear;\r\n\r\n  case PickerMode of\r\n    fmPointSize:\r\n    begin\r\n      Items.Add('8');\r\n      Items.Add('9');\r\n      Items.Add('10');\r\n      Items.Add('11');\r\n      Items.Add('12');\r\n      Items.Add('14');\r\n      Items.Add('16');\r\n      Items.Add('18');\r\n      Items.Add('20');\r\n      Items.Add('22');\r\n      Items.Add('24');\r\n      Items.Add('26');\r\n      Items.Add('28');\r\n      Items.Add('36');\r\n      Items.Add('48');\r\n      Items.Add('72');\r\n    end;\r\n    fmRelativeSize:\r\n    begin\r\n      Items.Add('8');\r\n      Items.Add('9');\r\n      Items.Add('10');\r\n      Items.Add('14');\r\n      Items.Add('18');\r\n      Items.Add('24');\r\n      Items.Add('36');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TFontSizePicker.SetPickerMode(const AValue: TFontSizePickerMode);\r\nbegin\r\n  FPickerMode := AValue;\r\n  Init;\r\nend;\r\n\r\n\r\n{ TCustomMemo }\r\n\r\nfunction TCustomMemo.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomMemo.DoHandleCut(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  if not CanCut then\r\n  begin\r\n    asm\r\n      Event.preventDefault();\r\n      Event.stopPropagation();\r\n    end;\r\n  end;\r\n\r\n  Result := False;\r\nend;\r\n\r\nprocedure TCustomMemo.BindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.oninput := DoHandleInput;\r\n    ElementInputHandle.onchange := DoHandleChange;\r\n    ElementInputHandle.addEventListener('paste', FHandlePastePtr);\r\n    ElementInputHandle.addEventListener('cut', FHandleCutPtr);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TCustomMemo.Clear;\r\nbegin\r\n  Lines.Clear;\r\nend;\r\n\r\nprocedure TCustomMemo.ClearMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandlePastePtr := nil;\r\n  FHandleCutPtr := nil;\r\nend;\r\n\r\nprocedure TCustomMemo.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FLines := TStringList.Create;\r\n  TStringList(FLines).OnChange := DoLinesChange;\r\n  Width := 400;\r\n  Height := 300;\r\n  ShowFocus := true;\r\n  ClipChildren := false;\r\n  FWantTabs := false;\r\n  FWordWrap := true;\r\nend;\r\n\r\nfunction TCustomMemo.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('TEXTAREA');\r\nend;\r\n\r\ndestructor TCustomMemo.Destroy;\r\nbegin\r\n  FLines.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TCustomMemo.DoHandleInput(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  GetText;\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomMemo.DoHandlePaste(Event: TEventListenerEvent): Boolean;\r\nvar\r\n  s: string;\r\nbegin\r\n  asm\r\n    var clipboardData = Event.clipboardData || window.clipboardData;\r\n    s = clipboardData.getData('Text');\r\n  end;\r\n\r\n  if not CanPaste(s) then\r\n  begin\r\n    asm\r\n      Event.preventDefault();\r\n      Event.stopPropagation();\r\n    end;\r\n  end;\r\n\r\n  Result:= false;\r\nend;\r\n\r\nprocedure TCustomMemo.DoLinesChange(Sender: TObject);\r\nbegin\r\n  if Assigned(ElementInputHandle) and not FBlockChange then\r\n  begin\r\n    ElementInputHandle.value := GetDisplayText;\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n   end;\r\nend;\r\n\r\nfunction TCustomMemo.CanCut: boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomMemo.CanPaste(AValue: string): boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomMemo.SetAutoSize(const Value: Boolean);\r\nbegin\r\n  if FAutoSize <> Value then\r\n  begin\r\n    FAutoSize := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetLines(ALines: TStrings);\r\nbegin\r\n  FLines.Assign(ALines);\r\nend;\r\n\r\nprocedure TCustomMemo.SetReadOnly(const Value: boolean);\r\nbegin\r\n  if (FReadOnly <> Value) then\r\n  begin\r\n    FReadOnly := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetSelLength(const Value: Integer);\r\nbegin\r\n  if FSelLength <> Value then\r\n  begin\r\n    FSelLength := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetSelStart(const Value: Integer);\r\nbegin\r\n  if FSelStart <> Value then\r\n  begin\r\n    FSelStart := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetText(const Value: String);\r\nbegin\r\n  FLines.Text := Value;\r\nend;\r\n\r\nprocedure TCustomMemo.SetTextHint(const Value: string);\r\nbegin\r\n  if FTextHint <> Value then\r\n  begin\r\n    FTextHint := Value;\r\n    UpdateElement;\r\n  end;\r\n\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TCustomMemo.UpdateElementData;\r\nvar\r\n  ss,sl: integer;\r\n  e: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) and not FBlockChange then\r\n  begin\r\n    ElementInputHandle.value := GetDisplayText;\r\n    ElementInputHandle.setSelectionRange(SelStart, SelStart + SelLength);\r\n    if not IsLinked then\r\n      ElementInputHandle.style.setProperty('resize', 'none');\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n\r\n    if TextHint <> '' then\r\n      ElementInputHandle.placeholder := TextHint;\r\n\r\n    if not isLinked then\r\n    begin\r\n      ss := FSelStart;\r\n      sl := FSelStart + FSelLength;\r\n      e := ElementInputHandle;\r\n      asm\r\n        setTimeout(function() {\r\n          e.setSelectionRange(ss, sl);\r\n        }, 1);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TCustomMemo.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) and not FBlockChange and not IsLinked then\r\n  begin\r\n    ElementInputHandle.style.setProperty('overflow', 'auto');\r\n    ElementInputHandle.style.setProperty('margin', '0');\r\n    ElementInputHandle.style.setProperty('padding', '0');\r\n\r\n    if (Color <> clNone) then\r\n      ElementInputHandle.style.setProperty('background-color', ColorToHtml(Color))\r\n    else\r\n      ElementInputHandle.style.removeProperty('background-color');\r\n  end;\r\nend;\r\n\r\nfunction TCustomMemo.GetText: String;\r\nbegin\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    FBlockChange := True;\r\n    FLines.Text := ElementInputHandle.value;\r\n    FBlockChange := False;\r\n  end;\r\n\r\n  Result := FLines.Text;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TCustomMemo.HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if (GetKeyCode(Event.Key) = 9) and WantTabs then\r\n  begin\r\n    eh := ElementInputHandle;\r\n\r\n    asm\r\n      var sstart = eh.selectionStart;\r\n      var send = eh.selectionEnd;\r\n\r\n      eh.value = eh.value.substring(0, sstart) + \"\\t\" +eh.value.substring(send);\r\n      // put caret at right position again\r\n      eh.selectionStart = eh.selectionEnd = sstart + 1;\r\n\r\n      Event.stopPropagation();\r\n      Event.preventDefault();\r\n    end;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction TCustomMemo.IsReadOnly: boolean;\r\nbegin\r\n  Result := FReadOnly;\r\nend;\r\n\r\nprocedure TCustomMemo.PersistinHTML;\r\nbegin\r\n  ElementInputHandle.innerHTML := Lines.Text;\r\nend;\r\n\r\nfunction TCustomMemo.GetDisplayText: string;\r\nbegin\r\n  Result := FLines.Text;\r\nend;\r\n\r\nfunction TCustomMemo.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nprocedure TCustomMemo.GetMethodPointers;\r\nbegin\r\n  inherited;\r\n  FHandlePastePtr := @DoHandlePaste;\r\n  FHandleCutPtr := @DoHandleCut;\r\nend;\r\n\r\nfunction TCustomMemo.GetSelLength: Integer;\r\nbegin\r\n  Result := ElementInputHandle.selectionEnd - ElementInputHandle.selectionStart;\r\nend;\r\n\r\nfunction TCustomMemo.GetSelStart: Integer;\r\nbegin\r\n  Result := ElementInputHandle.selectionStart;\r\nend;\r\n\r\n{ TControlGroup }\r\n\r\nprocedure TControlGroup.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FColumns := 1;\r\n  FControls := TList.Create;\r\n  FItems := TStringList.Create;\r\n  TStringList(FItems).OnChange := DoItemsChange;\r\n  BorderWidth := 2;\r\n  FOldCount := -1;\r\n  Width := 200;\r\n  Height := 200;\r\nend;\r\n\r\nprocedure TControlGroup.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TControlGroup.CreateGroupControl(ALeft, ATop, AIndex: integer;\r\n  ACaption: string; AState, AEnabled: boolean): TCustomControl;\r\nbegin\r\n  //\r\n  Result := nil;\r\nend;\r\n\r\nfunction TControlGroup.CreateElement: TJSElement;\r\nvar\r\n  legend: TJSElement;\r\nbegin\r\n  Result := document.createElement('FIELDSET');\r\n  legend := document.createElement('LEGEND');\r\n  Result.appendChild(legend);\r\n  legend.innerHTML := Caption;\r\n\r\n  if Caption = '' then\r\n    TJSHTMLElement(legend).style.setProperty('display', 'none')\r\n  else\r\n    TJSHTMLElement(legend).style.setProperty('display', '');\r\n\r\n  TJSHTMLElement(Result).style.setProperty('display', 'inline-block');\r\n\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-before','0px');\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-after','0px');\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-end','0px');\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-start','0px');\r\n  TJSHTMLElement(Result).style.setProperty('border','1px');\r\nend;\r\n\r\ndestructor TControlGroup.Destroy;\r\nbegin\r\n  FControls.Free;\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TControlGroup.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TControlGroup.SetCaption(const AValue: string);\r\nbegin\r\n  inherited SetCaption(AValue);\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  Container.firstElementChild.innerHTML := AValue;\r\n\r\n  if AValue = '' then\r\n    TJSHTMLElement(Container.firstElementChild).style.setProperty('display', 'none')\r\n  else\r\n    TJSHTMLElement(Container.firstElementChild).style.setProperty('display', '');\r\nend;\r\n\r\nprocedure TControlGroup.SetColumns(AValue: integer);\r\nbegin\r\n  if (FColumns > 0) and (FColumns <> AValue) then\r\n  begin\r\n    FColumns := AValue;\r\n    DoUpdateList;\r\n  end;\r\nend;\r\n\r\nprocedure TControlGroup.SetHeight(AValue: Integer);\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TControlGroup.SetItems(AItems: TStrings);\r\nbegin\r\n  FItems.Assign(AItems);\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TControlGroup.SetWidth(AValue: Integer);\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nfunction TControlGroup.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TControlGroup.DoHandleClick(AControl: TCustomControl);\r\nbegin\r\n  Change;\r\nend;\r\n\r\nprocedure TControlGroup.DoItemsChange(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TControlGroup.DoControlClick(Sender: TObject);\r\nbegin\r\n  DoHandleClick((Sender as TCustomControl));\r\nend;\r\n\r\nprocedure TControlGroup.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  s: string;\r\n  rd: TCustomControl;\r\n  dx,dy,dc,col,row: integer;\r\n  legend: TJSElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if FItems.Count = 0 then\r\n    Exit;\r\n\r\n  dy := Font.Size * 3;\r\n  dx := Width div FColumns;\r\n  if Caption <> '' then\r\n    dc := dy\r\n  else\r\n    dc := 4;\r\n  col := 0;\r\n  row := 0;\r\n\r\n  for i := 0 to FOldCount - 1 do\r\n  begin\r\n    rd := TCustomControl(FControls[i]);\r\n    rd.Free;\r\n  end;\r\n  FControls.Clear;\r\n\r\n  while Container.childElementCount > 0 do\r\n    Container.removeChild(Container.firstChild);\r\n\r\n  if Caption <> '' then\r\n  begin\r\n    legend := document.createElement('LEGEND');\r\n    ElementHandle.appendChild(legend);\r\n    legend.innerHTML := Caption;\r\n  end;\r\n\r\n  if ElementGroupClassName <> '' then\r\n    ElementHandle.setAttribute('class', ElementGroupClassName)\r\n  else\r\n    ElementHandle.removeAttribute('class');\r\n\r\n  TJSHTMLElement(Container).style.setProperty('margin','0px');\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    s := FItems[i];\r\n    rd := CreateGroupControl(4 + col * dx, dc + row * dy, i, s, GetGroupControlState(i), true);\r\n    FControls.Add(rd);\r\n\r\n    if not IsLinked then\r\n    begin\r\n      TJSHTMLElement(rd.Container).style.setProperty('float', 'left');\r\n      TJSHTMLElement(rd.Container).style.setProperty('width',  IntToStr(Trunc(100 / FColumns)) + '%');\r\n    end;\r\n\r\n    if i mod FColumns = 0 then\r\n      TJSHTMLElement(rd.Container).style.setProperty('clear', 'left');\r\n\r\n    ElementHandle.appendChild(rd.Container);\r\n\r\n    if col < FColumns - 1 then\r\n      inc(col)\r\n    else\r\n    begin\r\n      col := 0;\r\n      inc(row);\r\n    end;\r\n  end;\r\n\r\n  FOldCount := Items.Count;\r\nend;\r\n\r\nprocedure TControlGroup.EndUpdate;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\n\r\nfunction TControlGroup.GetGroupControl(AIndex: integer): TCustomControl;\r\nbegin\r\n  Result := TCustomControl(FControls[AIndex]);\r\nend;\r\n\r\nfunction TControlGroup.GetGroupControlState(AIndex: integer): boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nfunction TRadioGroup.CreateGroupControl(ALeft, ATop, AIndex: integer;\r\n  ACaption: string; AState, AEnabled: boolean): TCustomControl;\r\nvar\r\n  rd: TRadioButton;\r\nbegin\r\n  rd := TRadioButton.Create(GetID + IntToStr(AIndex));\r\n  rd.ElementPosition := ElementPosition;\r\n  rd.ElementFont := ElementFont;\r\n  rd.ElementClassName := ElementClassName;\r\n  rd.ElementButtonClassName := ElementButtonClassName;\r\n  rd.ElementLabelClassName := ElementLabelClassName;\r\n  rd.ParentFont := false;\r\n  rd.Font.Assign(Font);\r\n  rd.Parent := Self;\r\n  rd.Caption := ACaption;\r\n  rd.GroupName := GetID;\r\n  rd.Top := ATop; //dc + row * dy;\r\n  rd.Left := ALeft; //4 + col * dx;\r\n  rd.WidthStyle := ssAuto;\r\n  rd.WidthPercent := 100;\r\n  rd.OnClick := DoControlClick;\r\n  rd.Checked := AState;\r\n  rd.Enabled := AEnabled;\r\n  rd.Tag := AIndex;\r\n  rd.TabStop := true;\r\n  Result := rd;\r\nend;\r\n\r\nprocedure TRadioGroup.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItemIndex := -1;\r\n  FOldItemIndex := -2;\r\nend;\r\n\r\nprocedure TRadioGroup.DoHandleClick(AControl: TCustomControl);\r\nbegin\r\n  if ItemIndex = FOldItemIndex then\r\n    Exit;\r\n\r\n  Change;\r\n\r\n  FOldItemIndex := ItemIndex;\r\nend;\r\n\r\nfunction TRadioGroup.GetGroupControlState(AIndex: integer): boolean;\r\nbegin\r\n  Result := AIndex = FItemIndex;\r\nend;\r\n\r\nfunction TRadioGroup.GetItemIndex: integer;\r\nvar\r\n  el: TJSElement;\r\n  i: integer;\r\nbegin\r\n  Result := FItemIndex;\r\n\r\n  for i := 0 to FItems.Count -1 do\r\n  begin\r\n    el := document.getElementByID(GetID + IntToStr(i) + 'rd');\r\n    if Assigned(el) then\r\n    begin\r\n      if TJSHTMLInputElement(el).checked then\r\n        Result := i;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TRadioGroup.SetFocus;\r\nvar\r\n  idx: integer;\r\n  rd: TRadioButton;\r\nbegin\r\n  idx := ItemIndex;\r\n  if idx < 0 then\r\n    idx := 0;\r\n\r\n  rd := TRadioButton(GetGroupControl(idx));\r\n  if Assigned(rd) then\r\n    rd.SetFocus;\r\nend;\r\n\r\nprocedure TRadioGroup.SetItemIndex(AIndex: integer);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  // clear selection\r\n  if (AIndex = -1) and (FItemIndex >= 0) then\r\n  begin\r\n    el := document.getElementByID(GetID + IntToStr(FItemIndex) + 'rd');\r\n    if Assigned(el) then\r\n      TJSHTMLInputElement(el).checked := False;\r\n  end\r\n  else\r\n  begin\r\n    // new selection\r\n    FItemIndex := AIndex;\r\n    if (AIndex >= 0) and (AIndex < Items.Count) then\r\n    begin\r\n      el := document.getElementByID(GetID + IntToStr(AIndex) + 'rd');\r\n      if Assigned(el) then\r\n        TJSHTMLInputElement(el).checked := True;\r\n    end;\r\n  end;\r\nend;\r\n\r\n\r\n\r\n{ TColorPicker }\r\n\r\nprocedure TColorPicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FColor := clBlack;\r\nend;\r\n\r\nprocedure TColorPicker.BindEvents; \r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.oninput := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nfunction TColorPicker.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nprocedure TColorPicker.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('padding','0px'); \r\n    ElementHandle.style.setProperty('width', IntToStr(Width - 2) + 'px');\r\n    ElementHandle.style.setProperty('height',IntToStr(Height - 2) + 'px');\r\n  end;\r\nend;\r\n\r\nfunction TColorPicker.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin   \r\n  Select;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TColorPicker.Select;\r\nbegin\r\n  if Assigned(OnSelect) then\r\n    OnSelect(Self);\r\nend;\r\n\r\nfunction TColorPicker.GetColor: TColor;\r\nbegin\r\n  Result := FColor;\r\n\r\n  if Assigned(Container) then\r\n    Result := HexToColor(TJSHTMLInputElement(Container).value);\r\nend;\r\n\r\nprocedure TColorPicker.SetColor(AValue: TColor);\r\nbegin\r\n  FColor := AValue;\r\n\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(Container).value := ColorToHTML(AValue);\r\nend;\r\n\r\nfunction TColorPicker.GetInputType: string;\r\nbegin \r\n  Result := 'COLOR';\r\nend;\r\n\r\n{ TScrollBar }\r\n\r\nprocedure TScrollBar.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  TabStop := True;\r\n  FKind := sbHorizontal;\r\n  FPosition := 0;\r\n  FMin := 0;\r\n  FMax := 100;\r\n  FSmallChange := 1;\r\n  FLargeChange := 1;\r\n\r\n  FContent := TScrollBarContent.Create(Self);\r\n  FContent.Parent := Self;\r\n  FContent.Width := 121;\r\n  FContent.Height := 17;\r\n\r\n  Width := 121;\r\n  Height := 17;\r\n\r\n  UpdateContent;\r\nend;\r\n\r\nprocedure TScrollBar.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle.onscroll := @DoScroll;\r\nend;\r\n\r\nfunction TScrollBar.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\ndestructor TScrollBar.Destroy;\r\nbegin\r\n  FContent.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TScrollBar.DoScroll(Event: TJSUIEvent): Boolean;\r\nbegin\r\n  FScrolling := True;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\n\r\n  FScrolling := False;\r\n  Result := True;\r\nend;\r\n\r\nfunction TScrollBar.GetPageSize: Integer;\r\nbegin\r\n  Result := FPageSize;\r\n  if Result = 0 then\r\n    Result := 25;\r\nend;\r\n\r\nfunction TScrollBar.GetValue(XYPos: Double): Double;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(FContent) then\r\n  begin\r\n    case Kind of\r\n      sbHorizontal: Result := (XYPos / FContent.Width) * (Max - Min);\r\n      sbVertical: Result := (XYPos / FContent.Height) * (Max - Min);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TScrollBar.GetPosition: Integer;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(Element) then\r\n  begin\r\n    case Kind of\r\n      sbHorizontal: Result := Round(GetValue(Element.scrollLeft));\r\n      sbVertical: Result := Round(GetValue(Element.scrollTop));\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.Loaded;\r\nbegin\r\n  inherited;\r\n  UpdateContent;\r\nend;\r\n\r\nprocedure TScrollBar.SetBounds(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  inherited;\r\n  UpdateContent;\r\nend;\r\n\r\nprocedure TScrollBar.SetKind(const Value: TScrollBarKind);\r\nbegin\r\n  if FKind <> Value then\r\n  begin\r\n    FKind := Value;\r\n//    if not (csLoading in ComponentState) then\r\n    begin\r\n      case Kind of\r\n        sbHorizontal:\r\n        begin\r\n          SetBounds(Left, Top, Height, 17)\r\n        end;\r\n        sbVertical:\r\n        begin\r\n          SetBounds(Left, Top, 17, Width)\r\n        end;\r\n      end;\r\n    end;\r\n    UpdateElement;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetMax(const Value: Integer);\r\nbegin\r\n  if FMax <> Value then\r\n  begin\r\n    FMax := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetMin(const Value: Integer);\r\nbegin\r\n  if FMin <> Value then\r\n  begin\r\n    FMin := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetPageSize(const Value: Integer);\r\nbegin\r\n  if FPageSize <> Value then\r\n  begin\r\n    FPageSize := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetPosition(const Value: Integer);\r\nbegin\r\n  if FPosition <> Value then\r\n  begin\r\n    FPosition := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('overflow', 'auto');\r\n    case Kind of\r\n      sbHorizontal:\r\n      begin\r\n        ElementHandle.style.setProperty('overflow-y', 'hidden');\r\n        ElementHandle.style.setProperty('overflow-x', '');\r\n      end;\r\n      sbVertical:\r\n      begin\r\n        ElementHandle.style.setProperty('overflow-y', '');\r\n        ElementHandle.style.setProperty('overflow-x', 'hidden');\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.UpdateContent;\r\nvar\r\n  x, y, w, h: Integer;\r\n  ps: Integer;\r\n  v: Single;\r\nbegin\r\n  if not Assigned(FContent) or not Assigned(ElementHandle) or FScrolling then\r\n    Exit;\r\n\r\n  ps := PageSize;\r\n  v := (Max - Min) / ps;\r\n\r\n  case Kind of\r\n    sbHorizontal:\r\n    begin\r\n      y := 0;\r\n      h := Height;\r\n      w := Round(v * Width);\r\n      x := Round(((FPosition - Min) / (Max - Min)) * w);\r\n    end;\r\n    sbVertical:\r\n    begin\r\n      x := 0;\r\n      w := Width;\r\n      h := Round(v * Height);\r\n      y := Round(((FPosition - Min) / (Max - Min)) * h);\r\n    end;\r\n  end;\r\n\r\n  FContent.SetBounds(0, 0, w, h);\r\n  ElementHandle.scrollLeft := x;\r\n  ElementHandle.scrollTop := y;\r\nend;\r\n\r\n{ TScrollBarContent }\r\n\r\nfunction TScrollBarContent.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\n{ TCheckGroup }\r\n\r\nfunction TCheckGroup.CreateGroupControl(ALeft, ATop, AIndex: integer;\r\n  ACaption: string; AState, AEnabled: boolean): TCustomControl;\r\nvar\r\n  cb: TCheckBox;\r\nbegin\r\n  cb := TCheckBox.Create(GetID + IntToStr(AIndex));\r\n  cb.Caption := ACaption;\r\n  cb.ElementPosition := ElementPosition;\r\n  cb.ElementFont := ElementFont;\r\n  cb.ElementClassName := ElementClassName;\r\n  cb.ElementButtonClassName := ElementButtonClassName;\r\n  cb.ElementLabelClassName := ElementLabelClassName;\r\n  cb.ParentFont := false;\r\n  cb.Font.Assign(Font);\r\n  cb.Parent := Self;\r\n  cb.Top := ATop;\r\n  cb.Left := ALeft;\r\n  cb.WidthStyle := ssPercent;\r\n  cb.WidthPercent := 100;\r\n  cb.OnClick := DoControlClick;\r\n  cb.Checked := AState;\r\n  cb.Enabled := AEnabled;\r\n  cb.Tag := AIndex;\r\n  cb.TabStop := true;\r\n  Result := cb;\r\nend;\r\n\r\nprocedure TCheckGroup.CreateInitialize;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCheckGroup.DoHandleClick(AControl: TCustomControl);\r\nbegin\r\n  inherited;\r\n  if Assigned(OnCheckClick) then\r\n    OnCheckClick(Self, AControl.Tag);\r\nend;\r\n\r\nfunction TCheckGroup.GetChecked(AIndex: integer): boolean;\r\nbegin\r\n  Result := (GetGroupControl(AIndex) as TCheckBox).Checked;\r\nend;\r\n\r\nfunction TCheckGroup.GetGroupControlState(AIndex: integer): boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nprocedure TCheckGroup.SetChecked(AIndex: integer; const Value: boolean);\r\nbegin\r\n  (GetGroupControl(AIndex) as TCheckBox).Checked := Value;\r\nend;\r\n\r\nprocedure TCheckGroup.SetFocus;\r\nvar\r\n  cb: TCheckBox;\r\nbegin\r\n  if Items.Count > 0 then\r\n  begin\r\n    cb := TCheckBox(GetGroupControl(0));\r\n    if Assigned(cb) then\r\n      cb.SetFocus;\r\n  end;\r\nend;\r\n\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.ExtCtrls;\r\n\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, Types, WEBLib.Controls, WEBLib.StdCtrls, WEBLib.Graphics,\r\n  Web, WEBLib.WebTools;\r\n\r\ntype\r\n  TCustomLinkLabel = class(TCustomLabel)\r\n  private\r\n    FDisplText: string;\r\n    FOnLinkClick: TLinkClickEvent;\r\n    FWidthStyle: TSizeStyle;\r\n    FHeightPercent: TPercentSize;\r\n    FHeightStyle: TSizeStyle;\r\n    FWidthPercent: TPercentSize;\r\n    procedure SetHeightPercent(const Value: TPercentSize); reintroduce;\r\n    procedure SetHeightStyle(const Value: TSizeStyle); reintroduce;\r\n    procedure SetWidthPercent(const Value: TPercentSize); reintroduce;\r\n    procedure SetWidthStyle(const Value: TSizeStyle); reintroduce;\r\n  protected\r\n    function GetOuterWidth: integer; override;\r\n    function GetOuterHeight: integer; override;\r\n    function GetDisplayText: string; override;\r\n\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure BindEvents; override;\r\n    function DoLinkClick(Event: TJSMouseEvent): boolean;\r\n  public\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n  published\r\n    property Align;\r\n    property Alignment;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property Caption;\r\n    property Color;\r\n    property EllipsisPosition;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property Layout;\r\n    property Left;\r\n    property Margins;\r\n    property ShowHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WordWrap;\r\n\r\n    property HeightStyle: TSizeStyle read FHeightStyle write SetHeightStyle default ssAbsolute;\r\n    property WidthStyle: TSizeStyle read FWidthStyle write SetWidthStyle default ssAbsolute;\r\n    property HeightPercent: TPercentSize read FHeightPercent write SetHeightPercent default 100;\r\n    property WidthPercent: TPercentSize read FWidthPercent write SetWidthPercent default 100;\r\n\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnLinkClick: TLinkClickEvent read FOnLinkClick write FOnLinkClick;\r\n  end;\r\n\r\n  TLinkLabel = class(TCustomLinkLabel)\r\n  published\r\n    property Caption;\r\n    property ParentFont;\r\n  end;\r\n\r\n  TWebLinkLabel = class(TLinkLabel);\r\n\r\n  TTrackBarOrientation = (trHorizontal, trVertical);\r\n\r\n  TTrackBar = class(TCustomInput)\r\n  private\r\n    FMax: integer;\r\n    FMin: integer;\r\n    FPosition: integer;\r\n    FOnChange: TNotifyEvent;\r\n    FOrientation: TTrackBarOrientation;\r\n    procedure SetOrientation(const Value: TTrackBarOrientation);\r\n  protected\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    function GetInputType: string; override;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure BindEvents; override;\r\n    procedure SetMax(AValue: integer);\r\n    procedure SetMin(AValue: integer);\r\n    procedure SetPosition(AValue: integer);\r\n    function GetPosition: integer;\r\n    procedure DoUpdate;\r\n    procedure Change; virtual;\r\n    procedure CreateControl; override;\r\n    procedure UpdateElementVisual; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Left;\r\n    property Margins;\r\n    property Max: integer read FMax write SetMax default 10;\r\n    property Min: integer read FMin write SetMin default 0;\r\n    property Orientation: TTrackBarOrientation read FOrientation write SetOrientation default trHorizontal;\r\n    property Position: integer read GetPosition write SetPosition default 0;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TWebTrackBar = class(TTrackBar);\r\n\r\n  TTimer = class(TComponent)\r\n  private\r\n    FInterval: integer;\r\n    FTimerID: integer;\r\n    FOnTimer: TNotifyEvent;\r\n    FEnabled: boolean;\r\n  protected\r\n    procedure SetEnabled(Value: Boolean); virtual;\r\n    procedure SetInterval(AValue: integer);\r\n    procedure DoTimer;\r\n    procedure DoUpdateTimer;\r\n    procedure DoClearTimer;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Enabled: boolean read FEnabled write SetEnabled default True;\r\n    property Interval: integer read FInterval write SetInterval default 1000;\r\n    property OnTimer: TNotifyEvent read FOnTimer write FOnTimer;\r\n  end;\r\n\r\n  TWebTimer = class(TTimer);\r\n\r\n  TGeolocationEvent = procedure(Sender: TObject; Lat,Lon,Alt:double) of object;\r\n\r\n  TGeoLocation = class(TCustomControl)\r\n  private\r\n    FOnGeolocation: TGeolocationEvent;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure DoHandleGeolocation(APosition: TJSPosition);\r\n  public\r\n    function HasGeolocation: boolean;\r\n    procedure GetGeolocation;\r\n  published\r\n    property OnGeolocation: TGeolocationEvent read FOnGeolocation write FOnGeolocation;\r\n  end;\r\n\r\n  TWebGeoLocation = class(TGeoLocation);\r\n\r\n  TPaintBox = class(TGraphicControl)\r\n  private\r\n    FOnPaint: TNotifyEvent;\r\n  protected\r\n    procedure Paint; override;\r\n    procedure UpdateElementVisual; override;\r\n  public\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Margins;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnMouseWheel;\r\n    property OnPaint: TNotifyEvent read FOnPaint write FOnPaint;\r\n    property OnTouchStart;\r\n    property OnTouchMove;\r\n    property OnTouchEnd;\r\n  end;\r\n\r\n  TWebPaintBox = class(TPaintBox);\r\n\r\n  TCustomImageControl = class(TCustomControl)\r\n  private\r\n    FURL: string;\r\n    FPicture: TURLPicture;\r\n    FAutoSize: boolean;\r\n    FOnLoaded: TNotifyEvent;\r\n    procedure SetURL(AURL: string);\r\n    function GetBase64Img: string;\r\n  protected\r\n    function HandleDoDrag(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragEnd(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragExit(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragOver(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragStart(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDrop(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleImageLoad(aEvent: TJSEvent): boolean; virtual;\r\n\r\n    procedure SetPicture(const Value: TURLPicture);\r\n    procedure PictureChanged(Sender: TObject);\r\n    procedure PictureDataChanged(Sender: TObject);\r\n    procedure BindEvents; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure SetContainerURL(AURL: string);\r\n    property Picture: TURLPicture read FPicture write SetPicture;\r\n    property URL: string read FURL write SetURL;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    function DataURL: string; overload;\r\n    function DataURL(AWidth, AHeight: integer): string; overload;\r\n    procedure ResizeImage; overload;\r\n    procedure ResizeImage(AWidth, AHeight: integer); overload;\r\n    property Base64Image: string read GetBase64Img;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize: boolean read FAutoSize write FAutoSize default false;\r\n    property ChildOrder;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Margins;\r\n    property ShowHint;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnLoaded: TNotifyEvent read FOnLoaded write FOnLoaded;\r\n  end;\r\n\r\n  TImageControl = class(TCustomImageControl)\r\n  published\r\n    property Picture;\r\n    property URL;\r\n  end;\r\n\r\n  TWebImageControl = class(TImageControl);\r\n\r\n  TImageZoomControl = class;\r\n\r\n  TImageZoomAppearance = class(TPersistent)\r\n  private\r\n    FOwner: TImageZoomControl;\r\n    FHeightPercent: Integer;\r\n    FWidthPercent: Integer;\r\n    FResponsiveHeightPercent: Integer;\r\n    FResponsiveWidthPercent: Integer;\r\n    FResponsiveMaxWidth: Integer;\r\n    procedure SetHeightPercent(const Value: Integer);\r\n    procedure SetWidthPercent(const Value: Integer);\r\n    procedure SetResponsiveHeightPercent(const Value: Integer);\r\n    procedure SetResponsiveWidthPercent(const Value: Integer);\r\n    procedure SetResponsiveMaxWidth(const Value: Integer);\r\n  public\r\n    constructor Create(AOwner: TImageZoomControl); overload;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    function GetOwner: TPersistent; override;\r\n  published\r\n    property HeightPercent: Integer read FHeightPercent write SetHeightPercent default 100;\r\n    property WidthPercent: Integer read FWidthPercent write SetWidthPercent default 100;\r\n    property ResponsiveHeightPercent: Integer read FResponsiveHeightPercent write SetResponsiveHeightPercent default 100;\r\n    property ResponsiveWidthPercent: Integer read FResponsiveWidthPercent write SetResponsiveWidthPercent default 100;\r\n    property ResponsiveMaxWidth: Integer read FResponsiveMaxWidth write SetResponsiveMaxWidth default 768;\r\n  end;\r\n\r\n  TImageZoomControl = class(TCustomImageControl)\r\n  private\r\n    FStyle: TJSElement;\r\n    FOverlay: TJSElement;\r\n    FPictureZoom: TURLPicture;\r\n    FURLZoom: string;\r\n    FPictureZoomDataURL: string;\r\n    FAppearance: TImageZoomAppearance;\r\n    procedure SetPictureZoom(const Value: TURLPicture);\r\n    procedure SetURLZoom(const Value: string);\r\n  protected\r\n    procedure PictureZoomChanged(Sender: TObject);\r\n    procedure PictureZoomDataChanged(Sender: TObject);\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    function CreateElement: TJSElement; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Appearance: TImageZoomAppearance read FAppearance write FAppearance;\r\n    property Picture;\r\n    property URL;\r\n    property PictureZoom: TURLPicture read FPictureZoom write SetPictureZoom;\r\n    property URLZoom: string read FURLZoom write SetURLZoom;\r\n  end;\r\n\r\n  TWebImageZoomControl = class(TImageZoomControl);\r\n\r\n  TCustomPanel = class(TCustomControl)\r\n  private\r\n    FAutoSize: Boolean;\r\n    FPadding: TPadding;\r\n    FShowCaption: boolean;\r\n    FLabel: TJSHTMLElement;\r\n    FPanelBody: TJSHTMLElement;\r\n    FElementBodyClassName: TElementClassName;\r\n    procedure SetShowCaption(const Value: boolean);\r\n    procedure SetPadding(const Value: TPadding);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetCaption(const AValue: string); override;\r\n    procedure SetBorderStyle(const AValue: TBorderStyle); override;\r\n    procedure SetAutoSize(AValue: boolean);\r\n    procedure UpdateElementVisual; override;\r\n    property AutoSize: boolean read FAutoSize write SetAutoSize default false;\r\n    property Padding: TPadding read FPadding write SetPadding;\r\n    property ShowCaption: boolean read FShowCaption write SetShowCaption default true;\r\n    function GetOuterWidth: integer; override;\r\n    function GetOuterHeight: integer; override;\r\n    function GetChildContainer: TJSElement; override;\r\n    property ElementBodyClassName: TElementClassName read FElementBodyClassName write FElementBodyClassName;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure EndUpdate; override;\r\n  end;\r\n\r\n  TPanel = class(TCustomPanel)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property BorderColor;\r\n    property BorderStyle;\r\n    property Caption;\r\n    property ChildOrder;\r\n    property Color;\r\n    property ElementBodyClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Font;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Margins;\r\n    property Padding;\r\n    property ParentFont;\r\n    property Role;\r\n    property ShowCaption;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnDblClick;\r\n  end;\r\n\r\n  TDivPanel = class(TPanel)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  end;\r\n\r\n  TWebPanel = class(TPanel);\r\n\r\n  TCustomGroupBox = class(TCustomControl)\r\n  private\r\n    FCaption: string;\r\n    FCaptionSpan: TJSHTMLElement;\r\n    FControlSpan: TJSHTMLElement;\r\n  protected\r\n    procedure SetCaption(const Value: string); override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    property Caption: string read FCaption write SetCaption;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TGroupBox = class(TCustomGroupBox)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property Color;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Margins;\r\n    property ParentFont;\r\n    property Role;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n  end;\r\n\r\n  TWebGroupBox = class(TGroupBox);\r\n\r\n  TScrollBox = class(TCustomPanel)\r\n  private\r\n    FAutoScroll: boolean;\r\n    FScrollBars: TScrollStyle;\r\n    function GetScrollLeft: integer;\r\n    function GetScrollTop: integer;\r\n    procedure SetScrollLeft(const Value: integer);\r\n    procedure SetScrollTop(const Value: integer);\r\n    procedure SetScrollBars(const Value: TScrollStyle);\r\n  protected\r\n    procedure UpdateElement; override;\r\n    procedure SetAutoScroll(AValue: boolean);\r\n    function GetClientRect: TRect; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ScrollLeft: integer read GetScrollLeft write SetScrollLeft;\r\n    property ScrollTop: integer read GetScrollTop write SetScrollTop;\r\n    procedure EndUpdate; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoScroll: boolean read FAutoScroll write SetAutoScroll;\r\n    property BorderStyle;\r\n    property Color;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Margins;\r\n    property Role;\r\n    property ScrollBars: TScrollStyle read FScrollBars write SetScrollBars;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnResize;\r\n  end;\r\n\r\n  TWebScrollBox = class(TScrollBox);\r\n\r\n  TCustomDragControl = class(TCustomControl)\r\n  private\r\n    FText: string;\r\n    procedure SetText(const AValue: string);\r\n  protected\r\n    function HandleDoDrag(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragEnd(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragExit(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragOver(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragStart(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDrop(aEvent: TJSDragEvent): boolean; virtual;\r\n\r\n    procedure BindEvents; override;\r\n    procedure Paint; override;\r\n  published\r\n    property Text: string read FText write SetText;\r\n  end;\r\n\r\n  TSplitter = class(TCustomControl)\r\n  private\r\n    FLayer: TJSElement;\r\n    FFirstMove: boolean;\r\n    FSplitControl: TControl;\r\n    FSizing: boolean;\r\n    FSizingX,FSizingY: double;\r\n    FOriginalWidth,FOriginalHeight: integer;\r\n    FGripColor: TColor;\r\n    FOnMoved: TNotifyEvent;\r\n    FOnMove: TNotifyEvent;\r\n    procedure SetGripColor(const Value: TColor);\r\n  protected\r\n    procedure ColorChanging; override;\r\n    function HandleDocDoMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDocDoMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure DoMouseEnter; override;\r\n\r\n    procedure MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); override;\r\n    procedure MouseDown(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); override;\r\n    procedure Paint; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property GripColor: TColor read FGripColor write SetGripColor default clWhite;\r\n    property Margins;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnMove: TNotifyEvent read FOnMove write FOnMove;\r\n    property OnMoved: TNotifyEvent read FOnMoved write FOnMoved;\r\n  end;\r\n\r\n  TWebSplitter = class(TSplitter);\r\n\r\n  TVerticalAlignment = (vaTop, vaCenter, vaBottom);\r\n  TGridPanelExpandStyle = (esAddRows, esAddColumns);\r\n\r\n  TGridPanelRow = class(TCollectionItem)\r\n  private\r\n    FSizeStyle: TSizeStyle;\r\n    FValue: integer;\r\n    FMarginBottom: integer;\r\n    FMarginTop: integer;\r\n    FAlignment: TVerticalAlignment;\r\n    FElementClassName: string;\r\n    procedure SetMarginBottom(const Value: integer);\r\n    procedure SetMarginTop(const Value: integer);\r\n    procedure SetSizeStyle(const Value: TSizeStyle);\r\n    procedure SetValue(const Value: integer);\r\n  protected\r\n    function HeightAttribute: string;\r\n  public\r\n    constructor Create(ACollection: TCollection); override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Alignment: TVerticalAlignment read FAlignment write FAlignment default vaTop;\r\n    property ElementClassName: string read FElementClassName write FElementClassName;\r\n    property MarginTop: integer read FMarginTop write SetMarginTop;\r\n    property MarginBottom: integer read FMarginBottom write SetMarginBottom;\r\n    property SizeStyle: TSizeStyle read FSizeStyle write SetSizeStyle;\r\n    property Value: integer read FValue write SetValue;\r\n  end;\r\n\r\n  TGridPanelRows = class(TOwnedCollection)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    function GetItem(Index: integer): TGridPanelRow; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TGridPanelRow); reintroduce;\r\n  protected\r\n    procedure Update(Item: TCollectionItem); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TGridPanelRow; reintroduce;\r\n    function Insert(Index: integer): TGridPanelRow; reintroduce;\r\n    property Items[Index: integer]: TGridPanelRow read GetItem write SetItem; default;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TGridPanelColumn = class(TCollectionItem)\r\n  private\r\n    FSizeStyle: TSizeStyle;\r\n    FValue: integer;\r\n    FMarginLeft: integer;\r\n    FAlignment: TAlignment;\r\n    FMarginRight: integer;\r\n    FElementClassName: string;\r\n    procedure SetMarginLeft(const Value: integer);\r\n    procedure SetMarginRight(const Value: integer);\r\n    procedure SetSizeStyle(const Value: TSizeStyle);\r\n    procedure SetValue(const Value: integer);\r\n  protected\r\n    function WidthAttribute: string;\r\n  public\r\n    constructor Create(ACollection: TCollection); override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Alignment: TAlignment read FAlignment write FAlignment default taLeftJustify;\r\n    property ElementClassName: string read FElementClassName write FElementClassName;\r\n    property MarginLeft: integer read FMarginLeft write SetMarginLeft default 0;\r\n    property MarginRight: integer read FMarginRight write SetMarginRight default 0;\r\n    property SizeStyle: TSizeStyle read FSizeStyle write SetSizeStyle default ssPercent;\r\n    property Value: integer read FValue write SetValue;\r\n  end;\r\n\r\n  TGridPanelColumns = class(TOwnedCollection)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    function GetItem(Index: integer): TGridPanelColumn; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TGridPanelColumn); reintroduce;\r\n  protected\r\n    procedure Update(Item: TCollectionItem); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TGridPanelColumn; reintroduce;\r\n    function Insert(Index: integer): TGridPanelColumn; reintroduce;\r\n    property Items[Index: integer]: TGridPanelColumn read GetItem write SetItem; default;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TControlCollectionItem = class(TCollectionItem)\r\n  private\r\n    FControl: TWinControl;\r\n    FRow: integer;\r\n    FColumn: integer;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Column: integer read FColumn write FColumn;\r\n    property Row: integer read FRow write FRow;\r\n    property Control: TWinControl read FControl write FControl;\r\n  end;\r\n\r\n  TControlCollection = class(TOwnedCollection)\r\n  private\r\n    function GetItem(Index: Integer): TControlCollectionItem; reintroduce;\r\n    procedure SetItem(Index: Integer; const Value: TControlCollectionItem); reintroduce;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TControlCollectionItem; reintroduce;\r\n    function Insert(Index: Integer): TControlCollectionItem; reintroduce;\r\n    property Items[Index: Integer]: TControlCollectionItem read GetItem write SetItem;\r\n  end;\r\n\r\n  TGridPanel = class(TCustomControl)\r\n  private\r\n    FDesignTime: boolean;\r\n    FUpdateTable: boolean;\r\n    FColCount: integer;\r\n    FRowCollection: TGridPanelRows;\r\n    FColumnCollection: TGridPanelColumns;\r\n    FControlCollection: TControlCollection;\r\n    FGridLineWidth: integer;\r\n    FGridLineColor: TColor;\r\n    FExpandStyle: TGridPanelExpandStyle;\r\n    FTbl: TJSElement;\r\n    FTblBody: TJSElement;\r\n    procedure SetColumnCollection(const Value: TGridPanelColumns);\r\n    procedure SetRowCollection(const Value: TGridPanelRows);\r\n    procedure SetControlCollection(const Value: TControlCollection);\r\n  protected\r\n    function CreateTable: TJSElement; virtual;\r\n    function CreateRow(AIndex: integer): TJSElement; virtual;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateTable;\r\n    procedure UpdateElement; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure RegisterParent(AValue: TControl); override;\r\n    procedure TableChanged(Sender: TObject);\r\n    procedure Notification(AComponent: TComponent;  Operation: TOperation); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure AddControl(AControl: TWinControl);\r\n    procedure RemoveControl(AControl: TWinControl);\r\n    procedure EndUpdate; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Color;\r\n    property ControlCollection: TControlCollection read FControlCollection write SetControlCollection;\r\n    property ColumnCollection: TGridPanelColumns read FColumnCollection write SetColumnCollection;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property ExpandStyle: TGridPanelExpandStyle read FExpandStyle write FExpandStyle default esAddRows;\r\n    property GridLineWidth: integer read FGridLineWidth write FGridLineWidth default 0;\r\n    property GridLineColor: TColor read FGridLineColor write FGridLineColor default clBlack;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Margins;\r\n    property Role;\r\n    property RowCollection: TGridPanelRows read FRowCollection write SetRowCollection;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n  end;\r\n\r\n  TWebGridPanel = class(TGridPanel);\r\n\r\n  TMultiMediaType = (mtVideo, mtAudio);\r\n\r\n  TMultiMediaVolume = 0..100;\r\n\r\n  TMultimediaPlayer = class(TCustomControl)\r\n  private\r\n    FURL: string;\r\n    FMultimediaType: TMultimediaType;\r\n    FAutoPlay: boolean;\r\n    FControls: boolean;\r\n    FMuted: boolean;\r\n    FLoop: boolean;\r\n    FVolume: TMultiMediaVolume;\r\n    FPlaybackRate: double;\r\n    procedure SetAutoPlay(const Value: boolean);\r\n    procedure SetControls(const Value: boolean);\r\n    procedure SetMuted(const Value: boolean);\r\n    procedure SetLoop(const Value: boolean);\r\n    procedure SetURL(const Value: string);\r\n    procedure SetVolume(const Value: TMultiMediaVolume);\r\n    function GetCurrentTime: double;\r\n    procedure SetCurrentTime(const Value: double);\r\n    function GetDuration: double;\r\n    function GetEnded: boolean;\r\n    function GetPaused: boolean;\r\n    procedure SetPlaybackRate(const Value: double);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure Play;\r\n    procedure Pause;\r\n    procedure ReLoad;\r\n    property CurrentTime: double read GetCurrentTime write SetCurrentTime;\r\n    property Duration: double read GetDuration;\r\n    property Ended: boolean read GetEnded;\r\n    property Paused: boolean read GetPaused;\r\n  published\r\n    property AlignWithMargins;\r\n    property AutoPlay: boolean read FAutoPlay write SetAutoPlay;\r\n    property Controls: boolean read FControls write SetControls;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Loop: boolean read FLoop write SetLoop;\r\n    property Margins;\r\n    property MultimediaType: TMultimediaType read FMultiMediaType write FMultiMediaType;\r\n    property Muted: boolean read FMuted write SetMuted;\r\n    property PlaybackRate: double read FPlaybackRate write SetPlaybackRate;\r\n    property URL: string read FURL write SetURL;\r\n    property Volume: TMultiMediaVolume read FVolume write SetVolume;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n  end;\r\n\r\n  TWebMultiMediaPlayer = class(TMultiMediaPlayer);\r\n\r\n  THTMLContainer = class(TCustomControl)\r\n  private\r\n    FHTML: TStringList;\r\n    FScrollStyle: TScrollStyle;\r\n    procedure SetHTML(const Value: TStringList);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure HTMLChanged(Sender: TObject); virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property Font;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property HTML: TStringList read FHTML write SetHTML;\r\n    property Margins;\r\n    property Role;\r\n    property ScrollStyle: TScrollStyle read FScrollStyle write FScrollStyle;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n  end;\r\n\r\n  TWebHTMLContainer = class(THTMLContainer);\r\n\r\n  THTMLForm = class(TCustomControl)\r\n  private\r\n    FOnSubmit: TNotifyEvent;\r\n    FAction: string;\r\n    procedure SetAction(const Value: string);\r\n  protected\r\n    procedure UpdateElement; override;\r\n    function CreateElement: TJSElement; override;\r\n    function IsStructuralElement: boolean; override;\r\n    function DoHandleSubmit(Event: TJSEvent): boolean; virtual;\r\n    procedure BindEvents; override;\r\n  public\r\n    function CheckValidity: boolean;\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Action: string read FAction write SetAction;\r\n    property Align;\r\n    property Anchors;\r\n    property ElementPosition;\r\n    property ElementFont;\r\n    property Font;\r\n    property Role;\r\n    property OnSubmit: TNotifyEvent read FOnSubmit write FOnSubmit;\r\n  end;\r\n\r\n  TWebHTMLForm = class(THTMLForm);\r\n\r\n  TBadge = class(TCustomControl)\r\n  private\r\n    FTextColor: TColor;\r\n    FText: string;\r\n    procedure SetTextColor(const Value: TColor);\r\n    procedure SetText(const Value: string);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure SetElementClassName(AValue: string); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Color default clRed;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Margins;\r\n    property Role;\r\n    property Text: string read FText write SetText;\r\n    property TextColor: TColor read FTextColor write SetTextColor;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n  end;\r\n\r\n\r\n  TWebBadge = class(TBadge);\r\n\r\n  TAccordionSection = class(TCollectionItem)\r\n  private\r\n    FCaption: string;\r\n    FContent: string;\r\n    FTag: integer;\r\n    FExpanded: boolean;\r\n    procedure SetExpanded(const Value: boolean);\r\n    procedure SetCaption(const Value: string);\r\n    procedure SetContent(const Value: string);\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    property Expanded: boolean read FExpanded write SetExpanded;\r\n    function CaptionElement: TJSHTMLElement;\r\n    function PanelElement: TJSHTMLElement;\r\n  published\r\n    property Caption: string read FCaption write SetCaption;\r\n    property Content: string read FContent write SetContent;\r\n    property Tag: integer read FTag write FTag;\r\n  end;\r\n\r\n  TAccordionSections = class(TOwnedCollection)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    function GetItem(Index: integer): TAccordionSection; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TAccordionSection);\r\n  protected\r\n    procedure Update(Item: TCollectionItem); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); overload;\r\n    function Add: TAccordionSection; reintroduce;\r\n    function Insert(Index: integer): TAccordionSection; reintroduce;\r\n    property Items[Index: integer]: TAccordionSection read GetItem write SetItem; default;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TAccordionSectionEvent =  procedure(Sender: TObject; ASection: TAccordionSection) of object;\r\n  TAccordionSectionAllowEvent =  procedure(Sender: TObject; ASection: TAccordionSection; var Allow: boolean) of object;\r\n\r\n  TAccordionSectionRenderEvent =  procedure(Sender: TObject; ASection: TAccordionSection; ACaption, APanel: TJSHTMLElement) of object;\r\n\r\n  TAccordion = class(TCustomControl)\r\n  private\r\n    FStyleRendered: boolean;\r\n    FSections: TAccordionSections;\r\n    FOnCollapsing: TAccordionSectionAllowEvent;\r\n    FOnExpanding: TAccordionSectionAllowEvent;\r\n    FOnCollapsed: TAccordionSectionEvent;\r\n    FOnExpanded: TAccordionSectionEvent;\r\n    FOnRenderSection: TAccordionSectionRenderEvent;\r\n    FElementSectionClassName: TElementClassName;\r\n    FElementContentClassName: TElementClassName;\r\n    procedure SetSections(const Value: TAccordionSections);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure RenderAccordion;\r\n    procedure RenderStyle;\r\n    procedure SectionsChanged(Sender: TObject); virtual;\r\n    function DoAccordionClick(Event: TJSEvent): Boolean; virtual;\r\n    procedure UpdateElementVisual; override;\r\n    procedure Expand(ASection: TAccordionSection);\r\n    procedure Collapse(ASection: TAccordionSection);\r\n    procedure SetElementClassName(AValue: string); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure EndUpdate; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Margins;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property ElementSectionClassName: TElementClassName read FElementSectionClassName write FElementSectionClassName;\r\n    property ElementContentClassName: TElementClassName read FElementContentClassName write FElementContentClassName;\r\n    property Role;\r\n    property Sections: TAccordionSections read FSections write SetSections;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnCollapsed: TAccordionSectionEvent read FOnCollapsed write FOnCollapsed;\r\n    property OnCollapsing: TAccordionSectionAllowEvent read FOnCollapsing write FOnCollapsing;\r\n    property OnExpanded: TAccordionSectionEvent read FOnExpanded write FOnExpanded;\r\n    property OnExpanding: TAccordionSectionAllowEvent read FOnExpanding write FOnExpanding;\r\n    property OnRenderSection: TAccordionSectionRenderEvent read FOnRenderSection write FOnRenderSection;\r\n  end;\r\n\r\n  TWebAccordion = class(TAccordion);\r\n\r\n\r\n  TGridStyle = (gTemplateColumns, gTemplateRows);\r\n\r\n  TResponsiveLayoutItem = class(TCollectionItem)\r\n  private\r\n    FWidth: integer;\r\n    FStyleType: TGridStyle;\r\n    FStyle: string;\r\n    FColumnGap: string;\r\n    FRowGap: string;\r\n    FTag: integer;\r\n    FDescription: string;\r\n    FMargins: TMargins;\r\n    procedure SetMargins(const Value: TMargins);\r\n  public\r\n    constructor Create(AOwner: TCollection); override;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property ColumnGap: string read FColumnGap write FColumnGap;\r\n    property Description: string read FDescription write FDescription;\r\n    property Margins: TMargins read FMargins write SetMargins;\r\n    property RowGap: string read FRowGap write FRowGap;\r\n    property StyleType: TGridStyle read FStyleType write FStyleType;\r\n    property Style: string read FStyle write FStyle;\r\n    property Tag: integer read FTag write FTag;\r\n    property Width: integer read FWidth write FWidth;\r\n  end;\r\n\r\n  TResponsiveLayout = class(TOwnedCollection)\r\n  private\r\n    function GetItem(Index: integer): TResponsiveLayoutItem; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TResponsiveLayoutItem);\r\n  public\r\n    function GetLayoutForWidth(w: integer): TResponsiveLayoutItem;\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add(AWidth: integer; AStyle: string): TResponsiveLayoutItem; overload; reintroduce;\r\n    function Add: TResponsiveLayoutItem; overload; reintroduce;\r\n    function Insert(Index: integer): TResponsiveLayoutItem; reintroduce;\r\n    property Items[Index: integer]: TResponsiveLayoutItem read GetItem write SetItem;\r\n  end;\r\n\r\n  //https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Grid_Layout\r\n\r\n  TResponsiveLayoutChangeEvent = procedure(Sender: TObject; ALayout: TResponsiveLayoutItem) of object;\r\n\r\n  TResponsiveGridPanel = class(TCustomControl)\r\n  private\r\n    FDesignTime: boolean;\r\n    FLabel: TJSHTMLElement;\r\n    FLayout: TResponsiveLayout;\r\n    FActiveLayoutItem: TResponsiveLayoutItem;\r\n    FOldWidth: integer;\r\n    FControlCollection: TControlCollection;\r\n    FOnLayoutChange: TResponsiveLayoutChangeEvent;\r\n    procedure SetControlCollection(const Value: TControlCollection);\r\n    function HandleResize(Event: TEventListenerEvent): boolean; virtual;\r\n    procedure SetResponsiveStyle;\r\n  protected\r\n    procedure BindEvents; override;\r\n    procedure UnbindEvents; override;\r\n    procedure UpdateControls;\r\n    function CreateElement: TJSElement; override;\r\n    function GridElementCount: integer;\r\n    procedure UpdateElement; override;\r\n    procedure Loaded; override;\r\n    procedure RegisterParent(AValue: TControl); override;\r\n    procedure Notification(AComponent: TComponent;  Operation: TOperation); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    destructor Destroy; override;\r\n    procedure CreateInitialize; override;\r\n    procedure AlignControls(AControl: TControl; var Rect: TRect); override;\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); override;\r\n    procedure Resize; override;\r\n    procedure AddControl(AControl: TWinControl);\r\n    procedure RemoveControl(AControl: TWinControl);\r\n    procedure EndUpdate; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ChildOrder;\r\n    property Color;\r\n    property ControlCollection: TControlCollection read FControlCollection write SetControlCollection;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Layout: TResponsiveLayout read FLayout write FLayout;\r\n    property Margins;\r\n    property Role;\r\n    property ShowHint;\r\n    property Visible;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnLayoutChange: TResponsiveLayoutChangeEvent read FOnLayoutChange write FOnLayoutChange;\r\n  end;\r\n\r\n  TWebResponsiveGridPanel = class(TResponsiveGridPanel);\r\n\r\n\r\n  TLookupValueItem = class(TCollectionItem)\r\n  private\r\n    FValue: string;\r\n    FDisplayText: string;\r\n  public\r\n\r\n  published\r\n    property Value: string read FValue write FValue;\r\n    property DisplayText: string read FDisplayText write FDisplayText;\r\n  end;\r\n\r\n  TLookupValues = class(TOwnedCollection)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    function GetItem(Index: integer): TLookupValueItem; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TLookupValueItem);\r\n  protected\r\n    procedure DoChange; virtual;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    procedure AddPair(AValue, ADisplayText: string);\r\n    function Add: TLookupValueItem; reintroduce;\r\n    function Insert(Index: integer): TLookupValueItem; reintroduce;\r\n    property Items[Index: integer]: TLookupValueItem read GetItem write SetItem; default;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TCustomLookupComboBox = class(TCustomComboBox)\r\n  private\r\n    FLookupValues: TLookupValues;\r\n    procedure SetLookupValues(const Value: TLookupValues);\r\n    function GetDisplayText: string;\r\n    function GetValue: string;\r\n    procedure SetDisplayText(const Value: string);\r\n    procedure SetValue(const Value: string);\r\n  protected\r\n    procedure ValuesChanged(Sender: TObject);\r\n    procedure DoUpdateList; override;\r\n  public\r\n    destructor Destroy; override;\r\n    procedure CreateInitialize; override;\r\n    property Value: string read GetValue write SetValue;\r\n    property DisplayText: string read GetDisplayText write SetDisplayText;\r\n    property LookupValues: TLookupValues read FLookupValues write SetLookupValues;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Left;\r\n    property Margins;\r\n    property ParentFont;\r\n    property Role;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property TextDirection;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TLookupComboBox = class(TCustomLookupComboBox)\r\n  published\r\n    property LookupValues;\r\n  end;\r\n\r\n  TWebLookupComboBox = class(TLookupComboBox);\r\n\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Utils;\r\n\r\nvar\r\n  geolocation : TJSGeoLocation; external name 'navigator.geolocation';\r\n\r\n\r\n{ TCustomLinkLabel }\r\n\r\nprocedure TCustomLinkLabel.SetCaption(const AValue: string);\r\nvar\r\n  iopen, iopena, iopeni, iopenend, iopenendt, iclose: integer;\r\n  scaption, shref, stext, sanchor, sid, stype: string;\r\n  anchor, span, contentelement: TJSElement;\r\nbegin\r\n  inherited SetCaption(AValue);\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  contentelement := ContentHandle;\r\n\r\n  if (ElementID <> '') then\r\n    contentelement := document.getElementById(ElementID);\r\n\r\n  contentelement.innerHTML := '';\r\n\r\n  scaption := Caption;\r\n\r\n  sanchor := '<a href=\"';\r\n  sid := '<a id=\"';\r\n\r\n  if Assigned(FOnLinkClick) and ((pos(sanchor, scaption) > 0) or (pos(sid, scaption) > 0)) then\r\n  begin\r\n    while (Pos(sanchor, scaption) > 0) or (Pos(sid, scaption) > 0) do\r\n    begin\r\n      //find first link in string\r\n      iopena := pos(sanchor, scaption);\r\n      iopeni := pos(sid, scaption);\r\n\r\n      if ((iopena < iopeni) or (iopeni <= 0)) and (iopena > 0) then\r\n      begin\r\n        stype := '#url#';\r\n        iopen := iopena + length(sanchor);\r\n      end\r\n      else\r\n      begin\r\n        stype := '#id#';\r\n        iopen := iopeni + length(sid);\r\n      end;\r\n\r\n      iopenend := pos('\">', scaption);\r\n      iopenendt := pos('\" ', scaption);\r\n      if (iopenendt > 0) and (iopenendt < iopenend) then\r\n        iopenend := iopenendt;\r\n\r\n      iclose := pos('</a>', scaption);\r\n      shref := copy(scaption, iopen, iopenend - iopen);\r\n\r\n      iopenend := pos('\">', scaption);\r\n      iclose := pos('</a>', scaption);\r\n      stext := copy(scaption, iopenend + 2, iclose - (iopenend + 2));\r\n\r\n      //add prefix text\r\n      span := document.createElement('SPAN');\r\n      span.innerHTML := copy(scaption, 0, iopen);\r\n      contentelement.appendChild(span);\r\n\r\n      //add link\r\n      anchor := document.createElement('A');\r\n      anchor['href'] := '#';\r\n      anchor['id'] := stype + shref;\r\n      anchor.innerHTML := stext;\r\n      TJSHTMLElement(anchor).onclick := DoLinkClick;\r\n      contentelement.appendChild(anchor);\r\n\r\n      //remove prefix + link\r\n      Delete(scaption, 1, Pos('</a>', scaption) + 3);\r\n    end;\r\n\r\n    //suffix text\r\n    span := document.createElement('SPAN');\r\n    span.innerHTML := scaption;\r\n    contentelement.appendChild(span);\r\n    FDisplText := scaption;\r\n  end\r\n  else\r\n  begin\r\n    FDisplText := StringReplace(AValue, '> <', '>&nbsp;<', [rfReplaceAll]);\r\n    contentelement.innerHTML := FDisplText;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.SetHeightPercent(const Value: TPercentSize);\r\nbegin\r\n  FHeightPercent := Value;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.SetHeightStyle(const Value: TSizeStyle);\r\nbegin\r\n  FHeightStyle := Value;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.SetWidthPercent(const Value: TPercentSize);\r\nbegin\r\n  FWidthPercent := Value;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.SetWidthStyle(const Value: TSizeStyle);\r\nbegin\r\n  FWidthStyle := Value;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.BindEvents;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nconstructor TCustomLinkLabel.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FWidthStyle := ssAbsolute;\r\n  FWidthPercent := 100;\r\n  FHeightStyle := ssAbsolute;\r\n  FHeightPercent := 100;\r\n  Transparent := false;\r\nend;\r\n\r\nfunction TCustomLinkLabel.DoLinkClick(Event: TJSMouseEvent): boolean;\r\nvar\r\n slink, stype, svalue: string;\r\n ltype: TSysLinkType;\r\nbegin\r\n  svalue := event.target['id'];\r\n  stype := '#url#';\r\n  ltype := sltURL;\r\n\r\n  if not (pos(stype, svalue) > 0) then\r\n  begin\r\n    stype := '#id#';\r\n    ltype := sltID;\r\n  end;\r\n\r\n  slink := StringReplace(svalue, stype, '', []);\r\n\r\n  if Assigned(FOnLinkClick) then\r\n    FOnLinkClick(Self, slink, ltype);\r\n\r\n  Result := true;\r\nend;\r\n\r\n\r\nfunction TCustomLinkLabel.GetDisplayText: string;\r\nbegin\r\n  Result := FDisplText;\r\nend;\r\n\r\nfunction TCustomLinkLabel.GetOuterHeight: integer;\r\nbegin\r\n  Result := Height;\r\n  if AutoSize then\r\n    Result := Result + 4;\r\nend;\r\n\r\nfunction TCustomLinkLabel.GetOuterWidth: integer;\r\nbegin\r\n  Result := Width;\r\n  if AutoSize then\r\n    Result := Result + 4;\r\nend;\r\n\r\n{ TTrackBar }\r\n\r\nfunction TTrackBar.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nfunction TTrackBar.GetInputType: string;\r\nbegin\r\n  Result := 'range';\r\nend;\r\n\r\nprocedure TTrackBar.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TTrackBar.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  el := ElementHandle;\r\n  asm\r\n    this.FPosition = el.value;\r\n  end;\r\n\r\n  Change;\r\n  Result := True;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TTrackBar.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.oninput := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nprocedure TTrackBar.CreateControl;\r\nbegin\r\n  inherited;\r\n  DoUpdate;\r\nend;\r\n\r\nprocedure TTrackBar.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FMax := 100;\r\n  FMin := 0;\r\n  FPosition := 0;\r\nend;\r\n\r\nprocedure TTrackBar.SetMax(AValue: integer);\r\nbegin\r\n  if (FMax <> AValue) then\r\n  begin\r\n    FMax := AValue;\r\n    DoUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TTrackBar.SetMin(AValue: integer);\r\nbegin\r\n  if (FMin <> AValue) then\r\n  begin\r\n    FMin := AValue;\r\n    DoUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TTrackBar.SetOrientation(const Value: TTrackBarOrientation);\r\nvar\r\n  ow, oh: integer;\r\nbegin\r\n  if (FOrientation <> Value) then\r\n  begin\r\n    ow := Width;\r\n    oh := Height;\r\n    FOrientation := Value;\r\n    if not (csLoading in ComponentState) then\r\n    begin\r\n      Width := oh;\r\n      Height := ow;\r\n    end;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TTrackBar.DoUpdate;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  Container['max'] := IntToStr(FMax);\r\n  Container['min'] := IntToStr(FMin);\r\n\r\n  el := ElementHandle;\r\n\r\n  asm\r\n    el.value = this.FPosition;\r\n    el.setAttribute('value',this.FPosition);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TTrackBar.SetPosition(AValue: integer);\r\nbegin\r\n  if (FPosition <> AValue) then\r\n  begin\r\n    FPosition := AValue;\r\n    DoUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TTrackBar.UpdateElementVisual;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  el := ElementHandle;\r\n\r\n  if Orientation = trHorizontal then\r\n  begin\r\n    el.removeAttribute('orient');\r\n    el.style.removeProperty('writing-mode');\r\n    el.style.removeProperty('-webkit-appearance');\r\n    el.style.removeProperty('height');\r\n    if WidthStyle = ssAbsolute then\r\n      el.style.setProperty('width', IntToStr(Width));\r\n  end\r\n  else\r\n  begin\r\n    el.setAttribute('orient','vertical');\r\n    el.style.setProperty('writing-mode','bt-lt');\r\n    el.style.setProperty('-webkit-appearance','slider-vertical');\r\n    el.style.removeProperty('width');\r\n    if HeightStyle = ssAbsolute then\r\n      el.style.setProperty('height', IntToStr(Height));\r\n  end;\r\n\r\nend;\r\n\r\nfunction TTrackBar.GetPosition: integer;\r\nvar\r\n  s: string;\r\nbegin\r\n  Result := FPosition;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  s := TJSHTMLInputElement(Container).value;\r\n  if (s <> '') then\r\n    Result := StrToInt(s);\r\nend;\r\n\r\n{ TTimer }\r\n\r\nconstructor TTimer.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FInterval := 1000;\r\n  FTimerID := -1;\r\n  Enabled := True;\r\nend;\r\n\r\nprocedure TTimer.SetEnabled(Value: boolean);\r\nbegin\r\n  FEnabled := Value;\r\n  DoUpdateTimer;\r\nend;\r\n\r\nprocedure TTimer.SetInterval(AValue: integer);\r\nbegin\r\n  FInterval := AValue;\r\n  DoUpdateTimer;\r\nend;\r\n\r\nprocedure TTimer.DoTimer;\r\nbegin\r\n  if Assigned(FOnTimer) then\r\n    FOnTimer(Self);\r\nend;\r\n\r\ndestructor TTimer.Destroy;\r\nbegin\r\n  DoClearTimer;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTimer.DoClearTimer;\r\nbegin\r\n  if FTimerID <> -1 then\r\n  begin\r\n    window.clearInterval(FTimerID);\r\n    FTimerID := -1;\r\n  end;\r\nend;\r\n\r\nprocedure TTimer.DoUpdateTimer;\r\nbegin\r\n  DoClearTimer;\r\n\r\n  if Enabled then\r\n    FTimerID := window.setInterval(@DoTimer, FInterval);\r\nend;\r\n\r\n{ TPaintBox }\r\n\r\nprocedure TPaintBox.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    ElementHandle.style.setProperty('border', '1px dotted gray');\r\n  end;\r\nend;\r\n\r\nprocedure TPaintBox.Paint;\r\nbegin\r\n  inherited;\r\n  if Assigned(OnPaint) then\r\n    OnPaint(Self);\r\nend;\r\n\r\n{ TScrollBox }\r\n\r\nprocedure TScrollBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAutoScroll := true;\r\n  FScrollBars := ssBoth;\r\nend;\r\n\r\nprocedure TScrollBox.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) and not IsUpdating then\r\n  begin\r\n    case ScrollBars of\r\n    ssNone:\r\n      begin\r\n        ElementHandle.style.setProperty('overflow', 'hidden');\r\n      end;\r\n    ssVertical:\r\n      begin\r\n        ElementHandle.style.removeProperty('overflow');\r\n        ElementHandle.style.setProperty('overflow-x', 'hidden');\r\n        ElementHandle.style.setProperty('overflow-y', 'auto');\r\n      end;\r\n    ssHorizontal:\r\n      begin\r\n        ElementHandle.style.removeProperty('overflow');\r\n        ElementHandle.style.setProperty('overflow-x', 'auto');\r\n        ElementHandle.style.setProperty('overflow-y', 'hidden');\r\n      end;\r\n    ssBoth:\r\n      begin\r\n        ElementHandle.style.setProperty('overflow', 'auto');\r\n      end;\r\n    end;\r\n\r\n    if Visible then\r\n      ElementHandle.style.setProperty('display', 'inline-block');\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBox.EndUpdate;\r\nbegin\r\n  inherited;\r\n  AlignControl(Self);\r\n  // re-align in case align had effect on scrollbar appearance\r\n  AlignControl(Self);\r\nend;\r\n\r\nfunction TScrollBox.GetClientRect: TRect;\r\nvar\r\n  dw, dh: integer;\r\nbegin\r\n  dw := 0;\r\n  dh := 0;\r\n\r\n  if (ElementHandle.scrollHeight > ElementHandle.ClientHeight) and (ScrollBars in [ssBoth, ssVertical]) then\r\n    dw := 16; //GetScrollBarWidth;\r\n\r\n  if (ElementHandle.scrollWidth > ElementHandle.ClientWidth) and (ScrollBars in [ssBoth, ssHorizontal]) then\r\n    dh := 16; //GetScrollBarHeight;\r\n\r\n  Result := Rect(0,0, TJSHTMLElement(ElementHandle).clientWidth - dw, TJSHTMLElement(ElementHandle).clientHeight - dh);\r\nend;\r\n\r\nfunction TScrollBox.GetScrollLeft: integer;\r\nbegin\r\n  Result := ElementHandle.scrollLeft;\r\nend;\r\n\r\nfunction TScrollBox.GetScrollTop: integer;\r\nbegin\r\n  Result := ElementHandle.scrollTop;\r\nend;\r\n\r\nprocedure TScrollBox.SetAutoScroll(AValue: boolean);\r\nbegin\r\n  FAutoScroll := AValue;\r\nend;\r\n\r\nprocedure TScrollBox.SetScrollBars(const Value: TScrollStyle);\r\nbegin\r\n  if (FScrollBars <> Value) then\r\n  begin\r\n    FScrollBars := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBox.SetScrollLeft(const Value: integer);\r\nbegin\r\n  ElementHandle.scrollLeft := Value;\r\nend;\r\n\r\nprocedure TScrollBox.SetScrollTop(const Value: integer);\r\nbegin\r\n  ElementHandle.scrollTop := Value;\r\nend;\r\n\r\n{ TCustomImageControl }\r\n\r\nprocedure TCustomImageControl.BindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    Container['draggable'] := 'true';\r\n    Container['droppable'] := 'true';\r\n    ElementHandle.ondrag := HandleDoDrag;\r\n    ElementHandle.ondragend := HandleDoDragEnd;\r\n    ElementHandle.ondragexit := HandleDoDragExit;\r\n    ElementHandle.ondragover := HandleDoDragOver;\r\n    ElementHandle.ondragstart := HandleDoDragStart;\r\n    ElementHandle.ondrop := HandleDoDrop;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomImageControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FPicture := TURLPicture.Create;\r\n  FPicture.OnChange := PictureChanged;\r\n  FPicture.OnDataChange := PictureDataChanged;\r\n  Color := clNone;\r\n  TabStop := false;\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\nend;\r\n\r\nfunction TCustomImageControl.DataURL: string;\r\nbegin\r\n  Result := 'data:image/png;base64,' + GetBase64Img;\r\nend;\r\n\r\nfunction TCustomImageControl.DataURL(AWidth, AHeight: integer): string;\r\nbegin\r\n  Result := 'data:image/png;base64,' + GetBase64Image(ElementHandle, AWidth, AHeight);\r\nend;\r\n\r\ndestructor TCustomImageControl.Destroy;\r\nbegin\r\n  FPicture.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n\r\nfunction TCustomImageControl.GetBase64Img: string;\r\nbegin\r\n  Result := GetBase64Image(ElementHandle);\r\nend;\r\n\r\nfunction TCustomImageControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('IMG');\r\n  Result.addEventListener('load',@HandleImageLoad);\r\n  if URL <> '' then\r\n    Result.setAttribute('src', URL);\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDrag(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDragEnd(aEvent: TJSDragEvent): boolean;\r\nvar\r\n  obj: TObject;\r\nbegin\r\n  //\r\n//  PreventDefault;\r\n  DoEndDrag(obj,0,0);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDragExit(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDragOver(aEvent: TJSDragEvent): boolean;\r\nvar\r\n  allow: boolean;\r\n  obj: TObject;\r\nbegin\r\n//  PreventDefault;\r\n  AEvent.preventDefault;\r\n\r\n  DragOver(obj, 0, 0, dsDragMove, allow);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDragStart(aEvent: TJSDragEvent): boolean;\r\nvar\r\n  obj: TDragObject;\r\n\r\nbegin\r\n  AEvent.preventDefault;\r\n\r\n  AEvent.dataTransfer.effectAllowed := 'copy';\r\n  AEvent.dataTransfer.dropEffect := 'copy';\r\n  AEvent.dataTransfer.setData('text', 'dragdrop');\r\n\r\n  DoStartDrag(obj);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDrop(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  DragDrop(TObject(aEvent), aEvent.clientX, aEvent.clientY);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleImageLoad(aEvent: TJSEvent): boolean;\r\nbegin\r\n  if Assigned(OnLoaded) then\r\n    OnLoaded(Self);\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomImageControl.SetContainerURL(AURL: string);\r\nbegin\r\n  if Assigned(Container) then\r\n  begin\r\n    Container['src'] := AURL;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomImageControl.SetURL(AURL: string);\r\nbegin\r\n  FURL := AURL;\r\n  SetContainerURL(AURL);\r\nend;\r\n\r\nprocedure TCustomImageControl.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if AutoSize and Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.removeProperty('width');\r\n    ElementHandle.style.removeProperty('height');\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomImageControl.SetPicture(const Value: TURLPicture);\r\nbegin\r\n  FPicture.Assign(Value);\r\nend;\r\n\r\nprocedure TCustomImageControl.PictureChanged(Sender: TObject);\r\nbegin\r\n  SetURL(Picture.FileName);\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomImageControl.PictureDataChanged(Sender: TObject);\r\nbegin\r\n  SetContainerURL('data:image/png;base64,' + HexImageDecodeAsBase64(Picture.Data));\r\nend;\r\n\r\nprocedure TCustomImageControl.ResizeImage(AWidth, AHeight: integer);\r\nbegin\r\n  URL := 'data:image/png;base64,' + GetBase64Image(ElementHandle, Width, Height);\r\nend;\r\n\r\nprocedure TCustomImageControl.ResizeImage;\r\nbegin\r\n  ResizeImage(Width, Height);\r\nend;\r\n\r\n{ TCustomDragControl }\r\n\r\nprocedure TCustomDragControl.BindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    Container['draggable'] := 'true';\r\n    ElementHandle.ondragend := HandleDoDragEnd;\r\n    ElementHandle.ondragexit := HandleDoDragExit;\r\n    ElementHandle.ondragover := HandleDoDragOver;\r\n    ElementHandle.ondragstart := HandleDoDragStart;\r\n    ElementHandle.ondrop := HandleDoDrop;\r\n  end;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDrag(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //OutputDebugString('do drag');\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDragEnd(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  DoEndDrag(Self, aEvent.clientX, aEvent.clientY);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDragExit(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //OutputDebugString('do drag exit');\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDragOver(aEvent: TJSDragEvent): boolean;\r\nvar\r\n  Accept: boolean;\r\nbegin\r\n  aEvent.preventDefault();\r\n  //OutputDebugString('do drag over');\r\n  Accept := true;\r\n  DragOver(Self, aEvent.clientX, aEvent.clientY, dsDragMove, Accept);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDragStart(aEvent: TJSDragEvent): boolean;\r\nvar\r\n  obj: TDragObject;\r\nbegin\r\n  aEvent.dataTransfer.setData('text',  Text);\r\n  DoStartDrag(obj);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDrop(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  aEvent.preventDefault();\r\n  Text := aEvent.dataTransfer.getData('text');\r\n  DragDrop(Self, aEvent.clientX, aEvent.clientY);\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomDragControl.Paint;\r\nbegin\r\n  Canvas.Pen.Color := clRed;\r\n  Canvas.Pen.Width := 1;\r\n  Canvas.Pen.Style := psSolid;\r\n  Canvas.Brush.Style := bsSolid;\r\n  Canvas.Brush.Color := clYellow;\r\n  Canvas.Rectangle(ClientRect);\r\n\r\n  Canvas.TextOut(10,10,FText);\r\nend;\r\n\r\nprocedure TCustomDragControl.SetText(const AValue: string);\r\nbegin\r\n  if (FText <> AValue) then\r\n  begin\r\n    FText := AValue;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\n{ TSplitter }\r\n\r\nprocedure TSplitter.ColorChanging;\r\nbegin\r\n  inherited;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TSplitter.CreateInitialize;\r\n begin\r\n   inherited;\r\n   Cursor := crHSplit;\r\n   Width := 6;\r\n   Height := 100;\r\n   Align := alLeft;\r\n   FSplitControl := nil;\r\n   GripColor := clWhite;\r\n end;\r\n\r\n procedure TSplitter.Paint;\r\n var\r\n   xofs,dx: integer;\r\n   yofs,dy: integer;\r\n   i: integer;\r\n begin\r\n   Canvas.Brush.Color := Color;\r\n   Canvas.Pen.Color := Color;\r\n   Canvas.Brush.Style := bsSolid;\r\n   Canvas.Rectangle(ClientRect);\r\n\r\n   if (Align in [alLeft, alRight]) then\r\n   begin\r\n     dx := 0;\r\n     dy := 6;\r\n     yofs := (Height div 2) - 9;\r\n     xofs := (Width div 2);\r\n   end;\r\n\r\n   if (Align in [alTop, alBottom]) then\r\n   begin\r\n     dx := 6;\r\n     dy := 0;\r\n     xofs := (Width div 2) - 9;\r\n     yofs := (Height div 2) - 1;\r\n   end;\r\n\r\n   Canvas.Brush.Color := GripColor;\r\n   Canvas.Pen.Color := GripColor;\r\n\r\n   for i := 0 to 2 do\r\n   begin\r\n     Canvas.Rectangle(xofs, yofs, xofs + 2, yofs + 2);\r\n     xofs := xofs + dx;\r\n     yofs := yofs + dy;\r\n   end;\r\n end;\r\n\r\nprocedure TSplitter.SetGripColor(const Value: TColor);\r\nbegin\r\n  if (FGripColor <> Value) then\r\n  begin\r\n    FGripColor := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TSplitter.MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer);\r\nbegin\r\n  inherited;\r\n  FSizing := false;\r\n  FSplitControl := nil;\r\n  ReleaseCapture;\r\nend;\r\n\r\nprocedure TSplitter.MouseDown(Button: TMouseButton; Shift: TShiftState; X,Y: Integer);\r\nvar\r\n  r,rc: TRect;\r\n  i: integer;\r\n  c: TControl;\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  FSizing := true;\r\n\r\n  r := Rect(Left, Top, Left + Width, Top + Height);\r\n\r\n  if Assigned(Parent) then\r\n  begin\r\n    for i := 0 to Parent.ControlCount - 1 do\r\n    begin\r\n      c := Parent.Controls[i];\r\n\r\n      if (c.Align = Align) and (c <> Self) then\r\n      begin\r\n        rc := Rect(c.Left, c.Top, c.Left + c.Width, c.Top + c.Height);\r\n\r\n        //OutputDebugString(c.GetID+':'+inttostr(rc.Right)+':'+inttostr(r.Left));\r\n\r\n        if (Align = alLeft) and (rc.Right - r.Left < 4) then\r\n        begin\r\n          FSplitControl := c;\r\n          FOriginalWidth := FSplitControl.Width;\r\n          FSizing := true;\r\n          FSizingX := X;\r\n          FSizingY := Y;\r\n          break;\r\n          //OutputDebugString('left:'+c.GetID);\r\n        end;\r\n\r\n        if (Align = alRight) and (rc.Left - r.Right < 4) then\r\n        begin\r\n          FSplitControl := c;\r\n          FOriginalWidth := FSplitControl.Width;\r\n          FSizing := true;\r\n          FSizingX := X;\r\n          FSizingY := Y;\r\n          break;\r\n          //OutputDebugString('left:'+c.GetID);\r\n        end;\r\n\r\n        if (Align = alTop) and (rc.Bottom - r.Top < 4) then\r\n        begin\r\n          FSplitControl := c;\r\n          FOriginalHeight := FSplitControl.Height;\r\n          FSizing := true;\r\n          FSizingX := X;\r\n          FSizingY := Y;\r\n          break;\r\n          //OutputDebugString('top:'+c.GetID);\r\n        end;\r\n\r\n        if (Align = alBottom) and (rc.Top - r.Bottom < 4) then\r\n        begin\r\n          FSplitControl := c;\r\n          FOriginalHeight := FSplitControl.Height;\r\n          FSizing := true;\r\n          FSizingX := X;\r\n          FSizingY := Y;\r\n          break;\r\n          //OutputDebugString('top:'+c.GetID);\r\n        end;\r\n\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  FLayer := document.createElement('SPAN');\r\n  document.body.appendChild(FLayer);\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n  // make sure it is higher than the z-index of the layer associated with popup forms\r\n  eh.style.setProperty('z-index', '99999999');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.setProperty('position', 'absolute');\r\n\r\n  if (Align in [alLeft, alRight]) then\r\n    eh.style.setProperty('cursor', 'col-resize');\r\n\r\n  if (Align in [alTop, alBottom]) then\r\n    eh.style.setProperty('cursor', 'row-resize');\r\n\r\n  FFirstMove := true;\r\n\r\n  eh.addEventListener('mousemove',@HandleDocDoMouseMove);\r\n  eh.addEventListener('mouseup',@HandleDocDoMouseUp);\r\n\r\n  //Capture;\r\nend;\r\n\r\n\r\nprocedure TSplitter.DoMouseEnter;\r\nbegin\r\n  inherited;\r\n  if (Align in [alLeft, alRight]) then\r\n    Cursor := crHSplit;\r\n\r\n  if (Align in [alTop, alBottom]) then\r\n    Cursor := crVSplit;\r\nend;\r\n\r\nfunction TSplitter.HandleDocDoMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  dx,dy: integer;\r\nbegin\r\n  if FSizing and Assigned(FSplitControl) then\r\n  begin\r\n    if FFirstMove then\r\n    begin\r\n      FSizingX := Event.clientX;\r\n      FSizingY := Event.clientY;\r\n      FFirstMove := false;\r\n    end\r\n    else\r\n    begin\r\n      dx := Round(Event.clientX - FSizingX);\r\n      dy := Round(Event.clientY - FSizingY);\r\n\r\n      if Align = alLeft then\r\n        FSplitControl.Width := FOriginalWidth + dx;\r\n\r\n      if Align = alRight then\r\n        FSplitControl.Width := FOriginalWidth - dx;\r\n\r\n      if Align = alTop then\r\n        FSplitControl.Height := FOriginalHeight + dy;\r\n\r\n      if Align = alBottom then\r\n        FSplitControl.Height := FOriginalHeight - dy;\r\n\r\n      DoRealign;\r\n\r\n      if Assigned(OnMove) then\r\n        OnMove(Self);\r\n\r\n    end;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nfunction TSplitter.HandleDocDoMouseUp(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FSizing := false;\r\n  FSplitControl := nil;\r\n  FFirstMove := true;\r\n  FLayer.parentNode.removeChild(FLayer);\r\n  Result := true;\r\n  if Assigned(OnMoved) then\r\n    OnMoved(Self);\r\nend;\r\n\r\n{ TDivPanel }\r\n\r\nfunction TDivPanel.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\n{ TCustomPanel }\r\n\r\nprocedure TCustomPanel.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  EnablePropagation := True;\r\n  FAutoSize := False;\r\n  Color := clBtnFace;\r\n  TabStop := False;\r\n  CustomBorder := true;\r\n  ShowCaption := true;\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  FLabel := nil;\r\n  FPadding := TPadding.Create;\r\n\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\nend;\r\n\r\ndestructor TCustomPanel.Destroy;\r\nbegin\r\n  FPadding.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomPanel.EndUpdate;\r\nbegin\r\n  inherited;\r\n  if AutoSize then\r\n    AutoSize := true;\r\nend;\r\n\r\nfunction TCustomPanel.GetChildContainer: TJSElement;\r\nbegin\r\n  if Assigned(FPanelBody) then\r\n    Result := FPanelBody\r\n  else\r\n    Result := inherited;\r\nend;\r\n\r\nfunction TCustomPanel.GetOuterHeight: integer;\r\nbegin\r\n  Result := inherited GetOuterHeight;\r\nend;\r\n\r\nfunction TCustomPanel.GetOuterWidth: integer;\r\nbegin\r\n  Result := inherited GetOuterWidth;\r\nend;\r\n\r\nfunction TCustomPanel.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n  FPanelBody := TJSHTMLElement(document.createElement('DIV'));\r\n  FPanelBody['class'] := 'card-body';\r\n  Result.appendChild(FPanelBody);\r\nend;\r\n\r\nprocedure TCustomPanel.SetAutoSize(AValue: boolean);\r\nvar\r\n  i: integer;\r\n  mx,my: integer;\r\n  r: TJSDomRect;\r\n  el: TJSElement;\r\nbegin\r\n  FAutoSize := AValue;\r\n  if FAutoSize and not IsUpdating then\r\n  begin\r\n    if (WidthStyle = ssAbsolute) and (HeightStyle = ssAbsolute) then\r\n    begin\r\n      mx := 0;\r\n      my := 0;\r\n      for i := 0 to ControlCount - 1 do\r\n      begin\r\n        if Controls[i].WidthStyle = ssAbsolute then\r\n        begin\r\n          if Controls[i].Left + Controls[i].Width > mx then\r\n            mx := Controls[i].Left + Controls[i].Width;\r\n        end\r\n        else\r\n        begin\r\n          el := Controls[i].ElementHandle;\r\n          if Assigned(el) then\r\n          begin\r\n            r := el.getBoundingClientRect;\r\n            if r.X - Left + r.Width > mx then\r\n              mx := Round(r.X  - Left + r.Width);\r\n          end;\r\n        end;\r\n\r\n        if Controls[i].HeightStyle = ssAbsolute then\r\n        begin\r\n          if Controls[i].Top + Controls[i].Height > my then\r\n            my := Controls[i].Top + Controls[i].Height;\r\n        end\r\n        else\r\n        begin\r\n          el := Controls[i].ElementHandle;\r\n          if Assigned(el) then\r\n          begin\r\n            r := el.getBoundingClientRect;\r\n            if r.Y - Top + r.Height > my then\r\n              my := Round(r.Y - Top + r.Height);\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      Width := mx;\r\n      Height := my;\r\n    end\r\n    else\r\n    begin\r\n      Width := -1;\r\n      Height := -1;\r\n    end;\r\n\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomPanel.SetBorderStyle(const AValue: TBorderStyle);\r\nbegin\r\n  inherited;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomPanel.SetCaption(const AValue: string);\r\nbegin\r\n  inherited SetCaption(AValue);\r\n\r\n  if Assigned(ElementHandle) and ShowCaption then\r\n  begin\r\n    if not Assigned(FLabel) then\r\n    begin\r\n      FLabel := TJSHTMLElement(document.createElement('SPAN'));\r\n      FLabel.innerHTML := Caption;\r\n      if Assigned(ChildContainer) then\r\n        ChildContainer.appendChild(FLabel)\r\n      else\r\n        ElementHandle.appendChild(FLabel);\r\n\r\n      UpdateElementVisual;\r\n    end\r\n    else\r\n    begin\r\n      FLabel.innerHTML := Caption;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomPanel.SetPadding(const Value: TPadding);\r\nbegin\r\n  FPadding.Assign(Value);\r\nend;\r\n\r\nprocedure TCustomPanel.SetShowCaption(const Value: boolean);\r\nbegin\r\n  if (FShowCaption <> Value) then\r\n  begin\r\n    FShowCaption := Value;\r\n    UpdateElementVisual;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomPanel.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if not IsLinked then\r\n    begin\r\n      if AutoSize then\r\n      begin\r\n        ElementHandle.style.setProperty('overflow', '');\r\n        ElementHandle.style.setProperty('white-space', 'normal');\r\n        if Visible then\r\n          ElementHandle.style.setProperty('display', 'inline');\r\n      end\r\n      else\r\n      begin\r\n        ElementHandle.style.setProperty('overflow', 'hidden');\r\n        ElementHandle.style.setProperty('white-space', 'nowrap');\r\n        if Visible then\r\n          ElementHandle.style.setProperty('display', 'inline-block');\r\n      end;\r\n\r\n      ElementHandle.style.setProperty('padding-left',inttostr(Padding.Left)+'px');\r\n      ElementHandle.style.setProperty('padding-right',inttostr(Padding.Right)+'px');\r\n      ElementHandle.style.setProperty('padding-top',inttostr(Padding.Top)+'px');\r\n      ElementHandle.style.setProperty('padding-bottom',inttostr(Padding.Bottom)+'px');\r\n      ElementHandle.style.setProperty('box-sizing','border-box');\r\n\r\n      if ElementBodyClassName <> '' then\r\n        ChildContainer.setAttribute('class', ElementBodyClassName)\r\n      else\r\n        ChildContainer.removeAttribute('class');\r\n    end;\r\n\r\n    if Assigned(FLabel) then\r\n    begin\r\n      if ShowCaption then\r\n        FLabel.innerHTML := Caption\r\n      else\r\n        FLabel.innerHTML := '';\r\n\r\n      // center the label\r\n      if Visible then\r\n      begin\r\n        ElementHandle.style.setProperty('display','flex');\r\n        ElementHandle.style.setProperty('justify-content','center');\r\n        ElementHandle.style.setProperty('align-items','center');\r\n      end;\r\n    end;\r\n\r\n    // do not block selection in child controls\r\n    ElementHandle.style.setProperty('user-select', '');\r\n\r\n    // allow default caret on text\r\n    if Cursor = crDefault then\r\n      ElementHandle.style.setProperty('cursor', '');\r\n  end;\r\nend;\r\n\r\n{ TGeoLocation }\r\n\r\nfunction TGeoLocation.CreateElement: TJSElement;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nprocedure TGeoLocation.DoHandleGeolocation(APosition: TJSPosition);\r\nbegin\r\n  if Assigned(OnGeolocation) then\r\n    OnGeolocation(Self, APosition.Coords.Latitude, APosition.Coords.Longitude, APosition.Coords.Altitude);\r\nend;\r\n\r\nprocedure TGeoLocation.GetGeolocation;\r\nbegin\r\n  if Assigned(geolocation) then\r\n  begin\r\n    geolocation.getCurrentPosition(TJSGeoLocationCallback(@DoHandleGeoLocation));\r\n  end;\r\nend;\r\n\r\nfunction TGeoLocation.HasGeolocation: boolean;\r\nbegin\r\n  Result := Assigned(geolocation);\r\nend;\r\n\r\n{ TGridPanelRows }\r\n\r\nfunction TGridPanelRows.Add: TGridPanelRow;\r\nbegin\r\n  Result := TGridPanelRow(inherited Add);\r\nend;\r\n\r\nconstructor TGridPanelRows.Create(AOwner: TComponent);\r\nbegin\r\n   inherited Create(AOwner, TGridPanelRow);\r\nend;\r\n\r\nfunction TGridPanelRows.GetItem(Index: integer): TGridPanelRow;\r\nbegin\r\n  Result := TGridPanelRow(inherited Items[Index]);\r\nend;\r\n\r\nfunction TGridPanelRows.Insert(Index: integer): TGridPanelRow;\r\nbegin\r\n  Result := TGridPanelRow(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TGridPanelRows.SetItem(Index: integer; const Value: TGridPanelRow);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nprocedure TGridPanelRows.Update(Item: TCollectionItem);\r\nbegin\r\n  inherited;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{ TGridPanelColumns }\r\n\r\nfunction TGridPanelColumns.Add: TGridPanelColumn;\r\nbegin\r\n  Result := TGridPanelColumn(inherited Add);\r\nend;\r\n\r\nconstructor TGridPanelColumns.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TGridPanelColumn);\r\nend;\r\n\r\nfunction TGridPanelColumns.GetItem(Index: integer): TGridPanelColumn;\r\nbegin\r\n  Result := TGridPanelColumn(inherited Items[Index]);\r\nend;\r\n\r\nfunction TGridPanelColumns.Insert(Index: integer): TGridPanelColumn;\r\nbegin\r\n  Result := TGridPanelColumn(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TGridPanelColumns.SetItem(Index: integer;\r\n  const Value: TGridPanelColumn);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nprocedure TGridPanelColumns.Update(Item: TCollectionItem);\r\nbegin\r\n  inherited;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{ TGridPanel }\r\n\r\nprocedure TGridPanel.AddControl(AControl: TWinControl);\r\nbegin\r\n  FControlCollection.Add.Control := AControl;\r\n  AControl.Parent := Self;\r\n\r\n  if FControlCollection.Count > FColumnCollection.Count * FRowCollection.Count then\r\n  begin\r\n    if ExpandStyle = esAddRows then\r\n      FRowCollection.Add\r\n    else\r\n      FColumnCollection.Add;\r\n  end;\r\nend;\r\n\r\nfunction TGridPanel.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nprocedure TGridPanel.CreateInitialize;\r\nbegin\r\n  inherited;\r\n\r\n  FDesignTime := (csDesigning in ComponentState) and not\r\n    ((csReading in Owner.ComponentState) or (csLoading in Owner.ComponentState));\r\n\r\n  EnablePropagation := true;\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  FUpdateTable := true;\r\n  FColCount := -1;\r\n  FRowCollection := TGridPanelRows.Create(Self);\r\n  FRowCollection.PropName := 'RowCollection';\r\n\r\n  if FDesignTime then\r\n  begin\r\n    FRowCollection.Add;\r\n    FRowCollection[0].Value := 100;\r\n    FRowCollection[0].SizeStyle := ssPercent;\r\n    FRowCollection.OnChange := TableChanged;\r\n  end;\r\n  FColumnCollection := TGridPanelColumns.Create(Self);\r\n  FColumnCollection.PropName := 'ColumnCollection';\r\n\r\n  if FDesignTime then\r\n  begin\r\n    FColumnCollection.Add;\r\n    FColumnCollection.Add;\r\n    FColumnCollection[0].Value := 50;\r\n    FColumnCollection[1].Value := 50;\r\n    FColumnCollection[0].SizeStyle := ssPercent;\r\n    FColumnCollection[1].SizeStyle := ssPercent;\r\n  end;\r\n\r\n  FColumnCollection.OnChange := TableChanged;\r\n\r\n  FControlCollection := TControlCollection.Create(Self);\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\nend;\r\n\r\nfunction TGridPanel.CreateRow(AIndex: integer): TJSElement;\r\nvar\r\n  row, cell: TJSElement;\r\n  i: integer;\r\n  ps: string;\r\n\r\nbegin\r\n  if (GridLineColor <> clNone) and (GridLineWidth > 0) then\r\n    ps := IntToStr(GridLineWidth)+'px solid '+ ColorToHTML(GridLineColor)\r\n  else\r\n  begin\r\n    if (csDesigning in ComponentState) then\r\n      ps := '1px dotted gray'\r\n    else\r\n      ps := '0px';\r\n  end;\r\n\r\n  row := document.createElement('tr');\r\n  if (ElementClassName = '') then\r\n    TJSHTMLElement(row).style.setProperty('border', ps);\r\n\r\n  if RowCollection.Items[AIndex].MarginTop <> 0 then\r\n    TJSHTMLElement(row).style.setProperty('margin-top', IntToStr(RowCollection.Items[AIndex].MarginTop));\r\n\r\n  if RowCollection.Items[AIndex].MarginBottom <> 0 then\r\n    TJSHTMLElement(row).style.setProperty('margin-bottom', IntToStr(RowCollection.Items[AIndex].MarginBottom));\r\n\r\n  if (RowCollection.Items[AIndex].ElementClassName <> '') then\r\n  begin\r\n    TJSHTMLElement(row).setAttribute('class', RowCollection.Items[AIndex].ElementClassName);\r\n  end;\r\n\r\n  case RowCollection.Items[AIndex].Alignment of\r\n  vaCenter: TJSHTMLElement(row).setAttribute('valign','middle');\r\n  vaBottom: TJSHTMLElement(row).setAttribute('valign','bottom');\r\n  end;\r\n\r\n  if (ElementClassName = '') then\r\n    TJSHTMLElement(row).style.setProperty('border', ps);\r\n\r\n  row.setAttribute('height', RowCollection.Items[AIndex].HeightAttribute);\r\n\r\n  for i := 0 to ColumnCollection.Count - 1 do\r\n  begin\r\n    cell := document.createElement('td');\r\n    if (ElementClassName = '') then\r\n      TJSHTMLElement(cell).style.setProperty('border', ps);\r\n\r\n    if ColumnCollection.Items[i].MarginLeft <> 0 then\r\n      TJSHTMLElement(cell).style.setProperty('margin-left', IntToStr(ColumnCollection.Items[i].MarginLeft));\r\n\r\n    if ColumnCollection.Items[i].MarginRight <> 0 then\r\n      TJSHTMLElement(cell).style.setProperty('margin-right', IntToStr(ColumnCollection.Items[i].MarginRight));\r\n\r\n    if (ColumnCollection.Items[i].ElementClassName <> '') then\r\n    begin\r\n      TJSHTMLElement(cell).setAttribute('class', ColumnCollection.Items[i].ElementClassName);\r\n    end;\r\n\r\n    case ColumnCollection.Items[i].Alignment of\r\n    taCenter: TJSHTMLElement(cell).setAttribute('align','center');\r\n    taRightJustify: TJSHTMLElement(cell).setAttribute('align','right');\r\n    end;\r\n\r\n    cell.setAttribute('id', Name+'R'+IntToStr(AIndex)+'C'+IntToStr(i));\r\n\r\n    if AIndex = 0 then\r\n    begin\r\n      TJSHTMLElement(cell).style.setProperty('width',ColumnCollection.Items[i].WidthAttribute);\r\n    end;\r\n\r\n    //cellText := document.createTextNode('cell is row '+IntToStr(j)+', column '+IntToStr(i));\r\n    //cell.appendChild(cellText);\r\n    row.appendChild(cell);\r\n  end;\r\n\r\n  Result := row;\r\nend;\r\n\r\n\r\nfunction TGridPanel.CreateTable: TJSElement;\r\nvar\r\n  row: TJSElement;\r\n  j: integer;\r\n  ps: string;\r\nbegin\r\n  FTbl := document.createElement('table');\r\n\r\n  FTbl.setAttribute('width','100%');\r\n  FTbl.setAttribute('height','100%');\r\n\r\n  if ElementClassName <> '' then\r\n    FTbl.setAttribute('class', ElementClassName)\r\n  else\r\n  begin\r\n    if (GridLineColor <> clNone) and (GridLineWidth > 0) then\r\n      ps := IntToStr(GridLineWidth)+'px solid '+ ColorToHTML(GridLineColor)\r\n    else\r\n    begin\r\n      if (csDesigning in ComponentState) then\r\n        ps := '1px dotted gray'\r\n      else\r\n        ps := '0px';\r\n    end;\r\n\r\n    TJSHTMLElement(FTbl).style.setProperty('border', ps);\r\n    TJSHTMLElement(FTbl).style.setProperty('border-collapse','collapse');\r\n  end;\r\n\r\n  SetHTMLElementColor(TJSHTMLElement(FTbl), Color, not ((ElementClassName = '') and not IsLinked));\r\n\r\n  FTblBody := document.createElement('tbody');\r\n\r\n  // cells creation\r\n  for  j := 0 to RowCollection.Count - 1 do\r\n  begin\r\n    row := CreateRow(j);\r\n    FTblBody.appendChild(row);\r\n  end;\r\n\r\n  // append the <tbody> inside the <table>\r\n  FTbl.appendChild(FTblBody);\r\n  Result := FTbl;\r\nend;\r\n\r\nprocedure TGridPanel.UpdateTable;\r\nvar\r\n  i,j,k,numrows: integer;\r\n  fragment: TJSDocumentFragment;\r\n  ctrlid,destid: string;\r\n  control: TWinControl;\r\n  el,row: TJSElement;\r\n  isPercent: boolean;\r\n\r\nbegin\r\n  if not Assigned(FTblBody) then\r\n    Exit;\r\n\r\n  i := 0;\r\n  j := 0;\r\n\r\n  if FTblBody.childNodes.length < RowCollection.Count then\r\n  begin\r\n    isPercent := true;\r\n    for k := 0 to RowCollection.Count - 1 do\r\n    begin\r\n      if RowCollection.Items[k].SizeStyle <> ssPercent then\r\n      begin\r\n        isPercent := false;\r\n        break;\r\n      end;\r\n    end;\r\n\r\n    if isPercent then\r\n    begin\r\n      for k := 0 to RowCollection.Count - 1 do\r\n      begin\r\n        RowCollection.Items[k].Value := Trunc(100/RowCollection.Count);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  numrows := RowCollection.Count;\r\n\r\n  // change column structure\r\n  if (FColCount <> ColumnCollection.Count) then\r\n    numrows := 0;\r\n\r\n  // remove rows when rows decreased\r\n  while FTblBody.childNodes.length > numrows do\r\n  begin\r\n    FTblBody.removeChild(FTblBody.childNodes[FTblBody.childNodes.length - 1]);\r\n  end;\r\n\r\n  // fill rows to match RowCollection.Count\r\n  while FTblBody.childNodes.length < RowCollection.Count do\r\n  begin\r\n    row := CreateRow(FTblBody.childNodes.length);\r\n    FTblBody.appendChild(row);\r\n    row.setAttribute('height', RowCollection.Items[j].HeightAttribute);\r\n  end;\r\n\r\n  // assign controls in grid cells\r\n  for k := 0 to ControlCollection.Count - 1 do\r\n  begin\r\n    if Assigned(ControlCollection.Items[k].Control) then\r\n    begin\r\n      fragment := document.createDocumentFragment();\r\n      control := ControlCollection.Items[k].Control;\r\n      ControlCollection.Items[k].Column := i;\r\n      ControlCollection.Items[k].Row := j;\r\n\r\n      control.ElementPosition := epRelative;\r\n      control.ChildOrder := -1;\r\n      ctrlid := control.GetID;\r\n\r\n      if control.Align = alLeft then\r\n      begin\r\n        control.HeightStyle := ssPercent;\r\n        control.Height := 100;\r\n        if Assigned(control.ElementHandle) then\r\n          TJSHTMLElement(control.ElementHandle).style.setProperty('float','left');\r\n      end;\r\n\r\n      if control.Align = alRight then\r\n      begin\r\n        control.HeightStyle := ssPercent;\r\n        control.Height := 100;\r\n        if Assigned(control.ElementHandle) then\r\n          TJSHTMLElement(control.ElementHandle).style.setProperty('float','right');\r\n      end;\r\n\r\n      if (control.Align in [alTop, alBottom]) then\r\n      begin\r\n        control.WidthStyle := ssPercent;\r\n        control.Width := 100;\r\n      end;\r\n\r\n      if control.Align = alClient then\r\n      begin\r\n        control.WidthStyle := ssPercent;\r\n        control.HeightStyle := ssPercent;\r\n        control.Width := 100;\r\n        control.Height:= 100;\r\n      end;\r\n\r\n      row := TJSElement(FTblBody.childNodes[j]);\r\n      if Assigned(row) then\r\n      begin\r\n        row.setAttribute('height', RowCollection.Items[j].HeightAttribute);\r\n        if (RowCollection.Items[j].ElementClassName <> '') then\r\n          row.setAttribute('class', RowCollection.Items[j].ElementClassName)\r\n        else\r\n          row.removeAttribute('class');\r\n      end;\r\n\r\n      fragment.appendChild(document.getElementById(ctrlid));\r\n\r\n      destid := Name + 'R'+ inttostr(j) + 'C' + inttostr(i);\r\n\r\n      el := document.getElementById(destid);\r\n\r\n      if not Assigned(el) then\r\n      begin\r\n        row := CreateRow(j);\r\n        FTblBody.appendChild(row);\r\n        el := document.getElementById(destid);\r\n        row.setAttribute('height', RowCollection.Items[j].HeightAttribute);\r\n      end\r\n      else\r\n      begin\r\n        if (j = 0) then\r\n        begin\r\n          if ColumnCollection.Items[i].SizeStyle = ssAbsolute then\r\n          begin\r\n            TJSHTMLElement(FTbl).removeAttribute('width');\r\n            TJSHTMLElement(FTbl).removeAttribute('height');\r\n          end\r\n          else\r\n          begin\r\n            TJSHTMLElement(FTbl).setAttribute('width','100%');\r\n            TJSHTMLElement(FTbl).setAttribute('height','100%');\r\n          end;\r\n\r\n          TJSHTMLElement(el).style.setProperty('width',ColumnCollection.Items[i].WidthAttribute);\r\n        end;\r\n      end;\r\n\r\n      el.appendChild(fragment);\r\n\r\n      if control.Align = alTop then\r\n        TJSHTMLElement(el).style.setProperty('vertical-align','top');\r\n\r\n      if control.Align = alBottom then\r\n        TJSHTMLElement(el).style.setProperty('vertical-align','bottom');\r\n\r\n      inc(i);\r\n      if i = ColumnCollection.Count then\r\n      begin\r\n        i := 0;\r\n        inc(j);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  FColCount := ColumnCollection.Count;\r\nend;\r\n\r\ndestructor TGridPanel.Destroy;\r\nbegin\r\n  FRowCollection.Free;\r\n  FColumnCollection.Free;\r\n  FControlCollection.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TGridPanel.EndUpdate;\r\nbegin\r\n  inherited;\r\n  UpdateTable;\r\nend;\r\n\r\nprocedure TGridPanel.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nvar\r\n  i: integer;\r\n  destid: string;\r\n  el: TJSElement;\r\nbegin\r\n  if (Operation = opRemove) and not (csDestroying in ComponentState) then\r\n  begin\r\n    for i := ControlCollection.Count - 1 downto 0 do\r\n    begin\r\n      if ControlCollection.Items[i].Control = AComponent then\r\n      begin\r\n        destid := Name + 'R'+ inttostr(ControlCollection.Items[i].Row) + 'C' + inttostr(ControlCollection.Items[i].Column);\r\n        el := document.getElementById(destid);\r\n        el.removeChild(el.firstChild);\r\n\r\n        ControlCollection.Items[i].FControl := nil;\r\n        ControlCollection.Delete(i);\r\n      end;\r\n    end;\r\n\r\n    UpdateTable;\r\n  end;\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TGridPanel.RegisterParent(AValue: TControl);\r\nbegin\r\n  inherited;\r\n\r\n  if not IsUpdating and not (csLoading in ComponentState) then\r\n  begin\r\n    ControlCollection.Add.Control := TWinControl(AValue);\r\n\r\n    if ControlCollection.Count > ColumnCollection.Count * RowCollection.Count then\r\n    begin\r\n      if ExpandStyle = esAddRows then\r\n        RowCollection.Add\r\n      else\r\n        ColumnCollection.Add;\r\n    end;\r\n\r\n    UpdateTable;\r\n  end;\r\nend;\r\n\r\nprocedure TGridPanel.RemoveControl(AControl: TWinControl);\r\nvar\r\n  i,r,c: integer;\r\n  row: TJSElement;\r\n  d: double;\r\n\r\nbegin\r\n  for i := 0 to FControlCollection.Count - 1 do\r\n  begin\r\n    if FControlCollection.Items[i].Control =  AControl then\r\n    begin\r\n      r := FControlCollection.Items[i].Row;\r\n      c := FControlCollection.Items[i].Column;\r\n\r\n      row := TJSElement(FTblBody.childNodes[r]);\r\n\r\n      TJSHTMLElement(row.childNodes[c]).innerHTML := '';\r\n\r\n      FControlCollection.Delete(i);\r\n      break;\r\n    end;\r\n  end;\r\n\r\n  if ColumnCollection.Count > 0 then\r\n  begin\r\n    d := ControlCollection.Count / ColumnCollection.Count;\r\n\r\n    if Frac(d) > 0 then\r\n      d := Trunc(d + 1);\r\n\r\n    while d < RowCollection.Count do\r\n    begin\r\n      RowCollection.Delete(RowCollection.Count - 1);\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TGridPanel.SetColumnCollection(const Value: TGridPanelColumns);\r\nbegin\r\n  FColumnCollection.Assign(Value);\r\nend;\r\n\r\nprocedure TGridPanel.SetControlCollection(const Value: TControlCollection);\r\nbegin\r\n  FControlCollection.Assign(Value);\r\nend;\r\n\r\nprocedure TGridPanel.SetRowCollection(const Value: TGridPanelRows);\r\nbegin\r\n  FRowCollection.Assign(Value);\r\nend;\r\n\r\nprocedure TGridPanel.TableChanged(Sender: TObject);\r\nbegin\r\n  UpdateTable;\r\nend;\r\n\r\nprocedure TGridPanel.UpdateElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) and not IsUpdating then\r\n  begin\r\n    // do not block selection in child controls\r\n    ElementHandle.style.setProperty('user-select', '');\r\n\r\n    // allow default caret on text\r\n    if Cursor = crDefault then\r\n      ElementHandle.style.setProperty('cursor', '');\r\n\r\n    if FUpdateTable and Assigned(Container) then\r\n    begin\r\n      TJSElement(Container).appendChild(CreateTable);\r\n      UpdateTable;\r\n      FUpdateTable := false;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TGridPanel.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    ElementHandle.style.setProperty('border', '1px dotted gray');\r\n  end;\r\nend;\r\n\r\n{ TGridPanelColumn }\r\n\r\nprocedure TGridPanelColumn.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TGridPanelColumn) then\r\n  begin\r\n    FAlignment := (Source as TGridPanelColumn).Alignment;\r\n    FSizeStyle := (Source as TGridPanelColumn).SizeStyle;\r\n    FElementClassName := (Source as TGridPanelColumn).ElementClassName;\r\n    FValue := (Source as TGridPanelColumn).Value;\r\n    FMarginLeft := (Source as TGridPanelColumn).MarginLeft;\r\n    FMarginRight := (Source as TGridPanelColumn).MarginRight;\r\n  end;\r\nend;\r\n\r\nconstructor TGridPanelColumn.Create(ACollection: TCollection);\r\nbegin\r\n  inherited;\r\n  FSizeStyle := ssPercent;\r\n  FMarginLeft := 0;\r\n  FMarginRight := 0;\r\n  FAlignment := taLeftJustify;\r\nend;\r\n\r\nprocedure TGridPanelColumn.SetMarginLeft(const Value: integer);\r\nbegin\r\n  if (FMarginLeft <> Value) then\r\n  begin\r\n    FMarginLeft := Value;\r\n    TGridPanelColumns(Collection).Update(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TGridPanelColumn.SetMarginRight(const Value: integer);\r\nbegin\r\n  if (FMarginRight <> Value) then\r\n  begin\r\n    FMarginRight := Value;\r\n    TGridPanelColumns(Collection).Update(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TGridPanelColumn.SetSizeStyle(const Value: TSizeStyle);\r\nbegin\r\n  if (FSizeStyle <> Value) then\r\n  begin\r\n    FSizeStyle := Value;\r\n    TGridPanelColumns(Collection).Update(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TGridPanelColumn.SetValue(const Value: integer);\r\nbegin\r\n  if (FValue <> Value) then\r\n  begin\r\n    FValue := Value;\r\n    TGridPanelColumns(Collection).Update(Self);\r\n  end;\r\nend;\r\n\r\nfunction TGridPanelColumn.WidthAttribute: string;\r\nbegin\r\n  Result := '';\r\n  case SizeStyle of\r\n  ssPercent: Result := IntTostr(Value)+'%';\r\n  ssAbsolute: Result := IntTostr(Value)+'px';\r\n  end;\r\nend;\r\n\r\n{ TGridPanelRow }\r\n\r\nprocedure TGridPanelRow.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TGridPanelRow) then\r\n  begin\r\n    FAlignment := (Source as TGridPanelRow).Alignment;\r\n    FSizeStyle := (Source as TGridPanelRow).SizeStyle;\r\n    FElementClassName := (Source as TGridPanelRow).ElementClassName;\r\n    FValue := (Source as TGridPanelRow).Value;\r\n    FMarginTop := (Source as TGridPanelRow).MarginTop;\r\n    FMarginBottom := (Source as TGridPanelRow).MarginBottom;\r\n  end;\r\nend;\r\n\r\nconstructor TGridPanelRow.Create(ACollection: TCollection);\r\nbegin\r\n  inherited;\r\n  FSizeStyle := ssPercent;\r\n  FAlignment := vaTop;\r\n  FMarginTop := 0;\r\n  FMarginBottom := 0;\r\nend;\r\n\r\nfunction TGridPanelRow.HeightAttribute: string;\r\nbegin\r\n  Result := '';\r\n  case SizeStyle of\r\n  ssPercent: Result := IntTostr(Value)+'%';\r\n  ssAbsolute: Result := IntTostr(Value)+'px';\r\n  end;\r\nend;\r\n\r\nprocedure TGridPanelRow.SetMarginBottom(const Value: integer);\r\nbegin\r\n  if (FMarginBottom <> Value) then\r\n  begin\r\n    FMarginBottom := Value;\r\n    TGridPanelColumns(Collection).Update(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TGridPanelRow.SetMarginTop(const Value: integer);\r\nbegin\r\n  if (FMarginTop <> Value) then\r\n  begin\r\n    FMarginTop := Value;\r\n    TGridPanelColumns(Collection).Update(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TGridPanelRow.SetSizeStyle(const Value: TSizeStyle);\r\nbegin\r\n  if (FSizeStyle <> Value) then\r\n  begin\r\n    FSizeStyle := Value;\r\n    TGridPanelColumns(Collection).Update(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TGridPanelRow.SetValue(const Value: integer);\r\nbegin\r\n  if (FValue <> Value) then\r\n  begin\r\n    FValue := Value;\r\n    TGridPanelColumns(Collection).Update(Self);\r\n  end;\r\nend;\r\n\r\n{ TControlCollectionItem }\r\n\r\nprocedure TControlCollectionItem.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TControlCollectionItem) then\r\n  begin\r\n    FColumn := (Source as TControlCollectionItem).Column;\r\n    FRow := (Source as TControlCollectionItem).Row;\r\n    FControl := (Source as TControlCollectionItem).Control;\r\n  end;\r\nend;\r\n\r\n\r\n{ TControlCollection }\r\n\r\nfunction TControlCollection.Add: TControlCollectionItem;\r\nbegin\r\n  Result := TControlCollectionItem(inherited Add);\r\nend;\r\n\r\nconstructor TControlCollection.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TControlCollectionItem);\r\nend;\r\n\r\nfunction TControlCollection.GetItem(Index: Integer): TControlCollectionItem;\r\nbegin\r\n  Result := TControlCollectionItem(inherited Items[Index]);\r\nend;\r\n\r\nfunction TControlCollection.Insert(Index: Integer): TControlCollectionItem;\r\nbegin\r\n  Result := TControlCollectionItem(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TControlCollection.SetItem(Index: Integer;\r\n  const Value: TControlCollectionItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TWebMultimediaPlayer }\r\n\r\nfunction TMultimediaPlayer.CreateElement: TJSElement;\r\nvar\r\n  src: TJSElement;\r\nbegin\r\n  if MultimediaType = mtVideo then\r\n    Result := document.createElement('VIDEO')\r\n  else\r\n    Result := document.createElement('AUDIO');\r\n\r\n  src := document.createElement('SOURCE');\r\n  Result.appendChild(src);\r\nend;\r\n\r\nprocedure TMultimediaPlayer.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FVolume := 100;\r\n  FPlaybackRate := 1;\r\n  FMuted := false;\r\n  FAutoPlay := false;\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\nend;\r\n\r\nfunction TMultimediaPlayer.GetCurrentTime: double;\r\nvar\r\n  el: TJSElement;\r\n  i: double;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      i = el.currentTime;\r\n    end;\r\n  end;\r\n\r\n  Result := i;\r\nend;\r\n\r\nfunction TMultimediaPlayer.GetDuration: double;\r\nvar\r\n  el: TJSElement;\r\n  i: double;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      i = el.duration;\r\n    end;\r\n  end;\r\n  Result := i;\r\nend;\r\n\r\nfunction TMultimediaPlayer.GetEnded: boolean;\r\nvar\r\n  el: TJSElement;\r\n  e: boolean;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      e = el.ended;\r\n    end;\r\n  end;\r\n\r\n  Result := e;\r\nend;\r\n\r\nfunction TMultimediaPlayer.GetPaused: boolean;\r\nvar\r\n  el: TJSElement;\r\n  e: boolean;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      e = el.paused;\r\n    end;\r\n  end;\r\n\r\n  Result := e;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.Pause;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      el.pause();\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TMultimediaPlayer.Play;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  asm\r\n    el.play();\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.ReLoad;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  asm\r\n    el.load();\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetAutoPlay(const Value: boolean);\r\nbegin\r\n  if (FAutoPlay <> Value) then\r\n  begin\r\n    FAutoPlay := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetControls(const Value: boolean);\r\nbegin\r\n  if (FControls <> Value) then\r\n  begin\r\n    FControls := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetCurrentTime(const Value: double);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  asm\r\n    el.currentTime = Value;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetLoop(const Value: boolean);\r\nbegin\r\n  if (FLoop <> Value) then\r\n  begin\r\n    FLoop := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetMuted(const Value: boolean);\r\nbegin\r\n  if (FMuted <> Value) then\r\n  begin\r\n    FMuted := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetPlaybackRate(const Value: double);\r\nbegin\r\n  if (FPlaybackRate <> Value) then\r\n  begin\r\n    FPlaybackRate := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetURL(const Value: string);\r\nbegin\r\n  if (FURL <> Value) then\r\n  begin\r\n    FURL := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetVolume(const Value: TMultiMediaVolume);\r\nbegin\r\n  if (FVolume <> Value) then\r\n  begin\r\n    FVolume := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TMultimediaPlayer.UpdateElement;\r\nvar\r\n  el: TJSNode;\r\n  vid: TJSElement;\r\n\r\n  function booltoattr(b: boolean): string;\r\n  begin\r\n    if b then\r\n      result := 'true'\r\n    else\r\n      result := 'false';\r\n  end;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    vid := TJSElement(ElementHandle);\r\n    asm\r\n      vid.controls = this.FControls;\r\n      vid.playbackRate = this.FPlaybackRate;\r\n      vid.muted = this.FMuted;\r\n    end;\r\n\r\n    //ElementHandle.setAttribute('controls',booltoattr(FControls));\r\n    ElementHandle.setAttribute('autoplay',booltoattr(FAutoplay));\r\n    ElementHandle.setAttribute('muted',booltoattr(FMuted));\r\n    ElementHandle.setAttribute('volume',Format('%.2f',[FVolume/100]));\r\n\r\n    ElementHandle.setAttribute('src',url);\r\n\r\n//    el := ElementHandle.firstChild;\r\n//    if Assigned(el) then\r\n//    begin\r\n//      (el as TJSElement).setAttribute('src',url);\r\n//      (el as TJSElement).setAttribute('type','video/mp4');\r\n//    end;\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\n{ TCustomGroupBox }\r\n\r\nfunction TCustomGroupBox.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n\r\n  FControlSpan := TJSHTMLElement(document.createElement('SPAN'));\r\n  FCaptionSpan := TJSHTMLElement(document.createElement('SPAN'));\r\n\r\n  Result.appendChild(FControlSpan);\r\n  Result.appendChild(FCaptionSpan);\r\nend;\r\n\r\nprocedure TCustomGroupBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  EnablePropagation := True;\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  Color := clBtnFace;\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomGroupBox.SetCaption(const Value: string);\r\nbegin\r\n  if FCaption <> Value then\r\n  begin\r\n    FCaption := Value;\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomGroupBox.UpdateElementData;\r\nbegin\r\n  inherited;\r\n  if Assigned(FCaptionSpan) then\r\n  begin\r\n    FCaptionSpan.innerHTML := FCaption;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomGroupBox.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('overflow', 'visible');\r\n\r\n    ElementHandle.style.setProperty('white-space', 'nowrap');\r\n\r\n    if Visible then\r\n      ElementHandle.style.setProperty('display', 'inline-block');\r\n\r\n    ElementHandle.style.setProperty('webkit-user-select', 'none');\r\n    ElementHandle.style.setProperty('moz-user-select', 'none');\r\n    ElementHandle.style.setProperty('khtml-user-select', 'none');\r\n    ElementHandle.style.setProperty('ms-user-select', 'none');\r\n    ElementHandle.style.setProperty('user-select', 'none');\r\n\r\n    ElementHandle.style.setProperty('border-bottom','1px solid lightgray');\r\n\r\n    FCaptionSpan.style.setProperty('left','8px');\r\n    FCaptionSpan.style.setProperty('top','0px');\r\n    FCaptionSpan.style.setProperty('position','absolute');\r\n\r\n    SetHTMLElementColor(FCaptionSpan, Color, not (ElementClassName = ''));\r\n\r\n    FCaptionSpan.style.setProperty('zindex','100');\r\n\r\n    FControlSpan.style.setProperty('display','inline-block');\r\n    FControlSpan.style.setProperty('width','100%');\r\n    FControlSpan.style.setProperty('height','98%');\r\n    FControlSpan.style.setProperty('margin-top','8px');\r\n    FControlSpan.style.setProperty('border-style', 'solid');\r\n    FControlSpan.style.setProperty('border-width', '1px');\r\n    FControlSpan.style.setProperty('border-color', 'lightgray');\r\n\r\n    SetHTMLElementColor(FControlSpan, Color, not (ElementClassName = ''));\r\n  end;\r\nend;\r\n\r\n{ THTMLContainer }\r\n\r\nfunction THTMLContainer.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure THTMLContainer.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FHTML := TStringList.Create;\r\n  FHTML.OnChange := HTMLChanged;\r\n  FScrollStyle := ssBoth;\r\nend;\r\n\r\ndestructor THTMLContainer.Destroy;\r\nbegin\r\n  FHTML.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure THTMLContainer.HTMLChanged(Sender: TObject);\r\nbegin\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure THTMLContainer.SetHTML(const Value: TStringList);\r\nbegin\r\n  FHTML.Assign(Value);\r\nend;\r\n\r\nprocedure THTMLContainer.UpdateElement;\r\nvar\r\n  TextFound: Boolean;\r\nbegin\r\n  inherited;\r\n\r\n  if not IsUpdating and Assigned(ElementHandle) and Assigned(Container) then\r\n  begin\r\n    if (ElementClassname <> '') then\r\n    begin\r\n      ElementHandle.style.removeProperty('border');\r\n      ElementHandle.style.removeProperty('background-color');\r\n    end;\r\n\r\n    if Assigned(FHTML) then\r\n    begin\r\n      TextFound := FHTML.Text <> '';\r\n      Container.innerHTML := FHTML.Text;\r\n    end;\r\n\r\n    if (csDesigning in ComponentState) then\r\n      RenderDesigning(ClassName, Container, Self, (not TextFound));\r\n\r\n    case ScrollStyle of\r\n      ssBoth: ElementHandle.style.setProperty('overflow','auto');\r\n      ssNone: ElementHandle.style.setProperty('overflow','');\r\n      ssVertical: ElementHandle.style.setProperty('overflow-y','auto');\r\n      ssHorizontal: ElementHandle.style.setProperty('overflow-x','auto');\r\n    end;\r\n  end;\r\nend;\r\n\r\n\r\n{ THMTMLForm }\r\n\r\n{$HINTS OFF}\r\nprocedure THTMLForm.BindEvents;\r\nbegin\r\n  inherited;\r\n  ElementHandle.addEventListener('submit',@DoHandleSubmit);\r\nend;\r\n\r\nfunction  THTMLForm.CheckValidity: boolean;\r\nvar\r\n  el: TJSHTMLElement;\r\n  res: boolean;\r\nbegin\r\n  el := ElementHandle;\r\n  asm\r\n    res = el.checkValidity();\r\n  end;\r\n  Result := res;\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction THTMLForm.CreateElement: TJSElement;\r\nvar\r\n  LLabel: TJSHTMLElement;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Result := document.createElement('DIV');\r\n    LLabel := TJSHTMLElement(document.createElement('DIV'));\r\n    LLabel.innerHTML := 'TWebHTMLForm';\r\n    BorderStyle := bsSingle;\r\n    LLabel['align'] := 'center';\r\n    LLabel.style.setProperty('border','1px solid gray');\r\n    LLabel.style.setProperty('vertical-align','middle');\r\n    LLabel.style.setProperty('display','table-cell');\r\n    Result.appendChild(LLabel);\r\n  end\r\n  else\r\n  begin\r\n    Result := document.createElement('FORM');\r\n  end;\r\nend;\r\n\r\nprocedure THTMLForm.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  EnablePropagation := true;\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\nend;\r\n\r\nfunction THTMLForm.DoHandleSubmit(Event: TJSEvent): boolean;\r\nbegin\r\n  ElementEvent := Event;\r\n  if Assigned(OnSubmit) then\r\n    OnSubmit(Self);\r\n  Result := true;\r\nend;\r\n\r\nfunction THTMLForm.IsStructuralElement: boolean;\r\nbegin\r\n  Result := true;\r\nend;\r\n\r\nprocedure THTMLForm.SetAction(const Value: string);\r\nbegin\r\n  FAction := Value;\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle['action'] := FAction;\r\nend;\r\n\r\nprocedure THTMLForm.UpdateElement;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  if (csDesigning in ComponentState) and not (csDestroying in ComponentState) then\r\n  begin\r\n    eh := TJSHTMLElement(ElementHandle);\r\n    if Assigned(eh) then\r\n    begin\r\n      eh.style.setProperty('display','table');\r\n      eh.style.setProperty('background-color','silver');\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TBadge }\r\n\r\nfunction TBadge.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nprocedure TBadge.CreateInitialize;\r\nvar\r\n  css: string;\r\nbegin\r\n  inherited;\r\n  Color := clRed;\r\n  FTextColor := clWhite;\r\n  FText := '1';\r\n\r\n  css := 'span.tmsbadge {' +\r\n  '  background: #FF0000;' +\r\n  '  border-radius: 0.8em;' +\r\n  '  -moz-border-radius: 0.8em;' +\r\n  '  -webkit-border-radius: 0.8em;' +\r\n  '  color: #ffffff;' +\r\n  '  display: inline-block;' +\r\n  '  line-height: 1.6em;' +\r\n  '  margin-right: 5px;' +\r\n  '  text-align: center;' +\r\n  '  width: 1.6em;' +\r\n  '}';\r\n\r\n  AddControlStyle(css);\r\n\r\n  Width := 20;\r\n  Height := 20;\r\nend;\r\n\r\ndestructor TBadge.Destroy;\r\nbegin\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TBadge.SetElementClassName(AValue: string);\r\nbegin\r\n  inherited;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TBadge.SetText(const Value: string);\r\nbegin\r\n  FText := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TBadge.SetTextColor(const Value: TColor);\r\nbegin\r\n  FTextColor := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TBadge.UpdateElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.innerHTML := FText;\r\n\r\n    if ElementClassName = '' then\r\n    begin\r\n      ElementHandle.setAttribute('class','tmsbadge');\r\n      ElementHandle.style.setProperty('color',ColorToHTML(TextColor));\r\n    end\r\n    else\r\n    begin\r\n      ElementHandle.style.removeProperty('color');\r\n    end;\r\n\r\n    ElementHandle.style.removeProperty('width');\r\n    ElementHandle.style.removeProperty('height');\r\n  end;\r\nend;\r\n\r\n{ TAccordion }\r\n\r\nprocedure TAccordion.Collapse(ASection: TAccordionSection);\r\nvar\r\n  el,pnl: TJSHTMLElement;\r\n  LClass: string;\r\nbegin\r\n  el := ASection.CaptionElement;\r\n\r\n  LClass := 'accordionactive_'+Name;\r\n\r\n  if el.classList.contains(LClass) then\r\n    el.classList.remove(LClass);\r\n\r\n  pnl := TJSHTMLElement(el.nextElementSibling);\r\n  pnl.style.setProperty('max-height','0')\r\nend;\r\n\r\nfunction TAccordion.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure TAccordion.CreateInitialize;\r\nbegin\r\n  inherited;\r\n\r\n  FSections := TAccordionSections.Create(Self);\r\n  FSections.OnChange := SectionsChanged;\r\n  FSections.PropName := 'Sections';\r\n  FStyleRendered := false;\r\n\r\n  Width := 400;\r\n  Height := 300;\r\n\r\nend;\r\n\r\ndestructor TAccordion.Destroy;\r\nbegin\r\n  FSections.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TAccordion.DoAccordionClick(Event: TJSEvent): Boolean;\r\nvar\r\n  el: TJSElement;\r\n  pnl: TJSHTMLElement;\r\n  s: string;\r\n  Allow: boolean;\r\n  ASection: TAccordionSection;\r\n  i,e: integer;\r\nbegin\r\n  asm\r\n    el = Event.srcElement;\r\n  end;\r\n\r\n  Allow := true;\r\n  ASection := nil;\r\n\r\n  if el.hasAttribute('id') then\r\n  begin\r\n    s := el['id'];\r\n    s := Copy(s, pos(Name,s) + Length(Name) + 1, Length(s));\r\n    val(s,i,e);\r\n\r\n    if (e = 0) and (i < Sections.Count) then\r\n      ASection := Sections[i];\r\n  end;\r\n\r\n  if el.classlist.contains('accordionactive_'+Name) then\r\n  begin\r\n    if Assigned(OnCollapsing) then\r\n      OnCollapsing(Self, ASection, Allow);\r\n  end\r\n  else\r\n  begin\r\n    if Assigned(OnExpanding) then\r\n      OnExpanding(Self, ASection, Allow);\r\n  end;\r\n\r\n  if not Allow then\r\n    Exit;\r\n\r\n  el.classList.toggle('accordionactive_'+Name);\r\n\r\n  pnl := TJSHTMLElement(el.nextElementSibling);\r\n\r\n  s := pnl.style.getPropertyValue('max-height');\r\n\r\n  if (s <> '0px') and (s <> '') then\r\n  begin\r\n    pnl.style.setProperty('max-height','0')\r\n  end\r\n  else\r\n  begin\r\n    pnl.style.setProperty('max-height', IntToStr(pnl.scrollHeight) + 'px');\r\n  end;\r\n\r\n  if el.classlist.contains('accordionactive_'+Name) then\r\n  begin\r\n    ASection.FExpanded := true;\r\n    if Assigned(OnExpanded) then\r\n      OnExpanded(Self, ASection);\r\n  end\r\n  else\r\n  begin\r\n    ASection.FExpanded := false;\r\n    if Assigned(OnCollapsed) then\r\n      OnCollapsed(Self, ASection);\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TAccordion.EndUpdate;\r\nbegin\r\n  inherited;\r\n  RenderStyle;\r\n  RenderAccordion;\r\nend;\r\n\r\nprocedure TAccordion.Expand(ASection: TAccordionSection);\r\nvar\r\n  el,pnl: TJSHTMLElement;\r\n  LClass: string;\r\nbegin\r\n  el := ASection.CaptionElement;\r\n\r\n  LClass := 'accordionactive_'+Name;\r\n\r\n  if el.classList.contains(LClass) then\r\n    el.classList.add(LClass);\r\n\r\n  pnl := TJSHTMLElement(el.nextElementSibling);\r\n  pnl.style.setProperty('max-height', IntToStr(pnl.scrollHeight) + 'px');\r\nend;\r\n\r\nprocedure TAccordion.RenderAccordion;\r\nvar\r\n  i: integer;\r\n  sp,btn,divel,p: TJSHTMLElement;\r\nbegin\r\n  if ElementHandle.childNodes.length > 0 then\r\n  begin\r\n    while Assigned(ElementHandle.firstChild) do\r\n      ElementHandle.removeChild(ElementHandle.firstChild);\r\n\r\n    if ElementClassname <> '' then\r\n    begin\r\n      ElementHandle.style.removeProperty('border');\r\n      ElementHandle.style.removeProperty('background-color');\r\n    end;\r\n  end;\r\n\r\n  sp := TJSHTMLElement(document.createElement('SPAN'));\r\n  ElementHandle.appendChild(sp);\r\n\r\n  for i := 0 to FSections.Count - 1 do\r\n  begin\r\n    btn := TJSHTMLElement(document.createElement('BUTTON'));\r\n    btn.innerHTML := FSections.Items[i].Caption;\r\n    btn['id'] := Name + '_' + inttostr(i);\r\n    btn.setAttribute('class','accordion_'+Name);\r\n    if ElementSectionClassName <> '' then\r\n      btn.classList.Add(ElementSectionClassName);\r\n\r\n    btn.addEventListener('click',@DoAccordionClick);\r\n    divel := TJSHTMLElement(document.createElement('DIV'));\r\n    divel.setAttribute('class','accordionpanel_'+Name);\r\n    p := TJSHTMLElement(document.createElement('P'));\r\n    p.style.SetProperty('user-select','text');\r\n    if ElementContentClassName <> '' then\r\n      p.setAttribute('class',ElementContentClassName);\r\n\r\n    p.innerHTML := FSections[i].Content;\r\n\r\n    sp.appendChild(btn);\r\n    sp.appendChild(divel);\r\n    divel.appendChild(p);\r\n\r\n    if Assigned(OnRenderSection) then\r\n      OnRenderSection(Self, FSections.Items[i], btn, p);\r\n  end;\r\n\r\n  if (csDesigning in ComponentState) then\r\n    RenderDesigning(Classname, Container, Self, (FSections.Count = 0));\r\nend;\r\n\r\nprocedure TAccordion.RenderStyle;\r\nvar\r\n  css: string;\r\nbegin\r\n  if FStyleRendered then\r\n    Exit;\r\n\r\n  FStyleRendered := true;\r\n\r\n  css :=\r\n  '.accordion_'+ Name +' {'+\r\n  'background-color: #eee;'+\r\n  'color: #444;'+\r\n  'cursor: pointer;'+\r\n  'padding: 18px;'+\r\n  'width: 100%;'+\r\n  'text-align: left;'+\r\n  'border: none;' +\r\n  'outline: none;' +\r\n  'transition: 0.4s;'+\r\n  '}' +#13#10 +\r\n\r\n  '.accordionactive_'+Name+', .accordion_'+Name+'::hover {'+\r\n  'background-color: #ccc;'+\r\n  '}' +#13#10 +\r\n\r\n  '.accordionactive_'+Name+'::before {'+\r\n  'transform: rotate(90deg);'+\r\n  '}' +#13#10 +\r\n\r\n  '.accordion_'+Name+'::before {'+\r\n  '  content: \"\\25B6\";'+\r\n  '  font-size: 13px;'+\r\n//  '  color: #777;'+\r\n  '  display: inline-block;'+\r\n  '  margin-right: 5px;'+\r\n  '}' +#13#10 +\r\n\r\n  '.accordionpanel_'+Name+' {'+\r\n  'padding: 0 18px;'+\r\n  'background-color: white;'+\r\n  'max-height: 0;'+\r\n  'overflow: hidden;'+\r\n  'transition: max-height 0.2s ease-out;'+\r\n  '}';\r\n\r\n  AddInstanceStyle(css);\r\nend;\r\n\r\nprocedure TAccordion.SectionsChanged(Sender: TObject);\r\nbegin\r\n  if not IsUpdating then\r\n  begin\r\n    RenderStyle;\r\n    RenderAccordion;\r\n  end;\r\nend;\r\n\r\nprocedure TAccordion.SetElementClassName(AValue: string);\r\nbegin\r\n  inherited;\r\n  if ElementClassname <> '' then\r\n    RenderAccordion;\r\nend;\r\n\r\nprocedure TAccordion.SetSections(const Value: TAccordionSections);\r\nbegin\r\n  FSections.Assign(Value);\r\nend;\r\n\r\nprocedure TAccordion.UpdateElement;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TAccordion.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n  ElementHandle.style.setProperty('overflow-y','auto');\r\n  ElementHandle.style.setProperty('overflow-x','hidden');\r\nend;\r\n\r\n{ TAccordionSections }\r\n\r\nfunction TAccordionSections.Add: TAccordionSection;\r\nbegin\r\n  Result := TAccordionSection(inherited Add);\r\nend;\r\n\r\nconstructor TAccordionSections.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TAccordionSection);\r\nend;\r\n\r\nfunction TAccordionSections.GetItem(Index: integer): TAccordionSection;\r\nbegin\r\n  Result := TAccordionSection(inherited Items[Index]);\r\nend;\r\n\r\nfunction TAccordionSections.Insert(Index: integer): TAccordionSection;\r\nbegin\r\n  Result := TAccordionSection(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TAccordionSections.SetItem(Index: integer;\r\n  const Value: TAccordionSection);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nprocedure TAccordionSections.Update(Item: TCollectionItem);\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(OnChange) and (UpdateCount = 0) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{ TResponsiveGridPanel }\r\n\r\nprocedure TResponsiveGridPanel.AddControl(AControl: TWinControl);\r\nbegin\r\n  FControlCollection.Add.Control := AControl;\r\n  AControl.Parent := Self;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.AlignControls(AControl: TControl;\r\n  var Rect: TRect);\r\nbegin\r\n  inherited;\r\n  Resize;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.BindEvents;\r\nbegin\r\n  inherited;\r\n  document.defaultView.addEventListener('resize', @HandleResize);\r\nend;\r\n\r\nconstructor TResponsiveGridPanel.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n\r\nend;\r\n\r\nfunction TResponsiveGridPanel.CreateElement: TJSElement;\r\nbegin\r\n  if (csDesigning in ComponentState) and (ControlCollection.Count = 0) then\r\n  begin\r\n    Result := document.createElement('DIV');\r\n    FLabel := TJSHTMLElement(document.createElement('DIV'));\r\n    FLabel.innerHTML := ClassName;\r\n    BorderStyle := bsSingle;\r\n    FLabel['align'] := 'center';\r\n    FLabel.style.setProperty('border','1px solid silver');\r\n    FLabel.style.setProperty('vertical-align','middle');\r\n    FLabel.style.setProperty('display','table-cell');\r\n    Result.appendChild(FLabel);\r\n  end\r\n  else\r\n  begin\r\n    Result := document.createElement('DIV');\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.CreateInitialize;\r\nvar\r\n  li: TResponsiveLayoutItem;\r\nbegin\r\n  inherited;\r\n  FDesignTime := (csDesigning in ComponentState) and not\r\n    ((csReading in Owner.ComponentState) or (csLoading in Owner.ComponentState));\r\n\r\n  EnablePropagation := true;\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  FControlCollection := TControlCollection.Create(Self);\r\n  FControlCollection.PropName := 'ControlCollection';\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 400;\r\n    Height := 300;\r\n  end;\r\n\r\n  FLabel := nil;\r\n  FActiveLayoutItem := nil;\r\n  FLayout := TResponsiveLayout.Create(Self);\r\n  FLayout.PropName := 'Layout';\r\n\r\n  if FDesignTime then\r\n  begin\r\n    li := FLayout.Add;\r\n    li.Description := 'Smartphone';\r\n    li.Width := 575;\r\n    li.Style := '1fr';\r\n\r\n    li := FLayout.Add;\r\n    li.Description := 'Tablet';\r\n    li.Width := 768;\r\n    li.Style := '1fr 1fr';\r\n\r\n    li := FLayout.Add;\r\n    li.Description := 'Desktop';\r\n    li.Width := 991;\r\n    li.Style := '1fr 1fr 1fr';\r\n\r\n    li := FLayout.Add;\r\n    li.Description := 'Large Desktop';\r\n    li.Width := 1199;\r\n    li.Style := '1fr 1fr 1fr 1fr';\r\n\r\n  end;\r\n\r\n\r\nend;\r\n\r\ndestructor TResponsiveGridPanel.Destroy;\r\nbegin\r\n  FControlCollection.Free;\r\n  FLayout.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.EndUpdate;\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.GetChildren(Proc: TGetChildProc;\r\n  Root: TComponent);\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCollection.Count - 1 do\r\n  begin\r\n    if Assigned(ControlCollection.Items[i].Control) then\r\n      Proc(ControlCollection.Items[i].Control);\r\n  end;\r\nend;\r\n\r\nfunction TResponsiveGridPanel.GridElementCount: integer;\r\nvar\r\n  i: integer;\r\n  el: TJSHTMLElement;\r\nbegin\r\n  Result := 0;\r\n\r\n  for i := 0 to ElementHandle.childElementCount - 1 do\r\n  begin\r\n    el := TJSHTMLElement(ElementHandle.children[i]);\r\n    if (el['data'] = 'grid') then\r\n      inc(Result);\r\n  end;\r\nend;\r\n\r\nfunction TResponsiveGridPanel.HandleResize(Event: TEventListenerEvent): boolean;\r\nvar\r\n  w: integer;\r\nbegin\r\n  if (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  Result := true;\r\n  w := Width;\r\n  if FOldWidth <> w then\r\n  begin\r\n    FOldWidth  := w;\r\n    Resize;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.Loaded;\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nvar\r\n  i: integer;\r\n  upd: boolean;\r\n  el: TJSHTMLElement;\r\n\r\nbegin\r\n  upd := false;\r\n\r\n  if (Operation = opRemove) and not (csDestroying in ComponentState) then\r\n  begin\r\n    for i := ControlCollection.Count - 1 downto 0 do\r\n    begin\r\n      if (ControlCollection.Items[i].Control = AComponent) then\r\n      begin\r\n        el := TJSHTMLElement(ElementHandle.children[i]);\r\n        while el.childElementCount > 0 do\r\n          el.removeChild(el.firstChild);\r\n\r\n        ControlCollection.Items[i].Control := nil;\r\n        ControlCollection.Delete(i);\r\n        upd := true;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  inherited;\r\n\r\n  if upd then\r\n    UpdateControls;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.RegisterParent(AValue: TControl);\r\nbegin\r\n  inherited;\r\n\r\n  if not IsUpdating and not (csLoading in ComponentState) then\r\n  begin\r\n    ControlCollection.Add.Control := TWinControl(AValue);\r\n    UpdateControls;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.RemoveControl(AControl: TWinControl);\r\nvar\r\n  i: integer;\r\n\r\nbegin\r\n  for i := 0 to FControlCollection.Count - 1 do\r\n  begin\r\n    if FControlCollection.Items[i].Control =  AControl then\r\n    begin\r\n      FControlCollection.Delete(i);\r\n      break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.Resize;\r\nbegin\r\n  inherited;\r\n  SetResponsiveStyle;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.SetControlCollection(\r\n  const Value: TControlCollection);\r\nbegin\r\n  FControlCollection.Assign(Value);\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.SetResponsiveStyle;\r\nvar\r\n  li: TResponsiveLayoutItem;\r\n  w: integer;\r\n  lGap: string;\r\nbegin\r\n  if not Assigned(Layout) then\r\n    Exit;\r\n\r\n  if (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  w := Width;\r\n\r\n  li := Layout.GetLayoutForWidth(w);\r\n\r\n  if Assigned(li) then\r\n  begin\r\n    if li.StyleType = gTemplateColumns then\r\n    begin\r\n      ElementHandle.style.setProperty('grid-template-columns', li.Style);\r\n      ElementHandle.style.removeProperty('grid-template-rows');\r\n    end\r\n    else\r\n    begin\r\n      ElementHandle.style.removeProperty('grid-template-columns');\r\n      ElementHandle.style.setProperty('grid-template-rows', li.Style);\r\n    end;\r\n\r\n    lGap := li.RowGap;\r\n    if lGap.IsNumber then\r\n      lGap := lGap + 'px';\r\n\r\n    ElementHandle.style.setProperty('grid-row-gap', lGap);\r\n\r\n    lGap := li.ColumnGap;\r\n    if lGap.IsNumber then\r\n      lGap := lGap + 'px';\r\n\r\n    ElementHandle.style.setProperty('grid-column-gap', lGap);\r\n\r\n    ElementHandle.style.setProperty('padding-left', inttostr(li.Margins.Left)+'px');\r\n    ElementHandle.style.setProperty('padding-top', inttostr(li.Margins.Top)+'px');\r\n    ElementHandle.style.setProperty('padding-right', inttostr(li.Margins.Right)+'px');\r\n    ElementHandle.style.setProperty('padding-bottom', inttostr(li.Margins.Bottom)+'px');\r\n  end;\r\n\r\n  if li <> FActiveLayoutItem then\r\n  begin\r\n    FActiveLayoutItem := li;\r\n    if Assigned(OnLayoutChange) then\r\n      OnLayoutChange(Self, FActiveLayoutItem);\r\n  end;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.UnbindEvents;\r\nbegin\r\n  inherited;\r\n  document.defaultView.removeEventListener('resize', @HandleResize);\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.UpdateControls;\r\nvar\r\n  i,j,k: integer;\r\n  el: TJSHTMLElement;\r\n  fragment: TJSDocumentFragment;\r\n  control: TControl;\r\n  ctrlid: string;\r\nbegin\r\n  if (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if (ControlCollection.Count > 0) and Assigned(FLabel) then\r\n  begin\r\n    ElementHandle.removeChild(FLabel);\r\n    FLabel := nil;\r\n    ElementHandle.style.setProperty('display','grid');\r\n  end;\r\n\r\n  for i := 0 to ControlCollection.Count - 1 do\r\n  begin\r\n    if GridElementCount <= i then\r\n    begin\r\n      el := TJSHTMLElement(document.createElement('DIV'));\r\n      el['data'] := 'grid';\r\n\r\n      if (csDesigning in ComponentState) then\r\n        el.style.setProperty('border','1px silver dotted');\r\n\r\n      ElementHandle.appendChild(el);\r\n    end\r\n    else\r\n    begin\r\n      k := 0;\r\n      for j := 0 to ElementHandle.ChildElementCount - 1 do\r\n      begin\r\n        el := TJSHTMLElement(ElementHandle.children[j]);\r\n        if (el['data'] = 'grid') then\r\n        begin\r\n          if (k = i) then\r\n            break\r\n          else\r\n            inc(k);\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    fragment := document.createDocumentFragment();\r\n    control := ControlCollection.Items[i].Control;\r\n    if Assigned(control) then\r\n    begin\r\n      control.ElementPosition := epRelative;\r\n      control.ChildOrder := -1;\r\n      ctrlid := control.GetID;\r\n      fragment.appendChild(document.getElementById(ctrlid));\r\n      el.appendChild(fragment);\r\n    end;\r\n  end;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TResponsiveGridPanel.UpdateElement;\r\nbegin\r\n  inherited;\r\n\r\n  if (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    if (ControlCollection.Count = 0) then\r\n    begin\r\n      TJSHTMLElement(ElementHandle).style.setProperty('display','table');\r\n      if (Color = clNone) then\r\n        TJSHTMLElement(ElementHandle).style.setProperty('background-color','silver');\r\n    end;\r\n  end;\r\n\r\n  ElementHandle.style.setProperty('display','grid');\r\n  SetResponsiveStyle;\r\nend;\r\n\r\n{ TLayout }\r\n\r\nfunction TResponsiveLayout.Add: TResponsiveLayoutItem;\r\nbegin\r\n  Result := TResponsiveLayoutItem(inherited Add);\r\nend;\r\n\r\nfunction TResponsiveLayout.Add(AWidth: integer;\r\n  AStyle: string): TResponsiveLayoutItem;\r\nbegin\r\n  Result := Add;\r\n  Result.Width := AWidth;\r\n  Result.Style := AStyle;\r\nend;\r\n\r\nconstructor TResponsiveLayout.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TResponsiveLayoutItem);\r\nend;\r\n\r\nfunction TResponsiveLayout.GetItem(Index: integer): TResponsiveLayoutItem;\r\nbegin\r\n  Result := TResponsiveLayoutItem(inherited Items[Index]);\r\nend;\r\n\r\nfunction TResponsiveLayout.GetLayoutForWidth(w: integer): TResponsiveLayoutItem;\r\nvar\r\n  i,d,j,l,mx: integer;\r\n\r\nbegin\r\n  Result := nil;\r\n  if Count = 0 then\r\n    Exit;\r\n\r\n  d := $FFFF;\r\n  j := -1;\r\n  mx := 0;\r\n\r\n  for i := 0 to Count - 1 do\r\n  begin\r\n    if Items[i].Width > mx then\r\n    begin\r\n      mx := Items[i].Width;\r\n      l := i;\r\n    end;\r\n\r\n    if w < Items[i].Width then\r\n    begin\r\n      if Items[i].Width - w < d then\r\n      begin\r\n        d := Items[i].Width - w;\r\n        j := i;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if j = -1 then\r\n    j := l;\r\n\r\n  Result := Items[j];\r\nend;\r\n\r\nfunction TResponsiveLayout.Insert(Index: integer): TResponsiveLayoutItem;\r\nbegin\r\n  Result := TResponsiveLayoutItem(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TResponsiveLayout.SetItem(Index: integer; const Value: TResponsiveLayoutItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TResponsiveLayoutItem }\r\n\r\nprocedure TResponsiveLayoutItem.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TResponsiveLayoutItem) then\r\n  begin\r\n    FColumnGap := (Source as TResponsiveLayoutItem).ColumnGap;\r\n    FDescription := (Source as TResponsiveLayoutItem).Description;\r\n    FRowGap := (Source as TResponsiveLayoutItem).RowGap;\r\n    FWidth := (Source as TResponsiveLayoutItem).Width;\r\n    FStyle := (Source as TResponsiveLayoutItem).Style;\r\n    FStyleType := (Source as TResponsiveLayoutItem).StyleType;\r\n    FTag := (Source as TResponsiveLayoutItem).Tag;\r\n    FMargins.Assign((Source as TResponsiveLayoutItem).Margins);\r\n  end;\r\nend;\r\n\r\nconstructor TResponsiveLayoutItem.Create(AOwner: TCollection);\r\nbegin\r\n  inherited;\r\n  FMargins := TMargins.Create;\r\n\r\n  FMargins.Left := 0;\r\n  FMargins.Top := 0;\r\n  FMargins.Right := 0;\r\n  FMargins.Bottom := 0;\r\nend;\r\n\r\ndestructor TResponsiveLayoutItem.Destroy;\r\nbegin\r\n  FMargins.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TResponsiveLayoutItem.SetMargins(const Value: TMargins);\r\nbegin\r\n  FMargins.Assign(Value);\r\nend;\r\n\r\n{ TAccordionSection }\r\n\r\nprocedure TAccordionSection.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TAccordionSection) then\r\n  begin\r\n    FCaption := (Source as TAccordionSection).Caption;\r\n    FContent := (Source as TAccordionSection).Content;\r\n    FTag := (Source as TAccordionSection).Tag;\r\n  end;\r\nend;\r\n\r\nfunction TAccordionSection.CaptionElement: TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(document.getElementById(((Collection as TAccordionSections).Owner as TAccordion).Name+'_'+inttostr(Index)));\r\nend;\r\n\r\nfunction TAccordionSection.PanelElement: TJSHTMLElement;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  el := CaptionElement;\r\n  Result := TJSHTMLElement(el.nextElementSibling);\r\nend;\r\n\r\nprocedure TAccordionSection.SetCaption(const Value: string);\r\nbegin\r\n  FCaption := Value;\r\n  (Collection as TAccordionSections).Update(Self);\r\nend;\r\n\r\nprocedure TAccordionSection.SetContent(const Value: string);\r\nbegin\r\n  FContent := Value;\r\n  (Collection as TAccordionSections).Update(Self);\r\nend;\r\n\r\nprocedure TAccordionSection.SetExpanded(const Value: boolean);\r\nbegin\r\n  if (FExpanded <> Value) then\r\n  begin\r\n    FExpanded := Value;\r\n\r\n    if FExpanded then\r\n      ((Collection as TAccordionSections).Owner as TAccordion).Expand(Self)\r\n    else\r\n      ((Collection as TAccordionSections).Owner as TAccordion).Collapse(Self);\r\n  end;\r\nend;\r\n\r\n{ TImageZoomControl }\r\n\r\nfunction TImageZoomControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := inherited;\r\n\r\n  FStyle := document.createElement('STYLE');\r\n  FOverlay := document.createElement('DIV');\r\n  document.body.appendChild(FStyle);\r\n  document.body.appendChild(FOverlay);\r\nend;\r\n\r\nprocedure TImageZoomControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAppearance := TImageZoomAppearance.Create(Self);\r\n  FPictureZoom := TURLPicture.Create;\r\n  FPictureZoom.OnChange := PictureZoomChanged;\r\n  FPictureZoom.OnDataChange := PictureZoomDataChanged;\r\n  FPictureZoomDataURL := '';\r\n\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    Width := 100;\r\n    Height := 75;\r\n  end;\r\nend;\r\n\r\ndestructor TImageZoomControl.Destroy;\r\nbegin\r\n  FAppearance.Free;\r\n  FPictureZoom.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TImageZoomControl.PictureZoomChanged(Sender: TObject);\r\nbegin\r\n  SetURLZoom(PictureZoom.FileName);\r\n  FPictureZoomDataURL := '';\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TImageZoomControl.PictureZoomDataChanged(Sender: TObject);\r\nbegin\r\n  FPictureZoomDataURL := 'data:image/png;base64,' + HexImageDecodeAsBase64(PictureZoom.Data);\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TImageZoomControl.SetPictureZoom(const Value: TURLPicture);\r\nbegin\r\n  FPictureZoom.Assign(Value);\r\nend;\r\n\r\nprocedure TImageZoomControl.SetURLZoom(const Value: string);\r\nbegin\r\n  if FURLZoom <> Value then\r\n  begin\r\n    FURLZoom := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TImageZoomControl.UpdateElement;\r\nvar\r\n  PopupImage: string;\r\n  Popup: TJSElement;\r\nbegin\r\n  inherited;\r\n\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  if Assigned(FOverlay) then\r\n  begin\r\n    ElementHandle.setAttribute('onClick', 'document.getElementById(\"' + Name + 'myModal\").style.display = \"block\"');\r\n\r\n    if FPictureZoomDataURL <> '' then\r\n      PopupImage := FPictureZoomDataURL\r\n    else\r\n      PopupImage := URLZoom;\r\n\r\n    if PopupImage = '' then\r\n      PopupImage := URL;\r\n\r\n    FStyle.innerHTML := '.' + Name + 'modal-overlay {'#13\r\n    + '  display: none;'#13\r\n    + '  position: fixed;'#13\r\n    + '  z-index: 9999;'#13\r\n    + '  width: 100%;'#13\r\n    + '  height: 100%;'#13\r\n    + '  overflow: hidden;'#13\r\n    + '  top: 50%;'#13\r\n    + '  left: 50%;'#13\r\n    + '  -ms-transform: translate(-50%, -50%);'#13\r\n    + '  transform: translate(-50%, -50%);'#13\r\n    + '  background-color: rgba(0,0,0,0.2);'#13\r\n    + '}'#13\r\n\r\n    + '.' + Name + 'modal {'#13\r\n    + '  display: block;'#13\r\n    + '  position: absolute;'#13\r\n    + '  z-index: 9999;'#13\r\n    + '  width: ' + IntToStr(Appearance.WidthPercent) + '%;'#13\r\n    + '  height: ' + IntToStr(Appearance.HeightPercent) + '%;'#13\r\n    + '  overflow: hidden;'#13\r\n    + '  top: 50%;'#13\r\n    + '  left: 50%;'#13\r\n    + '  -ms-transform: translate(-50%, -50%);'#13\r\n    + '  transform: translate(-50%, -50%);'#13\r\n    + '  background-color: rgba(0,0,0,0.9);'#13\r\n    + '}'#13\r\n\r\n    + '.' + Name + 'modal-content {'#13\r\n    + '  display: block;'#13\r\n    + '  margin: 0;'#13\r\n    + '  position: absolute;'#13\r\n    + '  top: 50%;'#13\r\n    + '  left: 50%;'#13\r\n    + '  -ms-transform: translate(-50%, -50%);'#13\r\n    + '  transform: translate(-50%, -50%);'#13\r\n    + '  max-width: 100%;'#13\r\n    + '  max-height: 100%;'#13\r\n    + '}'#13\r\n\r\n    + '.' + Name + 'close {'#13\r\n    + '  z-index: 9999;'#13\r\n    + '  position: absolute;'#13\r\n    + '  top: 15px;'#13\r\n    + '  right: 35px;'#13\r\n    + '  color: #f1f1f1;'#13\r\n    + '  font-size: 40px;'#13\r\n    + '  font-weight: bold;'#13\r\n    + '  transition: 0.3s;'#13\r\n    + '}'#13\r\n\r\n    + '.' + Name + 'close:hover,'#13\r\n    + '.' + Name + 'close:focus {'#13\r\n    + '  color: #bbb;'#13\r\n    + '  text-decoration: none;'#13\r\n    + '  cursor: pointer;'#13\r\n    + '}'#13\r\n\r\n    + '@media only screen and (max-width: 769px) {'#13\r\n    + '\t.' + Name + 'modal {'#13\r\n    + '  width: ' + IntToStr(Appearance.ResponsiveWidthPercent) + '%;'#13\r\n    + '  height: ' + IntToStr(Appearance.ResponsiveHeightPercent) + '%;'#13\r\n    + '\t}'#13\r\n    + '}'#13;\r\n\r\n    FOverlay.setAttribute('onClick', 'this.style.display = \"none\";');\r\n    FOverlay.setAttribute('id', Name + 'myModal');\r\n    FOverlay.setAttribute('class', Name + 'modal-overlay');\r\n\r\n    while Assigned(FOverlay.firstChild) do\r\n      FOverlay.removeChild(FOverlay.firstChild);\r\n\r\n    Popup := document.createElement('DIV');\r\n    Popup.setAttribute('class', Name + 'modal');\r\n    Popup.innerHTML := '<span class=\"' + Name + 'close\">&times;</span>'\r\n    + '<img class=\"' + Name + 'modal-content\" src=\"' + PopupImage + '\">';\r\n\r\n    FOverlay.innerHTML := '';\r\n    FOverlay.AppendChild(Popup);\r\n  end;\r\nend;\r\n\r\n{ TImageZoomAppearance }\r\n\r\nprocedure TImageZoomAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if (Source is TImageZoomAppearance) then\r\n  begin\r\n    FHeightPercent := (Source as TImageZoomAppearance).HeightPercent;\r\n    FWidthPercent := (Source as TImageZoomAppearance).WidthPercent;\r\n    FResponsiveHeightPercent := (Source as TImageZoomAppearance).ResponsiveHeightPercent;\r\n    FResponsiveWidthPercent := (Source as TImageZoomAppearance).ResponsiveWidthPercent;\r\n    FResponsiveMaxWidth := (Source as TImageZoomAppearance).ResponsiveMaxWidth;\r\n  end;\r\nend;\r\n\r\nconstructor TImageZoomAppearance.Create(AOwner: TImageZoomControl);\r\nbegin\r\n  FHeightPercent := 100;\r\n  FWidthPercent := 100;\r\n  FResponsiveHeightPercent := 100;\r\n  FResponsiveWidthPercent := 100;\r\n  FResponsiveMaxWidth := 768;\r\n  FOwner := AOwner;\r\nend;\r\n\r\ndestructor TImageZoomAppearance.Destroy;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nfunction TImageZoomAppearance.GetOwner: TPersistent;\r\nbegin\r\n  Result := FOwner;\r\nend;\r\n\r\nprocedure TImageZoomAppearance.SetHeightPercent(const Value: Integer);\r\nbegin\r\n  if (FHeightPercent <> Value) and (FHeightPercent <= 100) then\r\n  begin\r\n    FHeightPercent := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TImageZoomAppearance.SetResponsiveHeightPercent(const Value: Integer);\r\nbegin\r\n  if (FResponsiveHeightPercent <> Value) and (FResponsiveHeightPercent <= 100) then\r\n  begin\r\n    FResponsiveHeightPercent := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TImageZoomAppearance.SetResponsiveMaxWidth(const Value: Integer);\r\nbegin\r\n  if (FResponsiveMaxWidth <> Value) and (FResponsiveMaxWidth >= 0) then\r\n  begin\r\n    FResponsiveMaxWidth := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TImageZoomAppearance.SetResponsiveWidthPercent(const Value: Integer);\r\nbegin\r\n  if (FResponsiveWidthPercent <> Value) and (FResponsiveWidthPercent <= 100) then\r\n  begin\r\n    FResponsiveWidthPercent := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TImageZoomAppearance.SetWidthPercent(const Value: Integer);\r\nbegin\r\n  if (FWidthPercent <> Value) and (FWidthPercent <= 100) then\r\n  begin\r\n    FWidthPercent := Value;\r\n    FOwner.UpdateElement;\r\n  end;\r\nend;\r\n\r\n{ TCustomLookupComboBox }\r\n\r\nprocedure TCustomLookupComboBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FLookupValues := TLookupValues.Create(Self);\r\n  FLookupValues.PropName := 'LookupValues';\r\n  FLookupValues.OnChange := ValuesChanged;\r\nend;\r\n\r\ndestructor TCustomLookupComboBox.Destroy;\r\nbegin\r\n  FLookupValues.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomLookupComboBox.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  opt: TJSElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  for i := TJSHTMLSelectElement(Container).options.length - 1 downto 0 do\r\n    TJSHTMLSelectElement(Container).remove(i);\r\n\r\n  for i := 0 to FLookupValues.Count - 1 do\r\n  begin\r\n    opt := document.createElement('OPTION');\r\n    opt['value'] := TLookupValueItem(FLookupValues.Items[i]).Value;\r\n    opt.innerHTML := TLookupValueItem(FLookupValues.Items[i]).DisplayText;\r\n    Container.appendChild(opt);\r\n  end;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TCustomLookupComboBox.GetDisplayText: string;\r\nbegin\r\n  Result := '';\r\n  if ItemIndex >= 0 then\r\n    Result := FLookupValues[ItemIndex].DisplayText;\r\nend;\r\n\r\nfunction TCustomLookupComboBox.GetValue: string;\r\nbegin\r\n  Result := '';\r\n  if ItemIndex >= 0 then\r\n    Result := FLookupValues[ItemIndex].Value;\r\nend;\r\n\r\nprocedure TCustomLookupComboBox.SetDisplayText(const Value: string);\r\nvar\r\n  i,idx: integer;\r\nbegin\r\n  idx := -1;\r\n  for i := 0 to FLookupValues.Count - 1 do\r\n  begin\r\n    if FLookupValues[i].DisplayText = Value then\r\n    begin\r\n      idx := i;\r\n      break;\r\n    end;\r\n  end;\r\n\r\n  ItemIndex := idx;\r\nend;\r\n\r\nprocedure TCustomLookupComboBox.SetLookupValues(const Value: TLookupValues);\r\nbegin\r\n  FLookupValues.Assign(Value);\r\nend;\r\n\r\nprocedure TCustomLookupComboBox.SetValue(const Value: string);\r\nvar\r\n  i,idx: integer;\r\nbegin\r\n  idx := -1;\r\n  for i := 0 to FLookupValues.Count - 1 do\r\n  begin\r\n    if FLookupValues[i].Value = Value then\r\n    begin\r\n      idx := i;\r\n      break;\r\n    end;\r\n  end;\r\n\r\n  ItemIndex := idx;\r\nend;\r\n\r\nprocedure TCustomLookupComboBox.ValuesChanged(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\n{ TLookupValues }\r\n\r\nfunction TLookupValues.Add: TLookupValueItem;\r\nbegin\r\n  Result := TLookupValueItem(inherited Add);\r\nend;\r\n\r\nprocedure TLookupValues.AddPair(AValue, ADisplayText: string);\r\nvar\r\n  lv: TLookupValueItem;\r\nbegin\r\n  lv := TLookupValueItem(inherited Add);\r\n  lv.Value := AValue;\r\n  lv.DisplayText := ADisplayText;\r\n  if (UpdateCount = 0) then\r\n     DoChange;\r\nend;\r\n\r\nconstructor TLookupValues.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TLookupValueItem);\r\nend;\r\n\r\nprocedure TLookupValues.DoChange;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TLookupValues.GetItem(Index: integer): TLookupValueItem;\r\nbegin\r\n  Result := TLookupValueItem(inherited Items[Index]);\r\nend;\r\n\r\nfunction TLookupValues.Insert(Index: integer): TLookupValueItem;\r\nbegin\r\n  Result := TLookupValueItem(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TLookupValues.SetItem(Index: integer; const Value: TLookupValueItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n\r\nend.\r\n","{*************************************************************************}\r\n{ TAdvTreeNodes                                                           }\r\n{ for Delphi & C++Builder                                                 }\r\n{                                                                         }\r\n{ written by TMS Software                                                 }\r\n{           copyright  2019 - 2020                                       }\r\n{           Email : info@tmssoftware.com                                  }\r\n{           Website : http://www.tmssoftware.com/                         }\r\n{                                                                         }\r\n{ The source code is given as is. The author is not responsible           }\r\n{ for any possible damage done due to the use of this code.               }\r\n{ The component can be freely used in any application. The complete       }\r\n{ source code remains property of the author and may not be distributed,  }\r\n{ published, given or sold in any form as such. No parts of the source    }\r\n{ code can be included in any other component or application without      }\r\n{ written authorization of the author.                                    }\r\n{*************************************************************************}\r\n\r\nunit WEBLib.TreeNodes;\r\n\r\n\r\ninterface\r\nuses\r\n  Classes, Types, SysUtils, Web;\r\n\r\ntype\r\n  TTreeNode = class;\r\n  TTreeNodes = class;\r\n\r\n  TDbgList = class(TList)\r\n  private\r\n    function GetItemsEx(Index: Integer): TTreeNode;\r\n    procedure SetItemsEx(Index: Integer; const Value: TTreeNode);\r\n  public\r\n    procedure AssignList(ListA: TList);\r\n    property Items[Index: Integer]: TTreeNode read GetItemsEx write SetItemsEx; default;\r\n  end;\r\n\r\n{ TTreeNode }\r\n\r\n  TNodeType = (ntText, ntCheckbox, ntRadioButton);\r\n\r\n  TImageIndex = integer;\r\n\r\n  PNodeInfo = ^TNodeInfo;\r\n  TNodeInfo = packed record\r\n    SelectedIndex: Integer;\r\n    StateIndex: Integer;\r\n    OverlayIndex: Integer;\r\n    Data: Pointer;\r\n    Count: Integer;\r\n    Text: string;\r\n    NodeType: TNodeType;\r\n    Checked: Boolean;\r\n    ImageURL: string;\r\n    ImageCollapsedURL: string;\r\n    URL: string;\r\n    Tag: Integer;\r\n    Hint: string;\r\n    IsExpanded: Boolean;\r\n  end;\r\n\r\n  TNodeDataInfo = packed record\r\n    SelectedIndex: Integer;\r\n    StateIndex: Integer;\r\n    OverlayIndex: Integer;\r\n    Data: Pointer;\r\n    Count: Integer;\r\n    NodeType: TNodeType;\r\n    Checked: Boolean;\r\n    Tag: Integer;\r\n    IsExpanded: Boolean;\r\n    TextLen: Byte;\r\n    HintLen: Byte;\r\n    URLLen: Byte;\r\n    ImageURLLen: Byte;\r\n    ImageCollapsedURLLen: Byte;\r\n  end;\r\n\r\n  TTreeNodeClass = class of TTreeNode;\r\n\r\n  TTreeNode = class(TPersistent)\r\n  private\r\n    FOwner: TTreeNodes;\r\n    FText: string;\r\n    FData: TObject;\r\n    FDeleting: Boolean;\r\n    FIsExpanded: Boolean;\r\n    FFirstChild: TTreeNode;\r\n    FNextSibling: TTreeNode;\r\n    FPrevSibling: TTreeNode;\r\n    FParentNode: TTreeNode;\r\n    FShowText: Boolean;\r\n    FImageCollapsedURL: string;\r\n    FImageURL: string;\r\n    FNodeType: TNodeType;\r\n    FURL: string;\r\n    FChecked: boolean;\r\n    FTag: Integer;\r\n    FHint: string;\r\n    function GetLevel: Integer;\r\n    function GetParent: TTreeNode;\r\n    function GetIndex: Integer;\r\n    function GetItem(Index: Integer): TTreeNode;\r\n    function GetCount: Integer;\r\n    procedure SetData(Value: TObject);\r\n    procedure SetItem(Index: Integer; Value: TTreeNode);\r\n    procedure SetText(const S: string);\r\n    function GetHasChildren: Boolean;\r\n    procedure SetShowText(const Value: Boolean);\r\n    //procedure ReadData(Stream: TStream; var Info: TNodeDataInfo);\r\n    //procedure WriteData(Stream: TStream; var Info: TNodeDataInfo);\r\n    procedure SetChecked(const Value: boolean);\r\n    procedure SetImageCollapsedURL(const Value: string);\r\n    procedure SetImageURL(const Value: string);\r\n    procedure SetNodeType(const Value: TNodeType);\r\n    procedure SetURL(const Value: string);\r\n    procedure SetTag(const Value: Integer);\r\n    procedure SetHint(const Value: string);\r\n    procedure SetIsExpanded(const Value: Boolean);\r\n  protected\r\n    function CompareCount(CompareMe: Integer): Boolean;\r\n    property Owner: TTreeNodes read FOwner;\r\n    function IsEqual(Node: TTreeNode): Boolean;\r\n  public\r\n    property Item[Index: Integer]: TTreeNode read GetItem write SetItem; default;\r\n    function IndexOf(Value: TTreeNode): Integer;\r\n    property Count: Integer read GetCount;\r\n    property Index: Integer read GetIndex;\r\n\r\n    constructor Create(AOwner: TTreeNodes);\r\n    destructor Destroy; override;\r\n\r\n    function AddFirstChild(const S: string): TTreeNode; overload;\r\n    function AddFirstChild(const S: string; Data: TObject): TTreeNode; overload;\r\n    function AddChild(const S: string): TTreeNode; overload;\r\n    function AddChild(const S: string; Data: TObject): TTreeNode; overload;\r\n    procedure Assign(Source: TPersistent); override;\r\n\r\n    procedure Delete;\r\n    procedure DeleteChildren;\r\n\r\n    function GetFirstChild: TTreeNode;\r\n    function GetLastChild: TTreeNode;\r\n    function GetNextChild(Value: TTreeNode): TTreeNode;\r\n    function GetNextSibling: TTreeNode;\r\n    function GetPrevChild(Value: TTreeNode): TTreeNode;\r\n    function GetPrevSibling: TTreeNode;\r\n    function HasAsParent(Value: TTreeNode): Boolean;\r\n    function IsFirstNode: Boolean;\r\n    function IsFirstChild: Boolean;\r\n\r\n    property Deleting: Boolean read FDeleting;\r\n    property Expanded: Boolean read FIsExpanded write SetIsExpanded;\r\n    property HasChildren: Boolean read GetHasChildren;\r\n    property Level: Integer read GetLevel;\r\n    property Parent: TTreeNode read GetParent;\r\n    property Text: string read FText write SetText;\r\n    property Data: TObject read FData write SetData;\r\n    property ShowText: Boolean read FShowText write SetShowText default true;\r\n    property NodeType: TNodeType read FNodeType write SetNodeType default ntText;\r\n    property Checked: boolean read FChecked write SetChecked default False;\r\n    property URL: string read FURL write SetURL;\r\n\r\n    property ImageCollapsedURL: string read FImageCollapsedURL write SetImageCollapsedURL;\r\n    property ImageURL: string read FImageURL write SetImageURL;\r\n    property Tag: Integer read FTag write SetTag default 0;\r\n    property Hint: string read FHint write SetHint;\r\n  end;\r\n\r\n\r\n  TNodeEvent = procedure(Sender: TObject; ANode: TTreeNode) of object;\r\n\r\n{ TTreeNodes }\r\n\r\n  TTreeNodes = class(TPersistent)\r\n  private\r\n    FOwner: TComponent;\r\n    FFirstNode: TTreeNode;\r\n    FNodeList: TDbgList;\r\n    FDeleting: Boolean;\r\n    FReading: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    FOnExpandedChange: TNodeEvent;\r\n    function GetNodeFromIndex(Index: Integer): TTreeNode;\r\n    //procedure ReadData(Stream: TStream);\r\n    //procedure WriteData(Stream: TStream);\r\n  protected\r\n    //procedure DefineProperties(Filer: TFiler); override;\r\n    procedure SetItem(Index: Integer; Value: TTreeNode);\r\n    function GetCount: Integer;\r\n    function InsertNode(ParentNode: TTreeNode; DesNode: TTreeNode; InsertBefore: Boolean): TTreeNode;\r\n    function IsVeryFirstNode(Node: TTreeNode): Boolean;\r\n    function CreateNode: TTreeNode;\r\n    property Reading: Boolean read FReading;\r\n  public\r\n    constructor Create(AOwner: TComponent);\r\n    destructor Destroy; override;\r\n    function AddFirst(const S: string): TTreeNode; overload;\r\n    function AddFirst(Data: TObject; const S: string): TTreeNode; overload;\r\n    function Add(Sibling: TTreeNode; const S: string): TTreeNode; overload;\r\n    function Add(Sibling: TTreeNode; const S: string; Data: TObject): TTreeNode; overload;\r\n    function Add(const S: string): TTreeNode; overload;\r\n    function Add(const S: string; Data: TObject): TTreeNode; overload;\r\n    function AddChild(Parent: TTreeNode; const S: string): TTreeNode; overload;\r\n    function AddChild(Parent: TTreeNode; const S: string; Data: TObject): TTreeNode; overload;\r\n    function AddChildFirst(Parent: TTreeNode; const S: string): TTreeNode; overload;\r\n    function AddChildFirst(Parent: TTreeNode; const S: string; Data: TObject): TTreeNode; overload;\r\n\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure Clear;\r\n    procedure Delete(Node: TTreeNode);\r\n    function GetFirstNode: TTreeNode;\r\n    function GetLastNode: TTreeNode;\r\n    function Insert(Sibling: TTreeNode; const S: string): TTreeNode;\r\n    function InsertObject(Sibling: TTreeNode; const S: string; Data: TObject): TTreeNode;\r\n    property Count: Integer read GetCount;\r\n    property Item[Index: Integer]: TTreeNode read GetNodeFromIndex; default;\r\n    property Owner: TComponent read FOwner;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnExpandedChange: TNodeEvent read FOnExpandedChange write FOnExpandedChange;\r\n    procedure Changed;\r\n  end;\r\n\r\nimplementation\r\n\r\nuses\r\n  Math;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\n{ TDbgList }\r\n\r\nprocedure TDbgList.AssignList(ListA: TList);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Clear;\r\n  for I := 0 to ListA.Count - 1 do\r\n    Add(ListA[I]);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TDbgList.GetItemsEx(Index: Integer): TTreeNode;\r\nbegin\r\n  if (Index >= Count) then\r\n  begin\r\n    raise Exception.Create('Index out of bounds in list read access');\r\n  end;\r\n\r\n  if Index < Count then\r\n    Result := TTreeNode(inherited Items[Index])\r\n  else\r\n    Result := nil;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TDbgList.SetItemsEx(Index: Integer; const Value: TTreeNode);\r\nbegin\r\n  if (Index >= Count) then\r\n  begin\r\n    raise Exception.Create('Index out of bounds in list write access');\r\n  end;\r\n  if Index < Count then\r\n    inherited Items[Index] := value;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\n{ TTreeNode }\r\n\r\nconstructor TTreeNode.Create(AOwner: TTreeNodes);\r\nbegin\r\n  inherited Create;\r\n  FOwner := AOwner;\r\n  FShowText := true;\r\n  FNodeType := ntText;\r\n  FChecked := False;\r\n  FIsExpanded := False;\r\n  FTag := 0;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\ndestructor TTreeNode.Destroy;\r\nvar\r\n  N, PN, NN: TTreeNode;\r\n  i: Integer;\r\nbegin\r\n  FDeleting := True;\r\n\r\n  DeleteChildren;\r\n\r\n  N := Parent;\r\n  if (((N <> nil) and (not N.Deleting)) or (N = nil)) and (not Owner.FDeleting) and Assigned(Owner) and Assigned(Owner.Owner) and not (csDestroying in Owner.Owner.ComponentState) then\r\n  begin\r\n    PN := getPrevSibling;\r\n    NN := getNextSibling;\r\n\r\n    if not Assigned(NN) then\r\n    begin\r\n      if IsFirstNode then\r\n        Owner.FFirstNode := nil\r\n      else if Assigned(Parent) and IsFirstChild then\r\n        Parent.FFirstChild := nil\r\n      else\r\n      begin\r\n        if Assigned(PN) then\r\n          PN.FNextSibling := nil;\r\n      end;  \r\n    end\r\n    else if not Assigned(PN) then\r\n    begin\r\n      if IsFirstNode then\r\n        Owner.FFirstNode := NN\r\n      else if Assigned(Parent) and IsFirstChild then\r\n        Parent.FFirstChild := NN;\r\n    end\r\n    else     \r\n    begin\r\n      PN.FNextSibling := NN;\r\n      NN.FPrevSibling := PN;\r\n    end;\r\n  end;\r\n\r\n  if not Assigned(Parent) then\r\n  begin\r\n    i := Owner.FNodeList.IndexOf(Self);\r\n    if (i >= 0) then\r\n      Owner.FNodeList.Delete(i);\r\n  end;\r\n\r\n  Data := nil;\r\n  inherited Destroy;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.HasAsParent(Value: TTreeNode): Boolean;\r\nbegin\r\n  if Value <> Nil then\r\n  begin\r\n    if Parent = nil then Result := False\r\n    else if Parent = Value then Result := True\r\n    else Result := Parent.HasAsParent(Value);\r\n  end\r\n  else Result := True;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetTag(const Value: Integer);\r\nbegin\r\n  FTag := Value;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetText(const S: string);\r\nbegin\r\n  if not Deleting and (S <> Text) then\r\n  begin\r\n    FText := S;\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetURL(const Value: string);\r\nbegin\r\n  FURL := Value;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetChecked(const Value: boolean);\r\nbegin\r\n  FChecked := Value;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetData(Value: TObject);\r\nbegin\r\n  if not Deleting and (Value <> Data) then\r\n  begin\r\n    FData := Value;\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetHint(const Value: string);\r\nbegin\r\n  FHint := Value;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetImageCollapsedURL(const Value: string);\r\nbegin\r\n  FImageCollapsedURL := Value;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetImageURL(const Value: string);\r\nbegin\r\n  FImageURL := Value;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetIsExpanded(const Value: Boolean);\r\nbegin\r\n  FIsExpanded := Value;\r\n  if Assigned(FOwner) then\r\n    if Assigned(FOwner.OnExpandedChange) then\r\n      FOwner.OnExpandedChange(FOwner, Self);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.CompareCount(CompareMe: Integer): Boolean;\r\nvar\r\n  Count: integer;\r\n  Node: TTreeNode;\r\nBegin\r\n  Count := 0;\r\n  Result := False;\r\n  Node := GetFirstChild;\r\n  while Node <> nil do\r\n  begin\r\n    Inc(Count);\r\n    Node := Node.GetNextChild(Node);\r\n    if Count > CompareMe then\r\n      Exit;\r\n  end;\r\n  if Count = CompareMe then\r\n    Result := True;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetHasChildren: Boolean;\r\nbegin\r\n  Result := Assigned(FFirstChild);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetParent: TTreeNode;\r\nbegin\r\n  Result := FParentNode;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetNextSibling: TTreeNode;\r\nbegin\r\n  Result := FNextSibling;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetPrevSibling: TTreeNode;\r\nbegin\r\n  Result := FPrevSibling;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetNextChild(Value: TTreeNode): TTreeNode;\r\nbegin\r\n  if Value <> nil then Result := Value.GetNextSibling\r\n  else Result := nil;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetPrevChild(Value: TTreeNode): TTreeNode;\r\nbegin\r\n  if Value <> nil then Result := Value.GetPrevSibling\r\n  else Result := nil;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetFirstChild: TTreeNode;\r\nbegin\r\n  Result := FFirstChild;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetLastChild: TTreeNode;\r\nvar\r\n  Node: TTreeNode;\r\nbegin\r\n  Result := GetFirstChild;\r\n  if Result <> nil then\r\n  begin\r\n    Node := Result;\r\n    repeat\r\n      Result := Node;\r\n      Node := Result.GetNextSibling;\r\n    until Node = nil;\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetIndex: Integer;\r\nvar\r\n  Node: TTreeNode;\r\nbegin\r\n  Result := -1;\r\n  Node := Self;\r\n//  while Node <> nil do\r\n  while Assigned(Node) do\r\n  begin\r\n    Inc(Result);\r\n    Node := Node.GetPrevSibling;\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetItem(Index: Integer): TTreeNode;\r\nbegin\r\n  Result := GetFirstChild;\r\n  while (Result <> nil) and (Index > 0) do\r\n  begin\r\n    Result := GetNextChild(Result);\r\n    Dec(Index);\r\n  end;\r\n  if Result = nil then raise Exception.Create('Invalid index');\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetItem(Index: Integer; Value: TTreeNode);\r\nbegin\r\n  item[Index].Assign(Value);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetNodeType(const Value: TNodeType);\r\nbegin\r\n  FNodeType := Value;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.SetShowText(const Value: Boolean);\r\nbegin\r\n  FShowText := Value;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.IndexOf(Value: TTreeNode): Integer;\r\nvar\r\n  Node: TTreeNode;\r\nbegin\r\n  Result := -1;\r\n  Node := GetFirstChild;\r\n  while (Node <> nil) do\r\n  begin\r\n    Inc(Result);\r\n    if Node = Value then Break;\r\n    Node := GetNextChild(Node);\r\n  end;\r\n  if Node = nil then Result := -1;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetCount: Integer;\r\nvar\r\n  Node: TTreeNode;\r\nbegin\r\n  Result := 0;\r\n  Node := GetFirstChild;\r\n  while Node <> nil do\r\n  begin\r\n    Inc(Result);\r\n    Node := Node.GetNextChild(Node);\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.IsFirstNode: Boolean;\r\nbegin\r\n  Result := Self = Owner.FFirstNode; // not Deleting and (Parent = nil) and (GetPrevSibling = nil);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.IsFirstChild: Boolean;\r\nbegin\r\n  Result := IsFirstNode or (Assigned(Parent) and (Parent.getFirstChild = Self));\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.GetLevel: Integer;\r\nvar\r\n  Node: TTreeNode;\r\nbegin\r\n  Result := 0;\r\n  Node := Parent;\r\n  while Node <> nil do\r\n  begin\r\n    Inc(Result);\r\n    Node := Node.Parent;\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.Delete;\r\nbegin\r\n  if not Deleting then\r\n    Free;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.DeleteChildren;\r\nvar\r\n  ChildList: TDbgList;\r\n  N: TTreeNode;\r\n  i: Integer;\r\nbegin\r\n  ChildList := TDbgList.Create;\r\n  N := GetFirstChild;\r\n  if N <> nil then\r\n  begin\r\n    repeat\r\n      ChildList.Add(N);\r\n      N := N.GetNextSibling;\r\n    until N = nil;\r\n  end;\r\n\r\n  for i := ChildList.Count - 1 downto 0 do\r\n  begin\r\n    ChildList[i].Delete;\r\n  end;\r\n  ChildList.Free;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.AddChild(const S: string): TTreeNode;\r\nbegin\r\n  Result := AddChild(S, nil);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.AddChild(const S: string; Data: TObject): TTreeNode;\r\nvar\r\n  N: TTreeNode;\r\nbegin\r\n  N := GetLastChild;\r\n  if Assigned(N) then\r\n    Result := Owner.InsertNode(nil, N, False)\r\n  else\r\n    Result := Owner.InsertNode(Self, nil, False);\r\n  Result.Text := S;\r\n  Result.Data := Data;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.AddFirstChild(const S: string): TTreeNode;\r\nbegin\r\n  Result := AddFirstChild(S, nil);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.AddFirstChild(const S: string; Data: TObject): TTreeNode;\r\nbegin\r\n  if not Assigned(FFirstChild) then\r\n    Result := Owner.InsertNode(Self, nil, True)\r\n  else\r\n    Result := Owner.InsertNode(nil, FFirstChild, True);\r\n  Result.Text := S;\r\n  Result.Data := Data;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.Assign(Source: TPersistent);\r\nvar\r\n  Node: TTreeNode;\r\nbegin\r\n  if not Deleting and (Source is TTreeNode) then\r\n  begin\r\n    Node := TTreeNode(Source);\r\n    Text := Node.Text;\r\n    Data := Node.Data;\r\n    ShowText := Node.ShowText;\r\n    NodeType := Node.NodeType;\r\n    Checked := Node.Checked;\r\n    URL := Node.URL;\r\n    Hint := Node.Hint;\r\n    ImageURL := Node.ImageURL;\r\n    ImageCollapsedURL := Node.ImageCollapsedURL;\r\n    Tag := Node.Tag;\r\n    FIsExpanded := Node.Expanded;\r\n  end\r\n  else\r\n    inherited Assign(Source);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNode.IsEqual(Node: TTreeNode): Boolean;\r\nbegin\r\n  Result := (Text = Node.Text) and (Data = Node.Data);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n(*\r\nprocedure TTreeNode.ReadData(Stream: TStream; var Info: TNodeDataInfo);\r\nvar\r\n  I, Size, ItemCount, SzM: Integer;\r\n  LNode: TTreeNode;\r\n  s: string;\r\nbegin\r\n  Stream.ReadBuffer(Size, SizeOf(Size));\r\n  Stream.ReadBuffer(Info, SizeOf(TNodeDataInfo));\r\n\r\n  {$IFDEF DELPHI_UNICODE}\r\n  SzM := 2;\r\n  {$ENDIF}\r\n\r\n  {$IFNDEF DELPHI_UNICODE}\r\n  SzM := 1;\r\n  {$ENDIF}\r\n\r\n  SetLength(S, Info.TextLen);\r\n  Stream.ReadBuffer(S[1], SzM * Info.TextLen);\r\n  Text := S;\r\n\r\n  SetLength(S, Info.HintLen);\r\n  Stream.ReadBuffer(S[1], SzM * Info.HintLen);\r\n  Hint := S;\r\n\r\n  SetLength(S, Info.URLLen);\r\n  Stream.ReadBuffer(S[1], SzM * Info.URLLen);\r\n  URL := S;\r\n\r\n  SetLength(S, Info.ImageURLLen);\r\n  Stream.ReadBuffer(S[1], SzM * Info.ImageURLLen);\r\n  ImageURL := S;\r\n\r\n  SetLength(S, Info.ImageCollapsedURLLen);\r\n  Stream.ReadBuffer(S[1], SzM * Info.ImageCollapsedURLLen);\r\n  ImageCollapsedURL := S;\r\n\r\n  NodeType := Info.NodeType;\r\n  Checked := Info.Checked;\r\n  Tag := Info.Tag;\r\n  IsExpanded := Info.IsExpanded;\r\n\r\n  ItemCount := Info.Count;\r\n  for I := 0 to ItemCount - 1 do\r\n  begin\r\n    LNode := AddChild(''); //Owner.Add(Self, '');\r\n    LNode.FParentNode := Self;\r\n    LNode.ReadData(Stream, Info);\r\n    //Owner.Owner.Added(LNode);\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNode.WriteData(Stream: TStream; var Info: TNodeDataInfo);\r\nvar\r\n  I, Size, ItemCount, SzM: Integer;\r\nbegin\r\n  //L := Length(Text);\r\n  //if L > 255 then L := 255;\r\n  //Size := SizeOf(TNodeInfo) + L - 255;\r\n\r\n  //L := Min(255, Length(Text)) + Min(255, Length(URL)) + Min(255, Length(Hint)) + Min(255, Length(ImageURL)) + Min(255, Length(ImageCollapsedURL));\r\n  //Size := SizeOf(TNodeInfo) + L - 255 * 5;\r\n\r\n  {$IFDEF DELPHI_UNICODE}\r\n  SzM := 2;\r\n  {$ENDIF}\r\n\r\n  {$IFNDEF DELPHI_UNICODE}\r\n  SzM := 1;\r\n  {$ENDIF}\r\n\r\n  Info.TextLen := Min(255, Length(Text));\r\n  Info.HintLen := Min(255, Length(Hint));\r\n  Info.URLLen := Min(255, Length(URL));\r\n  Info.ImageURLLen := Min(255, Length(ImageURL));\r\n  Info.ImageCollapsedURLLen := Min(255, Length(ImageCollapsedURL));\r\n\r\n  Info.NodeType := NodeType;\r\n  Info.Checked := Checked;\r\n  Info.Tag := Tag;\r\n  Info.IsExpanded := IsExpanded;\r\n\r\n  ItemCount := Count;\r\n  Info.Count := ItemCount;\r\n\r\n  Size := SizeOf(TNodeDataInfo) + (Info.TextLen + Info.HintLen + Info.URLLen + Info.ImageURLLen + Info.ImageCollapsedURLLen);\r\n\r\n  Stream.WriteBuffer(Size, SizeOf(Size));\r\n  Stream.WriteBuffer(Info, SizeOf(TNodeDataInfo));\r\n  Stream.WriteBuffer(Text[1], SzM * Info.TextLen);\r\n  Stream.WriteBuffer(Hint[1], SzM * Info.HintLen);\r\n  Stream.WriteBuffer(URL[1], SzM * Info.URLLen);\r\n  Stream.WriteBuffer(ImageURL[1], SzM * Info.ImageURLLen);\r\n  Stream.WriteBuffer(ImageCollapsedURL[1], SzM * Info.ImageCollapsedURLLen);\r\n\r\n  for I := 0 to ItemCount - 1 do\r\n    Item[I].WriteData(Stream, Info);\r\nend;\r\n*)\r\n//------------------------------------------------------------------------------\r\n\r\n{ TTreeNodes }\r\n\r\nconstructor TTreeNodes.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create;\r\n  FOwner := AOwner;\r\n  FFirstNode := nil;\r\n  FNodeList :=  TDbgList.Create;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.CreateNode: TTreeNode;\r\nvar\r\n  LClass: TTreeNodeClass;\r\nbegin\r\n  LClass := TTreeNode;\r\n  Result := LClass.Create(Self);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\ndestructor TTreeNodes.Destroy;\r\nbegin\r\n  FDeleting := True;\r\n  Clear;\r\n  FNodeList.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNodes.Delete(Node: TTreeNode);\r\nbegin\r\n  Node.Delete;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNodes.Changed;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TTreeNodes.Clear;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  for i := FNodeList.Count - 1 downto 0 do\r\n    FNodeList[i].Delete;\r\n\r\n  FNodeList.Clear;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.GetCount: Integer;\r\nbegin\r\n  Result := FNodeList.Count;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.GetNodeFromIndex(Index: Integer): TTreeNode;\r\nbegin\r\n  Result := nil;\r\n  if (Index >= 0) and (Index < FNodeList.Count) then\r\n    Result := FNodeList[Index];\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNodes.SetItem(Index: Integer; Value: TTreeNode);\r\nbegin\r\n  if (Index >= 0) and (Index < FNodeList.Count) then\r\n    GetNodeFromIndex(Index).Assign(Value);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.Insert(Sibling: TTreeNode; const S: string): TTreeNode;\r\nbegin\r\n  Result := InsertObject(Sibling, S, nil);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.InsertObject(Sibling: TTreeNode; const S: string;\r\n  Data: TObject): TTreeNode;\r\nbegin\r\n  Result := InsertNode(nil, Sibling, True);\r\n  if Assigned(Result) then\r\n  begin\r\n    Result.Text := S;\r\n    Result.Data := Data;\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.IsVeryFirstNode(Node: TTreeNode): Boolean;\r\nbegin\r\n  Result := Assigned(Node) and (Node = FFirstNode);  \r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.GetFirstNode: TTreeNode;\r\nbegin\r\n  Result := FFirstNode;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.GetLastNode: TTreeNode;\r\nbegin\r\n  Result := FFirstNode;\r\n  if Assigned(Result) then\r\n    while (Result.getNextSibling <> nil) do\r\n      Result := Result.getNextSibling;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.Add(Sibling: TTreeNode; const S: string): TTreeNode;\r\nbegin\r\n  Result := Add(Sibling, S, nil);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.Add(Sibling: TTreeNode; const S: string; Data: TObject): TTreeNode;\r\nbegin\r\n  Result := InsertNode(Sibling, GetLastNode, False);\r\n  Result.Text := S;\r\n  Result.Data := Data;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.Add(const S: string): TTreeNode;\r\nbegin\r\n  Result := Add(S, nil);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.Add(const S: string; Data: TObject): TTreeNode;\r\nbegin\r\n  Result := InsertNode(nil, GetLastNode, False);\r\n  Result.Text := S;\r\n  Result.Data := Data;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.AddChild(Parent: TTreeNode; const S: string): TTreeNode;\r\nbegin\r\n  Result := AddChild(Parent, S, nil);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.AddChild(Parent: TTreeNode;\r\n  const S: string; Data: TObject): TTreeNode;\r\nbegin\r\n  Result := nil;\r\n\r\n  if Assigned(Parent) then\r\n    Result := Parent.AddChild(S, Data);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.AddChildFirst(Parent: TTreeNode;\r\n  const S: string): TTreeNode;\r\nbegin\r\n  Result := AddChildFirst(Parent, S, nil);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.AddChildFirst(Parent: TTreeNode;\r\n  const S: string; Data: TObject): TTreeNode;\r\nbegin\r\n  Result := nil;\r\n  if Assigned(Parent) then\r\n    Result := Parent.AddFirstChild(S, Data)\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.AddFirst(const S: string): TTreeNode;\r\nbegin\r\n  Result := AddFirst(nil, S);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.AddFirst(Data: TObject; const S: string): TTreeNode;\r\nbegin\r\n  if not Assigned(FFirstNode) then\r\n  begin\r\n    //Result := CreateNode;\r\n    //FFirstNode := Result\r\n    Result := InsertNode(nil, nil, True);\r\n  end\r\n  else\r\n  begin\r\n    Result := InsertNode(nil, FFirstNode, True);\r\n  end;\r\n  Result.Text := S;\r\n  Result.Data := Data;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nfunction TTreeNodes.InsertNode(ParentNode: TTreeNode; DesNode: TTreeNode; InsertBefore: Boolean): TTreeNode;\r\nvar\r\n  N: TTreeNode;\r\nbegin\r\n  Result := nil;\r\n  if not Assigned(DesNode) then\r\n  begin\r\n    if Assigned(ParentNode) then\r\n    begin\r\n      N := ParentNode.GetLastChild;\r\n      if Assigned(N) then\r\n      begin\r\n        InsertNode(nil, N, False);\r\n        Exit;\r\n      end\r\n      else  // First Child Node\r\n      begin\r\n        Result := CreateNode;\r\n        ParentNode.FFirstChild := Result;\r\n        Result.FParentNode := ParentNode;\r\n        Exit;\r\n        {\r\n        if Assigned(ParentNode.GetNextSibling) then\r\n           FNodeList.Insert(ParentNode.GetNextSibling.Index, Result)\r\n        else\r\n          FNodeList.Add(Result);\r\n        }\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      if not Assigned(FFirstNode) then\r\n      begin\r\n        Result := CreateNode;\r\n        FFirstNode := Result;  // very first Node\r\n        FNodeList.Add(Result);\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    Result := CreateNode;\r\n    if InsertBefore then\r\n    begin\r\n      if IsVeryFirstNode(DesNode) then\r\n      begin\r\n        FFirstNode := Result;\r\n        Result.FNextSibling := DesNode;\r\n        DesNode.FPrevSibling := Result;\r\n        FNodeList.Insert(0,Result);\r\n      end\r\n      else\r\n      begin\r\n//fix: if DesNode is not the first node in a treeview, but a first child in a parent node (with DesNode.FPrevSibling = nil),\r\n//then execution continues on \"else\" branch and DesNode.Parent.FFirstChild does not change\r\n//- it remains pointing to DesNode, not on newly inserted node\r\n//        if DesNode.IsFirstNode and Assigned(DesNode.Parent) then\r\n        if DesNode.IsFirstChild and Assigned(DesNode.Parent) then\r\n        begin\r\n          DesNode.Parent.FFirstChild := Result;\r\n          Result.FNextSibling := DesNode;\r\n          DesNode.FPrevSibling := Result;\r\n          Result.FParentNode := DesNode.Parent;\r\n        end\r\n        else\r\n        begin\r\n          Result.FPrevSibling := DesNode.FPrevSibling;\r\n          Result.FNextSibling := DesNode;\r\n          DesNode.FPrevSibling := Result;\r\n          Result.FParentNode := DesNode.Parent;\r\n          if Assigned(Result.FPrevSibling) then\r\n            Result.FPrevSibling.FNextSibling := Result;\r\n        end;\r\n      end;\r\n    end\r\n    else // Insert after DesNode\r\n    begin\r\n      Result.FNextSibling := DesNode.FNextSibling;\r\n      Result.FPrevSibling := DesNode;\r\n      DesNode.FNextSibling := Result;\r\n      if Assigned(Result.FNextSibling) then\r\n        Result.FNextSibling.FPrevSibling := Result;\r\n      Result.FParentNode := DesNode.Parent;\r\n      if not Assigned(DesNode.Parent) then  // Root Node\r\n        FNodeList.Add(Result);\r\n    end;\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNodes.Assign(Source: TPersistent);\r\nvar\r\n//  TreeNodes: TTreeNodes;\r\n//  MemStream: TMemoryStream;\r\nbegin\r\n\r\n  if Source is TTreeNodes then\r\n  begin\r\n//    TreeNodes := TTreeNodes(Source);\r\n    Clear;\r\n    (*\r\n    MemStream := TMemoryStream.Create;\r\n    try\r\n      TreeNodes.WriteData(MemStream);\r\n      MemStream.Position := 0;\r\n      ReadData(MemStream);\r\n    finally\r\n      MemStream.Free;\r\n    end;\r\n    *)\r\n  end\r\n  else inherited Assign(Source);\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n(*\r\nprocedure TTreeNodes.DefineProperties(Filer: TFiler);\r\n\r\n  function WriteNodes: Boolean;\r\n  var\r\n    I: Integer;\r\n    Nodes: TTreeNodes;\r\n  begin\r\n    Nodes := TTreeNodes(Filer.Ancestor);\r\n    if Nodes = nil then\r\n      Result := Count > 0\r\n    else if Nodes.Count <> Count then\r\n      Result := True\r\n    else\r\n    begin\r\n      Result := False;\r\n      for I := 0 to Count - 1 do\r\n      begin\r\n        Result := not Item[I].IsEqual(Nodes[I]);\r\n        if Result then\r\n          Break;\r\n      end\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  inherited DefineProperties(Filer);\r\n  Filer.DefineBinaryProperty('Data', ReadData, WriteData, WriteNodes);\r\nend;\r\n*)\r\n//------------------------------------------------------------------------------\r\n(*\r\nprocedure TTreeNodes.ReadData(Stream: TStream);\r\nvar\r\n  I, Count: Integer;\r\n  NodeInfo: TNodeDataInfo;\r\n  LNode: TTreeNode;\r\nbegin\r\n  FReading := True;\r\n  try\r\n    Clear;\r\n    Stream.ReadBuffer(Count, SizeOf(Count));\r\n    for I := 0 to Count - 1 do\r\n    begin\r\n      LNode := Add('');\r\n      LNode.ReadData(Stream, NodeInfo);\r\n    end;\r\n  finally\r\n    FReading := False;\r\n  end;\r\nend;\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nprocedure TTreeNodes.WriteData(Stream: TStream);\r\nvar\r\n  I: Integer;\r\n  Node: TTreeNode;\r\n  NodeInfo: TNodeDataInfo;\r\nbegin\r\n  I := 0;\r\n  Node := GetFirstNode;\r\n  while Node <> nil do\r\n  begin\r\n    Inc(I);\r\n    Node := Node.GetNextSibling;\r\n  end;\r\n  Stream.WriteBuffer(I, SizeOf(I));\r\n  Node := GetFirstNode;\r\n  while Node <> nil do\r\n  begin\r\n    Node.WriteData(Stream, NodeInfo);\r\n    Node := Node.GetNextSibling;\r\n  end;\r\nend;\r\n*)\r\n//------------------------------------------------------------------------------\r\n\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.ComCtrls;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, Web, WEBLib.Controls, WEBLib.Graphics, WEBLib.ExtCtrls,\r\n  WEBLib.TreeNodes;\r\n\r\ntype\r\n  TCustomRichEdit = class;\r\n\r\n  TTextAttributes = class(TPersistent)\r\n  private\r\n    RichEdit: TCustomRichEdit;\r\n    FAlignment: TAlignment;\r\n    FIsBold: Boolean;\r\n    FIsItalic: Boolean;\r\n    FIsUnderline: Boolean;\r\n    FIsStrikeOut: Boolean;\r\n    FBackColor: TColor;\r\n    FColor: TColor;\r\n    FHeight: Integer;\r\n    FName: String;\r\n    FOrderedList: Boolean;\r\n    FSize: Integer;\r\n    FStyle: TFontStyles;\r\n    FUnOrderedList: Boolean;\r\n    procedure SetAlignment(Value: TAlignment);\r\n    procedure SetBackColor(Value: TColor);\r\n    procedure SetColor(Value: TColor);\r\n    procedure SetHeight(Value: Integer);\r\n    procedure SetName(Value: String);\r\n    procedure SetOrderedList(Value: Boolean);\r\n    procedure SetSize(Value: Integer);\r\n    procedure SetStyle(Value: TFontStyles);\r\n    procedure SetUnOrderedList(Value: Boolean);\r\n  protected\r\n    procedure AssignTo(Dest: TPersistent); override;\r\n  public\r\n    constructor Create(AOwner: TCustomRichEdit); reintroduce;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure Cut;\r\n    procedure Copy;\r\n    procedure Paste;\r\n    procedure Image;\r\n    procedure Link;\r\n    property Alignment: TAlignment read FAlignment write SetAlignment;\r\n    property BackColor: TColor read FBackColor write SetBackColor;\r\n    property Color: TColor read FColor write SetColor;\r\n    property Height: Integer read FHeight write SetHeight;\r\n    property Name: String read FName write SetName;\r\n    property OrderedList: Boolean read FOrderedList write SetOrderedList;\r\n    property Size: Integer read FSize write SetSize;\r\n    property Style: TFontStyles read FStyle write SetStyle;\r\n    property UnOrderedList: Boolean read FUnOrderedList write SetUnOrderedList;\r\n  end;\r\n\r\n  TCustomRichEdit = class(TCustomControl)\r\n  private\r\n    FOwner: TCustomControl;\r\n    FLines: TStringList;\r\n    FSelAttributes: TTextAttributes;\r\n    FAutoSize: Boolean;\r\n    FOnSelectionChange: TNotifyEvent;\r\n    FShowFocus: boolean;\r\n    FInsertLineBreaks: boolean;\r\n    FWantTabs: boolean;\r\n    FReadOnly: boolean;\r\n    FOnChange: TNotifyEvent;\r\n    function GetText: String;\r\n    function GetPlainText: String;\r\n    procedure SetText(const Value: String);\r\n    procedure SetSelAttributes(Value: TTextAttributes);\r\n    procedure SetAutoSize(const Value: Boolean);\r\n    procedure SetShowFocus(const Value: boolean); reintroduce;\r\n    procedure SetReadOnly(const Value: boolean);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n//    function ElementIFrameHandle: TJSWindow;\r\n    function ElementIFrameHandle: TJSDocument;\r\n    procedure UpdateElement; override;\r\n    procedure Loaded; override;\r\n    function CanShowFocus: boolean; override;\r\n    procedure DoHandleInput(Event: TJSEvent); virtual;\r\n    function HandleDoSelectionChange(Event: TEventListenerEvent): Boolean; virtual;\r\n    function HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean; override;\r\n    procedure SetLines(ALines: TStringList);\r\n    procedure DoLinesChange(Sender: TObject);\r\n    property Text: String read GetText write SetText;\r\n    property Font;\r\n    property Color;\r\n    property BorderStyle;\r\n    property AutoSize: Boolean read FAutoSize write SetAutoSize default false;\r\n    property Lines: TStringList read FLines write SetLines;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnSelectionChange: TNotifyEvent read FOnSelectionChange write FOnSelectionChange;\r\n    property PlainText: String read GetPlainText;\r\n    procedure DoEditAction(ActionString: string); overload;\r\n    procedure DoEditAction(ActionString: string; Data: string); overload;\r\n    procedure DoChange; virtual;\r\n    procedure BindEvents; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n\r\n    function GetContent: string;\r\n    procedure DoSelectAction(StartPosition, EndPosition: integer);\r\n    procedure DoImageAction;\r\n    procedure DoLinkAction;\r\n    procedure InsertHTML(HTML: String);\r\n\r\n    property InsertLineBreaks: boolean read FInsertLineBreaks write FInsertLineBreaks default false;\r\n    property SelAttributes: TTextAttributes read FSelAttributes write SetSelAttributes;\r\n    property ShowFocus: boolean read FShowFocus write SetShowFocus default true;\r\n    property Owner: TCustomControl read FOwner write FOwner;\r\n    property ReadOnly: boolean read FReadOnly write SetReadOnly default false;\r\n    property WantTabs: boolean read FWantTabs write FWantTabs default false;\r\n  end;\r\n\r\n  TRichEdit = class(TCustomRichEdit)\r\n  public\r\n    property Owner;\r\n    property PlainText;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property Font;\r\n    property Color;\r\n    property BorderStyle;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property InsertLinebreaks;\r\n    property Lines;\r\n    property Margins;\r\n    property ReadOnly;\r\n    property WantTabs;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnSelectionChange;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebRichEdit = class(TRichEdit);\r\n\r\n  TTabSet = class(TCustomControl)\r\n  private\r\n    FItems: TStringList;\r\n    FItemIndex: integer;\r\n    FSelectedColor: TColor;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetSelectedColor(const Value: TColor);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; override;\r\n    function HandleDoChange(Event: TEventListenerEvent): Boolean; virtual;\r\n    function HandleDoItemMouseOut(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoItemMouseOver(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure BindEvents; override;\r\n    procedure SetItems(AItems: TStringList);\r\n    procedure SetItemIndex(AIndex: integer);\r\n    procedure DoUpdateList; virtual;\r\n    procedure Loaded; override;\r\n    procedure ItemsChanged(Sender: TObject);\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure EndUpdate; override;\r\n    procedure Clear;\r\n    procedure SelectNextTab(GoForward: boolean);\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property ItemIndex: integer read FItemIndex write SetItemIndex;\r\n    property Items: TStringList read FItems write SetItems;\r\n    property Left;\r\n    property Margins;\r\n    property ParentFont;\r\n    property ShowHint;\r\n    property SelectedColor: TColor read FSelectedColor write SetSelectedColor default clSilver;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebTabSet = class(TTabSet);\r\n\r\n  TTabSheet = class(TPanel)\r\n  private\r\n    FTabVisible: Boolean;\r\n    FTabCaption: string;\r\n    procedure SetTabVisible(const Value: Boolean);\r\n  protected\r\n    procedure SetCaption(const AValue: string); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property TabVisible: Boolean read FTabVisible write SetTabVisible default True;\r\n    property Visible;\r\n  end;\r\n\r\n  TWebTabSheet = class(TTabSheet);\r\n\r\n  TPageControl = class(TCustomControl)\r\n  private\r\n    FPrevTabIndex: Integer;\r\n    FItems: TStringList;\r\n    FTabIndex: Integer;\r\n    FSelectedColor: TColor;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetSelectedColor(const AValue: TColor);\r\n    procedure SetItems(AItems: TStringList);\r\n    procedure SetTabIndex(AIndex: integer);\r\n  protected\r\n    function GetPage(Index: integer): TTabSheet;\r\n    function CreateElement: TJSElement; override;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; override;\r\n    function HandleDoChange(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoItemMouseOut(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoItemMouseOver(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure BindEvents; override;\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); override;\r\n    procedure DoUpdateList; virtual;\r\n    procedure DoUpdateResize; virtual;\r\n    procedure Loaded; override;\r\n    procedure ItemsChanged(Sender: TObject); virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Clear;\r\n    procedure EndUpdate; override;\r\n    procedure SelectNextPage(GoForward: boolean);\r\n    function PageCount: integer;\r\n    property Pages[index: integer]: TTabSheet read GetPage;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property ElementClassName;\r\n    property ElementFont;\r\n    property ElementID;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property TabIndex: integer read FTabIndex write SetTabIndex;\r\n    property Items: TStringList read FItems write SetItems;\r\n    property Left;\r\n    property Margins;\r\n    property ParentFont;\r\n    property ShowHint;\r\n    property SelectedColor: TColor read FSelectedColor write SetSelectedColor;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebPageControl = class(TPageControl);\r\n\r\n  TProgressBarStyle = (pbstNormal, pbstMarquee, pbstDiv);\r\n  TProgressBarValue = (pbvNone, pbvPercentage, pbvAbsolute);\r\n\r\n  TProgressBar = class(TCustomControl)\r\n  private\r\n    FMax: integer;\r\n    FMin: integer;\r\n    FPosition: integer;\r\n    FStyle: TProgressBarStyle;\r\n    FElementBarClassName: string;\r\n    FValue: TProgressBarValue;\r\n    procedure SetStyle(const Value: TProgressBarStyle);\r\n    procedure SetElementBarClassName(const Value: string);\r\n    procedure SetValue(const Value: TProgressBarValue);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetMax(AValue: integer);\r\n    procedure SetMin(AValue: integer);\r\n    procedure SetPosition(AValue: integer);\r\n    procedure DoUpdate; virtual;\r\n    procedure CreateProgressElement(AElement: TJSElement);\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure AfterLoadDFMValues; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ElementBarClassName: string read FElementBarClassName write SetElementBarClassName;\r\n    property ElementPosition;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Left;\r\n    property Margins;\r\n    property Max: integer read FMax write SetMax;\r\n    property Min: integer read FMin write SetMin;\r\n    property Position: integer read FPosition write SetPosition;\r\n    property Style: TProgressBarStyle read FStyle write SetStyle;\r\n    property Top;\r\n    property Value: TProgressBarValue read FValue write SetValue;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n  end;\r\n\r\n  TWebProgressBar = class(TProgressBar);\r\n\r\n  TTreeViewNodeEvent = procedure(Sender: TObject; Node: TTreeNode) of object;\r\n  TTreeViewNodeAllowEvent = procedure(Sender: TObject; Node: TTreeNode; var Allow: boolean) of object;\r\n\r\n  TTreeViewNodeRenderEvent = procedure(Sender: TObject; Node: TTreeNode; AElement: TJSHTMLElement) of object;\r\n\r\n  TTreeView = class(TCustomControl)\r\n  private\r\n    FItems: TTreeNodes;\r\n    FSelected: TTreeNode;\r\n    FOnCollapsing: TTreeViewNodeAllowEvent;\r\n    FOnExpanding: TTreeViewNodeAllowEvent;\r\n    FOnCollapsed: TTreeViewNodeEvent;\r\n    FOnExpanded: TTreeViewNodeEvent;\r\n    FOnClickNode: TTreeViewNodeEvent;\r\n    FOnDblClickNode: TTreeViewNodeEvent;\r\n    FOnRenderNode: TTreeViewNodeRenderEvent;\r\n    FAutoExpand: boolean;\r\n    FOnChange: TTreeViewNodeEvent;\r\n    FOnChanging: TTreeViewNodeAllowEvent;\r\n    FElementNodeSelectedClassName: TElementClassName;\r\n    FElementNodeClassName: TElementClassName;\r\n    procedure SetItems(const Value: TTreeNodes);\r\n    function GetSelected: TTreeNode;\r\n    procedure SetSelected(const Value: TTreeNode);\r\n    procedure SetElementNodeClassName(const Value: TElementClassName);\r\n    procedure SetElementNodeSelectedClassName(const Value: TElementClassName);\r\n  protected\r\n    procedure DoRenderNode(ANode: TTreeNode; AElement: TJSHTMLElement);\r\n    function RenderNode(ANode: TTreeNode; AElementName: string): TJSHTMLElement;\r\n    procedure RenderNodes;\r\n    function CreateElement: TJSElement; override;\r\n    procedure DoNodesChanged(Sender: TObject);\r\n    procedure DoExpandedChanged(Sender: TObject; ANode: TTreeNode);\r\n    function HandleNode(Event: TJSEvent): Boolean; virtual;\r\n    function HandleClick(Event: TJSEvent): Boolean; virtual;\r\n    function HandleDblClick(Event: TJSEvent): Boolean; virtual;\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure DoChangeSelection(NewNode: TTreeNode); virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure BeginUpdate; override;\r\n    procedure EndUpdate; override;\r\n    function GetNodeFromID(AId: string): TTreeNode;\r\n    function GetNodeElement(ANode: TTreeNode): TJSHTMLElement;\r\n    property Selected: TTreeNode read GetSelected write SetSelected;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n\r\n    property AutoExpand: boolean read FAutoExpand write FAutoExpand;\r\n    property ElementNodeClassName: TElementClassName read FElementNodeClassName write SetElementNodeClassName;\r\n    property ElementNodeSelectedClassName: TElementClassName read FElementNodeSelectedClassName write SetElementNodeSelectedClassName;\r\n\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n\r\n    property Items: TTreeNodes read FItems write SetItems;\r\n    property Margins;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnClickNode: TTreeViewNodeEvent read FOnClickNode write FOnClickNode;\r\n    property OnDblClickNode: TTreeViewNodeEvent read FOnDblClickNode write FOnDblClickNode;\r\n    property OnRenderNode: TTreeViewNodeRenderEvent read FOnRenderNode write FOnRenderNode;\r\n    property OnChange: TTreeViewNodeEvent read FOnChange write FOnChange;\r\n    property OnChanging: TTreeViewNodeAllowEvent read FOnChanging write FOnChanging;\r\n\r\n    property OnCollapsed: TTreeViewNodeEvent read FOnCollapsed write FOnCollapsed;\r\n    property OnCollapsing: TTreeViewNodeAllowEvent read FOnCollapsing write FOnCollapsing;\r\n    property OnExpanded: TTreeViewNodeEvent read FOnExpanded write FOnExpanded;\r\n    property OnExpanding: TTreeViewNodeAllowEvent read FOnExpanding write FOnExpanding;\r\n  end;\r\n\r\n  TWebTreeView = class(TTreeView);\r\n\r\n\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Buttons;\r\n\r\n{ TCustomRichEdit }\r\n\r\nprocedure TCustomRichEdit.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FLines := TStringList.Create;\r\n  FLines.OnChange := DoLinesChange;\r\n  FSelAttributes := TTextAttributes.Create(Self);\r\n  FShowFocus := true;\r\n  FInsertLineBreaks := false;\r\n  Width := 400;\r\n  Height := 300;\r\nend;\r\n\r\nprocedure TCustomRichEdit.BindEvents;\r\nbegin\r\n  inherited;\r\n  Container.addEventListener('input',@DoHandleInput);\r\nend;\r\n\r\nfunction TCustomRichEdit.CanShowFocus: boolean;\r\nbegin\r\n  Result := FShowFocus;\r\nend;\r\n\r\nfunction TCustomRichEdit.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\ndestructor TCustomRichEdit.Destroy;\r\nbegin\r\n  FLines.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomRichEdit.DoLinesChange(Sender: TObject);\r\nbegin\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomRichEdit.SetAutoSize(const Value: Boolean);\r\nbegin\r\n  if FAutoSize <> Value then\r\n  begin\r\n    FAutoSize := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomRichEdit.SetLines(ALines: TStringList);\r\nbegin\r\n  FLines.Assign(ALines);\r\nend;\r\n\r\nprocedure TCustomRichEdit.SetReadOnly(const Value: boolean);\r\nbegin\r\n  if FReadOnly <> Value then\r\n  begin\r\n    FReadOnly := Value;\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      if FReadOnly then\r\n        ElementHandle.contentEditable := 'false'\r\n      else\r\n        ElementHandle.contentEditable := 'true';\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nprocedure TCustomRichEdit.SetText(const Value: String);\r\nbegin\r\n  FLines.Text := Value;\r\n  UpdateElement;\r\nend;\r\n\r\n//function TCustomRichEdit.ElementIFrameHandle: TJSWindow;\r\nfunction TCustomRichEdit.ElementIFrameHandle: TJSDocument;\r\n//var\r\n//  iframe: TJSHTMLIFrameElement;\r\nbegin\r\n  Result := nil;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n//    iframe := TJSHTMLIFrameElement(document.getElementById(ElementID));\r\n//    if Assigned(iframe) then\r\n//      result := iframe.contentWindow.document;\r\n    Result := document;\r\n  end;\r\nend;\r\n\r\nprocedure GetTextNodes(node: TJSNode; nodes: TList);\r\nvar\r\n  children: TJSNodeList;\r\n  i, j: integer;\r\n  childlist: TList;\r\nbegin\r\n  if (node.nodeType = 3) then\r\n    nodes.Add(node)\r\n  else\r\n  begin\r\n    children := node.childNodes;\r\n    childlist := TList.Create;\r\n    for i := 0 to children.length - 1 do \r\n    begin\r\n      getTextNodes(children[i], childlist);   \r\n      for j := 0 to childlist.count - 1 do\r\n        nodes.Add(childlist[i]);\r\n    end;\r\n    childlist.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomRichEdit.DoSelectAction(StartPosition, EndPosition: integer);\r\nvar\r\n  s: string;\r\n  sstart, send: integer;\r\n  el: TJSElement;\r\n  range: TJSRange;\r\n  textNodes: TList;\r\n  textNode: TJSNode;\r\n  i: integer;\r\n  foundStart: boolean;\r\n  charCount, endCharCount: integer;\r\n  sel: TJSSelection;\r\nbegin\r\n  s := ElementID;\r\n  sstart := StartPosition;\r\n  send := EndPosition;\r\n\r\n  el := document.getElementById(s);\r\n  if Assigned(el) then\r\n  begin\r\n    range := document.createRange;\r\n    range.selectNodeContents(el);\r\n    textNodes := TList.Create;\r\n    GetTextNodes(el, textNodes);\r\n\r\n    foundStart := false;\r\n    charCount := 0;\r\n    endCharCount := 0;\r\n\r\n    for i := 0 to textNodes.count - 1 do\r\n    begin\r\n      textNode := TJSNode(textNodes[i]);\r\n      endCharCount := charCount + length(TJSNode(textNode).nodeValue);\r\n\r\n      if (not foundStart) and (sstart >= charCount) and ((sstart < endCharCount) or ((sstart = endCharCount) and (i <= textNodes.count))) then\r\n      begin\r\n        range.setStart(textNode, sstart - charCount);\r\n        foundStart := true;\r\n      end;\r\n\r\n      if (foundStart) and (send <= endCharCount) then\r\n      begin\r\n        range.setEnd(textNode, send - charCount);\r\n      \tbreak;\r\n      end;\r\n      charCount := endCharCount;\r\n    end;\r\n\r\n    sel := document.getSelection();\r\n    sel.removeAllRanges();\r\n    sel.addRange(range);\r\n\r\n    textNodes.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomRichEdit.DoEditAction(ActionString: string);\r\nbegin\r\n  if Assigned(ElementIFrameHandle) then\r\n    ElementIFrameHandle.execCommand(ActionString, false);\r\nend;\r\n\r\nprocedure TCustomRichEdit.DoChange;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TCustomRichEdit.DoEditAction(ActionString: string; Data: string);\r\nbegin\r\n  if Assigned(ElementIFrameHandle) then\r\n    ElementIFrameHandle.execCommand(ActionString, false, Data);\r\nend;\r\n\r\nprocedure TCustomRichEdit.DoHandleInput(Event: TJSEvent);\r\nbegin\r\n  DoChange;\r\nend;\r\n\r\nprocedure TCustomRichEdit.DoLinkAction;\r\nvar\r\n  url: string;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    url := window.prompt('Enter URL:', 'http://');\r\n    if Assigned(url) then\r\n    begin\r\n      if (url <> '') and (url <> 'http://') and (url <> 'https://') then\r\n        DoEditAction('createLink', url);\r\n      end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomRichEdit.DoImageAction;\r\nvar\r\n  url: string;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    url := window.prompt('Enter Image URL:', 'http://');\r\n    if Assigned(url) then\r\n    begin\r\n      if (url <> '') and (url <> 'http://') and (url <> 'https://') then\r\n        DoEditAction('insertImage', url);\t\r\n      end;\r\n  end; \r\nend;\r\n\r\nprocedure TCustomRichEdit.UpdateElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementIFrameHandle) then\r\n  begin\r\n//    ElementIFrameHandle.designMode := 'On';\r\n//    ElementIFrameHandle.document.open;\r\n//    ElementIFrameHandle.document.write(FLines.Text);\r\n//    ElementIFrameHandle.document.close;\r\n//    ElementIFrameHandle.document.contentEditable = true;\r\n//    ElementIFrameHandle.body.innerHTML := FLines.Text;  \r\n  end;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.innerHTML := FLines.Text;\r\n\r\n    if ReadOnly then\r\n      ElementHandle.contentEditable := 'false'\r\n    else\r\n      ElementHandle.contentEditable := 'true';\r\n\r\n    ElementHandle.style.setProperty('overflow', 'auto');\r\n    ElementHandle.style.setProperty('padding', '3px');\r\n\r\n    if BorderStyle = bsSingle then\r\n      ElementHandle.style.setProperty('border', '1px solid silver')\r\n    else\r\n      ElementHandle.style.setProperty('border', '');\r\n  end;\r\nend;\r\n\r\nfunction TCustomRichEdit.GetText: String;\r\nbegin\r\n//  if Assigned(ElementIFrameHandle) then\r\n//    FLines.Text := ElementIFrameHandle.body.innerHTML;\r\n\r\n  if Assigned(ElementHandle) then\r\n    FLines.Text := ElementHandle.innerHTML;\r\n  Result := FLines.Text;\r\nend;\r\n\r\nfunction TCustomRichEdit.GetContent: string;\r\nbegin\r\n  Result := self.GetText;\r\nend;\r\n\r\nfunction TCustomRichEdit.GetPlainText: String;\r\nbegin\r\n  Result := '';\r\n  if Assigned(ElementHandle) then\r\n    Result := ElementHandle.innerText;\r\nend;\r\n\r\nprocedure TCustomRichEdit.SetSelAttributes(Value: TTextAttributes);\r\nbegin\r\n  SelAttributes.Assign(Value);\r\nend;\r\n\r\nprocedure TCustomRichEdit.SetShowFocus(const Value: boolean);\r\nbegin\r\n  if (FShowFocus <> Value) then\r\n  begin\r\n    FShowFocus := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomRichEdit.Loaded;\r\nvar\r\n  doc: TJSDocument;\r\n  el: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementIFrameHandle) then\r\n  begin\r\n    doc := ElementIFrameHandle;\r\n    el := ElementHandle;\r\n//    el.onwheel := @HandleDoWheel;\r\n    el.onclick := @HandleDoClick;\r\n    el.ondblclick := @HandleDoDblClick;\r\n    el.onmousedown := @HandleDoMouseDown;\r\n    el.onmouseup := @HandleDoMouseUp;\r\n    el.onmousemove := @HandleDoMouseMove;\r\n    el.onkeydown := @HandleDoKeyDown;\r\n    el.onkeyup := @HandleDoKeyUp;\r\n    el.onkeypress := @HandleDoKeyPress;\r\n    el.onfocus := @HandleDoEnter;\r\n    el.onblur := @HandleDoExit;\r\n    doc.onselectionchange := @HandleDoSelectionChange;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomRichEdit.InsertHTML(HTML: String);\r\nvar\r\n  sel: TJSSelection;\r\n  range: TJSRange;\r\n  el: TJSHTMLElement;\r\n  frag: TJSDocumentFragment;\r\n  node, lastNode: TJSNode;\r\nbegin\r\n  sel := nil;\r\n  if Focused then\r\n  begin\r\n    sel := document.getSelection;\r\n    range := sel.getRangeAt(0);\r\n    range.deleteContents;\r\n  end\r\n  else\r\n  begin\r\n    range := document.createRange();\r\n    range.setStart(ElementHandle, 0);\r\n    range.setEnd(ElementHandle, 0);\r\n  end;\r\n\r\n  el := TJSHTMLElement(document.createElement('div'));\r\n  el.innerHTML := HTML;\r\n  frag := document.createDocumentFragment;\r\n  node := el.firstChild;\r\n  while (node = el.firstChild) do\r\n  begin\r\n    lastNode := frag.appendChild(node);\t\t\r\n    range.insertNode(frag);\r\n  end;\r\n\r\n  if Assigned(lastNode) then\r\n  begin\r\n    range := range.cloneRange();\r\n    range.setStartAfter(lastNode);\r\n    range.collapse;\r\n    if  Assigned(sel) then\r\n    begin\r\n      sel.removeAllRanges;\r\n      sel.addRange(range);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomRichEdit.HandleDoSelectionChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  if Assigned(Owner) then\r\n  begin\r\n    //reset to a color close to black to avoid being unable to\r\n    //select black as the new color\r\n    (Owner as TRichEditToolBar).TextColor := $000001;\r\n    (Owner as TRichEditToolBar).BackgroundColor := $000001;\r\n  end;\r\n\r\n  if Assigned(OnSelectionChange) then\r\n    OnSelectionChange(Self);\r\n  Result := True;\r\nend;\r\n\r\nfunction TCustomRichEdit.HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nbegin\r\n  Result := false;\r\n\r\n  //Handle Return Key\r\n  if (GetKeyCode(Event.Key) = 13) and InsertLineBreaks then\r\n    InsertHTML('<br>')\r\n  else\r\n  //Handle Tab Key\r\n  if (GetKeyCode(Event.Key) = 9) and WantTabs then\r\n    InsertHTML('<span style=white-space:pre>&#9;</span>')\r\n  else\r\n  begin   \r\n    Result := True;\r\n  end;\r\n\r\n  inherited;\r\nend;\r\n\r\n\r\n{ TTextAttributes }\r\n\r\nconstructor TTextAttributes.Create(AOwner: TCustomRichEdit);\r\nbegin\r\n  inherited Create;\r\n  RichEdit := AOwner;\r\n  FAlignment := taLeftJustify;\r\n  FIsBold := False;\r\n  FIsItalic := False;\r\n  FIsUnderline := False;\r\n  FIsStrikeOut := False;\r\n  FOrderedList := False;\r\n  FUnOrderedList := False;\r\nend;\r\n\r\nprocedure TTextAttributes.Cut;\r\nbegin\r\n  RichEdit.DoEditAction('cut');\r\nend;\r\n\r\nprocedure TTextAttributes.Copy;\r\nbegin\r\n  RichEdit.DoEditAction('copy');\r\nend;\r\n\r\nprocedure TTextAttributes.Paste;\r\nbegin\r\n  RichEdit.DoEditAction('paste');\r\nend;\r\n\r\nprocedure TTextAttributes.Image;\r\nbegin\r\n  RichEdit.DoImageAction;\r\nend;\r\n\r\nprocedure TTextAttributes.Link;\r\nbegin\r\n  RichEdit.DoLinkAction;\r\nend;\r\n\r\nprocedure TTextAttributes.SetAlignment(Value: TAlignment);\r\nbegin\r\n  FAlignment := Value;\r\n\r\n  case FAlignment of\r\n    taLeftJustify: RichEdit.DoEditAction('justifyleft');\r\n    taCenter: RichEdit.DoEditAction('justifycenter');\r\n    taRightJustify: RichEdit.DoEditAction('justifyright');\r\n  end;\r\nend;\r\n\r\nprocedure TTextAttributes.SetBackColor(Value: TColor);\r\nbegin\r\n  FColor := Value;\r\n  RichEdit.DoEditAction('hiliteColor', ColorToHtml(Value));\r\nend;\r\n\r\nprocedure TTextAttributes.SetColor(Value: TColor);\r\nbegin\r\n  FColor := Value;\r\n  RichEdit.DoEditAction('foreColor', ColorToHtml(Value));\r\nend;\r\n\r\nprocedure TTextAttributes.SetName(Value: string);\r\nbegin\r\n  FName := Value;\r\n  RichEdit.DoEditAction('fontName', Value);\r\nend;\r\n\r\nprocedure TTextAttributes.SetOrderedList(Value: Boolean);\r\nbegin\r\n  if (FOrderedLIst <> Value) then\r\n    RichEdit.DoEditAction('insertorderedlist');\r\n\r\n  FOrderedList := Value;\r\nend;\r\n\r\nprocedure TTextAttributes.SetUnOrderedList(Value: Boolean);\r\nbegin\r\n  if (FUnOrderedLIst <> Value) then\r\n    RichEdit.DoEditAction('insertunorderedlist');\r\n\r\n  FUnOrderedList := Value;\r\nend;\r\n\r\nprocedure TTextAttributes.SetStyle(Value: TFontStyles);\r\nbegin\r\n  FStyle := Value;\r\n\r\n  if (fsBold in FStyle) and (not FIsBold) then\r\n  begin\r\n    RichEdit.DoEditAction('bold');\r\n    FIsBold := True;\r\n  end;\r\n\r\n  if (not(fsBold in FStyle)) and (FIsBold) then\r\n  begin\r\n    RichEdit.DoEditAction('bold');\r\n    FIsBold := False;\r\n  end;\r\n  \r\n  if (fsItalic in FStyle) and (not FIsItalic) then\r\n  begin\r\n    RichEdit.DoEditAction('italic');\r\n    FIsItalic := True;\r\n  end;\r\n\r\n  if (not(fsItalic in FStyle)) and (FIsItalic) then\r\n  begin\r\n    RichEdit.DoEditAction('italic');\r\n    FIsItalic := False;\r\n  end;\r\n  \r\n  if (fsUnderline in FStyle) and (not FIsUnderline) then\r\n  begin\r\n    RichEdit.DoEditAction('underline');\r\n    FIsUnderline := True;\r\n  end;\r\n\r\n  if (not(fsUnderline in FStyle)) and (FIsUnderline) then\r\n  begin\r\n    RichEdit.DoEditAction('underline');\r\n    FIsUnderline := False;\r\n  end;\r\n\r\n  if (fsStrikeOut in FStyle) and (not FIsStrikeOut) then\r\n  begin\r\n    RichEdit.DoEditAction('strikethrough');\r\n    FIsStrikeOut := True;\r\n  end;\r\n\r\n  if (not(fsStrikeOut in FStyle)) and (FIsStrikeOut) then\r\n  begin\r\n    RichEdit.DoEditAction('strikethrough');\r\n    FIsStrikeOut := False;\r\n  end;\r\n\r\n//  RichEdit.UpdateElement;\r\nend;\r\n\r\nprocedure TTextAttributes.SetSize(Value: Integer);\r\nbegin\r\n  if (Value > 0) and (Value < 8) then\r\n  begin\r\n    FSize := Value;\r\n    FHeight := Value;\r\n    RichEdit.DoEditAction('fontSize', IntToStr(Value));\r\n  end;\r\nend;\r\n\r\nprocedure TTextAttributes.SetHeight(Value: Integer);\r\nbegin\r\n  if (Value > 0) and (Value < 8) then\r\n  begin\r\n    FSize := Value;\r\n    FHeight := Value;\r\n    RichEdit.DoEditAction('fontSize', IntToStr(Value));\r\n  end;\r\nend;\r\n\r\nprocedure TTextAttributes.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TFont then\r\n  begin\r\n    Color := TFont(Source).Color;\r\n    Name := TFont(Source).Name;\r\n    Style := TFont(Source).Style;\r\n    Size := TFont(Source).Size;\r\n  end\r\n  else if Source is TTextAttributes then\r\n  begin\r\n    Color := TTextAttributes(Source).Color;\r\n    Name := TTextAttributes(Source).Name;\r\n    Style := TTextAttributes(Source).Style;\r\n    Size := TTextAttributes(Source).Size;\r\n  end\r\n  else inherited Assign(Source);\r\nend;\r\n\r\nprocedure TTextAttributes.AssignTo(Dest: TPersistent);\r\nbegin\r\n  if Dest is TFont then\r\n  begin\r\n    TFont(Dest).Color := Color;\r\n    TFont(Dest).Name := Name;\r\n    TFont(Dest).Style := Style;\r\n    TFont(Dest).Size := Size;\r\n  end\r\n  else if Dest is TTextAttributes then\r\n  begin\r\n    TTextAttributes(Dest).Color := Color;\r\n    TTextAttributes(Dest).Name := Name;\r\n    TTextAttributes(Dest).Style := Style;\r\n  end\r\n  else inherited AssignTo(Dest);\r\nend;\r\n\r\n{ TTabSet }\r\n\r\nprocedure TTabSet.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.onchange := @HandleDoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TTabSet.Clear;\r\nbegin\r\n  Items.Clear;\r\nend;\r\n\r\nprocedure TTabSet.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItems := TStringList.Create;\r\n  FItems.OnChange := ItemsChanged;\r\n  FItemIndex := 0;\r\n  FSelectedColor := clSilver;\r\nend;\r\n\r\nfunction TTabSet.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\ndestructor TTabSet.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTabSet.SetItems(AItems: TStringList);\r\nbegin\r\n  FItems.Assign(AItems);\r\nend;\r\n\r\nfunction TTabSet.HandleDoChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\n  Result := True;\r\nend;\r\n\r\nprocedure TTabSet.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TTabSet.SelectNextTab(GoForward: boolean);\r\nbegin\r\n  if GoForward then\r\n  begin\r\n    if ItemIndex < Items.Count - 1 then\r\n      ItemIndex := ItemIndex + 1\r\n    else\r\n      ItemIndex := 0;\r\n  end\r\n  else\r\n  begin\r\n    if ItemIndex > 0 then\r\n      ItemIndex := ItemIndex - 1\r\n    else\r\n      ItemIndex := Items.Count - 1;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TTabSet.SetItemIndex(AIndex: integer);\r\nbegin\r\n  if FItemIndex <> AIndex then\r\n  begin\r\n    FItemIndex := AIndex;\r\n    DoUpdateList;\r\n  end;\r\nend;\r\n\r\nprocedure TTabSet.SetSelectedColor(const Value: TColor);\r\nbegin\r\n  if FSelectedColor <> Value then\r\n  begin\r\n    FSelectedColor := Value;\r\n    DoUpdateList;\r\n  end;\r\nend;\r\n\r\nprocedure TTabSet.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  s: string;\r\n  ul, li, a: TJSElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  while Assigned(Container.firstChild) do\r\n    Container.removeChild(Container.firstChild);\r\n\r\n  Container['class'] := '';\r\n\r\n  ul := document.createElement('UL');\r\n  ul['class'] := ElementClassName;\r\n\r\n  if ElementClassName <> '' then\r\n    ul['role'] := 'tablist'\r\n  else\r\n  begin\r\n    (TJSHTMLElement(ul)).style.setProperty('list-style-type', 'none');\r\n    (TJSHTMLElement(ul)).style.setProperty('margin', '0');\r\n    (TJSHTMLElement(ul)).style.setProperty('padding', '0');\r\n    (TJSHTMLElement(ul)).style.setProperty('display', 'inline-block');\r\n\r\n//    (TJSHTMLElement(ul)).onmouseout := @HandleDoItemMouseOut;\r\n//    (TJSHTMLElement(ul)).onmouseover := @HandleDoItemMouseOver;\r\n  end;\r\n\r\n  Container.appendChild(ul);\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    s := FItems[i];\r\n\r\n    li := document.createElement('LI');\r\n\r\n    if ElementClassName <> '' then\r\n      li['class'] := 'nav-item'\r\n    else\r\n    begin\r\n      (TJSHTMLElement(li)).style.setProperty('float', 'left');\r\n      (TJSHTMLElement(li)).style.setProperty('border-bottom', '1px solid lightgray');\r\n    end;\r\n\r\n    SetHTMLElementFont(TJSHTMLElement(li), Font, not ((ElementClassName = '') and (ElementFont = efProperty)));\r\n\r\n    ul.appendChild(li);\r\n\r\n    if not Enabled then\r\n      a := document.createElement('SPAN')\r\n    else\r\n    begin\r\n      a := document.createElement('A');\r\n      a['href'] := '#' + s;\r\n    end;\r\n\r\n    a.innerHTML := s;\r\n    a['id'] := GetID + '_' + IntToStr(i);\r\n\r\n    if ElementClassName <> '' then\r\n    begin\r\n\r\n      if ItemIndex = i then\r\n        a['class'] := 'nav-link active'\r\n      else\r\n        a['class'] := 'nav-link';\r\n      a['role'] := 'tab';\r\n\r\n      a['data-toggle'] := 'tab';\r\n      a['aria-controls'] := s;\r\n\r\n      if ItemIndex = i then \r\n        a['aria-selected'] := 'true'\r\n      else\r\n        a['aria-selected'] := 'false';\r\n    end\r\n    else\r\n    begin\r\n      (TJSHTMLElement(a)).style.setProperty('display', 'block');          \r\n      (TJSHTMLElement(a)).style.setProperty('text-align', 'center');          \r\n      (TJSHTMLElement(a)).style.setProperty('padding', '3px 15px');          \r\n      (TJSHTMLElement(a)).style.setProperty('text-decoration', 'none');    \r\n      (TJSHTMLElement(a)).style.setProperty('min-width', '50px'); \r\n      \r\n      (TJSHTMLElement(a)).style.setProperty('color', 'inherit');\r\n      (TJSHTMLElement(a)).style.setProperty('font-family', 'inherit');\r\n      (TJSHTMLElement(a)).style.setProperty('font-style', 'inherit');\r\n      (TJSHTMLElement(a)).style.setProperty('font-size', 'inherit');\r\n\r\n      if not enabled then\r\n        (TJSHTMLElement(a)).style.setProperty('pointer-events', 'none'); \r\n\r\n      if ItemIndex = i then \r\n        (TJSHTMLElement(a)).style.setProperty('background-color', ColorToHtml(SelectedColor));\r\n    end;\r\n\r\n    li.appendChild(a);\r\n  end;\r\n\r\n  if (csDesigning in ComponentState) then\r\n    RenderDesigning('TWebTabSet', Container, Self, (FItems.Count = 0));\r\n\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TTabSet.EndUpdate;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nfunction TTabSet.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  sid: string;\r\n  i: integer;\r\nbegin\r\n  sid := event.target['id'];\r\n\r\n  if sid <> '' then\r\n  begin\r\n    sid := StringReplace(sid, GetID + '_', '', []);    \r\n    if TryStrToInt(sid,i) then\r\n    begin\r\n      FItemIndex := i;\r\n      DoUpdateList;\r\n    end;\r\n    inherited;\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TTabSet.HandleDoItemMouseOut(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  Result := true;\r\n  //Event.stopPropagation;\r\n\r\n  el := TJSHTMLElement(Event.relatedTarget);\r\n  if Assigned(el) then\r\n  begin\r\n    if el.nodeName = 'A' then\r\n      el.style.setProperty('background-color', '');\r\n  end\r\nend;\r\n\r\nfunction TTabSet.HandleDoItemMouseOver(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  Result := true;\r\n  //Event.stopPropagation;\r\n\r\n  el := TJSHTMLElement(Event.relatedTarget);\r\n  if Assigned(el) then\r\n  begin\r\n    if el.nodeName = 'A' then\r\n      el.style.setProperty('background-color', 'lightgray');\r\n  end\r\nend;\r\n\r\n\r\nprocedure TTabSet.ItemsChanged(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\n{ TPageControl }\r\n\r\n\r\nprocedure TPageControl.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    //The ElementHandle doesn't have an onchange event\r\n    //so the onclick is used instead.\r\n    //HandleDoChange checks if a different tab is clicked\r\n    ElementHandle.onclick := @HandleDoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TPageControl.Clear;\r\nbegin\r\n  Items.Clear;\r\nend;\r\n\r\nprocedure TPageControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  FItems := TStringList.Create;\r\n  FItems.OnChange := ItemsChanged;\r\n  FTabIndex := 0;\r\n  FPrevTabIndex := FTabIndex;\r\n  TabStop := false;\r\n  FSelectedColor := clSilver;\r\n  Width := 400;\r\n  Height := 300;\r\n  EnablePropagation := true;\r\nend;\r\n\r\nfunction TPageControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\ndestructor TPageControl.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TPageControl.SelectNextPage(GoForward: boolean);\r\nbegin\r\n  if GoForward then\r\n  begin\r\n    if TabIndex < PageCount - 1 then\r\n      TabIndex := TabIndex + 1\r\n    else\r\n      TabIndex := 0;\r\n  end\r\n  else\r\n  begin\r\n    if TabIndex > 0 then\r\n      TabIndex := TabIndex - 1\r\n    else\r\n      TabIndex := PageCount - 1;\r\n  end;\r\nend;\r\n\r\nfunction TPageControl.PageCount: integer;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := 0;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if (Controls[i] is TTabSheet) then\r\n      inc(Result);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TPageControl.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if (Controls[i] is TTabSheet) then\r\n    begin\r\n      Proc(Controls[i]);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TPageControl.GetPage(index: integer): TTabSheet;\r\nvar\r\n  c,i: integer;\r\nbegin\r\n  c := -1;\r\n  Result := nil;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if (Controls[i] is TTabSheet) then\r\n      inc(c);\r\n\r\n     if c = index then\r\n     begin\r\n       Result := Controls[i] as TTabSheet;\r\n       break;\r\n     end;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TPageControl.SetItems(AItems: TStringList);\r\nbegin\r\n  FItems.Assign(AItems);\r\nend;\r\n\r\nfunction TPageControl.HandleDoChange(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if FPrevTabIndex <> FTabIndex then\r\n  begin\r\n    FPrevTabIndex := FTabIndex;\r\n    if Assigned(OnChange) then\r\n      OnChange(Self);\r\n  end;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TPageControl.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TPageControl.SetTabIndex(AIndex: integer);\r\nbegin\r\n  if (FTabIndex <> AIndex) and (AIndex >= 0) then\r\n  begin\r\n    FTabIndex := AIndex;\r\n    FPrevTabIndex := FTabIndex;\r\n    DoUpdateList;\r\n  end;\r\nend;\r\n\r\nprocedure TPageControl.SetSelectedColor(const AValue: TColor);\r\nbegin\r\n  if FSelectedColor <> AValue then\r\n  begin\r\n    FSelectedColor := AValue;\r\n    DoUpdateList;\r\n  end;\r\nend;\r\n\r\nprocedure TPageControl.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  s: string;\r\n  shidden: string;\r\n  n: TJSNode;\r\n  ul, li, a: TJSElement;\r\n  tabs: TStringList;\r\n  tab: TTabSheet;\r\n\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if not Assigned(ElementHandle) or IsUpdating then\r\n    Exit;\r\n\r\n  if ControlCount > 0 then\r\n  begin\r\n\r\n    tabs := TStringList.Create;\r\n\r\n    shidden := '{#hidden#}';\r\n\r\n    for i := 0 to ControlCount - 1 do\r\n    begin\r\n      if Controls[i] is TTabSheet then\r\n      begin\r\n        tab := TTabSheet(Controls[i]);\r\n        if tab.TabVisible then\r\n          tabs.Add(tab.FTabCaption)\r\n        else\r\n          tabs.Add(shidden);\r\n        tab.Align := alClient;\r\n        tab.AlignWithMargins := True;\r\n        tab.Margins.Left := 0;\r\n        tab.BorderStyle := bsSingle;\r\n        tab.Visible := (TabIndex = i);\r\n        if (TabIndex = i) then\r\n          tab.BringToFront\r\n        else\r\n          tab.SendToBack;\r\n\r\n        tab.GetElementHandle.style.setProperty('background-color', ColorToHtml(tab.Color));\r\n      end;\r\n    end;\r\n\r\n    for i := 0 to Container.childNodes.length - 1 do\r\n    begin\r\n      n := Container.childNodes[i];\r\n      if Assigned(n) and (TJSElement(n)['id'] = GetID + '_UL') then\r\n        Container.removeChild(n);\r\n    end;\r\n\r\n    Container['class'] := '';\r\n\r\n    if not Enabled then\r\n      ElementHandle.style.setProperty('pointer-events', 'none')\r\n    else\r\n      ElementHandle.style.setProperty('pointer-events', 'auto');\r\n\r\n    ul := document.createElement('UL');\r\n    ul['class'] := ElementClassName;\r\n    ul['id'] := GetID + '_UL';\r\n\r\n    if ElementClassName <> '' then\r\n      ul['role'] := 'tablist'\r\n    else\r\n    begin\r\n      (TJSHTMLElement(ul)).style.setProperty('list-style-type', 'none');\r\n      (TJSHTMLElement(ul)).style.setProperty('margin', '0');\r\n      (TJSHTMLElement(ul)).style.setProperty('padding', '0');\r\n      (TJSHTMLElement(ul)).style.setProperty('display', 'inline-block');\r\n    end;\r\n\r\n    Container.appendChild(ul);\r\n\r\n    for i := 0 to tabs.Count - 1 do\r\n    begin\r\n      s := tabs[i];\r\n      if s <> shidden then\r\n      begin\r\n        if s = '' then\r\n          s := 'tab' + IntToStr(i);\r\n\r\n        li := document.createElement('LI');\r\n\r\n        if ElementClassName <> '' then\r\n          li['class'] := 'nav-item'\r\n        else\r\n        begin\r\n          (TJSHTMLElement(li)).style.setProperty('float', 'left');\r\n          if BorderStyle <> bsNone then\r\n            (TJSHTMLElement(li)).style.setProperty('border-bottom', '1px solid lightgray');\r\n        end;\r\n\r\n        SetHTMLElementFont(TJSHTMLElement(li), Font, not ((ElementClassName = '') and (ElementFont = efProperty)));\r\n\r\n        ul.appendChild(li);\r\n\r\n        if not Enabled then\r\n          a := document.createElement('SPAN')\r\n        else\r\n        begin\r\n          a := document.createElement('A');\r\n          a['href'] := '#' + s;\r\n        end;\r\n\r\n        a.innerHTML := s;\r\n        a['id'] := GetID + '_' + IntToStr(i);\r\n\r\n        if ElementClassName <> '' then\r\n        begin\r\n          if TabIndex = i then\r\n            a['class'] := 'nav-link active'\r\n          else\r\n            a['class'] := 'nav-link';\r\n          a['role'] := 'tab';\r\n\r\n          a['data-toggle'] := 'tab';\r\n          a['aria-controls'] := s;\r\n\r\n          if TabIndex = i then\r\n            a['aria-selected'] := 'true'\r\n          else\r\n            a['aria-selected'] := 'false';\r\n        end\r\n        else\r\n        begin\r\n          (TJSHTMLElement(a)).style.setProperty('display', 'block');\r\n          (TJSHTMLElement(a)).style.setProperty('text-align', 'center');\r\n          (TJSHTMLElement(a)).style.setProperty('padding', '3px 15px');\r\n          (TJSHTMLElement(a)).style.setProperty('text-decoration', 'none');\r\n          (TJSHTMLElement(a)).style.setProperty('min-width', '50px');\r\n\r\n          (TJSHTMLElement(a)).style.setProperty('color', 'inherit');\r\n          (TJSHTMLElement(a)).style.setProperty('font-family', 'inherit');\r\n          (TJSHTMLElement(a)).style.setProperty('font-style', 'inherit');\r\n          (TJSHTMLElement(a)).style.setProperty('font-size', 'inherit');\r\n\r\n          if not enabled then\r\n            (TJSHTMLElement(a)).style.setProperty('pointer-events', 'none');\r\n\r\n          if TabIndex = i then\r\n            (TJSHTMLElement(a)).style.setProperty('background-color', ColorToHtml(SelectedColor));\r\n        end;\r\n\r\n        li.appendChild(a);\r\n      end;\r\n    end;\r\n\r\n    for i := 0 to ControlCount - 1 do\r\n    begin\r\n      if Controls[i] is TTabSheet then\r\n      begin\r\n        TTabSheet(Controls[i]).Margins.Top := Round((TJSHTMLElement(ul)).offsetHeight) - 1;\r\n        TTabSheet(Controls[i]).ElementHandle.style.setProperty('white-space', '');\r\n        TTabSheet(Controls[i]).BorderStyle := BorderStyle;\r\n      end;\r\n    end;\r\n\r\n    tabs.Free;\r\n  end\r\n  else\r\n  begin\r\n    if (csDesigning in ComponentState) then\r\n      RenderDesigning('TWebPageControl', Container, Self, True);\r\n  end;\r\n\r\n  DoUpdateResize;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TPageControl.DoUpdateResize;\r\nvar\r\n  i: integer;\r\nbegin\r\n  // hide all\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if Controls[i] is TTabSheet then\r\n       Controls[i].Visible := false;\r\n  end;\r\n\r\n  // cause client alignment for all\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if Controls[i] is TTabSheet then\r\n    begin\r\n      Controls[i].Visible := true;\r\n      Controls[i].Align := alNone;\r\n      Controls[i].Align := alClient;\r\n      Controls[i].Visible := false;\r\n    end;\r\n  end;\r\n\r\n  // make active tab visible\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    if Controls[i] is TTabSheet then\r\n    begin\r\n      Controls[i].Visible := (TabIndex = i);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TPageControl.EndUpdate;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nfunction TPageControl.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  sid: string;\r\n  i: integer;\r\nbegin\r\n  sid := Event.target['id'];\r\n\r\n  if sid <> '' then\r\n  begin\r\n    sid := StringReplace(sid, GetID + '_', '', []);    \r\n    if TryStrToInt(sid,i) then\r\n    begin\r\n      FTabIndex := i;\r\n      DoUpdateList;\r\n    end;\r\n    inherited;\r\n  end;\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TPageControl.HandleDoItemMouseOut(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  Result := true;\r\n  //Event.stopPropagation;\r\n\r\n  el := TJSHTMLElement(Event.relatedTarget);\r\n  if Assigned(el) then\r\n  begin\r\n    if el.nodeName = 'A' then\r\n      el.style.setProperty('background-color', '');\r\n  end\r\nend;\r\n\r\nfunction TPageControl.HandleDoItemMouseOver(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  Result := true;\r\n  //Event.stopPropagation;\r\n\r\n  el := TJSHTMLElement(Event.relatedTarget);\r\n  if Assigned(el) then\r\n  begin\r\n    if el.nodeName = 'A' then\r\n      el.style.setProperty('background-color', 'lightgray');\r\n  end\r\nend;\r\n\r\nprocedure TPageControl.ItemsChanged(Sender: TObject);\r\nvar\r\n  i: integer;\r\n  ts: TTabSheet;\r\n\r\nbegin\r\n  if (PageCount = 0) and (Items.Count > 0) and (ElementHandle.childElementCount > 0) then\r\n  begin\r\n    ElementHandle.removeChild(ElementHandle.firstChild);\r\n  end;\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    if PageCount <= i then\r\n    begin\r\n      ts := TTabSheet.Create(Owner);\r\n      ts.Parent := Self;\r\n      ts.Name := Name + 'sheet' + inttostr(i + 1);\r\n    end;\r\n    Pages[i].Caption := FItems[i];\r\n  end;\r\n\r\n  for i := PageCount - 1  downto 0 do\r\n  begin\r\n    if i >= Items.Count then\r\n    begin\r\n      ts := Pages[i];\r\n      ts.Free;\r\n    end;\r\n  end;\r\n\r\n  DoUpdateList;\r\nend;\r\n\r\n{ TTabSheet }\r\n\r\nprocedure TTabSheet.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  EnablePropagation := true;\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  Color := clWhite;\r\n  TabVisible := True;\r\n  ShowCaption := False;\r\nend;\r\n\r\nprocedure TTabSheet.SetCaption(const AValue: string);\r\nbegin\r\n  if (FTabCaption <> AValue) then\r\n  begin\r\n    FTabCaption := AValue;\r\n    if Assigned(Parent) then\r\n    begin\r\n      if Parent is TPageControl then\r\n        (Parent as TPageControl).DoUpdateList;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTabSheet.SetTabVisible(const Value: Boolean);\r\nbegin\r\n  if FTabVisible <> Value then\r\n  begin\r\n    FTabVisible := Value;\r\n\r\n    if Assigned(Parent) then\r\n    begin\r\n      if Parent is TPageControl then\r\n        (Parent as TPageControl).DoUpdateList;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TProgressBar }\r\n\r\nprocedure TProgressBar.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FMax := 100;\r\n  FMin := 0;\r\n  FPosition := 0;\r\n  FStyle := pbstNormal;\r\nend;\r\n\r\nprocedure TProgressBar.CreateProgressElement(AElement: TJSElement);\r\nvar\r\n  d: TJSElement;\r\nbegin\r\n  while Assigned(AElement.firstChild) do\r\n    AElement.removeChild(AElement.firstChild);\r\n\r\n  if FStyle = pbstDiv then\r\n  begin\r\n    d := document.createElement('DIV');\r\n    d.appendChild(document.createElement('DIV'));\r\n  end\r\n  else\r\n    d := document.createElement('PROGRESS');\r\n\r\n  AElement.appendChild(d);\r\nend;\r\n\r\nprocedure TProgressBar.AfterLoadDFMValues;\r\nbegin\r\n  inherited;\r\n  DoUpdate;\r\nend;\r\n\r\nfunction TProgressBar.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n  CreateProgressElement(Result);\r\nend;\r\n\r\nprocedure TProgressBar.SetElementBarClassName(const Value: string);\r\nbegin\r\n  FElementBarClassName := Value;\r\n  DoUpdate;\r\nend;\r\n\r\nprocedure TProgressBar.SetMax(AValue: integer);\r\nbegin\r\n  FMax := AValue;\r\n  DoUpdate;\r\nend;\r\n\r\nprocedure TProgressBar.SetMin(AValue: integer);\r\nbegin\r\n  FMin := AValue;\r\n  DoUpdate;\r\nend;\r\n\r\nprocedure TProgressBar.DoUpdate;\r\nvar\r\n  pvalue: integer;\r\n  maxvalue: integer;\r\n  el: TJSHTMLElement;\r\n  pos: integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if FMax <> FMin then\r\n    pos := Round((FPosition - Min) / (Max - Min) * 100)\r\n  else\r\n    pos := 0;\r\n\r\n  //\r\n  if isLinked then\r\n  begin\r\n    if ElementHandle.TagName= 'DIV' then\r\n    begin\r\n      if ElementHandle['role'] = 'progressbar' then\r\n        ElementHandle.style.setProperty('width',inttostr(pos)+'%')\r\n      else\r\n        ElementHandle.innerHTML := inttostr(pos)\r\n    end\r\n    else\r\n      ElementHandle.setAttribute('value',inttostr(pos));\r\n\r\n    Exit;\r\n  end;\r\n\r\n\r\n  if Style = pbstDiv then\r\n  begin\r\n\r\n    el := TJSHTMLElement(ElementHandle.firstChild);\r\n\r\n    if ElementClassName <> '' then\r\n    begin\r\n      el.setAttribute('class',ElementClassName);\r\n      ElementHandle.removeAttribute('class');\r\n    end;\r\n\r\n    el.style.setProperty('height',inttostr(Height)+'px');\r\n\r\n    if WidthStyle = ssAbsolute then\r\n      el.style.setProperty('width',inttostr(Width)+'px');\r\n\r\n    el := TJSHTMLElement(el.firstChild);\r\n\r\n    if ElementBarClassName <> '' then\r\n      el.setAttribute('class',ElementBarClassName);\r\n\r\n    el.setAttribute('role','progressbar');\r\n    el.style.setProperty('width',inttostr(pos)+'%');\r\n\r\n    case Value of\r\n    pbvPercentage: el.innerHTML := inttostr(pos)+'%';\r\n    pbvAbsolute: el.innerHTML := inttostr(Position);\r\n    pbvNone: el.innerHTML := '';\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    el := TJSHTMLElement(ElementHandle.firstChild);\r\n    el.style.setProperty('width','100%');\r\n    el.style.setProperty('height','100%');\r\n    pvalue := FPosition - FMin;\r\n    maxvalue := FMax - FMin;\r\n    el['max'] := IntToStr(maxvalue);\r\n\r\n    if Style = pbstNormal then\r\n      el['value'] := IntToStr(pvalue)\r\n    else\r\n      el.removeAttribute('value');\r\n  end;\r\nend;\r\n\r\nprocedure TProgressBar.SetPosition(AValue: integer);\r\nbegin\r\n  if (FPosition >= Min) and (FPosition <= Max) then\r\n  begin\r\n    FPosition := AValue;\r\n    DoUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TProgressBar.SetStyle(const Value: TProgressBarStyle);\r\nbegin\r\n  if FStyle <> Value then\r\n  begin\r\n    FStyle := Value;\r\n\r\n    if Assigned(ElementHandle) then\r\n    begin\r\n      CreateProgressElement(ElementHandle);\r\n      DoUpdate;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TProgressBar.SetValue(const Value: TProgressBarValue);\r\nbegin\r\n  FValue := Value;\r\n  DoUpdate;\r\nend;\r\n\r\n{ TWebTreeView }\r\n\r\nprocedure TTreeView.BeginUpdate;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nfunction TTreeView.CreateElement: TJSElement;\r\nvar\r\n  tn: TTreeNode;\r\nbegin\r\n  if (csDesigning in ComponentState) then\r\n  begin\r\n    BeginUpdate;\r\n\r\n    tn := Items.Add('<font color=\"#E5413C\" style=\"font-size:10pt\">&#x25FC;</font> Item 1');\r\n    Items.AddChild(tn,'Child Item 1');\r\n\r\n    tn := Items.Add('<font color=\"#F39527\" style=\"font-size:10pt\">&#x25FC;</font> Item 2');\r\n    Items.AddChild(tn,'Child Item 2');\r\n\r\n    tn := Items.Add('<font color=\"#BDC6CB\" style=\"font-size:10pt\">&#x25FC;</font> Item 3');\r\n    Items.AddChild(tn,'Child Item 3');\r\n\r\n    EndUpdate;\r\n  end;\r\n\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure TTreeView.CreateInitialize;\r\nvar\r\n  css: string;\r\nbegin\r\n  inherited;\r\n  FSelected := nil;\r\n  FItems := TTreeNodes.Create(Self);\r\n  FItems.OnChange := DoNodesChanged;\r\n  FItems.OnExpandedChange := DOExpandedChanged;\r\n\r\n  // remove default bullets\r\n  css := '.TVUL {' +\r\n    ' list-style-type: none;' +\r\n    ' margin: 0;' +\r\n    ' padding-left: 15px;' +\r\n    '}' + #13#10 +\r\n\r\n    ' .TVCARET {' +\r\n    '  cursor: pointer;' +\r\n    '  user-select: none;' +\r\n    '}' + #13#10 +\r\n\r\n    '.TVCARET::before {' +\r\n    'content: \"\\25B6\";' +\r\n    'color: black;' +\r\n    'display: inline-block;' +\r\n    'margin-right: 6px;' +\r\n    '}' + #13#10 +\r\n\r\n    '.TVCARET-DOWN::before {'+\r\n    'transform: rotate(90deg);'+\r\n    '}'+ #13#10 +\r\n\r\n    '.TVNESTED {' +\r\n    '  display: none;' +\r\n    '}' + #13#10 +\r\n\r\n    '.TVACTIVE {' +\r\n    '  display: block;' +\r\n    '}' + #13#10 +\r\n\r\n    '.TVNODE {' +\r\n    ' padding: 3px;'+\r\n    ' display: inline-block;' +\r\n    '}' + #13#10 +\r\n\r\n    '.TVNOCURSOR {' +\r\n    ' cursor: initial;'+\r\n    '}' + #13#10 +\r\n\r\n    '.TVSELECTED {' +\r\n    '  background-color: #0000ff;' +\r\n    '  color: #ffffff;' +\r\n    '}';\r\n\r\n  AddControlStyle(css);\r\n\r\n  Width := 200;\r\n  Height := 200;\r\nend;\r\n\r\ndestructor TTreeView.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTreeView.DoChangeSelection(NewNode: TTreeNode);\r\nvar\r\n  Allow: boolean;\r\nbegin\r\n  Allow := true;\r\n\r\n  if Assigned(OnChanging) then\r\n    OnChanging(Self, NewNode, Allow);\r\n\r\n  if Allow then\r\n  begin\r\n    Selected := NewNode;\r\n    if Assigned(OnChange) then\r\n      OnChange(Self, NewNode);\r\n  end;\r\nend;\r\n\r\nprocedure TTreeView.DoExpandedChanged(Sender: TObject; ANode: TTreeNode);\r\nvar\r\n  el, su: TJSElement;\r\nbegin\r\n  if ANode.Count > 0 then\r\n  begin\r\n    el := GetNodeElement(ANode);\r\n\r\n    if Assigned(el) and Assigned(el.parentElement) and Assigned(el.parentElement.parentElement) then\r\n    begin\r\n      su := el.parentElement.parentElement.querySelector('.TVNESTED');\r\n      if Assigned(su) then\r\n      begin\r\n        su.classList.toggle('TVACTIVE');\r\n        el.parentElement.classList.toggle('TVCARET-DOWN');\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTreeView.DoNodesChanged(Sender: TObject);\r\nbegin\r\n  //\r\nend;\r\n\r\nprocedure TTreeView.DoRenderNode(ANode: TTreeNode; AElement: TJSHTMLElement);\r\nbegin\r\n  if Assigned(OnRenderNode) then\r\n    OnRenderNode(Self, ANode, AElement);\r\nend;\r\n\r\nprocedure TTreeView.EndUpdate;\r\nbegin\r\n  inherited;\r\n  Selected := nil;\r\n  RenderNodes;\r\nend;\r\n\r\nfunction TTreeView.GetNodeElement(ANode: TTreeNode): TJSHTMLElement;\r\nvar\r\n  s: string;\r\n  tn: TTreeNode;\r\nbegin\r\n  Result := nil;\r\n  tn := ANode;\r\n\r\n  if not Assigned(tn) then\r\n    Exit;\r\n\r\n  s := '';\r\n\r\n  // generate HTML element ID\r\n  repeat\r\n    if s = '' then\r\n      s := IntToStr(tn.Index)\r\n    else\r\n      s := IntTostr(tn.Index) + '_' + s;\r\n\r\n    tn := tn.Parent;\r\n\r\n//  until (tn = nil);\r\n  until (not Assigned(tn));\r\n\r\n  s := Name + '_' + s;\r\n\r\n  Result := TJSHTMLElement(document.getElementById(s));\r\n\r\n  if Assigned(Result) then\r\n  begin\r\n    if Result.classlist.contains('TVCARET') then\r\n      Result := TJSHTMLElement(Result.firstChild);\r\n  end;\r\nend;\r\n\r\nfunction TTreeView.GetNodeFromID(AId: string): TTreeNode;\r\nvar\r\n  s: string;\r\n  sl: TStringList;\r\n  n: TTreeNode;\r\n  i,j,e: integer;\r\n\r\nbegin\r\n  Result := nil;\r\n\r\n  s := AID;\r\n  s := Copy(s, Length(Name) + 2, Length(s));\r\n\r\n  if (s <> '') then\r\n  begin\r\n    sl := TStringList.Create;\r\n    sl.Delimiter := '_';\r\n    sl.StrictDelimiter := true;\r\n    sl.DelimitedText := s;\r\n\r\n    n := nil;\r\n    for i := 0 to sl.Count - 1 do\r\n    begin\r\n      val(sl.Strings[i], j, e);\r\n\r\n      if (i = 0) then\r\n        n  := Items[j]\r\n      else\r\n        n := n.Item[j];\r\n    end;\r\n    sl.Free;\r\n\r\n    Result := n;\r\n  end;\r\nend;\r\n\r\nfunction TTreeView.GetSelected: TTreeNode;\r\nbegin\r\n  Result := FSelected;\r\nend;\r\n\r\nfunction TTreeView.HandleClick(Event: TJSEvent): Boolean;\r\nvar\r\n  n: TTreeNode;\r\n  el: TJSHTMLElement;\r\nbegin\r\n  Result := true;\r\n  asm\r\n    el = Event.srcElement;\r\n  end;\r\n\r\n  if Assigned(el) then\r\n  begin\r\n    if el.hasAttribute('id') then\r\n    begin\r\n      n := GetNodeFromID(el['id']);\r\n\r\n      if Assigned(OnClick) then\r\n        OnClick(Self);\r\n\r\n      if Assigned(n) then\r\n      begin\r\n        DoChangeSelection(n);\r\n\r\n        if Assigned(OnClickNode) then\r\n          OnClickNode(Self, n);\r\n      end;\r\n    end;\r\n\r\n  end;\r\nend;\r\n\r\nfunction TTreeView.HandleDblClick(Event: TJSEvent): Boolean;\r\nvar\r\n  n: TTreeNode;\r\n  el: TJSElement;\r\nbegin\r\n  Result := true;\r\n\r\n  asm\r\n    el = Event.srcElement;\r\n  end;\r\n\r\n  if Assigned(el) then\r\n  begin\r\n    if not el.hasAttribute('id') then\r\n      el := el.parentElement;\r\n\r\n    if el.hasAttribute('id') then\r\n    begin\r\n      n := GetNodeFromID(el['id']);\r\n\r\n      if Assigned(OnDblClick) then\r\n        OnDblClick(Self);\r\n\r\n      if Assigned(n) and Assigned(OnDblClickNode) then\r\n        OnDblClickNode(Self, n);\r\n\r\n      // toggle expanded state on dbl click\r\n      n.Expanded := not n.Expanded;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTreeView.HandleNode(Event: TJSEvent): Boolean;\r\nvar\r\n  el: TJSElement;\r\n  n: TTreeNode;\r\n  Allow: boolean;\r\nbegin\r\n  asm\r\n    el = Event.srcElement;\r\n  end;\r\n\r\n  if Assigned(el) and (el.hasAttribute('id')) then\r\n  begin\r\n    n := GetNodeFromID(el['id']);\r\n\r\n    Allow := true;\r\n\r\n    if n.Expanded then\r\n    begin\r\n      if Assigned(OnCollapsing) then\r\n        OnCollapsing(Self, n, Allow);\r\n    end\r\n    else\r\n    begin\r\n      if Assigned(OnExpanding) then\r\n        OnExpanding(Self, n, Allow);\r\n    end;\r\n\r\n    if Allow then\r\n    begin\r\n      n.Expanded := not n.Expanded;\r\n\r\n      if n.Expanded then\r\n      begin\r\n        if Assigned(OnExpanded) then\r\n          OnExpanded(Self, n);\r\n      end\r\n      else\r\n      begin\r\n        if Assigned(OnCollapsed) then\r\n          OnCollapsed(Self, n);\r\n      end;\r\n    end;\r\n\r\n    DoChangeSelection(n);\r\n\r\n    if Assigned(OnClickNode) then\r\n      OnClickNode(Self, n);\r\n\r\n    Result := true;\r\n    Event.preventDefault;\r\n  end\r\n  else\r\n  begin\r\n    if Assigned(el) then\r\n    begin\r\n      el := el.parentElement;\r\n      if el.hasAttribute('id') then\r\n      begin\r\n        n := GetNodeFromID(el['id']);\r\n        DoChangeSelection(n);\r\n\r\n        if Assigned(OnClickNode) then\r\n          OnClickNode(Self, n);\r\n\r\n        Result := true;\r\n        Event.preventDefault;\r\n      end;\r\n    end;\r\n\r\n  end;\r\n\r\n\r\n\r\nend;\r\n\r\nprocedure TTreeView.KeyDown(var Key: Word; Shift: TShiftState);\r\nvar\r\n  tn,sn,ln: TTreeNode;\r\nbegin\r\n  tn := Selected;\r\n\r\n  if (Key = VK_HOME) then\r\n  begin\r\n    if Assigned(Items[0]) then\r\n      DoChangeSelection(Items[0]);\r\n  end;\r\n\r\n  if (Key = VK_END) and (Items.Count > 0) then\r\n  begin\r\n    tn := Items[Items.Count - 1];\r\n\r\n    while tn.Expanded do\r\n    begin\r\n      if tn.Count > 0 then\r\n        tn := tn.Item[tn.Count -1];\r\n    end;\r\n\r\n    DoChangeSelection(tn);\r\n  end;\r\n\r\n  if (Key = VK_DOWN) then\r\n  begin\r\n    if Assigned(tn) then\r\n    begin\r\n      if tn.Expanded and (tn.Count > 0) then\r\n      begin\r\n        tn := tn.GetFirstChild;\r\n      end\r\n      else\r\n        tn := tn.GetNextSibling;\r\n\r\n      if not Assigned(tn) then\r\n      begin\r\n        tn := Selected;\r\n        sn := tn;\r\n\r\n        while not Assigned(sn.GetNextSibling) and Assigned(sn.Parent) do\r\n        begin\r\n          sn := sn.Parent;\r\n          if Assigned(sn) then\r\n            ln := sn.GetNextSibling;\r\n\r\n          if Assigned(ln) then\r\n          begin\r\n            tn := ln;\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      if Assigned(tn) then\r\n        DoChangeSelection(tn);\r\n    end;\r\n  end;\r\n\r\n  if (Key = VK_UP) then\r\n  begin\r\n    if Assigned(tn) then\r\n    begin\r\n      tn := tn.GetPrevSibling;\r\n      if Assigned(tn) then\r\n      begin\r\n        sn := tn;\r\n        while Assigned(sn) and sn.Expanded and (sn.Count > 0) do\r\n        begin\r\n          sn := sn.Item[tn.Count - 1];\r\n          if Assigned(sn) then\r\n            tn := sn;\r\n        end;\r\n\r\n        DoChangeSelection(tn);\r\n      end\r\n      else\r\n      begin\r\n        tn := Selected.Parent;\r\n        if Assigned(tn) then\r\n          DoChangeSelection(tn);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if (Key = VK_RIGHT) then\r\n  begin\r\n    if Assigned(tn) then\r\n      Selected.Expanded := true;\r\n  end;\r\n\r\n  if (Key = VK_LEFT) then\r\n  begin\r\n    if Assigned(tn) then\r\n      Selected.Expanded := false;\r\n  end;\r\n\r\n  if (Key in [VK_LEFT, VK_RIGHT, VK_DOWN, VK_UP]) then\r\n  begin\r\n    Key := 0;\r\n    Exit;\r\n  end;\r\n\r\n\r\n  inherited;\r\nend;\r\n\r\nfunction TTreeView.RenderNode(ANode: TTreeNode; AElementName: string): TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(document.createElement('SPAN'));\r\n  if AElementName <> '' then\r\n    Result.setAttribute('id',AElementName);\r\n\r\n  Result.innerHTML := ANode.Text;\r\n  Result.classlist.add('TVNODE');\r\n\r\n  if ElementNodeClassName <> '' then\r\n    Result.classlist.add(ElementNodeClassName);\r\n\r\n  if Assigned(Selected) then\r\n  begin\r\n    if Selected = ANode then\r\n    begin\r\n      Result.classlist.add('TVSELECTED');\r\n      if ElementNodeSelectedClassName <> '' then\r\n        Result.classlist.add(ElementNodeSelectedClassName);\r\n    end;\r\n  end;\r\n\r\n//  if not Assigned(OnClickNode) and not Assigned(OnDblClickNode) then\r\n//    Result.style.setProperty('pointer-events','none');\r\n\r\n  if ANode.Hint <> '' then\r\n    Result.setAttribute('title', ANode.Hint);\r\nend;\r\n\r\nprocedure TTreeView.RenderNodes;\r\n\r\n  procedure RenderChildNode(LinkElement: TJSHTMLElement; ANode: TTreeNode; AElementName: string);\r\n  var\r\n    sp,nd: TJSHTMLElement;\r\n  begin\r\n    sp := TJSHTMLElement(document.createElement('SPAN'));\r\n    if AElementName <> '' then\r\n      sp.setAttribute('id', AElementName);\r\n\r\n    sp.addEventListener('click',@HandleNode);\r\n    sp.addEventListener('dblclick',@HandleDblClick);\r\n\r\n    nd := TJSHTMLElement(document.createElement('SPAN'));\r\n\r\n    if AutoExpand then\r\n      nd.style.setProperty('pointer-events', 'none');\r\n\r\n    nd.innerHTML := ANode.Text;\r\n    nd.classlist.add('TVNODE');\r\n\r\n    if ElementNodeClassName <> '' then\r\n      nd.classlist.add(ElementNodeClassName);\r\n\r\n\r\n    if not AutoExpand then\r\n      nd.classlist.add('TVNOCURSOR');\r\n\r\n    if Assigned(Selected) then\r\n    begin\r\n      if Selected = ANode then\r\n      begin\r\n        nd.classlist.add('TVSELECTED');\r\n        if ElementNodeSelectedClassName <> '' then\r\n          nd.classlist.add(ElementNodeSelectedClassName);\r\n      end;\r\n    end;\r\n\r\n    if ANode.Hint <> '' then\r\n      nd.setAttribute('title', ANode.Hint);\r\n\r\n    LinkElement.appendChild(sp);\r\n    sp.appendChild(nd);\r\n    if ANode.Expanded then\r\n      sp.setAttribute('class', 'TVCARET TVCARET-DOWN')\r\n    else\r\n      sp.setAttribute('class', 'TVCARET');\r\n\r\n    DoRenderNode(ANode, nd);\r\n  end;\r\n\r\n  procedure FillChilds(ParentElement: TJSElement; ParentName: string; ANode: TTreeNode);\r\n  var\r\n    i: integer;\r\n    ul: TJSElement;\r\n    nd,li: TJSHTMLElement;\r\n    nn: string;\r\n  begin\r\n    ul := document.createElement('UL');\r\n    ul.setAttribute('class','TVUL');\r\n    ul.setAttribute('id',ParentName);\r\n    ParentElement.appendChild(ul);\r\n\r\n    if not Assigned(ANode) then\r\n    begin\r\n      // root items\r\n      for i := 0 to FItems.Count - 1 do\r\n      begin\r\n        nn := ParentName + '_' + inttostr(i);\r\n\r\n        li := TJSHTMLElement(document.createElement('LI'));\r\n        ul.appendChild(li);\r\n\r\n        if FItems[i].Count > 0 then\r\n        begin\r\n          RenderChildNode(li, FItems[i], nn);\r\n          FillChilds(li, nn, FItems[i]);\r\n        end\r\n        else\r\n        begin\r\n          nd := RenderNode(FItems[i], nn);\r\n          li.appendChild(nd);\r\n          DoRenderNode(FItems[i], nd);\r\n\r\n          nd.addEventListener('click', @HandleClick);\r\n          nd.addEventListener('dblclick', @HandleDblClick);\r\n        end;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      // child items\r\n      if ANode.Expanded then\r\n        ul.setAttribute('class','TVNESTED TVUL TVACTIVE')\r\n      else\r\n        ul.setAttribute('class','TVNESTED TVUL');\r\n\r\n      for i := 0 to ANode.Count - 1 do\r\n      begin\r\n        nn := ParentName + '_' + inttostr(i);\r\n\r\n        li := TJSHTMLElement(document.createElement('LI'));\r\n        ul.appendChild(li);\r\n\r\n        if ANode.Item[i].Count > 0 then\r\n        begin\r\n          RenderChildNode(li, ANode.Item[i], nn);\r\n          FillChilds(li, nn, ANode.Item[i]);\r\n        end\r\n        else\r\n        begin\r\n          nd := RenderNode(ANode.Item[i], nn);\r\n          li.appendChild(nd);\r\n\r\n          DoRenderNode(ANode.Item[i], nd);\r\n\r\n          nd.addEventListener('click', @HandleClick);\r\n          nd.addEventListener('dblclick', @HandleDblClick);\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  // remove previous tree\r\n  while ElementHandle.childNodes.length > 0 do\r\n    ElementHandle.removeChild(ElementHandle.FirstChild);\r\n\r\n  FillChilds(ElementHandle, Name, nil);\r\n  ElementHandle.style.setProperty('overflow','auto');\r\nend;\r\n\r\nprocedure TTreeView.SetElementNodeClassName(const Value: TElementClassName);\r\nbegin\r\n  if (FElementNodeClassName <> Value) then\r\n  begin\r\n    FElementNodeClassName := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TTreeView.SetElementNodeSelectedClassName(\r\n  const Value: TElementClassName);\r\nbegin\r\n  if (FElementNodeSelectedClassName <> Value) then\r\n  begin\r\n    FElementNodeSelectedClassName := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TTreeView.SetItems(const Value: TTreeNodes);\r\nbegin\r\n  FItems.Assign(Value);\r\nend;\r\n\r\nprocedure TTreeView.SetSelected(const Value: TTreeNode);\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  if Assigned(FSelected) then\r\n  begin\r\n    el := GetNodeElement(FSelected);\r\n    if Assigned(el) then\r\n    begin\r\n      el.classlist.toggle('TVSELECTED');\r\n      if ElementNodeSelectedClassName <> '' then\r\n        el.classlist.toggle(ElementNodeSelectedClassName);\r\n    end;\r\n  end;\r\n\r\n  FSelected := Value;\r\n  el := GetNodeElement(FSelected);\r\n  if Assigned(el) then\r\n  begin\r\n    el.classlist.toggle('TVSELECTED');\r\n    if ElementNodeSelectedClassName <> '' then\r\n      el.classlist.toggle(ElementNodeSelectedClassName);\r\n  end;\r\nend;\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Buttons;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, WEBLib.Controls, Web, WEBLib.Graphics, WEBLib.StdCtrls,\r\n  WEBlib.ComCtrls, WEBLib.ExtCtrls;\r\n\r\ntype\r\n\r\n  TButtonLayout = (blGlyphLeft, blGlyphRight, blGlyphTop, blGlyphBottom);\r\n\r\n\r\n  TCustomSpeedButton = class(TCustomControl)\r\n  private\r\n    FMaterialGlyph: TMaterialGlyph;\r\n    FColor: TColor;\r\n    FIntColor: TColor;\r\n    FDown: boolean;\r\n    FFlat: boolean;\r\n    FGroupIndex: integer;\r\n    FAllowAllUp: boolean;\r\n    FGlyph: TURLPicture;\r\n    FLayout: TButtonLayout;\r\n    FGlyphURL: String;\r\n    procedure SetMaterialGlyph(const AValue: TMaterialGlyph);\r\n    procedure SetColorEx(const AValue: TColor);\r\n    procedure SetIntColor(const AValue: TColor);\r\n    procedure SetGroupIndex(const AValue: integer);\r\n    procedure SetDown(const AValue: boolean);\r\n    procedure SetFlat(const Value: boolean);\r\n    procedure SetGlyph(const Value: TURLPicture);\r\n    procedure SetGlyphURL(const Value: String);\r\n  protected\r\n    procedure SetCaption(const AValue: string); override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure UpdateGroup; virtual;\r\n    procedure DoMouseLeave; override;\r\n    procedure DoMouseEnter; override;\r\n    procedure MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); override;\r\n    procedure MouseDown(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); override;\r\n    procedure GlyphChanged(Sender: TObject);\r\n    property AllowAllUp: boolean read FAllowAllUp write FAllowAllUp;\r\n    property Color: TColor read FColor write SetColorEx;\r\n    property IntColor: TColor read FIntColor write SetIntColor;\r\n    property Down: boolean read FDown write SetDown;\r\n    property Flat: boolean read FFlat write SetFlat default false;\r\n    property Glyph: TURLPicture read FGlyph write SetGlyph;\r\n    property GlyphURL: String read FGlyphURL write SetGlyphURL;\r\n    property GroupIndex: integer read FGroupIndex write SetGroupIndex;\r\n    property Layout: TButtonLayout read FLayout write FLayout default blGlyphLeft;\r\n    property MaterialGlyph: TMaterialGlyph read FMaterialGlyph write SetMaterialGlyph;\r\n  public\r\n    destructor Destroy; override;\r\n    procedure CreateInitialize; override;\r\n    function CanFocus: Boolean; override;\r\n  end;\r\n\r\n  TSpeedButton = class(TCustomSpeedButton)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AllowAllUp;\r\n    property Caption;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Flat;\r\n    property Font;\r\n    property Glyph;\r\n    property GlyphURL;\r\n    property GroupIndex;\r\n    property Height;\r\n    property Hint;\r\n    property Layout;\r\n    property Margins;\r\n    property MaterialGlyph;\r\n    property ShowHint;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n\r\n  TWebSpeedButton = class(TSpeedButton);\r\n\r\n  TCustomBitBtn = class(TCustomControl)\r\n  private\r\n    FMaterialGlyph: TMaterialGlyph;\r\n    FLayout: TButtonLayout;\r\n    FFlat: boolean;\r\n    FGlyph: TURLPicture;\r\n    FColor: TColor;\r\n    FIntColor: TColor;\r\n    FAlignment: TAlignment;\r\n    FGlyphURL: String;\r\n    procedure SetFlat(const Value: boolean);\r\n    procedure SetGlyph(const Value: TURLPicture);\r\n    procedure SetLayout(const Value: TButtonLayout);\r\n    procedure SetMaterialGlyph(const Value: TMaterialGlyph);\r\n    procedure SetColorEx(const Value: TColor);\r\n    procedure SetIntColor(const Value: TColor);\r\n    procedure SetAlignment(const Value: TAlignment);\r\n    procedure SetGlyphURL(const Value: String);\r\n  protected\r\n    procedure SetCaption(const AValue: string); override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure GlyphChanged(Sender: TObject);\r\n    property Alignment: TAlignment read FAlignment write SetAlignment default taCenter;\r\n    property Color: TColor read FColor write SetColorEx;\r\n    property IntColor: TColor read FIntColor write SetIntColor;\r\n    property Flat: boolean read FFlat write SetFlat default false;\r\n    property Layout: TButtonLayout read FLayout write SetLayout default blGlyphLeft;\r\n    property MaterialGlyph: TMaterialGlyph read FMaterialGlyph write SetMaterialGlyph;\r\n    property Glyph: TURLPicture read FGlyph write SetGlyph;\r\n    property GlyphURL: String read FGlyphURL write SetGlyphURL;\r\n  public\r\n    destructor Destroy; override;\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TBitBtn = class(TCustomBitBtn)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Alignment;\r\n    property Anchors;\r\n    property Caption;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Flat;\r\n    property Glyph;\r\n    property GlyphURL;\r\n    property Height;\r\n    property Hint;\r\n    property Layout;\r\n    property MaterialGlyph;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebBitBtn = class(TBitBtn);\r\n\r\n  TCustomToolBar = class(TCustomControl)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property Color default $CFCFCF;\r\n  end;\r\n\r\n  TToolBar = class(TCustomToolBar)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property Enabled;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property Margins;\r\n    property ShowHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnDblClick;\r\n  end;\r\n\r\n  TWebToolBar = class(TToolBar);\r\n\r\n\r\n  TRichEditBtn = (reFont, reFontSize, reBold, reItalic, reUnderline, reStrikeThrough,\r\n    reAlignLeft, reAlignCenter, reAlignRight, reUnorderedList, reOrderedList, reForegroundColor, reBackgroundColor);\r\n\r\n  TRichEditButtonSet = set of TRichEditBtn;\r\n\r\n  TRichEditToolBar = class(TToolBar)\r\n  private\r\n    FBold: TSpeedButton;\r\n    FItalic: TSpeedButton;\r\n    FUnderline: TSpeedButton;\r\n    FStrikeThrough: TSpeedButton;\r\n    FAlignLeft: TSpeedButton;\r\n    FAlignCenter: TSpeedButton;\r\n    FAlignRight: TSpeedButton;\r\n    FUList: TSpeedButton;\r\n    FOList: TSpeedButton;\r\n    FRichEdit: TRichEdit;\r\n    FFnt: TFontPicker;\r\n    FFntSize: TFontSizePicker;\r\n    FFgClr: TColorPicker;\r\n    FBkClr: TColorPicker;\r\n    FOnSpeedButtonClick: TNotifyEvent;\r\n    FTextColor: TColor;\r\n    FBackgroundColor: TColor;\r\n    FVisibleButtons: TRichEditButtonSet;\r\n    FHints: TStrings;\r\n    procedure SetRichEdit(const AValue: TRichEdit);\r\n    function GetRichEdit: TRichEdit;\r\n    procedure SetTextColor(const Value: TColor);\r\n    procedure SetBackgroundColor(const Value: TColor);\r\n    procedure SetVisibleButtons(const Value: TRichEditButtonSet);\r\n    procedure SetHints(const Value: TStrings);\r\n  protected\r\n    procedure CreateButton(var btn: TSpeedButton; BtnID, Glyph, Hint: string);\r\n    procedure HandleSpeedButtonClick(Sender: TObject); virtual;\r\n    procedure FgSelect(Sender: TObject);\r\n    procedure BkSelect(Sender: TObject);\r\n    procedure FntChange(Sender: TObject);\r\n    procedure FntSizeChange(Sender: TObject);\r\n    procedure UpdateButtons; virtual;\r\n    procedure Loaded; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    property BackgroundColor: TColor read FBackgroundColor write SetBackgroundColor;\r\n    property FontPicker: TFontPicker read FFnt;\r\n    property FontSizePicker: TFontSizePicker read FFntSize;\r\n  published\r\n    property Hints: TStrings read FHints write SetHints;\r\n    property RichEdit: TRichEdit read GetRichEdit write SetRichEdit;\r\n    property TextColor: TColor read FTextColor write SetTextColor;\r\n    property VisibleButtons: TRichEditButtonSet read FVisibleButtons write SetVisibleButtons;\r\n    property OnSpeedButtonClick: TNotifyEvent read FOnSpeedButtonClick write FOnSpeedButtonClick;\r\n  end;\r\n\r\n  TWebRichEditToolBar = class(TRichEditToolBar);\r\n\r\n  TToggleButtonStyle = (tsRectangular, tsRounded);\r\n\r\n  TToggleButton = class(TCustomControl)\r\n  private\r\n    FChecked: boolean;\r\n    FLabel: TJSHTMLElement;\r\n    FInput: TJSHTMLElement;\r\n    FSlider: TJSHTMLElement;\r\n    FStyle: TToggleButtonStyle;\r\n    procedure SetStyle(const Value: TToggleButtonStyle);\r\n    function GetChecked: boolean;\r\n    procedure SetChecked(const Value: boolean);\r\n  protected\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; override;\r\n    procedure UpdateElement; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure Loaded; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Checked: boolean read GetChecked write SetChecked;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Style: TToggleButtonStyle read FStyle write SetStyle default tsRectangular;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebToggleButton = class(TToggleButton);\r\n\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.WebTools;\r\n\r\n// https://stackoverflow.com/questions/1720320/how-to-dynamically-create-css-class-in-javascript-and-apply\r\n// https://www.w3schools.com/howto/howto_css_switch.asp\r\n\r\n{ TCustomSpeedButton }\r\n\r\nprocedure TCustomSpeedButton.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FColor := clNone;\r\n  FIntColor := clNone;\r\n  FGroupIndex := 0;\r\n  FDown := false;\r\n  FFlat := false;\r\n  FGlyph := TURLPicture.Create;\r\n  FGlyph.OnChange := GlyphChanged;\r\n  FGlyph.OnDataChange := GlyphChanged;\r\n  FLayout := blGlyphLeft;\r\nend;\r\n\r\nfunction TCustomSpeedButton.CanFocus: Boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nfunction TCustomSpeedButton.CreateElement: TJSElement;\r\nbegin\r\n  if FFlat then\r\n    Result := document.createElement('SPAN')\r\n  else\r\n    Result := document.createElement('BUTTON');\r\nend;\r\n\r\nprocedure TCustomSpeedButton.SetCaption(const AValue: string);\r\nbegin\r\n  if (Caption <> AValue) then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.SetColorEx(const AValue: TColor);\r\nbegin\r\n  if FColor <> AValue then\r\n  begin\r\n    FColor := AValue;\r\n    FIntColor := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.SetDown(const AValue: boolean);\r\nbegin\r\n  if (FDown <> AValue) then\r\n  begin\r\n    FDown := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.SetFlat(const Value: boolean);\r\nbegin\r\n  if (FFlat <> Value) then\r\n  begin\r\n    FFlat := Value;\r\n    RecreateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.SetIntColor(const AValue: TColor);\r\nbegin\r\n  if FIntColor <> AValue then\r\n  begin\r\n    FIntColor := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.SetMaterialGlyph(const AValue: TMaterialGlyph);\r\nbegin\r\n  if FMaterialGlyph <> AValue then\r\n  begin\r\n    FMaterialGlyph := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.SetGlyph(const Value: TURLPicture);\r\nbegin\r\n  FGlyph.Assign(Value);\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.SetGlyphURL(const Value: String);\r\nbegin\r\n  if FGlyphURL <> Value then\r\n  begin\r\n    FGlyphURL := Value;\r\n    RecreateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.SetGroupIndex(const AValue: integer);\r\nbegin\r\n  FGroupIndex := AValue;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.UpdateElement;\r\nvar\r\n  s,inactive,noptr,icn,imgsrc: string;\r\n  clr: TColor;\r\nbegin\r\n  inherited;\r\n\r\n  if not IsUpdating and (MaterialGlyph <> '') then\r\n    AddControlLink('googlematerial', 'https://fonts.googleapis.com/icon?family=Material+Icons');\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if Down then\r\n      clr := clGray\r\n    else\r\n      clr := FIntColor;\r\n\r\n    if FFlat then\r\n    begin\r\n      if clr <> clNone then\r\n        ElementHandle.style.setProperty('background-color', ColorToHTML(clr))\r\n      else\r\n        ElementHandle.style.setProperty('background-color', '');\r\n    end;\r\n\r\n    ElementHandle.style.setProperty('vertical-align','middle');\r\n\r\n//    if Visible then\r\n//      ElementHandle.style.setProperty('display','table');\r\n\r\n    ElementHandle.style.setProperty('overflow','hidden');\r\n    ElementHandle.style.setProperty('padding','0px');\r\n    ElementHandle.style.setProperty('text-align','center');\r\n\r\n    s := '';\r\n    inactive := '';\r\n    noptr := '';\r\n\r\n    if not Enabled then\r\n      inactive := ' md-light md-inactive';\r\n\r\n    noptr := 'pointer-events:none';\r\n\r\n    if FMaterialGlyph <> '' then\r\n      icn := '<i class=\"material-icons'+ inactive +'\" style=\"'+noptr+'\">' + FMaterialGlyph + '</i>';\r\n\r\n    if FGlyph.Data <> '' then\r\n      imgsrc :=  'data:image/jpeg;base64,' + HexImageDecodeAsBase64(FGlyph.Data)\r\n    else\r\n    if FGlyph.FileName <> '' then\r\n      imgsrc := FGlyph.FileName\r\n    else\r\n    if FGlyphURL <> '' then\r\n      imgsrc := FGlyphURL;\r\n\r\n    if imgsrc <> '' then\r\n      icn := '<img style=\"'+noptr+';vertical-align:middle;\" src=\"'+ imgsrc + '\">';\r\n\r\n    case Layout of\r\n    blGlyphLeft: s := '<table border=\"0\" align=\"center\" style=\"'+noptr+'\"><tr><td>'+icn+'</td><td>'+Caption+'</td></tr></table>';\r\n    blGlyphRight:  s := '<table border=\"0\" align=\"center\" style=\"'+noptr+'\"><tr><td>'+Caption+'</td><td>'+icn+'</td></tr></table>';\r\n    blGlyphTop: s := '<table border=\"0\" align=\"center\" style=\"'+noptr+'\"><tr><td>'+icn+'</td></tr><tr><td>'+Caption+'</td></tr></table>';\r\n    blGlyphBottom:  s := '<table border=\"0\" align=\"center\" style=\"'+noptr+'\"><tr><td>'+Caption+'</td></tr><tr><td>'+icn+'</td></tr></table>';\r\n    end;\r\n\r\n    ElementHandle.innerHTML := s;\r\n\r\n    SetHTMLElementFont(TJSHTMLElement(ElementHandle.firstChild), Font, not ((ElementClassName = '') and (ElementFont = efProperty)) );\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.UpdateGroup;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if Assigned(Parent) then\r\n  begin\r\n    for i := 0 to Parent.ControlCount - 1 do\r\n    begin\r\n      if (Parent.Controls[i] <> Self) and (Parent.Controls[i] is TSpeedButton) and ((Parent.Controls[i] as TSpeedButton).GroupIndex = GroupIndex) then\r\n        (Parent.Controls[i] as TSpeedButton).Down := false;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.DoMouseLeave;\r\nbegin\r\n  inherited;\r\n  IntColor := FColor;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.GlyphChanged(Sender: TObject);\r\nbegin\r\n  UpdateElement;\r\nend;\r\n\r\ndestructor TCustomSpeedButton.Destroy;\r\nbegin\r\n  FGlyph.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.DoMouseEnter;\r\nbegin\r\n  inherited;\r\n  if Enabled then\r\n    IntColor := clSilver;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer);\r\nbegin\r\n  inherited;\r\n  if Enabled then\r\n    IntColor := clSilver;\r\nend;\r\n\r\nprocedure TCustomSpeedButton.MouseDown(Button: TMouseButton; Shift: TShiftState; X,Y: Integer);\r\nbegin\r\n  inherited;\r\n  if not Enabled then\r\n    Exit;\r\n\r\n  IntColor := clGray;\r\n\r\n  if GroupIndex > 0 then\r\n  begin\r\n    if Down and AllowAllUp then\r\n      Down := false\r\n    else\r\n    begin\r\n      Down := true;\r\n      UpdateGroup;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TCustomToolBar }\r\n\r\nfunction TCustomToolBar.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nprocedure TCustomToolBar.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Color := $CFCFCF;\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\n  Width := 300;\r\n  Height := 32;\r\nend;\r\n\r\n{ TRichEditToolBar }\r\n\r\nprocedure TRichEditToolBar.CreateInitialize;\r\nbegin\r\n  inherited;\r\n\r\n  FFnt := TFontPicker.Create(Self);\r\n  FFnt.Parent := Self;\r\n  FFnt.Width := 150;\r\n  FFnt.Align := alLeft;\r\n  FFnt.OnChange := FntChange;\r\n\r\n  FFntSize := TFontSizePicker.Create(Self);\r\n  FFntSize.Parent := Self;\r\n  FFntSize.Width := 50;\r\n  FFntSize.Align := alLeft;\r\n  FFntSize.PickerMode := fmRelativeSize;\r\n  FFntSize.OnChange := FntSizeChange;\r\n\r\n  FHints := TStringList.Create;\r\n  FHints.Add('Bold');\r\n  FHints.Add('Italic');\r\n  FHints.Add('Underline');\r\n  FHints.Add('Strike Throught');\r\n\r\n  FHints.Add('Text Color');\r\n  FHints.Add('Background Color');\r\n  FHints.Add('Align lef');\r\n  FHints.Add('Align center');\r\n  FHints.Add('Align right');\r\n  FHints.Add('Numbered list');\r\n  FHints.Add('List');\r\n\r\n  CreateButton(FBold, ElementID+'_bold', '&#xE238;',FHints.Strings[0]);\r\n  CreateButton(FItalic, ElementID+'_italic', '&#xE23F;',FHints.Strings[1]);\r\n  CreateButton(FUnderline, ElementID+'_underline', '&#xE249;',FHints.Strings[2]);\r\n  CreateButton(FStrikeThrough, ElementID+'_strikethrough', '&#xE257;',FHints.Strings[3]);\r\n\r\n  FFgClr := TColorPicker.Create(Self);\r\n  FFgClr.Parent := Self;\r\n  FFgClr.Align := alLeft;\r\n  FFgClr.Hint := FHints.Strings[4];\r\n  FFgClr.Width := 32;\r\n  FFgClr.Height := 24;\r\n  FFgClr.OnSelect := FgSelect;\r\n\r\n  FBkClr := TColorPicker.Create(Self);\r\n  FBkClr.Parent := Self;\r\n  FBkClr.Align := alLeft;\r\n  FBkClr.Hint := FHints.Strings[5];\r\n  FBkClr.Width := 32;\r\n  FBkClr.Height := 24;\r\n  FBkClr.OnSelect := BkSelect;\r\n\r\n  CreateButton(FAlignLeft, ElementID+'_alignleft', '&#xE236;',FHints.Strings[6]);\r\n  CreateButton(FAlignCenter, ElementID+'_aligncenter', '&#xE234;',FHints.Strings[7]);\r\n  CreateButton(FAlignRight, ElementID+'_alignright', '&#xE237;',FHints.Strings[8]);\r\n\r\n  CreateButton(FOList, ElementID+'_olist','&#xE242;',FHints.Strings[9]);\r\n  CreateButton(FUList, ElementID+'_ulist','&#xE241;',FHints.Strings[10]);\r\n\r\n  FVisibleButtons := [reFont, reFontSize, reBold, reItalic, reUnderline, reStrikeThrough,\r\n    reAlignLeft, reAlignCenter, reAlignRight, reUnorderedList, reOrderedList, reForegroundColor, reBackgroundColor];\r\n\r\n  Width := 540;\r\n\r\n  RichEdit := nil;\r\nend; \r\n\r\ndestructor TRichEditToolBar.Destroy;\r\nbegin\r\n  FHints.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TRichEditToolBar.CreateButton(var btn: TSpeedButton; BtnID, Glyph, Hint: string);\r\nbegin\r\n  btn := TSpeedButton.Create(BtnID);\r\n  btn.Parent := Self;\r\n  btn.MaterialGlyph := Glyph;\r\n  btn.Width := 32;\r\n  btn.Height := 24;\r\n  btn.Align := alLeft;\r\n  btn.Flat := true;\r\n  btn.Hint := Hint;\r\n  btn.ShowHint := Hint <> '';\r\n  btn.Enabled := true;\r\n  btn.OnClick := HandleSpeedButtonClick;\r\nend;\r\n\r\nprocedure TRichEditToolBar.SetBackgroundColor(const Value: TColor);\r\nbegin\r\n  FBackgroundColor := Value;\r\n  FBkClr.Color := Value;\r\nend;\r\n\r\nprocedure TRichEditToolBar.SetHints(const Value: TStrings);\r\nbegin\r\n  FHints.Assign(Value);\r\nend;\r\n\r\nprocedure TRichEditToolBar.SetRichEdit(const AValue: TRichEdit);\r\nbegin\r\n  if Assigned(AValue) then\r\n  begin\r\n    FRichEdit := AValue;\r\n    FRichEdit.Owner := Self;\r\n  end;\r\nend;\r\n\r\nprocedure TRichEditToolBar.SetTextColor(const Value: TColor);\r\nbegin\r\n  FTextColor := Value;\r\n  FFgClr.Color := Value;\r\nend;\r\n\r\nprocedure TRichEditToolBar.SetVisibleButtons(const Value: TRichEditButtonSet);\r\nbegin\r\n  FVisibleButtons := Value;\r\n  UpdateButtons;\r\nend;\r\n\r\nprocedure TRichEditToolBar.UpdateButtons;\r\nbegin\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  FBold.Visible := reBold in FVisibleButtons;\r\n  FItalic.Visible := reItalic in VisibleButtons;\r\n  FUnderline.Visible := reUnderline in VisibleButtons;\r\n  FStrikeThrough.Visible := reStrikeThrough in VisibleButtons;\r\n  FAlignLeft.Visible := reAlignLeft in VisibleButtons;\r\n  FAlignCenter.Visible := reAlignCenter in VisibleButtons;\r\n  FAlignRight.Visible := reAlignRight in VisibleButtons;\r\n  FUList.Visible := reUnorderedList in VisibleButtons;\r\n  FOList.Visible := reOrderedList in VisibleButtons;\r\n  FFnt.Visible := reFont in VisibleButtons;\r\n  FFntSize.Visible := reFontSize in VisibleButtons;\r\n  FFgClr.Visible := reForegroundColor in VisibleButtons;\r\n  FBkClr.Visible := reBackgroundColor in VisibleButtons;\r\n\r\n  while FHints.Count < 13 do\r\n    FHints.Add('');\r\n\r\n  FBold.Hint := FHints.Strings[0];\r\n  FItalic.Hint := FHints.Strings[1];\r\n  FUnderline.Hint := FHints.Strings[2];\r\n  FStrikeThrough.Hint := FHints.Strings[3];\r\n  FAlignLeft.Hint := FHints.Strings[4];\r\n  FAlignCenter.Hint := FHints.Strings[5];\r\n  FAlignRight.Hint := FHints.Strings[6];\r\n  FUList.Hint := FHints.Strings[7];\r\n  FOList.Hint := FHints.Strings[8];\r\n  FFgClr.Hint := FHints.Strings[9];\r\n  FBkClr.Hint := FHints.Strings[10];\r\nend;\r\n\r\nfunction TRichEditToolBar.GetRichEdit: TRichEdit;\r\nbegin\r\n  Result := FRichEdit;\r\nend;\r\n\r\nprocedure TRichEditToolBar.FgSelect(Sender: TObject); \r\nbegin\r\n  RichEdit.SelAttributes.Color := FFgClr.Color;\r\nend;\r\n\r\nprocedure TRichEditToolBar.BkSelect(Sender: TObject); \r\nbegin\r\n  RichEdit.SelAttributes.BackColor := FBkClr.Color;\r\nend;\r\n\r\nprocedure TRichEditToolBar.FntChange(Sender: TObject);\r\nbegin\r\n  RichEdit.SelAttributes.Name := FFnt.Items[FFnt.ItemIndex];\r\nend;\r\n\r\nprocedure TRichEditToolBar.FntSizeChange(Sender: TObject);\r\nbegin\r\n  RichEdit.SelAttributes.Height := FFntSize.ItemIndex + 1;\r\nend;\r\n\r\nprocedure TRichEditToolBar.HandleSpeedButtonClick(Sender: TObject);\r\nvar\r\n  BID: string;\r\nbegin\r\n  if Assigned(RichEdit) then\r\n  begin\r\n    BID := TControl(Sender).GetID;\r\n\r\n    if BID = GetID + '_bold' then\r\n    begin\r\n      if fsBold in RichEdit.SelAttributes.Style then\r\n        RichEdit.SelAttributes.Style := RichEdit.SelAttributes.Style - [fsBold]\r\n      else\r\n        RichEdit.SelAttributes.Style := RichEdit.SelAttributes.Style + [fsBold];\r\n    end\r\n    else if BID = GetID + '_italic' then\r\n    begin\r\n      if fsItalic in RichEdit.SelAttributes.Style then\r\n        RichEdit.SelAttributes.Style := RichEdit.SelAttributes.Style - [fsItalic]\r\n      else\r\n        RichEdit.SelAttributes.Style := RichEdit.SelAttributes.Style + [fsItalic];\r\n    end\r\n    else if BID = GetID + '_underline' then\r\n    begin\r\n      if fsUnderline in RichEdit.SelAttributes.Style then\r\n        RichEdit.SelAttributes.Style := RichEdit.SelAttributes.Style - [fsUnderline]\r\n      else\r\n        RichEdit.SelAttributes.Style := RichEdit.SelAttributes.Style + [fsUnderline];\r\n    end\r\n    else if BID = GetID + '_strikethrough' then\r\n    begin\r\n      if fsStrikeOut in RichEdit.SelAttributes.Style then\r\n        RichEdit.SelAttributes.Style := RichEdit.SelAttributes.Style - [fsStrikeOut]\r\n      else\r\n        RichEdit.SelAttributes.Style := RichEdit.SelAttributes.Style + [fsStrikeOut];\r\n    end\r\n    else if BID = GetID + '_alignleft' then\r\n      RichEdit.SelAttributes.Alignment := taleftJustify\r\n    else if BID = GetID + '_aligncenter' then\r\n      RichEdit.SelAttributes.Alignment := taCenter\r\n    else if BID = GetID + '_alignright' then\r\n      RichEdit.SelAttributes.Alignment := taRightJustify\r\n    else if BID = GetID + '_olist' then\r\n      RichEdit.SelAttributes.OrderedList := not RichEdit.SelAttributes.OrderedList\r\n    else if BID = GetID + '_ulist' then\r\n      RichEdit.SelAttributes.UnOrderedList := not RichEdit.SelAttributes.UnOrderedList;\r\n  end;\r\n\r\n  if Assigned(OnSpeedButtonClick) then\r\n    OnSpeedButtonClick(Self);\r\nend;\r\n\r\n\r\nprocedure TRichEditToolBar.Loaded;\r\nbegin\r\n  inherited;\r\n  UpdateButtons;\r\nend;\r\n\r\n{ TToggleButton }\r\n\r\nfunction TToggleButton.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('span');\r\n  FLabel := TJSHTMLElement(document.createElement('label'));\r\n  FInput := TJSHTMLElement(document.createElement('input'));\r\n  FSlider := TJSHTMLElement(document.createElement('span'));\r\n  FInput.setAttribute('type','checkbox');\r\n\r\n  Result.appendChild(FLabel);\r\n  FLabel.appendChild(FInput);\r\n  FLabel.appendChild(FSlider);\r\nend;\r\n\r\nprocedure TToggleButton.CreateInitialize;\r\nvar\r\n  css: string;\r\nbegin\r\n  inherited;\r\n\r\n  css := '.switch {'+\r\n    'position: relative;'+\r\n    'display: inline-block;'+\r\n    'width: 44px;'+\r\n    'height: 22px;'+\r\n  '}'+\r\n\r\n  '.switch input {display:none;}'+\r\n\r\n  '.slider {'+\r\n    'position: absolute;'+\r\n    'cursor: pointer;'+\r\n    'top: 0;'+\r\n    'left: 0;'+\r\n    'right: 0;'+\r\n    'bottom: 0;'+\r\n    'background-color: #ccc;'+\r\n    '-webkit-transition: .4s;'+\r\n    'transition: .4s;'+\r\n  '}'+\r\n\r\n  '.slider:before {'+\r\n    'position: absolute;'+\r\n    'content: \"\";'+\r\n    'height: 14px;'+\r\n    'width: 14px;'+\r\n    'left: 4px;'+\r\n    'bottom: 4px;'+\r\n    'background-color: white;'+\r\n    '-webkit-transition: .4s;'+\r\n    'transition: .4s;'+\r\n  '}'+\r\n\r\n  'input:checked + .slider {'+\r\n    'background-color: #2196F3;'+\r\n  '}'+\r\n\r\n  'input:focus + .slider {'+\r\n    'box-shadow: 0 0 1px #2196F3;'+\r\n  '}'+\r\n\r\n  'input:checked + .slider:before {'+\r\n    '-webkit-transform: translateX(22px);'+\r\n    '-ms-transform: translateX(22px);'+\r\n    'transform: translateX(22px);'+\r\n  '}'+\r\n\r\n  '/* Rounded sliders */'+\r\n  '.slider.round {'+\r\n    'border-radius: 22px;'+\r\n  '}'+\r\n\r\n  '.slider.round:before {'+\r\n    'border-radius: 50%;'+\r\n  '}';\r\n\r\n  AddControlStyle(css);\r\n\r\n  Width := 48;\r\n  Height := 24;\r\nend;\r\n\r\nfunction TToggleButton.GetChecked: boolean;\r\nbegin\r\n  if Assigned(Container) then\r\n    FChecked := TJSHTMLInputElement(FInput).checked;\r\n\r\n  Result := FChecked;\r\nend;\r\n\r\nfunction TToggleButton.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  ElementEvent := Event;\r\n  StopPropagation;\r\n  if Event.target  = FInput then\r\n    Click;\r\n  Result := True;\r\n  ElementEvent := nil;\r\nend;\r\n\r\nprocedure TToggleButton.Loaded;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TToggleButton.SetChecked(const Value: boolean);\r\nbegin\r\n  FChecked := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TToggleButton.SetStyle(const Value: TToggleButtonStyle);\r\nbegin\r\n  if (FStyle <> Value) then\r\n  begin\r\n    FStyle := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TToggleButton.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if not IsUpdating then\r\n  begin\r\n    InjectCSS;\r\n\r\n    FLabel.setAttribute('class','switch');\r\n\r\n    TJSHTMLInputElement(FInput).checked := FChecked;\r\n\r\n    if Style = tsRectangular then\r\n      FSlider.setAttribute('class','slider')\r\n    else\r\n      FSlider.setAttribute('class','slider round');\r\n  end;\r\nend;\r\n\r\n{ TCustomBitBtn }\r\n\r\n//constructor TCustomBitBtn.Create(AOwner: TComponent);\r\n//begin\r\n//  inherited Create(AOwner);\r\n//end;\r\n\r\nfunction TCustomBitBtn.CreateElement: TJSElement;\r\nbegin\r\n  if FFlat then\r\n    Result := document.createElement('SPAN')\r\n  else\r\n    Result := document.createElement('BUTTON');\r\nend;\r\n\r\nprocedure TCustomBitBtn.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FColor := clNone;\r\n  FIntColor := clNone;\r\n  FFlat := false;\r\n  Width := 80;\r\n  Height := 25;\r\n  FAlignment := taCenter;\r\n  FGlyph := TURLPicture.Create;\r\n  FGlyph.OnChange := GlyphChanged;\r\n  FGlyph.OnDataChange := GlyphChanged;\r\nend;\r\n\r\ndestructor TCustomBitBtn.Destroy;\r\nbegin\r\n  FGlyph.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomBitBtn.GlyphChanged(Sender: TObject);\r\nbegin\r\n  UpdateElement;\r\nend;\r\n\r\n\r\nprocedure TCustomBitBtn.SetCaption(const AValue: string);\r\nbegin\r\n  if (Caption <> AValue) then\r\n  begin\r\n    inherited SetCaption(AValue);\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomBitBtn.SetColorEx(const Value: TColor);\r\nbegin\r\n  if (FColor <> Value) then\r\n  begin\r\n    FColor := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomBitBtn.SetFlat(const Value: boolean);\r\nbegin\r\n  if (FFlat <> Value) then\r\n  begin\r\n    FFlat := Value;\r\n    RecreateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomBitBtn.SetGlyph(const Value: TURLPicture);\r\nbegin\r\n  FGlyph.Assign(Value);\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomBitBtn.SetGlyphURL(const Value: String);\r\nbegin\r\n  if FGlyphURL <> Value then\r\n  begin\r\n    FGlyphURL := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomBitBtn.SetIntColor(const Value: TColor);\r\nbegin\r\n  FIntColor := Value;\r\nend;\r\n\r\nprocedure TCustomBitBtn.SetAlignment(const Value: TAlignment);\r\nbegin\r\n  if (FAlignment <> Value) then\r\n  begin\r\n    FAlignment := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomBitBtn.SetLayout(const Value: TButtonLayout);\r\nbegin\r\n  if (FLayout <> Value) then\r\n  begin\r\n    FLayout := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomBitBtn.SetMaterialGlyph(const Value: TMaterialGlyph);\r\nbegin\r\n  if (FMaterialGlyph <> Value) then\r\n  begin\r\n    FMaterialGlyph := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomBitBtn.UpdateElement;\r\nvar\r\n  s,inactive,noptr,matgl,imgsrc: string;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if (Color <> clNone) and not Flat then\r\n      ElementHandle.style.setProperty('background-color', ColorToHTML(Color))\r\n    else\r\n      ElementHandle.style.setProperty('background-color', '');\r\n\r\n    ElementHandle.style.setProperty('vertical-align','middle');\r\n    if Visible then\r\n      ElementHandle.style.setProperty('display','table');\r\n    ElementHandle.style.setProperty('overflow','hidden');\r\n    ElementHandle.style.setProperty('padding','0px');\r\n\r\n    case Alignment of\r\n      taLeftJustify: ElementHandle.style.setProperty('text-align','left');\r\n      taCenter: ElementHandle.style.setProperty('text-align','center');\r\n      taRightJustify: ElementHandle.style.setProperty('text-align','right');\r\n    end;\r\n\r\n    s := '';\r\n    inactive := '';\r\n    noptr := '';\r\n    matgl := '';\r\n\r\n    if not Enabled then\r\n      inactive := ' md-light md-inactive';\r\n\r\n    noptr := 'pointer-events:none';\r\n\r\n    if FMaterialGlyph <> '' then\r\n      matgl := '<i class=\"material-icons'+ inactive +'\" style=\"vertical-align:middle;'+noptr+'\">' + FMaterialGlyph + '</i>';\r\n\r\n//    if (FMaterialGlyph <> '') and (Caption <> '') then\r\n//      s := s + '&nbsp;';\r\n\r\n    if (Caption <> '') then\r\n      s := '<span style=\"'+noptr+'\">' + Caption + '</span>';\r\n\r\n    if FGlyph.Data <> '' then\r\n      imgsrc :=  'data:image/jpeg;base64,' + HexImageDecodeAsBase64(FGlyph.Data)\r\n    else\r\n    if FGlyph.FileName <> '' then\r\n      imgsrc := FGlyph.FileName\r\n    else\r\n    if FGlyphURL <> '' then\r\n      imgsrc := FGlyphURL;\r\n\r\n    case Layout of\r\n    blGlyphLeft:\r\n      begin\r\n        if matgl <> '' then\r\n          s := matgl + '&nbsp;' + s;\r\n\r\n        if imgsrc <> '' then\r\n          s := '<img style=\"vertical-align:middle;\" src=\"'+ imgsrc + '\">&nbsp;' + s;\r\n      end;\r\n\r\n    blGlyphRight:\r\n      begin\r\n        if matgl <> '' then\r\n          s := s + '&nbsp;' + matgl;\r\n\r\n        if imgsrc <> '' then\r\n           s := s+ '&nbsp;<img src=\"'+ imgsrc + '\">';\r\n      end;\r\n\r\n    blGlyphTop:\r\n      begin\r\n        if matgl <> '' then\r\n          s := matgl + '<br>' + s;\r\n\r\n        if imgsrc <> '' then\r\n           s := '<img src=\"'+ imgsrc + '\"><br>' + s;\r\n      end;\r\n\r\n    blGlyphBottom:\r\n      begin\r\n        if matgl <> '' then\r\n          s := s+ '<br>' + matgl;\r\n\r\n        if imgsrc <> '' then\r\n           s := s + '<br><img src=\"'+ imgsrc + '\">';\r\n      end;\r\n    end;\r\n\r\n    ElementHandle.innerHTML := s;\r\n  end;\r\nend;\r\n\r\nend.\r\n","{\r\n    Delphi/Kylix compatibility unit: String handling routines.\r\n\r\n    This file is part of the Free Pascal run time library.\r\n    Copyright (c) 2018 by the Free Pascal development team\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n{$mode objfpc}\r\n\r\n{$inline on}\r\nunit strutils;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Case insensitive search/replace\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction AnsiResemblesText(const AText, AOther: string): Boolean;\r\nFunction AnsiContainsText(const AText, ASubText: string): Boolean;\r\nFunction AnsiStartsText(const ASubText, AText: string): Boolean;\r\nFunction AnsiEndsText(const ASubText, AText: string): Boolean;\r\nFunction AnsiReplaceText(const AText, AFromText, AToText: string): string;\r\nFunction AnsiMatchText(const AText: string; const AValues: array of string): Boolean;\r\nFunction AnsiIndexText(const AText: string; const AValues: array of string): Integer;\r\n\r\nFunction StartsText(const ASubText, AText: string): Boolean;\r\nFunction EndsText(const ASubText, AText: string): Boolean;\r\n\r\nfunction ResemblesText(const AText, AOther: string): Boolean;\r\nfunction ContainsText(const AText, ASubText: string): Boolean;\r\nfunction MatchText(const AText: string; const AValues: array of string): Boolean;\r\nfunction IndexText(const AText: string; const AValues: array of string): Integer;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Case sensitive search/replace\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction AnsiContainsStr(const AText, ASubText: string): Boolean;\r\nFunction AnsiStartsStr(const ASubText, AText: string): Boolean;\r\nFunction AnsiEndsStr(const ASubText, AText: string): Boolean;\r\nFunction AnsiReplaceStr(const AText, AFromText, AToText: string): string;\r\nFunction AnsiMatchStr(const AText: string; const AValues: array of string): Boolean;\r\nFunction AnsiIndexStr(const AText: string; const AValues: array of string): Integer;\r\nFunction MatchStr(const AText: String; const AValues: array of String): Boolean;\r\nFunction IndexStr(const AText: String; const AValues: array of String): Integer;\r\nfunction ContainsStr(const AText, ASubText: string): Boolean;\r\nFunction StartsStr(const ASubText, AText: string): Boolean;\r\nFunction EndsStr(const ASubText, AText: string): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Miscellaneous\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DupeString(const AText: string; ACount: Integer): string;\r\nFunction ReverseString(const AText: string): string;\r\nFunction AnsiReverseString(const AText: String): String;\r\nFunction StuffString(const AText: string; AStart, ALength: Cardinal;  const ASubText: string): string;\r\nFunction RandomFrom(const AValues: array of string): string; overload;\r\nFunction IfThen(AValue: Boolean; const ATrue: string; const AFalse: string = ''): string; overload;\r\nfunction NaturalCompareText (const S1 , S2 : string ): Integer ;\r\nfunction NaturalCompareText(const Str1, Str2: string; const ADecSeparator, AThousandSeparator: String): Integer;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    VB emulations.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction LeftStr(const AText: String; const ACount: SizeInt): String;\r\nFunction RightStr(const AText: String; const ACount: SizeInt): String;\r\nFunction MidStr(const AText: String; const AStart, ACount: SizeInt): String;\r\nFunction RightBStr(const AText: String; const AByteCount: SizeInt): String;\r\nFunction MidBStr(const AText: String; const AByteStart, AByteCount: SizeInt): String;\r\nFunction AnsiLeftStr(const AText: String; const ACount: SizeInt): String;\r\nFunction AnsiRightStr(const AText: String; const ACount: SizeInt): String;\r\nFunction AnsiMidStr(const AText: String; const AStart, ACount: SizeInt): String;\r\nFunction LeftBStr(const AText: String; const AByteCount: SizeInt): String;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Extended search and replace\r\n  ---------------------------------------------------------------------}\r\n\r\nVar\r\n  { Default word delimiters are any character except the core alphanumerics. }\r\n  WordDelimiters: Array of Char;// = [#0..#255] - ['a'..'z','A'..'Z','1'..'9','0'];\r\n  \r\nConst\r\n  SErrAmountStrings    = 'Amount of search and replace strings don''t match';\r\n  SInvalidRomanNumeral = '%s is not a valid Roman numeral';\r\n\r\ntype\r\n  TStringSearchOption = (soDown, soMatchCase, soWholeWord);\r\n  TStringSearchOptions = set of TStringSearchOption;\r\n  TStringSeachOption = TStringSearchOption;\r\n\r\nFunction PosEx(const SubStr, S: string; Offset: SizeUint): SizeInt;\r\nFunction PosEx(const SubStr, S: string): SizeInt; // Offset: Cardinal = 1\r\nFunction PosEx(c:char; const S: string; Offset: SizeUint): SizeInt;\r\nfunction StringsReplace(const S: string; OldPattern, NewPattern: array of string;  Flags: TReplaceFlags): string;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Delphi compat\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction ReplaceStr(const AText, AFromText, AToText: string): string;\r\nFunction ReplaceText(const AText, AFromText, AToText: string): string;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Soundex Functions.\r\n  ---------------------------------------------------------------------}\r\n\r\ntype\r\n  TSoundexLength = 1..MaxInt;\r\n\r\nFunction Soundex(const AText: string; ALength: TSoundexLength): string;\r\nFunction Soundex(const AText: string): string; // ; ALength: TSoundexLength = 4\r\n\r\ntype\r\n  TSoundexIntLength = 1..8;\r\n\r\nFunction SoundexInt(const AText: string; ALength: TSoundexIntLength): Integer;\r\nFunction SoundexInt(const AText: string): Integer; //; ALength: TSoundexIntLength = 4\r\nFunction DecodeSoundexInt(AValue: Integer): string;\r\nFunction SoundexWord(const AText: string): Word;\r\nFunction DecodeSoundexWord(AValue: Word): string;\r\nFunction SoundexSimilar(const AText, AOther: string; ALength: TSoundexLength): Boolean;\r\nFunction SoundexSimilar(const AText, AOther: string): Boolean; //; ALength: TSoundexLength = 4\r\nFunction SoundexCompare(const AText, AOther: string; ALength: TSoundexLength): Integer;\r\nFunction SoundexCompare(const AText, AOther: string): Integer; //; ALength: TSoundexLength = 4\r\nFunction SoundexProc(const AText, AOther: string): Boolean;\r\n\r\ntype\r\n  TCompareTextProc = Function(const AText, AOther: string): Boolean;\r\n\r\nVar\r\n  AnsiResemblesProc: TCompareTextProc;\r\n  ResemblesProc: TCompareTextProc;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Other functions, based on RxStrUtils.\r\n  ---------------------------------------------------------------------}\r\ntype\r\n TRomanConversionStrictness = (rcsStrict, rcsRelaxed, rcsDontCare);\r\n\r\n\r\nfunction IsEmptyStr(const S: string; const EmptyChars: Array of char): Boolean;\r\nfunction DelSpace(const S: string): string;\r\nfunction DelChars(const S: string; Chr: Char): string;\r\nfunction DelSpace1(const S: string): string;\r\nfunction Tab2Space(const S: string; Numb: Byte): string;\r\nfunction NPos(const C: string; S: string; N: Integer): SizeInt;\r\nFunction RPosEX(C:char;const S : String;offs:cardinal):SizeInt; overload;\r\nFunction RPosex (Const Substr : String; Const Source : String;offs:cardinal) : SizeInt; overload;\r\nFunction RPos(c:char;const S : String):SizeInt; overload;\r\nFunction RPos (Const Substr : String; Const Source : String) : SizeInt; overload;\r\nfunction AddChar(C: Char; const S: string; N: Integer): string;\r\nfunction AddCharR(C: Char; const S: string; N: Integer): string;\r\nfunction PadLeft(const S: string; N: Integer): string;\r\nfunction PadRight(const S: string; N: Integer): string;\r\nfunction PadCenter(const S: string; Len: SizeInt): string;\r\nfunction Copy2Symb(const S: string; Symb: Char): string;\r\nfunction Copy2SymbDel(var S: string; Symb: Char): string;\r\nfunction Copy2Space(const S: string): string;\r\nfunction Copy2SpaceDel(var S: string): string;\r\nfunction AnsiProperCase(const S: string; const WordDelims: Array of char): string;\r\nfunction WordCount(const S: string; const WordDelims: Array of char): SizeInt;\r\nfunction WordPosition(const N: Integer; const S: string; const WordDelims: Array of char): SizeInt;\r\nfunction ExtractWord(N: Integer; const S: string;  const WordDelims: Array of char): string;\r\nfunction ExtractWordPos(N: Integer; const S: string; const WordDelims: Array of char; out Pos: Integer): string;\r\nfunction ExtractDelimited(N: Integer; const S: string;  const Delims: Array of char): string;\r\nfunction ExtractSubstr(const S: string; var Pos: Integer;  const Delims: Array of char): string;\r\nfunction IsWordPresent(const W, S: string; const WordDelims: Array of char): Boolean;\r\nfunction FindPart(const HelpWilds, InputStr: string): SizeInt;\r\nfunction IsWild(InputStr, Wilds: string; IgnoreCase: Boolean): Boolean;\r\nfunction XorString(const Key, Src: String): String;\r\nfunction XorEncode(const Key, Source: string): string;\r\nfunction XorDecode(const Key, Source: string): string;\r\nfunction GetCmdLineArg(const Switch: string; SwitchChars: Array of char): string;\r\nfunction Numb2USA(const S: string): string;\r\nfunction Hex2Dec(const S: string): Longint;\r\nfunction Dec2Numb(N: Longint; Len, Base: Byte): string;\r\nfunction Numb2Dec(S: string; Base: Byte): Longint;\r\nfunction IntToBin(Value: Longint; Digits, Spaces: Integer): string;\r\nfunction IntToBin(Value: Longint; Digits: Integer): string;\r\nfunction IntToBin(Value: NativeInt; Digits:integer): string;\r\nfunction IntToRoman(Value: Longint): string;\r\nfunction TryRomanToInt(S: String; out N: LongInt; Strictness: TRomanConversionStrictness = rcsRelaxed): Boolean;\r\nfunction RomanToInt(const S: string; Strictness: TRomanConversionStrictness = rcsRelaxed): Longint;\r\nfunction RomanToIntDef(Const S : String; const ADefault: Longint = 0; Strictness: TRomanConversionStrictness = rcsRelaxed): Longint;\r\n\r\nconst\r\n  DigitChars = ['0'..'9'];\r\n  Brackets = ['(',')','[',']','{','}'];\r\n  StdWordDelims = [#0..' ',',','.',';','/','\\',':','''','\"','`'] + Brackets;\r\n  StdSwitchChars = ['-','/'];\r\n\r\nfunction PosSet (const c:Array of char;const s : String ):SizeInt;\r\nfunction PosSet (const c:string;const s : String ):SizeInt;\r\nfunction PosSetEx (const c:Array of char;const s : String;count:Integer ):SizeInt;\r\nfunction PosSetEx (const c:string;const s : String;count:Integer ):SizeInt;\r\n\r\nProcedure Removeleadingchars(VAR S : String; Const CSet:Array of char);\r\nProcedure RemoveTrailingChars(VAR S : String;Const CSet:Array of char);\r\nProcedure RemovePadChars(VAR S : String;Const CSet:Array of char);\r\n\r\nfunction TrimLeftSet(const S: String;const CSet:Array of char): String;\r\nFunction TrimRightSet(const S: String;const CSet:Array of char): String;\r\nfunction TrimSet(const S: String;const CSet:Array of char): String;\r\n\r\n\r\ntype\r\n  SizeIntArray = array of SizeInt;\r\n\r\n\r\nimplementation\r\n\r\nuses js;\r\n\r\n{ ---------------------------------------------------------------------\r\n   Possibly Exception raising functions\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nfunction Hex2Dec(const S: string): Longint;\r\nvar\r\n  HexStr: string;\r\nbegin\r\n  if Pos('$',S)=0 then\r\n    HexStr:='$'+ S\r\n  else\r\n    HexStr:=S;\r\n  Result:=StrToInt(HexStr);\r\nend;\r\n\r\n{\r\n  We turn off implicit exceptions, since these routines are tested, and it \r\n  saves 20% codesize (and some speed) and don't throw exceptions, except maybe \r\n  heap related. If they don't, that is consider a bug.\r\n\r\n  In the future, be wary with routines that use strtoint, floating point \r\n  and/or format() derivatives. And check every divisor for 0.\r\n}\r\n\r\n{$IMPLICITEXCEPTIONS OFF}\r\n\r\n{ ---------------------------------------------------------------------\r\n    Case insensitive search/replace\r\n  ---------------------------------------------------------------------}\r\nFunction AnsiResemblesText(const AText, AOther: string): Boolean;\r\n\r\nbegin\r\n  if Assigned(AnsiResemblesProc) then\r\n    Result:=AnsiResemblesProc(AText,AOther)\r\n  else\r\n    Result:=False;\r\nend;\r\n\r\nFunction AnsiContainsText(const AText, ASubText: string): Boolean;\r\nbegin\r\n  Result:=Pos(Uppercase(ASubText),Uppercase(AText))>0;\r\nend;\r\n\r\n\r\nFunction AnsiStartsText(const ASubText, AText: string): Boolean;\r\nbegin\r\n  if (Length(AText) >= Length(ASubText)) and (ASubText <> '') then\r\n    Result := SameText(ASubText,Copy(AText,1,Length(ASubText)))\r\n  else\r\n    Result := False;\r\nend;\r\n\r\n\r\nFunction AnsiEndsText(const ASubText, AText: string): Boolean;\r\nbegin\r\n  if Length(AText) >= Length(ASubText) then\r\n    Result := SameText(aSubText,RightStr(aText,Length(ASubText)))\r\n  else\r\n    Result := False;\r\nend;\r\n\r\n\r\nFunction AnsiReplaceText(const AText, AFromText, AToText: string): string;\r\nbegin\r\n  Result := StringReplace(AText,AFromText,AToText,[rfReplaceAll,rfIgnoreCase]);\r\nend;\r\n\r\n\r\nFunction AnsiMatchText(const AText: string; const AValues: array of string): Boolean;\r\nbegin\r\n  Result:=(AnsiIndexText(AText,AValues)<>-1)\r\nend;\r\n\r\n\r\nFunction AnsiIndexText(const AText: string; const AValues: array of string): Integer;\r\n\r\nvar\r\n  i : Integer;\r\n\r\nbegin\r\n  Result:=-1;\r\n  if (high(AValues)=-1) or (High(AValues)>MaxInt) Then\r\n    Exit;\r\n  for i:=low(AValues) to High(Avalues) do\r\n     if CompareText(avalues[i],atext)=0 Then\r\n       exit(i);  // make sure it is the first val.\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Case sensitive search/replace\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction AnsiContainsStr(const AText, ASubText: string): Boolean;\r\nbegin\r\n  Result := Pos(ASubText,AText)>0;\r\nend;\r\n\r\n\r\nFunction AnsiStartsStr(const ASubText, AText: string): Boolean;\r\nbegin\r\n  if (Length(AText) >= Length(ASubText)) and (ASubText <> '') then\r\n    Result := (ASubText=Copy(aText,1,Length(ASubtext)))\r\n  else\r\n    Result := False;\r\nend;\r\n\r\n\r\nFunction AnsiEndsStr(const ASubText, AText: string): Boolean;\r\nbegin\r\n  if Length(AText) >= Length(ASubText) then\r\n    Result := (ASubText=RightStr(aText,Length(ASubText)))\r\n  else\r\n    Result := False;\r\nend;\r\n\r\n\r\nFunction AnsiReplaceStr(const AText, AFromText, AToText: string): string;\r\nbegin\r\n  Result := StringReplace(AText,AFromText,AToText,[rfReplaceAll]);\r\nend;\r\n\r\n\r\nFunction AnsiMatchStr(const AText: string; const AValues: array of string): Boolean;\r\nbegin\r\n  Result:=AnsiIndexStr(AText,Avalues)<>-1;\r\nend;\r\n\r\n\r\nFunction AnsiIndexStr(const AText: string; const AValues: array of string): Integer;\r\nvar\r\n  i : longint;\r\nbegin\r\n  result:=-1;\r\n  if (high(AValues)=-1) or (High(AValues)>MaxInt) Then\r\n    Exit;\r\n  for i:=low(AValues) to High(Avalues) do\r\n     if (avalues[i]=AText) Then\r\n       exit(i);                                 // make sure it is the first val.\r\nend;\r\n\r\n\r\nFunction MatchStr(const AText: String; const AValues: array of String): Boolean;\r\nbegin\r\n  Result := IndexStr(AText,AValues) <> -1;\r\nend;\r\n\r\n\r\nFunction IndexStr(const AText: String; const AValues: array of String): Integer;\r\nvar\r\n  i: longint;\r\nbegin\r\n  Result := -1;\r\n  if (high(AValues) = -1) or (High(AValues) > MaxInt) Then\r\n    Exit;\r\n  for i := low(AValues) to High(Avalues) do\r\n     if (avalues[i] = AText) Then\r\n       exit(i);                                 // make sure it is the first val.\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Playthingies\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DupeString(const AText: string; ACount: Integer): string;\r\n\r\nvar i : SizeInt;\r\n\r\nbegin\r\n result:='';\r\n for i:=1 to ACount do\r\n   Result:=Result+aText;\r\nend;\r\n\r\nFunction ReverseString(const AText: string): string;\r\n\r\nvar\r\n  i,j : SizeInt;\r\n\r\nbegin\r\n  setlength(result,length(atext));\r\n  i:=1; j:=length(atext);\r\n  while (i<=j) do\r\n    begin\r\n    result[i]:=atext[j-i+1];\r\n    inc(i);\r\n    end;\r\nend;\r\n\r\n\r\nFunction AnsiReverseString(const AText: String): String;\r\n\r\nbegin\r\n  Result:=ReverseString(AText);\r\nend;\r\n\r\n\r\nFunction StuffString(const AText: string; AStart, ALength: Cardinal;  const ASubText: string): string;\r\n\r\nvar i,j,k : SizeUInt;\r\n\r\nbegin\r\n  j:=length(ASubText);\r\n  i:=length(AText);\r\n  if AStart>i then \r\n    aStart:=i+1;\r\n  k:=i+1-AStart;\r\n  if ALength> k then\r\n    ALength:=k;\r\n  SetLength(Result,i+j-ALength);\r\n  Result:=Copy(AText,1,AStart-1)+Copy(ASubText,1,J)+Copy(AText,AStart+ALength,I+1-AStart-ALength);\r\nend;\r\n\r\nFunction RandomFrom(const AValues: array of string): string; overload;\r\n\r\nbegin\r\n  if high(AValues)=-1 then exit('');\r\n  result:=Avalues[random(High(AValues)+1)];\r\nend;\r\n\r\nFunction IfThen(AValue: Boolean; const ATrue: string; const AFalse: string = ''): string; overload;\r\n\r\nbegin\r\n  if avalue then\r\n    result:=atrue\r\n  else\r\n    result:=afalse;\r\nend;\r\n\r\nfunction NaturalCompareText(const Str1, Str2: string; const ADecSeparator, AThousandSeparator: String): Integer;\r\n{\r\n NaturalCompareBase compares strings in a collated order and\r\n so numbers are sorted too. It sorts like this:\r\n\r\n 01\r\n 001\r\n 0001\r\n\r\n and\r\n\r\n 0\r\n 00\r\n 000\r\n 000_A\r\n 000_B\r\n\r\n in a intuitive order.\r\n }\r\nvar\r\n  Num1, Num2: double;\r\n  pStr1, pStr2: integer;\r\n  Len1, Len2: SizeInt;\r\n  TextLen1, TextLen2: SizeInt;\r\n  TextStr1: string = '';\r\n  TextStr2: string = '';\r\n  i: SizeInt;\r\n  j: SizeInt;\r\n  \r\n  function Sign(const AValue: sizeint): integer;\r\n\r\n  begin\r\n    If Avalue<0 then\r\n      Result:=-1\r\n    else If Avalue>0 then\r\n      Result:=1\r\n    else\r\n      Result:=0;\r\n  end;\r\n\r\n  function IsNumber(ch: char): boolean;\r\n  begin\r\n    Result := ch in ['0'..'9'];\r\n  end;\r\n\r\n  function GetInteger(aString : String; var pch: integer; var Len: sizeint): double;\r\n\r\n  begin\r\n    Result := 0;\r\n    while (pch<=length(astring)) and IsNumber(AString[pch]) do\r\n      begin\r\n      Result := (Result * 10) + Ord(Astring[pch]) - Ord('0');\r\n      Inc(Len);\r\n      Inc(pch);\r\n      end;\r\n  end;\r\n\r\n  procedure GetChars;\r\n\r\n  begin\r\n    TextLen1 := 0;\r\n    while not (Str1[pStr1 + TextLen1] in ['0'..'9']) and ((pStr1 + TextLen1)<=Length(Str1)) do\r\n      Inc(TextLen1);\r\n    TextStr1:='';\r\n    i := 1;\r\n    j := 0;\r\n    while i <= TextLen1 do\r\n      begin\r\n      TextStr1 := TextStr1+Str1[pStr1 + j];\r\n      Inc(i);\r\n      Inc(j);\r\n      end;\r\n\r\n    TextLen2 := 0;\r\n    while not (Str2[pStr2 + TextLen2] in ['0'..'9']) and ((pStr2 + TextLen2)<=Length(Str2)) do\r\n      Inc(TextLen2);\r\n    i := 1;\r\n    j := 0;\r\n    while i <= TextLen2 do\r\n      begin\r\n      TextStr2 := TextStr2+Str2[pStr2 + j];\r\n      Inc(i);\r\n      Inc(j);\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  if (Str1 <> '') and (Str2 <> '') then\r\n    begin\r\n    pStr1 := 1;\r\n    pStr2 := 1;\r\n    Result := 0;\r\n    while (pStr1<=Length(Str1)) and (pStr2 <=Length(Str2)) do\r\n      begin\r\n      TextLen1 := 1;\r\n      TextLen2 := 1;\r\n      Len1 := 0;\r\n      Len2 := 0;\r\n      while (Str1[pStr1] = ' ') do\r\n      begin\r\n        Inc(pStr1);\r\n        Inc(Len1);\r\n      end;\r\n      while (Str2[pstr2] = ' ') do\r\n        begin\r\n        Inc(pStr2);\r\n        Inc(Len2);\r\n        end;\r\n      if IsNumber(Str1[pStr1]) and IsNumber(Str2[pStr2]) then\r\n        begin\r\n         Num1 := GetInteger(Str1,pStr1, Len1);\r\n         Num2 := GetInteger(Str2, pStr2, Len2);\r\n        if Num1 < Num2 then\r\n          Result := -1\r\n        else if Num1 > Num2 then\r\n          Result := 1\r\n        else\r\n        begin\r\n          Result := Sign(Len1 - Len2);\r\n        end;\r\n        Dec(pStr1);\r\n        Dec(pStr2);\r\n        end\r\n      else\r\n        begin\r\n        GetChars;\r\n        if TextStr1 <> TextStr2 then\r\n          Result := CompareText(TextStr1, TextStr2)\r\n        else\r\n          Result := 0;\r\n        end;\r\n      if Result <> 0 then\r\n        Break;\r\n      Inc(pStr1, TextLen1);\r\n      Inc(pStr2, TextLen2);\r\n      end;\r\n    end;\r\n  Num1:=Length(Str1);\r\n  Num2:=Length(Str2);\r\n  if (Result = 0) and (Num1 <> Num2) then\r\n    begin\r\n    if Num1 < Num2 then\r\n      Result := -1\r\n    else\r\n      Result := 1;\r\n    end;\r\n  if ADecSeparator='' then ;\r\n  if aThousandSeparator='' then ;\r\nend;\r\n\r\nfunction NaturalCompareText (const S1 , S2 : string ): Integer ;\r\nbegin\r\n  Result := NaturalCompareText(S1, S2, DecimalSeparator,ThousandSeparator);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    VB emulations.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction LeftStr(const AText: String; const ACount: SizeInt): String;\r\n\r\nbegin\r\n  Result:=Copy(AText,1,ACount);\r\nend;\r\n\r\nFunction RightStr(const AText: String; const ACount: SizeInt): String;\r\n\r\nvar j,l:SizeInt;\r\n\r\nbegin\r\n  l:=length(atext);\r\n  j:=ACount;\r\n  if j>l then j:=l;\r\n  Result:=Copy(AText,l-j+1,j);\r\nend;\r\n\r\nFunction MidStr(const AText: String; const AStart, ACount: SizeInt): String;\r\n\r\nbegin\r\n  if (ACount=0) or (AStart>length(atext)) then\r\n    exit('');\r\n  Result:=Copy(AText,AStart,ACount);\r\nend;\r\n\r\n\r\n\r\nFunction LeftBStr(const AText: String; const AByteCount: SizeInt): String;\r\n\r\nbegin\r\n  Result:=LeftStr(AText,AByteCount);\r\nend;\r\n\r\n\r\nFunction RightBStr(const AText: String; const AByteCount: SizeInt): String;\r\nbegin\r\n  Result:=RightStr(Atext,AByteCount);\r\nend;\r\n\r\n\r\nFunction MidBStr(const AText: String; const AByteStart, AByteCount: SizeInt): String;\r\nbegin\r\n  Result:=MidStr(AText,AByteStart,AByteCount);\r\nend;\r\n\r\n\r\nFunction AnsiLeftStr(const AText: String; const ACount: SizeInt): String;\r\nbegin\r\n  Result := copy(AText,1,ACount);\r\nend;\r\n\r\n\r\nFunction AnsiRightStr(const AText: String; const ACount: SizeInt): String;\r\nbegin\r\n  Result := copy(AText,length(AText)-ACount+1,ACount);\r\nend;\r\n\r\n\r\nFunction AnsiMidStr(const AText: String; const AStart, ACount: SizeInt): String;\r\nbegin\r\n  Result:=Copy(AText,AStart,ACount);\r\nend;\r\n\r\n\r\nFunction PosEx(const SubStr, S: string; Offset: SizeUint): SizeInt;\r\n\r\n\r\nbegin\r\n  result:=TJSString.New(S).IndexOf(SubStr,offset-1)+1;\r\nend;\r\n\r\nFunction PosEx(c:char; const S: string; Offset: SizeUint): SizeInt;\r\nbegin\r\n  result:=TJSString.New(S).IndexOf(c,offset-1)+1;\r\nend;\r\n\r\nFunction PosEx(const SubStr, S: string): SizeInt; // Offset: Cardinal = 1\r\n\r\nbegin\r\n  Result:=posex(substr,s,1);\r\nend;\r\n\r\n\r\nfunction StringsReplace(const S: string; OldPattern, NewPattern: array of string;  Flags: TReplaceFlags): string;\r\n\r\nvar pc,pcc,lastpc : integer;\r\n    strcount      : integer;\r\n    ResStr,\r\n    CompStr       : string;\r\n    Found         : Boolean;\r\n    sc            : sizeint;\r\n\r\nbegin\r\n  sc := length(OldPattern);\r\n  if sc <> length(NewPattern) then\r\n    raise exception.Create(SErrAmountStrings);\r\n\r\n  dec(sc);\r\n\r\n  if rfIgnoreCase in Flags then\r\n    begin\r\n    CompStr:=UpperCase(S);\r\n    for strcount := 0 to sc do\r\n      OldPattern[strcount] := UpperCase(OldPattern[strcount]);\r\n    end\r\n  else\r\n    CompStr := s;\r\n\r\n  ResStr := '';\r\n  pc := 1;\r\n  pcc := 1;\r\n  lastpc := pc+Length(S);\r\n\r\n  while pc < lastpc do\r\n    begin\r\n    Found := False;\r\n    for strcount := 0 to sc do\r\n      begin\r\n      if (Copy(compStr,pc,Length(OldPattern[strcount]))=OldPattern[strcount]) then\r\n        begin\r\n        ResStr := ResStr + NewPattern[strcount];\r\n        pc := pc+Length(OldPattern[strcount]);\r\n        pcc := pcc+Length(OldPattern[strcount]);\r\n        Found := true;\r\n        end\r\n      end;\r\n    if not found then\r\n      begin\r\n      ResStr := ResStr + S[pcc];\r\n      inc(pc);\r\n      inc(pcc);\r\n      end\r\n    else if not (rfReplaceAll in Flags) then\r\n      begin\r\n      ResStr := ResStr + copy(S,pcc,Length(S)-pcc+1);\r\n      break;\r\n      end;\r\n    end;\r\n  Result := ResStr;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Delphi compat\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction ReplaceStr(const AText, AFromText, AToText: string): string;\r\nbegin\r\n  result:=AnsiReplaceStr(AText, AFromText, AToText);\r\nend;\r\n\r\nFunction ReplaceText(const AText, AFromText, AToText: string): string;\r\nbegin\r\n  result:=AnsiReplaceText(AText, AFromText, AToText);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Soundex Functions.\r\n  ---------------------------------------------------------------------}\r\nVar\r\n  SScore : String =\r\n      '00000000000000000000000000000000'+ // 1..32\r\n      '00000000000000000000000000000000'+ // 33..64\r\n      '0123012i02245501262301i2i2'+ // 65..90\r\n      '000000'+ // 91..96\r\n      '0123012i02245501262301i2i2'+ // 97..122\r\n      '00000000000000000000000000000000'+ // 123..154\r\n      '00000000000000000000000000000000'+ // 155..186\r\n      '00000000000000000000000000000000'+ // 187..218\r\n      '00000000000000000000000000000000'+ // 219..250\r\n      '00000'; // 251..255\r\n\r\nFunction Soundex(const AText: string; ALength: TSoundexLength): string;\r\n\r\nVar\r\n  S,PS : Char;\r\n  I,L : SizeInt;\r\n\r\nbegin\r\n  Result:='';\r\n  PS:=#0;\r\n  If Length(AText)>0 then\r\n    begin\r\n    Result:=Upcase(AText[1]);\r\n    I:=2;\r\n    L:=Length(AText);\r\n    While (I<=L) and (Length(Result)<ALength) do\r\n      begin\r\n      S:=SScore[Ord(AText[i])];\r\n      If Not (S in ['0','i',PS]) then\r\n        Result:=Result+S;\r\n      If (S<>'i') then\r\n        PS:=S;\r\n      Inc(I);\r\n      end;\r\n    end;\r\n  L:=Length(Result);\r\n  If (L<ALength) then\r\n    Result:=Result+StringOfChar('0',Alength-L);\r\nend;\r\n\r\n\r\n\r\nFunction Soundex(const AText: string): string; // ; ALength: TSoundexLength = 4\r\n\r\nbegin\r\n  Result:=Soundex(AText,4);\r\nend;\r\n\r\nConst\r\n  Ord0 = Ord('0');\r\n  OrdA = Ord('A');\r\n\r\nFunction SoundexInt(const AText: string; ALength: TSoundexIntLength): Integer;\r\n\r\nvar\r\n  SE: string;\r\n  I: SizeInt;\r\n\r\nbegin\r\n  Result:=-1;\r\n  SE:=Soundex(AText,ALength);\r\n  If Length(SE)>0 then\r\n    begin\r\n    Result:=Ord(SE[1])-OrdA;\r\n    if ALength > 1 then\r\n      begin\r\n      Result:=Result*26+(Ord(SE[2])-Ord0);\r\n      for I:=3 to ALength do\r\n        Result:=(Ord(SE[I])-Ord0)+Result*7;\r\n      end;\r\n    Result:=ALength+Result*9;\r\n    end;\r\nend;\r\n\r\n\r\nFunction SoundexInt(const AText: string): Integer; //; ALength: TSoundexIntLength = 4\r\nbegin\r\n  Result:=SoundexInt(AText,4);\r\nend;\r\n\r\n\r\nFunction DecodeSoundexInt(AValue: Integer): string;\r\n\r\nvar\r\n  I, Len: Integer;\r\n\r\nbegin\r\n  Result := '';\r\n  Len := AValue mod 9;\r\n  AValue := AValue div 9;\r\n  for I:=Len downto 3 do\r\n    begin\r\n    Result:=Chr(Ord0+(AValue mod 7))+Result;\r\n    AValue:=AValue div 7;\r\n    end;\r\n  if Len>1 then\r\n    begin\r\n    Result:=Chr(Ord0+(AValue mod 26))+Result;\r\n    AValue:=AValue div 26;\r\n    end;\r\n  Result:=Chr(OrdA+AValue)+Result;\r\nend;\r\n\r\n\r\nFunction SoundexWord(const AText: string): Word;\r\n\r\nVar\r\n  S : String;\r\n\r\nbegin\r\n  S:=SoundEx(Atext,4);\r\n  Result:=Ord(S[1])-OrdA;\r\n  Result:=Result*26+ord(S[2])-48;\r\n  Result:=Result*7+ord(S[3])-48;\r\n  Result:=Result*7+ord(S[4])-48;\r\nend;\r\n\r\n\r\nFunction DecodeSoundexWord(AValue: Word): string;\r\nbegin\r\n  Result := Chr(Ord0+ (AValue mod 7));\r\n  AValue := AValue div 7;\r\n  Result := Chr(Ord0+ (AValue mod 7)) + Result;\r\n  AValue := AValue div 7;\r\n  Result := IntToStr(AValue mod 26) + Result;\r\n  AValue := AValue div 26;\r\n  Result := Chr(OrdA+AValue) + Result;\r\nend;\r\n\r\n\r\nFunction SoundexSimilar(const AText, AOther: string; ALength: TSoundexLength): Boolean;\r\nbegin\r\n  Result:=Soundex(AText,ALength)=Soundex(AOther,ALength);\r\nend;\r\n\r\n\r\nFunction SoundexSimilar(const AText, AOther: string): Boolean; //; ALength: TSoundexLength = 4\r\nbegin\r\n  Result:=SoundexSimilar(AText,AOther,4);\r\nend;\r\n\r\n\r\nFunction SoundexCompare(const AText, AOther: string; ALength: TSoundexLength): Integer;\r\nbegin\r\n  Result:=AnsiCompareStr(Soundex(AText,ALength),Soundex(AOther,ALength));\r\nend;\r\n\r\n\r\nFunction SoundexCompare(const AText, AOther: string): Integer; //; ALength: TSoundexLength = 4\r\nbegin\r\n  Result:=SoundexCompare(AText,AOther,4);\r\nend;\r\n\r\n\r\nFunction SoundexProc(const AText, AOther: string): Boolean;\r\nbegin\r\n  Result:=SoundexSimilar(AText,AOther);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    RxStrUtils-like functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\n\r\nfunction IsEmptyStr(const S: string; const EmptyChars: Array of char): Boolean;\r\n\r\nvar\r\n  i,l: SizeInt;\r\n\r\nbegin\r\n  l:=Length(S);\r\n  i:=1;\r\n  Result:=True;\r\n  while Result and (i<=l) do\r\n    begin\r\n    Result:=CharInSet(S[i],EmptyChars);\r\n    Inc(i);\r\n    end;\r\nend;\r\n\r\nfunction DelSpace(const S: String): string;\r\n\r\nbegin\r\n  Result:=DelChars(S,' ');\r\nend;\r\n\r\nfunction DelChars(const S: string; Chr: Char): string;\r\n\r\nvar\r\n  I,J: SizeInt;\r\n\r\nbegin\r\n  Result:=S;\r\n  I:=Length(Result);\r\n  While I>0 do\r\n    begin\r\n    if Result[I]=Chr then\r\n      begin\r\n      J:=I-1;\r\n      While (J>0) and (Result[J]=Chr) do\r\n        Dec(j);\r\n      Delete(Result,J+1,I-J);\r\n      I:=J+1;\r\n      end;\r\n    dec(I);\r\n    end;\r\nend;\r\n\r\nfunction DelSpace1(const S: string): string;\r\n\r\nvar\r\n  I : SizeInt;\r\n\r\nbegin\r\n  Result:=S;\r\n  for i:=Length(Result) downto 2 do\r\n    if (Result[i]=' ') and (Result[I-1]=' ') then\r\n      Delete(Result,I,1);\r\nend;\r\n\r\nfunction Tab2Space(const S: string; Numb: Byte): string;\r\n\r\nvar\r\n  I: SizeInt;\r\n\r\nbegin\r\n  I:=1;\r\n  Result:=S;\r\n  while I <= Length(Result) do\r\n    if Result[I]<>Chr(9) then\r\n      inc(I)\r\n    else\r\n      begin\r\n      Result[I]:=' ';\r\n      If (Numb>1) then\r\n        Insert(StringOfChar(' ',Numb-1),Result,I);\r\n      Inc(I,Numb);\r\n      end;\r\nend;\r\n\r\nfunction NPos(const C: string; S: string; N: Integer): SizeInt;\r\n\r\nvar\r\n  i,p,k: SizeInt;\r\n\r\nbegin\r\n  Result:=0;\r\n  if N<1 then\r\n    Exit;\r\n  k:=0;\r\n  i:=1;\r\n  Repeat\r\n    p:=pos(C,S);\r\n    Inc(k,p);\r\n    if p>0 then\r\n      delete(S,1,p);\r\n    Inc(i);\r\n  Until (i>n) or (p=0);\r\n  If (P>0) then\r\n    Result:=K;\r\nend;\r\n\r\nfunction AddChar(C: Char; const S: string; N: Integer): string;\r\n\r\nVar\r\n  l : SizeInt;\r\n\r\nbegin\r\n  Result:=S;\r\n  l:=Length(Result);\r\n  if l<N then\r\n    Result:=StringOfChar(C,N-l)+Result;\r\nend;\r\n\r\nfunction AddCharR(C: Char; const S: string; N: Integer): string;\r\n\r\nVar\r\n  l : SizeInt;\r\n\r\nbegin\r\n  Result:=S;\r\n  l:=Length(Result);\r\n  if l<N then\r\n    Result:=Result+StringOfChar(C,N-l);\r\nend;\r\n\r\n\r\nfunction PadRight(const S: string; N: Integer): string;\r\nbegin\r\n  Result:=AddCharR(' ',S,N);\r\nend;\r\n\r\n\r\nfunction PadLeft(const S: string; N: Integer): string;\r\nbegin\r\n  Result:=AddChar(' ',S,N);\r\nend;\r\n\r\n\r\nfunction Copy2Symb(const S: string; Symb: Char): string;\r\n\r\nvar\r\n  p: SizeInt;\r\n\r\nbegin\r\n  p:=Pos(Symb,S);\r\n  if p=0 then\r\n    p:=Length(S)+1;\r\n  Result:=Copy(S,1,p-1);\r\nend;\r\n\r\nfunction Copy2SymbDel(var S: string; Symb: Char): string;\r\n\r\nvar\r\n  p: SizeInt;\r\n\r\nbegin\r\n  p:=Pos(Symb,S);\r\n  if p=0 then\r\n    begin\r\n      result:=s;\r\n      s:='';\r\n    end\r\n  else\r\n    begin\t\r\n      Result:=Copy(S,1,p-1);\r\n      delete(s,1,p);\t\t\r\n    end;\r\nend;\r\n\r\nfunction Copy2Space(const S: string): string;\r\nbegin\r\n  Result:=Copy2Symb(S,' ');\r\nend;\r\n\r\nfunction Copy2SpaceDel(var S: string): string;\r\nbegin\r\n  Result:=Copy2SymbDel(S,' ');\r\nend;\r\n\r\nfunction AnsiProperCase(const S: string; const WordDelims: Array of char): string;\r\n\r\nvar\r\n  P,L : Integer;\r\n\r\nbegin\r\n  Result:=LowerCase(S);\r\n  P:=1;\r\n  L:=Length(Result);\r\n  while (P<=L) do\r\n    begin\r\n    while (P<=L) and (CharInSet(Result[P],WordDelims)) do\r\n      inc(P);\r\n    if (P<=L) then\r\n      Result[P]:=UpCase(Result[P]);\r\n    while (P<=L) and not CharInSet(Result[P],WordDelims) do\r\n      inc(P);\r\n    end;\r\nend;\r\n\r\nfunction WordCount(const S: string; const WordDelims: Array of char): SizeInt;\r\n\r\nvar\r\n  P,L : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  P:=1;\r\n  L:=Length(S);\r\n  while (P<=L) do\r\n    begin\r\n    while (P<=L) and (CharInSet(S[P],WordDelims)) do\r\n      Inc(P);\r\n    if (P<=L) then\r\n      inc(Result);\r\n    while (P<=L) and not (CharInSet(S[P],WordDelims)) do\r\n      inc(P);\r\n    end;\r\nend;\r\n\r\nfunction WordPosition(const N: Integer; const S: string; const WordDelims: Array of char): SizeInt;\r\n\r\nvar\r\n  PS,P,PE,Count : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  Count:=0;\r\n  PS:=1;\r\n  PE:=Length(S);\r\n  P:=PS;\r\n  while (P<=PE) and (Count<>N) do\r\n    begin\r\n    while (P<=PE) and CharInSet(S[P],WordDelims) do\r\n      inc(P);\r\n    if (P<=PE) then\r\n      inc(Count);\r\n    if (Count<>N) then\r\n      while (P<=PE) and not CharInSet(S[P],WordDelims) do\r\n        inc(P)\r\n    else\r\n      Result:=(P-PS)+1;\r\n    end;\r\nend;\r\n\r\n\r\nfunction ExtractWord(N: Integer; const S: string; const WordDelims: Array of char): string;\r\nvar\r\n  i: LongInt;\r\nbegin\r\n  Result:=ExtractWordPos(N,S,WordDelims,i);\r\nend;\r\n\r\n\r\nfunction ExtractWordPos(N: Integer; const S: string; const WordDelims: Array of char; out Pos: Integer): string;\r\n\r\nvar\r\n  i,j,l: SizeInt;\r\n\r\nbegin\r\n  j:=0;\r\n  i:=WordPosition(N, S, WordDelims);\r\n  if (I>MaxInt) then\r\n    begin\r\n    Result:='';\r\n    Pos:=-1;\r\n    Exit;\r\n    end;\r\n  Pos:=i;\r\n  if (i<>0) then\r\n    begin\r\n    j:=i;\r\n    l:=Length(S);\r\n    while (j<=L) and not CharInSet(S[j],WordDelims) do\r\n      inc(j);\r\n    end;\r\n  Result:=Copy(S,I,j-I);\r\nend;\r\n\r\n\r\nfunction ExtractDelimited(N: Integer; const S: string; const Delims: Array of char): string;\r\nvar\r\n  w,i,l,len: SizeInt;\r\nbegin\r\n  w:=0;\r\n  i:=1;\r\n  l:=0;\r\n  len:=Length(S);\r\n  SetLength(Result, 0);\r\n  while (i<=len) and (w<>N) do\r\n    begin\r\n    if CharInSet(S[i],Delims) then\r\n      inc(w)\r\n    else\r\n      begin\r\n      if (N-1)=w then\r\n        begin\r\n        inc(l);\r\n        Result:=Result+S[i];\r\n        end;\r\n      end;\r\n    inc(i);\r\n    end;\r\nend;\r\n\r\n\r\nfunction ExtractSubstr(const S: string; var Pos: Integer; const Delims: Array of char): string;\r\n\r\nvar\r\n  i,l: SizeInt;\r\n\r\nbegin\r\n  i:=Pos;\r\n  l:=Length(S);\r\n  while (i<=l) and not CharInSet(S[i],Delims) do\r\n    inc(i);\r\n  Result:=Copy(S,Pos,i-Pos);\r\n  while (i<=l) and CharInSet(S[i],Delims) do\r\n    inc(i);\r\n  if I>MaxInt then\r\n    Pos:=MaxInt\r\n  else\r\n    Pos:=i;\r\nend;\r\n\r\nfunction isWordPresent(const W, S: string; const WordDelims: Array of char): Boolean;\r\n\r\nvar\r\n  i,Count : SizeInt;\r\n\r\nbegin\r\n  Result:=False;\r\n  Count:=WordCount(S, WordDelims);\r\n  I:=1;\r\n  While (Not Result) and (I<=Count) do\r\n    begin\r\n    Result:=ExtractWord(i,S,WordDelims)=W;\r\n    Inc(i);\r\n    end;\r\nend;\r\n\r\n\r\nfunction Numb2USA(const S: string): string;\r\nvar\r\n  i, NA: Integer;\r\nbegin\r\n  i:=Length(S);\r\n  Result:=S;\r\n  NA:=0;\r\n  while (i > 0) do begin\r\n    if ((Length(Result) - i + 1 - NA) mod 3 = 0) and (i <> 1) then\r\n    begin\r\n      insert(',', Result, i);\r\n      inc(NA);\r\n    end;\r\n    Dec(i);\r\n  end;\r\nend;\r\n\r\nfunction PadCenter(const S: string; Len: SizeInt): string;\r\nbegin\r\n  if Length(S)<Len then\r\n    begin\r\n    Result:=StringOfChar(' ',(Len div 2) -(Length(S) div 2))+S;\r\n    Result:=Result+StringOfChar(' ',Len-Length(Result));\r\n    end\r\n  else\r\n    Result:=S;\r\nend;\r\n\r\n\r\nfunction Dec2Numb(N: Longint; Len, Base: Byte): string;\r\n\r\nvar\r\n  C: Integer;\r\n  Number: Longint;\r\n\r\nbegin\r\n  if N=0 then\r\n    Result:='0'\r\n  else\r\n    begin\r\n    Number:=N;\r\n    Result:='';\r\n    while Number>0 do\r\n      begin\r\n      C:=Number mod Base;\r\n      if C>9 then\r\n        C:=C+55\r\n      else\r\n        C:=C+48;\r\n      Result:=Chr(C)+Result;\r\n      Number:=Number div Base;\r\n      end;\r\n    end;\r\n  if (Result<>'') then\r\n    Result:=AddChar('0',Result,Len);\r\nend;\r\n\r\nfunction Numb2Dec(S: string; Base: Byte): Longint;\r\n\r\nvar\r\n  i, P: sizeint;\r\n\r\nbegin\r\n  i:=Length(S);\r\n  Result:=0;\r\n  S:=UpperCase(S);\r\n  P:=1;\r\n  while (i>=1) do\r\n    begin\r\n    if (S[i]>'@') then\r\n      Result:=Result+(Ord(S[i])-55)*P\r\n    else\r\n      Result:=Result+(Ord(S[i])-48)*P;\r\n    Dec(i);\r\n    P:=P*Base;\r\n    end;\r\nend;\r\n\r\nFunction RomanValues(C : Char) : Word;\r\n\r\nbegin\r\n  Case c of\r\n    'C' : Result:=100;\r\n    'D' : Result:=500;\r\n    'I' : Result:=1;\r\n    'L' : Result:=50;\r\n    'M' : Result:=1000;\r\n    'V' : Result:=5;\r\n    'X' : Result:=10;\r\n  else\r\n    Result:=0;\r\n  end;\r\nend;\r\n\r\nfunction RomanToIntDontCare(const S: String): Longint;\r\n{This was the original implementation of RomanToInt,\r\n it is internally used in TryRomanToInt when Strictness = rcsDontCare}\r\nconst\r\n  RomanChars  = ['C','D','I','L','M','V','X'];\r\n\r\nvar\r\n  index, Next: Char;\r\n  i,l: SizeInt;\r\n  Negative: Boolean;\r\n\r\nbegin\r\n  Result:=0;\r\n  i:=0;\r\n  Negative:=(Length(S)>0) and (S[1]='-');\r\n  if Negative then\r\n    inc(i);\r\n  l:=Length(S);\r\n  while (i<l) do\r\n    begin\r\n    inc(i);\r\n    index:=UpCase(S[i]);\r\n    if index in RomanChars then\r\n      begin\r\n      if (i+1)<=l then\r\n        Next:=UpCase(S[i+1])\r\n      else\r\n        Next:=#0;\r\n      if (Next in RomanChars) and (RomanValues(index)<RomanValues(Next)) then\r\n        begin\r\n        inc(Result, RomanValues(Next));\r\n        Dec(Result, RomanValues(index));\r\n        inc(i);\r\n        end\r\n      else\r\n        inc(Result, RomanValues(index));\r\n      end\r\n    else\r\n      begin\r\n      Result:=0;\r\n      Exit;\r\n      end;\r\n    end;\r\n  if Negative then\r\n    Result:=-Result;\r\nend;\r\n\r\n\r\n{ TryRomanToInt: try to convert a roman numeral to an integer\r\n  Parameters:\r\n  S: Roman numeral (like: 'MCMXXII')\r\n  N: Integer value of S (only meaningfull if the function succeeds)\r\n  Stricness: controls how strict the parsing of S is\r\n    - rcsStrict:\r\n      * Follow common subtraction rules\r\n         - only 1 preceding subtraction character allowed: IX = 9, but IIX <> 8\r\n         - from M you can only subtract C\r\n         - from D you can only subtract C\r\n         - from C you can only subtract X\r\n         - from L you can only subtract X\r\n         - from X you can only subtract I\r\n         - from V you can only subtract I\r\n      *  The numeral is parsed in \"groups\" (first M's, then D's etc.), the next group to be parsed\r\n         must always be of a lower denomination than the previous one.\r\n         Example: 'MMDCCXX' is allowed but 'MMCCXXDD' is not\r\n      * There can only ever be 3 consecutive M's, C's, X's or I's\r\n      * There can only ever be 1 D, 1 L and 1 V\r\n      * After IX or IV there can be no more characters\r\n      * Negative numbers are not supported\r\n      // As a consequence the maximum allowed Roman numeral is MMMCMXCIX = 3999, also N can never become 0 (zero)\r\n\r\n    - rcsRelaxed: Like rcsStrict but with the following exceptions:\r\n      * An infinite number of (leading) M's is allowed\r\n      * Up to 4 consecutive M's, C's, X's and I's are allowed\r\n      // So this is allowed: 'MMMMMMCXIIII'  = 6124\r\n\r\n    - rcsDontCare:\r\n      * no checking on the order of \"groups\" is done\r\n      * there are no restrictions on the number of consecutive chars\r\n      * negative numbers are supported\r\n      * an empty string as input will return True and N will be 0\r\n      * invalid input will return false\r\n      // for backwards comatibility: it supports rather ludicrous input like '-IIIMIII' -> -(2+(1000-1)+3)=-1004\r\n}\r\n\r\nfunction TryRomanToInt(S: String; out N: LongInt; Strictness: TRomanConversionStrictness = rcsRelaxed): Boolean;\r\n\r\nvar\r\n  i, Len: SizeInt;\r\n  Terminated: Boolean;\r\n\r\nbegin\r\n  Result := (False);\r\n  S := UpperCase(S);  //don't use AnsiUpperCase please\r\n  Len := Length(S);\r\n  if (Strictness = rcsDontCare) then\r\n  begin\r\n    N := RomanToIntDontCare(S);\r\n    if (N = 0) then\r\n    begin\r\n      Result := (Len = 0);\r\n    end\r\n    else\r\n      Result := True;\r\n    Exit;\r\n  end;\r\n  if (Len = 0) then Exit;\r\n  i := 1;\r\n  N := 0;\r\n  Terminated := False;\r\n  //leading M's\r\n  while (i <= Len) and ((Strictness <> rcsStrict) or (i < 4)) and (S[i] = 'M') do\r\n  begin\r\n    //writeln('TryRomanToInt: Found 1000');\r\n    Inc(i);\r\n    N := N + 1000;\r\n  end;\r\n  //then CM or or CD or D or (C, CC, CCC, CCCC)\r\n  if (i <= Len) and (S[i] = 'D') then\r\n  begin\r\n    //writeln('TryRomanToInt: Found 500');\r\n    Inc(i);\r\n    N := N + 500;\r\n  end\r\n  else if (i + 1 <= Len) and (S[i] = 'C') then\r\n  begin\r\n    if (S[i+1] = 'M') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 900');\r\n      Inc(i,2);\r\n      N := N + 900;\r\n    end\r\n    else if (S[i+1] = 'D') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 400');\r\n      Inc(i,2);\r\n      N := N + 400;\r\n    end;\r\n  end ;\r\n  //next max 4 or 3 C's, depending on Strictness\r\n  if (i <= Len) and (S[i] = 'C') then\r\n  begin\r\n    //find max 4 C's\r\n    //writeln('TryRomanToInt: Found 100');\r\n    Inc(i);\r\n    N := N + 100;\r\n    if (i <= Len) and (S[i] = 'C') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 100');\r\n      Inc(i);\r\n      N := N + 100;\r\n    end;\r\n    if (i <= Len) and (S[i] = 'C') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 100');\r\n      Inc(i);\r\n      N := N + 100;\r\n    end;\r\n    if (Strictness <> rcsStrict) and (i <= Len) and (S[i] = 'C') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 100');\r\n      Inc(i);\r\n      N := N + 100;\r\n    end;\r\n  end;\r\n\r\n  //then XC or XL\r\n  if (i + 1 <= Len) and (S[i] = 'X') then\r\n  begin\r\n    if (S[i+1] = 'C') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 90');\r\n      Inc(i,2);\r\n      N := N + 90;\r\n    end\r\n    else if  (S[i+1] = 'L') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 40');\r\n      Inc(i,2);\r\n      N := N + 40;\r\n    end;\r\n  end;\r\n\r\n  //then L\r\n  if (i <= Len) and (S[i] = 'L') then\r\n  begin\r\n    //writeln('TryRomanToInt: Found 50');\r\n    Inc(i);\r\n    N := N + 50;\r\n  end;\r\n\r\n  //then (X, xx, xxx, xxxx)\r\n  if (i <= Len) and (S[i] = 'X') then\r\n  begin\r\n    //find max 3 or 4 X's, depending on Strictness\r\n    //writeln('TryRomanToInt: Found 10');\r\n    Inc(i);\r\n    N := N + 10;\r\n    if (i <= Len) and (S[i] = 'X') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 10');\r\n      Inc(i);\r\n      N := N + 10;\r\n    end;\r\n    if (i <= Len) and (S[i] = 'X') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 10');\r\n      Inc(i);\r\n      N := N + 10;\r\n    end;\r\n    if (Strictness <> rcsStrict) and (i <= Len) and (S[i] = 'X') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 10');\r\n      Inc(i);\r\n      N := N + 10;\r\n    end;\r\n  end;\r\n\r\n  //then IX or IV\r\n  if (i + 1 <= Len) and (S[i] = 'I') then\r\n  begin\r\n    if (S[i+1] = 'X') then\r\n    begin\r\n      Terminated := (True);\r\n      //writeln('TryRomanToInt: Found 9');\r\n      Inc(i,2);\r\n      N := N + 9;\r\n    end\r\n    else if (S[i+1] = 'V') then\r\n    begin\r\n      Terminated := (True);\r\n      //writeln('TryRomanToInt: Found 4');\r\n      Inc(i,2);\r\n      N := N + 4;\r\n    end;\r\n  end;\r\n\r\n  //then V\r\n  if (not Terminated) and (i <= Len) and (S[i] = 'V') then\r\n  begin\r\n    //writeln('TryRomanToInt: Found 5');\r\n    Inc(i);\r\n    N := N + 5;\r\n  end;\r\n\r\n\r\n  //then I\r\n  if (not Terminated) and (i <= Len) and (S[i] = 'I') then\r\n  begin\r\n    Terminated := (True);\r\n    //writeln('TryRomanToInt: Found 1');\r\n    Inc(i);\r\n    N := N + 1;\r\n    //Find max 2 or 3 closing I's, depending on strictness\r\n    if (i <= Len) and (S[i] = 'I') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 1');\r\n      Inc(i);\r\n      N := N + 1;\r\n    end;\r\n    if (i <= Len) and (S[i] = 'I') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 1');\r\n      Inc(i);\r\n      N := N + 1;\r\n    end;\r\n    if (Strictness <> rcsStrict) and (i <= Len) and (S[i] = 'I') then\r\n    begin\r\n      //writeln('TryRomanToInt: Found 1');\r\n      Inc(i);\r\n      N := N + 1;\r\n    end;\r\n  end;\r\n\r\n  //writeln('TryRomanToInt: Len = ',Len,' i = ',i);\r\n  Result := (i > Len);\r\n  //if Result then writeln('TryRomanToInt: N = ',N);\r\n\r\nend;\r\n\r\nfunction RomanToInt(const S: string; Strictness: TRomanConversionStrictness = rcsRelaxed): Longint;\r\nbegin\r\n  if not TryRomanToInt(S, Result, Strictness) then\r\n    raise EConvertError.CreateFmt(SInvalidRomanNumeral,[S]);\r\nend;\r\n\r\nfunction RomanToIntDef(const S: String; const ADefault: Longint;\r\n  Strictness: TRomanConversionStrictness): Longint;\r\nbegin\r\n  if not TryRomanToInt(S, Result, Strictness) then\r\n    Result := ADefault;\r\nend;\r\n\r\n\r\n\r\n\r\nfunction intToRoman(Value: Longint): string;\r\n\r\nconst\r\n  Arabics : Array[1..13] of Integer\r\n          = (1,4,5,9,10,40,50,90,100,400,500,900,1000);\r\n  Romans  :  Array[1..13] of String\r\n          = ('I','IV','V','IX','X','XL','L','XC','C','CD','D','CM','M');\r\n\r\nvar\r\n  i: Integer;\r\n\r\nbegin\r\n  Result:='';\r\n  for i:=13 downto 1 do\r\n    while (Value >= Arabics[i]) do\r\n      begin\r\n        Value:=Value-Arabics[i];\r\n        Result:=Result+Romans[i];\r\n      end;\r\nend;\r\n\r\nfunction intToBin(Value: Longint; Digits, Spaces: Integer): string;\r\n\r\nvar endpos : integer;\r\n    p,p2: integer;\r\n    k: integer;\r\n\r\nbegin\r\n  Result:='';\r\n  if (Digits>32) then\r\n    Digits:=32;\r\n  if (spaces=0) then\r\n   begin\r\n     result:=inttobin(value,digits);\r\n     exit;\r\n   end;\r\n  endpos:=digits+ (digits-1) div spaces;\r\n  setlength(result,endpos);\r\n  p:=endpos;\r\n  p2:=1;\r\n  k:=spaces;\r\n  while (p>=p2) do\r\n    begin\r\n      if k=0 then\r\n       begin\r\n         Result[p]:=' ';\r\n         dec(p);\r\n         k:=spaces;\r\n       end;\r\n      Result[P]:=chr(48+(cardinal(value) and 1));\r\n      value:=cardinal(value) shr 1;\r\n      dec(p); \r\n      dec(k);\r\n   end;\r\nend;\r\n\r\nfunction intToBin(Value: Longint; Digits:integer): string;\r\n\r\nvar\r\n    p,p2 : integer;\r\n\r\nbegin\r\n  result:='';\r\n  if digits<=0 then exit;\r\n  setlength(result,digits);\r\n  p:=digits;\r\n  p2:=1;\r\n  // typecasts because we want to keep intto* delphi compat and take an integer\r\n  while (p>=p2) and (cardinal(value)>0) do     \r\n    begin\r\n       Result[p]:=chr(48+(cardinal(value) and 1));\r\n       value:=cardinal(value) shr 1;\r\n       dec(p); \r\n    end;\r\n  digits:=p-p2+1;\r\n  While digits>0 do\r\n    begin\r\n    Result[Digits]:=Chr(48);\r\n    Dec(Digits);\r\n    end;\r\nend;\r\n\r\nfunction IntToBin(Value: NativeInt; Digits:integer): string;\r\nvar\r\n      p,p2 : integer;\r\nbegin\r\n  result:='';\r\n  if digits<=0 then exit;\r\n  setlength(result,digits);\r\n  p:=digits;\r\n  p2:=1;\r\n  // typecasts because we want to keep intto* delphi compat and take a signed val\r\n  // and avoid warnings\r\n  while (p>=p2) and (value>0) do\r\n    begin\r\n       Result[p]:=chr(48+(cardinal(value) and 1));\r\n       value:=value div 2;\r\n       dec(p); \r\n    end;\r\n  digits:=p-p2+1;\r\n  While digits>0 do\r\n    result[digits]:=#48;\r\nend;\r\n\r\n\r\nfunction FindPart(const HelpWilds, inputStr: string): SizeInt;\r\nvar\r\n  Diff, i, J: SizeInt;\r\n\r\nbegin\r\n  Result:=0;\r\n  i:=Pos('?',HelpWilds);\r\n  if (i=0) then\r\n    Result:=Pos(HelpWilds, inputStr)\r\n  else\r\n    begin\r\n    Diff:=Length(inputStr) - Length(HelpWilds);\r\n    for i:=0 to Diff do\r\n      begin\r\n      for J:=1 to Length(HelpWilds) do\r\n        if (inputStr[i + J] = HelpWilds[J]) or (HelpWilds[J] = '?') then\r\n          begin\r\n          if (J=Length(HelpWilds)) then\r\n            begin\r\n            Result:=i+1;\r\n            Exit;\r\n            end;\r\n          end\r\n        else\r\n          Break;\r\n      end;\r\n    end;\r\nend;\r\n\r\nFunction isMatch(level : integer;inputstr,wilds : string; CWild, CinputWord: SizeInt;MaxInputword,maxwilds : SizeInt; Out EOS : Boolean) : Boolean;\r\n\r\nbegin\r\n  EOS:=False;\r\n  Result:=True;\r\n  repeat\r\n    if Wilds[CWild] = '*' then { handling of '*' }\r\n      begin\r\n      inc(CWild);\r\n      while Wilds[CWild] = '?' do { equal to '?' }\r\n        begin\r\n        { goto next letter }\r\n        inc(CWild);\r\n        inc(CinputWord);\r\n        end;\r\n      { increase until a match }\r\n      Repeat\r\n        while (inputStr[CinputWord]<>Wilds[CWild]) and (CinputWord <= MaxinputWord) do\r\n          inc(CinputWord);\r\n        Result:=isMatch(Level+1,inputstr,wilds,CWild, CinputWord,MaxInputword,maxwilds,EOS);\r\n        if not Result then\r\n          Inc(cInputWord);\r\n      Until Result or (CinputWord>=MaxinputWord);\r\n      if Result and EOS then\r\n        Exit;\r\n      Continue;\r\n      end;\r\n    if Wilds[CWild] = '?' then { equal to '?' }\r\n      begin\r\n      { goto next letter }\r\n      inc(CWild);\r\n      inc(CinputWord);\r\n      Continue;\r\n      end;\r\n    if inputStr[CinputWord] = Wilds[CWild] then { equal letters }\r\n      begin\r\n      { goto next letter }\r\n      inc(CWild);\r\n      inc(CinputWord);\r\n      Continue;\r\n      end;\r\n    Result:=false;\r\n    Exit;\r\n  until (CinputWord > MaxinputWord) or (CWild > MaxWilds);\r\n  { no completed evaluation, we need to check what happened }\r\n  if (CinputWord <= MaxinputWord) or (CWild < MaxWilds) then\r\n    Result:=false\r\n  else if (CWild>Maxwilds) then\r\n    EOS:=False\r\n  else\r\n    begin\r\n    EOS:=Wilds[CWild]='*';\r\n    if not EOS then\r\n      Result:=False;\r\n    end\r\nend;\r\n\r\nfunction isWild(inputStr, Wilds: string; ignoreCase: boolean): boolean;\r\n\r\nvar\r\n  i: SizeInt;\r\n  MaxinputWord, MaxWilds: SizeInt; { Length of inputStr and Wilds }\r\n  eos : Boolean;\r\n\r\nbegin\r\n  Result:=true;\r\n  if Wilds = inputStr then\r\n    Exit;\r\n  { delete '**', because '**' = '*' }\r\n  i:=Pos('**', Wilds);\r\n  while i > 0 do\r\n    begin\r\n    Delete(Wilds, i, 1);\r\n    i:=Pos('**', Wilds);\r\n    end;\r\n  if Wilds = '*' then { for fast end, if Wilds only '*' }\r\n    Exit;\r\n  MaxinputWord:=Length(inputStr);\r\n  MaxWilds:=Length(Wilds);\r\n  if (MaxWilds = 0) or (MaxinputWord = 0) then\r\n    begin\r\n    Result:=false;\r\n    Exit;\r\n    end;\r\n  if ignoreCase then { upcase all letters }\r\n    begin\r\n    inputStr:=UpperCase(inputStr);\r\n    Wilds:=UpperCase(Wilds);\r\n    end;\r\n  Result:=isMatch(1,inputStr,wilds,1,1,MaxinputWord, MaxWilds,EOS);\r\nend;\r\n\r\n\r\nfunction XorString(const Key, Src: String): String;\r\nvar\r\n  i: SizeInt;\r\nbegin\r\n  Result:=Src;\r\n  if Length(Key) > 0 then\r\n    for i:=1 to Length(Src) do\r\n      Result[i]:=Chr(Ord(Key[1 + ((i - 1) mod Length(Key))]) xor Ord(Src[i]));\r\nend;\r\n\r\nfunction XorEncode(const Key, Source: string): string;\r\n\r\nvar\r\n  i: Integer;\r\n  C: Byte;\r\n\r\nbegin\r\n  Result:='';\r\n  for i:=1 to Length(Source) do\r\n    begin\r\n    if Length(Key) > 0 then\r\n      C:=Ord(Key[1 + ((i - 1) mod Length(Key))]) xor Ord(Source[i])\r\n    else\r\n      C:=Ord(Source[i]);\r\n    Result:=Result+LowerCase(intToHex(C, 2));\r\n    end;\r\nend;\r\n\r\nfunction XorDecode(const Key, Source: string): string;\r\nvar\r\n  i: Integer;\r\n  C: Char;\r\nbegin\r\n  Result:='';\r\n  for i:=0 to Length(Source) div 2 - 1 do\r\n    begin\r\n    C:=Chr(StrTointDef('$' + Copy(Source, (i * 2) + 1, 2), Ord(' ')));\r\n    if Length(Key) > 0 then\r\n      C:=Chr(Ord(Key[1 + (i mod Length(Key))]) xor Ord(C));\r\n    Result:=Result + C;\r\n    end;\r\nend;\r\n\r\nfunction GetCmdLineArg(const Switch: string; SwitchChars: Array of char): string;\r\nvar\r\n  i: Integer;\r\n  S: string;\r\nbegin\r\n  i:=1;\r\n  Result:='';\r\n  while (Result='') and (i<=ParamCount) do\r\n    begin\r\n    S:=ParamStr(i);\r\n    if (Length(SwitchChars)=0) or (CharInSet(S[1],SwitchChars) and (Length(S) > 1)) and\r\n       (CompareText(Copy(S,2,Length(S)-1),Switch)=0) then\r\n      begin\r\n      inc(i);\r\n      if i<=ParamCount then\r\n        Result:=ParamStr(i);\r\n      end;\r\n    inc(i);\r\n    end;\r\nend;\r\n\r\nFunction RPosEX(C:char;const S : String;offs:cardinal):SizeInt; overload;\r\n\r\nBegin\r\n Result:=TJSString.New(S).lastIndexOf(c,offs-1)+1;\r\nEnd;\r\n\r\nFunction RPos(c:char;const S : String):SizeInt;\r\n\r\nbegin\r\n  Result:=RPosEx(string(C),S,Length(S));\r\nend;\r\n\r\nFunction RPos (Const Substr : String; Const Source : String) : SizeInt; overload;\r\nbegin\r\n  Result:=RPosEx(SubStr,Source,Length(Source));\r\nend;\r\n\r\nFunction RPosex (Const Substr : String; Const Source : String;offs:cardinal) : SizeInt; overload;\r\n\r\nbegin\r\n  Result:=TJSString.New(Source).lastIndexOf(SubStr,offs-1)+1;\r\nend;\r\n\r\nfunction possetex (const c:Array of char;const s : String;count:Integer ):SizeInt;\r\n\r\nvar i,j:SizeInt;\r\n\r\nbegin\r\n  if s='' then\r\n    j:=0\r\n  else\r\n    begin\r\n    i:=length(s);\r\n    j:=count;\r\n    if j>i then\r\n      begin\r\n      result:=0;\r\n      exit;\r\n      end;\r\n    while (j<=i) and (not CharInSet(s[j],c)) do inc(j);\r\n    if (j>i) then\r\n      j:=0;                                         // not found.\r\n    end;\r\n result:=j;\r\nend;\r\n\r\nfunction PosSetEx (const c:string;const s : String;count:Integer ):SizeInt;\r\n\r\nvar\r\n  cset : Array of char;\r\n  i,l    : SizeInt;\r\nbegin\r\n  L:=Length(C);\r\n  SetLength(Cset,L);\r\n  if L>0 then\r\n    for i:=1 to l do\r\n      cset[i-1]:=c[i];\r\n  Result:=PosSetEx(cset,s,count);\r\nend;\r\n\r\nfunction posset (const c:Array of char;const s : String ):SizeInt;\r\n\r\nbegin\r\n  result:=possetex(c,s,1);\r\nend;\r\n\r\nfunction PosSet (const c:string;const s : String ):SizeInt;\r\n\r\nbegin\r\n  Result:=PosSetEx(c,S,1);\r\nend;\r\n\r\n\r\nProcedure Removeleadingchars(Var S : String; Const CSet:Array of char);\r\n\r\nvar\r\n  I,J : Longint;\r\n\r\nbegin\r\n  I:=Length(S);\r\n  if (I>0) then\r\n    begin\r\n    J:=1;\r\n    while (J<=I) and CharInSet(S[J],CSet) DO\r\n      inc(J);\r\n    if J>1 then\r\n      Delete(S,1,J-1);\r\n    end;\r\nend;\r\n\r\n\r\nfunction TrimLeftSet(const S: String;const CSet:Array of char): String;\r\n\r\nbegin\r\n  result:=s;\r\n  removeleadingchars(result,cset); \r\nend;\r\n\r\nProcedure RemoveTrailingChars(VAR S : String;Const CSet:Array of char);\r\n\r\nvar\r\n  i,j : longint;\r\n\r\nbegin\r\n  I:=Length(S);\r\n  if (I>0) then\r\n    begin\r\n    J:=I;\r\n    while (j>0) and CharInSet(S[J],CSet) do\r\n      dec(J);\r\n    if J<>I then\r\n      setLength(S,J);\r\n    End;\r\nEnd;\r\n\r\nFunction TrimRightSet(const S: String;const CSet:Array of char): String;\r\n\r\nbegin\r\n  result:=s;\r\n  RemoveTrailingchars(result,cset); \r\nend;\r\n\r\nProcedure RemovePadChars(VAR S : String;Const CSet:Array of char);\r\n\r\nvar\r\n  I,J,K: longint;\r\n\r\nbegin\r\n  I:=Length(S);\r\n  if I=0 then exit;\r\n  J:=I;\r\n  while (j>0) and CharInset(S[J],CSet) do\r\n    dec(J);\r\n  if j=0 Then\r\n    begin\r\n    s:='';\r\n    exit;\r\n    end;\r\n  SetLength(S,J);\r\n  I:=J;\r\n  k:=1;\r\n  while (k<=I) and CharInSet(S[k],CSet) do\r\n    inc(k);\r\n  if k>1 Then\r\n    Delete(S,1,K-1);\r\nend;\r\n\r\nfunction TrimSet(const S: String;const CSet:Array of char): String;\r\n\r\nbegin\r\n  Result:=s;\r\n  RemovePadChars(Result,cset);\r\nend;\r\n\r\nfunction StartsText(const ASubText, AText: string): Boolean; inline;\r\nbegin\r\n  Result := AnsiStartsText(ASubText, AText);\r\nend;\r\n\r\n\r\nfunction EndsText(const ASubText, AText: string): Boolean;\r\nbegin\r\n  Result := AnsiEndsText(ASubText, AText);\r\nend;\r\n\r\nfunction ResemblesText(const AText, AOther: string): Boolean;\r\nbegin\r\n  if Assigned(ResemblesProc) then\r\n    Result := ResemblesProc(AText, AOther)\r\n  else\r\n    Result := False;\r\nend;\r\n\r\nfunction ContainsText(const AText, ASubText: string): Boolean;\r\nbegin\r\n  Result := AnsiContainsText(AText, ASubText);\r\nend;\r\n\r\nfunction MatchText(const AText: string; const AValues: array of string): Boolean;\r\nbegin\r\n  Result := AnsiMatchText(AText, AValues);\r\nend;\r\n\r\nfunction IndexText(const AText: string; const AValues: array of string): Integer;\r\nbegin\r\n  Result := AnsiIndexText(AText, AValues);\r\nend;\r\n\r\nfunction ContainsStr(const AText, ASubText: string): Boolean;\r\nbegin\r\n  Result := AnsiContainsStr(AText, ASubText);\r\nend;\r\n\r\nFunction StartsStr(const ASubText, AText: string): Boolean;\r\n\r\nbegin\r\n  Result := AnsiStartsStr(AText, ASubText);\r\nend;\r\n\r\nFunction EndsStr(const ASubText, AText: string): Boolean;\r\n\r\nbegin\r\n  Result := AnsiEndsStr(AText, ASubText);\r\nend;\r\n\r\n\r\ninitialization\r\n  AnsiResemblesProc:= @SoundexProc;\r\n  ResemblesProc:=@SoundexProc;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Mask;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, StrUtils, WEBLib.Controls, WEBLib.StdCtrls, Web;\r\n\r\ntype\r\n  TMaskedState = set of (mStateMasked, mStateReEnter, mStateDBSetText);\r\n\r\n  TMaskedText = type string;\r\n  TEditMask = type string;\r\n\r\n  TCustomMaskEdit = class(TEdit)\r\n  private\r\n    FEditMask: TEditMask;\r\n    FMaskBlank: Char;\r\n    FMaxChars: Integer;\r\n    FMaskState: TMaskedState;\r\n    FCaretPos: Integer;\r\n    FOldValue: string;\r\n    FEditText: string;\r\n    function GetEditText: string;\r\n    procedure SetEditText(const Value: string);\r\n    function AddEditFormat(const Value: string; Active: Boolean): string;\r\n    function RemoveEditFormat(const Value: string): string;\r\n    procedure ArrowKeys(CharCode: Word; Shift: TShiftState);\r\n    procedure CursorInc(CursorPos: Integer; Incr: Integer);\r\n    procedure CursorDec(CursorPos: Integer);\r\n    procedure DeleteKeys(CharCode: Word);\r\n    function DeleteSelection(var Value: string; Offset: Integer;\r\n      Len: Integer): Boolean;\r\n    procedure HomeEndKeys(CharCode: Word; Shift: TShiftState);\r\n    function CharKeys(var CharCode: Char): Boolean;\r\n    function InputChar(var NewChar: Char; Offset: Integer): Boolean;\r\n    function DoInputChar(var NewChar: Char; MaskOffset: Integer): Boolean;\r\n    function FindLiteralChar (MaskOffset: Integer; InChar: Char): Integer;\r\n  protected\r\n    procedure SetEditMask(const Value: TEditMask);\r\n    function GetMasked: Boolean;\r\n    function GetTextLen: integer;\r\n    function EditCanModify: boolean; virtual;\r\n    procedure ReformatText(const NewMask: string);\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure KeyUp(var Key: Word; Shift: TShiftState); override;\r\n    procedure KeyPress(var Key: Char); override;\r\n    procedure MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); override;\r\n    procedure CheckCursor;\r\n    procedure Reset; virtual;\r\n    procedure Loaded; override;\r\n    procedure DoEnter; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure GetSel(var ASelStart: Integer; var ASelStop: Integer);\r\n    procedure SetSel(ASelStart: Integer; ASelStop: Integer);\r\n    procedure SetCursor(Pos: Integer);\r\n\r\n    property EditMask: TEditMask read FEditMask write SetEditMask;\r\n    property EditText: string read GetEditText write SetEditText;\r\n\r\n    function GetFirstEditChar: Integer;\r\n    function GetLastEditChar: Integer;\r\n    function GetNextEditChar(Offset: Integer): Integer;\r\n    function GetPriorEditChar(Offset: Integer): Integer;\r\n    function GetMaxChars: Integer;\r\n    property IsMasked: Boolean read GetMasked;\r\n  end;\r\n\r\n  TMaskEdit = class(TCustomMaskEdit)\r\n  published\r\n    property EditMask;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n  end;\r\n\r\n  TWebMaskEdit = class(TMaskEdit);\r\n\r\nimplementation\r\n\r\nuses\r\n  Math, WEBLib.WebTools;\r\n\r\ntype\r\n  TMaskCharType = (mcNone, mcLiteral, mcIntlLiteral, mcDirective, mcMask,\r\n    mcMaskOpt, mcFieldSeparator, mcField);\r\n\r\n  TMaskInstructions = set of (miReverseDir, miUpperCase, miLowerCase,\r\n    miLiteralChar);\r\n\r\nconst\r\n  dMaskReverse = '!';\r\n  dMaskUpperCase = '>';\r\n  dMaskLowerCase = '<';\r\n  dMaskLiteral = '\\';\r\n\r\n  cMaskAlpha = 'L';\r\n  cMaskAlphaOpt = 'l';\r\n  cMaskAlphaNum = 'A';\r\n  cMaskAlphaNumOpt  = 'a';\r\n  cMaskAscii = 'C';\r\n  cMaskAsciiOpt = 'c';\r\n  cMaskNumeric = '0';\r\n  cMaskNumericOpt = '9';\r\n  cMaskNumSymOpt = '#';\r\n  cMaskTimeSeparator = ':';\r\n  cMaskDateSeparator = '/';\r\n  mskSeparator = ';';\r\n  mskBlank = '_';\r\n\r\nfunction IsCharAlpha(IChar: Char): boolean;\r\nbegin\r\n  Result := ((IChar >= 'a') and (IChar <= 'z')) or\r\n     ((IChar >= 'A') and (IChar <= 'Z'));\r\nend;\r\n\r\nfunction IsCharAlphaNumeric(IChar: Char): boolean;\r\nbegin\r\n  Result := ((IChar >= 'a') and (IChar <= 'z')) or\r\n     ((IChar >= 'A') and (IChar <= 'Z')) or\r\n     ((IChar >= '0') and (IChar <= '9'));\r\nend;\r\n\r\nfunction GetMaskCharType(const EditMask: string; MaskOffset: Integer): TMaskCharType;\r\nvar\r\n  MaskChar: Char;\r\nbegin\r\n  Result := mcLiteral;\r\n  MaskChar := #0;\r\n  if MaskOffset <= Length(EditMask) then\r\n    MaskChar := EditMask[MaskOffset];\r\n  if MaskOffset > Length(EditMask) then\r\n    Result := mcNone\r\n  else if (MaskOffset > 1) and (EditMask[MaskOffset - 1] = dMaskLiteral) and\r\n      not ((MaskOffset > 2) and (EditMask[MaskOffset - 2] = dMaskLiteral)) then\r\n    Result := mcLiteral\r\n  else if (MaskChar = mskSeparator) and\r\n         (Length(EditMask) >= 4) and\r\n         (MaskOffset > Length(EditMask) - 4) then\r\n    Result := mcFieldSeparator\r\n  else if (Length(EditMask) >= 4) and\r\n         (MaskOffset > (Length(EditMask) - 4)) and\r\n         (EditMask[MaskOffset - 1] = mskSeparator) and\r\n         not ((MaskOffset > 2) and (EditMask[MaskOffset - 2] = dMaskLiteral)) then\r\n    Result := mcField\r\n\r\n  else if MaskChar in [cMaskTimeSeparator, cMaskDateSeparator] then\r\n    Result := mcIntlLiteral\r\n\r\n  else if MaskChar in [dMaskReverse, dMaskUpperCase, dMaskLowerCase,\r\n      dMaskLiteral] then\r\n    Result := mcDirective\r\n\r\n  else if MaskChar in [cMaskAlphaOpt, cMaskAlphaNumOpt, cMaskAsciiOpt,\r\n      cMaskNumSymOpt, cMaskNumericOpt] then\r\n    Result := mcMaskOpt\r\n\r\n  else if MaskChar in [cMaskAlpha, cMaskAlphaNum, cMaskAscii, cMaskNumeric] then\r\n    Result := mcMask;\r\nend;\r\n\r\n\r\nfunction GetMaskInstructions(const EditMask: string; MaskOffset: Integer): TMaskInstructions;\r\nvar\r\n  I: Integer;\r\n  MaskChar: Char;\r\nbegin\r\n  Result := [];\r\n  for I := 0 to Length(EditMask) - 1 do\r\n  begin\r\n    MaskChar := EditMask[I+1];\r\n    if (MaskChar = dMaskReverse) then\r\n      Result := Result + [miReverseDir]\r\n    else\r\n    if (MaskChar = dMaskLowerCase) and (I < MaskOffset-1) then\r\n    begin\r\n      Result := Result - [miUpperCase] + [miLowerCase];\r\n    end\r\n    else\r\n    if (MaskChar = dMaskUpperCase) and (I < MaskOffset-1) then\r\n    begin\r\n      Result := Result - [miLowerCase];\r\n      if not ((I > 0) and (EditMask[I] = dMaskLowerCase)) then\r\n        Result := Result + [miUpperCase];\r\n    end;\r\n  end;\r\n  if GetMaskCharType(EditMask, MaskOffset) = mcLiteral then\r\n    Result := Result + [miLiteralChar];\r\nend;\r\n\r\nfunction GetFormatSettingsChar(IChar: Char): Char;\r\nbegin\r\n  Result := IChar;\r\n  case IChar of\r\n    cMaskTimeSeparator: Result := Char(FormatSettings.TimeSeparator);\r\n    cMaskDateSeparator: Result := Char(FormatSettings.DateSeparator);\r\n  end;\r\nend;\r\n\r\nfunction MaskOffsetToString(const EditMask: String; MaskOffset: Integer): string;\r\nvar\r\n  I: Integer;\r\n  CType: TMaskCharType;\r\nbegin\r\n  Result := '';\r\n  for I := 1 to MaskOffset do\r\n  begin\r\n    CType := GetMaskCharType(EditMask, I);\r\n    if not (CType in [mcDirective, mcField, mcFieldSeparator]) then\r\n      Result := Result + EditMask[I];\r\n  end;\r\nend;\r\n\r\nfunction MaskOffsetToOffset(const EditMask: String; MaskOffset: Integer): Integer;\r\nbegin\r\n  Result := Length(MaskOffsetToString(Editmask, MaskOffset));\r\nend;\r\n\r\nfunction OffsetToMaskOffset(const EditMask: string; Offset: Integer): Integer;\r\nvar\r\n  I: Integer;\r\n  Count: Integer;\r\n  MaxChars: Integer;\r\nbegin\r\n  MaxChars := MaskOffsetToOffset(EditMask, Length(EditMask));\r\n  if Offset > MaxChars then\r\n  begin\r\n    Result := -1;\r\n    Exit;\r\n  end;\r\n\r\n  Result := 0;\r\n  Count := Offset;\r\n  for I := 1 to Length(EditMask) do\r\n  begin\r\n    Inc(Result);\r\n    if not (mcDirective = GetMaskCharType(EditMask, I)) then\r\n    begin\r\n      Dec(Count);\r\n      if Count < 0 then\r\n        Exit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction FormatMaskedText(const EditMask: string; const Value: string; Blank: Char): string;\r\nvar\r\n  I: Integer;\r\n  Offset, MaskOffset: Integer;\r\n  CType: TMaskCharType;\r\n  Dir: TMaskInstructions;\r\nbegin\r\n  Result := Value;\r\n  Dir := GetMaskInstructions(EditMask, 1);\r\n\r\n  if not (miReverseDir in Dir) then\r\n  begin\r\n    { starting at the beginning, insert literal chars in the string\r\n      and add spaces on the end }\r\n    Offset := 1;\r\n    for MaskOffset := 1 to Length(EditMask) do\r\n    begin\r\n      CType := GetMaskCharType(EditMask, MaskOffset);\r\n\r\n      if CType in [mcLiteral, mcIntlLiteral] then\r\n      begin\r\n        Result := Copy(Result, 1, Offset - 1) +\r\n          GetFormatSettingsChar(EditMask[MaskOffset]) +\r\n          Copy(Result,  Offset, Length(Result) - Offset + 1);\r\n        Inc(Offset);\r\n      end\r\n      else if CType in [mcMask, mcMaskOpt] then\r\n      begin\r\n        if Offset > Length(Result) then\r\n          Result := Result + Blank;\r\n        Inc(Offset);\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n      { starting at the end, insert literal chars in the string\r\n        and add spaces at the beginning }\r\n    Offset := Length(Result);\r\n    for I := 0 to (Length(EditMask) - 1) do\r\n    begin\r\n      MaskOffset := Length(EditMask) - I;\r\n      CType := GetMaskCharType(EditMask, MaskOffset);\r\n\r\n      if CType in [mcLiteral, mcIntlLiteral] then\r\n      begin\r\n        Result := Copy(Result, 1, Offset) +\r\n               GetFormatSettingsChar(EditMask[MaskOffset]) +\r\n               Copy(Result, Offset + 1, Length(Result) - Offset);\r\n      end\r\n      else if CType in [mcMask, mcMaskOpt] then\r\n      begin\r\n        if Offset < 1 then\r\n          Result := Blank + Result\r\n        else\r\n          Dec(Offset);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction IsLiteralChar(const EditMask: string; Offset: Integer): Boolean;\r\nvar\r\n  MaskOffset: Integer;\r\n  CType: TMaskCharType;\r\nbegin\r\n  Result := False;\r\n  MaskOffset := OffsetToMaskOffset(EditMask, Offset);\r\n  if MaskOffset >= 0 then\r\n  begin\r\n    CType := GetMaskCharType(EditMask, MaskOffset);\r\n    Result := CType in [mcLiteral, mcIntlLiteral];\r\n  end;\r\nend;\r\n\r\nfunction GetMaskBlank(const EditMask: string): Char;\r\nbegin\r\n  Result := mskBlank;\r\n  if Length(EditMask) >= 4 then\r\n  begin\r\n    if (GetMaskCharType(EditMask, Length(EditMask) - 1) = mcFieldSeparator) then\r\n    begin\r\n      if (GetMaskCharType(EditMask, Length(EditMask) - 2) = mcFieldSeparator) or\r\n        (GetMaskCharType(EditMask, Length(EditMask) - 3) = mcFieldSeparator) then\r\n      begin\r\n        Result := EditMask[Length(EditMask)];\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TCustomMaskEdit }\r\n\r\nfunction TCustomMaskEdit.AddEditFormat(const Value: string;\r\n  Active: Boolean): string;\r\nbegin\r\n  if not Active then\r\n    Result := FormatMaskedText(EditMask, Value, ' ')\r\n  else\r\n    Result := FormatMaskedText(EditMask, Value, FMaskBlank);\r\nend;\r\n\r\nprocedure TCustomMaskEdit.ArrowKeys(CharCode: Word; Shift: TShiftState);\r\nvar\r\n  ASelStart, ASelStop : Integer;\r\nbegin\r\n  if (ssCtrl in Shift) then Exit;\r\n  GetSel(ASelStart, ASelStop);\r\n  if (ssShift in Shift) then\r\n  begin\r\n    if (CharCode = VK_RIGHT) then\r\n    begin\r\n      Inc(FCaretPos);\r\n      if (ASelStop = ASelStart + 1) then\r\n      begin\r\n        SetSel(ASelStart, ASelStop);  {reset caret to end of string}\r\n        Inc(FCaretPos);\r\n      end;\r\n      if FCaretPos > FMaxChars then FCaretPos := FMaxChars;\r\n    end\r\n    else  {if (CharCode = VK_LEFT) then}\r\n    begin\r\n      Dec(FCaretPos);\r\n      if (ASelStop = ASelStart + 2) and\r\n        (FCaretPos > ASelStart) then\r\n      begin\r\n        SetSel(ASelStart + 1, ASelStart + 1);  {reset caret to show up at start}\r\n        Dec(FCaretPos);\r\n      end;\r\n      if FCaretPos < 0 then FCaretPos := 0;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    if (ASelStop - ASelStart) > 1 then\r\n    begin\r\n      if ASelStop = FCaretPos then\r\n        Dec(FCaretPos);\r\n      SetCursor(FCaretPos);\r\n    end\r\n    else if (CharCode = VK_LEFT) then\r\n      CursorDec(ASelStart)\r\n    else   { if (CharCode = VK_RIGHT) then  }\r\n    begin\r\n      if ASelStop = ASelStart then\r\n        SetCursor(ASelStart)\r\n      else\r\n        CursorInc(ASelStart, 1);\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nfunction TCustomMaskEdit.CharKeys(var CharCode: Char): Boolean;\r\nvar\r\n  ASelStart, ASelStop : Integer;\r\n  Txt: string;\r\nbegin\r\n  Result := False;\r\n\r\n  GetSel(ASelStart, ASelStop);\r\n\r\n  if (ASelStop - ASelStart) > 1 then\r\n  begin\r\n    DeleteKeys(VK_DELETE);\r\n    ASelStart := GetNextEditChar(ASelStart);\r\n    SetCursor(ASelStart);\r\n  end;\r\n\r\n  Result := InputChar(CharCode, ASelStart);\r\n\r\n  if Result then\r\n  begin\r\n    Txt := CharCode;\r\n\r\n    Text := Copy(Text, 1, ASelStart) + Txt + Copy(Text, ASelStop + 1, Length(Text));\r\n\r\n    CursorInc(ASelStart, 1);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.CheckCursor;\r\nvar\r\n  ASelStart, ASelStop: Integer;\r\nbegin\r\n  if not HandleAllocated then Exit;\r\n  if (IsMasked) then\r\n  begin\r\n    GetSel(ASelStart, ASelStop);\r\n    if ASelStart = ASelStop then\r\n      SetCursor(ASelStart);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Height := 25;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.CursorDec(CursorPos: Integer);\r\nvar\r\n  nuPos: Integer;\r\nbegin\r\n  if CursorPos > 0 then\r\n  begin\r\n\r\n    nuPos := CursorPos;\r\n    Dec(nuPos);\r\n    nuPos := GetPriorEditChar(nuPos);\r\n    SetCursor(NuPos);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.CursorInc(CursorPos, Incr: Integer);\r\nvar\r\n  NuPos: Integer;\r\nbegin\r\n  if (CursorPos < Length(Text)) then\r\n  begin\r\n    NuPos := CursorPos + Incr;\r\n    NuPos := GetNextEditChar(NuPos);\r\n    if IsLiteralChar(EditMask, nuPos) then\r\n      NuPos := CursorPos;\r\n    SetCursor(NuPos);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.DeleteKeys(CharCode: Word);\r\nvar\r\n  ASelStart, ASelStop : Integer;\r\n  NuSelStart: Integer;\r\n  Str, Orig: string;\r\nbegin\r\n//  if ReadOnly then Exit;\r\n  GetSel(ASelStart, ASelStop);\r\n  if ((ASelStop - ASelStart) <= 1) and (CharCode = VK_BACK) then\r\n  begin\r\n    NuSelStart := ASelStart;\r\n    CursorDec(ASelStart);\r\n    GetSel(ASelStart, ASelStop);\r\n    if ASelStart = NuSelStart then Exit;\r\n  end;\r\n\r\n  if (ASelStop - ASelStart) < 1 then Exit;\r\n\r\n  Str := EditText;\r\n  Orig := EditText;\r\n\r\n  DeleteSelection(Str, ASelStart, ASelStop - ASelStart);\r\n\r\n  Str := Copy(Str, ASelStart + 1, ASelStop - ASelStart);\r\n\r\n  Str := Copy(Orig, 1, ASelStart) + Str + Copy(Orig, ASelStop + 1, Length(Orig));\r\n\r\n  EditText := Str;\r\n\r\n  if (ASelStop - ASelStart) <> 1 then\r\n  begin\r\n    ASelStart := GetNextEditChar(ASelStart);\r\n    SetCursor(ASelStart);\r\n  end\r\n  else\r\n  begin\r\n    GetSel(ASelStart, ASelStop);\r\n    SetCursor(ASelStart);\r\n  end;\r\nend;\r\n\r\nfunction TCustomMaskEdit.DeleteSelection(var Value: string; Offset,\r\n  Len: Integer): Boolean;\r\nvar\r\n  EndDel: Integer;\r\n  StrOffset, MaskOffset, Temp: Integer;\r\n  CType: TMaskCharType;\r\nbegin\r\n  Result := True;\r\n  if Len = 0 then Exit;\r\n\r\n  StrOffset := Offset + 1;\r\n  EndDel := StrOffset + Len;\r\n  Temp := OffsetToMaskOffset(EditMask, Offset);\r\n  if Temp < 0 then  Exit;\r\n  for MaskOffset := Temp to Length(EditMask) do\r\n  begin\r\n    CType := GetMaskCharType(EditMask, MaskOffset);\r\n    if CType in [mcLiteral, mcIntlLiteral] then\r\n      Inc(StrOffset)\r\n    else if CType in [mcMask, mcMaskOpt] then\r\n    begin\r\n      Value[StrOffset] := FMaskBlank;\r\n      Inc(StrOffset);\r\n    end;\r\n    if StrOffset >= EndDel then Break;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.DoEnter;\r\nbegin\r\n  inherited;\r\n  SelStart := 0;\r\n  SelLength := 1;\r\nend;\r\n\r\nfunction TCustomMaskEdit.DoInputChar(var NewChar: Char;\r\n  MaskOffset: Integer): Boolean;\r\nvar\r\n  Instr: TMaskInstructions;\r\n  Str: string;\r\n  CType: TMaskCharType;\r\n\r\nbegin\r\n  Result := True;\r\n  CType := GetMaskCharType(EditMask, MaskOffset);\r\n  if CType in [mcLiteral, mcIntlLiteral] then\r\n    NewChar := GetFormatSettingsChar(EditMask[MaskOffset])\r\n  else\r\n  begin\r\n    Instr := GetMaskInstructions(EditMask, MaskOffset);\r\n    case EditMask[MaskOffset] of\r\n      cMaskNumeric, cMaskNumericOpt:\r\n        begin\r\n          if not ((NewChar >= '0') and (NewChar <= '9')) then\r\n            Result := False;\r\n        end;\r\n      cMaskNumSymOpt:\r\n        begin\r\n          if not (((NewChar >= '0') and (NewChar <= '9')) or\r\n                 (NewChar = ' ') or(NewChar = '+') or(NewChar = '-')) then\r\n            Result := False;\r\n        end;\r\n      cMaskAscii, cMaskAsciiOpt:\r\n        begin\r\n          if IsCharAlpha(NewChar) then\r\n          begin\r\n            Str := ' ';\r\n            Str[1] := NewChar;\r\n            if (miUpperCase in Instr)  then\r\n              Str := UpperCase(Str)\r\n            else if miLowerCase in Instr then\r\n              Str := LowerCase(Str);\r\n            NewChar := Str[1];\r\n          end;\r\n        end;\r\n      cMaskAlpha, cMaskAlphaOpt, cMaskAlphaNum, cMaskAlphaNumOpt:\r\n        begin\r\n          Str := ' ';\r\n          Str[1] := NewChar;\r\n          if not IsCharAlpha(NewChar) then\r\n          begin\r\n            Result := False;\r\n            if ((EditMask[MaskOffset] = cMaskAlphaNum) or\r\n                (EditMask[MaskOffset] = cMaskAlphaNumOpt)) and\r\n                (IsCharAlphaNumeric(NewChar)) then\r\n              Result := True;\r\n          end\r\n          else if miUpperCase in Instr then\r\n            Str := UpperCase(Str)\r\n          else if miLowerCase in Instr then\r\n            Str := LowerCase(Str);\r\n          NewChar := Str[1];\r\n        end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomMaskEdit.EditCanModify: boolean;\r\nbegin\r\n  Result := not ReadOnly;\r\nend;\r\n\r\nfunction TCustomMaskEdit.FindLiteralChar(MaskOffset: Integer;\r\n  InChar: Char): Integer;\r\nvar\r\n  CType: TMaskCharType;\r\n  LitChar: Char;\r\nbegin\r\n  Result := -1;\r\n  while MaskOffset < Length(EditMask) do\r\n  begin\r\n    Inc(MaskOffset);\r\n    CType := GetMaskCharType(EditMask, MaskOffset);\r\n    if CType in [mcLiteral, mcIntlLiteral] then\r\n    begin\r\n      LitChar := EditMask[MaskOffset];\r\n      if CType = mcIntlLiteral then\r\n        LitChar := GetFormatSettingsChar(LitChar);\r\n      if LitChar = InChar then\r\n        Result := MaskOffset;\r\n      Exit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomMaskEdit.GetEditText: string;\r\nbegin\r\n  Result := RemoveEditFormat(inherited Text);\r\nend;\r\n\r\nfunction TCustomMaskEdit.GetFirstEditChar: Integer;\r\nbegin\r\n  Result := 0;\r\n  if IsMasked then\r\n    Result := GetNextEditChar(0);\r\nend;\r\n\r\nfunction TCustomMaskEdit.GetLastEditChar: Integer;\r\nbegin\r\n  Result := GetMaxChars;\r\n  if IsMasked then\r\n    Result := GetPriorEditChar(Result - 1);\r\nend;\r\n\r\nfunction TCustomMaskEdit.GetMasked: Boolean;\r\nbegin\r\n  Result := EditMask <> '';\r\nend;\r\n\r\nfunction TCustomMaskEdit.GetMaxChars: Integer;\r\nbegin\r\n  if IsMasked then\r\n    Result := FMaxChars\r\n  else\r\n    Result := GetTextLen;\r\nend;\r\n\r\nfunction TCustomMaskEdit.GetNextEditChar(Offset: Integer): Integer;\r\nbegin\r\n  Result := Offset;\r\n  while (Result < FMaxChars) and (IsLiteralChar(EditMask, Result)) do\r\n    Inc(Result);\r\nend;\r\n\r\nfunction TCustomMaskEdit.GetPriorEditChar(Offset: Integer): Integer;\r\nbegin\r\n  Result := Offset;\r\n  while (Result >= 0) and (IsLiteralChar(EditMask, Result)) do\r\n    Dec(Result);\r\n  if Result < 0 then\r\n    Result := GetNextEditChar(Result);\r\nend;\r\n\r\nprocedure TCustomMaskEdit.GetSel(var ASelStart, ASelStop: Integer);\r\nbegin\r\n  ASelStart := SelStart;\r\n  ASelStop := SelStart + SelLength;\r\nend;\r\n\r\nfunction TCustomMaskEdit.GetTextLen: integer;\r\nbegin\r\n  Result := Length(Text);\r\nend;\r\n\r\nprocedure TCustomMaskEdit.HomeEndKeys(CharCode: Word; Shift: TShiftState);\r\nvar\r\n  ASelStart, ASelStop : Integer;\r\nbegin\r\n  GetSel(ASelStart, ASelStop);\r\n  if (CharCode = VK_HOME) then\r\n  begin\r\n    if (ssShift in Shift) then\r\n    begin\r\n      if (ASelStart <> FCaretPos) and (ASelStop <> (ASelStart + 1)) then\r\n        ASelStop := ASelStart + 1;\r\n      SetSel(0, ASelStop);\r\n      CheckCursor;\r\n    end\r\n    else\r\n      SetCursor(0);\r\n    FCaretPos := 0;\r\n  end\r\n  else\r\n  begin\r\n    if (ssShift in Shift) then\r\n    begin\r\n      if (ASelStop <> FCaretPos) and (ASelStop <> (ASelStart + 1)) then\r\n        ASelStart := ASelStop - 1;\r\n      SetSel(ASelStart, FMaxChars);\r\n      CheckCursor;\r\n    end\r\n    else\r\n      SetCursor(FMaxChars - 1);\r\n    FCaretPos := FMaxChars;\r\n  end;\r\n\r\nend;\r\n\r\nfunction TCustomMaskEdit.InputChar(var NewChar: Char; Offset: Integer): Boolean;\r\nvar\r\n  MaskOffset: Integer;\r\n  CType: TMaskCharType;\r\n  InChar: Char;\r\nbegin\r\n  Result := True;\r\n\r\n  if EditMask <> '' then\r\n  begin\r\n    Result := False;\r\n    if Offset < FMaxChars then\r\n    begin\r\n      MaskOffset := OffsetToMaskOffset(EditMask, Offset);\r\n      if MaskOffset >= 0 then\r\n      begin\r\n        CType := GetMaskCharType(EditMask, MaskOffset);\r\n        InChar := NewChar;\r\n        Result := DoInputChar(NewChar, MaskOffset);\r\n        if not Result and (CType in [mcMask, mcMaskOpt]) then\r\n        begin\r\n          MaskOffset := FindLiteralChar (MaskOffset, InChar);\r\n          if MaskOffset > 0 then\r\n          begin\r\n            MaskOffset := MaskOffsetToOffset(EditMask, MaskOffset);\r\n            SetCursor (MaskOffset);\r\n            Exit;\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\n  if not Result then\r\n    MessageBeep(0)\r\nend;\r\n\r\nprocedure TCustomMaskEdit.KeyDown(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  inherited KeyDown(Key, Shift);\r\n\r\n  if (Key in [VK_LEFT, VK_RIGHT, VK_HOME, VK_END]) then\r\n  begin\r\n    PreventDefault;\r\n    StopPropagation;\r\n  end;\r\n\r\n  if IsMasked and (Key <> 0) and not (ssAlt in Shift) then\r\n  begin\r\n    if not (Key in [VK_LEFT, VK_RIGHT, VK_HOME, VK_END]) then\r\n    begin\r\n      if SelLength > 1 then\r\n      begin\r\n        SelStart := 0;\r\n        SelLength := 1;\r\n      end;\r\n    end;\r\n\r\n    if (Key = VK_LEFT) or(Key = VK_RIGHT) then\r\n    begin\r\n      ArrowKeys(Key, Shift);\r\n      if not ((ssShift in Shift) or (ssCtrl in Shift)) then\r\n        Key := 0;\r\n      Exit;\r\n    end\r\n    else if (Key = VK_UP) or(Key = VK_DOWN) then\r\n    begin\r\n      Key := 0;\r\n      Exit;\r\n    end\r\n    else if (Key = VK_HOME) or(Key = VK_END) then\r\n    begin\r\n      HomeEndKeys(Key, Shift);\r\n      Key := 0;\r\n      Exit;\r\n    end\r\n    else if ((Key = VK_DELETE) and not (ssShift in Shift)) or\r\n      (Key = VK_BACK) then\r\n    begin\r\n      if EditCanModify then\r\n        DeleteKeys(Key);\r\n      Key := 0;\r\n      PreventDefault;\r\n      StopPropagation;\r\n      Exit;\r\n    end;\r\n    CheckCursor;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.KeyPress(var Key: Char);\r\nbegin\r\n  inherited KeyPress(Key);\r\n\r\n  if IsMasked and (Key <> #0) and not CharInSet(Key, [^V, ^X, ^C]) then\r\n  begin\r\n    CharKeys(Key);\r\n    Key := #0;\r\n\r\n    PreventDefault;\r\n    StopPropagation;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.KeyUp(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  inherited KeyUp(Key, Shift);\r\n\r\n  if IsMasked and (Key <> 0) then\r\n  begin\r\n    if ((Key = VK_LEFT) or(Key = VK_RIGHT)) and (ssCtrl in Shift) then\r\n      CheckCursor;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.Loaded;\r\nbegin\r\n  inherited;\r\n  Text := FEditText;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.MouseUp(Button: TMouseButton; Shift: TShiftState; X,\r\n  Y: Integer);\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.ReformatText(const NewMask: string);\r\nvar\r\n  OldText: string;\r\nbegin\r\n  OldText := RemoveEditFormat(EditText);\r\n  FEditMask := NewMask;\r\n  FMaxChars  := MaskOffsetToOffset(EditMask, Length(NewMask));\r\n  FMaskBlank := GetMaskBlank(NewMask);\r\n//  OldText := AddEditFormat(OldText, True);\r\n  EditText := OldText;\r\nend;\r\n\r\nfunction TCustomMaskEdit.RemoveEditFormat(const Value: string): string;\r\nvar\r\n  I: Integer;\r\n  OldLen: Integer;\r\n  Offset, MaskOffset: Integer;\r\n  CType: TMaskCharType;\r\n  Dir: TMaskInstructions;\r\nbegin\r\n  Offset := 1;\r\n  Result := Value;\r\n  for MaskOffset := 1 to Length(EditMask) do\r\n  begin\r\n    CType := GetMaskCharType(EditMask, MaskOffset);\r\n\r\n    if CType in [mcLiteral, mcIntlLiteral] then\r\n      Result := Copy(Result, 1, Offset - 1) +\r\n        Copy(Result, Offset + 1, Length(Result) - Offset);\r\n    if CType in [mcMask, mcMaskOpt] then Inc(Offset);\r\n  end;\r\n\r\n  Dir := GetMaskInstructions(EditMask, 1);\r\n  if miReverseDir in Dir then\r\n  begin\r\n    Offset := 1;\r\n    for I := 1 to Length(Result) do\r\n    begin\r\n      if Result[I] = FMaskBlank then\r\n        Inc(Offset)\r\n      else\r\n        break;\r\n    end;\r\n    if Offset <> 1 then\r\n      Result := Copy(Result, Offset, Length(Result) - Offset + 1);\r\n  end\r\n  else begin\r\n    OldLen := Length(Result);\r\n    for I := 1 to OldLen do\r\n    begin\r\n      if Result[OldLen - I + 1] = FMaskBlank then\r\n        SetLength(Result, Length(Result) - 1)\r\n      else Break;\r\n    end;\r\n  end;\r\n  if FMaskBlank <> ' ' then\r\n  begin\r\n    OldLen := Length(Result);\r\n    for I := 1 to OldLen do\r\n    begin\r\n      if Result[I] = FMaskBlank then\r\n        Result[I] := ' ';\r\n      if I > OldLen then Break;\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomMaskEdit.Reset;\r\nbegin\r\n  EditText := FOldValue;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.SetCursor(Pos: Integer);\r\nbegin\r\n  SetSel(Pos,Pos + 1);\r\nend;\r\n\r\nprocedure TCustomMaskEdit.SetEditMask(const Value: TEditMask);\r\nvar\r\n  SelStart, SelStop: Integer;\r\nbegin\r\n  if Value <> EditMask then\r\n  begin\r\n    if (csDesigning in ComponentState) and (Value <> '') and\r\n      not (csLoading in ComponentState) then\r\n      EditText := '';\r\n\r\n    if HandleAllocated then GetSel(SelStart, SelStop);\r\n\r\n    ReformatText(Value);\r\n    Exclude(FMaskState, mStateMasked);\r\n\r\n    if EditMask <> '' then\r\n      Include(FMaskState, mStateMasked);\r\n\r\n    inherited MaxLength := 0;\r\n\r\n    if IsMasked and (FMaxChars > 0) then\r\n    begin\r\n      inherited MaxLength := FMaxChars;\r\n    end;\r\n\r\n    if HandleAllocated and Focused and\r\n       not (csDesigning in ComponentState) then\r\n      SetCursor(SelStart);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.SetEditText(const Value: string);\r\nbegin\r\n  FEditText := AddEditFormat(Value, True);\r\n  inherited Text := FEditText;\r\nend;\r\n\r\nprocedure TCustomMaskEdit.SetSel(ASelStart, ASelStop: Integer);\r\nbegin\r\n  SelStart := ASelStart;\r\n  SelLength := Max(1,ASelStop - ASelStart);\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2019                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.EditAutocomplete;\r\n\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, Types, WEBLib.Controls, WEBLib.StdCtrls, WEBLib.Graphics,\r\n  Web, JS;\r\n\r\ntype\r\n  TEditAutoCompleteLookupType = (ltFirstCharacter, ltAnywhere);\r\n\r\n  TEditAutoCompleteRenderItemEventArgs = class(TPersistent)\r\n  private\r\n    FItemElement: TJSHTMLElement;\r\n    FItemIndex: Integer;\r\n  public\r\n    property ItemIndex: Integer read FItemIndex write FItemIndex;\r\n    property ItemElement: TJSHTMLElement read FItemElement write FItemElement;\r\n  end;\r\n\r\n  TEditAutoCompleteRenderItemEvent = procedure(Sender: TObject; Args: TEditAutoCompleteRenderItemEventArgs) of object;\r\n\r\n  TEditAutoCompleteSelectEventArgs = class(TPersistent)\r\n  private\r\n    FItemIndex: Integer;\r\n  public\r\n    property ItemIndex: Integer read FItemIndex write FItemIndex;\r\n  end;\r\n\r\n  TEditAutoCompleteSelectEvent = procedure(Sender: TObject; Args: TEditAutoCompleteSelectEventArgs) of object;\r\n\r\n  TEditAutoComplete = class(TCustomInput)\r\n  private\r\n    FText: string;\r\n    FItemIndex: Integer;\r\n    FItems: TStringList;\r\n    FPopupHeight: Integer;\r\n    FActiveItemClassName: string;\r\n    FPopupClassName: string;\r\n    FItemClassName: string;\r\n    FOnRenderItem: TEditAutoCompleteRenderItemEvent;\r\n    FOnSelect: TEditAutoCompleteSelectEvent;\r\n    FTextHint: string;\r\n    FReadOnly: boolean;\r\n    FCharCase: TEditCharCase;\r\n    FOnChange: TNotifyEvent;\r\n    FLookupCaseSensitive: Boolean;\r\n    FlookupMinLength: Integer;\r\n    FLookupType: TEditAutoCompleteLookupType;\r\n    procedure AddScript(Script: string);\r\n    function GetText: string;\r\n    procedure SetText(const Value: string);\r\n    procedure SetItems(const Value: TStringList);\r\n    function GetItemIndex: Integer;\r\n    procedure SetItemIndex(const Value: Integer);\r\n    procedure SetPopupHeight(const Value: Integer);\r\n    procedure SetActiveItemClassName(const Value: string);\r\n    procedure SetItemClassName(const Value: string);\r\n    procedure SetPopupClassName(const Value: string);\r\n    procedure SetTextHint(const Value: string);\r\n    procedure SetReadOnly(const Value: boolean);\r\n    procedure SetCharcase(const Value: TEditCharCase);\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    procedure SetLookupCaseSensitive(const Value: Boolean);\r\n    procedure SetLookupMinLength(const Value: Integer);\r\n    procedure SetLookupType(const Value: TEditAutoCompleteLookupType);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure BindEvents; override;\r\n    function HandleRenderItem(Item: TJSHTMLElement; Index: Integer): TJSHTMLElement;\r\n    function HandleSelect(Index: Integer): Boolean;\r\n    function HandleDoChange(Event: TJSMouseEvent): Boolean; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n    procedure Change; virtual;\r\n    procedure Refresh; virtual;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property Color;\r\n    property CharCase: TEditCharCase read FCharCase write SetCharcase default wecNormal;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property HeightPercent;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property Margins;\r\n    property ReadOnly: boolean read FReadOnly write SetReadOnly default False;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TextHint: string read FTextHint write SetTextHint;\r\n    property TabStop;\r\n    property TabOrder;\r\n    property Visible;\r\n    property Width;\r\n    property WidthPercent;\r\n    property WidthStyle;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n\r\n    property Items: TStringList read FItems write SetItems;\r\n    property ItemIndex: Integer read GetItemIndex write SetItemIndex default -1;\r\n    property Text: string read GetText write SetText;\r\n    property PopupHeight: Integer read FPopupHeight write SetPopupHeight default 0;\r\n    property PopupClassName: string read FPopupClassName write SetPopupClassName;\r\n    property ItemClassName: string read FItemClassName write SetItemClassName;\r\n    property ActiveItemClassName: string read FActiveItemClassName write SetActiveItemClassName;\r\n    property LookupType: TEditAutoCompleteLookupType read FLookupType write SetLookupType default ltFirstCharacter;\r\n    property LookupCaseSensitive: Boolean read FLookupCaseSensitive write SetLookupCaseSensitive default False;\r\n    property LookupMinLength: Integer read FlookupMinLength write SetLookupMinLength default 1;\r\n\r\n    property OnRenderItem: TEditAutoCompleteRenderItemEvent read FOnRenderItem write FOnRenderItem;\r\n    property OnSelect: TEditAutoCompleteSelectEvent read FOnSelect write FOnSelect;\r\n  end;\r\n\r\n  TWebEditAutoComplete = class(TEditAutoComplete);\r\n\r\nimplementation\r\n\r\n\r\n{ TEditAutoComplete }\r\n\r\nprocedure TEditAutoComplete.BindEvents;\r\nvar\r\n  eh: TJSEventTarget;\r\nbegin\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    eh := ElementInputHandle;\r\n\r\n    eh.addEventListener('change',@HandleDoChange);\r\n    eh.addEventListener('click',@HandleDoClick);\r\n    eh.addEventListener('dblclick',@HandleDoDblClick);\r\n    eh.addEventListener('mousedown',@HandleDoMouseDown);\r\n    eh.addEventListener('mouseup',@HandleDoMouseUp);\r\n    eh.addEventListener('mousemove',@HandleDoMouseMove);\r\n    eh.addEventListener('mouseleave',@HandleDoMouseLeave);\r\n    eh.addEventListener('mouseenter',@HandleDoMouseEnter);\r\n    eh.addEventListener('keydown',@HandleDoKeyDown);\r\n    eh.addEventListener('keyup',@HandleDoKeyUp);\r\n    eh.addEventListener('keypress',@HandleDoKeyPress);\r\n    eh.addEventListener('focus',@HandleDoEnter);\r\n    eh.addEventListener('blur',@HandleDoExit);\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.Change;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n    FText := ElementInputHandle.value;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TEditAutoComplete.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure TEditAutoComplete.CreateInitialize;\r\nbegin\r\n  FItems := TStringList.Create;\r\n  FText := '';\r\n  FItemIndex := -1;\r\n  FPopupHeight := 0;\r\n  FPopupClassName := '';\r\n  FItemClassName := '';\r\n  FActiveItemClassName := '';\r\n  FLookupType := ltFirstCharacter;\r\n  FLookupMinLength := 1;\r\n  FLookupCaseSensitive := False;\r\n\r\n  inherited;\r\n\r\n  TabStop := True;\r\n  ReadOnly := False;\r\n  ElementFont := efProperty;\r\n  CharCase := wecNormal;\r\n  Width := 121;\r\n  Height := 25;\r\nend;\r\n\r\ndestructor TEditAutoComplete.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TEditAutoComplete.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(ElementHandle.childNodes[0]);\r\nend;\r\n\r\nfunction TEditAutoComplete.GetItemIndex: Integer;\r\nbegin\r\n  Result := FItemIndex;\r\n\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  Result := Items.IndexOf(Text);\r\nend;\r\n\r\nfunction TEditAutoComplete.GetText: string;\r\nvar\r\n  input: TJSHTMLInputElement;\r\nbegin\r\n  Result := FText;\r\n\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  input := TJSHTMLInputElement(ElementHandle.childNodes[0]);\r\n  if Assigned(input) then\r\n    Result := input.value;\r\nend;\r\n\r\nfunction TEditAutoComplete.HandleDoChange(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nfunction TEditAutoComplete.HandleRenderItem(Item: TJSHTMLElement; Index: Integer): TJSHTMLElement;\r\nvar\r\n  Args: TEditAutoCompleteRenderItemEventArgs;\r\nbegin\r\n  if Assigned(OnRenderItem) then\r\n  begin\r\n    Args := TEditAutoCompleteRenderItemEventArgs.Create;\r\n    Args.ItemElement := Item;\r\n    Args.ItemIndex := Index;\r\n    OnRenderItem(Self, Args);\r\n    Args.Free;\r\n  end;\r\n  Result := Item;\r\nend;\r\n\r\nfunction TEditAutoComplete.HandleSelect(Index: Integer): Boolean;\r\nvar\r\n  Args: TEditAutoCompleteSelectEventArgs;\r\nbegin\r\n  if Assigned(OnSelect) then\r\n  begin\r\n    Args := TEditAutoCompleteSelectEventArgs.Create;\r\n    Args.ItemIndex := Index;\r\n    OnSelect(Self, Args);\r\n    Args.Free;\r\n  end;\r\n\r\n  Result := True;\r\nend;\r\n\r\nprocedure TEditAutoComplete.Refresh;\r\nbegin\r\n //\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetActiveItemClassName(const Value: string);\r\nbegin\r\n  if FActiveItemClassName <> Value then\r\n  begin\r\n    FActiveItemClassName := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetCharcase(const Value: TEditCharCase);\r\nbegin\r\n  if FCharCase <> Value then\r\n  begin\r\n    FCharCase := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetItemClassName(const Value: string);\r\nbegin\r\n  if FItemClassName <> Value then\r\n  begin\r\n    FItemClassName := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetItemIndex(const Value: Integer);\r\nbegin\r\n  if (FItemIndex <> Value) and (Value < Items.Count) then\r\n  begin\r\n    FItemIndex := Value;\r\n    if FItemIndex >= 0 then\r\n      Text := Items[FItemIndex]\r\n    else\r\n      Text := '';\r\n    UpdateElement;\r\n  end;\r\n\r\n  if Value = -100 then\r\n  begin\r\n    HandleRenderItem(nil,-100);\r\n    HandleSelect(-100);\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetItems(const Value: TStringList);\r\nbegin\r\n  FItems.Assign(Value);\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetLookupCaseSensitive(const Value: Boolean);\r\nbegin\r\n  if FlookupCaseSensitive <> Value then\r\n  begin\r\n    FLookupCaseSensitive := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetLookupMinLength(const Value: Integer);\r\nbegin\r\n  if (FLookupMinLength <> Value) and (Value > 0) then\r\n  begin\r\n    FlookupMinLength := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetLookupType(\r\n  const Value: TEditAutoCompleteLookupType);\r\nbegin\r\n  if FLookupType <> Value then\r\n  begin\r\n    FLookupType := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetPopupClassName(const Value: string);\r\nbegin\r\n  if FPopupClassName <> Value then\r\n  begin\r\n    FPopupClassName := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetPopupHeight(const Value: Integer);\r\nbegin\r\n  if FPopupHeight <> Value then\r\n  begin\r\n    FPopupHeight := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetReadOnly(const Value: boolean);\r\nbegin\r\n  if FReadOnly <> Value then\r\n  begin\r\n    FReadOnly := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetText(const Value: string);\r\nbegin\r\n  if FText <> Value then\r\n  begin\r\n    FText := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.SetTextHint(const Value: string);\r\nbegin\r\n  if FTextHint <> Value then\r\n  begin\r\n    FTextHint := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TEditAutoComplete.AddScript(Script: string);\r\nbegin\r\n  asm\r\n    var scrObj = document.createElement('script');\r\n    scrObj.innerHTML = Script;\r\n    document.head.appendChild(scrObj);\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TEditAutoComplete.UpdateElement;\r\nvar\r\n  elid, sstyle: string;\r\n  classpopup, classitem, classactive: string;\r\n  newel: TJSHTMLElement;\r\n  itemdata: TJSArray;\r\n  I: Integer;\r\n  spopup, tabindex: string;\r\n  cl: TObject;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if not Assigned(ElementHandle) then\r\n    Exit;\r\n\r\n  elid := ElementID + '_input';\r\n\r\n  if PopupClassName = '' then\r\n    classpopup := ElementID + '_autocomplete-items'\r\n  else\r\n    classpopup := PopupClassName;\r\n\r\n  if ItemClassName = '' then\r\n    classitem := ElementID + '_autocomplete-item'\r\n  else\r\n    classitem := ItemClassName;\r\n\r\n  if ActiveItemClassName = '' then\r\n    classactive := ElementID + '_active-item'\r\n  else\r\n    classactive := ActiveItemClassName;\r\n\r\n  ElementHandle.style.setProperty('overflow', 'visible');\r\n  ElementHandle.setAttribute('tabindex', '-1');\r\n  ElementHandle.removeAttribute('class');\r\n  while ElementHandle.hasChildNodes do\r\n    ElementHandle.removeChild(ElementHandle.firstChild);\r\n\r\n  newel := TJSHTMLElement(document.createElement('input'));\r\n  if ElementClassName <> '' then\r\n    newel.setAttribute('class', ElementClassName);\r\n  newel.setAttribute('type', 'text');\r\n  newel.setAttribute('id', elid);\r\n  newel.setAttribute('autocomplete','off');\r\n  newel.style.setProperty('width', '100%');\r\n  newel.style.setProperty('height', '100%');\r\n\r\n  if Enabled then\r\n    newel.removeAttribute('disabled')\r\n  else\r\n    newel.setAttribute('disabled', 'true');\r\n\r\n  if ReadOnly then\r\n    newel.setAttribute('readonly', 'true')\r\n  else\r\n    newel.removeAttribute('readonly');\r\n\r\n  if TabStop then\r\n    tabindex := IntToStr(TabOrder)\r\n  else\r\n    tabindex := '-1';\r\n  newel.setAttribute('tabindex', tabindex);\r\n\r\n  newel.setAttribute('placeholder', TextHint);\r\n\r\n  newel.style.setProperty('background-color', ColorToHtml(color));\r\n\r\n  if ElementClassName = '' then\r\n  begin\r\n    if Enabled and (ElementFont = efProperty) then\r\n      newel.style.setProperty('color', ColorToHtml(Font.Color));\r\n  end;\r\n\r\n  SetHTMLElementFont(newel, Font, not ((ElementClassName = '') and (ElementFont = efProperty)));\r\n\r\n  case CharCase of\r\n    wecUpperCase: newel.style.setProperty('text-transform', 'uppercase');\r\n    wecLowerCase: newel.style.setProperty('text-transform', 'lowercase');\r\n    wecMixedCase: newel.style.setProperty('text-transform', 'capitalize');\r\n    wecNormal: newel.style.setProperty('text-transform', 'initial');\r\n  end;\r\n\r\n//  newel.style.setProperty('width', IntToStr(Width) + 'px');\r\n//  newel.style.setProperty('height', IntToStr(Height) + 'px');\r\n  newel.style.setProperty('box-sizing', 'border-box');\r\n  newel.setAttribute('value', Text);\r\n  ElementHandle.appendChild(newel);\r\n\r\n  newel := TJSHTMLElement(document.createElement('input'));\r\n  newel.setAttribute('type', 'hidden');\r\n  newel.setAttribute('id', elid + 'index');\r\n  ElementHandle.appendChild(newel);\r\n\r\n  BindEvents;\r\n\r\n  if PopupHeight > 0 then\r\n  begin\r\n    spopup :=\r\n      '  max-height: ' + IntToStr(PopupHeight) + 'px;' + #13 +\r\n      '  overflow: auto;' + #13;\r\n  end;\r\n\r\n  sstyle :=\r\n    '#' + ElementID + ' input[type=text] {' + #13 +\r\n    '  width: 100%;' + #13 +\r\n    '}' + #13 +\r\n\r\n    '.' + classpopup + ' {' + #13 +\r\n    '  position: absolute;' + #13 +\r\n    '  z-index: 99;' + #13 +\r\n    '  top: 100%;' + #13 +\r\n    '  min-width: 100%;' + #13 +\r\n//    '  width: 100%;' + #13 +\r\n    '  left: 0;' + #13 +\r\n//    '  right: 0;' + #13 +\r\n    spopup;\r\n\r\n  if PopupClassName = '' then\r\n  begin\r\n    sstyle := sstyle +\r\n      '  background-color: #fff;' + #13 +\r\n      '  border: 1px solid #d4d4d4;'\r\n  end;\r\n\r\n  sstyle := sstyle +\r\n    '}' + #13;\r\n\r\n  if ItemClassName = '' then\r\n  begin\r\n    sstyle := sstyle +\r\n      '.' + classitem + ' {' + #13 +\r\n      '  padding: 10px;' + #13 +\r\n      '  cursor: pointer;' + #13 +\r\n      '  border-bottom: 1px solid #d4d4d4;' + #13 +\r\n      '}' + #13 +\r\n\r\n      '.' + classitem + ':hover {' + #13 +\r\n      '  background-color: #e9e9e9 !important;' + #13 +\r\n      '}' + #13;\r\n  end;\r\n\r\n  if ActiveItemClassName = '' then\r\n  begin\r\n    sstyle := sstyle +\r\n      '.' + classactive + ' {' + #13 +\r\n      '  background-color: #e9e9e9 !important;' + #13 +\r\n      '  color: #000;' + #13 +\r\n      '}';\r\n  end;\r\n\r\n  AddInstanceStyle(sstyle);\r\n\r\n  AddScript(\r\n    'function doautocomplete(inp, hinp, arr, myclass) {' + #13 +\r\n    '  var currentFocus;' + #13 +\r\n    '  inp.addEventListener(\"input\", function(e) {' + #13 +\r\n    '      var a, b, i, h, lookup, minlength, cs, found, val = this.value;' + #13 +\r\n    '      lookup = ' + IntToStr(Ord(LookupType)) + ';' + #13 +\r\n    '      minlength = ' + IntToStr(LookupMinLength) + ';' + #13 +\r\n    '      cs = ' + BoolToStr(LookupCaseSensitive) + ';' + #13 +\r\n\r\n    '      ' + elid + 'closeAllLists();' + #13 +\r\n\r\n    '      if (!val) { return false;}' + #13 +\r\n    '      if (val.length < minlength) { return false;}' + #13 +\r\n\r\n    '      currentFocus = -1;' + #13 +\r\n    '      a = document.createElement(\"DIV\");' + #13 +\r\n    '      a.setAttribute(\"id\", this.id + \"autocomplete-list\");' + #13 +\r\n    '      a.setAttribute(\"class\", \"' + classpopup + '\");' + #13 +\r\n    '      a.addEventListener(\"mousedown\", function (e) {' + #13 +\r\n    '           e.preventDefault();' + #13 +\r\n    '      });' + #13 +\r\n    '      this.parentNode.appendChild(a);' + #13 +\r\n    '      for (i = 0; i < arr.length; i++) {' + #13 +\r\n    '        var q = val;' + #13 +\r\n    '        var l = arr[i];' + #13 +\r\n    '        var s = l;' + #13 +\r\n    '        if (!cs) {' + #13 +\r\n    '          q = q.toUpperCase();' + #13 +\r\n    '          l = l.toUpperCase();' + #13 +\r\n    '        }' + #13 +\r\n\r\n    '        found = false;' + #13 +\r\n    '        if ((lookup == 0) && (l.substr(0, q.length) == q)) {' + #13 +\r\n    '          found = true;' + #13 +\r\n    '          s = \"<strong>\" + arr[i].substr(0, val.length) + \"</strong>\";' + #13 +\r\n    '          s += arr[i].substr(val.length);' + #13 +\r\n    '        }' + #13 +\r\n    '        else if ((lookup == 1) && (l.indexOf(q) >= 0)) {' + #13 +\r\n    '          found = true;' + #13 +\r\n    '          s = arr[i].substr(0, l.indexOf(q));' + #13 +\r\n    '          s += \"<strong>\" + arr[i].substr(l.indexOf(q), val.length) + \"</strong>\";' + #13 +\r\n    '          s += arr[i].substr(l.indexOf(q) + val.length);' + #13 +\r\n    '        }' + #13 +\r\n\r\n    '        if (found) {' + #13 +\r\n    '          b = document.createElement(\"DIV\");' + #13 +\r\n    '          b.setAttribute(\"id\", this.id + \"|\" + i);' + #13 +\r\n    '          b.setAttribute(\"class\", \"' + classitem + '\");' + #13 +\r\n    '          b.innerHTML = s;' + #13 +\r\n    '          b = myclass.HandleRenderItem(b, i);'+\r\n    '          b.addEventListener(\"click\", function(e) {' + #13 +\r\n    '              var selindex = this.id.substring(this.id.indexOf(\"|\") + 1, this.id.length);' + #13 +\r\n    '              inp.value = arr[selindex]' + #13 +\r\n    '              inp.focus();' + #13 +\r\n    '              hinp.value = selindex;' + #13 +\r\n    '              myclass.HandleSelect(selindex);'+\r\n    '              ' + elid + 'closeAllLists();' + #13 +\r\n    '          });' + #13 +\r\n    '          a.appendChild(b);' + #13 +\r\n    '        }' + #13 +\r\n    '      }' + #13 +\r\n    '      if (a.childNodes.length <= 0) ' + elid + 'closeAllLists();'+\r\n    '  });' + #13 +\r\n\r\n    '  inp.addEventListener(\"blur\", function(e) {' + #13 +\r\n    '       ' + elid + 'closeAllLists(e.target, true);' + #13 +\r\n    '  });' + #13 +\r\n\r\n    '  inp.addEventListener(\"keydown\", function(e) {' + #13 +\r\n    '      var popup = document.getElementById(this.id + \"autocomplete-list\");' + #13 +\r\n    '      var x;' + #13 +\r\n    '      if (popup) x = popup.getElementsByTagName(\"div\");' + #13 +\r\n    '      if (x) {' + #13 +\r\n    '        if (e.keyCode == 27) {' + #13 +\r\n    '         ' + elid + 'closeAllLists(e.target, true);' + #13 +\r\n    '        } else if (e.keyCode == 40) {' + #13 +\r\n    '          currentFocus++;' + #13 +\r\n    '          ' + elid + 'addActive(x);' + #13 +\r\n    '          if ((x[currentFocus].offsetTop + x[currentFocus].offsetHeight) > (popup.offsetHeight + popup.scrollTop))' +\r\n    '            popup.scrollTop = ((x[currentFocus].offsetTop + x[currentFocus].offsetHeight) - popup.offsetHeight);' + #13 +\r\n    '        } else if (e.keyCode == 38) { ' + #13 +\r\n    '          currentFocus--;' + #13 +\r\n    '          ' + elid + 'addActive(x);' + #13 +\r\n    '          if ((x[currentFocus].offsetTop) < (popup.scrollTop))' +\r\n    '            popup.scrollTop = (x[currentFocus].offsetTop);' + #13 +\r\n    '        } else if (e.keyCode == 13) {' + #13 +\r\n    '          e.preventDefault();' + #13 +\r\n    '          if (currentFocus > -1) {' + #13 +\r\n    '            if (x) x[currentFocus].click();' + #13 +\r\n    '          }' + #13 +\r\n    '        }' + #13 +\r\n    '      }' + #13 +\r\n    '  });' + #13 +\r\n    '  function ' + elid + 'addActive(x) {' + #13 +\r\n    '    if (!x) return false;' + #13 +\r\n    '    ' + elid + 'removeActive(x);' + #13 +\r\n    '    if (currentFocus >= x.length) currentFocus = x.length - 1;' + #13 +\r\n    '    if (currentFocus < 0) currentFocus = 0;' + #13 +\r\n    '    x[currentFocus].classList.add(\"' + classactive + '\");' + #13 +\r\n    '  }' + #13 +\r\n    '  function ' + elid + 'removeActive(x) {' + #13 +\r\n    '    for (var i = 0; i < x.length; i++) {' + #13 +\r\n    '      x[i].classList.remove(\"' + classactive + '\");' + #13 +\r\n    '    }' + #13 +\r\n    '  }' + #13 +\r\n    '  function ' + elid + 'closeAllLists(elmnt, doblur) {' + #13 +\r\n    '    var x = document.getElementsByClassName(\"' + classpopup + '\");' + #13 +\r\n    '    var isinput = (elmnt != inp);' + #13 +\r\n    '    if (doblur) isinput = (elmnt == inp);' + #13 +\r\n    '    for (var i = 0; i < x.length; i++) {' + #13 +\r\n    '      if (elmnt != x[i] && isinput) {' + #13 +\r\n    '        x[i].parentNode.removeChild(x[i]);' + #13 +\r\n    '      }' + #13 +\r\n    '    }' + #13 +\r\n    '  }' + #13 +\r\n    '  document.addEventListener(\"click\", function (e) {' + #13 +\r\n    '       ' + elid + 'closeAllLists(e.target);' + #13 +\r\n    '  });' + #13 +\r\n    '}'\r\n  );\r\n\r\n  itemdata := TJSArray.new;\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    itemdata.push(Items[I]);\r\n  end;\r\n\r\n  cl := Self;\r\n  asm\r\n    //cl = this;\r\n    var el = document.getElementById(elid);\r\n    var elindex = document.getElementById(elid + 'index');\r\n    if (el && elindex)\r\n      doautocomplete(el, elindex, itemdata, cl);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018 - 2020                               }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.DBCtrls;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, DB, SysUtils, WEBLib.Controls, WEBLib.StdCtrls, WEBLib.ExtCtrls,\r\n  WEBLib.Buttons, WEBLib.Grids, WEBLib.Mask, WEBLib.EditAutoComplete, Web;\r\n\r\ntype\r\n  TWebLinkType = (wlHttp, wlMail, wlHttps, wlFTP);\r\n\r\n  TNavigateBtn = (nbFirst, nbPrior, nbNext, nbLast,\r\n                  nbInsert, nbDelete, nbEdit, nbPost, nbCancel);\r\n\r\n  TNavButtonSet = set of TNavigateBtn;\r\n\r\n  TFieldDataLink = class(TDataLink)\r\n  private\r\n    FOnDataChange: TNotifyEvent;\r\n    FOnUpdateData: TNotifyEvent;\r\n    FOnActiveChange: TNotifyEvent;\r\n    FField: TField;\r\n    FFieldName: string;\r\n    FModified: boolean;\r\n  protected\r\n    procedure UpdateField;\r\n    procedure ActiveChanged; override;\r\n    //procedure DataEvent(Event: TDataEvent; Info: NativeInt); override;\r\n    //procedure EditingChanged; override;\r\n    procedure RecordChanged(Field: TField); override;\r\n    procedure UpdateData; override;\r\n  public\r\n    property Field: TField read FField write FField;\r\n    procedure Modified;\r\n  published\r\n    property FieldName: string read FFieldName write FFieldName;\r\n    property OnDataChange: TNotifyEvent read FOnDataChange write FOnDataChange;\r\n    property OnUpdateData: TNotifyEvent read FOnUpdateData write FOnUpdateData;\r\n    property OnActiveChange: TNotifyEvent read FOnActiveChange write FOnActiveChange;\r\n  end;\r\n\r\n  TDBDataLink = class(TDataLink)\r\n  private\r\n    FOnActiveChange: TNotifyEvent;\r\n    FOnDataChange: TNotifyEvent;\r\n    FOnRecordChange: TNotifyEvent;\r\n    FOnUpdateData: TNotifyEvent;\r\n  protected\r\n    procedure DataSetChanged; override;\r\n    procedure ActiveChanged; override;\r\n    procedure RecordChanged(Field: TField); override;\r\n    procedure UpdateData; override;\r\n  published\r\n    property OnRecordChange: TNotifyEvent read FOnRecordChange write FOnRecordChange;\r\n    property OnDataChange: TNotifyEvent read FOnDataChange write FOnDataChange;\r\n    property OnActiveChange: TNotifyEvent read FOnActiveChange write FOnActiveChange;\r\n    property OnUpdateData: TNotifyEvent read FOnUpdateData write FOnUpdateData;\r\n  end;\r\n\r\n  TDBEdit = class(TEdit)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n  protected\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    function CheckDataSet: boolean; virtual;\r\n    function EditCanModify: Boolean; virtual;\r\n    function IsReadOnly: boolean; override;\r\n    function GetDisplayText: string; override;\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure KeyPress(var Key: Char); override;\r\n    procedure DoExit; override;\r\n    function CanPaste(AValue: string): boolean; override;\r\n    function CanCut: boolean; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Change; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n  end;\r\n\r\n  TWebDBEdit = class(TDBEdit);\r\n\r\n  TDBMaskEdit = class(TMaskEdit)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n    FFieldText: string;\r\n    function GetDataField: string;\r\n    function GetDataSource: TDataSource;\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n  protected\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    function CheckDataSet: boolean; virtual;\r\n    function EditCanModify: Boolean; override;\r\n    function IsReadOnly: boolean; override;\r\n    function GetDisplayText: string; override;\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure KeyPress(var Key: Char); override;\r\n    procedure DoExit; override;\r\n    function CanPaste(AValue: string): boolean; override;\r\n    function CanCut: boolean; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Change; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n  end;\r\n\r\n  TWebDBMaskEdit = class(TDBMaskEdit);\r\n\r\n\r\n  TDBLabel = class(TLabel)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n  protected\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    function CheckDataSet: boolean; virtual;\r\n    function GetDisplayText: string; override;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n  end;\r\n\r\n  TWebDBLabel = class(TDBLabel);\r\n\r\n  TDBSpinEdit = class(TSpinEdit)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n  protected\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    function EditCanModify: Boolean; virtual;\r\n    function IsReadOnly: boolean; override;\r\n    function CheckDataSet: boolean; virtual;\r\n    function GetDisplayText: string; override;\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure KeyPress(var Key: Char); override;\r\n    procedure Change; override;\r\n    procedure DoExit; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n  end;\r\n\r\n  TWebDBSpinEdit = class(TDBSpinEdit);\r\n\r\n  TDBCheckBox = class(TCheckBox)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n    FValueChecked: string;\r\n    FValueUnChecked: string;\r\n  protected\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    function CheckDataSet: boolean; virtual;\r\n    function EditCanModify: Boolean; virtual;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure Click; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n    property ValueChecked: string read FValueChecked write FValueChecked;\r\n    property ValueUnChecked: string read FValueUnChecked write FValueUnChecked;\r\n  end;\r\n\r\n  TWebDBCheckBox = class(TDBCheckBox);\r\n\r\n  TDBDateTimePicker = class(TDateTimePicker)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n  protected\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    function CheckDataSet: boolean; virtual;\r\n    function EditCanModify: Boolean; virtual;\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure KeyPress(var Key: Char); override;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure Change; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n  end;\r\n\r\n  TWebDBDateTimePicker = class(TDBDateTimePicker);\r\n\r\n  TDBComboBox = class(TComboBox)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n  protected\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    function EditCanModify: Boolean; virtual;\r\n    function CheckDataSet: boolean; virtual;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure Change; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n  end;\r\n\r\n  TWebDBComboBox = class(TDBComboBox);\r\n\r\n  TDBLookupComboBox = class(TCustomLookupComboBox)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FListLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n    FKeyField: string;\r\n    function GetListField: string;\r\n    function GetListSource: TDataSource;\r\n    procedure SetListField(const Value: string);\r\n    procedure SetListSource(const Value: TDataSource);\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    procedure SetKeyField(const Value: string);\r\n  protected\r\n    function CheckDataSet: boolean; virtual;\r\n    function EditCanModify: Boolean; virtual;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure ListActiveChange(Sender: TObject);\r\n    procedure Change; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n    property KeyField: string read FKeyField write SetKeyField;\r\n    property ListField: string read GetListField write SetListField;\r\n    property ListSource: TDataSource read GetListSource write SetListSource;\r\n  end;\r\n\r\n  TWebDBLookupComboBox = class(TDBLookupComboBox);\r\n\r\n  TDBEditAutoComplete = class(TEditAutoComplete)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n  protected\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    function EditCanModify: Boolean; virtual;\r\n    function CheckDataSet: boolean; virtual;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure KeyPress(var Key: Char); override;\r\n    procedure DoExit; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Change; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n  end;\r\n\r\n  TWebDBEditAutoComplete = class(TDBEditAutoComplete);\r\n\r\n\r\n  TDBRadioGroup = class(TRadioGroup)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n    FValues: TStringList;\r\n  protected\r\n    procedure SetValues(const Value: TStringList);\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    function CheckDataSet: boolean; virtual;\r\n    function EditCanModify: Boolean; virtual;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure Click; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n    property Values: TStringList read FValues write SetValues;\r\n  end;\r\n\r\n  TWebDBRadioGroup = class(TDBRadioGroup);\r\n\r\n  TDBLinkLabel = class(TCustomLinkLabel)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n    FLinkType: TWebLinkType;\r\n  protected\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    function CheckDataSet: boolean; virtual;\r\n    function GetDisplayText: string; override;\r\n    function EditCanModify: Boolean; virtual;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure Click; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n    property LinkType: TWebLinkType read FLinkType write FLinkType;\r\n  end;\r\n\r\n  TWebDBLinkLabel = class(TDBLinkLabel);\r\n\r\n  TDBMemo = class(TMemo)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FEditChange: boolean;\r\n  protected\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    function GetDataField: string;\r\n    function EditCanModify: Boolean; virtual;\r\n    function IsReadOnly: boolean; override;\r\n    function CheckDataSet: boolean; virtual;\r\n    function GetDisplayText: string; override;\r\n    procedure DataUpdate(Sender: TObject);\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure KeyPress(var Key: Char); override;\r\n    function CanPaste(AValue: string): boolean; override;\r\n    function CanCut: boolean; override;\r\n    procedure DoExit; override;\r\n    procedure Change; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n  end;\r\n\r\n  TWebDBMemo = class(TDBMemo);\r\n\r\n  TSetURLEvent = procedure(Sender: TObject; var AURL: string) of object;\r\n\r\n  TDBImageControl = class(TCustomImageControl)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FOnSetURL: TSetURLEvent;\r\n    FBaseURL: string;\r\n    function GetDataField: string;\r\n    function GetDataSource: TDataSource;\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n  protected\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property BaseURL: string read FBaseURL write FBaseURL;\r\n    property DataField: string read GetDataField write SetDataField;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n    property OnSetURL: TSetURLEvent read FOnSetURL write FOnSetURL;\r\n  end;\r\n\r\n  TWebDBImageControl = class(TDBImageControl);\r\n\r\n  TDBNavigator = class(TToolBar)\r\n  private\r\n    FDataLink: TFieldDataLink;\r\n    FFirstBtn: TSpeedButton;\r\n    FPriorBtn: TSpeedButton;\r\n    FNextBtn: TSpeedButton;\r\n    FLastBtn: TSpeedButton;\r\n    FEditBtn: TSpeedButton;\r\n    FPostBtn: TSpeedButton;\r\n    FInsertBtn: TSpeedButton;\r\n    FDeleteBtn: TSpeedButton;\r\n    FCancelBtn: TSpeedButton;\r\n    FVisibleButtons: TNavButtonSet;\r\n    FHints: TStringList;\r\n    procedure SetVisibleButtons(const Value: TNavButtonSet);\r\n    procedure SetHints(const Value: TStringList);\r\n  protected\r\n    procedure UpdateButtons;\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    procedure CreateButton(var btn: TSpeedButton; BtnID, Glyph, Hint: string);\r\n    procedure HandleSpeedButtonClick(Sender: TObject); virtual;\r\n    procedure HandleSpeedButtonMouseDown(Sender: TObject; Button: TMouseButton; Shift: TShiftState; X,Y: Integer); virtual;\r\n    procedure UpdateElement; override;\r\n    procedure Loaded; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Hints: TStringList read FHints write SetHints;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n    property VisibleButtons: TNavButtonSet read FVisibleButtons write SetVisibleButtons;\r\n  end;\r\n\r\n  TWebDBNavigator = class(TDBNavigator);\r\n\r\n  TColumnDataType = (cdText, cdImage, cdLink, cdCheck, cdRadio, cdExternalLink);\r\n\r\n  TTableControlColumn = class(TCollectionItem)\r\n  private\r\n    FDataField: string;\r\n    FTitle: string;\r\n    FDataType: TColumnDataType;\r\n    FClassName: string;\r\n    FTitleClassName: string;\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetTitle(const Value: string);\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property ElementClassName: string read FClassName write FClassName;\r\n    property DataField: string read FDataField write SetDataField;\r\n    property Title: string read FTitle write SetTitle;\r\n    property TitleElementClassName: string read FTitleClassName write FTitleClassName;\r\n    property DataType: TColumnDataType read FDataType write FDataType;\r\n  end;\r\n\r\n  TTableControlColumns = class(TOwnedCollection)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    function GetItem(Index: integer): TTableControlColumn; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TTableControlColumn); reintroduce;\r\n  protected\r\n    procedure Changed; virtual; reintroduce;\r\n    procedure Update(Item: TCollectionItem); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TTableControlColumn; reintroduce;\r\n    function Insert(Index: integer): TTableControlColumn; reintroduce;\r\n    property Items[Index: integer]: TTableControlColumn read GetItem write SetItem; default;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n\r\n  TDBTableControl = class(TCustomTableControl)\r\n  private\r\n    FDefaultFields: boolean;\r\n    FDataLink: TDBDataLink;\r\n    FColumns: TTableControlColumns;\r\n    FDataChanging: boolean;\r\n    procedure SetColumns(const Value: TTableControlColumns);\r\n  protected\r\n    procedure LoadData; virtual;\r\n    procedure LoadRow(ARow: integer); virtual;\r\n    procedure DataChange(Sender: TObject);\r\n    procedure RecordChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    procedure Loaded; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Columns: TTableControlColumns read FColumns write SetColumns;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n    property ElementFont;\r\n    property ElementClassName;\r\n    property ElementId;\r\n    property ElementPosition;\r\n  end;\r\n\r\n  TWebDBTableControl = class(TDBTableControl);\r\n\r\n  TDBResponsiveGrid = class(TResponsiveGrid)\r\n  private\r\n    FDataLink: TDBDataLink;\r\n    FModifying: boolean;\r\n    FRecordCount: integer;\r\n    FOldState: TDatasetState;\r\n    FDataChanging: boolean;\r\n  protected\r\n    procedure DataChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    function GetDataSource: TDataSource;\r\n    procedure HandleDoItemClick(Index: integer); override;\r\n    procedure LoadData; virtual;\r\n    procedure OptionsChanged(Sender: TObject); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Refresh; virtual;\r\n  published\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n    property ElementFont;\r\n    property ElementClassName;\r\n    property ElementId;\r\n    property ElementPosition;\r\n  end;\r\n\r\n  TWebDBResponsiveGrid = class(TDBResponsiveGrid);\r\n\r\n  TGridSortIndicator = (siNone, siAscending, siDescending);\r\n\r\n  TGridColumn = class(TCollectionItem)\r\n  private\r\n    FDataField: string;\r\n    FTitle: string;\r\n    FWidth: integer;\r\n    FDataType: TColumnDataType;\r\n    FClassName: string;\r\n    FTitleClassName: string;\r\n    FSortIndicator: TGridSortIndicator;\r\n    procedure SetDataField(const Value: string);\r\n    procedure SetTitle(const Value: string);\r\n    procedure SetWidth(const Value: integer);\r\n    procedure SetSortIndicator(const Value: TGridSortIndicator);\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(Collection: TCollection); override;\r\n    property SortIndicator: TGridSortIndicator read FSortIndicator write SetSortIndicator;\r\n  published\r\n    property ElementClassName: string read FClassName write FClassName;\r\n    property DataField: string read FDataField write SetDataField;\r\n    property DataType: TColumnDataType read FDataType write FDataType;\r\n    property Title: string read FTitle write SetTitle;\r\n    property TitleElementClassName: string read FTitleClassName write FTitleClassName;\r\n    property Width: integer read FWidth write SetWidth default 64;\r\n  end;\r\n\r\n  TSortIndicatorChanged = procedure(Sender: TObject; ACol: integer; AIndicator: TGridSortIndicator) of object;\r\n\r\n  TGridColumns = class(TOwnedCollection)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    FOnSortIndicatorChange: TSortIndicatorChanged;\r\n    function GetItem(Index: integer): TGridColumn; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TGridColumn); reintroduce;\r\n  protected\r\n    procedure Changed; virtual; reintroduce;\r\n    procedure Update(Item: TCollectionItem); override;\r\n    property OnSortIndicatorChange: TSortIndicatorChanged read FOnSortIndicatorChange write FOnSortIndicatorChange;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TGridColumn; reintroduce;\r\n    function Insert(Index: integer): TGridColumn; reintroduce;\r\n    property Items[Index: integer]: TGridColumn read GetItem write SetItem; default;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n\r\n  TDBGrid = class(TCustomStringGrid)\r\n  private\r\n    FDefaultFields: boolean;\r\n    FModifying: boolean;\r\n    FDataLink: TDBDataLink;\r\n    FColumns: TGridColumns;\r\n    FDataChanging: boolean;\r\n    FOldState: TDatasetState;\r\n    FOldIndicator: integer;\r\n    FShowIndicator: boolean;\r\n    function GetDataSource: TDataSource;\r\n    procedure SetColumns(const Value: TGridColumns);\r\n    procedure SetDataSource(const Value: TDataSource);\r\n    procedure SetShowIndicator(const Value: boolean);\r\n  protected\r\n    procedure LoadData; virtual;\r\n    procedure LoadRow(ARow: integer); virtual;\r\n    procedure DataChange(Sender: TObject);\r\n    procedure RecordChange(Sender: TObject);\r\n    procedure ActiveChange(Sender: TObject);\r\n    procedure ColumnsChanged(Sender: TObject);\r\n    procedure UpdateData(Sender: TObject);\r\n    procedure UpdateCell(ACol, ARow: integer; var AValue: string); override;\r\n    procedure SelectCell(ACol, ARow: integer); override;\r\n    procedure ChangeRow; override;\r\n    procedure UpdateIndicator(ARow: integer);\r\n    procedure DoCheckClick(ACol, ARow: Longint; Checked: boolean); override;\r\n    procedure DoSortIndicatorChange(Sender: TObject; ACol: integer; AIndicator: TGridSortIndicator);\r\n    function StopEdit: string; override;\r\n    procedure StartEdit(ch: string); override;\r\n    procedure Loaded; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Refresh;\r\n    procedure HideEdit; override;\r\n    procedure ShowEdit; override;\r\n    procedure EndUpdate; override;\r\n  published\r\n    property Columns: TGridColumns read FColumns write SetColumns;\r\n    property DataSource: TDataSource read GetDataSource write SetDataSource;\r\n    property ElementFont;\r\n    property ElementClassName;\r\n    property ElementId;\r\n    property ElementPosition;\r\n    property Font;\r\n    property ParentFont;\r\n    property ShowIndicator: boolean read FShowIndicator write SetShowIndicator;\r\n  end;\r\n\r\n  TWebDBGrid = class(TDBGrid);\r\n\r\nimplementation\r\n\r\nfunction CheckDB(ADataSource: TDataSource; ADataField: string; ADataLink: TDataLink): boolean;\r\nbegin\r\n  Result := false;\r\n  if Assigned(ADataSource) and (ADataSource.Enabled) and (ADataField <> '') then\r\n  begin\r\n    Result := Assigned(ADataLink.DataSet) and (ADataLink.DataSet.Active) and (ADataLink.DataSet.RecordCount > 0);\r\n  end;\r\nend;\r\n\r\nfunction FieldToCellData(AElement: TJSHTMLElement; AField: TField; ColumnDataType: TColumnDataType; Enabled: boolean): string;\r\nvar\r\n  b: boolean;\r\n  fs,t,d: string;\r\nbegin\r\n  Result := '';\r\n\r\n  case ColumnDataType of\r\n  cdText: Result := AField.DisplayText;\r\n  cdImage: Result := '<IMG src=\"'+AField.DisplayText+'\">';\r\n  cdLink: Result := '<A href=\"'+AField.DisplayText+'\">'+ AField.DisplayText+'</A>';\r\n  cdExternalLink: Result := '<A href=\"'+AField.DisplayText+'\" target=\"_blank\">'+ AField.DisplayText+'</A>';\r\n  cdCheck, cdRadio:\r\n    begin\r\n      if AField.DataType = ftBoolean then\r\n        b := AField.AsBoolean\r\n      else\r\n      begin\r\n        fs := LowerCase(AField.AsString);\r\n        b := (fs = 'y') or (fs = 'true') or (fs = '1');\r\n      end;\r\n\r\n      if ColumnDataType = cdCheck then\r\n        t := 'CHECKBOX'\r\n      else\r\n        t := 'RADIO';\r\n\r\n      if not Enabled then\r\n        d := ' DISABLED'\r\n      else\r\n        d := '';\r\n\r\n      if b then\r\n        Result := '<INPUT TYPE=\"' + t + '\" CHECKED'+ d + '>'\r\n      else\r\n        Result := '<INPUT TYPE=\"' + t + '\"' + d + '>';\r\n    end;\r\n  end;\r\nend;\r\n\r\n\r\n{ TFieldDataLink }\r\n\r\nprocedure TFieldDataLink.UpdateField;\r\nbegin\r\n  FField := nil;\r\n  if Assigned(DataSource) and Assigned(DataSource.DataSet) and (FieldName <> '') then\r\n  begin\r\n    if DataSource.DataSet.Active then\r\n      FField := DataSource.DataSet.FieldByName(FieldName);\r\n  end;\r\nend;\r\n\r\nprocedure TFieldDataLink.ActiveChanged;\r\nbegin\r\n  if not Active then\r\n    FField := nil\r\n  else\r\n    UpdateField;\r\n\r\n  if Assigned(OnActiveChange) then\r\n    OnActiveChange(Self);\r\nend;\r\n\r\nprocedure TFieldDataLink.RecordChanged(Field: TField);\r\nbegin\r\n  if (Field = nil) or (Field = FField) then\r\n  begin\r\n    if Assigned(FOnDataChange) then\r\n      FOnDataChange(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TFieldDataLink.UpdateData;\r\nbegin\r\n  if FModified then\r\n  begin\r\n    if (Field <> nil) and Assigned(FOnUpdateData) then\r\n      FOnUpdateData(Self);\r\n    FModified := False;\r\n  end;\r\nend;\r\n\r\nprocedure TFieldDataLink.Modified;\r\nbegin\r\n  FModified := true;\r\nend;\r\n\r\n{ TDBEdit }\r\n\r\nfunction TDBEdit.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nprocedure TDBEdit.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\n  FDataLink.UpdateField;\r\nend;\r\n\r\nfunction TDBEdit.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nfunction TDBEdit.GetDisplayText: string;\r\nbegin\r\n  if not CheckDataSet then\r\n    Result := ''\r\n  else\r\n    Result := inherited GetDisplayText;\r\nend;\r\n\r\nfunction TDBEdit.IsReadOnly: boolean;\r\nbegin\r\n  Result := ReadOnly or not CheckDataSet;\r\nend;\r\n\r\nprocedure TDBEdit.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\nend;\r\n\r\nprocedure TDBEdit.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\n  inherited;\r\nend;\r\n\r\ndestructor TDBEdit.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBEdit.DoExit;\r\nbegin\r\n  if not FDataLink.ReadOnly then\r\n  begin\r\n//    try\r\n      FEditChange := true;\r\n      FDataLink.UpdateRecord;     { tell data link to update database }\r\n\r\n//    except\r\n//      on Exception do\r\n//      begin\r\n//        SetFocus;   { if it failed, don't let focus leave }\r\n//        raise;\r\n//      end;\r\n//    end;\r\n  end;\r\n\r\n  inherited DoExit;\r\n\r\n  FEditChange := false;\r\nend;\r\n\r\nfunction TDBEdit.CanCut: boolean;\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  if not CheckDataSet then\r\n    Exit;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if not canedit then\r\n  begin\r\n    Result := false;\r\n    Exit;\r\n  end\r\n  else\r\n  begin\r\n    Result := inherited;\r\n    FDataLink.Edit;\r\n  end;\r\nend;\r\n\r\nfunction TDBEdit.CanPaste(AValue: string): boolean;\r\nbegin\r\n  Result := CanCut;\r\nend;\r\n\r\nprocedure TDBEdit.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    FDataLink.Field.AsString := Text;\r\n  end;\r\nend;\r\n\r\nprocedure TDBEdit.DataChange(Sender: TObject);\r\nbegin\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n    Text := FDataLink.Field.DisplayText\r\n  else\r\n    Text := '';\r\nend;\r\n\r\nprocedure TDBEdit.ActiveChange(Sender: TObject);\r\nbegin\r\n   if Assigned(FDataLink.DataSet) then\r\n   begin\r\n     if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n       Text := ''\r\n     else\r\n       DataChange(Self);\r\n   end;\r\nend;\r\n\r\nprocedure TDBEdit.KeyDown(var Key: Word; Shift: TShiftState); \r\nvar\r\n  canedit: boolean;\r\n\r\nbegin\r\n  if not CheckDataSet then\r\n    Exit;\r\n\r\n  if (Key = VK_DELETE) or (Key = VK_BACK) or ((Key = VK_INSERT) and (ssShift in Shift)) then\r\n  begin\r\n    FEditChange := true;\r\n    canedit := EditCanModify;\r\n    FEditChange := false;\r\n\r\n    if not canedit then\r\n    begin\r\n      key := 0;\r\n      inherited;\r\n      Exit;\r\n    end\r\n    else\r\n    begin\r\n      inherited;\r\n      FDataLink.Edit;\r\n    end;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TDBEdit.KeyPress(var Key: Char);\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  if not CheckDataSet then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if FDataLink.DataSet.ControlsDisabled then\r\n  begin\r\n    PreventDefault;\r\n    StopPropagation;\r\n    Exit;\r\n  end;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if not canedit then\r\n    Exit;\r\n\r\n  if {((Key >= #32) and (FDataLink.Field <> nil) and\r\n    not FDataLink.Field.IsValidChar(Key)) or} (FDataLink.ReadOnly) then\r\n  begin\r\n    Key := #0;\r\n  end;\r\n\r\n  inherited Keypress(Key);\r\nend;\r\n\r\nprocedure TDBEdit.Change;\r\nbegin\r\n  inherited;\r\n  FDataLink.Modified;\r\nend;\r\n\r\nfunction TDBEdit.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nfunction TDBEdit.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := True;\r\nend;\r\n\r\n{ TDBLabel }\r\n\r\nfunction TDBLabel.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nprocedure TDBLabel.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\n  FDataLink.UpdateField;\r\nend;\r\n\r\nfunction TDBLabel.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\n\r\nfunction TDBLabel.GetDisplayText: string;\r\nbegin\r\n  if not CheckDataSet then\r\n    Result := ''\r\n  else\r\n    Result := inherited GetDisplayText;\r\nend;\r\n\r\nprocedure TDBLabel.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\nend;\r\n\r\nfunction TDBLabel.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBLabel.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  inherited;\r\nend;\r\n\r\ndestructor TDBLabel.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBLabel.DataUpdate(Sender: TObject);\r\nbegin\r\n//  ShowMessage('data update');\r\n//  if Assigned(FDataLink.Field) then\r\n//    FDataLink.Field.Text := Caption;\r\nend;\r\n\r\nprocedure TDBLabel.DataChange(Sender: TObject);\r\nbegin\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n    Caption := FDataLink.Field.DisplayText\r\n  else\r\n    Caption := '';\r\nend;\r\n\r\nprocedure TDBLabel.ActiveChange(Sender: TObject);\r\nbegin\r\n   if Assigned(FDataLink.DataSet) then\r\n   begin\r\n     if not FDataLink.DataSet.Active or not DataSource.Enabled then \r\n       Caption := ''\r\n     else\r\n       DataChange(Self);\r\n   end;\r\nend;\r\n\r\n\r\n{ TDBNavigator }\r\n\r\nprocedure TDBNavigator.CreateInitialize;\r\nvar\r\n  css: string;\r\nbegin\r\n  inherited;\r\n\r\n  css :=\r\n    // Rules for sizing the icon.\r\n    '.material-icons.md-18 { font-size: 18px; }'+\r\n    '.material-icons.md-24 { font-size: 24px; }'+\r\n    '.material-icons.md-36 { font-size: 36px; }'+\r\n    '.material-icons.md-48 { font-size: 48px; }'+\r\n\r\n    // Rules for using icons as black on a light background.\r\n    '.material-icons.md-dark { color: rgba(0, 0, 0, 0.54); }'+\r\n    '.material-icons.md-dark.md-inactive { color: rgba(255, 0, 0, 1); }'+\r\n\r\n    // Rules for using icons as white on a dark background.\r\n    '.material-icons.md-light { color: rgba(255, 255, 255, 1); }'+\r\n    '.material-icons.md-light.md-inactive { color: rgba(128, 128, 128, 1); }';\r\n\r\n  AddControlStyle(css);\r\n\r\n  Width := 32*9;\r\n\r\n  FHints := TStringList.Create;\r\n  FHints.Add('First');\r\n  FHints.Add('Prior');\r\n  FHints.Add('Next');\r\n  FHints.Add('Last');\r\n  FHints.Add('Edit');\r\n  FHints.Add('Post');\r\n  FHints.Add('Insert');\r\n  FHints.Add('Delete');\r\n  FHints.Add('Cancel');\r\n\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n\r\n  CreateButton(FFirstBtn, ElementID+'_first', '&#xE5DC;',FHints.Strings[0]);\r\n  CreateButton(FPriorBtn, ElementID+'_prior', '&#xE5CB;',FHints.Strings[1]);\r\n  CreateButton(FNextBtn, ElementID+'_next', '&#xE5CC;',FHints.Strings[2]);\r\n  CreateButton(FLastBtn, ElementID+'_last', '&#xE5DD;',FHints.Strings[3]);\r\n\r\n  CreateButton(FEditBtn, ElementID+'_edit', '&#xE5C7;',FHints.Strings[4]);\r\n  CreateButton(FPostBtn, ElementID+'_post', '&#xE5CA;',FHints.Strings[5]);\r\n  CreateButton(FInsertBtn, ElementID+'_insert', '&#xE145;',FHints.Strings[6]);\r\n  CreateButton(FDeleteBtn, ElementID+'_delete','&#xE15B;',FHints.Strings[7]);\r\n  CreateButton(FCancelBtn, ElementID+'_cancel','&#xE14C;',FHints.Strings[8]);\r\n\r\n  FVisibleButtons := [nbFirst, nbPrior, nbNext, nbLast,\r\n                  nbInsert, nbDelete, nbEdit, nbPost, nbCancel];\r\n\r\n  UpdateButtons;\r\nend;\r\n\r\ndestructor TDBNavigator.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  FHints.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TDBNavigator.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\nend;\r\n\r\nprocedure TDBNavigator.SetHints(const Value: TStringList);\r\nbegin\r\n  FHints.Assign(Value);\r\n  UpdateButtons;\r\nend;\r\n\r\nprocedure TDBNavigator.SetVisibleButtons(const Value: TNavButtonSet);\r\nbegin\r\n  FVisibleButtons := Value;\r\n  UpdateButtons;\r\nend;\r\n\r\nfunction TDBNavigator.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nprocedure TDBNavigator.CreateButton(var btn: TSpeedButton; BtnID, Glyph, Hint: string);\r\nbegin\r\n  btn := TSpeedButton.Create(BtnID);\r\n  btn.Flat := true;\r\n  btn.Parent := Self;\r\n  btn.MaterialGlyph := Glyph;\r\n  btn.Width := 32;\r\n  btn.Height := 24;\r\n  btn.Align := alLeft;\r\n  btn.Hint := Hint;\r\n  btn.ShowHint := Hint <> '';\r\n  btn.OnClick := HandleSpeedButtonClick;\r\n  btn.OnMouseDown := HandleSpeedButtonMouseDown;\r\nend;\r\n\r\nprocedure TDBNavigator.UpdateButtons;\r\nbegin\r\n  if Assigned(FDataLink) and Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and Assigned(FDataLink.DataSource.DataSet.Active)  then\r\n  begin\r\n    FFirstBtn.Enabled := FDataLink.DataSet.Active and not FDataLink.DataSet.BOF;\r\n    FPriorBtn.Enabled := FDataLink.DataSet.Active and not FDataLink.DataSet.BOF;\r\n    FNextBtn.Enabled := FDataLink.DataSet.Active and not FDataLink.DataSet.EOF;\r\n    FLastBtn.Enabled := FDataLink.DataSet.Active and not FDataLink.DataSet.EOF;\r\n    FPostBtn.Enabled := FDataLink.DataSet.Active  and (FDataLink.DataSet.State in [dsEdit, dsInsert]);\r\n    FEditBtn.Enabled := FDataLink.DataSet.Active  and (FDataLink.DataSet.State = dsBrowse) and not FDataLink.DataSet.IsEmpty;\r\n    FInsertBtn.Enabled := FDataLink.DataSet.Active and not (FDataLink.DataSet.State = dsInsert);\r\n    FDeleteBtn.Enabled := FDataLink.DataSet.Active and not FDataLink.DataSet.IsEmpty;\r\n    FCancelBtn.Enabled := FDataLink.DataSet.Active and (FDataLink.DataSet.State in [dsInsert, dsEdit]);\r\n  end\r\n  else\r\n  begin\r\n    FFirstBtn.Enabled := false;\r\n    FPriorBtn.Enabled := false;\r\n    FNextBtn.Enabled := false;\r\n    FLastBtn.Enabled := false;\r\n    FEditBtn.Enabled := false;\r\n    FPostBtn.Enabled := false;\r\n    FInsertBtn.Enabled := false;\r\n    FDeleteBtn.Enabled := false;\r\n    FCancelBtn.Enabled := false;\r\n  end;\r\n\r\n  FFirstBtn.Visible := nbFirst in VisibleButtons;\r\n  FPriorBtn.Visible := nbPrior in VisibleButtons;\r\n  FNextBtn.Visible := nbNext in VisibleButtons;\r\n  FLastBtn.Visible := nbLast in VisibleButtons;\r\n  FEditBtn.Visible := nbEdit in VisibleButtons;\r\n  FPostBtn.Visible := nbPost in VisibleButtons;\r\n  FInsertBtn.Visible := nbInsert in VisibleButtons;\r\n  FDeleteBtn.Visible := nbDelete in VisibleButtons;\r\n  FCancelBtn.Visible := nbCancel in VisibleButtons;\r\n\r\n  while FHints.Count < 9 do\r\n    FHints.Add('');\r\n\r\n  FFirstBtn.Hint := Hints.Strings[0];\r\n  FPriorBtn.Hint := Hints.Strings[1];\r\n  FNextBtn.Hint := Hints.Strings[2];\r\n  FLastBtn.Hint := Hints.Strings[3];\r\n  FEditBtn.Hint := Hints.Strings[4];\r\n  FPostBtn.Hint := Hints.Strings[5];\r\n  FInsertBtn.Hint := Hints.Strings[6];\r\n  FDeleteBtn.Hint := Hints.Strings[7];\r\n  FCancelBtn.Hint := Hints.Strings[8];\r\nend;\r\n\r\nprocedure TDBNavigator.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if not IsUpdating then\r\n    AddControlLink('googlematerial', 'https://fonts.googleapis.com/icon?family=Material+Icons');\r\nend;\r\n\r\nprocedure TDBNavigator.HandleSpeedButtonClick(Sender: TObject);\r\nvar\r\n  BID: string;\r\nbegin\r\n  if Assigned(DataSource) and Assigned(DataSource.DataSet) then\r\n  begin\r\n    BID := TControl(Sender).GetID;\r\n\r\n    if BID = GetID + '_first' then\r\n      FDataLink.DataSet.First;\r\n\r\n    if BID = GetID + '_prior' then\r\n      FDataLink.DataSet.Prior;\r\n\r\n    if BID = GetID + '_next' then\r\n      FDataLink.DataSet.Next;\r\n\r\n    if BID = GetID + '_last' then\r\n      FDataLink.DataSet.Last;\r\n\r\n    if BID = GetID + '_edit' then\r\n      FDataLink.DataSet.Edit;\r\n\r\n    if BID = GetID + '_insert' then\r\n      //FInsertBtn.Parent.Tag := 9;          //CAMERON 6/4/2020 disable insert button\r\n      FDataLink.DataSet.Insert;\r\n\r\n    if BID = GetID + '_delete' then\r\n      FDataLink.DataSet.Delete;\r\n\r\n    if BID = GetID + '_post' then\r\n      FDataLink.DataSet.Post;\r\n\r\n    if BID = GetID + '_cancel' then\r\n      FDataLink.DataSet.Cancel;\r\n  end;\r\nend;\r\n\r\nprocedure TDBNavigator.HandleSpeedButtonMouseDown(Sender: TObject;\r\n  Button: TMouseButton; Shift: TShiftState; X, Y: Integer);\r\nbegin\r\n  SetFocus;\r\nend;\r\n\r\nprocedure TDBNavigator.Loaded;\r\nbegin\r\n  inherited;\r\n  UpdateButtons;\r\nend;\r\n\r\nprocedure TDBNavigator.DataChange(Sender: TObject);\r\nbegin\r\n  UpdateButtons;\r\nend;\r\n\r\nprocedure TDBNavigator.ActiveChange(Sender: TObject);\r\nbegin\r\n  UpdateButtons;\r\nend;\r\n\r\n\r\n{ TDBSpinEdit }\r\n\r\nfunction TDBSpinEdit.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nprocedure TDBSpinEdit.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\n  FDataLink.UpdateField;\r\nend;\r\n\r\nfunction TDBSpinEdit.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nfunction TDBSpinEdit.GetDisplayText: string;\r\nbegin\r\n  if not CheckDataSet then\r\n    Result := ''\r\n  else\r\n    Result := inherited GetDisplayText;\r\nend;\r\n\r\nfunction TDBSpinEdit.IsReadOnly: boolean;\r\nbegin\r\n  Result := ReadOnly or not CheckDataSet;\r\nend;\r\n\r\nprocedure TDBSpinEdit.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\nend;\r\n\r\nprocedure TDBSpinEdit.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\n  inherited;\r\nend;\r\n\r\ndestructor TDBSpinEdit.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBSpinEdit.DoExit; \r\nbegin\r\n  if not FDataLink.ReadOnly then\r\n  begin\r\n//    try\r\n      FEditChange := true;\r\n      FDataLink.UpdateRecord;     { tell data link to update database }\r\n\r\n//    except\r\n//      on Exception do\r\n//      begin\r\n//        SetFocus;   { if it failed, don't let focus leave }\r\n//        raise;\r\n//      end;\r\n//    end;\r\n  end;\r\n\r\n  inherited DoExit;\r\n\r\n  FEditChange := false;\r\nend;\r\n\r\nfunction TDBSpinEdit.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := true;\r\nend;\r\n\r\nprocedure TDBSpinEdit.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    FDataLink.Field.AsInteger := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TDBSpinEdit.DataChange(Sender: TObject);\r\nbegin\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n    Value := FDataLink.Field.AsInteger\r\n  else\r\n    Value := 0;\r\nend;\r\n\r\nprocedure TDBSpinEdit.ActiveChange(Sender: TObject);\r\nbegin\r\n   if Assigned(FDataLink.DataSet) then\r\n   begin\r\n     if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n     begin\r\n       Text := '';\r\n       Value := 0;\r\n     end\r\n     else\r\n       DataChange(Self);\r\n   end;\r\nend;\r\n\r\nprocedure TDBSpinEdit.KeyDown(var Key: Word; Shift: TShiftState);\r\nvar\r\n  canedit: boolean;\r\n\r\nbegin\r\n  if not Assigned(DataSource) then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if (Key = VK_DELETE) or (Key = VK_BACK) or ((Key = VK_INSERT) and (ssShift in Shift)) then\r\n  begin\r\n    FEditChange := true;\r\n    canedit := EditCanModify;\r\n    FEditChange := false;\r\n\r\n    if not canedit then\r\n    begin\r\n      key := 0;\r\n      inherited;\r\n      Exit;\r\n    end\r\n    else\r\n    begin\r\n      inherited;\r\n      FDataLink.Edit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TDBSpinEdit.KeyPress(var Key: Char);\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  if not CheckDataSet then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if FDataLink.DataSet.ControlsDisabled then\r\n  begin\r\n    PreventDefault;\r\n    StopPropagation;\r\n    Exit;\r\n  end;\r\n\r\n  if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if not canedit then\r\n    Exit;\r\n \r\n  if {(Key >= #32) and (FDataLink.Field <> nil) and\r\n    not FDataLink.Field.IsValidChar(Key) or} (FDataLink.ReadOnly) then\r\n  begin\r\n    Key := #0;\r\n  end;\r\n\r\n  inherited Keypress(Key);\r\nend;\r\n\r\nprocedure TDBSpinEdit.Change; \r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  inherited;\r\n\r\n  if not CheckDataSet then\r\n    Exit;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if canedit then\r\n  begin\r\n    FDataLink.Edit;\r\n    FDataLink.Modified;\r\n  end;\r\nend;\r\n\r\nfunction TDBSpinEdit.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\n{ TDBCheckBox }\r\n\r\nprocedure TDBCheckBox.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\nend;\r\n\r\nprocedure TDBCheckBox.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDatalink.DataSource := Value;\r\nend;\r\n\r\nfunction TDBCheckBox.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nfunction TDBCheckBox.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nprocedure TDBCheckBox.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    if FDataLink.Field.DataType = ftString then\r\n    begin\r\n      if Checked then\r\n        FDataLink.Field.AsString := ValueChecked\r\n      else\r\n        FDataLink.Field.AsString := ValueUnChecked;\r\n    end\r\n    else\r\n      FDataLink.Field.AsBoolean := Checked;\r\n  end;\r\nend;\r\n\r\nprocedure TDBCheckBox.DataChange(Sender: TObject);\r\nbegin\r\n  Enabled := CheckDataSet;\r\n\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n  begin\r\n    if FDataLink.Field.DataType = ftString then\r\n      Checked := FDataLink.Field.AsString = ValueChecked\r\n    else\r\n      Checked := FDataLink.Field.AsBoolean;\r\n  end\r\n  else\r\n    Checked := false;\r\nend;\r\n\r\nfunction TDBCheckBox.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := true;\r\nend;\r\n\r\n\r\nprocedure TDBCheckBox.ActiveChange(Sender: TObject);\r\nbegin\r\n  Enabled := CheckDataSet;\r\n\r\n  if Assigned(FDataLink.DataSet) then\r\n  begin\r\n    if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n      Checked := false\r\n    else\r\n      DataChange(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TDBCheckBox.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\n  FValueChecked := 'True';\r\n  FValueUnChecked := 'False';\r\n  inherited;\r\nend;\r\n\r\ndestructor TDBCheckBox.Destroy; \r\nbegin\r\n  FDataLink.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TDBCheckBox.CheckDataSet: boolean;\r\nbegin\r\n   Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBCheckBox.Click;\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  inherited;\r\n\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n    Exit;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if canedit then\r\n  begin\r\n    FDataLink.Edit;\r\n    FDataLink.Modified;\r\n  end;\r\nend;\r\n\r\n{ TDBDateTimePicker }\r\n\r\nprocedure TDBDateTimePicker.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\nend;\r\n\r\nprocedure TDBDateTimePicker.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDatalink.DataSource := Value;\r\nend;\r\n\r\nfunction TDBDateTimePicker.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nprocedure TDBDateTimePicker.KeyDown(var Key: Word; Shift: TShiftState);\r\nvar\r\n  canedit: boolean;\r\n\r\nbegin\r\n  if not CheckDataSet then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if (Key = VK_DELETE) or (Key = VK_BACK) or ((Key = VK_INSERT) and (ssShift in Shift)) then\r\n  begin\r\n    FEditChange := true;\r\n    canedit := EditCanModify;\r\n    FEditChange := false;\r\n\r\n    if not canedit then\r\n    begin\r\n      key := 0;\r\n      inherited;\r\n      Exit;\r\n    end\r\n    else\r\n    begin\r\n      inherited;\r\n      FDataLink.Edit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TDBDateTimePicker.KeyPress(var Key: Char);\r\nbegin\r\n  if not CheckDataSet then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if FDataLink.DataSet.ControlsDisabled then\r\n  begin\r\n    PreventDefault;\r\n    StopPropagation;\r\n    Exit;\r\n  end;\r\n\r\n  inherited;\r\nend;\r\n\r\nfunction TDBDateTimePicker.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nprocedure TDBDateTimePicker.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    FEditChange := true;\r\n\r\n    if Kind = dtkDate then\r\n      FDataLink.Field.AsDateTime := Date\r\n    else\r\n      FDataLink.Field.AsDateTime := Time;\r\n  end;\r\n\r\n  FEditChange := false;\r\nend;\r\n\r\nprocedure TDBDateTimePicker.DataChange(Sender: TObject);\r\nbegin\r\n  Enabled := CheckDB(DataSource, DataField, FDataLink);\r\n\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n  begin\r\n    if Kind = dtkDate then\r\n      Date := FDataLink.Field.AsDateTime\r\n    else\r\n      Time := FDataLink.Field.AsDateTime;\r\n  end\r\n  else\r\n  begin\r\n    Date := 0;\r\n    Time := 0;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TDBDateTimePicker.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := true;\r\nend;\r\n\r\n\r\nprocedure TDBDateTimePicker.ActiveChange(Sender: TObject);\r\nbegin\r\n  Enabled := CheckDB(DataSource, DataField, FDataLink);\r\n\r\n  if Assigned(FDataLink.DataSet) then\r\n  begin\r\n    if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n    begin\r\n      Date := Now;\r\n    end\r\n    else\r\n      DataChange(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TDBDateTimePicker.Change;\r\nbegin\r\n  inherited;\r\n\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n    Exit;\r\n\r\n  FEditChange := true;\r\n  FDataLink.Edit;\r\n  FDataLink.Modified;\r\n  FEditChange := false;\r\nend;\r\n\r\nfunction TDBDateTimePicker.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBDateTimePicker.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\n  inherited;\r\nend;\r\n\r\ndestructor TDBDateTimePicker.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n\r\n{ TDBComboBox }\r\n\r\nprocedure TDBComboBox.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\nend;\r\n\r\nprocedure TDBComboBox.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDatalink.DataSource := Value;\r\nend;\r\n\r\nfunction TDBComboBox.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nfunction TDBComboBox.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nprocedure TDBComboBox.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    FDataLink.Field.AsString := Text;\r\n  end;\r\nend;\r\n\r\nprocedure TDBComboBox.DataChange(Sender: TObject);\r\nvar\r\n  idx: integer;\r\nbegin\r\n  Enabled := CheckDataSet;\r\n\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n  begin\r\n    idx := Items.IndexOf(FDataLink.Field.DisplayText);\r\n    ItemIndex := idx;\r\n  end\r\n  else\r\n    ItemIndex := -1;\r\nend;\r\n\r\n\r\nfunction TDBComboBox.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := true;\r\nend;\r\n\r\nprocedure TDBComboBox.Change;\r\nbegin\r\n  inherited;\r\n\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n    Exit;\r\n\r\n  FEditChange := true;\r\n  FDataLink.Edit;\r\n  FDataLink.Modified;\r\n\r\n  FEditChange := false;\r\nend;\r\n\r\nfunction TDBComboBox.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBComboBox.ActiveChange(Sender: TObject);\r\nbegin\r\n  Enabled := CheckDataSet;\r\n\r\n  if Assigned(FDataLink.DataSet) then\r\n  begin\r\n\r\n    if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n    begin\r\n      Text := '';\r\n    end\r\n    else\r\n      DataChange(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TDBComboBox.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\n  inherited;\r\nend;\r\n\r\ndestructor TDBComboBox.Destroy; \r\nbegin\r\n  FDataLink.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n{ TDBRadioGroup }\r\n\r\nprocedure TDBRadioGroup.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\nend;\r\n\r\nprocedure TDBRadioGroup.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDatalink.DataSource := Value;\r\nend;\r\n\r\nfunction TDBRadioGroup.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nfunction TDBRadioGroup.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nprocedure TDBRadioGroup.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    if FDataLink.Field.DataType = ftString then\r\n    begin\r\n      if Values.Count > ItemIndex then\r\n        FDataLink.Field.AsString := Values[ItemIndex];\r\n    end\r\n    else    \r\n      FDataLink.Field.AsInteger := ItemIndex;\r\n  end;\r\nend;\r\n\r\nprocedure TDBRadioGroup.DataChange(Sender: TObject);\r\nbegin\r\n  Enabled := CheckDataSet;\r\n\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n  begin\r\n    if FDataLink.Field.DataType = ftString then\r\n    begin\r\n       ItemIndex := Values.IndexOf(FDataLink.Field.AsString);\r\n    end\r\n    else\r\n      ItemIndex := FDataLink.Field.AsInteger;\r\n  end\r\n  else\r\n    ItemIndex := -1;\r\nend;\r\n\r\n\r\nfunction TDBRadioGroup.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := true;\r\nend;\r\n\r\nfunction TDBRadioGroup.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBRadioGroup.Click;\r\nbegin\r\n  inherited;\r\n\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  FDataLink.Edit;\r\n  FDataLink.Modified; \r\nend;\r\n\r\nprocedure TDBRadioGroup.ActiveChange(Sender: TObject);\r\nbegin\r\n  Enabled := CheckDataSet;\r\n  if Assigned(FDataLink.DataSet) then\r\n  begin\r\n    if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n    begin\r\n      ItemIndex := -1;\r\n    end\r\n    else\r\n      DataChange(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TDBRadioGroup.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\n  FValues := TStringList.Create;\r\n  inherited;\r\nend;\r\n\r\ndestructor TDBRadioGroup.Destroy; \r\nbegin\r\n  FValues.Free;\r\n  FDataLink.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TDBRadioGroup.SetValues(const Value: TStringList);\r\nbegin\r\n  FValues.Assign(Value);\r\nend;\r\n\r\n\r\n{ TDBLinkLabel }\r\n\r\nprocedure TDBLinkLabel.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\nend;\r\n\r\nprocedure TDBLinkLabel.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDatalink.DataSource := Value;\r\nend;\r\n\r\nfunction TDBLinkLabel.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nfunction TDBLinkLabel.GetDisplayText: string;\r\nbegin\r\n  if not CheckDataSet then\r\n    Result := ''\r\n  else\r\n    Result := inherited GetDisplayText;\r\nend;\r\n\r\nfunction TDBLinkLabel.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nprocedure TDBLinkLabel.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n  end;\r\nend;\r\n\r\nprocedure TDBLinkLabel.DataChange(Sender: TObject);\r\nvar\r\n  url, protocol: string;\r\nbegin\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n  begin\r\n    case LinkType of\r\n    wlHttp: protocol := 'http://';\r\n    wlHttps: protocol := 'https://';\r\n    wlMail: protocol := 'mailto:';\r\n    wlFTP: protocol := 'ftp://';\r\n    end;\r\n\r\n    url := '<a href=\"' + protocol + FDataLink.Field.AsString + '\">' + FDataLink.Field.AsString + '</a>';\r\n    Caption := url;\r\n  end\r\n  else\r\n    Caption := '';\r\nend;\r\n\r\n\r\nfunction TDBLinkLabel.EditCanModify: Boolean; \r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nfunction TDBLinkLabel.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBLinkLabel.Click;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBLinkLabel.ActiveChange(Sender: TObject);\r\nbegin\r\n   if Assigned(FDataLink.DataSet) then\r\n   begin\r\n     if not FDataLink.DataSet.Active or not DataSource.Enabled then \r\n     begin\r\n       Caption := '';\r\n     end\r\n     else\r\n       DataChange(Self);\r\n   end;\r\nend;\r\n\r\nprocedure TDBLinkLabel.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\n  FLinkType := wlHttp;\r\n  inherited;\r\nend;\r\n\r\ndestructor TDBLinkLabel.Destroy; \r\nbegin\r\n  FDataLink.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n\r\n\r\n{ TDBMemo }\r\n\r\nprocedure TDBMemo.ActiveChange(Sender: TObject);\r\nbegin\r\n   if Assigned(FDataLink.DataSet) then\r\n   begin\r\n     if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n       Lines.Text := ''\r\n     else\r\n       DataChange(Self);\r\n   end;\r\nend;\r\n\r\nfunction TDBMemo.CanCut: boolean;\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  if not CheckDataSet then\r\n    Exit;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if not canedit then\r\n  begin\r\n    Result := false;\r\n    Exit;\r\n  end\r\n  else\r\n  begin\r\n    Result := inherited;\r\n    FDataLink.Edit;\r\n  end;\r\nend;\r\n\r\nfunction TDBMemo.CanPaste(AValue: string): boolean;\r\nbegin\r\n  Result := CanCut;\r\nend;\r\n\r\nprocedure TDBMemo.Change;\r\nbegin\r\n  inherited;\r\n  FDataLink.Modified;\r\nend;\r\n\r\nfunction TDBMemo.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBMemo.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBMemo.DataChange(Sender: TObject);\r\nbegin\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n    Lines.Text := FDataLink.Field.DisplayText\r\n  else\r\n    Lines.Text := '';\r\nend;\r\n\r\nprocedure TDBMemo.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    FDataLink.Field.AsString := Lines.Text;\r\n  end;\r\nend;\r\n\r\ndestructor TDBMemo.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBMemo.DoExit;\r\nbegin\r\n  if not FDataLink.ReadOnly then\r\n  begin\r\n//    try\r\n      FEditChange := true;\r\n      FDataLink.UpdateRecord;     { tell data link to update database }\r\n\r\n//    except\r\n//      on Exception do\r\n//      begin\r\n//        SetFocus;   { if it failed, don't let focus leave }\r\n//        raise;\r\n//      end;\r\n//    end;\r\n  end;\r\n\r\n  inherited DoExit;\r\n\r\n  FEditChange := false;\r\nend;\r\n\r\nfunction TDBMemo.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := true;\r\nend;\r\n\r\nfunction TDBMemo.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nfunction TDBMemo.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nfunction TDBMemo.GetDisplayText: string;\r\nbegin\r\n  if not CheckDataSet then\r\n    Result := ''\r\n  else\r\n    Result := inherited GetDisplayText;\r\nend;\r\n\r\nfunction TDBMemo.IsReadOnly: boolean;\r\nbegin\r\n  Result := ReadOnly or not CheckDataSet;\r\nend;\r\n\r\nprocedure TDBMemo.KeyDown(var Key: Word; Shift: TShiftState);\r\nvar\r\n  canedit: boolean;\r\n\r\nbegin\r\n  if not CheckDataSet then\r\n    Exit;\r\n\r\n  if (Key = VK_DELETE) or (Key = VK_BACK) or ((Key = VK_INSERT) and (ssShift in Shift)) then\r\n  begin\r\n    FEditChange := true;\r\n    canedit := EditCanModify;\r\n    FEditChange := false;\r\n\r\n    if not canedit then\r\n    begin\r\n      key := 0;\r\n      inherited;\r\n      Exit;\r\n    end\r\n    else\r\n    begin\r\n      inherited;\r\n      FDataLink.Edit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TDBMemo.KeyPress(var Key: Char);\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  if not CheckDataSet then\r\n    Exit;\r\n\r\n  if FDataLink.DataSet.ControlsDisabled then\r\n  begin\r\n    PreventDefault;\r\n    StopPropagation;\r\n    Exit;\r\n  end;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if not canedit then\r\n    Exit;\r\n\r\n  if {(Key >= #32) and (FDataLink.Field <> nil) and\r\n    not FDataLink.Field.IsValidChar(Key) or} (FDataLink.ReadOnly) then\r\n  begin\r\n    Key := #0;\r\n  end;\r\n\r\n  inherited Keypress(Key);\r\nend;\r\n\r\nprocedure TDBMemo.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\n  FDataLink.UpdateField;\r\nend;\r\n\r\nprocedure TDBMemo.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\nend;\r\n\r\n{ TDBTableControl }\r\n\r\nprocedure TDBTableControl.ActiveChange(Sender: TObject);\r\nbegin\r\n  // load data here from dataset\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not Assigned(DataSource.DataSet) then\r\n    Exit;\r\n\r\n  if DataSource.Dataset.ControlsDisabled then\r\n    Exit;\r\n\r\n  if DataSource.DataSet.Active then\r\n  begin\r\n    FDataChanging := true;\r\n    LoadData;\r\n    FDataChanging := false;\r\n  end\r\n  else\r\n  begin\r\n    RowCount := 2;\r\n    Clear;\r\n    if FDefaultFields then\r\n      Columns.Clear;\r\n  end;\r\nend;\r\n\r\nprocedure TDBTableControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  RowCount := 2;\r\n  FDataLink := TDBDataLink.Create;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FDataLink.OnRecordChange := RecordChange;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FColumns := TTableControlColumns.Create(Self);\r\n  FColumns.PropName := 'Columns';\r\n  FDefaultFields := false;\r\n  FDataChanging := false;\r\nend;\r\n\r\nprocedure TDBTableControl.DataChange(Sender: TObject);\r\nbegin\r\n  if FDataChanging then\r\n    Exit;\r\n\r\n  FDataChanging := true;\r\n\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active and (FDataLink.DataSource.DataSet.State = dsBrowse) then\r\n  begin\r\n    LoadData;\r\n  end;\r\n\r\n  FDataChanging := false;\r\nend;\r\n\r\nprocedure TDBTableControl.RecordChange(Sender: TObject);\r\nvar\r\n  r: integer;\r\nbegin\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active and (FDataLink.DataSource.DataSet.State = dsBrowse) then\r\n  begin\r\n    r := FDataLink.DataSource.DataSet.RecNo - 1;\r\n\r\n    if RowHeader then\r\n      inc(r);\r\n\r\n    LoadRow(r);\r\n  end;\r\nend;\r\n\r\ndestructor TDBTableControl.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  FColumns.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TDBTableControl.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nprocedure TDBTableControl.LoadData;\r\nvar\r\n  c,r,i: integer;\r\n  lField: TField;\r\n  noflds: boolean;\r\n  cd,cn: string;\r\n  ce: TJSHTMLElement;\r\n  bk: TBookmark;\r\n  isBOF, isEOF: boolean;\r\n\r\nbegin\r\n  isBOF := DataSource.DataSet.BOF;\r\n  isEOF := DataSource.DataSet.EOF;\r\n\r\n  bk := DataSource.DataSet.GetBookmark;\r\n\r\n  DataSource.DataSet.DisableControls;\r\n  DataSource.DataSet.First;\r\n\r\n  if RowHeader then\r\n    r := 1\r\n  else\r\n    r := 0;\r\n\r\n  noflds := true;\r\n\r\n  for i := 0 to Columns.Count - 1 do\r\n  begin\r\n    if Columns[i].DataField <> '' then\r\n      noflds := false;\r\n  end;\r\n\r\n  FDefaultFields := noflds;\r\n\r\n  if noflds and (Columns.Count > 0) then\r\n  begin\r\n    for i := 0 to DataSource.DataSet.FieldCount - 1 do\r\n    begin\r\n      if i >= Columns.Count then\r\n        Columns.Add;\r\n\r\n      with Columns[i] do\r\n      begin\r\n        DataField := DataSource.DataSet.Fields[i].FieldName;\r\n        Title :=  DataSource.DataSet.Fields[i].DisplayLabel;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if Columns.Count = 0 then\r\n  begin\r\n    for c := 0 to DataSource.DataSet.FieldCount - 1 do\r\n    begin\r\n      with Columns.Add do\r\n      begin\r\n        DataField := DataSource.DataSet.Fields[c].FieldName;\r\n        Title := DataField;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  ColCount := Columns.Count;\r\n\r\n  RowCount := DataSource.DataSet.RecordCount + r;\r\n\r\n  if RowHeader then\r\n  begin\r\n    for c := 0 to ColCount - 1 do\r\n    begin\r\n      cd := Columns[c].Title;\r\n\r\n      GetCellData(c, 0, nil, cd);\r\n      Cells[c, 0] := cd;\r\n\r\n      cn := Columns[c].TitleElementClassName;\r\n\r\n      ce := TJSHTMLElement(CellElements[c,0]);\r\n\r\n      GetCellChildren(c, 0, lField, cd, ce);\r\n\r\n      GetCellClassName(c, 0, lField, cd, cn);\r\n\r\n      if cn <> '' then\r\n      begin\r\n        ce.setAttribute('class',cn);\r\n      end;\r\n\r\n    end;\r\n  end;\r\n\r\n  while not DataSource.DataSet.EOF do\r\n  begin\r\n    LoadRow(r);\r\n    inc(r);\r\n    DataSource.DataSet.Next;\r\n  end;\r\n\r\n  if DataSource.DataSet.BookmarkValid(bk) then\r\n    DataSource.DataSet.GotoBookmark(bk);\r\n\r\n  if isBOF then\r\n    DataSource.DataSet.First;\r\n\r\n  if isEOF then\r\n    DataSource.DataSet.Last;\r\n\r\n  DataSource.DataSet.EnableControls;\r\nend;\r\n\r\nprocedure TDBTableControl.Loaded;\r\nbegin\r\n  inherited;\r\n  ColCount := Columns.Count;\r\nend;\r\n\r\nprocedure TDBTableControl.LoadRow(ARow: integer);\r\nvar\r\n  c,r: integer;\r\n  lField: TField;\r\n  cd,cn: string;\r\n  ce: TJSHTMLElement;\r\n\r\nbegin\r\n  c := 0;\r\n  r := ARow;\r\n\r\n  for c := 0 to ColCount - 1 do\r\n  begin\r\n    lField := nil;\r\n    cd := '';\r\n\r\n    ce := TJSHTMLElement(CellElements[c,r]);\r\n\r\n    if (Columns[c].DataField <> '') then\r\n    begin\r\n      lField := DataSource.DataSet.FieldByName(Columns[c].DataField);\r\n\r\n      if Assigned(lField) then\r\n        cd := FieldToCellData(ce, lField, Columns[c].DataType, false);\r\n    end;\r\n\r\n    GetCellData(c,r,lField,cd);\r\n    Cells[c,r] := cd;\r\n\r\n    cn := Columns[c].ElementClassName;\r\n\r\n    GetCellChildren(c, r, lField, cd, ce);\r\n\r\n    GetCellClassName(c, r, lField, cd, cn);\r\n\r\n    if cn <> '' then\r\n    begin\r\n      ce.setAttribute('class',cn);\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TDBTableControl.SetColumns(const Value: TTableControlColumns);\r\nbegin\r\n  FColumns.Assign(Value);\r\nend;\r\n\r\nprocedure TDBTableControl.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\nend;\r\n\r\n{ TTableControlColumns }\r\n\r\nfunction TTableControlColumns.Add: TTableControlColumn;\r\nbegin\r\n   Result := TTableControlColumn(inherited Add);\r\nend;\r\n\r\nprocedure TTableControlColumns.Changed;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nconstructor TTableControlColumns.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TTableControlColumn);\r\nend;\r\n\r\nfunction TTableControlColumns.GetItem(Index: integer): TTableControlColumn;\r\nbegin\r\n  Result := TTableControlColumn(inherited Items[Index]);\r\nend;\r\n\r\nfunction TTableControlColumns.Insert(Index: integer): TTableControlColumn;\r\nbegin\r\n  Result := TTableControlColumn(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TTableControlColumns.SetItem(Index: integer;\r\n  const Value: TTableControlColumn);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nprocedure TTableControlColumns.Update(Item: TCollectionItem);\r\nbegin\r\n  inherited;\r\n  Changed;\r\nend;\r\n\r\n{ TDBDataLink }\r\n\r\nprocedure TDBDataLink.ActiveChanged;\r\nbegin\r\n  inherited;\r\n  if Assigned(OnActiveChange) then\r\n    OnActiveChange(Self);\r\nend;\r\n\r\nprocedure TDBDataLink.DataSetChanged;\r\nbegin\r\n  inherited;\r\n  if Assigned(OnDataChange) then\r\n    OnDataChange(Self);\r\nend;\r\n\r\nprocedure TDBDataLink.RecordChanged(Field: TField);\r\nbegin\r\n  inherited;\r\n  if Assigned(OnRecordChange) then\r\n    OnRecordChange(Self);\r\nend;\r\n\r\nprocedure TDBDataLink.UpdateData;\r\nbegin\r\n  inherited;\r\n  if Assigned(OnUpdateData) then\r\n    OnUpdateData(Self);\r\nend;\r\n\r\n{ TTableControlColumn }\r\n\r\nprocedure TTableControlColumn.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TTableControlColumn) then\r\n  begin\r\n    FClassName := (Source as TTableControlColumn).ElementClassName;\r\n    FDataField := (Source as TTableControlColumn).DataField;\r\n    FTitle := (Source as TTableControlColumn).Title;\r\n    FTitleClassName := (Source as TTableControlColumn).TitleElementClassName;\r\n    FDataType := (Source as TTableControlColumn).DataType;\r\n  end;\r\nend;\r\n\r\nprocedure TTableControlColumn.SetDataField(const Value: string);\r\nbegin\r\n  if FDataField <> Value then\r\n  begin\r\n    FDataField := Value;\r\n    (Collection as TTableControlColumns).Update(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTableControlColumn.SetTitle(const Value: string);\r\nbegin\r\n  if FTitle <> Value then\r\n  begin\r\n    FTitle := Value;\r\n    (Collection as TTableControlColumns).Update(Self);\r\n  end;\r\nend;\r\n\r\n{ TDBImageControl }\r\n\r\nprocedure TDBImageControl.ActiveChange(Sender: TObject);\r\nbegin\r\n   if Assigned(FDataLink.DataSet) then\r\n   begin\r\n     if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n       URL := ''\r\n     else\r\n       DataChange(Self);\r\n   end;\r\n\r\nend;\r\n\r\nprocedure TDBImageControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\nend;\r\n\r\nprocedure TDBImageControl.DataChange(Sender: TObject);\r\nvar\r\n  AURL: string;\r\nbegin\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n  begin\r\n    AURL := BaseURL + FDataLink.Field.AsString;\r\n    if Assigned(OnSetURL) then\r\n      OnSetURL(Self, AURL);\r\n    URL := AURL;\r\n  end;\r\nend;\r\n\r\ndestructor TDBImageControl.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TDBImageControl.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nfunction TDBImageControl.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nprocedure TDBImageControl.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\n  FDataLink.UpdateField;\r\nend;\r\n\r\nprocedure TDBImageControl.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\nend;\r\n\r\n{ TDBResponsiveGrid }\r\n\r\nprocedure TDBResponsiveGrid.ActiveChange(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active then\r\n  begin\r\n    FDataChanging := true;\r\n    LoadData;\r\n    FDataChanging := false;\r\n  end\r\n  else\r\n    Items.Clear;\r\nend;\r\n\r\nprocedure TDBResponsiveGrid.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FDataChanging := false;\r\n  FDataLink := TDBDataLink.Create;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FDataLink.OnRecordChange := DataChange;\r\n  FModifying := false;\r\nend;\r\n\r\nprocedure TDBResponsiveGrid.DataChange(Sender: TObject);\r\nvar\r\n  nstate: TDataSetState;\r\nbegin\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active and not FModifying then\r\n  begin\r\n    nstate := FOldState;\r\n    FOldState := FDataLink.DataSet.State;\r\n\r\n    if not FDataChanging and (FRecordCount <> FDataLink.DataSet.RecordCount) then\r\n    begin\r\n      FDataChanging := true;\r\n      LoadData;\r\n      FDataChanging := false;\r\n    end\r\n    else\r\n    if not FDataChanging and (nstate = dsEdit) and (FDataLink.DataSet.State = dsBrowse) then\r\n    begin\r\n      FDataChanging := true;\r\n      LoadData;\r\n      FDataChanging := false;\r\n    end;\r\n\r\n    ItemIndex := FDataLink.DataSource.DataSet.RecNo - 1;\r\n\r\n  end;\r\nend;\r\n\r\ndestructor TDBResponsiveGrid.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TDBResponsiveGrid.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nprocedure TDBResponsiveGrid.HandleDoItemClick(Index: integer);\r\nbegin\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active then\r\n  begin\r\n    FModifying := true;\r\n    FDataLink.DataSource.DataSet.RecNo := Index + 1;\r\n    FModifying := false;\r\n  end;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBResponsiveGrid.Refresh;\r\nbegin\r\n  LoadData;\r\nend;\r\n\r\nprocedure TDBResponsiveGrid.LoadData;\r\nvar\r\n  html, ident, htmlvalue: string;\r\n  c: integer;\r\n  itm: TResponsiveGridItem;\r\n  bk: TBookmark;\r\nbegin\r\n  // get the items from the dataset here\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active then\r\n  begin\r\n    FDataLink.DataSource.DataSet.DisableControls;\r\n\r\n    bk := FDataLink.DataSet.GetBookmark;\r\n\r\n    Items.Clear;\r\n\r\n    FDataLink.DataSource.DataSet.First;\r\n\r\n    while not FDataLink.DataSource.DataSet.EOF do\r\n    begin\r\n      itm := Items.Add;\r\n\r\n      html := Options.ItemTemplate;\r\n      for c := 0 to FDataLink.DataSource.DataSet.Fields.Count - 1 do\r\n      begin\r\n        ident := '(%' +  FDataLink.DataSource.DataSet.Fields[c].FieldName + '%)';\r\n        if Pos(Uppercase(ident), Uppercase(html)) > 0 then\r\n        begin\r\n          htmlvalue := FDataLink.DataSource.DataSet.Fields[c].DisplayText;\r\n          DoItemGetFieldValue(itm.Index, FDataLink.DataSource.DataSet.Fields[c].FieldName, htmlvalue);\r\n          html := StringReplace(html, ident, htmlvalue, [rfReplaceAll, rfIgnoreCase]);\r\n        end;\r\n      end;\r\n\r\n      itm.HTML := html;\r\n\r\n      DoItemCreated(itm.Index);\r\n\r\n      FDataLink.DataSource.DataSet.Next;\r\n    end;\r\n\r\n    FRecordCount := FDataLink.DataSet.RecordCount;\r\n\r\n    if DataSource.DataSet.BookmarkValid(bk) then\r\n      FDataLink.DataSet.GotoBookMark(bk);\r\n\r\n    FDataLink.DataSource.DataSet.EnableControls;\r\n  end\r\n  else\r\n    Items.Clear;\r\nend;\r\n\r\nprocedure TDBResponsiveGrid.OptionsChanged(Sender: TObject);\r\nbegin\r\n  inherited;\r\n  LoadData;\r\nend;\r\n\r\nprocedure TDBResponsiveGrid.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\n  LoadData;\r\nend;\r\n\r\n\r\n{ TGridColumn }\r\n\r\nprocedure TGridColumn.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TTableControlColumn) then\r\n  begin\r\n    FClassName := (Source as TGridColumn).ElementClassName;\r\n    FDataField := (Source as TGridColumn).DataField;\r\n    FTitle := (Source as TGridColumn).Title;\r\n    FTitleClassName := (Source as TGridColumn).TitleElementClassName;\r\n    FDataType := (Source as TGridColumn).DataType;\r\n    FWidth := (Source as TGridColumn).Width;\r\n  end;\r\nend;\r\n\r\nconstructor TGridColumn.Create(Collection: TCollection);\r\nbegin\r\n  inherited;\r\n  FWidth := 64;\r\n  FDataType := cdText;\r\nend;\r\n\r\nprocedure TGridColumn.SetDataField(const Value: string);\r\nbegin\r\n  if FDataField <> Value then\r\n  begin\r\n    FDataField := Value;\r\n    (Collection as TGridColumns).Update(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TGridColumn.SetSortIndicator(const Value: TGridSortIndicator);\r\nvar\r\n  i: integer;\r\nbegin\r\n\r\n  for i := 0 to (Collection as TGridColumns).Count - 1 do\r\n  begin\r\n    (Collection as TGridColumns).Items[i].FSortIndicator := siNone;\r\n  end;\r\n\r\n  FSortIndicator := Value;\r\n\r\n  if Assigned((Collection as TGridColumns).OnSortIndicatorChange) then\r\n    (Collection as TGridColumns).OnSortIndicatorChange((Collection as TGridColumns), Index, FSortIndicator);\r\nend;\r\n\r\nprocedure TGridColumn.SetTitle(const Value: string);\r\nbegin\r\n  if FTitle <> Value then\r\n  begin\r\n    FTitle := Value;\r\n    (Collection as TGridColumns).Update(Self);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TGridColumn.SetWidth(const Value: integer);\r\nbegin\r\n  if (FWidth <> Value) then\r\n  begin\r\n    FWidth := Value;\r\n    (Collection as TGridColumns).Update(Self);\r\n  end;\r\nend;\r\n\r\n{ TGridColumns }\r\n\r\nfunction TGridColumns.Add: TGridColumn;\r\nbegin\r\n   Result := TGridColumn(inherited Add);\r\nend;\r\n\r\nprocedure TGridColumns.Changed;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nconstructor TGridColumns.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TGridColumn);\r\nend;\r\n\r\nfunction TGridColumns.GetItem(Index: integer): TGridColumn;\r\nbegin\r\n  Result := TGridColumn(inherited Items[Index]);\r\nend;\r\n\r\nfunction TGridColumns.Insert(Index: integer): TGridColumn;\r\nbegin\r\n  Result := TGridColumn(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TGridColumns.SetItem(Index: integer;\r\n  const Value: TGridColumn);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nprocedure TGridColumns.Update(Item: TCollectionItem);\r\nbegin\r\n  inherited;\r\n  Changed;\r\nend;\r\n\r\n{ TDBGrid }\r\n\r\nprocedure TDBGrid.ActiveChange(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active then\r\n  begin\r\n    FDataChanging := true;\r\n    LoadData;\r\n    FDataChanging := false;\r\n  end\r\n  else\r\n  begin\r\n    Clear;\r\n    RowCount := FixedRows;\r\n    if FDefaultFields then\r\n      Columns.Clear;\r\n    FOldIndicator := -1;\r\n  end;\r\nend;\r\n\r\nprocedure TDBGrid.ChangeRow;\r\nbegin\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active then\r\n  begin\r\n    if (FDataLink.DataSource.DataSet.State  in [dsEdit, dsInsert]) then\r\n    begin\r\n      FDataLink.DataSource.DataSet.Post;\r\n    end;\r\n  end;\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBGrid.ColumnsChanged(Sender: TObject);\r\nvar\r\n  c: integer;\r\nbegin\r\n  if not Assigned(ElementHandle) or IsUpdating then\r\n    Exit;\r\n\r\n  ColCount := Columns.Count + FixedCols;\r\n\r\n  if (FixedRows > 0) and (RowCount > 0) then\r\n  begin\r\n    for c := 0 to Columns.Count - 1 do\r\n    begin\r\n      Cells[c + FixedCols, 0] := Columns[c].Title;\r\n      ColWidths[c + FixedCols] := Columns[c].Width;\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TDBGrid.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FDataLink := TDBDataLink.Create;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FDataLink.OnRecordChange := RecordChange;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnUpdateData := UpdateData;\r\n  FColumns := TGridColumns.Create(Self);\r\n  FColumns.OnChange := ColumnsChanged;\r\n  FColumns.OnSortIndicatorChange := DoSortIndicatorChange;\r\n  FColumns.PropName := 'Columns';\r\n  FModifying := false;\r\n  FDefaultFields := false;\r\n  FDataChanging := false;\r\n  FOldIndicator := -1;\r\n  FShowIndicator := true;\r\nend;\r\n\r\nprocedure TDBGrid.DataChange(Sender: TObject);\r\nvar\r\n  r: integer;\r\nbegin\r\n  if FDataChanging then\r\n    Exit;\r\n\r\n  if (FOldState <> FDataLink.DataSource.DataSet.State) then\r\n  begin\r\n\r\n    if EditMode and (FOldState in [dsEdit, dsInsert]) then\r\n    begin\r\n      StopEdit;\r\n    end;\r\n\r\n    if (FOldState in [dsInsert]) then\r\n    begin\r\n      FDataChanging := true;\r\n      LoadData;\r\n      FDataChanging := false;\r\n      Exit;\r\n    end;\r\n  end;\r\n\r\n  FOldState := FDataLink.DataSource.DataSet.State;\r\n\r\n  if (FOldState in [{dsInsert,} dsEdit]) then\r\n    Exit;\r\n\r\n  FDataChanging := true;\r\n\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active and not FModifying and not EditMode then\r\n  begin\r\n    if (RowCount <> FDataLink.DataSource.DataSet.RecordCount + FixedRows) then\r\n    begin\r\n      LoadData;\r\n    end\r\n    else\r\n    begin\r\n      r := FixedRows + FDataLink.DataSource.DataSet.RecNo - 1;\r\n\r\n      if (FOldState = dsInsert) then\r\n      begin\r\n        RowCount := RowCount + 1;\r\n        r := RowCount - 1;\r\n        Row := RowCount - 1;\r\n        LoadRow(Row);\r\n      end\r\n      else\r\n      if r <= RowCount - 1 then\r\n      begin\r\n        Row := r;\r\n        LoadRow(r);\r\n      end\r\n      else\r\n      begin\r\n        LoadData;\r\n        Row := r;\r\n      end;\r\n\r\n      UpdateIndicator(r);\r\n    end;\r\n  end;\r\n\r\n  FDataChanging := false;\r\nend;\r\n\r\nprocedure TDBGrid.RecordChange(Sender: TObject);\r\nvar\r\n  r: integer;\r\nbegin\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active and not FModifying and not EditMode then\r\n  begin\r\n    r := FixedRows + FDataLink.DataSource.DataSet.RecNo - 1;\r\n\r\n    if FDataLink.DataSource.DataSet.State = dsInsert then\r\n    begin\r\n\r\n    end\r\n    else\r\n    if r <= RowCount - 1 then\r\n    begin\r\n      Row := r;\r\n      LoadRow(r);\r\n    end\r\n    else\r\n    begin\r\n      LoadData;\r\n      Row := r;\r\n    end;\r\n\r\n    UpdateIndicator(r);\r\n\r\n  end;\r\nend;\r\n\r\nprocedure TDBGrid.Refresh;\r\nbegin\r\n  LoadData;\r\nend;\r\n\r\ndestructor TDBGrid.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  FColumns.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBGrid.DoCheckClick(ACol, ARow: Longint; Checked: boolean);\r\nvar\r\n  insUpdate: boolean;\r\n  fldName: string;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active and (goEditing in Options) then\r\n  begin\r\n    insupdate := FDataLink.DataSource.DataSet.State in [dsInsert, dsEdit];\r\n    fldName := Columns[ACol - FixedCols].DataField;\r\n\r\n    if fldName <> '' then\r\n    begin\r\n      if not insupdate then\r\n        FDataLink.DataSource.DataSet.Edit;\r\n\r\n      FDataLink.DataSource.DataSet.FieldByName(fldName).AsBoolean := Checked;\r\n\r\n      if not insupdate then\r\n        FDataLink.DataSource.DataSet.Post;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TDBGrid.DoSortIndicatorChange(Sender: TObject; ACol: integer;\r\n  AIndicator: TGridSortIndicator);\r\nvar\r\n  s: string;\r\nbegin\r\n  s := Columns[ACol].Title;\r\n  case AIndicator of\r\n  siAscending: s := s + '&nbsp;&#x25B2;';\r\n  siDescending: s := s + '&nbsp;&#x25BC';\r\n  end;\r\n  Cells[ACol, 0] := s;\r\nend;\r\n\r\nprocedure TDBGrid.EndUpdate;\r\nbegin\r\n  ColumnsChanged(Self);\r\n  inherited;\r\nend;\r\n\r\nfunction TDBGrid.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nprocedure TDBGrid.HideEdit;\r\nbegin\r\n  inherited;\r\n  UpdateIndicator(Row);\r\nend;\r\n\r\nprocedure TDBGrid.LoadData;\r\nvar\r\n  c,r,i: integer;\r\n  bk: TBookmark;\r\n  noflds: boolean;\r\n  isBOF,isEOF: boolean;\r\n  LTitle,cn: string;\r\n  fld: TField;\r\n  ce: TJSHTMLElement;\r\nbegin\r\n  noflds := true;\r\n  r := 0;\r\n\r\n  for i := 0 to Columns.Count - 1 do\r\n  begin\r\n    if Columns[i].DataField <> '' then\r\n      noflds := false;\r\n  end;\r\n\r\n  FDefaultFields := noflds;\r\n\r\n  Columns.BeginUpdate;\r\n\r\n  // only unbound columns found\r\n  if noflds and (Columns.Count > 0) then\r\n  begin\r\n    for i := 0 to FDataLink.DataSet.FieldCount - 1 do\r\n    begin\r\n      if (faHiddenCol in FDataLink.DataSet.Fields[i].FieldDef.Attributes) then\r\n        Continue;\r\n\r\n      if not FDataLink.DataSet.Fields[i].Visible then\r\n        Continue;\r\n\r\n      if i >= Columns.Count then\r\n        Columns.Add;\r\n\r\n      with Columns[i] do\r\n      begin\r\n        FDataField := FDataLink.DataSet.Fields[i].FieldName;\r\n        FTitle :=  FDataLink.DataSet.Fields[i].DisplayLabel;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if (Columns.Count = 0) then\r\n  begin\r\n    for i := 0 to FDataLink.DataSet.FieldCount - 1 do\r\n    begin\r\n      if (faHiddenCol in FDataLink.DataSet.Fields[i].FieldDef.Attributes) then\r\n        Continue;\r\n\r\n      with Columns.Add do\r\n      begin\r\n        FDataField := FDataLink.DataSet.Fields[i].FieldName;\r\n        FTitle :=  FDataLink.DataSet.Fields[i].DisplayLabel;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Columns.EndUpdate;\r\n\r\n  ColCount := Columns.Count + FixedCols;\r\n\r\n  RowCount := FDataLink.DataSource.DataSet.RecordCount + FixedRows;\r\n\r\n  isBOF := FDataLink.DataSet.Bof;\r\n  isEOF := FDataLink.DataSet.Eof;\r\n\r\n  FDataLink.DataSource.DataSet.DisableControls;\r\n\r\n  bk := FDataLink.DataSet.GetBookmark;\r\n\r\n  FDataLink.DataSource.DataSet.First;\r\n\r\n  if FixedRows > 0 then\r\n  begin\r\n    for c := 0 to Columns.Count - 1 do\r\n    begin\r\n      LTitle := Columns[c].Title;\r\n      case Columns[c].SortIndicator of\r\n      siAscending: LTitle := LTitle + '&nbsp;&#x25B2;';\r\n      siDescending: LTitle := LTitle + '&nbsp;&#x25BC';\r\n      end;\r\n\r\n      Cells[c + FixedCols, r] := LTitle;\r\n      if Columns[c].TitleElementClassName <> '' then\r\n      begin\r\n        CellElements[c + FixedCols, r].classList.add(Columns[c + FixedCols].TitleElementClassName);\r\n      end;\r\n\r\n      fld := nil;\r\n      if Columns[c].DataField <> '' then\r\n      begin\r\n        fld := FDataLink.DataSource.DataSet.FieldByName(Columns[c].DataField);\r\n      end;\r\n\r\n      ce := CellElements[c,0];\r\n\r\n      GetCellChildren(c, 0, fld, LTitle, ce);\r\n\r\n      BindCellChildren(c, 0, ce);\r\n\r\n      cn := Columns[c].ElementClassName;\r\n\r\n      GetCellClassName(c, 0, fld, LTitle, cn);\r\n\r\n      if cn <> '' then\r\n        ce.classList.add(cn);\r\n    end;\r\n  end;\r\n\r\n  r := FixedRows;\r\n\r\n  while not FDataLink.DataSource.DataSet.EOF do\r\n  begin\r\n    LoadRow(r);\r\n    inc(r);\r\n    FDataLink.DataSource.DataSet.Next;\r\n  end;\r\n\r\n  if DataSource.DataSet.BookmarkValid(bk) then\r\n    FDataLink.DataSource.DataSet.GotoBookmark(bk);\r\n\r\n  if isBOF then\r\n    FDataLink.DataSource.DataSet.First;\r\n\r\n  if isEOF then\r\n    FDataLink.DataSource.DataSet.Last;\r\n\r\n  FDataLink.DataSource.DataSet.EnableControls;\r\nend;\r\n\r\nprocedure TDBGrid.Loaded;\r\nbegin\r\n  inherited;\r\n  ColumnsChanged(Self);\r\nend;\r\n\r\nprocedure TDBGrid.LoadRow(ARow: integer);\r\nvar\r\n  c,r: integer;\r\n  fld: TField;\r\n  cd,cn: string;\r\n  ce: TJSHTMLElement;\r\n\r\nbegin\r\n  if ARow < FixedRows then\r\n    Exit;\r\n\r\n  r := ARow;\r\n\r\n  for c := 0 to Columns.Count - 1 do\r\n  begin\r\n    cd := '';\r\n    fld := nil;\r\n    ce := CellElements[c + FixedCols, r];\r\n\r\n    if (Columns[c].DataField <> '') then\r\n    begin\r\n      fld := FDataLink.DataSource.DataSet.FieldByName(Columns[c].DataField);\r\n\r\n      if Assigned(fld) then\r\n      begin\r\n        cd := FieldToCellData(ce, fld, Columns[c].DataType, goEditing in Options);\r\n      end;\r\n    end;\r\n\r\n    GetCellData(c, r, fld, cd);\r\n\r\n    Cells[c + FixedCols, r] := cd;\r\n\r\n    cn := Columns[c].ElementClassName;\r\n\r\n    GetCellChildren(c, r, fld, cd, ce);\r\n\r\n    BindCellChildren(c, r, ce);\r\n\r\n    GetCellClassName(c, r, fld, cd, cn);\r\n\r\n    if cn <> '' then\r\n      ce.classList.add(cn);\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TDBGrid.SelectCell(ACol, ARow: integer);\r\nvar\r\n  nRecNo: integer;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active then\r\n  begin\r\n    FModifying := true;\r\n\r\n    nRecNo := ARow - FixedRows + 1;\r\n\r\n    if (nRecNo >= 0) and (FDataLink.DataSource.DataSet.RecNo <> nRecNo) and\r\n      (nRecNo <= FDataLink.DataSource.DataSet.RecordCount)  then\r\n    begin\r\n      FDataLink.DataSource.DataSet.RecNo := nRecNo;\r\n\r\n      if nRecNo = 1 then\r\n        FDataLink.DataSource.DataSet.First;\r\n\r\n      if nRecNo = FDataLink.DataSource.DataSet.RecordCount then\r\n        FDataLink.DataSource.DataSet.Last;\r\n    end;\r\n\r\n    UpdateIndicator(ARow);\r\n\r\n    FModifying := false;\r\n  end;\r\nend;\r\n\r\nprocedure TDBGrid.SetColumns(const Value: TGridColumns);\r\nbegin\r\n  FColumns.Assign(Value);\r\nend;\r\n\r\nprocedure TDBGrid.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\nend;\r\n\r\nprocedure TDBGrid.SetShowIndicator(const Value: boolean);\r\nbegin\r\n  FShowIndicator := Value;\r\n  UpdateIndicator(Row);\r\nend;\r\n\r\nprocedure TDBGrid.ShowEdit;\r\nvar\r\n  fldName: string;\r\nbegin\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active  then\r\n  begin\r\n    fldName := Columns[Col - FixedCols].DataField;\r\n\r\n    if (fldName <> '') then\r\n    begin\r\n      if not FDataLink.DataSource.DataSet.FieldByName(fldName).ReadOnly then\r\n      begin\r\n        FDataLink.DataSource.DataSet.Edit;\r\n        inherited;\r\n      end;\r\n    end\r\n    else\r\n      inherited;\r\n  end;\r\nend;\r\n\r\nprocedure TDBGrid.StartEdit(ch: string);\r\nbegin\r\n  inherited StartEdit(ch);\r\n  UpdateIndicator(Row);\r\nend;\r\n\r\nfunction TDBGrid.StopEdit: string;\r\nbegin\r\n  Result := inherited StopEdit;\r\n  UpdateIndicator(Row);\r\nend;\r\n\r\nprocedure TDBGrid.UpdateCell(ACol, ARow: integer; var AValue: string);\r\nvar\r\n  fldName: string;\r\n  insupdate: boolean;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active then\r\n  begin\r\n    insupdate := FDataLink.DataSource.DataSet.State in [dsInsert, dsEdit];\r\n    fldName := Columns[ACol - FixedCols].DataField;\r\n\r\n    if fldName <> '' then\r\n    begin\r\n      if not insupdate then\r\n      begin\r\n        FDataLink.DataSource.DataSet.Edit;\r\n      end;\r\n\r\n      FDataLink.DataSource.DataSet.FieldByName(fldName).AsString := AValue;\r\n\r\n      if not insupdate then\r\n      begin\r\n        FDataLink.DataSource.DataSet.Post;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TDBGrid.UpdateData(Sender: TObject);\r\nbegin\r\n  if FDataLink.DataSource.DataSet.State = dsInsert then\r\n  begin\r\n    HideEdit;\r\n  end;\r\nend;\r\n\r\nprocedure TDBGrid.UpdateIndicator(ARow: integer);\r\nvar\r\n  LSym: string;\r\nbegin\r\n  if FixedCols = 0 then\r\n    Exit;\r\n\r\n  if (FOldIndicator <> ARow) and (FOldIndicator <> -1) or not FShowIndicator then\r\n  begin\r\n    Cells[0, FOldIndicator] := '';\r\n  end;\r\n\r\n  if FShowIndicator then\r\n  begin\r\n\r\n    if Assigned(FDataLink.DataSource) and Assigned(FDataLink.DataSource.DataSet) and FDataLink.DataSource.DataSet.Active and (Row >= FixedRows) then\r\n    begin\r\n      if EditMode then\r\n      begin\r\n        LSym := '&#x270E;'\r\n      end\r\n      else\r\n      begin\r\n        if FDataLink.DataSource.DataSet.State = dsInsert then\r\n          LSym := '&brvbar'\r\n        else\r\n          LSym := '&#x25B6;';\r\n      end;\r\n\r\n      Cells[0, ARow] := '&nbsp;' + LSym;\r\n    end;\r\n  end;\r\n\r\n  FOldIndicator := ARow;\r\nend;\r\n\r\n{ TDBMaskEdit }\r\n\r\nprocedure TDBMaskEdit.ActiveChange(Sender: TObject);\r\nbegin\r\n   if Assigned(FDataLink.DataSet) then\r\n   begin\r\n     if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n       EditText := ''\r\n     else\r\n       DataChange(Self);\r\n   end;\r\nend;\r\n\r\nfunction TDBMaskEdit.CanCut: boolean;\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  if not CheckDataSet then\r\n    Exit;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if not canedit then\r\n  begin\r\n    Result := false;\r\n    Exit;\r\n  end\r\n  else\r\n  begin\r\n    Result := inherited;\r\n    FDataLink.Edit;\r\n  end;\r\nend;\r\n\r\nfunction TDBMaskEdit.CanPaste(AValue: string): boolean;\r\nbegin\r\n  Result := CanCut;\r\nend;\r\n\r\nprocedure TDBMaskEdit.Change;\r\nbegin\r\n  inherited;\r\n  FDataLink.Modified;\r\nend;\r\n\r\nfunction TDBMaskEdit.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBMaskEdit.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\nend;\r\n\r\nprocedure TDBMaskEdit.DataChange(Sender: TObject);\r\nbegin\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and  not FDataLink.DataSet.IsEmpty then\r\n    FFieldText := FDataLink.Field.DisplayText\r\n  else\r\n    FFieldText := '';\r\n\r\n  EditText := FFieldText;\r\nend;\r\n\r\nprocedure TDBMaskEdit.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    FDataLink.Field.AsString := EditText;\r\n  end;\r\nend;\r\n\r\ndestructor TDBMaskEdit.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBMaskEdit.DoExit;\r\nbegin\r\n  if not FDataLink.ReadOnly then\r\n  begin\r\n    FEditChange := true;\r\n    FDataLink.UpdateRecord; // tell data link to update database\r\n  end;\r\n\r\n  inherited DoExit;\r\n\r\n  FEditChange := false;\r\nend;\r\n\r\nfunction TDBMaskEdit.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := True;\r\nend;\r\n\r\nfunction TDBMaskEdit.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nfunction TDBMaskEdit.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nfunction TDBMaskEdit.GetDisplayText: string;\r\nbegin\r\n  if not CheckDataSet then\r\n  begin\r\n    Result := '';\r\n  end\r\n  else\r\n    Result := inherited GetDisplayText;\r\nend;\r\n\r\nfunction TDBMaskEdit.IsReadOnly: boolean;\r\nbegin\r\n  Result := ReadOnly or not CheckDataSet;\r\nend;\r\n\r\nprocedure TDBMaskEdit.KeyDown(var Key: Word; Shift: TShiftState);\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  if not CheckDataSet then\r\n    Exit;\r\n\r\n  if (Key = VK_DELETE) or (Key = VK_BACK) or ((Key = VK_INSERT) and (ssShift in Shift)) then\r\n  begin\r\n    FEditChange := true;\r\n    canedit := EditCanModify;\r\n    FEditChange := false;\r\n\r\n    if not canedit then\r\n    begin\r\n      key := 0;\r\n      inherited;\r\n      Exit;\r\n    end\r\n    else\r\n    begin\r\n      inherited;\r\n      FDataLink.Edit;\r\n    end;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TDBMaskEdit.KeyPress(var Key: Char);\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  if not CheckDataSet then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if FDataLink.DataSet.ControlsDisabled then\r\n  begin\r\n    PreventDefault;\r\n    StopPropagation;\r\n    Exit;\r\n  end;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if not canedit then\r\n    Exit;\r\n\r\n  if {(Key >= #32) and (FDataLink.Field <> nil) and\r\n    not FDataLink.Field.IsValidChar(Key) or} (FDataLink.ReadOnly) then\r\n  begin\r\n    Key := #0;\r\n  end;\r\n\r\n  inherited Keypress(Key);\r\nend;\r\n\r\nprocedure TDBMaskEdit.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\n  FDataLink.UpdateField;\r\nend;\r\n\r\nprocedure TDBMaskEdit.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\n  FDataLink.UpdateField;\r\nend;\r\n\r\n{ TDBEditAutoComplete }\r\n\r\nprocedure TDBEditAutoComplete.ActiveChange(Sender: TObject);\r\nbegin\r\n   if Assigned(FDataLink.DataSet) then\r\n   begin\r\n     if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n     begin\r\n       Text := '';\r\n     end\r\n     else\r\n       DataChange(Self);\r\n   end;\r\nend;\r\n\r\nprocedure TDBEditAutoComplete.Change;\r\nbegin\r\n  inherited;\r\n\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n    Exit;\r\n\r\n  FDataLink.Edit;\r\n  FDataLink.Modified;\r\nend;\r\n\r\nfunction TDBEditAutoComplete.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBEditAutoComplete.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n  FEditChange := false;\r\n\r\n  inherited;\r\n\r\nend;\r\n\r\nprocedure TDBEditAutoComplete.DataChange(Sender: TObject);\r\nbegin\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n    Text := FDataLink.Field.DisplayText\r\n  else\r\n    Text := '';\r\nend;\r\n\r\nprocedure TDBEditAutoComplete.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    FDataLink.Field.AsString := Text;\r\n  end;\r\nend;\r\n\r\ndestructor TDBEditAutoComplete.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBEditAutoComplete.DoExit;\r\nbegin\r\n  if not FDataLink.ReadOnly then\r\n  begin\r\n    FEditChange := true;\r\n    FDataLink.UpdateRecord;     { tell data link to update database }\r\n  end;\r\n\r\n  inherited DoExit;\r\n\r\n  FEditChange := false;\r\nend;\r\n\r\nfunction TDBEditAutoComplete.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := true;\r\nend;\r\n\r\nfunction TDBEditAutoComplete.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nfunction TDBEditAutoComplete.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nprocedure TDBEditAutoComplete.KeyDown(var Key: Word; Shift: TShiftState);\r\nvar\r\n  canedit: boolean;\r\n\r\nbegin\r\n  if not CheckDataSet then\r\n    Exit;\r\n\r\n  if (Key = VK_DELETE) or (Key = VK_BACK) or ((Key = VK_INSERT) and (ssShift in Shift)) then\r\n  begin\r\n    FEditChange := true;\r\n    canedit := EditCanModify;\r\n    FEditChange := false;\r\n\r\n    if not canedit then\r\n    begin\r\n      key := 0;\r\n      inherited;\r\n      Exit;\r\n    end\r\n    else\r\n    begin\r\n      inherited;\r\n      FDataLink.Edit;\r\n    end;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TDBEditAutoComplete.KeyPress(var Key: Char);\r\nvar\r\n  canedit: boolean;\r\nbegin\r\n  if not CheckDataSet then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if FDataLink.DataSet.ControlsDisabled then\r\n  begin\r\n    PreventDefault;\r\n    StopPropagation;\r\n    Exit;\r\n  end;\r\n\r\n  FEditChange := true;\r\n  canedit := EditCanModify;\r\n  FEditChange := false;\r\n\r\n  if not canedit then\r\n    Exit;\r\n\r\n  if (FDataLink.ReadOnly) then\r\n  begin\r\n    Key := #0;\r\n  end;\r\n\r\n  inherited Keypress(Key);\r\nend;\r\n\r\nprocedure TDBEditAutoComplete.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\nend;\r\n\r\nprocedure TDBEditAutoComplete.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDataLink.DataSource := Value;\r\nend;\r\n\r\n{ TDBLookupComboBox }\r\n\r\nprocedure TDBLookupComboBox.ActiveChange(Sender: TObject);\r\nbegin\r\n  Enabled := CheckDataSet;\r\n\r\n  if Assigned(FDataLink.DataSet) then\r\n  begin\r\n    if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n    begin\r\n      ItemIndex := -1;\r\n    end\r\n    else\r\n      DataChange(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TDBLookupComboBox.Change;\r\nbegin\r\n  inherited;\r\n\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not FDataLink.DataSet.Active or not DataSource.Enabled then\r\n    Exit;\r\n\r\n  FEditChange := true;\r\n  FDataLink.Edit;\r\n  FDataLink.Modified;\r\n\r\n  FEditChange := false;\r\nend;\r\n\r\nfunction TDBLookupComboBox.CheckDataSet: boolean;\r\nbegin\r\n  Result := CheckDB(DataSource, DataField, FDataLink);\r\nend;\r\n\r\nprocedure TDBLookupComboBox.CreateInitialize;\r\nbegin\r\n  FDataLink := TFieldDataLink.Create;\r\n  FDataLink.OnUpdateData := DataUpdate;\r\n  FDataLink.OnDataChange := DataChange;\r\n  FDataLink.OnActiveChange := ActiveChange;\r\n\r\n  FListLink := TFieldDataLink.Create;\r\n  FListLink.OnActiveChange := ListActiveChange;\r\n\r\n  FEditChange := false;\r\n  inherited;\r\nend;\r\n\r\nprocedure TDBLookupComboBox.DataChange(Sender: TObject);\r\nbegin\r\n  Enabled := CheckDataSet;\r\n\r\n  if FEditChange then\r\n    Exit;\r\n\r\n  if not Assigned(DataSource) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.DataSet) then\r\n    Exit;\r\n\r\n  if not Assigned(FDataLink.Field) then\r\n    FDataLink.UpdateField;\r\n\r\n  if Assigned(FDataLink.Field) and not FDataLink.DataSet.IsEmpty then\r\n  begin\r\n    Value := FDataLink.Field.AsString;\r\n  end\r\n  else\r\n    ItemIndex := -1;\r\nend;\r\n\r\nprocedure TDBLookupComboBox.DataUpdate(Sender: TObject);\r\nbegin\r\n  if Assigned(FDataLink.Field) then\r\n  begin\r\n    if not Assigned(FDataLink.Field) then\r\n      FDataLink.UpdateField;\r\n\r\n    FDataLink.Field.AsString := Value;\r\n  end;\r\nend;\r\n\r\ndestructor TDBLookupComboBox.Destroy;\r\nbegin\r\n  FDataLink.Free;\r\n  FListLink.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nfunction TDBLookupComboBox.EditCanModify: Boolean;\r\nbegin\r\n  if Assigned(DataSource) then\r\n    Result := not FDatalink.DataSet.ControlsDisabled and FDataLink.Edit\r\n  else\r\n    Result := true;\r\nend;\r\n\r\nfunction TDBLookupComboBox.GetDataField: string;\r\nbegin\r\n  Result := FDataLink.FieldName;\r\nend;\r\n\r\nfunction TDBLookupComboBox.GetDataSource: TDataSource;\r\nbegin\r\n  Result := FDataLink.DataSource;\r\nend;\r\n\r\nfunction TDBLookupComboBox.GetListField: string;\r\nbegin\r\n  Result := FListLink.FieldName;\r\nend;\r\n\r\nfunction TDBLookupComboBox.GetListSource: TDataSource;\r\nbegin\r\n  Result := FListLink.DataSource;\r\nend;\r\n\r\nprocedure TDBLookupComboBox.ListActiveChange(Sender: TObject);\r\nvar\r\n  kfld,lfld: TField;\r\n  isBOF,isEOF: boolean;\r\n  bk: TBookmark;\r\nbegin\r\n  if Assigned(ListSource) and Assigned(ListSource.DataSet) and (ListSource.DataSet.Active) and (KeyField <> '') and (ListField <> '') then\r\n  begin\r\n    kfld := ListSource.Dataset.FieldByName(KeyField);\r\n    lfld := ListSource.Dataset.FieldByName(ListField);\r\n\r\n    if Assigned(kfld) and Assigned(lfld) then\r\n    begin\r\n      isBOF := ListSource.DataSet.BOF;\r\n      isEOF := ListSource.DataSet.EOF;\r\n\r\n      ListSource.DataSet.DisableControls;\r\n\r\n      bk := ListSource.DataSet.GetBookmark;\r\n\r\n      LookupValues.Clear;\r\n\r\n      ListSource.DataSet.First;\r\n\r\n      while not ListSource.DataSet.EOF do\r\n      begin\r\n        LookupValues.AddPair(kfld.AsString, lfld.DisplayText);\r\n        ListSource.DataSet.Next;\r\n      end;\r\n\r\n      if ListSource.DataSet.BookmarkValid(bk) then\r\n       ListSource.DataSet.GotoBookmark(bk);\r\n\r\n      if isBOF then\r\n        ListSource.DataSet.First;\r\n\r\n      if isEOF then\r\n        ListSource.DataSet.Last;\r\n\r\n      DoUpdateList;\r\n\r\n      ListSource.DataSet.EnableControls;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TDBLookupComboBox.SetDataField(const Value: string);\r\nbegin\r\n  FDataLink.FieldName := Value;\r\nend;\r\n\r\nprocedure TDBLookupComboBox.SetDataSource(const Value: TDataSource);\r\nbegin\r\n  FDatalink.DataSource := Value;\r\nend;\r\n\r\nprocedure TDBLookupComboBox.SetKeyField(const Value: string);\r\nbegin\r\n  FKeyField := Value;\r\nend;\r\n\r\nprocedure TDBLookupComboBox.SetListField(const Value: string);\r\nbegin\r\n  FListLink.FieldName := Value;\r\nend;\r\n\r\nprocedure TDBLookupComboBox.SetListSource(const Value: TDataSource);\r\nbegin\r\n  FListLink.DataSource := Value;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\nunit WEBLib.Imaging.gifimg;\r\n\r\ninterface\r\n\r\nimplementation\r\n\r\nbegin\r\nasm\r\nend;\r\n\r\n\r\nend.\r\n","unit uDM;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Classes, JS, Web, WEBLib.Modules, DB, WEBLib.CDS;\r\n\r\ntype\r\n  TfDM = class(TDataModule)\r\n    cUsers: TClientConnection;\r\n    dUsers: TClientDataSet;\r\n    dUsersID: TIntegerField;\r\n    dUsersUsername: TStringField;\r\n    dUsersPassword: TStringField;\r\n    dUsersMachineName: TStringField;\r\n    dUsersExternalIP: TStringField;\r\n    dUsersLoginCount: TIntegerField;\r\n    dUsersLastLogin: TDateTimeField;\r\n    dUsersCreated: TDateTimeField;\r\n    cSwimmers: TClientConnection;\r\n    dSwimmers: TClientDataSet;\r\n    dSwimmersID: TIntegerField;\r\n    dSwimmersFirstName: TStringField;\r\n    dSwimmersLastName: TStringField;\r\n    dSwimmersGender: TStringField;\r\n    dSwimmersSpecialNeeds: TStringField;\r\n    dSwimmersFly_25: TFloatField;\r\n    dSwimmersBack_25: TFloatField;\r\n    dSwimmersBreast_25: TFloatField;\r\n    dSwimmersFree_25: TFloatField;\r\n    dSwimmersFly_50: TFloatField;\r\n    dSwimmersBack_50: TFloatField;\r\n    dSwimmersBreast_50: TFloatField;\r\n    dSwimmersFree_50: TFloatField;\r\n    dSwimmersFree_100: TFloatField;\r\n    dSwimmersIM_100: TFloatField;\r\n    dSwimmersActive: TStringField;\r\n    dSwimmersCreated: TDateTimeField;\r\n    dSwimmersIndex: TIntegerField;\r\n    procedure WebDataModuleCreate(Sender: TObject);\r\n    procedure cUsersAfterConnect(Sender: TObject);\r\n    procedure cSwimmersAfterConnect(Sender: TObject);\r\n    procedure dSwimmersCalcFields(DataSet: TDataSet);\r\n  private\r\n    { Private declarations }\r\n  protected\r\n    procedure LoadDFMValues; override;\r\n  public\r\n    { Public declarations }\r\n  end;\r\n\r\nvar\r\n  fDM: TfDM;\r\n\r\nimplementation\r\n\r\n{%CLASSGROUP 'Vcl.Controls.TControl'}\r\n\r\n\r\nprocedure TfDM.cSwimmersAfterConnect(Sender: TObject);\r\nbegin\r\n  dSwimmers.IDField := 'ID';\r\nend;\r\n\r\nprocedure TfDM.cUsersAfterConnect(Sender: TObject);\r\nbegin\r\n  dUsers.IDField := 'ID';\r\nend;\r\n\r\nprocedure TfDM.dSwimmersCalcFields(DataSet: TDataSet);\r\nbegin\r\n  dSwimmersIndex.Value := Dataset.RecNo;\r\nend;\r\n\r\nprocedure TfDM.WebDataModuleCreate(Sender: TObject);\r\nbegin\r\n  cUsers.Active := true;\r\nend;\r\n\r\nprocedure TfDM.LoadDFMValues;\r\nbegin\r\n  inherited LoadDFMValues;\r\n\r\n  cUsers := TClientConnection.Create(Self);\r\n  dUsers := TClientDataSet.Create(Self);\r\n  dUsersID := TIntegerField.Create(Self);\r\n  dUsersUsername := TStringField.Create(Self);\r\n  dUsersPassword := TStringField.Create(Self);\r\n  dUsersMachineName := TStringField.Create(Self);\r\n  dUsersExternalIP := TStringField.Create(Self);\r\n  dUsersLoginCount := TIntegerField.Create(Self);\r\n  dUsersLastLogin := TDateTimeField.Create(Self);\r\n  dUsersCreated := TDateTimeField.Create(Self);\r\n  cSwimmers := TClientConnection.Create(Self);\r\n  dSwimmers := TClientDataSet.Create(Self);\r\n  dSwimmersIndex := TIntegerField.Create(Self);\r\n  dSwimmersID := TIntegerField.Create(Self);\r\n  dSwimmersFirstName := TStringField.Create(Self);\r\n  dSwimmersLastName := TStringField.Create(Self);\r\n  dSwimmersGender := TStringField.Create(Self);\r\n  dSwimmersSpecialNeeds := TStringField.Create(Self);\r\n  dSwimmersFly_25 := TFloatField.Create(Self);\r\n  dSwimmersBack_25 := TFloatField.Create(Self);\r\n  dSwimmersBreast_25 := TFloatField.Create(Self);\r\n  dSwimmersFree_25 := TFloatField.Create(Self);\r\n  dSwimmersFly_50 := TFloatField.Create(Self);\r\n  dSwimmersBack_50 := TFloatField.Create(Self);\r\n  dSwimmersBreast_50 := TFloatField.Create(Self);\r\n  dSwimmersFree_50 := TFloatField.Create(Self);\r\n  dSwimmersFree_100 := TFloatField.Create(Self);\r\n  dSwimmersIM_100 := TFloatField.Create(Self);\r\n  dSwimmersActive := TStringField.Create(Self);\r\n  dSwimmersCreated := TDateTimeField.Create(Self);\r\n\r\n  cUsers.BeforeLoadDFMValues;\r\n  dUsers.BeforeLoadDFMValues;\r\n  dUsersID.BeforeLoadDFMValues;\r\n  dUsersUsername.BeforeLoadDFMValues;\r\n  dUsersPassword.BeforeLoadDFMValues;\r\n  dUsersMachineName.BeforeLoadDFMValues;\r\n  dUsersExternalIP.BeforeLoadDFMValues;\r\n  dUsersLoginCount.BeforeLoadDFMValues;\r\n  dUsersLastLogin.BeforeLoadDFMValues;\r\n  dUsersCreated.BeforeLoadDFMValues;\r\n  cSwimmers.BeforeLoadDFMValues;\r\n  dSwimmers.BeforeLoadDFMValues;\r\n  dSwimmersIndex.BeforeLoadDFMValues;\r\n  dSwimmersID.BeforeLoadDFMValues;\r\n  dSwimmersFirstName.BeforeLoadDFMValues;\r\n  dSwimmersLastName.BeforeLoadDFMValues;\r\n  dSwimmersGender.BeforeLoadDFMValues;\r\n  dSwimmersSpecialNeeds.BeforeLoadDFMValues;\r\n  dSwimmersFly_25.BeforeLoadDFMValues;\r\n  dSwimmersBack_25.BeforeLoadDFMValues;\r\n  dSwimmersBreast_25.BeforeLoadDFMValues;\r\n  dSwimmersFree_25.BeforeLoadDFMValues;\r\n  dSwimmersFly_50.BeforeLoadDFMValues;\r\n  dSwimmersBack_50.BeforeLoadDFMValues;\r\n  dSwimmersBreast_50.BeforeLoadDFMValues;\r\n  dSwimmersFree_50.BeforeLoadDFMValues;\r\n  dSwimmersFree_100.BeforeLoadDFMValues;\r\n  dSwimmersIM_100.BeforeLoadDFMValues;\r\n  dSwimmersActive.BeforeLoadDFMValues;\r\n  dSwimmersCreated.BeforeLoadDFMValues;\r\n  try\r\n    Name := 'fDM';\r\n    SetEvent(Self, Self, 'OnCreate', 'WebDataModuleCreate');\r\n    Height := 1216;\r\n    Width := 1754;\r\n    cUsers.SetParentComponent(Self);\r\n    cUsers.Name := 'cUsers';\r\n    cUsers.Active := False;\r\n    cUsers.URI := 'http://ljstpirates.com/JSON/Users.php';\r\n    cUsers.AfterConnect := cUsersAfterConnect;\r\n    cUsers.Left := 384;\r\n    cUsers.Top := 472;\r\n    dUsers.SetParentComponent(Self);\r\n    dUsers.Name := 'dUsers';\r\n    dUsers.Connection := cUsers;\r\n    dUsers.Left := 384;\r\n    dUsers.Top := 520;\r\n    dUsersID.SetParentComponent(dUsers);\r\n    dUsersID.Name := 'dUsersID';\r\n    dUsersID.FieldName := 'ID';\r\n    dUsersUsername.SetParentComponent(dUsers);\r\n    dUsersUsername.Name := 'dUsersUsername';\r\n    dUsersUsername.FieldName := 'Username';\r\n    dUsersUsername.Size := 256;\r\n    dUsersPassword.SetParentComponent(dUsers);\r\n    dUsersPassword.Name := 'dUsersPassword';\r\n    dUsersPassword.FieldName := 'Password';\r\n    dUsersPassword.Size := 256;\r\n    dUsersMachineName.SetParentComponent(dUsers);\r\n    dUsersMachineName.Name := 'dUsersMachineName';\r\n    dUsersMachineName.FieldName := 'MachineName';\r\n    dUsersMachineName.Size := 256;\r\n    dUsersExternalIP.SetParentComponent(dUsers);\r\n    dUsersExternalIP.Name := 'dUsersExternalIP';\r\n    dUsersExternalIP.FieldName := 'ExternalIP';\r\n    dUsersExternalIP.Size := 256;\r\n    dUsersLoginCount.SetParentComponent(dUsers);\r\n    dUsersLoginCount.Name := 'dUsersLoginCount';\r\n    dUsersLoginCount.FieldName := 'LoginCount';\r\n    dUsersLastLogin.SetParentComponent(dUsers);\r\n    dUsersLastLogin.Name := 'dUsersLastLogin';\r\n    dUsersLastLogin.FieldName := 'LastLogin';\r\n    dUsersCreated.SetParentComponent(dUsers);\r\n    dUsersCreated.Name := 'dUsersCreated';\r\n    dUsersCreated.FieldName := 'Created';\r\n    cSwimmers.SetParentComponent(Self);\r\n    cSwimmers.Name := 'cSwimmers';\r\n    cSwimmers.Active := False;\r\n    cSwimmers.URI := 'http://ljstpirates.com/JSON/Swimmers.php';\r\n    cSwimmers.AfterConnect := cSwimmersAfterConnect;\r\n    cSwimmers.Left := 456;\r\n    cSwimmers.Top := 472;\r\n    dSwimmers.SetParentComponent(Self);\r\n    dSwimmers.Name := 'dSwimmers';\r\n    dSwimmers.Connection := cSwimmers;\r\n    SetEvent(dSwimmers, Self, 'OnCalcFields', 'dSwimmersCalcFields');\r\n    dSwimmers.Left := 456;\r\n    dSwimmers.Top := 520;\r\n    dSwimmersIndex.SetParentComponent(dSwimmers);\r\n    dSwimmersIndex.Name := 'dSwimmersIndex';\r\n    dSwimmersIndex.Alignment := taCenter;\r\n    dSwimmersIndex.DisplayLabel := 'ID';\r\n    dSwimmersIndex.FieldKind := fkCalculated;\r\n    dSwimmersIndex.FieldName := 'Index';\r\n    dSwimmersIndex.Calculated := True;\r\n    dSwimmersID.SetParentComponent(dSwimmers);\r\n    dSwimmersID.Name := 'dSwimmersID';\r\n    dSwimmersID.Alignment := taCenter;\r\n    dSwimmersID.FieldName := 'ID';\r\n    dSwimmersID.Visible := False;\r\n    dSwimmersFirstName.SetParentComponent(dSwimmers);\r\n    dSwimmersFirstName.Name := 'dSwimmersFirstName';\r\n    dSwimmersFirstName.FieldName := 'FirstName';\r\n    dSwimmersFirstName.Size := 256;\r\n    dSwimmersLastName.SetParentComponent(dSwimmers);\r\n    dSwimmersLastName.Name := 'dSwimmersLastName';\r\n    dSwimmersLastName.FieldName := 'LastName';\r\n    dSwimmersLastName.Size := 256;\r\n    dSwimmersGender.SetParentComponent(dSwimmers);\r\n    dSwimmersGender.Name := 'dSwimmersGender';\r\n    dSwimmersGender.FieldName := 'Gender';\r\n    dSwimmersGender.Size := 256;\r\n    dSwimmersSpecialNeeds.SetParentComponent(dSwimmers);\r\n    dSwimmersSpecialNeeds.Name := 'dSwimmersSpecialNeeds';\r\n    dSwimmersSpecialNeeds.FieldName := 'SpecialNeeds';\r\n    dSwimmersSpecialNeeds.Size := 256;\r\n    dSwimmersFly_25.SetParentComponent(dSwimmers);\r\n    dSwimmersFly_25.Name := 'dSwimmersFly_25';\r\n    dSwimmersFly_25.Alignment := taCenter;\r\n    dSwimmersFly_25.FieldName := 'Fly_25';\r\n    dSwimmersBack_25.SetParentComponent(dSwimmers);\r\n    dSwimmersBack_25.Name := 'dSwimmersBack_25';\r\n    dSwimmersBack_25.Alignment := taCenter;\r\n    dSwimmersBack_25.FieldName := 'Back_25';\r\n    dSwimmersBreast_25.SetParentComponent(dSwimmers);\r\n    dSwimmersBreast_25.Name := 'dSwimmersBreast_25';\r\n    dSwimmersBreast_25.Alignment := taCenter;\r\n    dSwimmersBreast_25.FieldName := 'Breast_25';\r\n    dSwimmersFree_25.SetParentComponent(dSwimmers);\r\n    dSwimmersFree_25.Name := 'dSwimmersFree_25';\r\n    dSwimmersFree_25.Alignment := taCenter;\r\n    dSwimmersFree_25.FieldName := 'Free_25';\r\n    dSwimmersFly_50.SetParentComponent(dSwimmers);\r\n    dSwimmersFly_50.Name := 'dSwimmersFly_50';\r\n    dSwimmersFly_50.Alignment := taCenter;\r\n    dSwimmersFly_50.FieldName := 'Fly_50';\r\n    dSwimmersBack_50.SetParentComponent(dSwimmers);\r\n    dSwimmersBack_50.Name := 'dSwimmersBack_50';\r\n    dSwimmersBack_50.Alignment := taCenter;\r\n    dSwimmersBack_50.FieldName := 'Back_50';\r\n    dSwimmersBreast_50.SetParentComponent(dSwimmers);\r\n    dSwimmersBreast_50.Name := 'dSwimmersBreast_50';\r\n    dSwimmersBreast_50.Alignment := taCenter;\r\n    dSwimmersBreast_50.FieldName := 'Breast_50';\r\n    dSwimmersFree_50.SetParentComponent(dSwimmers);\r\n    dSwimmersFree_50.Name := 'dSwimmersFree_50';\r\n    dSwimmersFree_50.Alignment := taCenter;\r\n    dSwimmersFree_50.FieldName := 'Free_50';\r\n    dSwimmersFree_100.SetParentComponent(dSwimmers);\r\n    dSwimmersFree_100.Name := 'dSwimmersFree_100';\r\n    dSwimmersFree_100.Alignment := taCenter;\r\n    dSwimmersFree_100.FieldName := 'Free_100';\r\n    dSwimmersIM_100.SetParentComponent(dSwimmers);\r\n    dSwimmersIM_100.Name := 'dSwimmersIM_100';\r\n    dSwimmersIM_100.Alignment := taCenter;\r\n    dSwimmersIM_100.FieldName := 'IM_100';\r\n    dSwimmersActive.SetParentComponent(dSwimmers);\r\n    dSwimmersActive.Name := 'dSwimmersActive';\r\n    dSwimmersActive.Alignment := taCenter;\r\n    dSwimmersActive.FieldName := 'Active';\r\n    dSwimmersActive.Size := 256;\r\n    dSwimmersCreated.SetParentComponent(dSwimmers);\r\n    dSwimmersCreated.Name := 'dSwimmersCreated';\r\n    dSwimmersCreated.FieldName := 'Created';\r\n    dSwimmersCreated.Visible := False;\r\n  finally\r\n    cUsers.AfterLoadDFMValues;\r\n    dUsers.AfterLoadDFMValues;\r\n    dUsersID.AfterLoadDFMValues;\r\n    dUsersUsername.AfterLoadDFMValues;\r\n    dUsersPassword.AfterLoadDFMValues;\r\n    dUsersMachineName.AfterLoadDFMValues;\r\n    dUsersExternalIP.AfterLoadDFMValues;\r\n    dUsersLoginCount.AfterLoadDFMValues;\r\n    dUsersLastLogin.AfterLoadDFMValues;\r\n    dUsersCreated.AfterLoadDFMValues;\r\n    cSwimmers.AfterLoadDFMValues;\r\n    dSwimmers.AfterLoadDFMValues;\r\n    dSwimmersIndex.AfterLoadDFMValues;\r\n    dSwimmersID.AfterLoadDFMValues;\r\n    dSwimmersFirstName.AfterLoadDFMValues;\r\n    dSwimmersLastName.AfterLoadDFMValues;\r\n    dSwimmersGender.AfterLoadDFMValues;\r\n    dSwimmersSpecialNeeds.AfterLoadDFMValues;\r\n    dSwimmersFly_25.AfterLoadDFMValues;\r\n    dSwimmersBack_25.AfterLoadDFMValues;\r\n    dSwimmersBreast_25.AfterLoadDFMValues;\r\n    dSwimmersFree_25.AfterLoadDFMValues;\r\n    dSwimmersFly_50.AfterLoadDFMValues;\r\n    dSwimmersBack_50.AfterLoadDFMValues;\r\n    dSwimmersBreast_50.AfterLoadDFMValues;\r\n    dSwimmersFree_50.AfterLoadDFMValues;\r\n    dSwimmersFree_100.AfterLoadDFMValues;\r\n    dSwimmersIM_100.AfterLoadDFMValues;\r\n    dSwimmersActive.AfterLoadDFMValues;\r\n    dSwimmersCreated.AfterLoadDFMValues;\r\n  end;\r\nend;\r\n\r\nend.\r\n","unit uHome;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Classes, JS, Web, WEBLib.Graphics, WEBLib.Controls,\r\n  WEBLib.Forms, WEBLib.Dialogs, DB, WEBLib.DB, WEBLib.Grids, WEBLib.DBCtrls,\r\n  WEBLib.ExtCtrls, WEBLib.StdCtrls, WEBLib.ComCtrls;\r\n\r\ntype\r\n  TfHome = class(TForm)\r\n    WebPanel1: TPanel;\r\n    dsSwimmers: TDataSource;\r\n    WebButton1: TButton;\r\n    WebPanel2: TPanel;\r\n    WebDBNavigator1: TDBNavigator;\r\n    WebPageControl1: TPageControl;\r\n    WebPageControl1Sheet1: TTabSheet;\r\n    WebPageControl1Sheet2: TTabSheet;\r\n    WebPageControl1Sheet3: TTabSheet;\r\n    WebDBGrid1: TDBGrid;\r\n    WebPanel3: TPanel;\r\n    WebComboBox1: TComboBox;\r\n    procedure WebFormCreate(Sender: TObject);\r\n  private\r\n    { Private declarations }\r\n  protected\r\n    procedure LoadDFMValues; override;\r\n  public\r\n    { Public declarations }\r\n  end;\r\n\r\nvar\r\n  fHome: TfHome;\r\n\r\nimplementation\r\nuses\r\n  uDM;\r\n\r\n\r\nprocedure TfHome.WebFormCreate(Sender: TObject);\r\nvar\r\n  i: integer;\r\nbegin\r\n  with fDM.cSwimmers do\r\n  if not Active then\r\n    Active := True;\r\n\r\n  for i := 0 to WebDBGrid1.Columns.Count-1 do\r\n    WebComboBox1.Items.Add(WebDBGrid1.Columns[i].DataField);\r\n\r\n\r\nend;\r\n\r\nprocedure TfHome.LoadDFMValues;\r\nbegin\r\n  inherited LoadDFMValues;\r\n\r\n  WebPanel1 := TPanel.Create(Self);\r\n  WebButton1 := TButton.Create(Self);\r\n  WebPanel2 := TPanel.Create(Self);\r\n  WebDBNavigator1 := TDBNavigator.Create(Self);\r\n  WebPageControl1 := TPageControl.Create(Self);\r\n  WebPageControl1Sheet1 := TTabSheet.Create(Self);\r\n  WebDBGrid1 := TDBGrid.Create(Self);\r\n  WebPanel3 := TPanel.Create(Self);\r\n  WebComboBox1 := TComboBox.Create(Self);\r\n  WebPageControl1Sheet2 := TTabSheet.Create(Self);\r\n  WebPageControl1Sheet3 := TTabSheet.Create(Self);\r\n  dsSwimmers := TDataSource.Create(Self);\r\n\r\n  WebPanel1.BeforeLoadDFMValues;\r\n  WebButton1.BeforeLoadDFMValues;\r\n  WebPanel2.BeforeLoadDFMValues;\r\n  WebDBNavigator1.BeforeLoadDFMValues;\r\n  WebPageControl1.BeforeLoadDFMValues;\r\n  WebPageControl1Sheet1.BeforeLoadDFMValues;\r\n  WebDBGrid1.BeforeLoadDFMValues;\r\n  WebPanel3.BeforeLoadDFMValues;\r\n  WebComboBox1.BeforeLoadDFMValues;\r\n  WebPageControl1Sheet2.BeforeLoadDFMValues;\r\n  WebPageControl1Sheet3.BeforeLoadDFMValues;\r\n  dsSwimmers.BeforeLoadDFMValues;\r\n  try\r\n    Name := 'fHome';\r\n    Left := 0;\r\n    Top := 0;\r\n    Width := 1930;\r\n    Height := 1213;\r\n    Font.Charset := DEFAULT_CHARSET;\r\n    Font.Color := clWindowText;\r\n    Font.Height := -11;\r\n    Font.Name := 'Arial';\r\n    Font.Style := [];\r\n    TabOrder := 1;\r\n    SetEvent(Self, Self, 'OnCreate', 'WebFormCreate');\r\n    WebPanel1.SetParentComponent(Self);\r\n    WebPanel1.Name := 'WebPanel1';\r\n    WebPanel1.Left := 0;\r\n    WebPanel1.Top := 0;\r\n    WebPanel1.Width := 1930;\r\n    WebPanel1.Height := 73;\r\n    WebPanel1.Align := alTop;\r\n    WebPanel1.BorderColor := clSilver;\r\n    WebPanel1.BorderStyle := bsSingle;\r\n    WebPanel1.Caption := 'WebPanel1';\r\n    WebPanel1.ChildOrder := 2;\r\n    WebPanel1.ShowCaption := False;\r\n    WebButton1.SetParentComponent(WebPanel1);\r\n    WebButton1.Name := 'WebButton1';\r\n    WebButton1.Left := 920;\r\n    WebButton1.Top := 24;\r\n    WebButton1.Width := 96;\r\n    WebButton1.Height := 25;\r\n    WebButton1.Caption := 'WebButton1';\r\n    WebPanel2.SetParentComponent(Self);\r\n    WebPanel2.Name := 'WebPanel2';\r\n    WebPanel2.Left := 0;\r\n    WebPanel2.Top := 1168;\r\n    WebPanel2.Width := 1930;\r\n    WebPanel2.Height := 45;\r\n    WebPanel2.Align := alBottom;\r\n    WebPanel2.BorderColor := clSilver;\r\n    WebPanel2.BorderStyle := bsSingle;\r\n    WebPanel2.Caption := 'WebPanel1';\r\n    WebPanel2.ChildOrder := 2;\r\n    WebPanel2.ShowCaption := False;\r\n    WebDBNavigator1.SetParentComponent(WebPanel2);\r\n    WebDBNavigator1.Name := 'WebDBNavigator1';\r\n    WebDBNavigator1.Left := 0;\r\n    WebDBNavigator1.Top := 0;\r\n    WebDBNavigator1.Width := 330;\r\n    WebDBNavigator1.Height := 45;\r\n    WebDBNavigator1.Align := alLeft;\r\n    WebDBNavigator1.DataSource := dsSwimmers;\r\n    WebDBNavigator1.Hints.BeginUpdate;\r\n    try\r\n      WebDBNavigator1.Hints.Clear;\r\n      WebDBNavigator1.Hints.Add('First');\r\n      WebDBNavigator1.Hints.Add('Prior');\r\n      WebDBNavigator1.Hints.Add('Next');\r\n      WebDBNavigator1.Hints.Add('Last');\r\n      WebDBNavigator1.Hints.Add('Edit');\r\n      WebDBNavigator1.Hints.Add('Post');\r\n      WebDBNavigator1.Hints.Add('Insert');\r\n      WebDBNavigator1.Hints.Add('Delete');\r\n      WebDBNavigator1.Hints.Add('Cancel');\r\n    finally\r\n      WebDBNavigator1.Hints.EndUpdate;\r\n    end;\r\n    WebPageControl1.SetParentComponent(Self);\r\n    WebPageControl1.Name := 'WebPageControl1';\r\n    WebPageControl1.Left := 0;\r\n    WebPageControl1.Top := 73;\r\n    WebPageControl1.Width := 1930;\r\n    WebPageControl1.Height := 1095;\r\n    WebPageControl1.Align := alClient;\r\n    WebPageControl1.ChildOrder := 3;\r\n    WebPageControl1.Font.Charset := DEFAULT_CHARSET;\r\n    WebPageControl1.Font.Color := clWindowText;\r\n    WebPageControl1.Font.Height := -13;\r\n    WebPageControl1.Font.Name := 'Arial';\r\n    WebPageControl1.Font.Style := [];\r\n    WebPageControl1.TabIndex := 0;\r\n    WebPageControl1.ParentFont := False;\r\n    WebPageControl1.SelectedColor := clSilver;\r\n    WebPageControl1.TabOrder := 2;\r\n    WebPageControl1Sheet1.SetParentComponent(WebPageControl1);\r\n    WebPageControl1Sheet1.Name := 'WebPageControl1Sheet1';\r\n    WebPageControl1Sheet1.Left := 0;\r\n    WebPageControl1Sheet1.Top := 20;\r\n    WebPageControl1Sheet1.Width := 1930;\r\n    WebPageControl1Sheet1.Height := 1075;\r\n    WebPageControl1Sheet1.Caption := 'Personal Data';\r\n    WebDBGrid1.SetParentComponent(WebPageControl1Sheet1);\r\n    WebDBGrid1.Name := 'WebDBGrid1';\r\n    WebDBGrid1.Left := 201;\r\n    WebDBGrid1.Top := 0;\r\n    WebDBGrid1.Width := 1729;\r\n    WebDBGrid1.Height := 1075;\r\n    WebDBGrid1.Align := alClient;\r\n    WebDBGrid1.Columns.Clear;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Index';\r\n      Title := 'ID';\r\n      Width := 43;\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'FirstName';\r\n      Title := 'First Name';\r\n      Width := 205;\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'LastName';\r\n      Title := 'Last Name';\r\n      Width := 184;\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Gender';\r\n      Title := 'Gender';\r\n      Width := 60;\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Fly_25';\r\n      Title := '25 Fly';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Back_25';\r\n      Title := '25 Back';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Breast_25';\r\n      Title := '25 Breast';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Free_25';\r\n      Title := '25 Free';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Fly_50';\r\n      Title := '50 Fly';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Back_50';\r\n      Title := '50 Back';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Breast_50';\r\n      Title := '50 Breast';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Free_50';\r\n      Title := '50 Free';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Free_100';\r\n      Title := '100 Free';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'IM_100';\r\n      Title := '100 IM';\r\n    end;\r\n    with WebDBGrid1.Columns.Add do\r\n    begin\r\n      DataField := 'Active';\r\n      Title := 'Active';\r\n    end;\r\n    WebDBGrid1.DataSource := dsSwimmers;\r\n    WebDBGrid1.FixedCols := 1;\r\n    WebDBGrid1.Font.Charset := DEFAULT_CHARSET;\r\n    WebDBGrid1.Font.Color := clWindowText;\r\n    WebDBGrid1.Font.Height := -13;\r\n    WebDBGrid1.Font.Name := 'Arial';\r\n    WebDBGrid1.Font.Style := [];\r\n    WebDBGrid1.ParentFont := False;\r\n    WebDBGrid1.TabOrder := 0;\r\n    WebDBGrid1.ColWidths[0] := 20;\r\n    WebDBGrid1.ColWidths[1] := 43;\r\n    WebDBGrid1.ColWidths[2] := 205;\r\n    WebDBGrid1.ColWidths[3] := 184;\r\n    WebDBGrid1.ColWidths[4] := 60;\r\n    WebDBGrid1.ColWidths[5] := 64;\r\n    WebDBGrid1.ColWidths[6] := 64;\r\n    WebDBGrid1.ColWidths[7] := 64;\r\n    WebDBGrid1.ColWidths[8] := 64;\r\n    WebDBGrid1.ColWidths[9] := 64;\r\n    WebDBGrid1.ColWidths[10] := 64;\r\n    WebDBGrid1.ColWidths[11] := 64;\r\n    WebDBGrid1.ColWidths[12] := 64;\r\n    WebDBGrid1.ColWidths[13] := 64;\r\n    WebDBGrid1.ColWidths[14] := 64;\r\n    WebDBGrid1.ColWidths[15] := 64;\r\n    WebPanel3.SetParentComponent(WebPageControl1Sheet1);\r\n    WebPanel3.Name := 'WebPanel3';\r\n    WebPanel3.Left := 0;\r\n    WebPanel3.Top := 0;\r\n    WebPanel3.Width := 201;\r\n    WebPanel3.Height := 1075;\r\n    WebPanel3.Align := alLeft;\r\n    WebPanel3.BorderColor := clSilver;\r\n    WebPanel3.BorderStyle := bsSingle;\r\n    WebPanel3.Caption := 'WebPanel3';\r\n    WebPanel3.ChildOrder := 1;\r\n    WebPanel3.ShowCaption := False;\r\n    WebComboBox1.SetParentComponent(WebPanel3);\r\n    WebComboBox1.Name := 'WebComboBox1';\r\n    WebComboBox1.AlignWithMargins := True;\r\n    WebComboBox1.Left := 5;\r\n    WebComboBox1.Top := 25;\r\n    WebComboBox1.Width := 191;\r\n    WebComboBox1.Height := 22;\r\n    WebComboBox1.Margins.Left := 5;\r\n    WebComboBox1.Margins.Top := 25;\r\n    WebComboBox1.Margins.Right := 5;\r\n    WebComboBox1.Margins.Bottom := 0;\r\n    WebComboBox1.Align := alTop;\r\n    WebComboBox1.ItemIndex := -1;\r\n    WebPageControl1Sheet2.SetParentComponent(WebPageControl1);\r\n    WebPageControl1Sheet2.Name := 'WebPageControl1Sheet2';\r\n    WebPageControl1Sheet2.Left := 0;\r\n    WebPageControl1Sheet2.Top := 20;\r\n    WebPageControl1Sheet2.Width := 1930;\r\n    WebPageControl1Sheet2.Height := 1075;\r\n    WebPageControl1Sheet2.Caption := 'WebPageControl1Sheet2';\r\n    WebPageControl1Sheet3.SetParentComponent(WebPageControl1);\r\n    WebPageControl1Sheet3.Name := 'WebPageControl1Sheet3';\r\n    WebPageControl1Sheet3.Left := 0;\r\n    WebPageControl1Sheet3.Top := 20;\r\n    WebPageControl1Sheet3.Width := 1930;\r\n    WebPageControl1Sheet3.Height := 1075;\r\n    WebPageControl1Sheet3.Caption := 'WebPageControl1Sheet3';\r\n    dsSwimmers.SetParentComponent(Self);\r\n    dsSwimmers.Name := 'dsSwimmers';\r\n    dsSwimmers.DataSet := fDM.dSwimmers;\r\n    dsSwimmers.Left := 952;\r\n    dsSwimmers.Top := 592;\r\n  finally\r\n    WebPanel1.AfterLoadDFMValues;\r\n    WebButton1.AfterLoadDFMValues;\r\n    WebPanel2.AfterLoadDFMValues;\r\n    WebDBNavigator1.AfterLoadDFMValues;\r\n    WebPageControl1.AfterLoadDFMValues;\r\n    WebPageControl1Sheet1.AfterLoadDFMValues;\r\n    WebDBGrid1.AfterLoadDFMValues;\r\n    WebPanel3.AfterLoadDFMValues;\r\n    WebComboBox1.AfterLoadDFMValues;\r\n    WebPageControl1Sheet2.AfterLoadDFMValues;\r\n    WebPageControl1Sheet3.AfterLoadDFMValues;\r\n    dsSwimmers.AfterLoadDFMValues;\r\n  end;\r\nend;\r\n\r\nend.","unit uLogin;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Classes, JS, Web, WEBLib.Graphics, WEBLib.Controls,\r\n  WEBLib.Forms, WEBLib.Dialogs, DB, WEBLib.DB, WEBLib.CDS, WEBLib.Grids, WEBLib.DBCtrls, WEBLib.StdCtrls, WEBLib.ExtCtrls, WEBLib.Imaging.GIFImg;\r\n\r\ntype\r\n  TfLogin = class(TForm)\r\n    LoginBox: TGroupBox;\r\n    WebLabel1: TLabel;\r\n    UsernameEdit: TEdit;\r\n    PasswordEdit: TEdit;\r\n    LoginBtn: TButton;\r\n    LogoPanel: TPanel;\r\n    SignUpBox: TGroupBox;\r\n    WebLabel2: TLabel;\r\n    EmailEdit: TEdit;\r\n    PswEdit: TEdit;\r\n    SignUpBtn: TButton;\r\n    LogoPanel2: TPanel;\r\n    ConfirmPswEdit: TEdit;\r\n    LNameEdit: TEdit;\r\n    FNameEdit: TEdit;\r\n    procedure WebFormResize(Sender: TObject);\r\n    procedure LoginBtnClick(Sender: TObject);\r\n    procedure WebLabel1Click(Sender: TObject);\r\n    procedure CenterGroupBox;\r\n    procedure WebFormCreate(Sender: TObject);\r\n    procedure Login;\r\n\r\n  private\r\n    { Private declarations }\r\n  protected\r\n    procedure LoadDFMValues; override;\r\n  public\r\n    { Public declarations }\r\n  end;\r\n\r\nvar\r\n  fLogin: TfLogin;\r\n\r\nimplementation\r\nuses\r\n  uDM, uHome;\r\n\r\n\r\nprocedure TfLogin.LoginBtnClick(Sender: TObject);\r\nbegin\r\n  with fDM do\r\n  begin\r\n    if not dUsers.Active then\r\n      dUsers.Active := True;\r\n\r\n  if (dUsers.Locate('Username', UsernameEdit.Text, [locaseinsensitive])) and\r\n  (dUsers.FieldByName('Password').AsString = PasswordEdit.Text) then\r\n    Login\r\n  else\r\n    showmessage('Invalid Username or Password');\r\n\r\n  end;\r\nend;\r\n\r\nprocedure TfLogin.WebFormCreate(Sender: TObject);\r\nbegin\r\n  CenterGroupBox;\r\nend;\r\n\r\nprocedure TfLogin.WebFormResize(Sender: TObject);\r\nbegin\r\n  CenterGroupBox;\r\nend;\r\n\r\nprocedure TfLogin.WebLabel1Click(Sender: TObject);\r\nbegin\r\n  LoginBox.Visible := not LoginBox.Visible;\r\n  SignUpBox.Visible := not SignUpBox.Visible;\r\nend;\r\n\r\nprocedure TfLogin.CenterGroupBox;\r\nbegin\r\n  LoginBox.Top := (Height div 2) - (LoginBox.Height div 2) - 60;\r\n  LoginBox.Left := (Width div 2) - (LoginBox.Width div 2);\r\n\r\n  SignUpBox.Top := LoginBox.Top;\r\n  SignUpBox.Left := LoginBox.Left;\r\n\r\nend;\r\n\r\nprocedure TfLogin.Login;\r\nvar\r\n newform: TfHome;\r\n\r\nprocedure AfterShowModal(AValue: TModalResult);\r\nbegin\r\nend;\r\n\r\nprocedure AfterCreate(AForm: TObject);\r\nbegin\r\nend;\r\n\r\nbegin\r\n newform := TfHome.CreateNew(@AfterCreate);\r\n newform.ShowModal(@AfterShowModal);\r\nend;\r\n\r\nprocedure TfLogin.LoadDFMValues;\r\nbegin\r\n  inherited LoadDFMValues;\r\n\r\n  LoginBox := TGroupBox.Create(Self);\r\n  WebLabel1 := TLabel.Create(Self);\r\n  UsernameEdit := TEdit.Create(Self);\r\n  PasswordEdit := TEdit.Create(Self);\r\n  LoginBtn := TButton.Create(Self);\r\n  LogoPanel := TPanel.Create(Self);\r\n  SignUpBox := TGroupBox.Create(Self);\r\n  WebLabel2 := TLabel.Create(Self);\r\n  EmailEdit := TEdit.Create(Self);\r\n  PswEdit := TEdit.Create(Self);\r\n  SignUpBtn := TButton.Create(Self);\r\n  LogoPanel2 := TPanel.Create(Self);\r\n  ConfirmPswEdit := TEdit.Create(Self);\r\n  LNameEdit := TEdit.Create(Self);\r\n  FNameEdit := TEdit.Create(Self);\r\n\r\n  LoginBox.BeforeLoadDFMValues;\r\n  WebLabel1.BeforeLoadDFMValues;\r\n  UsernameEdit.BeforeLoadDFMValues;\r\n  PasswordEdit.BeforeLoadDFMValues;\r\n  LoginBtn.BeforeLoadDFMValues;\r\n  LogoPanel.BeforeLoadDFMValues;\r\n  SignUpBox.BeforeLoadDFMValues;\r\n  WebLabel2.BeforeLoadDFMValues;\r\n  EmailEdit.BeforeLoadDFMValues;\r\n  PswEdit.BeforeLoadDFMValues;\r\n  SignUpBtn.BeforeLoadDFMValues;\r\n  LogoPanel2.BeforeLoadDFMValues;\r\n  ConfirmPswEdit.BeforeLoadDFMValues;\r\n  LNameEdit.BeforeLoadDFMValues;\r\n  FNameEdit.BeforeLoadDFMValues;\r\n  try\r\n    Name := 'fLogin';\r\n    Left := 0;\r\n    Top := 0;\r\n    Width := 1956;\r\n    Height := 1181;\r\n    Font.Charset := DEFAULT_CHARSET;\r\n    Font.Color := clWindowText;\r\n    Font.Height := -11;\r\n    Font.Name := 'Arial';\r\n    Font.Style := [];\r\n    TabOrder := 1;\r\n    SetEvent(Self, Self, 'OnCreate', 'WebFormCreate');\r\n    SetEvent(Self, Self, 'OnResize', 'WebFormResize');\r\n    LoginBox.SetParentComponent(Self);\r\n    LoginBox.Name := 'LoginBox';\r\n    LoginBox.Left := 512;\r\n    LoginBox.Top := 276;\r\n    LoginBox.Width := 361;\r\n    LoginBox.Height := 445;\r\n    LoginBox.Caption := 'Login';\r\n    LoginBox.ChildOrder := 1;\r\n    LoginBox.Color := clWhite;\r\n    LoginBox.Font.Charset := DEFAULT_CHARSET;\r\n    LoginBox.Font.Color := clWindowText;\r\n    LoginBox.Font.Height := -16;\r\n    LoginBox.Font.Name := 'Arial';\r\n    LoginBox.Font.Style := [];\r\n    LoginBox.ParentFont := False;\r\n    WebLabel1.SetParentComponent(LoginBox);\r\n    WebLabel1.Name := 'WebLabel1';\r\n    WebLabel1.AlignWithMargins := True;\r\n    WebLabel1.Left := 150;\r\n    WebLabel1.Top := 364;\r\n    WebLabel1.Width := 161;\r\n    WebLabel1.Height := 16;\r\n    WebLabel1.Cursor := crHandPoint;\r\n    WebLabel1.Margins.Left := 150;\r\n    WebLabel1.Margins.Right := 50;\r\n    WebLabel1.Margins.Bottom := 10;\r\n    WebLabel1.Align := alBottom;\r\n    WebLabel1.Alignment := taRightJustify;\r\n    WebLabel1.Caption := 'New User? Sign Up Here';\r\n    WebLabel1.Font.Charset := DEFAULT_CHARSET;\r\n    WebLabel1.Font.Color := clBlue;\r\n    WebLabel1.Font.Height := -13;\r\n    WebLabel1.Font.Name := 'Arial';\r\n    WebLabel1.Font.Style := [];\r\n    WebLabel1.ParentFont := False;\r\n    SetEvent(WebLabel1, Self, 'OnClick', 'WebLabel1Click');\r\n    UsernameEdit.SetParentComponent(LoginBox);\r\n    UsernameEdit.Name := 'UsernameEdit';\r\n    UsernameEdit.AlignWithMargins := True;\r\n    UsernameEdit.Left := 25;\r\n    UsernameEdit.Top := 258;\r\n    UsernameEdit.Width := 311;\r\n    UsernameEdit.Height := 30;\r\n    UsernameEdit.Cursor := crIBeam;\r\n    UsernameEdit.Margins.Left := 25;\r\n    UsernameEdit.Margins.Top := 25;\r\n    UsernameEdit.Margins.Right := 25;\r\n    UsernameEdit.Align := alTop;\r\n    UsernameEdit.ChildOrder := 1;\r\n    UsernameEdit.Font.Charset := DEFAULT_CHARSET;\r\n    UsernameEdit.Font.Color := clWindowText;\r\n    UsernameEdit.Font.Height := -16;\r\n    UsernameEdit.Font.Name := 'Arial';\r\n    UsernameEdit.Font.Style := [];\r\n    UsernameEdit.ParentFont := False;\r\n    UsernameEdit.Required := True;\r\n    UsernameEdit.TextHint := 'Username/Email';\r\n    PasswordEdit.SetParentComponent(LoginBox);\r\n    PasswordEdit.Name := 'PasswordEdit';\r\n    PasswordEdit.AlignWithMargins := True;\r\n    PasswordEdit.Left := 25;\r\n    PasswordEdit.Top := 311;\r\n    PasswordEdit.Width := 311;\r\n    PasswordEdit.Height := 30;\r\n    PasswordEdit.Cursor := crIBeam;\r\n    PasswordEdit.Margins.Left := 25;\r\n    PasswordEdit.Margins.Top := 20;\r\n    PasswordEdit.Margins.Right := 25;\r\n    PasswordEdit.Align := alTop;\r\n    PasswordEdit.ChildOrder := 1;\r\n    PasswordEdit.Font.Charset := DEFAULT_CHARSET;\r\n    PasswordEdit.Font.Color := clWindowText;\r\n    PasswordEdit.Font.Height := -16;\r\n    PasswordEdit.Font.Name := 'Arial';\r\n    PasswordEdit.Font.Style := [];\r\n    PasswordEdit.ParentFont := False;\r\n    PasswordEdit.PasswordChar := '*';\r\n    PasswordEdit.Required := True;\r\n    PasswordEdit.TextHint := 'Password';\r\n    LoginBtn.SetParentComponent(LoginBox);\r\n    LoginBtn.Name := 'LoginBtn';\r\n    LoginBtn.AlignWithMargins := True;\r\n    LoginBtn.Left := 100;\r\n    LoginBtn.Top := 390;\r\n    LoginBtn.Width := 161;\r\n    LoginBtn.Height := 30;\r\n    LoginBtn.Cursor := crHandPoint;\r\n    LoginBtn.Margins.Left := 100;\r\n    LoginBtn.Margins.Top := 0;\r\n    LoginBtn.Margins.Right := 100;\r\n    LoginBtn.Margins.Bottom := 25;\r\n    LoginBtn.Align := alBottom;\r\n    LoginBtn.Caption := 'Login';\r\n    LoginBtn.ChildOrder := 2;\r\n    SetEvent(LoginBtn, Self, 'OnClick', 'LoginBtnClick');\r\n    LogoPanel.SetParentComponent(LoginBox);\r\n    LogoPanel.Name := 'LogoPanel';\r\n    LogoPanel.AlignWithMargins := True;\r\n    LogoPanel.Left := 10;\r\n    LogoPanel.Top := 25;\r\n    LogoPanel.Width := 341;\r\n    LogoPanel.Height := 208;\r\n    LogoPanel.Margins.Left := 10;\r\n    LogoPanel.Margins.Top := 25;\r\n    LogoPanel.Margins.Right := 10;\r\n    LogoPanel.Margins.Bottom := 0;\r\n    LogoPanel.Align := alTop;\r\n    LogoPanel.BorderColor := clSilver;\r\n    LogoPanel.BorderStyle := bsNone;\r\n    LogoPanel.Caption := 'LogoPanel';\r\n    LogoPanel.ChildOrder := 3;\r\n    LogoPanel.Color := clWhite;\r\n    LogoPanel.ShowCaption := False;\r\n    SignUpBox.SetParentComponent(Self);\r\n    SignUpBox.Name := 'SignUpBox';\r\n    SignUpBox.Left := 976;\r\n    SignUpBox.Top := 276;\r\n    SignUpBox.Width := 361;\r\n    SignUpBox.Height := 613;\r\n    SignUpBox.Caption := 'Sign Up';\r\n    SignUpBox.ChildOrder := 1;\r\n    SignUpBox.Color := clWhite;\r\n    SignUpBox.Font.Charset := DEFAULT_CHARSET;\r\n    SignUpBox.Font.Color := clWindowText;\r\n    SignUpBox.Font.Height := -16;\r\n    SignUpBox.Font.Name := 'Arial';\r\n    SignUpBox.Font.Style := [];\r\n    SignUpBox.ParentFont := False;\r\n    SignUpBox.Visible := False;\r\n    WebLabel2.SetParentComponent(SignUpBox);\r\n    WebLabel2.Name := 'WebLabel2';\r\n    WebLabel2.AlignWithMargins := True;\r\n    WebLabel2.Left := 100;\r\n    WebLabel2.Top := 532;\r\n    WebLabel2.Width := 231;\r\n    WebLabel2.Height := 16;\r\n    WebLabel2.Cursor := crHandPoint;\r\n    WebLabel2.Margins.Left := 100;\r\n    WebLabel2.Margins.Right := 30;\r\n    WebLabel2.Margins.Bottom := 10;\r\n    WebLabel2.Align := alBottom;\r\n    WebLabel2.Alignment := taRightJustify;\r\n    WebLabel2.Caption := 'Already have an account? Login Here';\r\n    WebLabel2.Font.Charset := DEFAULT_CHARSET;\r\n    WebLabel2.Font.Color := clBlue;\r\n    WebLabel2.Font.Height := -13;\r\n    WebLabel2.Font.Name := 'Arial';\r\n    WebLabel2.Font.Style := [];\r\n    WebLabel2.ParentFont := False;\r\n    SetEvent(WebLabel2, Self, 'OnClick', 'WebLabel1Click');\r\n    EmailEdit.SetParentComponent(SignUpBox);\r\n    EmailEdit.Name := 'EmailEdit';\r\n    EmailEdit.AlignWithMargins := True;\r\n    EmailEdit.Left := 25;\r\n    EmailEdit.Top := 258;\r\n    EmailEdit.Width := 311;\r\n    EmailEdit.Height := 30;\r\n    EmailEdit.Cursor := crIBeam;\r\n    EmailEdit.Margins.Left := 25;\r\n    EmailEdit.Margins.Top := 25;\r\n    EmailEdit.Margins.Right := 25;\r\n    EmailEdit.Align := alTop;\r\n    EmailEdit.ChildOrder := 1;\r\n    EmailEdit.Font.Charset := DEFAULT_CHARSET;\r\n    EmailEdit.Font.Color := clWindowText;\r\n    EmailEdit.Font.Height := -16;\r\n    EmailEdit.Font.Name := 'Arial';\r\n    EmailEdit.Font.Style := [];\r\n    EmailEdit.ParentFont := False;\r\n    EmailEdit.Required := True;\r\n    EmailEdit.TextHint := 'Email/Username';\r\n    PswEdit.SetParentComponent(SignUpBox);\r\n    PswEdit.Name := 'PswEdit';\r\n    PswEdit.AlignWithMargins := True;\r\n    PswEdit.Left := 25;\r\n    PswEdit.Top := 417;\r\n    PswEdit.Width := 311;\r\n    PswEdit.Height := 30;\r\n    PswEdit.Cursor := crIBeam;\r\n    PswEdit.Margins.Left := 25;\r\n    PswEdit.Margins.Top := 20;\r\n    PswEdit.Margins.Right := 25;\r\n    PswEdit.Align := alTop;\r\n    PswEdit.ChildOrder := 1;\r\n    PswEdit.Font.Charset := DEFAULT_CHARSET;\r\n    PswEdit.Font.Color := clWindowText;\r\n    PswEdit.Font.Height := -16;\r\n    PswEdit.Font.Name := 'Arial';\r\n    PswEdit.Font.Style := [];\r\n    PswEdit.ParentFont := False;\r\n    PswEdit.PasswordChar := '*';\r\n    PswEdit.Required := True;\r\n    PswEdit.TextHint := 'Password';\r\n    SignUpBtn.SetParentComponent(SignUpBox);\r\n    SignUpBtn.Name := 'SignUpBtn';\r\n    SignUpBtn.AlignWithMargins := True;\r\n    SignUpBtn.Left := 100;\r\n    SignUpBtn.Top := 558;\r\n    SignUpBtn.Width := 161;\r\n    SignUpBtn.Height := 30;\r\n    SignUpBtn.Cursor := crHandPoint;\r\n    SignUpBtn.Margins.Left := 100;\r\n    SignUpBtn.Margins.Top := 0;\r\n    SignUpBtn.Margins.Right := 100;\r\n    SignUpBtn.Margins.Bottom := 25;\r\n    SignUpBtn.Align := alBottom;\r\n    SignUpBtn.Caption := 'Sign Up';\r\n    SignUpBtn.ChildOrder := 2;\r\n    LogoPanel2.SetParentComponent(SignUpBox);\r\n    LogoPanel2.Name := 'LogoPanel2';\r\n    LogoPanel2.AlignWithMargins := True;\r\n    LogoPanel2.Left := 10;\r\n    LogoPanel2.Top := 25;\r\n    LogoPanel2.Width := 341;\r\n    LogoPanel2.Height := 208;\r\n    LogoPanel2.Margins.Left := 10;\r\n    LogoPanel2.Margins.Top := 25;\r\n    LogoPanel2.Margins.Right := 10;\r\n    LogoPanel2.Margins.Bottom := 0;\r\n    LogoPanel2.Align := alTop;\r\n    LogoPanel2.BorderColor := clSilver;\r\n    LogoPanel2.BorderStyle := bsNone;\r\n    LogoPanel2.Caption := 'LogoPanel';\r\n    LogoPanel2.ChildOrder := 3;\r\n    LogoPanel2.Color := clWhite;\r\n    LogoPanel2.ShowCaption := False;\r\n    ConfirmPswEdit.SetParentComponent(SignUpBox);\r\n    ConfirmPswEdit.Name := 'ConfirmPswEdit';\r\n    ConfirmPswEdit.AlignWithMargins := True;\r\n    ConfirmPswEdit.Left := 25;\r\n    ConfirmPswEdit.Top := 470;\r\n    ConfirmPswEdit.Width := 311;\r\n    ConfirmPswEdit.Height := 30;\r\n    ConfirmPswEdit.Cursor := crIBeam;\r\n    ConfirmPswEdit.Margins.Left := 25;\r\n    ConfirmPswEdit.Margins.Top := 20;\r\n    ConfirmPswEdit.Margins.Right := 25;\r\n    ConfirmPswEdit.Align := alTop;\r\n    ConfirmPswEdit.ChildOrder := 1;\r\n    ConfirmPswEdit.Font.Charset := DEFAULT_CHARSET;\r\n    ConfirmPswEdit.Font.Color := clWindowText;\r\n    ConfirmPswEdit.Font.Height := -16;\r\n    ConfirmPswEdit.Font.Name := 'Arial';\r\n    ConfirmPswEdit.Font.Style := [];\r\n    ConfirmPswEdit.ParentFont := False;\r\n    ConfirmPswEdit.PasswordChar := '*';\r\n    ConfirmPswEdit.Required := True;\r\n    ConfirmPswEdit.TextHint := 'Confirm Password';\r\n    LNameEdit.SetParentComponent(SignUpBox);\r\n    LNameEdit.Name := 'LNameEdit';\r\n    LNameEdit.AlignWithMargins := True;\r\n    LNameEdit.Left := 25;\r\n    LNameEdit.Top := 364;\r\n    LNameEdit.Width := 311;\r\n    LNameEdit.Height := 30;\r\n    LNameEdit.Cursor := crIBeam;\r\n    LNameEdit.Margins.Left := 25;\r\n    LNameEdit.Margins.Top := 20;\r\n    LNameEdit.Margins.Right := 25;\r\n    LNameEdit.Align := alTop;\r\n    LNameEdit.ChildOrder := 1;\r\n    LNameEdit.Font.Charset := DEFAULT_CHARSET;\r\n    LNameEdit.Font.Color := clWindowText;\r\n    LNameEdit.Font.Height := -16;\r\n    LNameEdit.Font.Name := 'Arial';\r\n    LNameEdit.Font.Style := [];\r\n    LNameEdit.ParentFont := False;\r\n    LNameEdit.Required := True;\r\n    LNameEdit.TextHint := 'Last Name';\r\n    FNameEdit.SetParentComponent(SignUpBox);\r\n    FNameEdit.Name := 'FNameEdit';\r\n    FNameEdit.AlignWithMargins := True;\r\n    FNameEdit.Left := 25;\r\n    FNameEdit.Top := 311;\r\n    FNameEdit.Width := 311;\r\n    FNameEdit.Height := 30;\r\n    FNameEdit.Cursor := crIBeam;\r\n    FNameEdit.Margins.Left := 25;\r\n    FNameEdit.Margins.Top := 20;\r\n    FNameEdit.Margins.Right := 25;\r\n    FNameEdit.Align := alTop;\r\n    FNameEdit.ChildOrder := 1;\r\n    FNameEdit.Font.Charset := DEFAULT_CHARSET;\r\n    FNameEdit.Font.Color := clWindowText;\r\n    FNameEdit.Font.Height := -16;\r\n    FNameEdit.Font.Name := 'Arial';\r\n    FNameEdit.Font.Style := [];\r\n    FNameEdit.ParentFont := False;\r\n    FNameEdit.Required := True;\r\n    FNameEdit.TextHint := 'First Name';\r\n  finally\r\n    LoginBox.AfterLoadDFMValues;\r\n    WebLabel1.AfterLoadDFMValues;\r\n    UsernameEdit.AfterLoadDFMValues;\r\n    PasswordEdit.AfterLoadDFMValues;\r\n    LoginBtn.AfterLoadDFMValues;\r\n    LogoPanel.AfterLoadDFMValues;\r\n    SignUpBox.AfterLoadDFMValues;\r\n    WebLabel2.AfterLoadDFMValues;\r\n    EmailEdit.AfterLoadDFMValues;\r\n    PswEdit.AfterLoadDFMValues;\r\n    SignUpBtn.AfterLoadDFMValues;\r\n    LogoPanel2.AfterLoadDFMValues;\r\n    ConfirmPswEdit.AfterLoadDFMValues;\r\n    LNameEdit.AfterLoadDFMValues;\r\n    FNameEdit.AfterLoadDFMValues;\r\n  end;\r\nend;\r\n\r\nend.\r\n","program LJST_SAS;\r\n\r\nuses\r\n  WEBLib.Forms,\r\n  uLogin in 'uLogin.pas'{*.html},\r\n  uDM in 'uDM.pas',\r\n  uHome in 'uHome.pas'{*.html};\r\n\r\n{$R *.res}\r\n\r\nbegin\r\n  Application.Initialize;\r\n  Application.MainFormOnTaskbar := True;\r\n  Application.CreateForm(TfLogin, fLogin);\r\n  Application.CreateForm(TfDM, fDM);\r\n  Application.CreateForm(TfHome, fHome);\r\n  Application.Run;\r\nend.\r\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACx2CA;;;;AAaY,oBAAG;AACH,oBAAG;AAIb,mBAAmB;AACnB,kCAAyC,cAAC,EAAD;AACzC,8BAAqC,cAAC,EAAD;AACrC,4BAA4B;AAGjB,qBAAG;AACH,qBAAG,CAAC;AACJ,qBAAG;AACH,qBAAG,CAAC;AACR,iBAAG;AACH,iBAAG;AACA,oBAAI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tC,gCA6CsC,CAA/B;AACA,mFAA+B,UA6vE3C,2BA7vE2C,CAA/B;AACL,8EAA+B,UAwsEtC,2BAxsEsC,CAA/B;AACM,oFAA+B,UArExC,+BAqEwC,CAA/B;AACN,8EAA+B,UAnEtC,2BAmEsC,CAA/B;AACA,8EAA+B,UAjX3C,sBAiX2C,CAA/B;AACF,4EAAgC,UAu7ElC,8BAv7EkC,CAAhC;AACC,6EAAgC,UAxEvC,0BAwEuC,CAAhC;AACG,gFAA+B,UAqwEtC,6BArwEsC,CAA/B;AACL,2EAA+B,UAsrEtC,wBAtrEsC,CAA/B;AACM,iFAA+B,UA9CtC,8BA8CsC,CAA/B;AACD,gFAA+B,UAxCtC,6BAwCsC,CAA/B;AACC,iFAAgC,UAxBvC,8BAwBuC,CAAhC;AACH,8EAA+B,UAkwEtC,2BAlwEsC,CAA/B;AAwOX;AACP;AADO;aACP;AADO;;AACP;AADO;;;AACP;AADO;AAMG;AACV;AADU;aACV;AADU;;AACV;AADU;;;AACV,qBHtkBa,+BGskBb;AADU;AAMA;AACV;AADU;aACV,4BACA;AAFU;;AACV;AACA;AAFU;;;AACV,0BH5kBa,+BG4kBb;AACA;AAFU;AAOA;AACV;AACA;AACA;AAHU;aACV,kBACA,IAAA,0CACA,oCADA;AAFU;;AACV;AACA;AACA;AAHU;;;AACV,qBHnlBa,+BGmlBb;AACA,iCHplBa,+BGolBb;AACA;AAHU;AAQI;AACd;AADc;aACd;AADc;;AACd;AADc;;;AACd;AADc;AAMJ;AACV;AACA;AACA;AAHU;aACV,sBACA,IAAA,kCACA,0BADA;AAFU;;AACV;AACA;AACA;AAHU;;;AACV,uBHjmBa,+BGimBb;AACA;AACA;AAHU;AAQS;AACnB;AADmB;aACnB;AADmB;;AACnB;AADmB;;;AACnB;AADmB;AAMN;;aACb;AADa;;AACb;AADa;;;AACb;AADa;AAMC;AACd;AADc;aACd,sBACA;AAFc;;AACd;AACA;AAFc;;;AACd;AACA;AAFc;AAOK;AACnB;AACA;AACA;AAHmB;aACnB,wCACA,IAAA,0CACA,0BADA;AAFmB;;AACnB;AACA;AACA;AAHmB;;;AACnB;AACA,iCH5gBW,6BG4gBX;AACA;AAHmB;AAQR;;aACX;AADW;;AACX;AADW;;;AACX,wBHpoBa,+BGooBb;AADW;AAMD;AACV;AADU;aACV;AADU;;AACV;AADU;;;AACV;AADU;AAME;AACZ;AACA;AAFY;aACZ,wBACA;AAFY;;AACZ;AACA;AAFY;;;AACZ,wBH/hBW,6BG+hBX;AACA,4BHhiBW,6BGgiBX;AAFY;AAOA;;aACZ;AADY;;AACZ;AADY;;;AACZ;AADY;AAMK;;aACjB;AADiB;;AACjB;AADiB;;;AACjB;AADiB;AAMC;;aAClB;AADkB;;AAClB;AADkB;;;AAClB;AADkB;AAMD;;aAChB;AADgB;;AAChB;AADgB;;;AAChB,yBA+ES,0BA/ET;AADgB;AAMF;;aACf;AADe;;AACf;AADe;;;AACf,yBAyEU,0BAzEV;AADe;AAMA;AACf;AACA;AAFe;aACf,wBACA;AAFe;;AACf;AACA;AAFe;;;AACf,wBHpkBW,6BGokBX;AACA,4BHrkBW,6BGqkBX;AAFe;AAON;AACT;AADS;aACT;AADS;;AACT;AADS;;;AACT;AADS;AAMM;;aACf;AADe;;AACf;AADe;;;AACf;AADe;AAMP;AACR;AACA;AACA;AAHQ;aACR,sBACA,IAAA,sBACA,0BADA;AAFQ;;AACR;AACA;AACA;AAHQ;;;AACR;AACA,uBHzsBa,+BGysBb;AACA,uBH1sBa,+BG0sBb;AAHQ;AAQQ;AAChB;AACA;AACA;AAHgB;aAChB,gBACA,IAAA,gBACA,oBADA;AAFgB;;AAChB;AACA;AACA;AAHgB;;;AAChB;AACA;AACA;AAHgB;AAQH;AACY,sDATT,wCASS;AACjB;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBQ;aACR,oBACA,IAAA,oBACA,IAAA,4BACA,IAAA,oBACA,IAAA,oBACA,IAAA,oBACA,IAAA,gBACA,IAAA,gBACA,IAAA,gBACA,IAAA,gBACA,IAAA,gBACA,IAAA,gBACA,IAAA,gBACA,IAAA,kBACA,IAAA,kBACA,IAAA,kBACA,IAAA,oBACA,oBAhBA;AAFQ;;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBQ;;;AACR;AACA;AACA,0BALa,6BAKb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAlByB,yCAkBzB;AACA;AAlBQ;AAuBG;AACX;AACA;AAFW;aACX,gCACA;AAFW;;AACX;AACA;AAFW;;;AACX,4BAOU,0BAPV;AACA,6BAMU,0BANV;AAFW;AAOI;AAoEI;AAEX,oBAAG;AACF,qBAAG;AACC,yBAAG;AAJG;AAkDA;AACnB;AACA;AACA;AAHmB;aACnB,0BACA,IAAA,kCACA,8BADA;AAFmB;;AACnB;AACA;AACA;AAHmB;;;AACnB;AACA;AACA;AAHmB;AAuKM;AACzB;AACA;AAFyB;aACzB,4BACA;AAFyB;;AACzB;AACA;AAFyB;;;AACzB;AACA;AAFyB;AA8DX;AACd;AACA;AAFc;aACd,sBACA;AAFc;;AACd;AACA;AAFc;;;AACd;AACA;AAFc;AAKE;AAChB;AACA;AACA;AAHgB;aAChB,kDACA,IAAA,4BACA,sCADA;AAFgB;;AAChB;AACA;AACA;AAHgB;;;AAChB;AACA;AACA;AAHgB;AAMJ;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AAPY;aACZ,8BACA,IAAA,gCACA,IAAA,8BACA,IAAA,8BACA,IAAA,8CACA,IAAA,4BACA,4BALA;AAFY;;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AAPY;;;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AAPY;AAUH;AAET;AAFS;;iBACT;AADS;;;aACT,yBACA;AAFS;;AACT;AACA;AAFS;;;AACT,yBAXY,4BAWZ;AACA;AAFS;AAKW,2EAAuB,aALlC,yBAKkC,CAAvB;AACH,0EAAuB,aAN/B,yBAM+B,CAAvB;AACQ,gFAAoB,UA5B/B,8BA4B+B,CAApB;AACH,+EAAoB,UA7B5B,8BA6B4B,CAApB;AAuEQ;AAC9B;AAD8B;aAC9B;AAD8B;;AAC9B;AAD8B;;;AAC9B;AAD8B;AA6HhB;AAqEK,0EAAmB,oBAAnB;AAEP,yCACL,+BADK;AAm2BW,mFAA+B,SA/ejD,qBA+eiD,CAA/B;AAkGX;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZY;aACZ,wBACA,IAAA,wDACA,IAAA,0DACA,IAAA,wDACA,IAAA,0DACA,IAAA,4DACA,IAAA,8DACA,IAAA,0CACA,IAAA,4CACA,IAAA,4CACA,IAAA,kDACA,wDAVA;AAFY;;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZY;;;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZY;AAsJc;AA4GX;AACf;AACA;AACA;AACA;AAJe;aACf,0BACA,IAAA,0BACA,IAAA,0BACA,oCAFA;AAFe;;AACf;AACA;AACA;AACA;AAJe;;;AACf;AACA;AACA;AACA;AAJe;AA8CN;AAEN,eAAG;AACE,oBAAG;AACH,oBAAG;AACJ,mBAAG;AACR,cAAG;AACC,kBAAG;AACJ,iBAAG;AACJ,gBAAG;AACA,mBAAG;AACA,sBAAG;AACR,iBAAG;AACH,iBAAG;AACF,kBAAG;AACC,sBAAG;AACR,iBAAG;AACL,eAAG;AACD,iBAAG;AACC,qBAAG;AACH,qBAAG;AACF,sBAAG;AACN,mBAAG;AACN,gBAAG;AACH,gBAAG;AACC,oBAAG;AACL,kBAAG;AACA,qBAAG;AACP,iBAAG;AACJ,gBAAG;AACF,iBAAG;AACL,eAAG;AACA,kBAAG;AACD,oBAAG;AACN,iBAAG;AACF,kBAAG;AACJ,iBAAG;AACJ,gBAAG;AACH,gBAAG;AACD,kBAAG;AACJ,iBAAG;AACJ,gBAAG;AACD,kBAAG;AACE,uBAAG;AACR,kBAAG;AACF,mBAAG;AACN,gBAAG;AACD,kBAAG;AACL,gBAAG;AACF,iBAAG;AACJ,gBAAG;AACF,iBAAG;AACF,kBAAG;AACH,kBAAG;AACF,mBAAG;AACI,0BAAG;AACL,wBAAG;AACV,iBAAG;AACF,kBAAG;AACJ,iBAAG;AACA,oBAAG;AACA,uBAAG;AACL,qBAAG;AACL,mBAAG;AACJ,kBAAG;AACI,yBAAG;AACJ,wBAAI;AACP,qBAAG;AACL,mBAAG;AACH,mBAAG;AACN,gBAAG;AACE,qBAAG;AACF,sBAAG;AACJ,qBAAG;AACH,qBAAG;AACC,yBAAG;AACL,uBAAG;AACD,yBAAG;AACN,sBAAG;AACI,6BAAG;AACb,mBAAG;AACK,2BAAG;AACR,sBAAG;AACJ,qBAAG;AACH,qBAAG;AACR,gBAAG;AACA,mBAAG;AACH,mBAAG;AACK,2BAAG;AACV,oBAAG;AACH,oBAAG;AACL,kBAAG;AACF,mBAAG;AACG,yBAAG;AACd,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACH,cAAG;AACF,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACH,eAAG;AACD,iBAAG;AACH,iBAAG;AACH,iBAAG;AACH,iBAAG;AACD,mBAAG;AACL,iBAAG;AACH,iBAAG;AACA,oBAAG;AACR,eAAG;AACE,oBAAG;AACL,kBAAG;AACD,oBAAG;AACF,qBAAG;AACH,qBAAG;AACR,gBAAG;AACD,kBAAG;AACE,uBAAG;AACP,mBAAG;AACJ,kBAAG;AACH,kBAAG;AACE,uBAAG;AACE,4BAAG;AACP,wBAAG;AACL,sBAAG;AACJ,qBAAG;AA1IH;AAsLM;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATe;aACf,wBACA,IAAA,0BACA,IAAA,kCACA,IAAA,sCACA,IAAA,4CACA,IAAA,oCACA,IAAA,wCACA,IAAA,kDACA,kCAPA;AAFe;;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATe;;;AACf;AACA,yBA7pGK,qBA6pGL;AACA,6BAjmGS,yBAimGT;AACA,+BAlmGS,yBAkmGT;AACA,kCAhqGK,qBAgqGL;AACA,8BAjqGK,qBA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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAe;AACf;AACA;AACA;AACA;AAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/GM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAk0HwB;AAAhB;AAEhB,eAAgB,WAAC,cAAD;AAFA;AAAgB;AAmDL;AAAX;AAEhB,eAAU,cAAS,CAAC,KAAD;AAFH;AAAW;AAnyEA;AAE3B,UAAI,aAAS,KAAG,MAAhB;AAEE;AACA,wBAAY;AACZ;AACA;OALF;AAF2B;AAWF;AAEzB,UAAI,WAAO,KAAG,MAAd;AAEE,sBAAU;AAEV;AAEA;AAGA,YAAG,kBAAS,IAAI,CAAI,iBAAW,IAAY,CAAC,uBAAD,SAA3C;AAEE,cAAG,MAAO,IAAG,CAAb;AACE,mCAAa,MAAM,YAAY,CAAC,SAAS,qBAAQ,CAAC,MAAD,CAAlB;AAE/B,gBAAA,uBAAa,MAAM,eAAe,CAAC,QAAD;SALtC;OATF;AAFyB;AAqEC;AAE1B;AAEA,UAAG,YAAQ,KAAG,MAAd;AAEE,YAAU,CAAN,WAAM,IAAG,cAAC,mBAAQ,oBAAS,oBAAlB,CAAH,CAAgC,IAAY,CAAC,uBAAD,SAAtD;AAEE,eAAM,uBAAa;AACnB,cAAU,CAAP,EAAE,IAAK,GAAE,MAAF,CAAS,IAAG,MAAM,YAA5B;AA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ACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXoD;AAnQI;AAExD;AACA;AACA;AAJwD;AAcH;AAErD;AACA;AAHqD;AAPF;AAEnD;AACA;AACA;AAJmD;AA0QG;AAEtD;AACA;AACA;AACA;AACA;AACA;AACA;AARsD;AA3P/C,gBAAG;AACI,uBAAG;AAHsC;AAAxB;AAK7B;AAEA,eAAiB;AAEjB,gBAAkB,gCAAP;;;;UAAO;AAElB,eAAiB,gCAAP;;;;WAAgB,KAAT;AAEjB,UAAG,MAAO,IAAG,CAAb;AAEE,kBAAkB,oCAAP;;;;aAAkB,EAAG,MAAd,CAAsB,GAA2B,gCAAR,CAAV,qCAAP;;;;eAAkB,MAAX,GAAU;;;;YAAQ,CAA3B;;AAIxC,YAAU,mCAAP;;;;YAAO,CAAQ,KAAE,CAApB,EACE,UAAW,OAAQ,GAAE,KAAM,GAAS,gCAAP;;;;YAAO,CADtC;;AAKJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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D;AAEC;;AACA;;AACD;;AACH;;AACC;;AA6BJ;AAzBO;;;AAEhB;AACA;AACA;AACA;AACA;AACA;AAPgB;;;;;;AAmwGuB;AAEzC,uBAAY,OAAO,CAAC,KAAD;AAFsB;AAqCH;AAEtC;AACA;AACA;AAEA,uBAAa;AACb,YAAO,WAAM;AAEb,UAAG,CAAY,CAAC,GAAD,SAAf,EACE,MADF;AAGA,UAAG,cAAU,KAAE,iCAAf;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;OAGO,UAAc,CAAV,cAAU,KAAE,8BAAF,CAAa,IAAsB,CAAjB,iBAAW,WAAC,EAAK,KAAG,EAAH,CAAjD;AAEH,iBAAU,iBAAW,WAAC;AACtB,iBAAmB,cAAC,IAAO,MAAM,CAAC,MA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AACL;AAEA,YAAQ;AACR,YAAO;AACP,aAAQ,kCAAW,CAAC,UAAD;AACnB,aAAQ,kCAAW,CAAC,YAAD;AAGrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxBgC;AA4BD;AAG7B;AACA;AAAK;AACL;AAEA,YAAQ;AACR,YAAO;AACP,aAAQ,kCAAW,CAAC,UAAD;AACnB,aAAQ,kCAAW,CAAC,YAAD;AAGrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3B+B;AA5DG;AAIhC;AACA;AAAK;AACL;AAEA,YAAQ;AACR,YAAO;AACP,aAAQ,kCAAW,CAAC,UAAD;AACnB,aAAQ,kCAAW,CAAC,YAAD;AAGrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5BkC;AA2FH;AAE7B;AACA;AAEA,YAAQ;AACR,YAAO;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhB+B;AAoBA;AAE7B;AACA;AACA;AAEA,YAAQ;AAEH;AACL,UADK,KACL;AAAW,cAAO;AAClB,gBAFK,KAEL;AAAO,cAAO;AACd,gBAHK,KAGL;AAAS,cAAO;AAChB,gBAJK,KAIL;AAAU,cAAO;AACjB,gBALK,KAKL;AAAU,cAAO;AACjB,gBANK,KAML,qCAAQ,MAAO,cAAf;AAGA,YAAO;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjC+B;AAqCA;AAE7B;AACA;AAAI;AACJ;AACA;AAEA,YAAQ;AAER,YAAO,kCAAW,CAAC,KAAD;AAClB,uBAAM,CAAC;;;;WAAI,EAAE,CAAP;AACN,YAAO;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5B+B;AAgCA;AAE7B;AACA;AAEA,YAAQ;AAER,YAAO;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAp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CC;AAEH;;AACC,kCADD,mCACC;AACK,wEAAoB,WAoC7B,sBApC6B,EAAgB,oBAApC;AACI,4EAAoB,WAmCjC,sBAnCiC,EAAc,mBAA0B,yBAA5D;AAEH,yEAAoB,WAiC9B,sBAjC8B,EAC1B,wBADM;AAEL,wCA+BL,oCA/BK;AAED;;AACD;AACT;AACA;AACA;AACA;AAJS;aACT,sBACA,IAAA,wBACA,IAAA,8BACA,0CAFA;AAFS;;AACT;AACA;AACA;AACA;AAJS;;;AACT;AACA,wBAHU,0BAGV;AACA;AACA,+BAxCW,2BAwCX;AAJS;AAMH,mCANG,iCAMH;AAEI;AACV;AACA;AACA;AACA;AAEA;AANU;;mBAKV;AALU;;;aACV,sBACA,IAAA,0BACA,IAAA,wCACA,IAAA,wBACA,IAAA,6BACA,kCAJA;AAFU;;AACV;AACA;AACA;AACA;AACA;AACA;AANU;;;AACV;AACA,yBAl+BW,2BAk+BX;AACA,gCAh+BY,4BAg+BZ;AACA;AACA,2BAhDO,uBAgDP;AACA;AANU;AAQK,4CARL,kCAQK;AAGF;AACb;AADa;aACb;AADa;;AACb;AADa;;;AACb,0BAJe,+BAIf;AADa;AAIM,4EAAoB,UAKjC,sBALiC,EAAiB,QAf9C,0BAe8C,CAArC;AACH,yEAAoB,UAI9B,sBAJ8B,EAAiB,QALxC,6BAKwC,CAArC;AAIV;;;AAEN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtEM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAygGuB;;AAGb;AAGhB;AACA;AACA;AAKF,YAAG,kBAAa,G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CAAC,UAAD,SAAf,EACE,MADF;AAGA,mBAAc,gBAAW,KAAE,wCAAF;AACzB,WAAM;AACN,cAAS,eAAM,GAAE,oBAAF;AACf,sBAAiB,KAAM,GAAE,0CAAF;AAEvB,UAAG,IAAK,GAAE,eAAV;AAEE,cAAO;AAEX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;OAvCE;AA2CA,UAAG,IAAK,IAAG,eAAX;AAEE,eAAQ,IAAK,GAAE,eAAF;AAGjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;OAjBE;AAsBF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGE;AAzGsC;AAsQC;AAEvC;AACA;AAAI;AAAI;AAAO;AAEf,aAAM,gBAAW,SAAC,EAAM,IAAG,IAA3B,EACE,gBAAW,IAAI,CAAC,sBAAD;AAEjB,sBAAW,KAAC,KAAS,KAAV;AAEX,UAAG,iBAAH,EACE,MADF;AAGA,UAAG,CAAY,CAAC,UAAD,SAAf,EACE,MADF;AAGA,WAAM;AAEN,WAAM;AAEN,cAAS,gBAAO,GAAE,qBAAF;AAEhB,sBAAiB,KAAM,GAAE,2CAAF;AAEvB,UAAG,IAAK,GAAE,eAAV;AAEE,cAAO;AAEX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;OA9BE;AAmCA,UAAG,IAAK,IAAG,eAAX;AAEE,eAAQ,IAAK,GAAE,eAAF;AAGjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;OAZE;AAiBF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvFyC;AAxJK;AAE5C;AAEA,8BAAoB;AAEpB,eAAS,SA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"}